<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>Nginx模块块stream和ngx_http_proxy_connect_module使用体验</title>
      <link href="/arlo/baeb958b/"/>
      <url>/arlo/baeb958b/</url>
      
        <content type="html"><![CDATA[<p>因项目环境限制，部署环境分为互联网环境（可访问互联网）和政务外网环境（不可访问互联网）；但是因业务需要，需要实现政务外网环境访问访问外网；（原因不究~~~）</p><a id="more"></a><p><img src="\images\2020\0812\01.png" alt="01"></p><p><img src="\images\2020\0812\02.png" alt="02"></p><h1 id="互联网区Server1-nginx搭建"><a href="#互联网区Server1-nginx搭建" class="headerlink" title="互联网区Server1 nginx搭建"></a>互联网区Server1 nginx搭建</h1><p><strong>ngx_http_proxy_connect_module</strong> ：<a href="https://github.com/chobits/ngx_http_proxy_connect_module" target="_blank" rel="external">https://github.com/chobits/ngx_http_proxy_connect_module</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">yum install gcc gcc-c++ make automake autoconf libtool pcre pcre-devel zlib zlib-devel openssl openssl-devel wget</div><div class="line">wget https://nginx.org/download/nginx-1.18.0.tar.gz</div><div class="line">wget https://github.com/chobits/ngx_http_proxy_connect_module/archive/master.zip</div><div class="line">tar xf nginx-1.18.0.tar.gz </div><div class="line">unzip master.zip</div><div class="line">cd nginx-1.18.0</div><div class="line">patch -p1 &lt; /usr/local/src/ngx_http_proxy_connect_module-master/patch/proxy_connect.patch </div><div class="line"></div><div class="line"># nginx版本高于1.9.11，可以使用--add-dynamic-module=/path加载动态模块,配置文件里需要load_module模块位置；使用--add-module=PATH编译，配置文件里不用使用load_module指定模块; </div><div class="line"></div><div class="line">./configure --prefix=/usr/local/nginx-1.18.0  --with-stream --add-dynamic-module=/usr/local/src/ngx_http_proxy_connect_module-master/</div><div class="line"></div><div class="line">make</div><div class="line">make install</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">worker_processes  auto;</div><div class="line">error_log  logs/error.log  info;</div><div class="line"></div><div class="line">load_module /usr/local/nginx-1.18.0/modules/ngx_http_proxy_connect_module.so; #加载模块的配置必须必须放在这个位置</div><div class="line"></div><div class="line">events &#123;</div><div class="line">    worker_connections  1024;</div><div class="line">&#125;</div><div class="line"></div><div class="line">http &#123;</div><div class="line">    include       mime.types;</div><div class="line">    default_type  application/octet-stream;</div><div class="line"></div><div class="line">    log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;</div><div class="line">                      &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</div><div class="line">                      &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</div><div class="line">    access_log  logs/access.log  main;</div><div class="line">    sendfile        on;</div><div class="line">    keepalive_timeout  65;</div><div class="line"></div><div class="line">    server &#123;</div><div class="line">       listen       11001;</div><div class="line">       server_name  localhost;</div><div class="line">       </div><div class="line">       location /forecast_pic&#123;</div><div class="line">proxy_pass http://x.x.x.x:xx/forecast_pic ;</div><div class="line">            root   html;</div><div class="line">            index  index.html index.htm;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        error_page   500 502 503 504  /50x.html;</div><div class="line">        location = /50x.html &#123;</div><div class="line">            root   html;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">include proxy.conf; #为了方便查看，我把ngx_http_proxy_connect_module代理的配置单独放在这个文件里了</div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"># cat proxy.conf </div><div class="line">server &#123;</div><div class="line">     listen    11003;</div><div class="line">    </div><div class="line">     # dns resolver used by forward proxying</div><div class="line">     resolver                       100.125.0.14;</div><div class="line"></div><div class="line">     location / &#123;</div><div class="line">                proxy_pass http://$host$request_uri;      </div><div class="line">                proxy_set_header HOST $http_host;</div><div class="line">                proxy_buffers 256 4k;</div><div class="line">                proxy_max_temp_file_size 0k;</div><div class="line">                proxy_connect_timeout 30;</div><div class="line">                proxy_send_timeout 60;</div><div class="line">                proxy_read_timeout 60;</div><div class="line">                proxy_next_upstream error timeout invalid_header http_502;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">server &#123;</div><div class="line">    listen                         11004;</div><div class="line">    # dns resolver used by forward proxying</div><div class="line">    resolver                       100.125.0.14;  #指定cns</div><div class="line"></div><div class="line">     # forward proxy for CONNECT request</div><div class="line">    proxy_connect;</div><div class="line">    proxy_connect_allow            443;#指定https端口</div><div class="line">    proxy_connect_connect_timeout  10s;</div><div class="line">    proxy_connect_read_timeout     10s;</div><div class="line">    proxy_connect_send_timeout     10s;</div><div class="line"></div><div class="line">    # forward proxy for non-CONNECT request</div><div class="line">    location / &#123;</div><div class="line">        proxy_pass http://$host;</div><div class="line">        proxy_set_header Host $host;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h1 id="政务外网区-Server2-Nginx搭建"><a href="#政务外网区-Server2-Nginx搭建" class="headerlink" title="政务外网区 Server2 Nginx搭建"></a>政务外网区 Server2 Nginx搭建</h1><p><strong>stream</strong> ：<a href="https://nginx.org/en/docs/stream/ngx_stream_core_module.html" target="_blank" rel="external">https://nginx.org/en/docs/stream/ngx_stream_core_module.html</a></p><p>nginx从1.9.0开始，新增加了一个stream模块，用来实现四层协议的转发、代理或者负载均衡等。（代理oracle、mysql等也是非常好用的，推荐~）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">yum install gcc gcc-c++ make automake autoconf libtool pcre pcre-devel zlib zlib-devel openssl openssl-devel wget</div><div class="line">wget https://nginx.org/download/nginx-1.18.0.tar.gz</div><div class="line">tar xf nginx-1.18.0.tar.gz </div><div class="line">cd nginx-1.18.0/</div><div class="line">./configure --prefix=/usr/local/nginx-1.18.0/ --with-stream &amp;&amp; make &amp;&amp; make install</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line">worker_processes  1;</div><div class="line">events &#123;</div><div class="line">    worker_connections  1024;</div><div class="line">&#125;</div><div class="line">stream &#123;</div><div class="line">   upstream proxy1 &#123;   </div><div class="line">        server 16.168.135.174:11003 weight=1 max_fails=2 fail_timeout=30s;   </div><div class="line">    &#125;</div><div class="line">    upstream proxy2 &#123;   </div><div class="line">        server 16.168.135.174:11004 weight=1 max_fails=2 fail_timeout=30s;   </div><div class="line">    &#125;</div><div class="line"> server &#123;</div><div class="line">        listen       11003;</div><div class="line">        proxy_connect_timeout 1s;</div><div class="line">        proxy_timeout 3s;</div><div class="line">        proxy_pass proxy1;</div><div class="line">   &#125;</div><div class="line"> server &#123;</div><div class="line">        listen       11004;</div><div class="line">        proxy_connect_timeout 1s;</div><div class="line">        proxy_timeout 3s;</div><div class="line">        proxy_pass proxy2;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">http &#123;</div><div class="line">    include       mime.types;</div><div class="line">    default_type  application/octet-stream;</div><div class="line">    sendfile        on;</div><div class="line">    keepalive_timeout  65;</div><div class="line">    server &#123;</div><div class="line">        listen       11001;</div><div class="line">        server_name  localhost;</div><div class="line">location / &#123;</div><div class="line">             if ($request_method = &apos;OPTIONS&apos;) &#123;</div><div class="line">   add_header &apos;Access-Control-Allow-Origin&apos; *;</div><div class="line">            add_header &apos;Access-Control-Allow-Credentials&apos; &apos;true&apos;;</div><div class="line">           add_header &apos;Access-Control-Allow-Methods&apos; &apos;GET, POST, PUT, DELETE, OPTIONS&apos;;</div><div class="line">            add_header &apos;Access-Control-Allow-Headers&apos; &apos;DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,token,timestamp&apos;;</div><div class="line">            add_header &apos;Access-Control-Max-Age&apos; 1728000;</div><div class="line">            add_header &apos;Content-Type&apos; &apos;text/plain charset=UTF-8&apos;;</div><div class="line">            add_header &apos;Content-Length&apos; 0;</div><div class="line">            return 204;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">        location /forecast_pic &#123;</div><div class="line">    proxy_pass http://x.x.x.x:xx1/forecast_pic;</div><div class="line">            root   html;</div><div class="line">            index  index.html index.htm;</div><div class="line">        &#125;</div><div class="line">location /FJAtmoCompr &#123;</div><div class="line">    proxy_pass http://x.x.x.x:xx2/FJAtmoCompr;</div><div class="line">&#125;</div><div class="line">location /cdwarn &#123;</div><div class="line">    proxy_pass http://x.x.x.x:xx3/cdwarn;</div><div class="line">&#125;</div><div class="line">        error_page   500 502 503 504  /50x.html;</div><div class="line">        location = /50x.html &#123;</div><div class="line">            root   html;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h1 id="政务外网区-Server3-代理使用测试"><a href="#政务外网区-Server3-代理使用测试" class="headerlink" title="政务外网区 Server3 代理使用测试"></a>政务外网区 Server3 代理使用测试</h1><p><img src="\images\2020\0812\03.png" alt="03"></p><p>为了长期使用，我们将代理设置为系统环境变量</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">vim /etc/profile</div><div class="line"></div><div class="line">export http_proxy=&apos;16.167.5.198:11003&apos;</div><div class="line">export https_proxy=&apos;16.167.5.198:11004&apos;</div><div class="line">export ftp_proxy=&apos;16.167.5.198:11003&apos;</div><div class="line"></div><div class="line">source /etc/profile</div></pre></td></tr></table></figure><p><img src="\images\2020\0812\04.png" alt="04"></p>]]></content>
      
      
      <categories>
          
          <category> 服务器搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Centos7.x静默安装Oracle 12.2.0.1.0</title>
      <link href="/arlo/e3c25d94/"/>
      <url>/arlo/e3c25d94/</url>
      
        <content type="html"><![CDATA[<p>今天项目上让安装一台12c的数据库，和之前的11g静默安装过程大致差不多，在此记录一下，方便日后查看。</p><h1 id="关闭selinux和firewalld"><a href="#关闭selinux和firewalld" class="headerlink" title="关闭selinux和firewalld"></a>关闭selinux和firewalld</h1><h2 id="关闭selinux"><a href="#关闭selinux" class="headerlink" title="关闭selinux"></a>关闭selinux</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sed -i &apos;s/SELINUX=enforcing/SELINUX=disabled/&apos; /etc/selinux/config</div><div class="line">grep SELINUX=disabled /etc/selinux/config</div><div class="line">setenforce 0</div></pre></td></tr></table></figure><h2 id="关闭firewalld"><a href="#关闭firewalld" class="headerlink" title="关闭firewalld"></a>关闭firewalld</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">systemctl stop firewalld.service</div><div class="line">systemctl disable firewalld.service</div></pre></td></tr></table></figure><a id="more"></a><h1 id="系统基础信息配置"><a href="#系统基础信息配置" class="headerlink" title="系统基础信息配置"></a>系统基础信息配置</h1><h2 id="基础软件安装"><a href="#基础软件安装" class="headerlink" title="基础软件安装"></a>基础软件安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#默认是不安装32位软件包的，添加此选项</div><div class="line">echo &apos;multilib_policy=all&apos; &gt;&gt; /etc/yum.conf</div><div class="line">yum -y install  binutils-* compat-libstdc++-* elfutils-libelf-*  elfutils-libelf-devel-* gcc-* gcc-c++-* glibc-* glibc-common-* glibc-devel-*  glibc-headers-* ksh-* libaio-*  libaio-devel-* libgcc-*  libstdc++* libstdc++-devel* make-*  sysstat-* unixODBC-* unixODBC-devel-* compat-libcap1* mksh </div><div class="line"># 非必须要安装的包，个人习惯</div><div class="line">yum -y install vim unzip lrzsz</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">#监测一下软件是否安装全</div><div class="line">rpm -q \</div><div class="line">binutils \</div><div class="line">compat-libstdc++-33 \</div><div class="line">elfutils-libelf \</div><div class="line">elfutils-libelf-devel \</div><div class="line">expat \</div><div class="line">gcc \</div><div class="line">gcc-c++ \</div><div class="line">glibc \</div><div class="line">glibc-common \</div><div class="line">glibc-devel \</div><div class="line">glibc-headers \</div><div class="line">libaio \</div><div class="line">libaio-devel \</div><div class="line">libgcc \</div><div class="line">libstdc++ \</div><div class="line">libstdc++-devel \</div><div class="line">make \</div><div class="line">pdksh \</div><div class="line">sysstat \</div><div class="line">unixODBC \</div><div class="line">unixODBC-devel \</div><div class="line">compat-libcap1 | grep &quot;not installed&quot;</div></pre></td></tr></table></figure><h2 id="配置主机名"><a href="#配置主机名" class="headerlink" title="配置主机名"></a>配置主机名</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hostnamectl set-hostname db-server</div></pre></td></tr></table></figure><h2 id="添加hosts记录"><a href="#添加hosts记录" class="headerlink" title="添加hosts记录"></a>添加hosts记录</h2><p><code>vim /etc/hosts</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</div><div class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</div><div class="line">127.0.0.1   db-server</div></pre></td></tr></table></figure><h2 id="修改PAM配置文件"><a href="#修改PAM配置文件" class="headerlink" title="修改PAM配置文件"></a>修改PAM配置文件</h2><p><code>vim /etc/pam.d/login</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">session    required     /lib64/security/pam_limits.so</div><div class="line">session    required     pam_limits.so</div></pre></td></tr></table></figure><h2 id="修改内核参数"><a href="#修改内核参数" class="headerlink" title="修改内核参数"></a>修改内核参数</h2><p><code>vim /etc/sysctl.conf</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">fs.aio-max-nr = 1048576 </div><div class="line">fs.file-max = 6815744 </div><div class="line">kernel.shmmni = 4096 </div><div class="line">kernel.sem = 250 32000 100 128 </div><div class="line">net.ipv4.ip_local_port_range = 9000 65500 </div><div class="line">net.core.rmem_default = 262144 </div><div class="line">net.core.rmem_max = 4194304 </div><div class="line">net.core.wmem_default = 262144 </div><div class="line">net.core.wmem_max = 1048586</div></pre></td></tr></table></figure><p>重新加载生效<br><code>sysctl -p</code></p><h2 id="修改系统资源限制"><a href="#修改系统资源限制" class="headerlink" title="修改系统资源限制"></a>修改系统资源限制</h2><p><code>vim /etc/security/limits.conf</code>  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">oracle  soft  nproc   2047 </div><div class="line">oracle  hard  nproc   16384 </div><div class="line">oracle  soft  nofile  1024 </div><div class="line">oracle  hard  nofile  65536</div><div class="line">oraclesoft  stack   10240</div></pre></td></tr></table></figure><h1 id="Oracle相关环境配置"><a href="#Oracle相关环境配置" class="headerlink" title="Oracle相关环境配置"></a>Oracle相关环境配置</h1><h2 id="新建用户"><a href="#新建用户" class="headerlink" title="新建用户"></a>新建用户</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">groupadd -g 1000 oinstall</div><div class="line">groupadd -g 1001 dba</div><div class="line">useradd -u 1000 -g oinstall -G dba oracle</div><div class="line">#设置oracle用户密码为oracle#123</div><div class="line">echo &quot;oracle:oracle#123&quot; | chpasswd</div></pre></td></tr></table></figure><h2 id="修改用户配置文件"><a href="#修改用户配置文件" class="headerlink" title="修改用户配置文件"></a>修改用户配置文件</h2><p><code>vim /etc/profile</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">#添加到文件末尾即可</div><div class="line"></div><div class="line">if [ $USER = &quot;oracle&quot; ]; then</div><div class="line">   if [ $SHELL = &quot;/bin/ksh&quot; ]; then</div><div class="line">       ulimit -p 16384</div><div class="line">       ulimit -n 65536</div><div class="line">   else</div><div class="line">       ulimit -u 16384 -n 65536</div><div class="line">   fi</div><div class="line">fi</div></pre></td></tr></table></figure><h2 id="新建目录并设置权限"><a href="#新建目录并设置权限" class="headerlink" title="新建目录并设置权限"></a>新建目录并设置权限</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mkdir -p /u01/app/oracle/product/12.2.0/db_1</div><div class="line">mkdir -p /u01/app/oraInventory</div><div class="line">chown -R oracle.oinstall /u01/app/oracle</div><div class="line">chown -R oracle.oinstall /u01/app/oraInventory</div><div class="line">chmod -R 775 /u01/app</div></pre></td></tr></table></figure><h2 id="设置oracle用户环境变量"><a href="#设置oracle用户环境变量" class="headerlink" title="设置oracle用户环境变量"></a>设置oracle用户环境变量</h2><p><code>su - oracle</code><br><code>vim ~/.bash_profile</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">export ORACLE_BASE=/u01/app/oracle</div><div class="line">export ORACLE_HOME=$ORACLE_BASE/product/12.2.0/db_1</div><div class="line">export ORACLE_SID=orcl</div><div class="line">export PATH=$PATH:$ORACLE_HOME/bin</div><div class="line">export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib</div><div class="line">export NLS_LANG=American_America.ZHS16GBK</div></pre></td></tr></table></figure><h2 id="检查环境变量是否生效"><a href="#检查环境变量是否生效" class="headerlink" title="检查环境变量是否生效"></a>检查环境变量是否生效</h2><p><code>source ~/.bash_profile</code><br><code>env |grep ORA</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ORACLE_SID=orcl</div><div class="line">ORACLE_BASE=/u01/app/oracle</div><div class="line">ORACLE_HOME=/u01/app/oracle/product/12.2.0/db_1</div></pre></td></tr></table></figure><h1 id="安装Oracle数据库"><a href="#安装Oracle数据库" class="headerlink" title="安装Oracle数据库"></a>安装Oracle数据库</h1><p>下载地址：<a href="https://www.oracle.com/database/technologies/oracle-database-software-downloads.html" target="_blank" rel="external">https://www.oracle.com/database/technologies/oracle-database-software-downloads.html</a></p><p>12.2.0.1.0只有一个软件包，(3,453,696,911 bytes) (cksum - 4170261901)，将<code>linuxx64_12201_database.zip</code>传到服务器/usr/local/src/ 目录下并解压。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@db-server src]# pwd</div><div class="line">/usr/local/src</div><div class="line">[root@db-server src]# unzip linuxx64_12201_database.zip </div><div class="line">……</div></pre></td></tr></table></figure><h2 id="安装Oracle数据库软件"><a href="#安装Oracle数据库软件" class="headerlink" title="安装Oracle数据库软件"></a>安装Oracle数据库软件</h2><p>解压后在/usr/local/src/database/response/ 目录下有三个rsp文件，用来作为静默安装时的应答文件的模板。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">db_install.rsp安装应答</div><div class="line">netca.rsp建立监听、本地服务名等网络设置的应答</div><div class="line">dbca.rsp创建数据库应答</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">--备份以下两个响应文件</div><div class="line">cp db_install.rsp db_install.bak</div><div class="line">cp dbca.rsp dbca.bak</div></pre></td></tr></table></figure><h3 id="修改db-install-rsp-文件"><a href="#修改db-install-rsp-文件" class="headerlink" title="修改db_install.rsp 文件"></a>修改db_install.rsp 文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line">[root@db-server response]# egrep -v &quot;^#|^$&quot; db_install.rsp </div><div class="line"></div><div class="line">oracle.install.responseFileVersion=/oracle/install/rspfmt_dbinstall_response_schema_v12.2.0</div><div class="line">oracle.install.option=INSTALL_DB_SWONLY</div><div class="line">UNIX_GROUP_NAME=oinstall</div><div class="line">INVENTORY_LOCATION=/u01/app/oraInventory</div><div class="line">ORACLE_HOME=/u01/app/oracle/product/12.2.0/db_1</div><div class="line">ORACLE_BASE=/u01/app/oracle</div><div class="line">      </div><div class="line">                               </div><div class="line">oracle.install.db.InstallEdition=EE</div><div class="line">oracle.install.db.OSDBA_GROUP=dba</div><div class="line">oracle.install.db.OSOPER_GROUP=</div><div class="line">oracle.install.db.OSBACKUPDBA_GROUP=dba</div><div class="line">oracle.install.db.OSDGDBA_GROUP=dba</div><div class="line">oracle.install.db.OSKMDBA_GROUP=dba</div><div class="line">oracle.install.db.OSRACDBA_GROUP=dba</div><div class="line">oracle.install.db.rac.configurationType=</div><div class="line">oracle.install.db.CLUSTER_NODES=</div><div class="line">oracle.install.db.isRACOneInstall=false</div><div class="line">oracle.install.db.racOneServiceName=</div><div class="line">oracle.install.db.rac.serverpoolName=</div><div class="line">oracle.install.db.rac.serverpoolCardinality=0</div><div class="line">oracle.install.db.config.starterdb.type=GENERAL_PURPOSE</div><div class="line">oracle.install.db.config.starterdb.globalDBName=</div><div class="line">oracle.install.db.config.starterdb.SID=</div><div class="line">oracle.install.db.ConfigureAsContainerDB=false</div><div class="line">oracle.install.db.config.PDBName=</div><div class="line">oracle.install.db.config.starterdb.characterSet=ZHS16GBK</div><div class="line">oracle.install.db.config.starterdb.memoryOption=false</div><div class="line">oracle.install.db.config.starterdb.memoryLimit=</div><div class="line">oracle.install.db.config.starterdb.installExampleSchemas=false</div><div class="line">oracle.install.db.config.starterdb.password.ALL=</div><div class="line">oracle.install.db.config.starterdb.password.SYS=</div><div class="line">oracle.install.db.config.starterdb.password.SYSTEM=</div><div class="line">oracle.install.db.config.starterdb.password.DBSNMP=</div><div class="line">oracle.install.db.config.starterdb.password.PDBADMIN=</div><div class="line">oracle.install.db.config.starterdb.managementOption=DEFAULT</div><div class="line">oracle.install.db.config.starterdb.omsHost=</div><div class="line">oracle.install.db.config.starterdb.omsPort=0</div><div class="line">oracle.install.db.config.starterdb.emAdminUser=</div><div class="line">oracle.install.db.config.starterdb.emAdminPassword=</div><div class="line">oracle.install.db.config.starterdb.enableRecovery=false</div><div class="line">oracle.install.db.config.starterdb.storageType=</div><div class="line">oracle.install.db.config.starterdb.fileSystemStorage.dataLocation=</div><div class="line">oracle.install.db.config.starterdb.fileSystemStorage.recoveryLocation=</div><div class="line">oracle.install.db.config.asm.diskGroup=</div><div class="line">oracle.install.db.config.asm.ASMSNMPPassword=</div><div class="line">MYORACLESUPPORT_USERNAME=</div><div class="line">MYORACLESUPPORT_PASSWORD=</div><div class="line">SECURITY_UPDATES_VIA_MYORACLESUPPORT=false</div><div class="line">DECLINE_SECURITY_UPDATES=true</div><div class="line">PROXY_HOST=</div><div class="line">PROXY_PORT=</div><div class="line">PROXY_USER=</div><div class="line">PROXY_PWD=</div><div class="line">COLLECTOR_SUPPORTHUB_URL=</div></pre></td></tr></table></figure><h3 id="执行静默安装"><a href="#执行静默安装" class="headerlink" title="执行静默安装"></a>执行静默安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">[oracle@db-server database]$ pwd</div><div class="line">/usr/local/src/database</div><div class="line">[oracle@db-server database]$ ./runInstaller -silent -ignorePrereq -ignoreSysPrereqs -responseFile /usr/local/src/database/response/db_install.rsp </div><div class="line">Starting Oracle Universal Installer...</div><div class="line"></div><div class="line">Checking Temp space: must be greater than 500 MB.   Actual 29865 MB    Passed</div><div class="line">Checking swap space: must be greater than 150 MB.   Actual 2047 MB    Passed</div><div class="line">Preparing to launch Oracle Universal Installer from /tmp/OraInstall2020-06-18_03-36-22AM. Please wait ...[oracle@db-server database]$ You can find the log of this install session at:</div><div class="line"> /u01/app/oraInventory/logs/installActions2020-06-18_03-36-22AM.log</div><div class="line">The installation of Oracle Database 12c was successful.</div><div class="line">Please check &apos;/u01/app/oraInventory/logs/silentInstall2020-06-18_03-36-22AM.log&apos; for more details.</div><div class="line"></div><div class="line">As a root user, execute the following script(s):</div><div class="line">1. /u01/app/oraInventory/orainstRoot.sh</div><div class="line">2. /u01/app/oracle/product/12.2.0/db_1/root.sh</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">Successfully Setup Software.</div></pre></td></tr></table></figure><p>安装过程中，我们可以另开一个终端查看安装日志</p><p><code>tail -f /u01/app/oraInventory/logs/silentInstall2020-06-18_03-36-22AM.log</code></p><h3 id="以root身份执行以下脚本，然后在刚才的安装界面敲回车，完成安装"><a href="#以root身份执行以下脚本，然后在刚才的安装界面敲回车，完成安装" class="headerlink" title="以root身份执行以下脚本，然后在刚才的安装界面敲回车，完成安装"></a>以root身份执行以下脚本，然后在刚才的安装界面敲回车，完成安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@db-server response]# /u01/app/oraInventory/orainstRoot.sh</div><div class="line">Changing permissions of /u01/app/oraInventory.</div><div class="line">Adding read,write permissions for group.</div><div class="line">Removing read,write,execute permissions for world.</div><div class="line"></div><div class="line">Changing groupname of /u01/app/oraInventory to oinstall.</div><div class="line">The execution of the script is complete.</div><div class="line">[root@db-server response]# /u01/app/oracle/product/12.2.0/db_1/root.sh</div><div class="line">Check /u01/app/oracle/product/12.2.0/db_1/install/root_db-server_2020-06-18_03-46-08-638987704.log for the output of root script</div></pre></td></tr></table></figure><h2 id="静默安装监听"><a href="#静默安装监听" class="headerlink" title="静默安装监听"></a>静默安装监听</h2><h3 id="安装监听"><a href="#安装监听" class="headerlink" title="安装监听"></a>安装监听</h3><p>静默安装使用默认的监听响应文件即可，不用修改。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[oracle@db-server ~]$ $ORACLE_HOME/bin/netca /silent /responseFile /usr/local/src/database/response/netca.rsp </div><div class="line"></div><div class="line">Parsing command line arguments:</div><div class="line">    Parameter &quot;silent&quot; = true</div><div class="line">    Parameter &quot;responsefile&quot; = /usr/local/src/database/response/netca.rsp</div><div class="line">Done parsing command line arguments.</div><div class="line">Oracle Net Services Configuration:</div><div class="line">Profile configuration complete.</div><div class="line">Oracle Net Listener Startup:</div><div class="line">The information provided for this listener is currently in use by other software on this computer. </div><div class="line">    Listener start failed.</div><div class="line">Check the trace file for details: /u01/app/oracle/cfgtoollogs/netca/trace_OraDB12Home1-2006183AM4751.log</div><div class="line">Oracle Net Services configuration failed.  The exit code is 1</div></pre></td></tr></table></figure><h3 id="启动监听"><a href="#启动监听" class="headerlink" title="启动监听"></a>启动监听</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">[oracle@db-server ~]$ lsnrctl start</div><div class="line"></div><div class="line">LSNRCTL for Linux: Version 12.2.0.1.0 - Production on 18-JUN-2020 03:48:13</div><div class="line"></div><div class="line">Copyright (c) 1991, 2016, Oracle.  All rights reserved.</div><div class="line"></div><div class="line">Starting /u01/app/oracle/product/12.2.0/db_1/bin/tnslsnr: please wait...</div><div class="line"></div><div class="line">TNSLSNR for Linux: Version 12.2.0.1.0 - Production</div><div class="line">System parameter file is /u01/app/oracle/product/12.2.0/db_1/network/admin/listener.ora</div><div class="line">Log messages written to /u01/app/oracle/diag/tnslsnr/db-server/listener/alert/log.xml</div><div class="line">Listening on: (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=db-server)(PORT=1539)))</div><div class="line">Listening on: (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1521)))</div><div class="line"></div><div class="line">Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=localhost)(PORT=1539)))</div><div class="line">STATUS of the LISTENER</div><div class="line">------------------------</div><div class="line">Alias                     LISTENER</div><div class="line">Version                   TNSLSNR for Linux: Version 12.2.0.1.0 - Production</div><div class="line">Start Date                18-JUN-2020 03:48:14</div><div class="line">Uptime                    0 days 0 hr. 0 min. 0 sec</div><div class="line">Trace Level               off</div><div class="line">Security                  ON: Local OS Authentication</div><div class="line">SNMP                      OFF</div><div class="line">Listener Parameter File   /u01/app/oracle/product/12.2.0/db_1/network/admin/listener.ora</div><div class="line">Listener Log File         /u01/app/oracle/diag/tnslsnr/db-server/listener/alert/log.xml</div><div class="line">Listening Endpoints Summary...</div><div class="line">  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=db-server)(PORT=1539)))</div><div class="line">  (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1521)))</div><div class="line">The listener supports no services</div><div class="line">The command completed successfully</div></pre></td></tr></table></figure><p><em><u>ps:细心的朋友应该发现了，我这里有点问题，启动的是1539端口，不是响应文件里定义的1521端口，暂时还没找到原因，先手动修改了。</u></em></p><h2 id="静默安装数据库"><a href="#静默安装数据库" class="headerlink" title="静默安装数据库"></a>静默安装数据库</h2><h3 id="修改安装数据库响应文件"><a href="#修改安装数据库响应文件" class="headerlink" title="修改安装数据库响应文件"></a>修改安装数据库响应文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">[root@db-server ~]# egrep -v &quot;^#|^$&quot; /usr/local/src/database/response/dbca.rsp</div><div class="line">responseFileVersion=/oracle/assistants/rspfmt_dbca_response_schema_v12.2.0</div><div class="line">gdbName=orcl</div><div class="line">sid=orcl</div><div class="line">databaseConfigType=SI</div><div class="line">RACOneNodeServiceName=</div><div class="line">policyManaged=false</div><div class="line">createServerPool=false</div><div class="line">serverPoolName=</div><div class="line">cardinality=</div><div class="line">force=false</div><div class="line">pqPoolName=</div><div class="line">pqCardinality=</div><div class="line">createAsContainerDatabase=false</div><div class="line">numberOfPDBs=0</div><div class="line">pdbName=</div><div class="line">useLocalUndoForPDBs=true</div><div class="line">pdbAdminPassword=</div><div class="line">nodelist=</div><div class="line">templateName=/u01/app/oracle/product/12.2.0/db_1/assistants/dbca/templates/General_Purpose.dbc</div><div class="line">sysPassword=Ths#123%</div><div class="line">systemPassword=Ths#123% </div><div class="line">serviceUserPassword=</div><div class="line">emConfiguration=</div><div class="line">emExpressPort=0</div><div class="line">runCVUChecks=false</div><div class="line">dbsnmpPassword=</div><div class="line">omsHost=</div><div class="line">omsPort=0</div><div class="line">emUser=</div><div class="line">emPassword=</div><div class="line">dvConfiguration=false</div><div class="line">dvUserName=</div><div class="line">dvUserPassword=</div><div class="line">dvAccountManagerName=</div><div class="line">dvAccountManagerPassword=</div><div class="line">olsConfiguration=false</div><div class="line">datafileJarLocation=&#123;ORACLE_HOME&#125;/assistants/dbca/templates/</div><div class="line">datafileDestination=&#123;ORACLE_BASE&#125;/oradata/&#123;DB_UNIQUE_NAME&#125;/</div><div class="line">recoveryAreaDestination=&#123;ORACLE_BASE&#125;/fast_recovery_area/&#123;DB_UNIQUE_NAME&#125;</div><div class="line">storageType=FS</div><div class="line">diskGroupName=</div><div class="line">asmsnmpPassword=</div><div class="line">recoveryGroupName=</div><div class="line">characterSet=ZHS16GBK</div><div class="line">nationalCharacterSet=</div><div class="line">registerWithDirService=false</div><div class="line">dirServiceUserName=</div><div class="line">dirServicePassword=</div><div class="line">walletPassword=</div><div class="line">listeners=</div><div class="line">variablesFile=</div><div class="line">variables=DB_UNIQUE_NAME=orcl,ORACLE_BASE=/u01/app/oracle,PDB_NAME=,DB_NAME=orcl,ORACLE_HOME=/u01/app/oracle/product/12.2.0/db_1,SID=orcl</div><div class="line">initParams=undo_tablespace=UNDOTBS1,memory_target=1577MB,processes=320,db_recovery_file_dest_size=8016MB,dispatchers=(PROTOCOL=TCP) (SERVICE=&#123;SID&#125;XDB),db_recovery_file_dest=&#123;ORACLE_BASE&#125;/fast_recovery_area/&#123;DB_UNIQUE_NAME&#125;,db_block_size=8KB,diagnostic_dest=&#123;ORACLE_BASE&#125;,audit_file_dest=&#123;ORACLE_BASE&#125;/admin/&#123;DB_UNIQUE_NAME&#125;/adump,db_create_file_dest=&#123;ORACLE_BASE&#125;/oradata/&#123;DB_UNIQUE_NAME&#125;/,compatible=12.2.0,db_name=orcl,audit_trail=db,remote_login_passwordfile=EXCLUSIVE,open_cursors=300</div><div class="line">sampleSchema=false</div><div class="line">memoryPercentage=40</div><div class="line">databaseType=MULTIPURPOSE</div><div class="line">automaticMemoryManagement=true</div><div class="line">totalMemory=0</div></pre></td></tr></table></figure><h3 id="执行静默建库"><a href="#执行静默建库" class="headerlink" title="执行静默建库"></a>执行静默建库</h3><p><strong>12c和11不同的地方就是在这里要加一个-createDatabase的参数。</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">[oracle@db-server ~]$ $ORACLE_HOME/bin/dbca -silent -createDatabase -responseFile /home/oracle/dbca.rsp </div><div class="line">Copying database files</div><div class="line">1% complete</div><div class="line">2% complete</div><div class="line">18% complete</div><div class="line">33% complete</div><div class="line">Creating and starting Oracle instance</div><div class="line">35% complete</div><div class="line">40% complete</div><div class="line">44% complete</div><div class="line">49% complete</div><div class="line">50% complete</div><div class="line">53% complete</div><div class="line">55% complete</div><div class="line">Completing Database Creation</div><div class="line">56% complete</div><div class="line">57% complete</div><div class="line">58% complete</div><div class="line">62% complete</div><div class="line">65% complete</div><div class="line">66% complete</div><div class="line">Executing Post Configuration Actions</div><div class="line">100% complete</div><div class="line">Look at the log file &quot;/u01/app/oracle/cfgtoollogs/dbca/orcl/orcl.log&quot; for further details.</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">[oracle@db-server ~]$ lsnrctl status</div><div class="line"></div><div class="line">LSNRCTL for Linux: Version 12.2.0.1.0 - Production on 17-JUN-2020 19:09:02</div><div class="line"></div><div class="line">Copyright (c) 1991, 2016, Oracle.  All rights reserved.</div><div class="line"></div><div class="line">Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=localhost)(PORT=1521)))</div><div class="line">STATUS of the LISTENER</div><div class="line">------------------------</div><div class="line">Alias                     LISTENER</div><div class="line">Version                   TNSLSNR for Linux: Version 12.2.0.1.0 - Production</div><div class="line">Start Date                17-JUN-2020 19:08:16</div><div class="line">Uptime                    0 days 0 hr. 0 min. 46 sec</div><div class="line">Trace Level               off</div><div class="line">Security                  ON: Local OS Authentication</div><div class="line">SNMP                      OFF</div><div class="line">Listener Parameter File   /u01/app/oracle/product/12.2.0/db_1/network/admin/listener.ora</div><div class="line">Listener Log File         /u01/app/oracle/diag/tnslsnr/db-server/listener/alert/log.xml</div><div class="line">Listening Endpoints Summary...</div><div class="line">  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=db-server)(PORT=1521)))</div><div class="line">Services Summary...</div><div class="line">Service &quot;orcl&quot; has 1 instance(s).</div><div class="line">  Instance &quot;orcl&quot;, status READY, has 1 handler(s) for this service...</div><div class="line">Service &quot;orclXDB&quot; has 1 instance(s).</div><div class="line">  Instance &quot;orcl&quot;, status READY, has 1 handler(s) for this service...</div><div class="line">The command completed successfully</div></pre></td></tr></table></figure><h1 id="配置开机启动"><a href="#配置开机启动" class="headerlink" title="配置开机启动"></a>配置开机启动</h1><h2 id="修改oratab"><a href="#修改oratab" class="headerlink" title="修改oratab"></a>修改oratab</h2><p><code>vim /etc/oratab</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">orcl:/u01/app/oracle/product/12.2.0/db_1:Y</div></pre></td></tr></table></figure><h2 id="修改dbstart文件"><a href="#修改dbstart文件" class="headerlink" title="修改dbstart文件"></a>修改dbstart文件</h2><p><code>vim /u01/app/oracle/product/12.2.0/db_1/bin/dbstart</code></p><p><em>修改第80行: ORACLE_HOME_LISTNER=$1为ORACLE_HOME_LISTNER=$ORACLE_HOME</em></p><h2 id="修改dbshut文件"><a href="#修改dbshut文件" class="headerlink" title="修改dbshut文件"></a>修改dbshut文件</h2><p><code>vim /u01/app/oracle/product/12.2.0/db_1/bin/dbshut</code></p><p><em>修改第50行: ORACLE_HOME_LISTNER=$1为ORACLE_HOME_LISTNER=$ORACLE_HOME</em></p><h2 id="修改开机启动文件"><a href="#修改开机启动文件" class="headerlink" title="修改开机启动文件"></a>修改开机启动文件</h2><p><code>vim /etc/rc.d/rc.local</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">su - oracle -lc &quot;/u01/app/oracle/product/12.2.0/db_1/bin/lsnrctl start&quot;</div><div class="line">su - oracle -lc &quot;/u01/app/oracle/product/12.2.0/db_1/bin/dbstart&quot;</div></pre></td></tr></table></figure><p>添加可执行权限</p><p><code>chmod +x /etc/rc.d/rc.local</code></p><h1 id="关闭审计日志"><a href="#关闭审计日志" class="headerlink" title="关闭审计日志"></a>关闭审计日志</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">由于默认审计日志默认是开启状态，长时间使用后会早上SYSTEM表空间撑爆，磁盘占用率高，建议关闭</div><div class="line">sqlplus / as sysdba</div><div class="line"></div><div class="line">SQL&gt; show parameter audit_trail</div><div class="line">SQL&gt; alter system set audit_trail=none scope=spfile;</div><div class="line">SQL&gt; shutdown immediate;</div><div class="line">SQL&gt; startup</div></pre></td></tr></table></figure><h1 id="使SqlPlus工具支持上下左右键"><a href="#使SqlPlus工具支持上下左右键" class="headerlink" title="使SqlPlus工具支持上下左右键"></a>使SqlPlus工具支持上下左右键</h1><p>安装rlwrap： <a href="http://islocal.cc/arlo/d9547628/">http://islocal.cc/arlo/d9547628/</a></p>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>zabbix(13)实现短信接口告警</title>
      <link href="/arlo/c254fd0e/"/>
      <url>/arlo/c254fd0e/</url>
      
        <content type="html"><![CDATA[<p>最近有个内网项目搭建了一套zabbix监控，由于不能访问互联网，导致告警无法使用邮件，钉钉类的方式推送告警通知；了解到之前项目上采购过一个金笛短信设备，拿来一试。</p><h1 id="官方文档说明"><a href="#官方文档说明" class="headerlink" title="官方文档说明"></a>官方文档说明</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">短信发送URL：</div><div class="line">http://127.0.0.1:8060/send?password=[password]&amp;text=[text]&amp;recipient=[cell-phone number]&amp;encoding=U</div><div class="line">短信接收URL：</div><div class="line">http://127.0.0.1:8060/read?password=[password]&amp;gateway=modem[id]&amp;count=[number]</div><div class="line">短信发送状态URL：</div><div class="line">http://127.0.0.1:8060/sendstatus?msgid=[msgid]</div></pre></td></tr></table></figure><a id="more"></a><h1 id="使用浏览器测试短信发送"><a href="#使用浏览器测试短信发送" class="headerlink" title="使用浏览器测试短信发送"></a>使用浏览器测试短信发送</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://10.206.2.108:8060/send?password=1&amp;text=[tes20200611]&amp;recipient=18xxxxxxxxx&amp;encoding=U</div></pre></td></tr></table></figure><p>手机可以正常收到。</p><h1 id="编写短信发送脚本"><a href="#编写短信发送脚本" class="headerlink" title="编写短信发送脚本"></a>编写短信发送脚本</h1><p><code>grep -E AlertScriptsPath /etc/zabbix/zabbix_server.conf</code><br><code>cd /usr/lib/zabbix/alertscripts</code></p><p><code>vim sendSMS.sh</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">[root@zw_zabbix_server alertscripts]# vim sendSMS.sh </div><div class="line">#!/bin/bash</div><div class="line"></div><div class="line"># 脚本的日志文件</div><div class="line">LOGFILE=&quot;/tmp/SMS.log&quot;</div><div class="line">:&gt;&quot;$LOGFILE&quot;</div><div class="line">exec 1&gt;&quot;$LOGFILE&quot;</div><div class="line">exec 2&gt;&amp;1</div><div class="line"></div><div class="line">MOBILE_NUMBER=$1    # 手机号码</div><div class="line">MESSAGE_UTF8=$3     # 短信内容</div><div class="line">XXD=&quot;/usr/bin/xxd&quot;</div><div class="line">CURL=&quot;/usr/bin/curl&quot;</div><div class="line">TIMEOUT=5</div><div class="line"></div><div class="line"># 短信内容要经过URL编码处理</div><div class="line">MESSAGE_ENCODE=$(echo &quot;$MESSAGE_UTF8&quot; | $&#123;XXD&#125; -ps | sed &apos;s/\(..\)/%\1/g&apos; | tr -d &apos;\n&apos;)</div><div class="line"></div><div class="line"># SMS API</div><div class="line">URL=&quot;http://10.206.2.108:8060/send?password=1&amp;text=$&#123;MESSAGE_ENCODE&#125;&amp;recipient=$MOBILE_NUMBER&amp;encoding=U&quot;</div><div class="line"></div><div class="line"># Send it</div><div class="line">set -x</div><div class="line">$&#123;CURL&#125; -s --connect-timeout $&#123;TIMEOUT&#125; &quot;$&#123;URL&#125;&quot;</div></pre></td></tr></table></figure><p><code>chmod +x sendSMS.sh</code></p><p><code>./sendSMS.sh 18xxxxxxxxx &quot;&quot; &quot;test zabbix sendmail&quot;</code></p><p>手机可以正常收到。</p><h1 id="配置zabbix"><a href="#配置zabbix" class="headerlink" title="配置zabbix"></a>配置zabbix</h1><h2 id="管理-报警媒介类型-创建媒体类型"><a href="#管理-报警媒介类型-创建媒体类型" class="headerlink" title="管理-报警媒介类型-创建媒体类型"></a>管理-报警媒介类型-创建媒体类型</h2><p><img src="\images\2020\0611\01.png" alt="01"></p><p><img src="\images\2020\0611\02.png" alt="01"></p><p>脚本参数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">名称：sendSMS</div><div class="line">类型：脚本</div><div class="line">脚本名称：sendSMS.sh</div><div class="line">添加以下3个参数，分别对应sendSMS.sh脚本需要的3个参数</div><div class="line">收短信电话号码:&#123;ALERT.SENDTO&#125;</div><div class="line">主题:&#123;ALERT.SUBJECT&#125;#好像没什么用</div><div class="line">短信内容:&#123;ALERT.MESSAGE&#125;</div></pre></td></tr></table></figure><h2 id="设置用户报警媒介"><a href="#设置用户报警媒介" class="headerlink" title="设置用户报警媒介"></a>设置用户报警媒介</h2><p><img src="\images\2020\0611\03.png" alt="01"></p><p><img src="\images\2020\0611\04.png" alt="01"></p><p><img src="\images\2020\0611\05.png" alt="01"></p><h2 id="触发告警器"><a href="#触发告警器" class="headerlink" title="触发告警器"></a>触发告警器</h2><p><img src="\images\2020\0611\06.png" alt="01"></p><p><img src="\images\2020\0611\07.png" alt="01"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">默认接收人:藏_故障&#123;TRIGGER.STATUS&#125;:服务器 &#123;HOSTNAME1&#125;:&#123;TRIGGER.NAME&#125;</div><div class="line">默认信息:</div><div class="line">告警主机:&#123;HOSTNAME1&#125;</div><div class="line">告警时间:&#123;EVENT.DATE&#125; &#123;EVENT.TIME&#125;</div><div class="line">告警等级:&#123;TRIGGER.SEVERITY&#125;</div><div class="line">告警信息: &#123;TRIGGER.NAME&#125;</div><div class="line">告警项目:&#123;TRIGGER.KEY1&#125;</div><div class="line">问题详情:&#123;ITEM.NAME&#125;:&#123;ITEM.VALUE&#125;</div><div class="line">当前状态:&#123;TRIGGER.STATUS&#125;:&#123;ITEM.VALUE1&#125;</div><div class="line">事件ID:&#123;EVENT.ID&#125;</div><div class="line">请至Montoring-Events中查看详细情况。</div></pre></td></tr></table></figure><p><img src="\images\2020\0611\08.png" alt="01"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">默认接收人:藏_故障&#123;TRIGGER.STATUS&#125;:服务器 &#123;HOSTNAME1&#125;:&#123;TRIGGER.NAME&#125;</div><div class="line">告警主机:&#123;HOSTNAME1&#125;</div><div class="line">告警时间:&#123;EVENT.DATE&#125; &#123;EVENT.TIME&#125;</div><div class="line">告警等级:&#123;TRIGGER.SEVERITY&#125;</div><div class="line">告警信息: &#123;TRIGGER.NAME&#125;</div><div class="line">告警项目:&#123;TRIGGER.KEY1&#125;</div><div class="line">问题详情:&#123;ITEM.NAME&#125;:&#123;ITEM.VALUE&#125;</div><div class="line">当前状态:&#123;TRIGGER.STATUS&#125;:&#123;ITEM.VALUE1&#125;</div><div class="line">事件ID:&#123;EVENT.ID&#125;</div><div class="line">报警已恢复，请放松心情。</div></pre></td></tr></table></figure><h2 id="测试告警"><a href="#测试告警" class="headerlink" title="测试告警"></a>测试告警</h2><p>关闭agent，测试告警</p><p><img src="\images\2020\0611\09.png" alt="01"></p><p>测试成功。</p><p><em>ps：第二天测试的时候发现短信平台成功发送了，但是手机收不到短信，咨询厂家，怀疑是运营商拦截了。</em></p>]]></content>
      
      
      <categories>
          
          <category> 监控 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> zabbix </tag>
            
            <tag> 监控 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Zabbix(12)升级php版本</title>
      <link href="/arlo/af5322c5/"/>
      <url>/arlo/af5322c5/</url>
      
        <content type="html"><![CDATA[<p>漏扫设备扫描处理zabbix服务器有很多漏洞，看了一眼基本上都是openssh和php相关的漏洞，决定升级一下版本。</p><p>zabbix4.4.8默认安装的php是5.4.16</p><a id="more"></a><h1 id="查看php版本"><a href="#查看php版本" class="headerlink" title="查看php版本"></a>查看php版本</h1><p><img src="\images\2020\0602\01.png" alt="01"></p><h1 id="升级php版本"><a href="#升级php版本" class="headerlink" title="升级php版本"></a>升级php版本</h1><p><code>rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</code></p><p><code>rpm -Uvh https://rpms.remirepo.net/enterprise/remi-release-7.rpm</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">cat &lt;&lt;EOF&gt; /etc/yum.repos.d/remi.repo</div><div class="line">[remi]</div><div class="line">name=Remi&apos;s RPM repository for Enterprise Linux 7 - $basearch</div><div class="line">#baseurl=http://rpms.remirepo.net/enterprise/7/remi/$basearch/</div><div class="line">#mirrorlist=https://rpms.remirepo.net/enterprise/7/remi/httpsmirror</div><div class="line">mirrorlist=http://cdn.remirepo.net/enterprise/7/remi/mirror</div><div class="line">enabled=0</div><div class="line">gpgcheck=1</div><div class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-remi</div><div class="line">EOF</div><div class="line">cat &lt;&lt;EOF&gt; /etc/yum.repos.d/remi-php73.repo</div><div class="line">[remi-php73]</div><div class="line">name=Remi&apos;s PHP 7.3 RPM repository for Enterprise Linux 7 - $basearch</div><div class="line">#baseurl=http://rpms.remirepo.net/enterprise/7/php73/$basearch/</div><div class="line">mirrorlist=https://rpms.remirepo.net/enterprise/7/php73/httpsmirror</div><div class="line">mirrorlist=http://cdn.remirepo.net/enterprise/7/php73/mirror</div><div class="line">enabled=1</div><div class="line">gpgcheck=1</div><div class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-remi</div><div class="line">EOF</div></pre></td></tr></table></figure><p><code>yum -y upgrade php*</code></p><h1 id="验证php版本"><a href="#验证php版本" class="headerlink" title="验证php版本"></a>验证php版本</h1><p><img src="\images\2020\0602\02.png" alt="01"></p>]]></content>
      
      
      <categories>
          
          <category> 监控 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> zabbix </tag>
            
            <tag> 监控 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Thread 1 cannot allocate new log 故障处理</title>
      <link href="/arlo/2cd5eb70/"/>
      <url>/arlo/2cd5eb70/</url>
      
        <content type="html"><![CDATA[<p>开发反馈业务系统无法登录，排查了到数据库部分时候，发现日志里有“ Thread 1 cannot allocate new log ”错误，该错误是redo日志组无法切换，初步查看了日志情况，没有可切换空余的日志组。</p><a id="more"></a><h1 id="各种状态含义"><a href="#各种状态含义" class="headerlink" title="各种状态含义"></a>各种状态含义</h1><p><strong>CURRENT</strong>：指当前的日志文件,在进行实例恢复时是必须的；</p><p><strong>ACTIVE</strong>：是指活动的非当前日志,在进行实例恢复时会被用到。Active状态意味着,Checkpoint尚未完成,因此该日志文件不能被覆盖。这时也不能drop掉,应该执行alter system checkpoint; –强制执行检查点;然后在操作。</p><p><strong>INACTIVE</strong>：是非活动日志,在实例恢复时不再需要,但在介质恢复时可能需要。</p><p><strong>UNUSED</strong>：表示该日志从未被写入,可能是刚添加的,或RESETLOGS后被重置。</p><h1 id="查看日志状态"><a href="#查看日志状态" class="headerlink" title="查看日志状态"></a>查看日志状态</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">--查看日志组状态</div><div class="line">select group#,sequence#,bytes,members,status from v$log;</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">--查看当前日志组成员</div><div class="line">select * from v$logfile;</div><div class="line">select * from v$log;</div></pre></td></tr></table></figure><h1 id="增加日志组"><a href="#增加日志组" class="headerlink" title="增加日志组"></a>增加日志组</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter database add logfile group 4 (&apos;/u01/app/oracle/oradata/orcl/redo04.log&apos;) size 1024m;</div><div class="line"></div><div class="line">SQL&gt; alter database add logfile group 5 (&apos;/u01/app/oracle/oradata/orcl/redo05.log&apos;) size 1024m;</div><div class="line"></div><div class="line">SQL&gt; alter database add logfile group 6 (&apos;/u01/app/oracle/oradata/orcl/redo06.log&apos;) size 1024m;</div></pre></td></tr></table></figure><h1 id="切换到新增的日志组上"><a href="#切换到新增的日志组上" class="headerlink" title="切换到新增的日志组上"></a>切换到新增的日志组上</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter system switch logfile;   --可多次执行,直到CURRENT指向新建的日志组</div></pre></td></tr></table></figure><h1 id="删除日志组"><a href="#删除日志组" class="headerlink" title="删除日志组"></a>删除日志组</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">-- 只能删除INACTIVE状态日志， 只能从数据库中删除日志，并不删除物理文件，需要手动rm删除系统中的物理文件。</div><div class="line">alter database drop logfile group 1;</div><div class="line">alter database drop logfile group 2;</div><div class="line">alter database drop logfile group 3;</div></pre></td></tr></table></figure><p>ps：</p><p>查看占用资源较多的进程，根据进程系统进程id查看sql语句；</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">SELECT addr FROM v$process WHERE spid=&apos;418736&apos;;</div><div class="line">SELECT sql_id FROM v$session WHERE paddr=&apos;0000000978F9B0E0&apos;</div><div class="line">SELECT sql_text FROM v$sql WHERE sql_id =&apos;0uy9j8b502c4r&apos;;</div></pre></td></tr></table></figure><p>如果遇到复杂的性能问题，还是建议生成awr报告，更加详细的反馈数据库的性能，瓶颈，根据具体项去做优化。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SYS@orcl&gt; @?/rdbms/admin/awrrpt.sql</div></pre></td></tr></table></figure><p>参考链接：</p><p><a href="https://www.cnblogs.com/xqzt/p/5034826.html" target="_blank" rel="external">https://www.cnblogs.com/xqzt/p/5034826.html</a></p><p><a href="https://blog.51cto.com/4709096/1741983" target="_blank" rel="external">https://blog.51cto.com/4709096/1741983</a></p>]]></content>
      
      
      
    </entry>
    
    <entry>
      <title>Zabbix(11)使用zabbix监控VMware虚拟化</title>
      <link href="/arlo/1faeef66/"/>
      <url>/arlo/1faeef66/</url>
      
        <content type="html"><![CDATA[<p>zabbix也可以监控VMware虚拟化，支持VMware vCenter或vSphere版本最低为4.1。 </p><p>以下配置文件参数可用于调整虚拟机监控： </p><p><strong>StartVMwareCollectors</strong> - 预先启动Vmware collector收集器实例的数量。 </p><p>此值取决于要监控的VMware服务的数量。在大多数情况下，这应该是： servicenum &lt; StartVMwareCollectors &lt; (servicenum * 2)其中 servicenum 是 VMware 服务的数量。例如：如果您有1个VMware服务，请将 StartVMwareCollectors 设置为 2，那么果您有 3 个 VMware 服务，请将其设置为 5。请注意，在大多数情况下，此值不应小于 2，不应大于 VMware 数量的 2 倍服务。还要记住，此值还取决于 VMware 环境大小和 VMwareFrequency 和 VMwarePerfFrequency 配置参数。 </p><p><strong>VMwareCacheSize</strong> - 用于存储VMware数据的缓存容量，默认为8M，取值范围：256K-2G。</p><p><strong>VMwareFrequency</strong> - 接到VMware服务收集一个新数据的频率，默认为60秒，取值范围：10-86400。</p><p> <strong>VMwarePerfFrequency</strong> - 连接到VMware服务收集性能数据的频率，默认为60秒，取值范围：10-86400。 </p><p><strong>VMwareTimeout</strong> - VMware collector等待VMware服务响应的时间，默认为10秒，取值范围：1-300。</p><a id="more"></a><h1 id="配置zabbix服务器"><a href="#配置zabbix服务器" class="headerlink" title="配置zabbix服务器"></a>配置zabbix服务器</h1><p><code>egrep -v &quot;^#|^$&quot; /etc/zabbix/zabbix_server.conf |grep -i vmware</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">StartVMwareCollectors=5</div><div class="line">VMwareFrequency=60</div><div class="line">VMwarePerfFrequency=60</div><div class="line">VMwareTimeout=60</div></pre></td></tr></table></figure><p><code>systemctl restart zabbix-server</code></p><p><code>systemctl status zabbix-server</code></p><p><img src="\images\2020\0515\01.png" alt="01"></p><h1 id="添加vCenter"><a href="#添加vCenter" class="headerlink" title="添加vCenter"></a>添加vCenter</h1><p><img src="\images\2020\0515\02.png" alt="01"></p><p>关联模板</p><p><img src="\images\2020\0515\03.png" alt="01"></p><p>点击宏，添加以下内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;$USERNAME&#125;：vcenter超管</div><div class="line">&#123;$PASSWORD&#125;：vcenter超管密码</div><div class="line">&#123;$URL&#125;：https://vcenterip/sdk</div></pre></td></tr></table></figure><p><img src="\images\2020\0515\04.png" alt="01"></p><h1 id="自动发现"><a href="#自动发现" class="headerlink" title="自动发现"></a>自动发现</h1><p>点击vcenter主机-自动发现规则-勾选自动发现规则-点击现在检查</p><p><img src="\images\2020\0515\05.png" alt="01"></p><p><img src="\images\2020\0515\06.png" alt="01"></p><p><img src="\images\2020\0515\07.png" alt="01"></p><p>至此，已经实现了对vmware虚拟化平台的监控，但是默认的模板里没有图形和触发器，我还需要继续研究一下。</p><p>可以参考：</p><p><a href="https://www.mr-mao.cn/archives/zabbix-monitor-vcenter-esxi-vm.html" target="_blank" rel="external">https://www.mr-mao.cn/archives/zabbix-monitor-vcenter-esxi-vm.html</a></p><p><a href="https://www.zabbix.com/documentation/4.0/zh/manual/config/items/itemtypes/simple_checks/vmware_keys" target="_blank" rel="external">https://www.zabbix.com/documentation/4.0/zh/manual/config/items/itemtypes/simple_checks/vmware_keys</a></p>]]></content>
      
      
      <categories>
          
          <category> 监控 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> zabbix </tag>
            
            <tag> 监控 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>处理Oracle故障：error=27072 txt: &#39;Linux-x86_64 Error: 5: Input/output error</title>
      <link href="/arlo/bd0ffc81/"/>
      <url>/arlo/bd0ffc81/</url>
      
        <content type="html"><![CDATA[<p>今天周末，一大早开发经理发消息说项目上有个数据库连不上了，让上去排查一下。连上数据库之后，监听是启动状态，但是并没有注册数据库，看日志早上8点多的时候数据库出错，自动关掉了，错误日志如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tail -n 1000 /u01/app/oracle/diag/rdbms/orcl/orcl/trace/alert_orcl.log</div></pre></td></tr></table></figure><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">Sat Apr 18 23:50:29 2020</div><div class="line">Thread 1 cannot allocate new log, sequence 11779</div><div class="line">Private strand flush not complete</div><div class="line">  Current log# 3 seq# 11778 mem# 0: /u01/app/oracle/oradata/orcl/redo03.log</div><div class="line">Thread 1 advanced to log sequence 11779 (LGWR switch)</div><div class="line">  Current log# 1 seq# 11779 mem# 0: /u01/app/oracle/oradata/orcl/redo01.log</div><div class="line">Sun Apr 19 01:29:06 2020</div><div class="line">Thread 1 advanced to log sequence 11780 (LGWR switch)</div><div class="line">  Current log# 2 seq# 11780 mem# 0: /u01/app/oracle/oradata/orcl/redo02.log</div><div class="line">Sun Apr 19 02:00:00 2020</div><div class="line">Closing scheduler window</div><div class="line">Closing Resource Manager plan via scheduler window</div><div class="line">Clearing Resource Manager plan via parameter</div><div class="line">Sun Apr 19 03:02:45 2020</div><div class="line">Thread 1 advanced to log sequence 11781 (LGWR switch)</div><div class="line">  Current log# 3 seq# 11781 mem# 0: /u01/app/oracle/oradata/orcl/redo03.log</div><div class="line">Sun Apr 19 04:49:42 2020</div><div class="line">Thread 1 advanced to log sequence 11782 (LGWR switch)</div><div class="line">  Current log# 1 seq# 11782 mem# 0: /u01/app/oracle/oradata/orcl/redo01.log</div><div class="line">Sun Apr 19 06:00:00 2020</div><div class="line">Setting Resource Manager plan SCHEDULER[0x32DF]:DEFAULT_MAINTENANCE_PLAN via scheduler window</div><div class="line">Setting Resource Manager plan DEFAULT_MAINTENANCE_PLAN via parameter</div><div class="line">Sun Apr 19 06:00:00 2020</div><div class="line">Starting background process VKRM</div><div class="line">Sun Apr 19 06:00:00 2020</div><div class="line">VKRM started with pid=58, OS id=17023 </div><div class="line">Sun Apr 19 06:00:02 2020</div><div class="line">Begin automatic SQL Tuning Advisor run for special tuning task  &quot;SYS_AUTO_SQL_TUNING_TASK&quot;</div><div class="line">Sun Apr 19 06:00:07 2020</div><div class="line">Thread 1 advanced to log sequence 11783 (LGWR switch)</div><div class="line">  Current log# 2 seq# 11783 mem# 0: /u01/app/oracle/oradata/orcl/redo02.log</div><div class="line">Sun Apr 19 06:00:51 2020</div><div class="line">End automatic SQL Tuning Advisor run for special tuning task  &quot;SYS_AUTO_SQL_TUNING_TASK&quot;</div><div class="line">Sun Apr 19 07:10:49 2020</div><div class="line">Thread 1 advanced to log sequence 11784 (LGWR switch)</div><div class="line">  Current log# 3 seq# 11784 mem# 0: /u01/app/oracle/oradata/orcl/redo03.log</div><div class="line">Sun Apr 19 08:00:49 2020</div><div class="line">KCF: read, write or open error, block=0xe0 online=1</div><div class="line">        file=3 &apos;/u01/app/oracle/oradata/orcl/undotbs01.dbf&apos;</div><div class="line">        error=27072 txt: &apos;Linux-x86_64 Error: 5: Input/output error</div><div class="line">Additional information: 4</div><div class="line">Additional information: 224</div><div class="line">Additional information: -1&apos;</div><div class="line">Errors in file /u01/app/oracle/diag/rdbms/orcl/orcl/trace/orcl_dbw1_19450.trc:</div><div class="line">Errors in file /u01/app/oracle/diag/rdbms/orcl/orcl/trace/orcl_dbw1_19450.trc:</div><div class="line">ORA-63999: data file suffered media failure</div><div class="line">ORA-01114: IO error writing block to file 3 (block # 224)</div><div class="line">ORA-01110: data file 3: &apos;/u01/app/oracle/oradata/orcl/undotbs01.dbf&apos;</div><div class="line">ORA-27072: File I/O error</div><div class="line">Linux-x86_64 Error: 5: Input/output error</div><div class="line">Additional information: 4</div><div class="line">Additional information: 224</div><div class="line">Additional information: -1</div><div class="line">DBW1 (ospid: 19450): terminating the instance due to error 63999</div><div class="line">Sun Apr 19 08:00:49 2020</div><div class="line">System state dump requested by (instance=1, osid=19450 (DBW1)), summary=[abnormal instance termination].</div><div class="line">System State dumped to trace file /u01/app/oracle/diag/rdbms/orcl/orcl/trace/orcl_diag_19440_20200419080049.trc</div><div class="line">Dumping diagnostic data in directory=[cdmp_20200419080049], requested by (instance=1, osid=19450 (DBW1)), summary=[abnormal instance termination].</div><div class="line">Instance terminated by DBW1, pid = 19450</div></pre></td></tr></table></figure><p>第一反应是磁盘空间是不是满了，查看了系统空间，/u01分区剩余还很多</p><p><img src="/images/2020/0419/01.png" alt="oracle"></p><p>经查看，这台机器是虚拟机环境，非实体机，可能存在存储超分的情况（分配出去的存储空间大于实际可用的物理空间，倒是物理空间被耗尽后，系统中依然看到存在富裕剩余空间）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@db-23-200 ~]# dmidecode |grep -i prod</div><div class="line">Product Name: Bochs</div></pre></td></tr></table></figure><p>为了进一步验证是否存在超分，删除了一个本地的备份文件，然后启动oracle数据库服务，居然拉起来了。原来这tmd就叫惊喜╰(<em>°▽°</em>)╯</p><p>参考链接：<a href="https://blog.csdn.net/weixin_39133690/article/details/102799091" target="_blank" rel="external">https://blog.csdn.net/weixin_39133690/article/details/102799091</a></p>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Docker|4.Dockerfile编写</title>
      <link href="/arlo/d9e6ac98/"/>
      <url>/arlo/d9e6ac98/</url>
      
        <content type="html"><![CDATA[<p>Dockerfile是用来构建Docker镜像的构建文件，是由一系列命令和参数构成的脚本。</p><h1 id="Dockerfile构建过程解析"><a href="#Dockerfile构建过程解析" class="headerlink" title="Dockerfile构建过程解析"></a>Dockerfile构建过程解析</h1><h2 id="Dockerfile基础知识"><a href="#Dockerfile基础知识" class="headerlink" title="Dockerfile基础知识"></a>Dockerfile基础知识</h2><ul><li>每条保留指令都必须为大写字母且后面要跟随至少一个参数</li><li>指令按照从上到下，顺序执行</li><li>#表示注释</li><li>每条指令都会创建一个新的镜像层，并对镜像进行提交</li></ul><a id="more"></a><h2 id="Docker执行Dockerfile的大概流程"><a href="#Docker执行Dockerfile的大概流程" class="headerlink" title="Docker执行Dockerfile的大概流程"></a>Docker执行Dockerfile的大概流程</h2><ul><li>docker从基础镜像运行一个容器</li><li>执行一条指令并对容器做出修改</li><li>执行类似docker commit的操作提交一个新的镜像层</li><li>docker再基于刚提交的镜像运行一个新容器</li><li>执行dockerfile中的下一条指令直到所有指令都执行完成</li></ul><p>Dockerfile，需要定义一个Dockerfile，Dockerfile定义了进程需要的一切东西。Dockerfile涉及的内容包括执行代码或者是文件、环境变量、依赖包、运行时环境、动态链接库、操作系统的发行版、服务进程和内核进程（当应用进程需要和系统服务和内核进程打交道，这时需要考虑如何设计namespace的权限控制）等等；</p><p>Docker镜像，在用Dockerfile定义一个文件之后，docker build时会产生一个Docker镜像，当运行Docker镜像时，会真正开始提供服务；</p><p>Docker容器，容器是直接提供服务的。</p><h1 id="Dockerfile体系结构"><a href="#Dockerfile体系结构" class="headerlink" title="Dockerfile体系结构"></a>Dockerfile体系结构</h1><table><thead><tr><th>保留字指令</th><th>含义</th></tr></thead><tbody><tr><td>FROM</td><td>基础镜像，当前新镜像是基于哪个镜像的</td></tr><tr><td>MAINTAINER</td><td>镜像维护者的姓名和邮箱地址</td></tr><tr><td>RUN</td><td>容器构建时需要运行的指令</td></tr><tr><td>EXPOSE</td><td>容器对外暴漏的端口</td></tr><tr><td>WORKDIR</td><td>指定在创建容器后，终端默认登录进来的工作目录，一个落脚点</td></tr><tr><td>ENV</td><td>在构建镜像过程中设置环境变量</td></tr><tr><td>ADD</td><td>将宿主机目录下的文件拷贝进镜像且ADD命令会自动处理URL和解压tar压缩包</td></tr><tr><td>COPY</td><td>类似ADD，拷贝文件和目录到镜像中。将从构建上下文目录中的&lt;原路径&gt;的文件/目标复制到新的一层的镜像内的&lt;目标路径&gt;位置</td></tr><tr><td>VOLUME</td><td>容器数据卷，用于数据保存和持久化工作</td></tr><tr><td>CMD</td><td>指定一个容器启动时要运行的命令。Dockfile中可以有多个CMD指令，但只有最后一个生效，CMD会被docker run之后的参数替换（替换）</td></tr><tr><td>ENTRYPOINT</td><td>指定一个容器启动时要运行的命令。ENTRYPOINT的目标和CMD一样，都是在指定容器启动程序及参数（追加）</td></tr><tr><td>ONBUILD</td><td>当构建一个被继承的Dockerfile时运行命令，父镜像在被子镜像继承后父镜像的onbuild被触发。</td></tr></tbody></table><h1 id="编写tomcat-dockerfile"><a href="#编写tomcat-dockerfile" class="headerlink" title="编写tomcat dockerfile"></a>编写tomcat dockerfile</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@localhost tomcat]# pwd</div><div class="line">/root/mydocker/tomcat</div><div class="line">[root@localhost tomcat]# ls -l</div><div class="line">total 199896</div><div class="line">-rw-r--r-- 1 root root   9584807 Jul  6  2018 apache-tomcat-8.5.32.tar.gz</div><div class="line">-rw-r--r-- 1 root root         5 Feb 13 00:15 c.txt</div><div class="line">-rw-r--r-- 1 root root       614 Feb 13 00:21 dockerfile</div><div class="line">-rw-r--r-- 1 root root 195094741 Oct 31 15:00 jdk-8u221-linux-x64.tar.gz</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">[root@localhost tomcat]# cat /root/mydocker/tomcat/dockerfile </div><div class="line">FROM centos</div><div class="line">MAINTAINER arlo&lt;10887272@qq.com&gt;</div><div class="line">WORKDIR /usr/local</div><div class="line">#安装vim,lsof软件</div><div class="line">RUN yum -y install vim lsof</div><div class="line">#拷贝并解压jdk,tomcat</div><div class="line">COPY c.txt /usr/local/ctext.txt</div><div class="line">ADD jdk-8u221-linux-x64.tar.gz /usr/local/</div><div class="line">ADD apache-tomcat-8.5.32.tar.gz /usr/local/</div><div class="line">#配置环境变量</div><div class="line">ENV JAVA_HOME /usr/local/jdk1.8.0_221/</div><div class="line">ENV CLASSPATH .:$JAVA_HOME/lib/:$JAVA_HOME/jre/lib/</div><div class="line">ENV CATALINA_HOME /usr/local/apache-tomcat-8.5.32</div><div class="line">ENV CATALINA_BASE /usr/local/apache-tomcat-8.5.32</div><div class="line">ENV PATH $JAVA_HOME/bin:$PATH</div><div class="line">#暴漏容器服务端口</div><div class="line">EXPOSE 8080</div><div class="line">#启动服务</div><div class="line">CMD [&quot;/usr/local/apache-tomcat-8.5.32/bin/catalina.sh&quot;,&quot;run&quot;]</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div></pre></td><td class="code"><pre><div class="line">[root@localhost tomcat]# docker build -f /root/mydocker/tomcat/dockerfile -t test/tomcat .</div><div class="line">Sending build context to Docker daemon  204.7MB</div><div class="line">Step 1/14 : FROM centos</div><div class="line"> ---&gt; 470671670cac</div><div class="line">Step 2/14 : MAINTAINER arlo&lt;10887272@qq.com&gt;</div><div class="line"> ---&gt; Using cache</div><div class="line"> ---&gt; 9fe35c7393cf</div><div class="line">Step 3/14 : WORKDIR /usr/local</div><div class="line"> ---&gt; Running in 32918030b909</div><div class="line">Removing intermediate container 32918030b909</div><div class="line"> ---&gt; d3d46c9c0512</div><div class="line">Step 4/14 : RUN yum -y install vim lsof</div><div class="line"> ---&gt; Running in 897a79906fc7</div><div class="line">CentOS-8 - AppStream                            251 kB/s | 6.4 MB     00:26    </div><div class="line">CentOS-8 - Base                                 1.3 MB/s | 5.0 MB     00:03    </div><div class="line">CentOS-8 - Extras                               907  B/s | 2.1 kB     00:02    </div><div class="line">Dependencies resolved.</div><div class="line">================================================================================</div><div class="line"> Package             Arch        Version                   Repository      Size</div><div class="line">================================================================================</div><div class="line">Installing:</div><div class="line"> vim-enhanced        x86_64      2:8.0.1763-13.el8         AppStream      1.4 M</div><div class="line"> lsof                x86_64      4.91-2.el8                BaseOS         253 k</div><div class="line">Installing dependencies:</div><div class="line"> gpm-libs            x86_64      1.20.7-15.el8             AppStream       39 k</div><div class="line"> vim-common          x86_64      2:8.0.1763-13.el8         AppStream      6.3 M</div><div class="line"> vim-filesystem      noarch      2:8.0.1763-13.el8         AppStream       48 k</div><div class="line"> which               x86_64      2.21-10.el8               BaseOS          49 k</div><div class="line"></div><div class="line">Transaction Summary</div><div class="line">================================================================================</div><div class="line">Install  6 Packages</div><div class="line"></div><div class="line">Total download size: 8.1 M</div><div class="line">Installed size: 31 M</div><div class="line">Downloading Packages:</div><div class="line">(1/6): gpm-libs-1.20.7-15.el8.x86_64.rpm        212 kB/s |  39 kB     00:00    </div><div class="line">(2/6): vim-filesystem-8.0.1763-13.el8.noarch.rp 961 kB/s |  48 kB     00:00    </div><div class="line">(3/6): lsof-4.91-2.el8.x86_64.rpm               530 kB/s | 253 kB     00:00    </div><div class="line">(4/6): which-2.21-10.el8.x86_64.rpm             918 kB/s |  49 kB     00:00    </div><div class="line">(5/6): vim-common-8.0.1763-13.el8.x86_64.rpm    2.5 MB/s | 6.3 MB     00:02    </div><div class="line">(6/6): vim-enhanced-8.0.1763-13.el8.x86_64.rpm  538 kB/s | 1.4 MB     00:02    </div><div class="line">--------------------------------------------------------------------------------</div><div class="line">Total                                           2.0 MB/s | 8.1 MB     00:03     </div><div class="line">warning: /var/cache/dnf/AppStream-02e86d1c976ab532/packages/gpm-libs-1.20.7-15.el8.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID 8483c65d: NOKEY</div><div class="line">CentOS-8 - AppStream                            1.6 MB/s | 1.6 kB     00:00    </div><div class="line">Importing GPG key 0x8483C65D:</div><div class="line"> Userid     : &quot;CentOS (CentOS Official Signing Key) &lt;security@centos.org&gt;&quot;</div><div class="line"> Fingerprint: 99DB 70FA E1D7 CE22 7FB6 4882 05B5 55B3 8483 C65D</div><div class="line"> From       : /etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</div><div class="line">Key imported successfully</div><div class="line">Running transaction check</div><div class="line">Transaction check succeeded.</div><div class="line">Running transaction test</div><div class="line">Transaction test succeeded.</div><div class="line">Running transaction</div><div class="line">  Preparing        :                                                        1/1 </div><div class="line">  Installing       : which-2.21-10.el8.x86_64                               1/6 </div><div class="line">  Installing       : vim-filesystem-2:8.0.1763-13.el8.noarch                2/6 </div><div class="line">  Installing       : vim-common-2:8.0.1763-13.el8.x86_64                    3/6 </div><div class="line">  Installing       : gpm-libs-1.20.7-15.el8.x86_64                          4/6 </div><div class="line">  Running scriptlet: gpm-libs-1.20.7-15.el8.x86_64                          4/6 </div><div class="line">  Installing       : vim-enhanced-2:8.0.1763-13.el8.x86_64                  5/6 </div><div class="line">  Installing       : lsof-4.91-2.el8.x86_64                                 6/6 </div><div class="line">  Running scriptlet: lsof-4.91-2.el8.x86_64                                 6/6 </div><div class="line">  Running scriptlet: vim-common-2:8.0.1763-13.el8.x86_64                    6/6 </div><div class="line">  Verifying        : gpm-libs-1.20.7-15.el8.x86_64                          1/6 </div><div class="line">  Verifying        : vim-common-2:8.0.1763-13.el8.x86_64                    2/6 </div><div class="line">  Verifying        : vim-enhanced-2:8.0.1763-13.el8.x86_64                  3/6 </div><div class="line">  Verifying        : vim-filesystem-2:8.0.1763-13.el8.noarch                4/6 </div><div class="line">  Verifying        : lsof-4.91-2.el8.x86_64                                 5/6 </div><div class="line">  Verifying        : which-2.21-10.el8.x86_64                               6/6 </div><div class="line"></div><div class="line">Installed:</div><div class="line">  vim-enhanced-2:8.0.1763-13.el8.x86_64    lsof-4.91-2.el8.x86_64              </div><div class="line">  gpm-libs-1.20.7-15.el8.x86_64            vim-common-2:8.0.1763-13.el8.x86_64 </div><div class="line">  vim-filesystem-2:8.0.1763-13.el8.noarch  which-2.21-10.el8.x86_64            </div><div class="line"></div><div class="line">Complete!</div><div class="line">Removing intermediate container 897a79906fc7</div><div class="line"> ---&gt; 13121fca3153</div><div class="line">Step 5/14 : COPY c.txt /usr/local/ctext.txt</div><div class="line"> ---&gt; 295b1db8995d</div><div class="line">Step 6/14 : ADD jdk-8u221-linux-x64.tar.gz /usr/local/</div><div class="line"> ---&gt; 8f55fab3cee8</div><div class="line">Step 7/14 : ADD apache-tomcat-8.5.32.tar.gz /usr/local/</div><div class="line"> ---&gt; 19390cab29cb</div><div class="line">Step 8/14 : ENV JAVA_HOME /usr/local/jdk1.8.0_221/</div><div class="line"> ---&gt; Running in d7db7c594c17</div><div class="line">Removing intermediate container d7db7c594c17</div><div class="line"> ---&gt; 0e316b643b87</div><div class="line">Step 9/14 : ENV CLASSPATH .:$JAVA_HOME/lib/:$JAVA_HOME/jre/lib/</div><div class="line"> ---&gt; Running in fb8be4c72efe</div><div class="line">Removing intermediate container fb8be4c72efe</div><div class="line"> ---&gt; 9b2d22114da9</div><div class="line">Step 10/14 : ENV CATALINA_HOME /usr/local/apache-tomcat-8.5.32</div><div class="line"> ---&gt; Running in 0026d43d76ef</div><div class="line">Removing intermediate container 0026d43d76ef</div><div class="line"> ---&gt; 1780fa4f640e</div><div class="line">Step 11/14 : ENV CATALINA_BASE /usr/local/apache-tomcat-8.5.32</div><div class="line"> ---&gt; Running in 2c843fa05104</div><div class="line">Removing intermediate container 2c843fa05104</div><div class="line"> ---&gt; b3e0da022f22</div><div class="line">Step 12/14 : ENV PATH $JAVA_HOME/bin:$PATH</div><div class="line"> ---&gt; Running in 7366d7cb77a1</div><div class="line">Removing intermediate container 7366d7cb77a1</div><div class="line"> ---&gt; afefbc99ba9c</div><div class="line">Step 13/14 : EXPOSE 8080</div><div class="line"> ---&gt; Running in a65838b19573</div><div class="line">Removing intermediate container a65838b19573</div><div class="line"> ---&gt; cf9fbf0a77e9</div><div class="line">Step 14/14 : CMD [&quot;/usr/local/apache-tomcat-8.5.32/bin/startup.sh&quot;,&quot;run&quot;]</div><div class="line"> ---&gt; Running in 51d8114e1305</div><div class="line">Removing intermediate container 51d8114e1305</div><div class="line"> ---&gt; fd478a528ca4</div><div class="line">Successfully built fd478a528ca4</div><div class="line">Successfully tagged test/tomcat:latest</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">[root@localhost tomcat]# docker images</div><div class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</div><div class="line">test/tomcat         latest              fd478a528ca4        32 seconds ago      721MB</div><div class="line">test/centos2        latest              9c47c178eb61        3 hours ago         314MB</div><div class="line">test/centos         latest              c8ed8caf62e2        17 hours ago        237MB</div><div class="line">tomcat              latest              b56d8850aed5        5 days ago          529MB</div><div class="line">centos              latest              470671670cac        3 weeks ago         237MB</div><div class="line">[root@localhost tomcat]# docker history test/tomcat</div><div class="line">IMAGE               CREATED              CREATED BY                                      SIZE                COMMENT</div><div class="line">fd478a528ca4        42 seconds ago       /bin/sh -c #(nop)  CMD [&quot;/usr/local/apache-t…   0B                  </div><div class="line">cf9fbf0a77e9        46 seconds ago       /bin/sh -c #(nop)  EXPOSE 8080                  0B                  </div><div class="line">afefbc99ba9c        49 seconds ago       /bin/sh -c #(nop)  ENV PATH=/usr/local/jdk1.…   0B                  </div><div class="line">b3e0da022f22        53 seconds ago       /bin/sh -c #(nop)  ENV CATALINA_BASE=/usr/lo…   0B                  </div><div class="line">1780fa4f640e        57 seconds ago       /bin/sh -c #(nop)  ENV CATALINA_HOME=/usr/lo…   0B                  </div><div class="line">9b2d22114da9        About a minute ago   /bin/sh -c #(nop)  ENV CLASSPATH=.:/usr/loca…   0B                  </div><div class="line">0e316b643b87        About a minute ago   /bin/sh -c #(nop)  ENV JAVA_HOME=/usr/local/…   0B                  </div><div class="line">19390cab29cb        About a minute ago   /bin/sh -c #(nop) ADD file:047cf33d1eac02dd1…   13.6MB              </div><div class="line">8f55fab3cee8        About a minute ago   /bin/sh -c #(nop) ADD file:cd29f38ce9a4a50a3…   407MB               </div><div class="line">295b1db8995d        About a minute ago   /bin/sh -c #(nop) COPY file:ba9516c02edf6166…   5B                  </div><div class="line">13121fca3153        About a minute ago   /bin/sh -c yum -y install vim lsof              63.6MB              </div><div class="line">d3d46c9c0512        2 minutes ago        /bin/sh -c #(nop) WORKDIR /usr/local            0B                  </div><div class="line">9fe35c7393cf        3 hours ago          /bin/sh -c #(nop)  MAINTAINER arlo&lt;10887272@…   0B                  </div><div class="line">470671670cac        3 weeks ago          /bin/sh -c #(nop)  CMD [&quot;/bin/bash&quot;]            0B                  </div><div class="line">&lt;missing&gt;           3 weeks ago          /bin/sh -c #(nop)  LABEL org.label-schema.sc…   0B                  </div><div class="line">&lt;missing&gt;           4 weeks ago          /bin/sh -c #(nop) ADD file:aa54047c80ba30064…   237MB</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@localhost tomcat]# docker run -d -p 8888:8080 --name tomcat0212 -v /data/tomcatwar:/usr/local/apache-tomcat-8.5.32/webapps -v /data/tomcatlogs:/usr/local/apache-tomcat-8.5.32/logs --privileged=true test/tomcat</div></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Docker|3.文件、数据共享</title>
      <link href="/arlo/a27711a4/"/>
      <url>/arlo/a27711a4/</url>
      
        <content type="html"><![CDATA[<h1 id="文件拷贝"><a href="#文件拷贝" class="headerlink" title="文件拷贝"></a>文件拷贝</h1><p><strong>docker cp 容器ID:/文件路径/文件名称 本地文件路径</strong></p><p><strong>docker cp 本地文件路径 容器ID:/文件路径/文件名称 </strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#从容器内拷贝文件到本地</div><div class="line">[root@localhost ~]# docker cp cd7a272e8786:/etc/passwd /tmp</div><div class="line">[root@localhost ~]# head -3 /tmp/passwd </div><div class="line">root:x:0:0:root:/root:/bin/bash</div><div class="line">bin:x:1:1:bin:/bin:/sbin/nologin</div><div class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#将本地文件拷贝到容器内</div><div class="line">[root@localhost ~]# echo &quot;123&quot; &gt; file1</div><div class="line">[root@localhost ~]# docker cp file1 cd7a272e8786:/tmp</div><div class="line">[root@localhost ~]# docker exec -it cd7a272e8786 cat /tmp/file1</div><div class="line">123</div></pre></td></tr></table></figure><a id="more"></a><h1 id="数据卷"><a href="#数据卷" class="headerlink" title="数据卷"></a>数据卷</h1><h2 id="v命令实现"><a href="#v命令实现" class="headerlink" title="-v命令实现"></a>-v命令实现</h2><p><strong>docker run -it -v /宿主机的绝对路径目录:/容器内目录 镜像名</strong>    #如果不能写，需要添加–privileged=true</p><p><strong>docker run -it -v /宿主机的绝对路径目录:/容器内目录:ro  镜像名</strong>    #容器内文件只读</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# docker run --name centos0211 -it -v /HostDataVolume:/ContainerDataVolume centos</div><div class="line">[root@cde93366c404 /]# cd /ContainerDataVolume/</div><div class="line">[root@cde93366c404 ContainerDataVolume]# ls</div><div class="line">[root@cde93366c404 ContainerDataVolume]# echo &quot;123&quot; &gt; file1</div><div class="line">[root@cde93366c404 ContainerDataVolume]# exit</div><div class="line">exit</div><div class="line">[root@localhost ~]# cat /HostDataVolume/file1 </div><div class="line">123</div></pre></td></tr></table></figure><h2 id="dockerfile方式数据卷"><a href="#dockerfile方式数据卷" class="headerlink" title="dockerfile方式数据卷"></a>dockerfile方式数据卷</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">vim /root/mydocker/Dockerfile</div><div class="line">#volume test</div><div class="line">FROM centos</div><div class="line">VOLUME [&quot;/DataVolumeContainer1&quot;,&quot;/DataVolumeContainer2&quot;]</div><div class="line">CMD echo &quot;finished, ------success!&quot;</div><div class="line">CMD /bin/bash</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[root@localhost mydocker]# docker build -f /root/mydocker/Dockerfile -t test/centos .</div><div class="line">Sending build context to Docker daemon  2.048kB</div><div class="line">Step 1/4 : FROM centos</div><div class="line"> ---&gt; 470671670cac</div><div class="line">Step 2/4 : VOLUME [&quot;/DataVolumeContainer1&quot;,&quot;/DataVolumeContainer2&quot;]</div><div class="line"> ---&gt; Running in ad5cdf37264a</div><div class="line">Removing intermediate container ad5cdf37264a</div><div class="line"> ---&gt; 3e834cfa3923</div><div class="line">Step 3/4 : CMD echo &quot;finished, ------success!&quot;</div><div class="line"> ---&gt; Running in 033f927a7220</div><div class="line">Removing intermediate container 033f927a7220</div><div class="line"> ---&gt; d1b3cc53d482</div><div class="line">Step 4/4 : CMD /bin/bash</div><div class="line"> ---&gt; Running in 47ebcfb99158</div><div class="line">Removing intermediate container 47ebcfb99158</div><div class="line"> ---&gt; c8ed8caf62e2</div><div class="line">Successfully built c8ed8caf62e2</div><div class="line">Successfully tagged test/centos:latest</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@localhost mydocker]# docker images</div><div class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</div><div class="line">test/centos         latest              c8ed8caf62e2        10 seconds ago      237MB</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@localhost mydocker]# docker run -it test/centos</div><div class="line">[root@7f54ea649e73 /]# ls -l</div><div class="line">total 16</div><div class="line">drwxr-xr-x   2 root root    6 Feb 11 23:18 DataVolumeContainer1</div><div class="line">drwxr-xr-x   2 root root    6 Feb 11 23:18 DataVolumeContainer2</div><div class="line">……</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# docker inspect 7f54ea649e73</div><div class="line">……</div><div class="line">……</div><div class="line">&quot;Mounts&quot;: [</div><div class="line">            &#123;</div><div class="line">                &quot;Type&quot;: &quot;volume&quot;,</div><div class="line">                &quot;Name&quot;: &quot;db383db0ed0f634dca3b88ac7b1b5eb7aaf1eb45aa5e198c1dbb672717cbadc4&quot;,</div><div class="line">                &quot;Source&quot;: &quot;/var/lib/docker/volumes/db383db0ed0f634dca3b88ac7b1b5eb7aaf1eb45aa5e198c1dbb672717cbadc4/_data&quot;,</div><div class="line">                &quot;Destination&quot;: &quot;/DataVolumeContainer1&quot;,</div><div class="line">                &quot;Driver&quot;: &quot;local&quot;,</div><div class="line">                &quot;Mode&quot;: &quot;&quot;,</div><div class="line">                &quot;RW&quot;: true,</div><div class="line">                &quot;Propagation&quot;: &quot;&quot;</div><div class="line">            &#125;,</div><div class="line">            &#123;</div><div class="line">                &quot;Type&quot;: &quot;volume&quot;,</div><div class="line">                &quot;Name&quot;: &quot;ed238e4c4a3bf80274f6bd6dd5d4a1aa00020e081a38d9ae668567d9a9301344&quot;,</div><div class="line">                &quot;Source&quot;: &quot;/var/lib/docker/volumes/ed238e4c4a3bf80274f6bd6dd5d4a1aa00020e081a38d9ae668567d9a9301344/_data&quot;,</div><div class="line">                &quot;Destination&quot;: &quot;/DataVolumeContainer2&quot;,</div><div class="line">                &quot;Driver&quot;: &quot;local&quot;,</div><div class="line">                &quot;Mode&quot;: &quot;&quot;,</div><div class="line">                &quot;RW&quot;: true,</div><div class="line">                &quot;Propagation&quot;: &quot;&quot;</div><div class="line">            &#125;</div><div class="line">……</div><div class="line">……</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@7f54ea649e73 /]# echo &quot;123&quot; &gt; /DataVolumeContainer1/file1</div><div class="line">[root@localhost ~]# cat /var/lib/docker/volumes/db383db0ed0f634dca3b88ac7b1b5eb7aaf1eb45aa5e198c1dbb672717cbadc4/_data/file1 </div><div class="line">123</div></pre></td></tr></table></figure><h1 id="数据卷容器"><a href="#数据卷容器" class="headerlink" title="数据卷容器"></a>数据卷容器</h1><p>命名的容器挂载数据卷，其他容器通过挂载这个（父容器）实现数据共享，挂载数据卷的容器，称之为数据卷容器。</p><h2 id="先启动一个父容器"><a href="#先启动一个父容器" class="headerlink" title="先启动一个父容器"></a>先启动一个父容器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# docker run -it --name dc01 test/centos</div><div class="line"></div><div class="line">[root@fe649066e76e /]# cd DataVolumeContainer1/</div><div class="line"></div><div class="line">[root@fe649066e76e DataVolumeContainer1]# touch add_dc01.txt</div></pre></td></tr></table></figure><h2 id="新建dc02-dc03容器，继承dc01"><a href="#新建dc02-dc03容器，继承dc01" class="headerlink" title="新建dc02/dc03容器，继承dc01"></a>新建dc02/dc03容器，继承dc01</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#新建dc02</div><div class="line"></div><div class="line">[root@localhost ~]# docker run -it --name dc02 --volumes-from dc01 test/centos</div><div class="line"></div><div class="line">[root@c14197144fe7 /]# cd /DataVolumeContainer1/</div><div class="line"></div><div class="line">[root@c14197144fe7 DataVolumeContainer1]# touch add_dc02.txt</div><div class="line"></div><div class="line">#新建dc03</div><div class="line"></div><div class="line">[root@localhost ~]# docker run -it --name dc03 --volumes-from dc01 test/centos</div><div class="line"></div><div class="line">[root@c409dacf9084 /]# cd /DataVolumeContainer1/</div><div class="line"></div><div class="line">[root@c409dacf9084 DataVolumeContainer1]# touch add_dc03.txt</div></pre></td></tr></table></figure><h2 id="在dc01上查看数据"><a href="#在dc01上查看数据" class="headerlink" title="在dc01上查看数据"></a>在dc01上查看数据</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# docker ps</div><div class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</div><div class="line">c409dacf9084        test/centos         &quot;/bin/sh -c /bin/bash&quot;   4 minutes ago       Up 4 minutes                            dc03</div><div class="line">c14197144fe7        test/centos         &quot;/bin/sh -c /bin/bash&quot;   4 minutes ago       Up 4 minutes                            dc02</div><div class="line">fe649066e76e        test/centos         &quot;/bin/sh -c /bin/bash&quot;   9 minutes ago       Up 9 minutes                            dc01</div><div class="line">[root@localhost ~]# docker attach fe649066e76e</div><div class="line">[root@fe649066e76e DataVolumeContainer1]# ls -l</div><div class="line">total 0</div><div class="line">-rw-r--r-- 1 root root 0 Feb 12 00:02 add_dc01.txt</div><div class="line">-rw-r--r-- 1 root root 0 Feb 12 00:09 add_dc02.txt</div><div class="line">-rw-r--r-- 1 root root 0 Feb 12 00:10 add_dc03.txt</div></pre></td></tr></table></figure><h2 id="删除dc01-在dc02上添加数据，在dc03上查看"><a href="#删除dc01-在dc02上添加数据，在dc03上查看" class="headerlink" title="删除dc01,在dc02上添加数据，在dc03上查看"></a>删除dc01,在dc02上添加数据，在dc03上查看</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# docker ps</div><div class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</div><div class="line">c409dacf9084        test/centos         &quot;/bin/sh -c /bin/bash&quot;   5 minutes ago       Up 5 minutes                            dc03</div><div class="line">c14197144fe7        test/centos         &quot;/bin/sh -c /bin/bash&quot;   5 minutes ago       Up 5 minutes                            dc02</div><div class="line">fe649066e76e        test/centos         &quot;/bin/sh -c /bin/bash&quot;   10 minutes ago      Up 10 minutes                           dc01</div><div class="line">[root@localhost ~]# docker rm -f fe649066e76e</div><div class="line">fe649066e76e</div><div class="line">[root@localhost ~]# docker attach c14197144fe7</div><div class="line">[root@c14197144fe7 DataVolumeContainer1]# ls -l</div><div class="line">total 0</div><div class="line">-rw-r--r-- 1 root root 0 Feb 12 00:02 add_dc01.txt</div><div class="line">-rw-r--r-- 1 root root 0 Feb 12 00:09 add_dc02.txt</div><div class="line">-rw-r--r-- 1 root root 0 Feb 12 00:10 add_dc03.txt</div><div class="line">[root@c14197144fe7 DataVolumeContainer1]# touch update_dc02.txt</div><div class="line"></div><div class="line">[root@localhost ~]# docker attach dc03</div><div class="line">[root@c409dacf9084 DataVolumeContainer1]# ls -l</div><div class="line">total 0</div><div class="line">-rw-r--r-- 1 root root 0 Feb 12 00:02 add_dc01.txt</div><div class="line">-rw-r--r-- 1 root root 0 Feb 12 00:09 add_dc02.txt</div><div class="line">-rw-r--r-- 1 root root 0 Feb 12 00:10 add_dc03.txt</div><div class="line">-rw-r--r-- 1 root root 0 Feb 12 00:13 update_dc02.txt</div></pre></td></tr></table></figure><h2 id="删除dc02，测试dc03数据是否可以访问"><a href="#删除dc02，测试dc03数据是否可以访问" class="headerlink" title="删除dc02，测试dc03数据是否可以访问"></a>删除dc02，测试dc03数据是否可以访问</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# docker rm -f dc02</div><div class="line">dc02</div><div class="line">[root@localhost ~]# docker ps</div><div class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</div><div class="line">c409dacf9084        test/centos         &quot;/bin/sh -c /bin/bash&quot;   10 minutes ago      Up 10 minutes                           dc03</div><div class="line">[root@localhost ~]# docker attach dc03</div><div class="line">[root@c409dacf9084 DataVolumeContainer1]# ls -l</div><div class="line">total 0</div><div class="line">-rw-r--r-- 1 root root 0 Feb 12 00:02 add_dc01.txt</div><div class="line">-rw-r--r-- 1 root root 0 Feb 12 00:09 add_dc02.txt</div><div class="line">-rw-r--r-- 1 root root 0 Feb 12 00:10 add_dc03.txt</div><div class="line">-rw-r--r-- 1 root root 0 Feb 12 00:13 update_dc02.txt</div></pre></td></tr></table></figure><h2 id="新建dc04继承dc03，然后删除dc03"><a href="#新建dc04继承dc03，然后删除dc03" class="headerlink" title="新建dc04继承dc03，然后删除dc03"></a>新建dc04继承dc03，然后删除dc03</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# docker run -it --name dc04 --volumes-from dc03 test/centos</div><div class="line">[root@localhost ~]# docker rm -f dc03</div><div class="line">dc03</div><div class="line">[root@localhost ~]# docker ps </div><div class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</div><div class="line">5156e4538e53        test/centos         &quot;/bin/sh -c /bin/bash&quot;   59 seconds ago      Up 58 seconds                           dc04</div><div class="line">[root@localhost ~]# docker attach dc04</div><div class="line">[root@5156e4538e53 DataVolumeContainer1]# cd /DataVolumeContainer1/</div><div class="line">[root@5156e4538e53 DataVolumeContainer1]# ls -l</div><div class="line">total 0</div><div class="line">-rw-r--r-- 1 root root 0 Feb 12 00:02 add_dc01.txt</div><div class="line">-rw-r--r-- 1 root root 0 Feb 12 00:09 add_dc02.txt</div><div class="line">-rw-r--r-- 1 root root 0 Feb 12 00:10 add_dc03.txt</div><div class="line">-rw-r--r-- 1 root root 0 Feb 12 00:13 update_dc02.txt</div></pre></td></tr></table></figure><p><strong>结论：容器之间配置信息的传递，数据卷的生命周期一直持续到没有容器使用它为止</strong></p>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Docker|2.常用操作命令</title>
      <link href="/arlo/4846dd1c/"/>
      <url>/arlo/4846dd1c/</url>
      
        <content type="html"><![CDATA[<h1 id="查看版本信息"><a href="#查看版本信息" class="headerlink" title="查看版本信息"></a>查看版本信息</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">docker version</div><div class="line"></div><div class="line">docker info</div></pre></td></tr></table></figure><h1 id="获取帮助"><a href="#获取帮助" class="headerlink" title="获取帮助"></a>获取帮助</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker --help</div></pre></td></tr></table></figure><a id="more"></a><h1 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h1><h2 id="列出本地镜像docker-images"><a href="#列出本地镜像docker-images" class="headerlink" title="列出本地镜像docker images"></a>列出本地镜像docker images</h2><p>-a:    列出本地所有镜像（包含中间层镜像）</p><p>-q：只显示镜像ID</p><p>–digests: 显示镜像的摘要信息</p><p>–no-trunc: 显示完整的镜像信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# docker images</div><div class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</div><div class="line">tomcat              latest              b56d8850aed5        4 days ago          529MB</div><div class="line">centos              latest              470671670cac        3 weeks ago         237MB</div><div class="line">hello-world         latest              fce289e99eb9        13 months ago       1.84kB</div><div class="line"></div><div class="line">REPOSITORY: 镜像仓库源</div><div class="line">TAG：镜像标签</div><div class="line">IMAGE ID ：镜像ID</div><div class="line">CREATED：镜像创建时间</div><div class="line">SIZE: 镜像大小</div><div class="line">同一仓库源可以有多个TAG，代表这个仓库源的不同个版本，我们使用REPOSITORY:TAG来定义不同的镜像。</div><div class="line">如果不指定一个镜像的标签版本，docker将默认使用REPOSITORY:lastest镜像</div></pre></td></tr></table></figure><h2 id="查找镜像docker-search"><a href="#查找镜像docker-search" class="headerlink" title="查找镜像docker search"></a>查找镜像docker search</h2><p>虽然本地已经修改为阿里云加速镜像站，但是查询还是从<a href="https://hub.docker.com/上查找镜像。" target="_blank" rel="external">https://hub.docker.com/上查找镜像。</a></p><p>–no-trunc: 显示完整的镜像描述</p><p>-s: 列出收藏数不小于指定的镜像</p><p>–automated: 只列出automated build类型的镜像</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# docker search tomcat -s 50</div><div class="line">Flag --stars has been deprecated, use --filter=stars=3 instead</div><div class="line">NAME                DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED</div><div class="line">tomcat              Apache Tomcat is an open source implementati…   2637                [OK]                </div><div class="line">tomee               Apache TomEE is an all-Apache Java EE certif…   74                  [OK]                </div><div class="line">dordoka/tomcat      Ubuntu 14.04, Oracle JDK 8 and Tomcat 8 base…   53                                      [OK]</div><div class="line">                                    </div><div class="line">NAME：镜像名称</div><div class="line">DESCRIPTION：镜像描述</div><div class="line">STARS：点赞数</div><div class="line">OFFICIAL：官方镜像</div><div class="line">AUTOMATED：自动更新</div></pre></td></tr></table></figure><h2 id="拉取镜像dockerpull"><a href="#拉取镜像dockerpull" class="headerlink" title="拉取镜像dockerpull"></a>拉取镜像dockerpull</h2><p>下载镜像 <strong>docker pull 镜像名称[:TAG]</strong>，如果不指定TAG，默认为lastest</p><h2 id="删除镜像docker-rmi"><a href="#删除镜像docker-rmi" class="headerlink" title="删除镜像docker rmi"></a>删除镜像docker rmi</h2><p>删除镜像：    docker rmi  镜像名称/镜像ID</p><p>删除单个镜像：    docker rmi -f 镜像名称/镜像ID</p><p>删除多个镜像：    docker rmi -f 镜像名称1:TAG/镜像ID1[空格]镜像名称2:TAG/镜像ID2</p><p>删除全部镜像：    docker rmi -f $(docker images -qa)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">删除镜像</div><div class="line">[root@localhost ~]# docker rmi hello-world</div><div class="line">Error response from daemon: conflict: unable to remove repository reference &quot;hello-world&quot; (must force) - container c0c56d69276d is using its referenced image fce289e99eb9</div><div class="line">强行删除镜像</div><div class="line">[root@localhost ~]# docker rmi -f fce289e99eb9</div><div class="line">Untagged: hello-world:latest</div><div class="line">Untagged: hello-world@sha256:9572f7cdcee8591948c2963463447a53466950b3fc15a247fcad1917ca215a2f</div><div class="line">Deleted: sha256:fce289e99eb9bca977dae136fbe2a82b6b7d4c372474c9235adc1741675f587e</div><div class="line">删除多个镜像</div><div class="line">[root@localhost ~]# docker rmi -f hello-world nginx</div><div class="line">Untagged: hello-world:latest</div><div class="line">Untagged: hello-world@sha256:9572f7cdcee8591948c2963463447a53466950b3fc15a247fcad1917ca215a2f</div><div class="line">Deleted: sha256:fce289e99eb9bca977dae136fbe2a82b6b7d4c372474c9235adc1741675f587e</div><div class="line">Untagged: nginx:latest</div><div class="line">Untagged: nginx@sha256:ad5552c786f128e389a0263104ae39f3d3c7895579d45ae716f528185b36bc6f</div><div class="line">Deleted: sha256:2073e0bcb60ee98548d313ead5eacbfe16d9054f8800a32bedd859922a99a6e1</div><div class="line">Deleted: sha256:a3136fbf38691346715cac8360bcdfca0fff812cede416469653670f04e2cab0</div><div class="line">Deleted: sha256:99360ffcb2da18fd9ede194efaf5d4b90e7aee99f45737e918113e6833dcf278</div><div class="line">Deleted: sha256:488dfecc21b1bc607e09368d2791cb784cf8c4ec5c05d2952b045b3e0f8cc01e</div></pre></td></tr></table></figure><h1 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h1><h2 id="新建并启动容器"><a href="#新建并启动容器" class="headerlink" title="新建并启动容器"></a>新建并启动容器</h2><p>启动容器必须有一个镜像，如果本地有镜像就从本地启动，如果本地没有则先去镜像站点拉取镜像然后启动，并保存镜像到本地；</p><p><strong>docker run 镜像名称</strong>   </p><p>–name=”容器新名字”：为容器指定一个名称；</p><p>-d：后台运行容器，并返回容器ID，即启动守护式容器；</p><p>-i：已交互模式运行容器，通常与-t同时使用；</p><p>-t：为容器重新分配一个伪输入终端，通常与-i同时使用；</p><p>-P：随机端口映射；</p><p>-p：指定端口映射，有以下四种格式       ip:hostPort:containerPort  /        ip::containerPort  /        hostPort:containerPort /        containerPort</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# docker images</div><div class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</div><div class="line">tomcat              latest              b56d8850aed5        4 days ago          529MB</div><div class="line">centos              latest              470671670cac        3 weeks ago         237MB</div><div class="line"># 启动交互式容器</div><div class="line">[root@localhost ~]# docker run -it --name centos20200211 470671670cac</div><div class="line">[root@8ec89289309a /]# pwd</div><div class="line">/</div><div class="line">[root@8ec89289309a /]# ls</div><div class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</div><div class="line">[root@8ec89289309a /]#</div><div class="line"># 启动守护式容器</div><div class="line">docker run -d </div><div class="line"># 启动一个mysql容器</div><div class="line">docker run -p 3306:3306 --name db1 -v /data/mysql/conf:/etc/mysql/conf.d -v /data/mysql/logs:/logs -v /data/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=111 -d mysql:5.7.29</div></pre></td></tr></table></figure><h2 id="列出的容器"><a href="#列出的容器" class="headerlink" title="列出的容器"></a>列出的容器</h2><p>docker ps</p><p>-a： 列出所有的容器，包含已经停止的容器</p><p>-l： 显示最新创建的容器</p><p>-n： 显示最近n次创建的容器</p><p>-q： 静默模式，只显示容器编号</p><p>–no-trunc ：不截断输出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# docker ps</div><div class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</div><div class="line">8ec89289309a        470671670cac        &quot;/bin/bash&quot;         3 minutes ago       Up 3 minutes                            centos20200211</div><div class="line">8a5da2a84c74        centos              &quot;/bin/bash&quot;         3 hours ago         Up 3 hours                              centos0211</div></pre></td></tr></table></figure><h2 id="退出容器"><a href="#退出容器" class="headerlink" title="退出容器"></a>退出容器</h2><ul><li><p>exit             容器停止退出</p></li><li><p>Ctrl+P+Q    容器不停止退出</p></li></ul><p>开两个终端做个操作</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# docker ps </div><div class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</div><div class="line">8ec89289309a        470671670cac        &quot;/bin/bash&quot;         6 minutes ago       Up 6 minutes                            centos20200211</div><div class="line">8a5da2a84c74        centos              &quot;/bin/bash&quot;         3 hours ago         Up 3 hours                              centos0211</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@8ec89289309a /]# exit</div><div class="line">exit</div><div class="line">[root@localhost ~]#</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# docker ps </div><div class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</div><div class="line">8a5da2a84c74        centos              &quot;/bin/bash&quot;         3 hours ago         Up 3 hours                              centos0211</div></pre></td></tr></table></figure><h2 id="启动容器"><a href="#启动容器" class="headerlink" title="启动容器"></a>启动容器</h2><p><strong>docker start 容器id/容器名称</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# docker ps -a</div><div class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                        PORTS               NAMES</div><div class="line">ba4a8278426e        470671670cac        &quot;/bin/bash&quot;         12 minutes ago      Up 12 minutes                                     centos20200211</div><div class="line">f34465900de2        centos              &quot;/bin/bash&quot;         28 minutes ago      Exited (127) 27 minutes ago                       stoic_ride</div><div class="line">8a5da2a84c74        centos              &quot;/bin/bash&quot;         3 hours ago         Up 3 hours                                        centos0211</div><div class="line">899f21d7be4f        470671670cac        &quot;/bin/bash&quot;         4 hours ago         Exited (0) 3 hours ago                            dazzling_hypatia</div><div class="line">8821a07e9822        470671670cac        &quot;/bin/bash&quot;         4 hours ago         Exited (130) 4 hours ago                          infallible_jones</div><div class="line">c0c56d69276d        fce289e99eb9        &quot;/hello&quot;            31 hours ago        Exited (0) 31 hours ago                           interesting_dirac</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# docker start 899f21d7be4f</div><div class="line">899f21d7be4f</div><div class="line">[root@localhost ~]# docker ps</div><div class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</div><div class="line">ba4a8278426e        470671670cac        &quot;/bin/bash&quot;         12 minutes ago      Up 12 minutes                           centos20200211</div><div class="line">8a5da2a84c74        centos              &quot;/bin/bash&quot;         3 hours ago         Up 3 hours                              centos0211</div><div class="line">899f21d7be4f        470671670cac        &quot;/bin/bash&quot;         4 hours ago         Up 5 seconds                            dazzling_hypatia</div></pre></td></tr></table></figure><h2 id="重启容器"><a href="#重启容器" class="headerlink" title="重启容器"></a>重启容器</h2><p><strong>docker restart 容器id/容器名称</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# docker restart 899f21d7be4f</div><div class="line">899f21d7be4f</div><div class="line">[root@localhost ~]# docker ps</div><div class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</div><div class="line">ba4a8278426e        470671670cac        &quot;/bin/bash&quot;         14 minutes ago      Up 14 minutes                           centos20200211</div><div class="line">8a5da2a84c74        centos              &quot;/bin/bash&quot;         4 hours ago         Up 4 hours                              centos0211</div><div class="line">899f21d7be4f        470671670cac        &quot;/bin/bash&quot;         4 hours ago         Up 1 second                             dazzling_hypatia</div></pre></td></tr></table></figure><h2 id="停止容器"><a href="#停止容器" class="headerlink" title="停止容器"></a>停止容器</h2><p><strong>docker stop 容器id/容器名称</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# docker ps</div><div class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</div><div class="line">ba4a8278426e        470671670cac        &quot;/bin/bash&quot;         16 minutes ago      Up 16 minutes                           centos20200211</div><div class="line">8a5da2a84c74        centos              &quot;/bin/bash&quot;         4 hours ago         Up 4 hours                              centos0211</div><div class="line">899f21d7be4f        470671670cac        &quot;/bin/bash&quot;         4 hours ago         Up About a minute                       dazzling_hypatia</div><div class="line">[root@localhost ~]# docker stop 899f21d7be4f</div><div class="line">899f21d7be4f</div><div class="line">[root@localhost ~]# docker ps</div><div class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</div><div class="line">ba4a8278426e        470671670cac        &quot;/bin/bash&quot;         16 minutes ago      Up 16 minutes                           centos20200211</div><div class="line">8a5da2a84c74        centos              &quot;/bin/bash&quot;         4 hours ago         Up 4 hours                              centos0211</div></pre></td></tr></table></figure><h2 id="强行停止容器"><a href="#强行停止容器" class="headerlink" title="强行停止容器"></a>强行停止容器</h2><p><strong>docker kill 容器id/容器名称</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# docker ps</div><div class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</div><div class="line">ba4a8278426e        470671670cac        &quot;/bin/bash&quot;         16 minutes ago      Up 16 minutes                           centos20200211</div><div class="line">8a5da2a84c74        centos              &quot;/bin/bash&quot;         4 hours ago         Up 4 hours                              centos0211</div><div class="line">[root@localhost ~]# docker kill 8a5da2a84c74</div><div class="line">8a5da2a84c74</div><div class="line">[root@localhost ~]# docker ps</div><div class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</div><div class="line">ba4a8278426e        470671670cac        &quot;/bin/bash&quot;         18 minutes ago      Up 18 minutes                           centos20200211</div></pre></td></tr></table></figure><h2 id="删除容器"><a href="#删除容器" class="headerlink" title="删除容器"></a>删除容器</h2><p>删除已经停止的单个容器     <strong>docker rm 容器id/容器名称</strong></p><p>删除正在运行的单个容器     <strong>docker rm  -f 容器id/容器名称</strong></p><p>一次性删除多个容器             <strong>docker rm -f $(docker ps -a -q)    /    docker ps -a -q |xargs docker rm </strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# docker ps -a</div><div class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</div><div class="line">ba4a8278426e        470671670cac        &quot;/bin/bash&quot;         43 minutes ago      Up 43 minutes                           centos20200211</div><div class="line"># 不加-f，只会删除已经停止退出的容器</div><div class="line">[root@localhost ~]# docker rm -f $(docker ps -a -q)</div><div class="line">ba4a8278426e</div><div class="line">[root@localhost ~]# docker ps -a</div><div class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</div></pre></td></tr></table></figure><h2 id="查看容器日志"><a href="#查看容器日志" class="headerlink" title="查看容器日志"></a>查看容器日志</h2><p><strong>docker logs  容器id</strong></p><p>-t 加入时间戳</p><p>-t 跟随最新的日志打印</p><p>–tail 数字显示最后的多少条</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# docker logs -t -f --tail 20  4f30ee04eac7</div><div class="line">2020-02-11T17:00:51.830836896Z bash: ll: command not found</div><div class="line">2020-02-11T17:01:56.146309331Z [root@4f30ee04eac7 /]# ss</div><div class="line">2020-02-11T17:01:56.279428980Z Netid     State      Recv-Q      Send-Q             Local Address:Port             Peer Address:Port      </div><div class="line">2020-02-11T17:02:08.128296224Z [root@4f30ee04eac7 /]# ps</div><div class="line">2020-02-11T17:02:08.134374708Z bash: $&apos;\345\271ps&apos;: command not found</div><div class="line">2020-02-11T17:02:13.669104746Z [root@4f30ee04eac7 /]ps -ef</div><div class="line">2020-02-11T17:02:13.685931632Z UID        PID  PPID  C STIME TTY          TIME CMD</div><div class="line">2020-02-11T17:02:13.687150066Z root         1     0  0 16:59 pts/0    00:00:00 /bin/bash</div><div class="line">2020-02-11T17:02:13.687185878Z root        18     1  0 17:02 pts/0    00:00:00 ps -ef</div><div class="line">[root@4f30ee04eac7 /]# </div><div class="line">[root@4f30ee04eac7 /]# ps -ef</div><div class="line">2020-02-11T17:05:14.601317299Z UID        PID  PPID  C STIME TTY          TIME CMD</div><div class="line">2020-02-11T17:05:14.601362985Z root         1     0  0 16:59 pts/0    00:00:00 /bin/bash</div><div class="line">2020-02-11T17:05:14.601375403Z root        19     1  0 17:05 pts/0    00:00:00 ps -ef</div><div class="line">2020-02-11T17:05:15.511402720Z [root@4f30ee04eac7 /]# pwd</div><div class="line">2020-02-11T17:05:15.511432928Z /</div><div class="line">2020-02-11T17:05:16.155997418Z [root@4f30ee04eac7 /]# ls</div><div class="line">2020-02-11T17:05:16.160923769Z bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</div><div class="line">2020-02-11T17:05:18.225781961Z [root@4f30ee04eac7 /]# cd </div><div class="line">2020-02-11T17:05:20.175387626Z [root@4f30ee04eac7 ~]# id</div><div class="line">2020-02-11T17:05:20.180529056Z uid=0(root) gid=0(root) groups=0(root)</div></pre></td></tr></table></figure><h2 id="查看容器内进程"><a href="#查看容器内进程" class="headerlink" title="查看容器内进程"></a>查看容器内进程</h2><p><strong>docker top 容器id</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# docker top 4f30ee04eac7</div><div class="line">UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD</div><div class="line">root                4648                4631                0                   00:59               pts/0               00:00:00            /bin/bash</div></pre></td></tr></table></figure><h2 id="进入容器"><a href="#进入容器" class="headerlink" title="进入容器"></a>进入容器</h2><p><strong>docker exec -it 容器ID bashshell</strong></p><p><strong>docker attach 容器ID</strong></p><p>attach 直接进入容器启动命令的终端，不会启动新的进程</p><p>exec 是在容器中打开新的终端，并且可以启动新的进程</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# docker run -it centos</div><div class="line">[root@cd7a272e8786 /]# </div><div class="line"># 按Ctrl+P+Q退出容器</div><div class="line">[root@localhost ~]# </div><div class="line">[root@localhost ~]# docker ps</div><div class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</div><div class="line">cd7a272e8786        centos              &quot;/bin/bash&quot;         12 seconds ago      Up 11 seconds                           heuristic_perlman</div><div class="line">[root@localhost ~]# docker attach cd7a272e8786</div><div class="line">[root@cd7a272e8786 /]#</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# docker exec -it -t cd7a272e8786 ls -l /tmp</div><div class="line">total 8</div><div class="line">-rwx------ 1 root root  671 Jan 13 21:49 ks-script-_srt3u3c</div><div class="line">-rwx------ 1 root root 1379 Jan 13 21:49 ks-script-gpqu_kuo</div></pre></td></tr></table></figure><h2 id="查看容器内部细节"><a href="#查看容器内部细节" class="headerlink" title="查看容器内部细节"></a>查看容器内部细节</h2><p><strong>docker inspect 容器id</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# docker inspect 4f30ee04eac7</div><div class="line">[</div><div class="line">    &#123;</div><div class="line">        &quot;Id&quot;: &quot;4f30ee04eac790df1edc4d1ae87df1096cb4aac78f8b5a741602068f5a3ad1ba&quot;,</div><div class="line">        &quot;Created&quot;: &quot;2020-02-11T16:59:07.103035515Z&quot;,</div><div class="line">        &quot;Path&quot;: &quot;/bin/bash&quot;,</div><div class="line">        &quot;Args&quot;: [],</div><div class="line">        &quot;State&quot;: &#123;</div><div class="line">            &quot;Status&quot;: &quot;running&quot;,</div><div class="line">            &quot;Running&quot;: true,</div><div class="line">            &quot;Paused&quot;: false,</div><div class="line">            &quot;Restarting&quot;: false,</div><div class="line">            &quot;OOMKilled&quot;: false,</div><div class="line">            &quot;Dead&quot;: false,</div><div class="line">            &quot;Pid&quot;: 4648,</div><div class="line">            &quot;ExitCode&quot;: 0,</div><div class="line">            &quot;Error&quot;: &quot;&quot;,</div><div class="line">            &quot;StartedAt&quot;: &quot;2020-02-11T16:59:07.625242514Z&quot;,</div><div class="line">            &quot;FinishedAt&quot;: &quot;0001-01-01T00:00:00Z&quot;</div><div class="line">        &#125;,</div><div class="line">        &quot;Image&quot;: &quot;sha256:470671670cac686c7cf0081e0b37da2e9f4f768ddc5f6a26102ccd1c6954c1ee&quot;,</div><div class="line">        &quot;ResolvConfPath&quot;: &quot;/var/lib/docker/containers/4f30ee04eac790df1edc4d1ae87df1096cb4aac78f8b5a741602068f5a3ad1ba/resolv.conf&quot;,</div><div class="line">        &quot;HostnamePath&quot;: &quot;/var/lib/docker/containers/4f30ee04eac790df1edc4d1ae87df1096cb4aac78f8b5a741602068f5a3ad1ba/hostname&quot;,</div><div class="line">        &quot;HostsPath&quot;: &quot;/var/lib/docker/containers/4f30ee04eac790df1edc4d1ae87df1096cb4aac78f8b5a741602068f5a3ad1ba/hosts&quot;,</div><div class="line">        &quot;LogPath&quot;: &quot;/var/lib/docker/containers/4f30ee04eac790df1edc4d1ae87df1096cb4aac78f8b5a741602068f5a3ad1ba/4f30ee04eac790df1edc4d1ae87df1096cb4aac78f8b5a741602068f5a3ad1ba-json.log&quot;,</div><div class="line">        &quot;Name&quot;: &quot;/centos20200211&quot;,</div><div class="line">        &quot;RestartCount&quot;: 0,</div><div class="line">        &quot;Driver&quot;: &quot;devicemapper&quot;,</div><div class="line">        &quot;Platform&quot;: &quot;linux&quot;,</div><div class="line">        &quot;MountLabel&quot;: &quot;&quot;,</div><div class="line">        &quot;ProcessLabel&quot;: &quot;&quot;,</div><div class="line">        &quot;AppArmorProfile&quot;: &quot;&quot;,</div><div class="line">        &quot;ExecIDs&quot;: null,</div><div class="line">        &quot;HostConfig&quot;: &#123;</div><div class="line">            &quot;Binds&quot;: null,</div><div class="line">            &quot;ContainerIDFile&quot;: &quot;&quot;,</div><div class="line">            &quot;LogConfig&quot;: &#123;</div><div class="line">                &quot;Type&quot;: &quot;json-file&quot;,</div><div class="line">                &quot;Config&quot;: &#123;&#125;</div><div class="line">            &#125;,</div><div class="line">            &quot;NetworkMode&quot;: &quot;default&quot;,</div><div class="line">            &quot;PortBindings&quot;: &#123;&#125;,</div><div class="line">            &quot;RestartPolicy&quot;: &#123;</div><div class="line">                &quot;Name&quot;: &quot;no&quot;,</div><div class="line">                &quot;MaximumRetryCount&quot;: 0</div><div class="line">            &#125;,</div><div class="line">            &quot;AutoRemove&quot;: false,</div><div class="line">            &quot;VolumeDriver&quot;: &quot;&quot;,</div><div class="line">            &quot;VolumesFrom&quot;: null,</div><div class="line">            &quot;CapAdd&quot;: null,</div><div class="line">            &quot;CapDrop&quot;: null,</div><div class="line">            &quot;Capabilities&quot;: null,</div><div class="line">            &quot;Dns&quot;: [],</div><div class="line">            &quot;DnsOptions&quot;: [],</div><div class="line">            &quot;DnsSearch&quot;: [],</div><div class="line">            &quot;ExtraHosts&quot;: null,</div><div class="line">            &quot;GroupAdd&quot;: null,</div><div class="line">            &quot;IpcMode&quot;: &quot;private&quot;,</div><div class="line">            &quot;Cgroup&quot;: &quot;&quot;,</div><div class="line">            &quot;Links&quot;: null,</div><div class="line">            &quot;OomScoreAdj&quot;: 0,</div><div class="line">            &quot;PidMode&quot;: &quot;&quot;,</div><div class="line">            &quot;Privileged&quot;: false,</div><div class="line">            &quot;PublishAllPorts&quot;: false,</div><div class="line">            &quot;ReadonlyRootfs&quot;: false,</div><div class="line">            &quot;SecurityOpt&quot;: null,</div><div class="line">            &quot;UTSMode&quot;: &quot;&quot;,</div><div class="line">            &quot;UsernsMode&quot;: &quot;&quot;,</div><div class="line">            &quot;ShmSize&quot;: 67108864,</div><div class="line">            &quot;Runtime&quot;: &quot;runc&quot;,</div><div class="line">            &quot;ConsoleSize&quot;: [</div><div class="line">                0,</div><div class="line">                0</div><div class="line">            ],</div><div class="line">            &quot;Isolation&quot;: &quot;&quot;,</div><div class="line">            &quot;CpuShares&quot;: 0,</div><div class="line">            &quot;Memory&quot;: 0,</div><div class="line">            &quot;NanoCpus&quot;: 0,</div><div class="line">            &quot;CgroupParent&quot;: &quot;&quot;,</div><div class="line">            &quot;BlkioWeight&quot;: 0,</div><div class="line">            &quot;BlkioWeightDevice&quot;: [],</div><div class="line">            &quot;BlkioDeviceReadBps&quot;: null,</div><div class="line">            &quot;BlkioDeviceWriteBps&quot;: null,</div><div class="line">            &quot;BlkioDeviceReadIOps&quot;: null,</div><div class="line">            &quot;BlkioDeviceWriteIOps&quot;: null,</div><div class="line">            &quot;CpuPeriod&quot;: 0,</div><div class="line">            &quot;CpuQuota&quot;: 0,</div><div class="line">            &quot;CpuRealtimePeriod&quot;: 0,</div><div class="line">            &quot;CpuRealtimeRuntime&quot;: 0,</div><div class="line">            &quot;CpusetCpus&quot;: &quot;&quot;,</div><div class="line">            &quot;CpusetMems&quot;: &quot;&quot;,</div><div class="line">            &quot;Devices&quot;: [],</div><div class="line">            &quot;DeviceCgroupRules&quot;: null,</div><div class="line">            &quot;DeviceRequests&quot;: null,</div><div class="line">            &quot;KernelMemory&quot;: 0,</div><div class="line">            &quot;KernelMemoryTCP&quot;: 0,</div><div class="line">            &quot;MemoryReservation&quot;: 0,</div><div class="line">            &quot;MemorySwap&quot;: 0,</div><div class="line">            &quot;MemorySwappiness&quot;: null,</div><div class="line">            &quot;OomKillDisable&quot;: false,</div><div class="line">            &quot;PidsLimit&quot;: null,</div><div class="line">            &quot;Ulimits&quot;: null,</div><div class="line">            &quot;CpuCount&quot;: 0,</div><div class="line">            &quot;CpuPercent&quot;: 0,</div><div class="line">            &quot;IOMaximumIOps&quot;: 0,</div><div class="line">            &quot;IOMaximumBandwidth&quot;: 0,</div><div class="line">            &quot;MaskedPaths&quot;: [</div><div class="line">                &quot;/proc/asound&quot;,</div><div class="line">                &quot;/proc/acpi&quot;,</div><div class="line">                &quot;/proc/kcore&quot;,</div><div class="line">                &quot;/proc/keys&quot;,</div><div class="line">                &quot;/proc/latency_stats&quot;,</div><div class="line">                &quot;/proc/timer_list&quot;,</div><div class="line">                &quot;/proc/timer_stats&quot;,</div><div class="line">                &quot;/proc/sched_debug&quot;,</div><div class="line">                &quot;/proc/scsi&quot;,</div><div class="line">                &quot;/sys/firmware&quot;</div><div class="line">            ],</div><div class="line">            &quot;ReadonlyPaths&quot;: [</div><div class="line">                &quot;/proc/bus&quot;,</div><div class="line">                &quot;/proc/fs&quot;,</div><div class="line">                &quot;/proc/irq&quot;,</div><div class="line">                &quot;/proc/sys&quot;,</div><div class="line">                &quot;/proc/sysrq-trigger&quot;</div><div class="line">            ]</div><div class="line">        &#125;,</div><div class="line">        &quot;GraphDriver&quot;: &#123;</div><div class="line">            &quot;Data&quot;: &#123;</div><div class="line">                &quot;DeviceId&quot;: &quot;32&quot;,</div><div class="line">                &quot;DeviceName&quot;: &quot;docker-253:0-102243954-b0ecd426ae759df49cab32c752911e1dcd35a84afc31955ba49a4699db11092d&quot;,</div><div class="line">                &quot;DeviceSize&quot;: &quot;10737418240&quot;</div><div class="line">            &#125;,</div><div class="line">            &quot;Name&quot;: &quot;devicemapper&quot;</div><div class="line">        &#125;,</div><div class="line">        &quot;Mounts&quot;: [],</div><div class="line">        &quot;Config&quot;: &#123;</div><div class="line">            &quot;Hostname&quot;: &quot;4f30ee04eac7&quot;,</div><div class="line">            &quot;Domainname&quot;: &quot;&quot;,</div><div class="line">            &quot;User&quot;: &quot;&quot;,</div><div class="line">            &quot;AttachStdin&quot;: true,</div><div class="line">            &quot;AttachStdout&quot;: true,</div><div class="line">            &quot;AttachStderr&quot;: true,</div><div class="line">            &quot;Tty&quot;: true,</div><div class="line">            &quot;OpenStdin&quot;: true,</div><div class="line">            &quot;StdinOnce&quot;: true,</div><div class="line">            &quot;Env&quot;: [</div><div class="line">                &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</div><div class="line">            ],</div><div class="line">            &quot;Cmd&quot;: [</div><div class="line">                &quot;/bin/bash&quot;</div><div class="line">            ],</div><div class="line">            &quot;Image&quot;: &quot;470671670cac&quot;,</div><div class="line">            &quot;Volumes&quot;: null,</div><div class="line">            &quot;WorkingDir&quot;: &quot;&quot;,</div><div class="line">            &quot;Entrypoint&quot;: null,</div><div class="line">            &quot;OnBuild&quot;: null,</div><div class="line">            &quot;Labels&quot;: &#123;</div><div class="line">                &quot;org.label-schema.build-date&quot;: &quot;20200114&quot;,</div><div class="line">                &quot;org.label-schema.license&quot;: &quot;GPLv2&quot;,</div><div class="line">                &quot;org.label-schema.name&quot;: &quot;CentOS Base Image&quot;,</div><div class="line">                &quot;org.label-schema.schema-version&quot;: &quot;1.0&quot;,</div><div class="line">                &quot;org.label-schema.vendor&quot;: &quot;CentOS&quot;,</div><div class="line">                &quot;org.opencontainers.image.created&quot;: &quot;2020-01-14 00:00:00-08:00&quot;,</div><div class="line">                &quot;org.opencontainers.image.licenses&quot;: &quot;GPL-2.0-only&quot;,</div><div class="line">                &quot;org.opencontainers.image.title&quot;: &quot;CentOS Base Image&quot;,</div><div class="line">                &quot;org.opencontainers.image.vendor&quot;: &quot;CentOS&quot;</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        &quot;NetworkSettings&quot;: &#123;</div><div class="line">            &quot;Bridge&quot;: &quot;&quot;,</div><div class="line">            &quot;SandboxID&quot;: &quot;6b6ff8333ff7e94732a09dddc37744728b0febc6c1bf06bfaaf54bf791e576d3&quot;,</div><div class="line">            &quot;HairpinMode&quot;: false,</div><div class="line">            &quot;LinkLocalIPv6Address&quot;: &quot;&quot;,</div><div class="line">            &quot;LinkLocalIPv6PrefixLen&quot;: 0,</div><div class="line">            &quot;Ports&quot;: &#123;&#125;,</div><div class="line">            &quot;SandboxKey&quot;: &quot;/var/run/docker/netns/6b6ff8333ff7&quot;,</div><div class="line">            &quot;SecondaryIPAddresses&quot;: null,</div><div class="line">            &quot;SecondaryIPv6Addresses&quot;: null,</div><div class="line">            &quot;EndpointID&quot;: &quot;66edac9cd524223f0a57e4c58d5080114826f6a90db64f1e734f6f6f5371627e&quot;,</div><div class="line">            &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</div><div class="line">            &quot;GlobalIPv6Address&quot;: &quot;&quot;,</div><div class="line">            &quot;GlobalIPv6PrefixLen&quot;: 0,</div><div class="line">            &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</div><div class="line">            &quot;IPPrefixLen&quot;: 16,</div><div class="line">            &quot;IPv6Gateway&quot;: &quot;&quot;,</div><div class="line">            &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</div><div class="line">            &quot;Networks&quot;: &#123;</div><div class="line">                &quot;bridge&quot;: &#123;</div><div class="line">                    &quot;IPAMConfig&quot;: null,</div><div class="line">                    &quot;Links&quot;: null,</div><div class="line">                    &quot;Aliases&quot;: null,</div><div class="line">                    &quot;NetworkID&quot;: &quot;cd648ca5b88f8ec9e946884ed18c21fe1f2bbf214a5e3bd0094bdd61cc36f41c&quot;,</div><div class="line">                    &quot;EndpointID&quot;: &quot;66edac9cd524223f0a57e4c58d5080114826f6a90db64f1e734f6f6f5371627e&quot;,</div><div class="line">                    &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</div><div class="line">                    &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</div><div class="line">                    &quot;IPPrefixLen&quot;: 16,</div><div class="line">                    &quot;IPv6Gateway&quot;: &quot;&quot;,</div><div class="line">                    &quot;GlobalIPv6Address&quot;: &quot;&quot;,</div><div class="line">                    &quot;GlobalIPv6PrefixLen&quot;: 0,</div><div class="line">                    &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</div><div class="line">                    &quot;DriverOpts&quot;: null</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">]</div></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Docker|1.安装部署</title>
      <link href="/arlo/4470a347/"/>
      <url>/arlo/4470a347/</url>
      
        <content type="html"><![CDATA[<h1 id="CentOS7-安装Docker"><a href="#CentOS7-安装Docker" class="headerlink" title="CentOS7 安装Docker"></a>CentOS7 安装Docker</h1><h2 id="删掉之前的docker版本"><a href="#删掉之前的docker版本" class="headerlink" title="删掉之前的docker版本"></a>删掉之前的docker版本</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum remove docker docker-common docker-selinux docker-engine</div></pre></td></tr></table></figure><h2 id="安装相关依赖"><a href="#安装相关依赖" class="headerlink" title="安装相关依赖"></a>安装相关依赖</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</div></pre></td></tr></table></figure><h2 id="添加软件源信息"><a href="#添加软件源信息" class="headerlink" title="添加软件源信息"></a>添加软件源信息</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</div></pre></td></tr></table></figure><h2 id="更新并安装Docker-CE"><a href="#更新并安装Docker-CE" class="headerlink" title="更新并安装Docker-CE"></a>更新并安装Docker-CE</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">yum makecache fast</div><div class="line">sudo yum -y install docker-ce</div></pre></td></tr></table></figure><h2 id="开启Docker服务"><a href="#开启Docker服务" class="headerlink" title="开启Docker服务"></a>开启Docker服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">systemctl start docker</div></pre></td></tr></table></figure><a id="more"></a><h2 id="查看安装信息"><a href="#查看安装信息" class="headerlink" title="查看安装信息"></a>查看安装信息</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# docker version</div><div class="line">Client: Docker Engine - Community</div><div class="line"> Version:           19.03.5</div><div class="line"> API version:       1.40</div><div class="line"> Go version:        go1.12.12</div><div class="line"> Git commit:        633a0ea</div><div class="line"> Built:             Wed Nov 13 07:25:41 2019</div><div class="line"> OS/Arch:           linux/amd64</div><div class="line"> Experimental:      false</div><div class="line"></div><div class="line">Server: Docker Engine - Community</div><div class="line"> Engine:</div><div class="line">  Version:          19.03.5</div><div class="line">  API version:      1.40 (minimum version 1.12)</div><div class="line">  Go version:       go1.12.12</div><div class="line">  Git commit:       633a0ea</div><div class="line">  Built:            Wed Nov 13 07:24:18 2019</div><div class="line">  OS/Arch:          linux/amd64</div><div class="line">  Experimental:     false</div><div class="line"> containerd:</div><div class="line">  Version:          1.2.10</div><div class="line">  GitCommit:        b34a5c8af56e510852c35414db4c1f4fa6172339</div><div class="line"> runc:</div><div class="line">  Version:          1.0.0-rc8+dev</div><div class="line">  GitCommit:        3e425f80a8c931f88e6d94a8c831b9d5aa481657</div><div class="line"> docker-init:</div><div class="line">  Version:          0.18.0</div><div class="line">  GitCommit:        fec3683</div></pre></td></tr></table></figure><h1 id="配置阿里云镜像加速"><a href="#配置阿里云镜像加速" class="headerlink" title="配置阿里云镜像加速"></a>配置阿里云镜像加速</h1><p>推荐安装1.10.0以上版本的Docker客户端</p><h2 id="使用阿里云账号登录"><a href="#使用阿里云账号登录" class="headerlink" title="使用阿里云账号登录"></a>使用阿里云账号登录</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors</div></pre></td></tr></table></figure><h2 id="配置镜像加速器"><a href="#配置镜像加速器" class="headerlink" title="配置镜像加速器"></a>配置镜像加速器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">mkdir -p /etc/docker</div><div class="line">tee /etc/docker/daemon.json &lt;&lt;-&apos;EOF&apos;</div><div class="line">&#123;</div><div class="line">  &quot;registry-mirrors&quot;: [&quot;https://yk5r9j0f.mirror.aliyuncs.com&quot;]</div><div class="line">&#125;</div><div class="line">EOF</div><div class="line">systemctl daemon-reload</div><div class="line">systemctl restart docker</div></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>工具|利用GoAccess分析Nginx访问日志</title>
      <link href="/arlo/85bf3410/"/>
      <url>/arlo/85bf3410/</url>
      
        <content type="html"><![CDATA[<p>项目上线之后，访问量逐渐增多，最近发现一些异常，从服务器监控zabbix没有发现比较有用的信息，链路监控pinpoint上发现访问量比之前增加了很多，所以想从入口方面分析一下来源，看看是不是被人抓取数据了。<br><a id="more"></a></p><h1 id="Nginx日志格式"><a href="#Nginx日志格式" class="headerlink" title="Nginx日志格式"></a>Nginx日志格式</h1><p>我这里使用的是阿里开源的tengine，和nginx是一样的，默认的日志格式</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;</div><div class="line">                      &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</div><div class="line">                      &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</div><div class="line"></div><div class="line">    access_log  logs/access.log  main;</div><div class="line">    error_log   logs/error.log warn;</div><div class="line">    access_log  &quot;pipe:rollback logs/access_log interval=1d baknum=7 maxsize=2G&quot;  main;</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">113.200.77.134 - - [19/Dec/2019:10:45:39 +0800] &quot;GET /air/home/code/regions HTTP/1.1&quot; 200 1391 &quot;http://localhost:8080/app/tabs/home&quot; &quot;Mozilla/5.0 (Linux; Android 9; COL-AL10 Build/HUAWEICOL-AL10; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/72.0.3626.121 Mobile Safari/537.36&quot; &quot;-&quot;</div></pre></td></tr></table></figure><table><thead><tr><th>参数</th><th>说明</th><th>实例</th></tr></thead><tbody><tr><td>$remote_addr</td><td>客户端地址</td><td>113.200.77.134</td></tr><tr><td>$remote_user</td><td>客户端用户名称</td><td>- -</td></tr><tr><td>$time_local</td><td>访问时间和时区</td><td>19/Dec/2019:10:45:39 +0800]</td></tr><tr><td>$request</td><td>请求的URI和HTTP协议</td><td>GET /air/home/code/regions HTTP/1.1</td></tr><tr><td>$http_host</td><td>请求地址，即浏览器中你输入的地址（IP或域名）</td><td></td></tr><tr><td>$status</td><td>HTTP请求状态</td><td>200</td></tr><tr><td>$upstream_status</td><td>upstream状态</td><td></td></tr><tr><td>$body_bytes_sent</td><td>发送给客户端文件内容大小</td><td>1391</td></tr><tr><td>$http_referer</td><td>url跳转来源</td><td><a href="http://localhost:8080/app/tabs/home" target="_blank" rel="external">http://localhost:8080/app/tabs/home</a></td></tr><tr><td>$http_user_agent</td><td>用户终端浏览器等信息</td><td>Mozilla/5.0 (Linux; Android 9; COL-AL10 Build/HUAWEICOL-AL10; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/72.0.3626.121 Mobile Safari/537.36</td></tr><tr><td>$ssl_protocol</td><td>SSL协议版本</td><td></td></tr><tr><td>$ssl_cipher</td><td>交换数据中的算法</td><td></td></tr><tr><td>$http_x_forwarded_for</td><td>HTTP 扩展头部</td><td></td></tr><tr><td>$upstream_addr</td><td>后台upstream的地址，即真正提供服务的主机地址</td><td></td></tr><tr><td>$request_time</td><td>Nginx处理整个请求所用总时间</td><td></td></tr><tr><td>$upstream_connect_time</td><td>Nginx与upstream server建立连接所用时间</td><td></td></tr><tr><td>$upstream_header_time</td><td>从建立连接成功到接收第一个字节之间的时间</td><td></td></tr><tr><td>$upstream_response_time</td><td>从建立连接成功到接收第一个字节之间的时间</td></tr></tbody></table><h1 id="GoAccess"><a href="#GoAccess" class="headerlink" title="GoAccess"></a>GoAccess</h1><p><strong>GoAccess</strong>是一个开源的<strong>实时</strong> <strong>Web日志分析器</strong>和交互式查看器，可在<em> nix系统的<strong>终端</strong>中或通过<em>*浏览器运行</em></em>。</p><p>它为需要实时可视服务器报告的系统管理员提供了<strong>快速</strong>而有价值的HTTP统计信息。</p><p>官网地址：<a href="https://goaccess.io/" target="_blank" rel="external">https://goaccess.io/</a></p><p>github地址：<a href="https://github.com/allinurl/goaccess" target="_blank" rel="external">https://github.com/allinurl/goaccess</a></p><p>GoAccess日志规范：<a href="https://goaccess.io/man#custom-log" target="_blank" rel="external">https://goaccess.io/man#custom-log</a></p><h2 id="安装GoAccess"><a href="#安装GoAccess" class="headerlink" title="安装GoAccess"></a>安装GoAccess</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">yum install geoip-devel  ncurses-devel glib2 glib2-devel  ncurses-devel zlib zlib-devel </div><div class="line">wget https://tar.goaccess.io/goaccess-1.3.tar.gz</div><div class="line">tar -xzvf goaccess-1.3.tar.gz</div><div class="line">cd goaccess-1.3/</div><div class="line">./configure --prefix=/usr/local/goaccess --enable-utf8 --enable-geoip=legacy</div><div class="line">make</div><div class="line">make install</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim /usr/local/goaccess/etc/goaccess/goaccess.conf</div></pre></td></tr></table></figure><p>配置日志格式，和nginx里的日志格式匹配起来，日志规范参考上述链接</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">time-format %H:%M:%S</div><div class="line">date-format %d/%b/%Y</div><div class="line">log-format %h %^[%d:%t %^] &quot;%r&quot; %s %b &quot;%R&quot; &quot;%u&quot;</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">%t  匹配time-format格式的时间字段</div><div class="line">%d  匹配date-format格式的日期字段</div><div class="line">%h  host(客户端ip地址，包括ipv4和ipv6)</div><div class="line">%r  来自客户端的请求行</div><div class="line">%m  请求的方法</div><div class="line">%U  URL路径</div><div class="line">%H  请求协议</div><div class="line">%s  服务器响应的状态码</div><div class="line">%b  服务器返回的内容大小</div><div class="line">%R  HTTP请求头的referer字段</div><div class="line">%u  用户代理的HTTP请求报头</div><div class="line">%D  请求所花费的时间，单位微秒</div><div class="line">%T  请求所花费的时间，单位秒</div><div class="line">%^  忽略这一字段</div></pre></td></tr></table></figure><h2 id="终端查看日志"><a href="#终端查看日志" class="headerlink" title="终端查看日志"></a>终端查看日志</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/goaccess/bin/goaccess -a -d -f /usr/local/tengine/logs/access.log -p /usr/local/goaccess/etc/goaccess/goaccess.conf</div></pre></td></tr></table></figure><p><img src="/images/2019/1219/01.png" alt="goaccess"></p><ul><li>F1或h：帮助</li><li>F5 ：刷新主界面</li><li>q：退出程序/当前窗口/折叠当前模块</li><li>o或Enter：展开选中的模块或窗口</li><li>0-9以及Shift + 0：将选中的模块或窗口激活</li><li>k和j：模块内部移动</li><li>c：修改配色</li><li>^f和^b：模块中上下滚屏</li><li>tab shift+tab：前后切换模块</li><li>s：模块内部排序选择</li><li>/：在所有模块中搜索(支持正则)</li><li>n：找到下个匹配</li><li>g和G：跳到第一项/最后一项</li></ul><h2 id="生成html格式"><a href="#生成html格式" class="headerlink" title="生成html格式"></a>生成html格式</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">usr/local/goaccess/bin/goaccess -a -d -f /usr/local/tengine/logs/access_log.1 -p /usr/local/goaccess/etc/goaccess/goaccess.conf  -o ~/sx.html</div></pre></td></tr></table></figure><p><img src="/images/2019/1219/02.png" alt="goaccess"></p>]]></content>
      
      
      
    </entry>
    
    <entry>
      <title>Oracle自动删除归档日志</title>
      <link href="/arlo/272be08f/"/>
      <url>/arlo/272be08f/</url>
      
        <content type="html"><![CDATA[<h1 id="Oracle日志的分类"><a href="#Oracle日志的分类" class="headerlink" title="Oracle日志的分类"></a>Oracle日志的分类</h1><p>Alter log  files：警报日志<br>Trace files：跟踪日志（用户和进程）<br>redo log ：重做日志（记录数据库的更改）<br><a id="more"></a></p><h2 id="重做日志"><a href="#重做日志" class="headerlink" title="重做日志"></a>重做日志</h2><p>分为在线重做日志和归档重做日志<br><strong>在线重做日志</strong>：又称联机重做日志，指Oracle以SQL脚本的形式记录数据库的数据更新，换句话说，实时保存已执行的SQL脚本到在线日志文件中<br><strong>归档重做日志</strong>：简称归档日志，是指当条件满足时，Oracle将在线重做日志以文件形式保存到硬盘（持久化）<br>重做日志的简单原理：在数据更新操作commit前，将更改的SQL脚本写入重做日志。主要用于数据库的增量备份和增量恢复。<br>重做日志直接对应于硬盘的重做日志文件（有在线和归档俩种），重做日志文件以组的形式组织，一个重做日志组包括一个或多个日志文件。</p><h2 id="归档重做日志"><a href="#归档重做日志" class="headerlink" title="归档重做日志"></a>归档重做日志</h2><p>其实，所谓的归档，就是指，将在线日志进行归档，持久化成固定的文件到硬盘，便于以后的恢复和查询。当然，前提条件是数据库要处于归档模式。<br>在线重做日志大小毕竟是有限的，当都写满了的时候，就面临着俩个选择，第一个就是把以前在线重做日志从头擦除开始继续写，第二种就是把以前的在线重做日志先进行备份，然后对被备份的日志擦除开始写新的在线Redo  File。这种备份的在线重做日志就是归档日志。而数据库如果采用这种生成归档日志的模式的话，就是归档日志模式（ARCHIVELOG模式），反之如果不生成归档日志，就是非归档日志模式（NOARCHIVELOG模式）。<br><strong>有了归档日志有什么好处？</strong><br>比如在这个月1号的时候备份了一次数据，然后过了10天，这个10天生成了很多在线重做日志，突然发现其中有一个数据磁盘出问题了，不能用了，那我该如何是好呢？<br>如果没有采用归档日志，那么实际上磁盘中只会有几个最新的在线重做日志。那么我只能把出问题的数据磁盘上所占据的表空间都删除掉。但是如果是SYSTEM表空间所设计的磁盘出错了，就没办法这么做了，只能用第二种方法。第二种方法就是把1号备份的数据拿出来恢复。那么1号到10号之间的10天的数据都丢了，如果是关键系统，比如证券金融什么的系统，就要让你赔钱赔死掉。<br>但是如果有了归档日志，那么你这10天的重做日志都会存放起来，那么DBA首先会把1号的备份数据恢复，然后再拿这10天的Redo日志来进行一次数据操作重放，那么就可以完全恢复最新的数据库，不会有什么后果了。<br>在软件开发的时候，由于测试服务器的配置有限，特别是磁盘空间有限，所以可能要限制Redo文件的大小，有可能把系统设置为NOARCHIVELOG模式了。但是在实际的生产环境下，基本上一定要使用ARCHIVELOG模式，否则万一出了问题，真是苦都来不及。<br>有人可能会怕归档日志造成性能损失。其实这个完全是杞人忧天的，归档日志只是做一个备份，其实也就是多耗一些磁盘空间而已。在当前的软件系统中，硬盘的存储容量成本已经属于低到可以忽略的地步，而最重要的是数据库的安全。DBA的任务本来就是确保数据的安全，如果连安全都保证不了，那点微乎其微的性能提高又有什么用呢。<br>归档日志（Archive Log）是非活动的重做日志备份。通过使用归档日志，可以保留所有重做历史记录，当数据库处于Archive Log模式并进行日志切换时，后台进程ARCH会将重做日志的内容保存到归档日志中，当数据库出现介质失败时，使用数据文件备份，归档日志和重做日志可以完全恢复数据库。</p><h4 id="查看数据库当前是否为归档模式"><a href="#查看数据库当前是否为归档模式" class="headerlink" title="查看数据库当前是否为归档模式"></a>查看数据库当前是否为归档模式</h4><p><code>SELECT  LOG_MODE FROM  V$DATABASE;</code><br>ARCHIVELOG（归档模式）、NOARCHIVELOG（非归档模式）</p><h4 id="切换数据库为归档模式"><a href="#切换数据库为归档模式" class="headerlink" title="切换数据库为归档模式"></a><a href="http://islocal.cc/arlo/60a79bb7/">切换数据库为归档模式</a></h4><p><code>shutdown   immediate             #关闭数据库</code><br><code>startup   mount                        #开启数据库到挂载状态</code><br><code>alter database archivelog;     #改变模式为ARCHIVELOG</code><br><code>archive log  start;                   #开启归档日志</code><br><code>alter datebase open;               #打开数据库</code></p><h4 id="查找归档日志目录"><a href="#查找归档日志目录" class="headerlink" title="查找归档日志目录"></a>查找归档日志目录</h4><p><code>SELECT  destination  FROM  V$archive_dest;</code></p><h3 id="在线重做日志的原理"><a href="#在线重做日志的原理" class="headerlink" title="在线重做日志的原理"></a>在线重做日志的原理</h3><p>对于在线重做日志，Oracle 11g默认对于每个数据库实例，建立3个在线日志组，每组一个日志文件，文件名称为REDO01.LOG,REDO02.LOG,REDO03.LOG。（用户可以通过视图操作添加/修改/删除日志组合日志文件来自定义在线重做日志）每组内的日志文件的内容完全相同，且保存在不同的位置，用于磁盘日志镜像，以做多次备份提高安全性。默认情况这3组通常只有一组处于活动状态，不断地同步写入已操作的脚本，当日志文件写满时（达到指定的空间配额），如果当前数据库处于归档模式，则将在线日志归档到硬盘，成为归档日志；若当前数据库处于非归档模式，则不进行归档操作，而当前在线日志的内容会被下一次重新写入覆盖而无法保存。因此，通常数据库在运行时，是处于归档模式下的，以保存数据更新的日志。当前归档日志组写满够，Oracle会切换到下一日志组，继续写入，这样循环切换；处于归档模式下，切换至原已写满的日志组，若该日志组归档完毕则则覆盖写入，若没有则只能使用日志缓冲区，等待归档完毕之后才能覆盖写入。当然，处于非归档模式下是直接覆盖写入的。</p><h1 id="删除归档日志"><a href="#删除归档日志" class="headerlink" title="删除归档日志"></a>删除归档日志</h1><p>由于归档日志日积月累，占用空间很大，我们只需要保留最近一段时间的日志即可，所以我们要对之前的内容做删除处理。</p><h2 id="用oracle用户登陆rman并连接数据库"><a href="#用oracle用户登陆rman并连接数据库" class="headerlink" title="用oracle用户登陆rman并连接数据库"></a>用oracle用户登陆rman并连接数据库</h2><p><code>hostname@oracle$ rman target /</code></p><h2 id="列出并确认归档日志路径"><a href="#列出并确认归档日志路径" class="headerlink" title="列出并确认归档日志路径"></a>列出并确认归档日志路径</h2><p><code>RMAN&gt;list archivelog all;</code></p><h2 id="删除7天以前的归档日志"><a href="#删除7天以前的归档日志" class="headerlink" title="删除7天以前的归档日志"></a>删除7天以前的归档日志</h2><p><code>RMAN&gt;DELETE ARCHIVELOG ALL COMPLETED BEFORE &#39;SYSDATE-7&#39;;</code>  表明删除当前的系统时间7天前的日志</p><h1 id="Windows下自动删除归档日志"><a href="#Windows下自动删除归档日志" class="headerlink" title="Windows下自动删除归档日志"></a>Windows下自动删除归档日志</h1><h2 id="新建E-database-backup-rm-archivelog-txt文件"><a href="#新建E-database-backup-rm-archivelog-txt文件" class="headerlink" title="新建E:\database_backup\rm_archivelog.txt文件"></a>新建E:\database_backup\rm_archivelog.txt文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">connect target  /</div><div class="line">run&#123;</div><div class="line">    crosscheck archivelog all;</div><div class="line">    DELETE ARCHIVELOG ALL COMPLETED BEFORE &apos;SYSDATE-7&apos;;</div><div class="line">    delete expired archivelog all;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="新建E-database-backup-rm-archivelog-bat文件"><a href="#新建E-database-backup-rm-archivelog-bat文件" class="headerlink" title="新建E:\database_backup\rm_archivelog.bat文件"></a>新建E:\database_backup\rm_archivelog.bat文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">@echo off</div><div class="line">set &quot;filename=rm_archivelog_task_log_%date:~0,4%%date:~5,2%%date:~8,2%.txt&quot;</div><div class="line">(</div><div class="line">echo.</div><div class="line">echo =========================  正在清除过期归档文件，请稍等...... %date% %time%  =========================</div><div class="line">echo.</div><div class="line">rman cmdfile=E:\database_backup\rm_archivelog.txt</div><div class="line">echo.</div><div class="line">echo =========================              【结束清理 %date% %time%】                  =========================</div><div class="line">echo.</div><div class="line">)&gt;&gt;E:\database_backup\%filename% 2&gt;&amp;1&lt;nul</div><div class="line">pause</div></pre></td></tr></table></figure><h2 id="设置计划任务"><a href="#设置计划任务" class="headerlink" title="设置计划任务"></a>设置计划任务</h2><p>每日凌晨执行E:\database_backup\rm_archivelog.bat脚本</p><h1 id="Linux下自动删除归档日志"><a href="#Linux下自动删除归档日志" class="headerlink" title="Linux下自动删除归档日志"></a>Linux下自动删除归档日志</h1><h2 id="编写脚本"><a href="#编写脚本" class="headerlink" title="编写脚本"></a>编写脚本</h2><p><code>vim /home/oracle/.rm_archivelog.sh</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line">#Author 南山小樵</div><div class="line">#Date 2019/12/16</div><div class="line"></div><div class="line">if [ -f ~/.bash_profile ]; then</div><div class="line">    . ~/.bash_profile</div><div class="line">fi</div><div class="line">#set env</div><div class="line"></div><div class="line">ORACLE_SID=orcl</div><div class="line">ORACLE_HOME=/u01/app/oracle/product/11.2.0/db_1/</div><div class="line"></div><div class="line">$ORACLE_HOME/bin/rman target sys/passwd@orcl  log=/tmp/rman.log &lt;&lt;EOF       </div><div class="line">run&#123;</div><div class="line">crosscheck archivelog all;    </div><div class="line">delete noprompt expired archivelog all;    </div><div class="line">delete noprompt archivelog all completed before &apos;sysdate - 7&apos;;    </div><div class="line">&#125;  </div><div class="line">exit;</div><div class="line">EOF</div></pre></td></tr></table></figure></p><h2 id="给脚本赋予可执行权限"><a href="#给脚本赋予可执行权限" class="headerlink" title="给脚本赋予可执行权限"></a>给脚本赋予可执行权限</h2><p><code>chmod +x /home/oracle/.rm_archivelog.sh</code></p><h2 id="设置计划任务-1"><a href="#设置计划任务-1" class="headerlink" title="设置计划任务"></a>设置计划任务</h2><p><code>crontab -l</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">00 3 * * * /home/oracle/.rm_archivelog.sh</div></pre></td></tr></table></figure></p><p>参考链接：<br><a href="https://www.jianshu.com/p/3bc8f372fe16" target="_blank" rel="external">https://www.jianshu.com/p/3bc8f372fe16</a><br><a href="https://www.cnblogs.com/kerrycode/p/9046372.html" target="_blank" rel="external">https://www.cnblogs.com/kerrycode/p/9046372.html</a></p><hr>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>没有PE的情况下，如何强行修改Windows Server 2012密码？</title>
      <link href="/arlo/fba0cc3c/"/>
      <url>/arlo/fba0cc3c/</url>
      
        <content type="html"><![CDATA[<p>对windows环境比较熟悉的朋友都知道，windows下修改密码最常用的就是PE工具了，一键修改；最近服务器上有台Windows Server 2012的虚拟机密码忘记了，无奈又不能直接挂载PE上去，在网上看到这个方法，感觉很方便，在此记录一下！（服务器是Xen Server环境虚拟机，本教程是vmware workstations，方法差不多）</p><a id="more"></a><h1 id="挂载iso镜像到虚拟机"><a href="#挂载iso镜像到虚拟机" class="headerlink" title="挂载iso镜像到虚拟机"></a>挂载iso镜像到虚拟机</h1><p>重启虚拟机，从cd/dvd-rom启动</p><p><img src="\images\2019\1111\01.png" alt="windows"></p><h1 id="引导至安装操作系统界面，点击下一步"><a href="#引导至安装操作系统界面，点击下一步" class="headerlink" title="引导至安装操作系统界面，点击下一步"></a>引导至安装操作系统界面，点击下一步</h1><p><img src="\images\2019\1111\02.png" alt="windows"></p><h1 id="进入安装界面，点击左下角开始修复"><a href="#进入安装界面，点击左下角开始修复" class="headerlink" title="进入安装界面，点击左下角开始修复"></a>进入安装界面，点击左下角开始修复</h1><p><img src="\images\2019\1111\06.png" alt="windows"></p><h1 id="选择一个选项界面-“疑难杂症”"><a href="#选择一个选项界面-“疑难杂症”" class="headerlink" title="选择一个选项界面-“疑难杂症”"></a>选择一个选项界面-“疑难杂症”</h1><p><img src="\images\2019\1111\03.png" alt="windows"></p><h1 id="高级选项界面-命令提示符"><a href="#高级选项界面-命令提示符" class="headerlink" title="高级选项界面-命令提示符"></a>高级选项界面-命令提示符</h1><p><img src="\images\2019\1111\04.png" alt="windows"></p><h1 id="在弹出的命令提示符窗口操作"><a href="#在弹出的命令提示符窗口操作" class="headerlink" title="在弹出的命令提示符窗口操作"></a>在弹出的命令提示符窗口操作</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">d:</div><div class="line">cd Windows\System32</div><div class="line">move Utilman.exe Utilman.exe.bak</div><div class="line">copy cmd.exe Utilman.exe</div><div class="line">shutdown /r /t 0</div></pre></td></tr></table></figure><p><img src="\images\2019\1111\05.png" alt="windows"></p><h1 id="重启虚拟机"><a href="#重启虚拟机" class="headerlink" title="重启虚拟机"></a>重启虚拟机</h1><p>点击左下角，弹出命令行提示框</p><p><img src="\images\2019\1111\07.png" alt="windows"></p><p>将administrator密码修改为111.com？</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">net user administrator 111.com?</div></pre></td></tr></table></figure><p><img src="\images\2019\1111\08.png" alt="windows"></p><p>成功登录操作系统。</p><p><img src="\images\2019\1111\09.png" alt="windows"></p>]]></content>
      
      
      <categories>
          
          <category> Troubleshooting </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Oracle单实例配置多个监听</title>
      <link href="/arlo/1651f01e/"/>
      <url>/arlo/1651f01e/</url>
      
        <content type="html"><![CDATA[<h1 id="监听注册"><a href="#监听注册" class="headerlink" title="监听注册"></a>监听注册</h1><p>Oracle的注册就是将数据库作为一个服务注册到监听程序，而客户端不需要知道数据库名和实例名，只需要知道改数据库对外提供的服务名就可以申请连接到数据库。</p><p>动态注册：由PMON进程动态注册至监听中<br>静态注册：通过解析listene.ora文件</p><p>在没有listener.ora配置文件的情况下，如果启动监听，则监听为动态注册。用图形化netca创建的监听，默认也为动态注册；监听的配置文件都在<code>$ORACLE_HOME/network/admin</code>目录下，默认监听名为LISTENER，端口为1521<br><img src="\images\2019\0905\01.png" alt="05"></p><a id="more"></a><h1 id="动态监听"><a href="#动态监听" class="headerlink" title="动态监听"></a>动态监听</h1><p>在动态注册监听的环境中，listener.ora文件可以不包括当前数据库的实例信息，所以这个文件不必要。<br>实例启动时，会由Oracle PMON进程将数据库实例信息动态注册至监听上。当Oracle实例关闭时，会再次由PMON进程自动从监听里面撤销当前实例信息。<br>动态注册成功大概需要一分钟时间，注册成功状态为READY；</p><p>一般有3种状态：READY、BLOCKED和RESTRICED<br><strong>READY</strong>：表示数据库实例已经处于mount或者open状态，可以接受客户端连接<br><strong>BLOCKED</strong>：表示数据库实例还处于nomount状态或者该实例类型为ASM实例，不接受客户端连接，如果这时候客户端去连接数据库会报ora-12528错误<br><strong>RESTRICED</strong>：表示数据库处于RESTRICED模式，不接受普通权限的远程客户端连接，如果这时候客户端去连接数据库会报ora-12526错误</p><h2 id="编辑监听文件listener-ora"><a href="#编辑监听文件listener-ora" class="headerlink" title="编辑监听文件listener.ora"></a>编辑监听文件listener.ora</h2><p><code>[oracle@dbserver admin]$ cat listener.ora</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"># listener.ora Network Configuration File: /u01/app/oracle/product/11.2.0/db_1/network/admin/listener.ora</div><div class="line"># Generated by Oracle configuration tools.</div><div class="line"></div><div class="line">LISTENER =</div><div class="line">  (DESCRIPTION_LIST =</div><div class="line">    (DESCRIPTION =</div><div class="line">      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521))</div><div class="line">      (ADDRESS = (PROTOCOL = TCP)(HOST = dbserver)(PORT = 1521))</div><div class="line">    )</div><div class="line">  )</div><div class="line"></div><div class="line">LISTENER2 =</div><div class="line">  (DESCRIPTION_LIST =</div><div class="line">    (DESCRIPTION =</div><div class="line">      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1522))</div><div class="line">      (ADDRESS = (PROTOCOL = TCP)(HOST = dbserver)(PORT = 1522))</div><div class="line">    )</div><div class="line">  )</div><div class="line">ADR_BASE_LISTENER = /u01/app/oracle</div></pre></td></tr></table></figure></p><h2 id="编辑tnsnames-ora"><a href="#编辑tnsnames-ora" class="headerlink" title="编辑tnsnames.ora"></a>编辑tnsnames.ora</h2><p><code>[oracle@dbserver admin]$ cat tnsnames.ora</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"># tnsnames.ora Network Configuration File: /u01/app/oracle/product/11.2.0/db_1/network/admin/tnsnames.ora</div><div class="line"># Generated by Oracle configuration tools.</div><div class="line"></div><div class="line">ORCL =</div><div class="line">  (DESCRIPTION =</div><div class="line">    (ADDRESS = (PROTOCOL = TCP)(HOST = dbserver)(PORT = 1521))</div><div class="line">    (CONNECT_DATA =</div><div class="line">      (SERVER = DEDICATED)</div><div class="line">      (SERVICE_NAME = orcl)</div><div class="line">    )</div><div class="line">  )</div><div class="line"></div><div class="line">TEST =</div><div class="line">  (DESCRIPTION =</div><div class="line">    (ADDRESS = (PROTOCOL = TCP)(HOST = dbserver)(PORT = 1522))</div><div class="line">    (CONNECT_DATA =</div><div class="line">      (SERVER = DEDICATED)</div><div class="line">      (SERVICE_NAME = orcl)</div><div class="line">    )</div><div class="line">  )</div></pre></td></tr></table></figure></p><h2 id="启动新创建的监听LISTENER2"><a href="#启动新创建的监听LISTENER2" class="headerlink" title="启动新创建的监听LISTENER2"></a>启动新创建的监听LISTENER2</h2><p><code>[oracle@dbserver admin]$ lsnrctl start LISTENER2</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">LSNRCTL for Linux: Version 11.2.0.4.0 - Production on 05-SEP-2019 21:01:25</div><div class="line"></div><div class="line">Copyright (c) 1991, 2013, Oracle.  All rights reserved.</div><div class="line"></div><div class="line">Starting /u01/app/oracle/product/11.2.0/db_1/bin/tnslsnr: please wait...</div><div class="line"></div><div class="line">TNSLSNR for Linux: Version 11.2.0.4.0 - Production</div><div class="line">System parameter file is /u01/app/oracle/product/11.2.0/db_1/network/admin/listener.ora</div><div class="line">Log messages written to /u01/app/oracle/diag/tnslsnr/dbserver/listener2/alert/log.xml</div><div class="line">Listening on: (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1522)))</div><div class="line">Listening on: (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=dbserver)(PORT=1522)))</div><div class="line"></div><div class="line">Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=EXTPROC1522)))</div><div class="line">STATUS of the LISTENER</div><div class="line">------------------------</div><div class="line">Alias                     LISTENER2</div><div class="line">Version                   TNSLSNR for Linux: Version 11.2.0.4.0 - Production</div><div class="line">Start Date                05-SEP-2019 21:01:25</div><div class="line">Uptime                    0 days 0 hr. 0 min. 0 sec</div><div class="line">Trace Level               off</div><div class="line">Security                  ON: Local OS Authentication</div><div class="line">SNMP                      OFF</div><div class="line">Listener Parameter File   /u01/app/oracle/product/11.2.0/db_1/network/admin/listener.ora</div><div class="line">Listener Log File         /u01/app/oracle/diag/tnslsnr/dbserver/listener2/alert/log.xml</div><div class="line">Listening Endpoints Summary...</div><div class="line">  (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1522)))</div><div class="line">  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=dbserver)(PORT=1522)))</div><div class="line">The listener supports no services</div><div class="line">The command completed successfully</div></pre></td></tr></table></figure></p><h2 id="修改实例注册到新创建的监听LISTENER2"><a href="#修改实例注册到新创建的监听LISTENER2" class="headerlink" title="修改实例注册到新创建的监听LISTENER2"></a>修改实例注册到新创建的监听LISTENER2</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">[oracle@dbserver admin]$ sqlplus / as sysdba</div><div class="line"></div><div class="line">SQL*Plus: Release 11.2.0.4.0 Production on Thu Sep 5 21:05:56 2019</div><div class="line"></div><div class="line">Copyright (c) 1982, 2013, Oracle.  All rights reserved.</div><div class="line"></div><div class="line"></div><div class="line">Connected to:</div><div class="line">Oracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit Production</div><div class="line">With the Partitioning, OLAP, Data Mining and Real Application Testing options</div><div class="line"></div><div class="line">SQL&gt; show parameter local_listener;</div><div class="line"></div><div class="line">NAME     TYPE VALUE</div><div class="line">------------------------------------ ----------- ------------------------------</div><div class="line">local_listener     string</div><div class="line">SQL&gt; alter system set local_listener=&apos;TEST&apos;;</div><div class="line"></div><div class="line">System altered.</div><div class="line"></div><div class="line">SQL&gt; show parameter local_listener;</div><div class="line"></div><div class="line">NAME     TYPE VALUE</div><div class="line">------------------------------------ ----------- ------------------------------</div><div class="line">local_listener     string TEST</div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><p><img src="\images\2019\0905\02.png" alt="05"><br><img src="\images\2019\0905\03.png" alt="05"></p><p>修改之后，我们查看监听状态，可以发现orcl实例已经从默认的监听LISTENER修改为LISTENER2了。</p><h2 id="注册多个端口"><a href="#注册多个端口" class="headerlink" title="注册多个端口"></a>注册多个端口</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">SQL&gt;  ALTER SYSTEM SET LOCAL_LISTENER=&apos;(ADDRESS=(PROTOCOL=TCP)(HOST=192.168.100.132)(PORT=1521))&apos;,&apos;(ADDRESS=(PROTOCOL=TCP)(HOST=192.168.100.132)(PORT=1522))&apos;;</div><div class="line"></div><div class="line">System altered.</div><div class="line"></div><div class="line">SQL&gt; show parameter local_listener;</div><div class="line"></div><div class="line">NAME     TYPE VALUE</div><div class="line">------------------------------------ ----------- ------------------------------</div><div class="line">local_listener     string (ADDRESS=(PROTOCOL=TCP)(HOST=1</div><div class="line"> 92.168.100.132)(PORT=1521)), (</div><div class="line"> ADDRESS=(PROTOCOL=TCP)(HOST=19</div><div class="line"> 2.168.100.132)(PORT=1522))</div><div class="line">SQL&gt; alter system register;</div><div class="line"></div><div class="line">System altered.</div><div class="line"></div><div class="line">SQL&gt;</div></pre></td></tr></table></figure><p><img src="\images\2019\0905\04.png" alt="05"><br><img src="\images\2019\0905\05.png" alt="05"></p><h1 id="静态监听"><a href="#静态监听" class="headerlink" title="静态监听"></a>静态监听</h1><p>静态注册不管实例是否启动，在启动监听的时候都会将实例名称注册到监听中，主要用于DBA远程启动数据库实例。</p><h2 id="编辑监听配置文件listener-ora"><a href="#编辑监听配置文件listener-ora" class="headerlink" title="编辑监听配置文件listener.ora"></a>编辑监听配置文件listener.ora</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">[oracle@dbserver admin]$ cat listener.ora </div><div class="line"># listener.ora Network Configuration File: /u01/app/oracle/product/11.2.0/db_1/network/admin/listener.ora</div><div class="line"># Generated by Oracle configuration tools.</div><div class="line"></div><div class="line">LISTENER =</div><div class="line">  (DESCRIPTION_LIST =</div><div class="line">    (DESCRIPTION =</div><div class="line">      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521))</div><div class="line">      (ADDRESS = (PROTOCOL = TCP)(HOST = dbserver)(PORT = 1521))</div><div class="line">    )</div><div class="line">  )</div><div class="line"></div><div class="line">SID_LIST_LISTENER = </div><div class="line">  (SID_LIST = </div><div class="line">    (SID_DESC = </div><div class="line">      (GLOBAL_DBNAME = orcl) </div><div class="line">      (SID_NAME = orcl) </div><div class="line">      (ORACLE_HOME = /u01/app/oracle/product/11.2.0/db_1 ) </div><div class="line">    ) </div><div class="line">  )</div><div class="line"></div><div class="line"></div><div class="line">LISTENER2 =</div><div class="line">  (DESCRIPTION_LIST =</div><div class="line">    (DESCRIPTION =</div><div class="line">      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1522))</div><div class="line">      (ADDRESS = (PROTOCOL = TCP)(HOST = dbserver)(PORT = 1522))</div><div class="line">    )</div><div class="line">  )</div><div class="line">SID_LIST_LISTENER2 =</div><div class="line">  (SID_LIST =</div><div class="line">    (SID_DESC =</div><div class="line">      (GLOBAL_DBNAME = orcl)</div><div class="line">      (SID_NAME = orcl)</div><div class="line">      (ORACLE_HOME = /u01/app/oracle/product/11.2.0/db_1 )</div><div class="line">    )</div><div class="line">  )</div><div class="line">ADR_BASE_LISTENER = /u01/app/oracle</div></pre></td></tr></table></figure><h2 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h2><p><img src="\images\2019\0905\06.png" alt="05"><br><img src="\images\2019\0905\07.png" alt="05"></p>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Oracle解锁用户和表</title>
      <link href="/arlo/5b695efc/"/>
      <url>/arlo/5b695efc/</url>
      
        <content type="html"><![CDATA[<h1 id="解锁用户"><a href="#解锁用户" class="headerlink" title="解锁用户"></a>解锁用户</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alter user arlo account unlock;</div></pre></td></tr></table></figure><a id="more"></a><h1 id="数据级别解锁表"><a href="#数据级别解锁表" class="headerlink" title="数据级别解锁表"></a>数据级别解锁表</h1><h2 id="锁表查询的代码有以下的形式"><a href="#锁表查询的代码有以下的形式" class="headerlink" title="锁表查询的代码有以下的形式"></a>锁表查询的代码有以下的形式</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">select count(*) from v$locked_object;</div><div class="line">select * from v$locked_object;</div></pre></td></tr></table></figure><h2 id="查看哪个表被锁"><a href="#查看哪个表被锁" class="headerlink" title="查看哪个表被锁"></a>查看哪个表被锁</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">select b.owner,b.object_name,a.session_id,a.locked_mode from v$locked_object a,dba_objects b where b.object_id = a.object_id;</div><div class="line">--</div><div class="line">select b.owner TABLEOWNER, b.object_name TABLENAME, c.OSUSER LOCKBY,c.USERNAME LOGINID, c.sid SID, c.SERIAL# SERIAL from v$locked_object a,dba_objects b, v$session c where b.object_id = a.object_id AND a.SESSION_ID =c.sid;</div></pre></td></tr></table></figure><h2 id="查看是哪个session引起的"><a href="#查看是哪个session引起的" class="headerlink" title="查看是哪个session引起的"></a>查看是哪个session引起的</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select b.username,b.sid,b.serial#,logon_time from v$locked_object a,v$session b where a.session_id = b.sid order by b.logon_time;</div></pre></td></tr></table></figure><h2 id="查看是哪个sql引起的"><a href="#查看是哪个sql引起的" class="headerlink" title="查看是哪个sql引起的"></a>查看是哪个sql引起的</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select b.username,b.sid,b.serial#,c.* from v$locked_object a,v$session b,v$sql c where a.session_id = b.sid and b.SQL_ID = c.sql_id and c.sql_id = &apos;&apos; order by b.logon_time;</div></pre></td></tr></table></figure><h2 id="杀掉对应进程"><a href="#杀掉对应进程" class="headerlink" title="杀掉对应进程"></a>杀掉对应进程</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alter system kill session&apos;1025,41&apos;; --其中1025为sid,41为serial#</div></pre></td></tr></table></figure><h1 id="系统界别解锁表"><a href="#系统界别解锁表" class="headerlink" title="系统界别解锁表"></a>系统界别解锁表</h1><p>今天在使用上述方法解锁用户的时候报错</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">alter system kill session &apos;2293,85&apos;</div><div class="line">*</div><div class="line">ERROR at line 1:</div><div class="line">ORA-00031: session marked for kill</div></pre></td></tr></table></figure><h2 id="查找进程id"><a href="#查找进程id" class="headerlink" title="查找进程id"></a>查找进程id</h2><p>如果利用上面的命令杀死一个进程后，进程状态被置为”killed”，但是锁定的资源很长时间没有被释放，那么可以在os一级再杀死相应的进程（线程），首先执行下面的语句获得进程（线程）号：2293</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">SYS@orcl&gt; select spid, osuser, s.program from v$session s,v$process p where s.paddr=p.addr and s.sid=2293;</div><div class="line">SPID OSUSER PROGRAM</div><div class="line">-------- ----------------------- ---------------------------------------------</div><div class="line">384159 AdministratorSQL Developer</div></pre></td></tr></table></figure><h2 id="在Linux中结束进程"><a href="#在Linux中结束进程" class="headerlink" title="在Linux中结束进程"></a>在Linux中结束进程</h2><p>在Linux操作系统中执行命令杀掉进程</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kill -9 384159</div></pre></td></tr></table></figure><h2 id="在Windows中结束进程"><a href="#在Windows中结束进程" class="headerlink" title="在Windows中结束进程"></a>在Windows中结束进程</h2><p>在windows（unix也适用）用orakill杀死线程，orakill是oracle提供的一个可执行命令，语法为：<br><code>orakill sid thread</code>  – sid：表示要杀死的进程属于的实例名 thread：是要杀掉的线程号<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">C:&gt; orakill orcl 384159</div></pre></td></tr></table></figure></p><h2 id="查看Oracle链接客户端的IP等信息"><a href="#查看Oracle链接客户端的IP等信息" class="headerlink" title="查看Oracle链接客户端的IP等信息"></a>查看Oracle链接客户端的IP等信息</h2><h3 id="查看每个oracle帐户的连接总数"><a href="#查看每个oracle帐户的连接总数" class="headerlink" title="查看每个oracle帐户的连接总数"></a>查看每个oracle帐户的连接总数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">--查看当前连接数</div><div class="line">select count(*) from v$process;</div><div class="line"></div><div class="line">--查看会话session：</div><div class="line">select * from v$session where username is not null;</div><div class="line">select username,count(username) from v$session where username is not null group by username;</div><div class="line"></div><div class="line">--查看最大连接数</div><div class="line">select value from v$parameter where name =&apos;processes&apos;;</div><div class="line"></div><div class="line">--查看并发连接数</div><div class="line">Select count(*) from v$session where status=&apos;ACTIVE&apos;;</div><div class="line"></div><div class="line">--查询：客户端设备标识、客户端程序、oracle用户名、消耗的连接数量</div><div class="line">SELECT B.MACHINE 机器名,</div><div class="line">       B.PROGRAM 程序名,</div><div class="line">       B.USERNAME 用户名,</div><div class="line">       COUNT(*) 连接数</div><div class="line">  FROM V$PROCESS A, V$SESSION B</div><div class="line"> WHERE A.ADDR = B.PADDR</div><div class="line">   AND B.USERNAME IS NOT NULL</div><div class="line"> GROUP BY B.MACHINE, B.PROGRAM, B.USERNAME</div><div class="line"> ORDER BY COUNT(*) DESC;</div><div class="line"></div><div class="line">--杀死指定的进程</div><div class="line">alter system kill session &apos;sid,serial#&apos; immediate;</div></pre></td></tr></table></figure><h3 id="缺省从-v-session-中不能直接获得客户端-IP，可以在数据库中创建一个追踪客户端IP地址的触发器"><a href="#缺省从-v-session-中不能直接获得客户端-IP，可以在数据库中创建一个追踪客户端IP地址的触发器" class="headerlink" title="缺省从 v$session 中不能直接获得客户端 IP，可以在数据库中创建一个追踪客户端IP地址的触发器"></a>缺省从 v$session 中不能直接获得客户端 IP，可以在数据库中创建一个追踪客户端IP地址的触发器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">create or replace trigger on_logon_trigger after logon on database  </div><div class="line">begin  </div><div class="line">    dbms_application_info.set_client_info(sys_context(&apos;userenv&apos;, &apos;ip_address&apos;));  </div><div class="line">end;</div></pre></td></tr></table></figure><h3 id="比较常用的显示客户端信息的sql"><a href="#比较常用的显示客户端信息的sql" class="headerlink" title="比较常用的显示客户端信息的sql"></a>比较常用的显示客户端信息的sql</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">select sid,serial#,username,program,machine,client_info  </div><div class="line">from v$session  </div><div class="line">where username is not null  </div><div class="line">order by username,program,machine;</div></pre></td></tr></table></figure><h1 id="connection、process和session的基本知识"><a href="#connection、process和session的基本知识" class="headerlink" title="connection、process和session的基本知识"></a>connection、process和session的基本知识</h1><p>每个sql login称为一个连接（connection)，而每个连接，可以产生一个或多个会话，如果数据库运行在专用服务器方式，一个会话对应一个服务器进程（process)，如果数据库运行在共享服务器方式，一个服务器进程可以为多个会话服务。</p><p>Connection并不是直接建立在用户进程和数据库实例之间的。而是在用户进程和Server Process（服务器进程）之间的，因此有一个Connection就一定会有一个用户进程和一个服务器进程，但不一定会存在Session。比如，如果需要将东西从A运到B，Connection可以看成是一座“桥”，而卡车把东西从A运到B后并返回A，这就是Session。所以，只要不断开连接，随时都可以在这个连接上创建出会话。</p>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Zabbix(10)使用zabbix监控IPMI</title>
      <link href="/arlo/6abfbe9a/"/>
      <url>/arlo/6abfbe9a/</url>
      
        <content type="html"><![CDATA[<h1 id="IPMI介绍"><a href="#IPMI介绍" class="headerlink" title="IPMI介绍"></a>IPMI介绍</h1><p> IPMI（Intelligent Platform Management Interface）即智能平台管理接口是使硬件管理具备“智能化”的新一代通用接口标准。用户可以利用 IPMI 监视服务器的物理特征，如温度、电压、电扇工作状态、电源供应以及机箱入侵等。Ipmi 最大的优势在于它是独立于 CPU BIOS 和 OS 的，所以用户无论在开机还是关机的状态下，只要接通电源就可以实现对服务器的监控。Ipmi 是一种规范的标准，其中最重要的物理部件就是BMC(Baseboard Management Controller 如图1)，一种嵌入式管理微控制器，它相当于整个平台管理的“大脑”，通过它 ipmi 可以监控各个传感器的数据并记录各种事件的日志。 </p><a id="more"></a><h1 id="配置服务器IPMI"><a href="#配置服务器IPMI" class="headerlink" title="配置服务器IPMI"></a>配置服务器IPMI</h1><p>使用服务器默认的ipmi地址登录，然后进入到ipmi登录界面，修改规划的ip地址，我这里以浪潮服务器为例</p><p><img src="\images\2019\0729\01.png" alt="01"></p><h1 id="修改zabbix-server配置文件"><a href="#修改zabbix-server配置文件" class="headerlink" title="修改zabbix server配置文件"></a>修改zabbix server配置文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sed -i &apos;/# StartIPMIPollers=0/aStartIPMIPollers=3&apos; /etc/zabbix/zabbix_server.conf</div></pre></td></tr></table></figure><p><code>/etc/init.d/zabbix-server restart</code></p><h1 id="安装IPMI相关软件"><a href="#安装IPMI相关软件" class="headerlink" title="安装IPMI相关软件"></a>安装IPMI相关软件</h1><p><code>yum -y install OpenIPMI OpenIPMI-devel ipmitool freeipmi</code></p><h1 id="获取IPMI传感器参数"><a href="#获取IPMI传感器参数" class="headerlink" title="获取IPMI传感器参数"></a>获取IPMI传感器参数</h1><p><code>ipmitool -I lanplus -H 10.206.2.52 -U admin -P passwd sensor</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div></pre></td><td class="code"><pre><div class="line">CPU0_Temp        | 55.000     | degrees C  | ok    | na        | na        | na        | 101.000   | 103.000   | na        </div><div class="line">CPU1_Temp        | 52.000     | degrees C  | ok    | na        | na        | na        | 101.000   | 103.000   | na        </div><div class="line">PCH_Temp         | 50.000     | degrees C  | ok    | na        | na        | na        | 95.000    | 100.000   | na        </div><div class="line">DIMMG0_Temp      | 45.000     | degrees C  | ok    | na        | na        | na        | 83.000    | 93.000    | na        </div><div class="line">DIMMG1_Temp      | 43.000     | degrees C  | ok    | na        | na        | na        | 83.000    | 93.000    | na        </div><div class="line">Inlet_Temp       | 25.000     | degrees C  | ok    | na        | na        | na        | 40.000    | 42.000    | na        </div><div class="line">Outlet_Temp      | 48.000     | degrees C  | ok    | na        | na        | na        | na        | na        | na        </div><div class="line">SYS0_Temp        | 42.000     | degrees C  | ok    | na        | na        | na        | na        | na        | na        </div><div class="line">SYS1_Temp        | 35.000     | degrees C  | ok    | na        | na        | na        | na        | na        | na        </div><div class="line">RAID_Temp        | na         | degrees C  | na    | na        | na        | na        | 105.000   | 115.000   | na        </div><div class="line">GPU0_Temp        | na         | degrees C  | na    | na        | na        | na        | 82.000    | 92.000    | na        </div><div class="line">GPU1_Temp        | na         | degrees C  | na    | na        | na        | na        | 82.000    | 92.000    | na        </div><div class="line">MIC0_Temp        | na         | degrees C  | na    | na        | na        | na        | 104.000   | 114.000   | na        </div><div class="line">MIC1_Temp        | na         | degrees C  | na    | na        | na        | na        | 104.000   | 114.000   | na        </div><div class="line">SYS_VCCIO        | 0.950      | Volts      | ok    | 0.690     | 0.770     | 0.850     | 1.170     | 1.250     | 1.330     </div><div class="line">SYS_12V          | 12.126     | Volts      | ok    | 9.024     | 9.776     | 10.528    | 13.536    | 14.288    | 15.040    </div><div class="line">SYS_3.3V         | 3.360      | Volts      | ok    | 2.660     | 2.800     | 2.940     | 3.658     | 3.798     | 3.938     </div><div class="line">SYS_5V           | 5.220      | Volts      | ok    | 3.888     | 4.176     | 4.464     | 5.544     | 5.832     | 6.120     </div><div class="line">PCH_P1V05        | 1.050      | Volts      | ok    | 0.770     | 0.850     | 0.930     | 1.170     | 1.250     | 1.330     </div><div class="line">PCH_P1V5         | 1.540      | Volts      | ok    | 1.180     | 1.260     | 1.340     | 1.670     | 1.750     | 1.830     </div><div class="line">CPU0_VCORE       | 1.770      | Volts      | ok    | 1.040     | 1.120     | 1.200     | 2.300     | 2.380     | 2.460     </div><div class="line">CPU1_VCORE       | 1.780      | Volts      | ok    | 1.040     | 1.120     | 1.200     | 2.300     | 2.380     | 2.460     </div><div class="line">CPU0_DDR_VDDQAB  | 1.210      | Volts      | ok    | 0.910     | 0.990     | 1.070     | 1.330     | 1.410     | 1.490     </div><div class="line">CPU0_DDR_VDDQCD  | 1.230      | Volts      | ok    | 0.910     | 0.990     | 1.070     | 1.330     | 1.410     | 1.490     </div><div class="line">CPU1_DDR_VDDQEF  | 1.230      | Volts      | ok    | 0.910     | 0.990     | 1.070     | 1.330     | 1.410     | 1.490     </div><div class="line">CPU1_DDR_VDDQGH  | 1.220      | Volts      | ok    | 0.910     | 0.990     | 1.070     | 1.330     | 1.410     | 1.490     </div><div class="line">FAN_0            | 5760.000   | RPM        | ok    | na        | 0.000     | na        | na        | na        | na        </div><div class="line">FAN_1            | na         | RPM        | na    | na        | 0.000     | na        | na        | na        | na        </div><div class="line">FAN_2            | 5760.000   | RPM        | ok    | na        | 0.000     | na        | na        | na        | na        </div><div class="line">FAN_3            | na         | RPM        | na    | na        | 0.000     | na        | na        | na        | na        </div><div class="line">FAN_4            | 5952.000   | RPM        | ok    | na        | 0.000     | na        | na        | na        | na        </div><div class="line">FAN_5            | na         | RPM        | na    | na        | 0.000     | na        | na        | na        | na        </div><div class="line">FAN_6            | 5952.000   | RPM        | ok    | na        | 0.000     | na        | na        | na        | na        </div><div class="line">FAN_7            | na         | RPM        | na    | na        | 0.000     | na        | na        | na        | na        </div><div class="line">CPU0_Status      | 0x0        | discrete   | 0x8080| na        | na        | na        | na        | na        | na        </div><div class="line">CPU1_Status      | 0x0        | discrete   | 0x8080| na        | na        | na        | na        | na        | na        </div><div class="line">MEM_CHA0_Status  | 0x0        | discrete   | 0x4080| na        | na        | na        | na        | na        | na        </div><div class="line">MEM_CHA1_Status  | 0x0        | discrete   | 0x4080| na        | na        | na        | na        | na        | na        </div><div class="line">MEM_CHA2_Status  | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">MEM_CHB0_Status  | 0x0        | discrete   | 0x4080| na        | na        | na        | na        | na        | na        </div><div class="line">MEM_CHB1_Status  | 0x0        | discrete   | 0x4080| na        | na        | na        | na        | na        | na        </div><div class="line">MEM_CHB2_Status  | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">MEM_CHC0_Status  | 0x0        | discrete   | 0x4080| na        | na        | na        | na        | na        | na        </div><div class="line">MEM_CHC1_Status  | 0x0        | discrete   | 0x4080| na        | na        | na        | na        | na        | na        </div><div class="line">MEM_CHC2_Status  | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">MEM_CHD0_Status  | 0x0        | discrete   | 0x4080| na        | na        | na        | na        | na        | na        </div><div class="line">MEM_CHD1_Status  | 0x0        | discrete   | 0x4080| na        | na        | na        | na        | na        | na        </div><div class="line">MEM_CHD2_Status  | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">MEM_CHE0_Status  | 0x0        | discrete   | 0x4080| na        | na        | na        | na        | na        | na        </div><div class="line">MEM_CHE1_Status  | 0x0        | discrete   | 0x4080| na        | na        | na        | na        | na        | na        </div><div class="line">MEM_CHE2_Status  | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">MEM_CHF0_Status  | 0x0        | discrete   | 0x4080| na        | na        | na        | na        | na        | na        </div><div class="line">MEM_CHF1_Status  | 0x0        | discrete   | 0x4080| na        | na        | na        | na        | na        | na        </div><div class="line">MEM_CHF2_Status  | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">MEM_CHG0_Status  | 0x0        | discrete   | 0x4080| na        | na        | na        | na        | na        | na        </div><div class="line">MEM_CHG1_Status  | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">MEM_CHG2_Status  | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">MEM_CHH0_Status  | 0x0        | discrete   | 0x4080| na        | na        | na        | na        | na        | na        </div><div class="line">MEM_CHH1_Status  | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">MEM_CHH2_Status  | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">HDD0_Status      | 0x0        | discrete   | 0x0180| na        | na        | na        | na        | na        | na        </div><div class="line">HDD1_Status      | 0x0        | discrete   | 0x0180| na        | na        | na        | na        | na        | na        </div><div class="line">HDD2_Status      | 0x0        | discrete   | 0x0180| na        | na        | na        | na        | na        | na        </div><div class="line">HDD3_Status      | 0x0        | discrete   | 0x0180| na        | na        | na        | na        | na        | na        </div><div class="line">HDD4_Status      | 0x0        | discrete   | 0x0180| na        | na        | na        | na        | na        | na        </div><div class="line">HDD5_Status      | 0x0        | discrete   | 0x0180| na        | na        | na        | na        | na        | na        </div><div class="line">HDD6_Status      | 0x0        | discrete   | 0x0180| na        | na        | na        | na        | na        | na        </div><div class="line">HDD7_Status      | 0x0        | discrete   | 0x0180| na        | na        | na        | na        | na        | na        </div><div class="line">HDD8_Status      | 0x0        | discrete   | 0x0180| na        | na        | na        | na        | na        | na        </div><div class="line">HDD9_Status      | 0x0        | discrete   | 0x0180| na        | na        | na        | na        | na        | na        </div><div class="line">HDD10_Status     | 0x0        | discrete   | 0x0180| na        | na        | na        | na        | na        | na        </div><div class="line">HDD11_Status     | 0x0        | discrete   | 0x0180| na        | na        | na        | na        | na        | na        </div><div class="line">HDD12_Status     | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">HDD13_Status     | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">HDD14_Status     | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">HDD15_Status     | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">HDD16_Status     | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">HDD17_Status     | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">HDD18_Status     | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">HDD19_Status     | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">HDD20_Status     | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">HDD21_Status     | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">HDD22_Status     | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">HDD23_Status     | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">HDD24_Status     | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">HDD0_Rear_Status | 0x0        | discrete   | 0x0180| na        | na        | na        | na        | na        | na        </div><div class="line">HDD1_Rear_Status | 0x0        | discrete   | 0x0180| na        | na        | na        | na        | na        | na        </div><div class="line">HDD2_Rear_Status | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">HDD3_Rear_Status | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">Total_Power      | 335.000    | Watts      | ok    | na        | na        | na        | na        | na        | na        </div><div class="line">PSU0_Supply      | 0x0        | discrete   | 0x0180| na        | na        | na        | na        | na        | na        </div><div class="line">PSU1_Supply      | 0x0        | discrete   | 0x0180| na        | na        | na        | na        | na        | na        </div><div class="line">PSU0_Unit        | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">PSU1_Unit        | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">EventLog         | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">ME_FW_Status     | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">BMC_Boot_Up      | 0x0        | discrete   | 0x0280| na        | na        | na        | na        | na        | na        </div><div class="line">IPMI_Watchdog    | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">RISER0_Temp      | 48.000     | degrees C  | ok    | na        | na        | na        | na        | na        | na        </div><div class="line">RISER1_Temp      | na         | degrees C  | na    | na        | na        | na        | na        | na        | na        </div><div class="line">HDD_REAR0_Temp   | 36.000     | degrees C  | ok    | na        | na        | na        | 60.000    | 70.000    | na        </div><div class="line">HDD_REAR1_Temp   | na         | degrees C  | na    | na        | na        | na        | 60.000    | 70.000    | na        </div><div class="line">NVME_0_Status    | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">NVME_1_Status    | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">NVME_2_Status    | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">NVME_3_Status    | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">NVME_4_Status    | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">NVME_5_Status    | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">NVME_6_Status    | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">NVME_7_Status    | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na        </div><div class="line">All_Unit_Status  | 0x0        | discrete   | 0x0080| na        | na        | na        | na        | na        | na</div></pre></td></tr></table></figure><h1 id="Zabbix-web界面添加主机"><a href="#Zabbix-web界面添加主机" class="headerlink" title="Zabbix web界面添加主机"></a>Zabbix web界面添加主机</h1><p><img src="\images\2019\0729\02.png" alt="01"></p><p><img src="\images\2019\0729\03.png" alt="01"></p><p><img src="\images\2019\0729\04.png" alt="01"></p><h1 id="修改模板，添加监控项"><a href="#修改模板，添加监控项" class="headerlink" title="修改模板，添加监控项"></a>修改模板，添加监控项</h1><p>由于默认自带的模板很多监控项获取不到数据，这里我手动监测一下传感器，自己把传感器能获取的数据添加到模板里去</p><p><code>ipmitool -I lanplus -H 10.206.2.52 -U admin -P admin sensor list</code><br><img src="\images\2019\0729\05.png" alt="01"></p><p><code>ipmitool -I lanplus -H 10.206.2.52 -U admin -P admin sensor get &quot;CPU0_Temp&quot;</code></p><p><img src="\images\2019\0729\06.png" alt="01"></p><p><img src="\images\2019\0729\07.png" alt="01"></p><p><img src="\images\2019\0729\08.png" alt="01"></p><h1 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h1><p>打印当前 BMC 配置</p><p><code>ipmitool lan print 1</code></p><p>使用静态IP地址</p><p><code>ipmitool lan set 1 ipsrc static</code></p><p>设置 IP</p><p><code>ipmitool lan set 1 ipaddr 172.16.10.205</code>      </p><p>设置掩码</p><p><code>ipmitool lan set 1 netmask 255.255.0.0</code>  </p><p><code>ipmitool lan set 1 access on</code></p><p>配置网关</p><p><code>ipmitool lan set 1 defgw ipaddr 172.16.10.1</code><br>列出当前用户列表</p><p><code>ipmitool user list 1</code></p><p>其中 2 为要设置密原的用户 ID 号，设置密码为 111.com</p><p><code>ipmitool user set password 2 “111.com”</code></p><p>重启BMC</p><p><code>ipmitool   -H 10.206.2.52   -U  admin  -P  admin  -I  lanplus   mc reset warm</code></p><p>参考资料: <a href="https://www.cnblogs.com/kaishirenshi/p/9703127.html" target="_blank" rel="external">https://www.cnblogs.com/kaishirenshi/p/9703127.html</a></p>]]></content>
      
      
      <categories>
          
          <category> 监控 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> zabbix </tag>
            
            <tag> 监控 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>jenkins插件“Publish Over SSH”拷贝文件到远程服务器并执行脚本</title>
      <link href="/arlo/e68b6718/"/>
      <url>/arlo/e68b6718/</url>
      
        <content type="html"><![CDATA[<p>之前的java项目打出来的是war包，通过插件”Deploy to container”部署到tomcat下，近期项目组使用到spring boot项目，打出来的是jar包，需要远程发布，网上找了下，基本上都是通过”Publish Over SSH”插件，将jar包拷贝到远程服务器上，然后通过执行shell脚本启动jar项目，这里记录一下过程。<br><a id="more"></a></p><h1 id="安装-Publish-Over-SSH-插件"><a href="#安装-Publish-Over-SSH-插件" class="headerlink" title="安装 Publish Over SSH 插件"></a>安装 Publish Over SSH 插件</h1><p>Manage Jenkins –&gt;Manage Plugins–&gt;可选插件–&gt;Publish Over SSH–&gt;直接安装</p><h1 id="添加Linux主机"><a href="#添加Linux主机" class="headerlink" title="添加Linux主机"></a>添加Linux主机</h1><p>Manage Jenkins –&gt;Configure System –&gt;Publish Over SSH<br>这这里我们需要设置远程主机相关信息，如主机名，用户，密码，远程主机目录；高级选项选项中，我们可以选择key和密码两种方式访问远程linux主机，还可以设置跳转机<br><img src="\images\2019\0714\01.png" alt="02"></p><h1 id="构建项目"><a href="#构建项目" class="headerlink" title="构建项目"></a>构建项目</h1><p>构建一个maven项目，其他信息和之前的一样，配置好svn地址，相关用户获取代码。<br>Build阶段参数设置为：<code>-e clean package -Dmaven.test.skip=true</code><br><img src="\images\2019\0714\02.png" alt="02"><br><img src="\images\2019\0714\03.png" alt="02"><br><strong>Source Files</strong>：需要发布的jar包位置，需要写相对（当前项目目录）路径；如：当前项目名称是monitor-cloud，jar包的位置是/var/lib/jenkins/workspace/monitor-cloud/monitor-gateway/target/monitor-gateway.jar，在Source Files填写 monitor-gateway/target/monitor-gateway.jar即可<br><strong>Remove prefix</strong>：表示需要移除的目录，比如这里填写monitor-gateway/target，则表示发布时，只把monitor-gateway.jar.jar发布到远程linux，而不包含monitor-gateway/target目录结构<br><strong>Remote directory</strong>：表示需要把编译好的war包发布到远程linux的哪个目录下 (我刚才在全局属性里设置了，这里就留空了)<br><strong>Exec command</strong>：需要执行的shell命令，shell命令在远程linux服务器上.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">echo &quot;deploy monitor-gateway.jar&quot;</div><div class="line"> </div><div class="line">pid=`ps -ef|grep monitor-gateway|grep -v grep|awk &apos;&#123;print $2&#125;&apos;`</div><div class="line"> </div><div class="line">if [ -n &quot;$pid&quot; ]</div><div class="line">    then</div><div class="line">    echo &apos;The pid: server&apos; $pid &apos; will be killed....&apos;</div><div class="line">    kill -9 $pid</div><div class="line">    echo &apos;The pid: server&apos; $pid &apos; will be start&apos;</div><div class="line">    nohup /usr/local/jdk1.8.0_202/bin/java -jar /usr/local/ths/monitor-gateway.jar &gt;  /dev/null &amp; </div><div class="line">else</div><div class="line">    echo &apos;The pid: server&apos; $pid &apos; not exist , will be start&apos;</div><div class="line">    nohup /usr/local/jdk1.8.0_202/bin/java -jar /usr/local/ths/monitor-gateway.jar &gt;  /dev/null &amp;</div><div class="line">fi</div><div class="line">    echo &apos;The pid: server&apos; $pid &apos; started&apos;</div></pre></td></tr></table></figure><p>参考：<a href="https://blog.csdn.net/l848168/article/details/85261514" target="_blank" rel="external">https://blog.csdn.net/l848168/article/details/85261514</a></p>]]></content>
      
      
      <categories>
          
          <category> 自动化运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Jenkins </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>持续检测端口连通性</title>
      <link href="/arlo/50806164/"/>
      <url>/arlo/50806164/</url>
      
        <content type="html"><![CDATA[<p>一个地址端口有时候可以通，有时候不行，telnet只能检测某一时刻的连通状态；为了持续检测，我这边写了一个shell脚本，内容如下。</p><a id="more"></a><h1 id="编写一个非交互式shell检测脚本"><a href="#编写一个非交互式shell检测脚本" class="headerlink" title="编写一个非交互式shell检测脚本"></a>编写一个非交互式shell检测脚本</h1><p><code>vim check_port.sh</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line">IP=&apos;192.168.100.130&apos;</div><div class="line">PORT_LIST=&quot;22 8080&quot;</div><div class="line">TIME_STAMP=`date &quot;+%Y-%m-%d %T&quot;`</div><div class="line">for PORT in $PORT_LIST</div><div class="line">do</div><div class="line">    RESULT=`echo &quot;&quot; | telnet $IP $PORT 2&gt;/dev/null | grep &quot;]&quot; | wc -l`</div><div class="line">    if [ $RESULT -eq 1 ];then</div><div class="line">        echo &quot;$TIME_STAMP $IP的$PORT端口可以连通&quot; &gt;&gt; /tmp/1.txt</div><div class="line">    else </div><div class="line">        echo &quot;$TIME_STAMP $IP的$PORT端口不能连通&quot; &gt;&gt; /tmp/1.txt</div><div class="line">    fi</div><div class="line">done</div></pre></td></tr></table></figure><h1 id="添加执行权限"><a href="#添加执行权限" class="headerlink" title="添加执行权限"></a>添加执行权限</h1><p><code>chmod +x /opt/check_post.sh</code></p><h1 id="使用crontab定时执行脚本"><a href="#使用crontab定时执行脚本" class="headerlink" title="使用crontab定时执行脚本"></a>使用crontab定时执行脚本</h1><p><code>crontab -l</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">*/5 * * * * /opt/check_post.sh</div></pre></td></tr></table></figure><p>参考：<a href="https://www.jianshu.com/p/92adf516a62d" target="_blank" rel="external">https://www.jianshu.com/p/92adf516a62d</a></p>]]></content>
      
      
      <categories>
          
          <category> 监控 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 监控 </tag>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>OpenVPN使用用户名密码验证登录</title>
      <link href="/arlo/b525080b/"/>
      <url>/arlo/b525080b/</url>
      
        <content type="html"><![CDATA[<p>书接上文，咱们说到<a href="http://islocal.cc/arlo/fd972502/">Centos7下OpenVpn服务器搭建</a> ，使用证书验证，如果偷懒多人使用同一个证书，感觉不是很安全，如果新建多个账号，也不是很方便，所以想着使用用户名密码去验证。使用用户名密码验证的常见做法有两种，一种是借助<code>pam_mysql.so</code>,另一种是使用<code>checkpsw</code>方式，本文使用第二种方式，比较简单。搭建过程和上文基本一样，只需要创建服务器端证书，不需要客户端证书。<br><a id="more"></a></p><h1 id="修改服务端配置文件"><a href="#修改服务端配置文件" class="headerlink" title="修改服务端配置文件"></a>修改服务端配置文件</h1><p>修改服务器端配置文件<code>vim /etc/openvpn/server.conf</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">local 192.168.6.23</div><div class="line">port 11094</div><div class="line">proto tcp</div><div class="line">dev tun</div><div class="line"></div><div class="line">ca /etc/openvpn/certs/ca.crt</div><div class="line">cert /etc/openvpn/certs/server.crt</div><div class="line">key /etc/openvpn/certs/server.key</div><div class="line">dh /etc/openvpn/certs/dh.pem</div><div class="line">tls-auth ta.key 0</div><div class="line">cipher AES-256-GCM</div><div class="line"></div><div class="line">ifconfig-pool-persist /etc/openvpn/ipp.txt</div><div class="line">#以下四行配置文件未新添加的的</div><div class="line">auth-user-pass-verify /etc/openvpn/checkpsw.sh via-env</div><div class="line">verify-client-cert none</div><div class="line">username-as-common-name</div><div class="line">script-security 3</div><div class="line"></div><div class="line">server 10.66.66.0 255.255.255.0</div><div class="line">push &quot;route 192.168.6.0 255.255.255.0&quot;</div><div class="line">push &quot;route 192.168.10.0 255.255.255.0&quot;</div><div class="line">#push &quot;redirect-gateway def1 bypass-dhcp&quot;</div><div class="line">push &quot;dhcp-option DNS 223.5.5.5&quot;</div><div class="line">push &quot;dhcp-option DNS 223.6.6.6&quot;</div><div class="line">topology subnet</div><div class="line">client-to-client</div><div class="line"></div><div class="line">keepalive 20 120</div><div class="line">comp-lzo</div><div class="line">duplicate-cn</div><div class="line">user openvpn</div><div class="line">group openvpn</div><div class="line">persist-key</div><div class="line">persist-tun</div><div class="line">status openvpn-status.log</div><div class="line">log-append  openvpn.log</div><div class="line">verb 3</div><div class="line">mute 20</div></pre></td></tr></table></figure></p><h1 id="新建一个key"><a href="#新建一个key" class="headerlink" title="新建一个key"></a>新建一个key</h1><p>tls-auth 在 SSL/TLS 握手包的基础上增加了额外的签名，以提供更高的安全性<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">openvpn --genkey --secret /etc/openvpn/ta.key</div></pre></td></tr></table></figure></p><h1 id="新建shell脚本"><a href="#新建shell脚本" class="headerlink" title="新建shell脚本"></a>新建shell脚本</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">#!/bin/sh</div><div class="line">###########################################################</div><div class="line"># checkpsw.sh (C) 2004 Mathias Sundman &lt;mathias@openvpn.se&gt;</div><div class="line">#</div><div class="line"># This script will authenticate OpenVPN users against</div><div class="line"># a plain text file. The passfile should simply contain</div><div class="line"># one row per user with the username first followed by</div><div class="line"># one or more space(s) or tab(s) and then the password.</div><div class="line">PASSFILE=&quot;/etc/openvpn/psw-file&quot;</div><div class="line">LOG_FILE=&quot;/etc/openvpn/openvpn-password.log&quot;</div><div class="line">TIME_STAMP=`date &quot;+%Y-%m-%d %T&quot;`</div><div class="line">###########################################################</div><div class="line">if [ ! -r &quot;$&#123;PASSFILE&#125;&quot; ]; then</div><div class="line">  echo &quot;$&#123;TIME_STAMP&#125;: Could not open password file \&quot;$&#123;PASSFILE&#125;\&quot; for reading.&quot; &gt;&gt; $&#123;LOG_FILE&#125;</div><div class="line">  exit 1</div><div class="line">fi</div><div class="line">CORRECT_PASSWORD=`awk &apos;!/^;/&amp;&amp;!/^#/&amp;&amp;$1==&quot;&apos;$&#123;username&#125;&apos;&quot;&#123;print $2;exit&#125;&apos; $&#123;PASSFILE&#125;`</div><div class="line">if [ &quot;$&#123;CORRECT_PASSWORD&#125;&quot; = &quot;&quot; ]; then</div><div class="line">  echo &quot;$&#123;TIME_STAMP&#125;: User does not exist: username=\&quot;$&#123;username&#125;\&quot;, password=\&quot;$&#123;password&#125;\&quot;.&quot; &gt;&gt; $&#123;LOG_FILE&#125;</div><div class="line">  exit 1</div><div class="line">fi</div><div class="line">if [ &quot;$&#123;password&#125;&quot; = &quot;$&#123;CORRECT_PASSWORD&#125;&quot; ]; then</div><div class="line">  echo &quot;$&#123;TIME_STAMP&#125;: Successful authentication: username=\&quot;$&#123;username&#125;\&quot;.&quot; &gt;&gt; $&#123;LOG_FILE&#125;</div><div class="line">  exit 0</div><div class="line">fi</div><div class="line">echo &quot;$&#123;TIME_STAMP&#125;: Incorrect password: username=\&quot;$&#123;username&#125;\&quot;, password=\&quot;$&#123;password&#125;\&quot;.&quot; &gt;&gt; $&#123;LOG_FILE&#125;</div><div class="line">exit 1</div></pre></td></tr></table></figure><p>赋予脚本权限<br><code>chmod 755 checkpsw.sh</code></p><h1 id="新建用户密码配置文件psw-file"><a href="#新建用户密码配置文件psw-file" class="headerlink" title="新建用户密码配置文件psw-file"></a>新建用户密码配置文件psw-file</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#用户名  密码</div><div class="line">ths1    123456</div><div class="line">ths2123456</div><div class="line">ths3123456</div></pre></td></tr></table></figure><p><code>chmod 600 /etc/openvpn/psw-file</code><br><code>chown openvpn.openvpn /etc/openvpn/psw-file</code><br><code>touch /etc/openvpn/openvpn-password.log</code><br><code>chown openvpn.openvpn /etc/openvpn/openvpn-password.log</code><br><code>chmod 644 /etc/openvpn/openvpn-password.log</code></p><h1 id="重启服务"><a href="#重启服务" class="headerlink" title="重启服务"></a>重启服务</h1><p><code>systemctl restart openvpn@server</code><br><code>systemctl enable openvpn@server</code></p><h1 id="客户端测试"><a href="#客户端测试" class="headerlink" title="客户端测试"></a>客户端测试</h1><p>编辑<code>C:\Program Files\OpenVPN\config\sx3.ovpn</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">client   </div><div class="line">proto tcp  </div><div class="line">dev tun    </div><div class="line">remote 192.168.6.23 11094</div><div class="line">ca ca.crt     </div><div class="line">auth-user-pass#使用密码验证，主要是这行</div><div class="line">tls-auth ta.key 1</div><div class="line">cipher AES-256-GCM</div><div class="line">resolv-retry infinite</div><div class="line">nobind</div><div class="line">mute-replay-warnings</div><div class="line">keepalive 20 120</div><div class="line">comp-lzo</div><div class="line">#user openvpn</div><div class="line">#group openvpn</div><div class="line">persist-key</div><div class="line">persist-tun</div><div class="line">status openvpn-status.log</div><div class="line">log-append openvpn.log</div><div class="line">verb 3</div><div class="line">mute 20</div><div class="line">route-method exe</div><div class="line">route-delay 2</div><div class="line"></div><div class="line">&lt;ca&gt;</div><div class="line">-----BEGIN CERTIFICATE-----</div><div class="line">……ABCDEFG……</div><div class="line">-----END CERTIFICATE-----</div><div class="line">&lt;/ca&gt;</div><div class="line">&lt;tls-auth&gt;</div><div class="line">#</div><div class="line"># 2048 bit OpenVPN static key</div><div class="line">#</div><div class="line">-----BEGIN OpenVPN Static key V1-----</div><div class="line">……ABCDEFG……</div><div class="line">-----END OpenVPN Static key V1-----</div><div class="line">&lt;/tls-auth&gt;</div></pre></td></tr></table></figure></p><h1 id="客户端测试-1"><a href="#客户端测试-1" class="headerlink" title="客户端测试"></a>客户端测试</h1><p><img src="\images\2019\0514\01.png" alt="01"><br><img src="\images\2019\0514\02.png" alt="02"></p>]]></content>
      
      
      
    </entry>
    
    <entry>
      <title>fping批量检测主机存活</title>
      <link href="/arlo/52a5c096/"/>
      <url>/arlo/52a5c096/</url>
      
        <content type="html"><![CDATA[<p><strong>fping</strong>是一个小型命令行工具，用于向网络主机发送<strong>ICMP</strong> （ <strong>Internet控制消息协议</strong> ）回应请求，类似于ping，但在ping多个主机时性能要高得多。 fping完全不同于ping，因为您可以在命令行上定义任意数量的主机，或者指定包含要ping的IP地址或主机列表的文件。<br><a id="more"></a></p><h1 id="windows环境"><a href="#windows环境" class="headerlink" title="windows环境"></a>windows环境</h1><p>我在<a href="https://fping.org/" target="_blank" rel="external">fping官网</a>没找到下载地址，可以从这里下载：<a href="http://blog.perceptus.ca/wp-content/uploads/2017/11/fping300.zip" target="_blank" rel="external">http://blog.perceptus.ca/wp-content/uploads/2017/11/fping300.zip</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">-g  ping一个区间范围</div><div class="line">-H  ping文本里的ip地址</div><div class="line">-L  将结果输出到文本中</div><div class="line">-D  打印日期（年月日）</div><div class="line">-T  打印时间戳（时分秒）</div></pre></td></tr></table></figure><h2 id="ping一个区间范围"><a href="#ping一个区间范围" class="headerlink" title="ping一个区间范围"></a>ping一个区间范围</h2><p><code>ping -g 172.16.10.1/172.16.10.254</code></p><h2 id="ping-文件"><a href="#ping-文件" class="headerlink" title="ping 文件"></a>ping 文件</h2><p><code>fping -D -T -H d:\172.txt -L d:\1.txt</code></p><h1 id="Linux（centos）环境"><a href="#Linux（centos）环境" class="headerlink" title="Linux（centos）环境"></a>Linux（centos）环境</h1><p><code>yum -y install epel-release</code><br><code>yum -y install fping</code></p><h2 id="fping用法"><a href="#fping用法" class="headerlink" title="fping用法"></a>fping用法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">-a 仅显示存活主机</div><div class="line">-u 仅显示不存活主机</div><div class="line">-g 指定网段</div><div class="line">-f 指定文件</div><div class="line">-r 重复检测网段次数（一般和-g结合使用，-g -r 1）</div><div class="line">-C 检测主机次数</div><div class="line">-s 显示统计信息</div></pre></td></tr></table></figure><h2 id="ping多主机"><a href="#ping多主机" class="headerlink" title="ping多主机"></a>ping多主机</h2><p><code>fping www.baidu.com 163.com qq.com t.cn google.com facebook.com</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">www.baidu.com is alive</div><div class="line">163.com is alive</div><div class="line">qq.com is alive</div><div class="line">t.cn is alive</div><div class="line">google.com is unreachable</div><div class="line">facebook.com is unreachable</div></pre></td></tr></table></figure><h2 id="ping区间"><a href="#ping区间" class="headerlink" title="ping区间"></a>ping区间</h2><p><code>fping -C 1 -g 192.168.6.1 192.168.6.5</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">192.168.6.1 : [0], 84 bytes, 0.58 ms (0.58 avg, 0% loss)</div><div class="line">192.168.6.1 : 0.58</div><div class="line">192.168.6.2 : -</div><div class="line">192.168.6.3 : -</div><div class="line">192.168.6.4 : -</div><div class="line">192.168.6.5 : -</div></pre></td></tr></table></figure><h2 id="ping网段"><a href="#ping网段" class="headerlink" title="ping网段"></a>ping网段</h2><p><code>fping -g -r 1 192.168.6.0/24</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">192.168.6.1 is alive</div><div class="line">……</div><div class="line">192.168.6.121 is alive</div><div class="line">ICMP Host Unreachable from 192.168.6.23 for ICMP Echo sent to 192.168.6.2</div><div class="line">……</div><div class="line">ICMP Host Unreachable from 192.168.6.23 for ICMP Echo sent to 192.168.6.148</div><div class="line">192.168.6.2 is unreachable</div><div class="line">……</div><div class="line">192.168.6.252 is unreachable</div></pre></td></tr></table></figure></p><h2 id="ping文件"><a href="#ping文件" class="headerlink" title="ping文件"></a>ping文件</h2><p><code>cat 1.txt</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">192.168.1.1</div><div class="line">192.168.10.33</div><div class="line">223.5.5.5</div><div class="line">114.114.114.114</div><div class="line">221.11.1.67</div></pre></td></tr></table></figure></p><p><code>fping &lt; 1.txt</code><br><code>fping -f 1.txt</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">ICMP Time Exceeded from 192.168.0.253 for ICMP Echo sent to 192.168.1.1</div><div class="line">192.168.10.33 is alive</div><div class="line">114.114.114.114 is alive</div><div class="line">223.5.5.5 is alive</div><div class="line">221.11.1.67 is alive</div><div class="line">ICMP Time Exceeded from 192.168.0.253 for ICMP Echo sent to 192.168.1.1</div><div class="line">ICMP Time Exceeded from 192.168.0.253 for ICMP Echo sent to 192.168.1.1</div><div class="line">ICMP Time Exceeded from 192.168.0.253 for ICMP Echo sent to 192.168.1.1</div><div class="line">192.168.1.1 is unreachable</div></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Troubleshooting </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 监控 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Centos7下OpenVpn服务器搭建</title>
      <link href="/arlo/fd972502/"/>
      <url>/arlo/fd972502/</url>
      
        <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>项目实施过程中，远程访问服务器方式有windows远程桌面、VNC、盗版teamviewer，向日葵、anydesk，甚至还有qq远程桌面的，错综复杂，杂乱无章，项目上没有购置硬件vpn的预算，为了结束这一尴尬的局面，决定使用开源软件openvpn自建vpn环境。<br><a id="more"></a></p><h1 id="系统环境"><a href="#系统环境" class="headerlink" title="系统环境"></a>系统环境</h1><p><strong>OS</strong>：CentOS Linux release 7.4.1708 (Core)<br><strong>SELinux</strong>：disabled<br><strong>firewalld</strong>：active<br><strong>openvpn</strong>：2.4.7<br><strong>easy-rsa</strong>：3.0.3</p><h1 id="部署openvpn软件"><a href="#部署openvpn软件" class="headerlink" title="部署openvpn软件"></a>部署openvpn软件</h1><h2 id="安装openvpn-amp-easy-rsa-软件"><a href="#安装openvpn-amp-easy-rsa-软件" class="headerlink" title="安装openvpn &amp; easy-rsa 软件"></a>安装openvpn &amp; easy-rsa 软件</h2><p><code>yum install epel-release</code><br><code>yum install openvpn easy-rsa</code><br><code>cp -r /usr/share/easy-rsa/ /etc/openvpn/easy-rsa</code><br><code>cd /etc/openvpn/easy-rsa/3.0.3</code><br><code>cp /usr/share/doc/easy-rsa-3.0.3/vars.example vars</code></p><h1 id="创建证书"><a href="#创建证书" class="headerlink" title="创建证书"></a>创建证书</h1><h2 id="创建ca证书"><a href="#创建ca证书" class="headerlink" title="创建ca证书"></a>创建ca证书</h2><h3 id="编辑vars文件，根据自己的环境配置"><a href="#编辑vars文件，根据自己的环境配置" class="headerlink" title="编辑vars文件，根据自己的环境配置"></a>编辑vars文件，根据自己的环境配置</h3><p><em>ps:这一步不是必须滴，不填写也可以</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">set_var EASYRSA_REQ_COUNTRY    &quot;CN&quot;</div><div class="line">set_var EASYRSA_REQ_PROVINCE   &quot;ShaanXi&quot;</div><div class="line">set_var EASYRSA_REQ_CITY       &quot;Xi&apos;an&quot;</div><div class="line">set_var EASYRSA_REQ_ORG        &quot;islocal.cc&quot;</div><div class="line">set_var EASYRSA_REQ_EMAIL      &quot;xx@islocal.cc&quot;</div><div class="line">set_var EASYRSA_REQ_OU         &quot;My OpenVPN&quot;</div></pre></td></tr></table></figure></p><p><code>source /vars</code><br>进入<em>/etc/openvpn/easy-rsa/3.0.3</em>目录<br><img src="\images\2019\0428\01.png" alt="01"><br>目录初始化<br><code>./easyra init-pki</code><br>创建ca证书<br><code>./easyra build-ca nopass</code><br><img src="\images\2019\0428\02.png" alt="02"></p><h2 id="创建服务器证书和key"><a href="#创建服务器证书和key" class="headerlink" title="创建服务器证书和key"></a>创建服务器证书和key</h2><p><code>./easyrsa gen-req server nopass</code> #生成下列两个文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">req: /etc/openvpn/easy-rsa/3.0.3/pki/reqs/server.req</div><div class="line">key: /etc/openvpn/easy-rsa/3.0.3/pki/private/server.key</div></pre></td></tr></table></figure></p><p><img src="\images\2019\0428\03.png" alt="03"></p><h2 id="签约服务端证书"><a href="#签约服务端证书" class="headerlink" title="签约服务端证书"></a>签约服务端证书</h2><p>生成服务器证书文件<br><code>./easyrsa sign server server</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/etc/openvpn/easy-rsa/3.0.3/pki/issued/server.crt</div></pre></td></tr></table></figure></p><p><img src="\images\2019\0428\04.png" alt="04"></p><h2 id="生成vpn密钥协议交换文件"><a href="#生成vpn密钥协议交换文件" class="headerlink" title="生成vpn密钥协议交换文件"></a>生成vpn密钥协议交换文件</h2><p><code>./easyrsa gen-dh</code> #可以看到我们生成的是2048位的加密文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/etc/openvpn/easy-rsa/3.0.3/pki/dh.pem</div></pre></td></tr></table></figure></p><p><img src="\images\2019\0428\05.png" alt="05"></p><h2 id="创建客户端证书"><a href="#创建客户端证书" class="headerlink" title="创建客户端证书"></a>创建客户端证书</h2><p>拷贝easy-rsa到client目录下<br><code>cp -r /usr/share/easy-rsa/ /etc/openvpn/client/</code><br>初始化目录<br><code>./easyrsa init-pki</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/etc/openvpn/client/easy-rsa/3.0.3/pki</div></pre></td></tr></table></figure></p><p>新建用户，创建客户端证书<br><code>./easyrsa gen-req ths nopass</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">req: /etc/openvpn/client/easy-rsa/3.0.3/pki/reqs/ths.req</div><div class="line">key: /etc/openvpn/client/easy-rsa/3.0.3/pki/private/ths.key</div></pre></td></tr></table></figure></p><p><img src="\images\2019\0428\06.png" alt="06"></p><h2 id="签约客户端证书"><a href="#签约客户端证书" class="headerlink" title="签约客户端证书"></a>签约客户端证书</h2><p><font color="#FF0000"><strong>注意：返回到服务器目录下操作！！！</strong></font><br><code>cd /etc/openvpn/easy-rsa/3.0.3</code><br><code>./easyrsa import-req /etc/openvpn/client/easy-rsa/3.0.3/pki/reqs/ths.req ths</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/etc/openvpn/easy-rsa/3.0.3/pki/issued/ths.crt</div></pre></td></tr></table></figure></p><p><img src="\images\2019\0428\07.png" alt="07"></p><h2 id="整理一下所有证书"><a href="#整理一下所有证书" class="headerlink" title="整理一下所有证书"></a>整理一下所有证书</h2><h3 id="服务器端证书"><a href="#服务器端证书" class="headerlink" title="服务器端证书"></a>服务器端证书</h3><p><code>mkdir /etc/openvpn/certs</code><br><code>cd /etc/openvpn/certs</code><br><code>cp /etc/openvpn/easy-rsa/3.0.3/pki/ca.crt .</code><br><code>cp /etc/openvpn/easy-rsa/3.0.3/pki/dh.pem .</code><br><code>cp /etc/openvpn/easy-rsa/3.0.3/pki/issued/server.crt .</code><br><code>cp /etc/openvpn/easy-rsa/3.0.3/pki/private/server.key .</code></p><h3 id="客户端证书"><a href="#客户端证书" class="headerlink" title="客户端证书"></a>客户端证书</h3><p><code>mkdir /etc/openvpn/client/ths</code><br><code>cd /etc/openvpn/client/ths</code><br><code>cp /etc/openvpn/easy-rsa/3.0.3/pki/ca.crt .</code><br><code>cp /etc/openvpn/easy-rsa/3.0.3/pki/issued/ths.crt .</code><br><code>cp /etc/openvpn/client/easy-rsa/3.0.3/pki/private/ths.key .</code></p><h1 id="服务器端配置文件"><a href="#服务器端配置文件" class="headerlink" title="服务器端配置文件"></a>服务器端配置文件</h1><p><code>cat /etc/openvpn/server.conf</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">local 192.168.6.23#填写自己的openvpn服务器ip地址，默认侦听服务器上所有的ip</div><div class="line">port 11094#侦听端口，默认为1194，据说网上会过滤1194端口流量，我这里修改为11094</div><div class="line">proto tcp#端口协议，默认udp，开启tcp方便映射转发</div><div class="line">dev tun#创建一个路由ip隧道,路由模式有tun/tap</div><div class="line"></div><div class="line">ca /etc/openvpn/certs/ca.crt#根证书路径</div><div class="line">cert /etc/openvpn/certs/server.crt#证书</div><div class="line">key /etc/openvpn/certs/server.key#私钥文件（保密）</div><div class="line">dh /etc/openvpn/certs/dh.pem#协议交换文件</div><div class="line"></div><div class="line">ifconfig-pool-persist /etc/openvpn/ipp.txt #记录客户端和虚拟ip的对应关系。当重启OpenVPN时，再次连接的客户端将分配到与上一次分配相同的虚拟IP地址</div><div class="line">server 10.66.66.0 255.255.255.0#设置服务器端模式，并提供一个VPN子网，以便于从中为客户端分配IP地址。服务器会获取10.66.66.1 </div><div class="line">push &quot;route 192.168.6.0 255.255.255.0&quot;#推送路由信息到客户端，以允许客户端能够连接到服务器背后的其他私有子网。</div><div class="line">#push &quot;redirect-gateway def1 bypass-dhcp&quot; </div><div class="line"># 启用该指令，所有客户端的默认网关都将重定向到VPN，这将导致诸如web浏览器、DNS查询等所有客户端流量都经过VPN。</div><div class="line">push &quot;dhcp-option DNS 223.5.5.5&quot;</div><div class="line">push &quot;dhcp-option DNS 223.6.6.6&quot;</div><div class="line">client-to-client#允许拨号连接vpn的客户端之间相互通信</div><div class="line">keepalive 10 120# 默认每10秒钟ping一次，如果120秒内都没有收到对方的回复，则表示远程连接已经关闭</div><div class="line">comp-lzo# 在VPN连接上启用压缩。如果你在此处启用了该指令，那么也应该在每个客户端配置文件中启用它。</div><div class="line">#duplicate-cn#打开后允许多个客户端使用同一个帐号连接</div><div class="line">user openvpn</div><div class="line">group openvpn</div><div class="line">max-clients 100</div><div class="line">persist-key</div><div class="line">persist-tun#通过keepalive检测vpn超时后，当重新启动vpn后，保持tun或者tap设备自动连接状态</div><div class="line">status openvpn-status.log# 状态日志</div><div class="line">log-append  openvpn.log</div><div class="line">verb 1#指定日志文件冗余</div><div class="line"># 为日志文件设置适当的冗余级别(0~9)。冗余级别越高，输出的信息越详细。</div><div class="line"># 0 表示静默运行，只记录致命错误。</div><div class="line"># 4 表示合理的常规用法。</div><div class="line"># 5 和 6 可以帮助调试连接错误。</div><div class="line"># 9 表示极度冗余，输出非常详细的日志信息。</div><div class="line">mute 20#相同类别的信息只有前20条会输出到日志文件中。</div></pre></td></tr></table></figure></p><h2 id="启动openvpn服务"><a href="#启动openvpn服务" class="headerlink" title="启动openvpn服务"></a>启动openvpn服务</h2><p><code>systemctl start openvpn@server</code><br>启动服务器后，我们可以监控/etc/openvpn/openvpn.log日志，如果有异常，可根据日志排查。<br>我们查看一下ip地址，可以看到tun0获取到的是10.66.66.1<br><img src="\images\2019\0428\08.png" alt="08"></p><h2 id="设置开机自启动服务"><a href="#设置开机自启动服务" class="headerlink" title="设置开机自启动服务"></a>设置开机自启动服务</h2><p><code>systemctl enable openvpn@server</code></p><h1 id="防火墙策略"><a href="#防火墙策略" class="headerlink" title="防火墙策略"></a>防火墙策略</h1><h2 id="开启内核路由转发"><a href="#开启内核路由转发" class="headerlink" title="开启内核路由转发"></a>开启内核路由转发</h2><p><code>echo &quot;net.ipv4.ip_forward = 1&quot; &gt;&gt; /etc/sysctl.conf</code><br><code>sysctl -p</code></p><h2 id="开放vpn监听端口"><a href="#开放vpn监听端口" class="headerlink" title="开放vpn监听端口"></a>开放vpn监听端口</h2><p><code>firewall-cmd --zone=public --add-port=11094/tcp --permanent</code><br><code>firewall-cmd --permanent --zone=public --add-masquerade</code><br><code>firewall-cmd --permanent --zone=public --add-rich-rule=&#39;rule family=ipv4 source address=10.66.66.0/24 masquerade&#39;</code><br><code>firewall-cmd --reload</code></p><h1 id="客户端测试"><a href="#客户端测试" class="headerlink" title="客户端测试"></a>客户端测试</h1><h2 id="安装Windows客户端"><a href="#安装Windows客户端" class="headerlink" title="安装Windows客户端"></a>安装Windows客户端</h2><p><code>https://build.openvpn.net/downloads/releases/openvpn-install-2.4.7-I607-Win7.exe</code><br><code>https://build.openvpn.net/downloads/releases/openvpn-install-2.4.7-I607-Win10.exe</code><br>将/etc/openvpn/client/ths目录下的ca.crt、ths.crt、ths.key复制到“C:\Program Files\OpenVPN\config”目录下<br>在此目录下新建一个client.ovpn文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">client   </div><div class="line">proto tcp  </div><div class="line">dev tun    </div><div class="line">remote 192.168.6.23 11094</div><div class="line">ca ca.crt   </div><div class="line">cert ths.crt</div><div class="line">key ths.key      </div><div class="line">resolv-retry infinite</div><div class="line">nobind</div><div class="line">mute-replay-warnings</div><div class="line">keepalive 20 120</div><div class="line">comp-lzo</div><div class="line">#user openvpn</div><div class="line">#group openvpn</div><div class="line">persist-key</div><div class="line">persist-tun</div><div class="line">status openvpn-status.log</div><div class="line">log-append openvpn.log</div><div class="line">verb 3</div><div class="line">mute 20</div></pre></td></tr></table></figure></p><p>使用管理员权限启动“OpenVPN GUI”<br><img src="\images\2019\0428\09.png" alt="09"><br><img src="\images\2019\0428\10.png" alt="10"></p><p>参考链接:<br><a href="https://build.openvpn.net/downloads/releases/" target="_blank" rel="external">https://build.openvpn.net/downloads/releases/</a><br><a href="https://www.cnblogs.com/irockcode/p/7587421.html" target="_blank" rel="external">https://www.cnblogs.com/irockcode/p/7587421.html</a><br><a href="https://www.cnblogs.com/tielemao/p/9603696.html" target="_blank" rel="external">https://www.cnblogs.com/tielemao/p/9603696.html</a></p>]]></content>
      
      
      
    </entry>
    
    <entry>
      <title>fio 存储性能测试</title>
      <link href="/arlo/687d8f2c/"/>
      <url>/arlo/687d8f2c/</url>
      
        <content type="html"><![CDATA[<h1 id="测试环境"><a href="#测试环境" class="headerlink" title="测试环境"></a>测试环境</h1><table><thead><tr><th style="text-align:left">硬件环境</th><th></th></tr></thead><tbody><tr><td style="text-align:left">CPU</td><td>Intel(R) Xeon(R) Gold 5120 CPU @ 2.20GHz * 4  (逻辑cpu112核)</td></tr><tr><td style="text-align:left">内存</td><td>256GB</td></tr><tr><td style="text-align:left">磁盘</td><td>数普DS5760，单块10TB 7200RPM NL-SAS磁盘，划分3个RAID6 lun ，通过56GB InfiniBand网络挂载到操作系统</td></tr><tr><td style="text-align:left"><strong>软件环境</strong></td><td></td></tr><tr><td style="text-align:left">操作系统</td><td>CentOS Linux release 7.5.1804</td></tr><tr><td style="text-align:left">测试软件</td><td>fio-3.1</td></tr></tbody></table><blockquote><p><font color="#FF0000"><strong>友情提示：性能测试建议直接通过写裸盘的方式进行测试（systemrescuecd+fio），会得到较为真实的数据。但直接测试裸盘会破坏文件系统结构，导致数据丢失，请在测试前确认磁盘中数据已备份；</strong></font><br><a id="more"></a></p></blockquote><h1 id="dd-测试"><a href="#dd-测试" class="headerlink" title="dd 测试"></a>dd 测试</h1><p>首先使用dd简单的测试一下写入速度<br><code>dd if=/dev/zero of=/opt/file1 bs=1M count=102400</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># dd if=/dev/zero of=/opt/file1 bs=1M count=102400 </div><div class="line">102400+0 records in</div><div class="line">102400+0 records out</div><div class="line">107374182400 bytes (107 GB) copied, 70.5689 s, 1.5 GB/s</div></pre></td></tr></table></figure></p><h1 id="fio安装"><a href="#fio安装" class="headerlink" title="fio安装"></a>fio安装</h1><p>为了看到更详细，更精准的存储性能，我们选用fio作为测试工具；<br>fio 是测试 IOPS 的非常好的工具，用来对硬件进行压力测试和验证，支持 19种不同的 I/O 引擎，包括: sync,mmap, libaio, posixaio, SG v3, splice, null, network, syslet, guasi, solarisaio 等等。<br>它支持 Linux 、FreeBSD 、NetBSD、 OpenBSD、 OS X、 OpenSolaris、 AIX、 HP-UX、 Android 以及 Windows操作系统。</p><h2 id="硬盘性能指标"><a href="#硬盘性能指标" class="headerlink" title="硬盘性能指标"></a>硬盘性能指标</h2><p>顺序读写（bw吞吐量，常用单位为 MB/s）：文件在硬盘上存储位置是连续的。<br>随机读写（iops磁盘的每秒读写次数，常用单位为次）：在硬盘上随机位置读写数据，默认4KB</p><h2 id="fio安装-1"><a href="#fio安装-1" class="headerlink" title="fio安装"></a>fio安装</h2><p><code>yum -y install epel-release</code><br><code>yum -y install fio</code></p><h2 id="fio命令格式"><a href="#fio命令格式" class="headerlink" title="fio命令格式"></a>fio命令格式</h2><p><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 32 -thread -rw=randrw -ioengine=psync -bs=16k -size=200G -numjobs=112 -runtime=300 -group_reporting -name=test</code></p><h2 id="fio参数详解"><a href="#fio参数详解" class="headerlink" title="fio参数详解"></a>fio参数详解</h2><p><strong>filename</strong>: 指定文件 (设备) 的名称。可以通过冒号分割同时指定多个文件，如 filename=/dev/sda:/dev/sdb。<br><strong>name</strong>: 指定 job 的名字，在命令行中表示新启动一个 job。<br><strong>direct</strong>: bool 类型，如果设置成 true (1)，表示不使用 io buffer。<br><strong>iodepth</strong>: 如果 ioengine 采用异步方式，该参数表示一批提交保持的 io 单元数。该参数可参考文章“Fio 压测工具和 io 队列深度理解和误区”。<br><a href="http://blog.yufeng.info/archives/2104" target="_blank" rel="external">http://blog.yufeng.info/archives/2104</a><br><strong>ioengine</strong>: I/O 引擎，现在 fio 支持 19 种 ioengine。默认值是 sync 同步阻塞 I/O，libaio 是 Linux 的 native 异步 I/O。关于同步异步，阻塞和非阻塞模型可以参考文章“使用异步 I/O 大大提高应用程序的性能”。<br><a href="http://www.ibm.com/developerworks/cn/linux/l-async/" target="_blank" rel="external">http://www.ibm.com/developerworks/cn/linux/l-async/</a><br><strong>rw</strong>: I/O 模式，顺序读(read)、顺序写(write)、随机读(randread)、随机写(randwrite)、随机读写(randrw)。<br><strong>rwmixread</strong>: 随机读写模式中读占比，默认为50%<br><strong>bs</strong>: I/O block 大小，默认是 4k。<br><strong>bsrange</strong>：指定数据块的大小范围<br><strong>size</strong>: 指定 job 处理的文件的大小。<br><strong>numjobs</strong>: 指定 job 的线程数。<br><strong>runtime</strong>: 指定在多少秒后停止进程。如果未指定该参数，fio 将执行至指定的文件读写完全完成。<br><strong>time_based</strong>: 如果在 runtime 指定的时间还没到时文件就被读写完成，将继续重复知道 runtime 时间结束。<br><strong>group_reporting</strong>: 当同时指定了 numjobs 了时，输出结果按组显示。</p><h1 id="fio测试结果"><a href="#fio测试结果" class="headerlink" title="fio测试结果"></a>fio测试结果</h1><p>我们需要根据自己业务场景来看待测试结果，如果是数据库业务的话，对随机读写要求比较高。如果是视频业务的话，对顺序读要求比较高。<br>为了确认不同参数对测试结果的影响有多大，我这里针对ioengine、iodepth、numjobs和bs参数进行了单独测试，测试结果如下:<br><img src="\images\2019\0427\0.png" alt="0"><br>从测试结果来看，我们可以得出以下结论：</p><ul><li>在同步模式（psync）和异步模式（libaio）下测试，在顺序写的时候同步模式iops会低于异步模式，其他基本无差异</li><li>队列深度（iodepth）对测试影响不大，网上说法是一般设置32个</li><li>线程数（numjobs）对测试效果影响较大，建议设置为逻辑cpu核数</li><li>文件块大小（bs）可以看到块越小，iops越高</li></ul><h1 id="fio详细测试过程"><a href="#fio详细测试过程" class="headerlink" title="fio详细测试过程"></a>fio详细测试过程</h1><h2 id="测试iodepth"><a href="#测试iodepth" class="headerlink" title="测试iodepth"></a>测试iodepth</h2><p><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 1 -thread -rw=read -ioengine=psync -bs=16k -size=200G -numjobs=112 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\iodepth-read-1.png" alt="iodepth-read-1"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 16 -thread -rw=read -ioengine=psync -bs=16k -size=200G -numjobs=112 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\iodepth-read-16.png" alt="iodepth-read-16"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 32 -thread -rw=read -ioengine=psync -bs=16k -size=200G -numjobs=112 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\iodepth-read-32.png" alt="iodepth-read-32"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 1 -thread -rw=write -ioengine=psync -bs=16k -size=200G -numjobs=112 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\iodepth-write-1.png" alt="iodepth-write-1"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 16 -thread -rw=write -ioengine=psync -bs=16k -size=200G -numjobs=112 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\iodepth-write-16.png" alt="iodepth-write-16"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 32 -thread -rw=write -ioengine=psync -bs=16k -size=200G -numjobs=112 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\iodepth-write-32.png" alt="iodepth-write-32"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 1 -thread -rw=randread -ioengine=psync -bs=16k -size=200G -numjobs=112 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\iodepth-randread-1.png" alt="iodepth-randread-1"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 16 -thread -rw=randread -ioengine=psync -bs=16k -size=200G -numjobs=112 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\iodepth-randread-16.png" alt="iodepth-randread-16"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 32 -thread -rw=randread -ioengine=psync -bs=16k -size=200G -numjobs=112 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\iodepth-randread-32.png" alt="iodepth-randread-32"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 1 -thread -rw=randwrite -ioengine=psync -bs=16k -size=200G -numjobs=112 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\iodepth-randwrite-1.png" alt="iodepth-randwrite-1"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 16 -thread -rw=randwrite -ioengine=psync -bs=16k -size=200G -numjobs=112 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\iodepth-randwrite-16.png" alt="iodepth-randwrite-16"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 32 -thread -rw=randwrite -ioengine=psync -bs=16k -size=200G -numjobs=112 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\iodepth-randwrite-32.png" alt="iodepth-randwrite-32"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 1 -thread -rw=randrw -ioengine=psync -bs=16k -size=200G -numjobs=112 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\iodepth-randrw-1.png" alt="iodepth-randrw-1"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 16 -thread -rw=randrw -ioengine=psync -bs=16k -size=200G -numjobs=112 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\iodepth-randrw-16.png" alt="iodepth-randrw-16"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 32 -thread -rw=randrw -ioengine=psync -bs=16k -size=200G -numjobs=112 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\iodepth-randrw-32.png" alt="iodepth-randrw-32"></p><h2 id="测试ioengine-psync-libaio"><a href="#测试ioengine-psync-libaio" class="headerlink" title="测试ioengine(psync/libaio)"></a>测试ioengine(psync/libaio)</h2><p><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 32 -thread -rw=read -ioengine=libaio -bs=16k -size=200G -numjobs=112 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\libaio-read.png" alt="libaio-randread"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 32 -thread -rw=write -ioengine=libaio -bs=16k -size=200G -numjobs=112 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\libaio-write.png" alt="libaio-write"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 32 -thread -rw=randread -ioengine=libaio -bs=16k -size=200G -numjobs=112 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\libaio-randread.png" alt="libaio-randread"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 32 -thread -rw=randwrite -ioengine=libaio -bs=16k -size=200G -numjobs=112 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\libaio-randwrite.png" alt="libaio-randwrite"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 32 -thread -rw=randrw -ioengine=libaio -bs=16k -size=200G -numjobs=112 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\libaio-randrw.png" alt="libaio-randrw"></p><h2 id="测试numjobs-1-30-112"><a href="#测试numjobs-1-30-112" class="headerlink" title="测试numjobs  1/30/112"></a>测试numjobs  1/30/112</h2><p><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 32 -thread -rw=read -ioengine=psync -bs=16k -size=200G -numjobs=1 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\numjobs-read-1.png" alt="numjobs-read-1"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 32 -thread -rw=read -ioengine=psync -bs=16k -size=200G -numjobs=30 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\numjobs-read-30.png" alt="numjobs-read-30"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 32 -thread -rw=write -ioengine=psync -bs=16k -size=200G -numjobs=1 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\numjobs-write-1.png" alt="numjobs-write-1"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 32 -thread -rw=write -ioengine=psync -bs=16k -size=200G -numjobs=30 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\numjobs-write-30.png" alt="numjobs-write-30"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 32 -thread -rw=randread -ioengine=psync -bs=16k -size=200G -numjobs=1 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\numjobs-randread-1.png" alt="numjobs-randread-1"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 32 -thread -rw=randread -ioengine=psync -bs=16k -size=200G -numjobs=30 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\numjobs-randread-30.png" alt="numjobs-randread-30"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 32 -thread -rw=randwrite -ioengine=psync -bs=16k -size=200G -numjobs=1 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\numjobs-randwrite-1.png" alt="numjobs-randwrite-1"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 32 -thread -rw=randwrite -ioengine=psync -bs=16k -size=200G -numjobs=30 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\numjobs-randwrite-30.png" alt="numjobs-randwrite-30"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 32 -thread -rw=randrw -ioengine=psync -bs=16k -size=200G -numjobs=1 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\numjobs-randrw-1.png" alt="numjobs-randrw-1"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 32 -thread -rw=randrw -ioengine=psync -bs=16k -size=200G -numjobs=30 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\numjobs-randrw-30.png" alt="numjobs-randrw-30"></p><h2 id="测试bs"><a href="#测试bs" class="headerlink" title="测试bs"></a>测试bs</h2><p><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 32 -thread -rw=read -ioengine=psync -bs=64k -size=200G -numjobs=112 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\bs-read-64.png" alt="bs-read-64"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 32 -thread -rw=read -ioengine=psync -bs=1024k -size=200G -numjobs=112 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\bs-read-1024.png" alt="bs-read-1024"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 32 -thread -rw=write -ioengine=psync -bs=64k -size=200G -numjobs=112 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\bs-write-64.png" alt="bs-write-64"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 32 -thread -rw=write -ioengine=psync -bs=1024k -size=200G -numjobs=112 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\bs-write-1024.png" alt="bs-write-1024"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 32 -thread -rw=randread -ioengine=psync -bs=64k -size=200G -numjobs=112 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\bs-randread-64.png" alt="bs-randread-64"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 32 -thread -rw=randread -ioengine=psync -bs=1024k -size=200G -numjobs=112 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\bs-randread-1024.png" alt="bs-randread-1024"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 32 -thread -rw=randwrite -ioengine=psync -bs=64k -size=200G -numjobs=112 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\bs-randwrite-64.png" alt="bs-randwrite-64"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 32 -thread -rw=randwrite -ioengine=psync -bs=1024k -size=200G -numjobs=112 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\bs-randwrite-1024.png" alt="bs-randwrite-1024"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 32 -thread -rw=randrw -ioengine=psync -bs=64k -size=200G -numjobs=112 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\bs-randrw-64.png" alt="bs-randrw-64"><br><code>fio -filename=/dev/mapper/mpatha -direct=1 -iodepth 32 -thread -rw=randrw -ioengine=psync -bs=1024k -size=200G -numjobs=112 -runtime=300 -group_reporting -name=test</code><img src="\images\2019\0427\bs-randrw-1024.png" alt="bs-randrw-1024"><br>参考链接：<a href="https://wsgzao.github.io/post/fio/" target="_blank" rel="external">https://wsgzao.github.io/post/fio/</a><br>​      <a href="https://linux.cn/article-9912-1.html" target="_blank" rel="external">https://linux.cn/article-9912-1.html</a><br>​      <a href="http://www.178pt.com/204.html" target="_blank" rel="external">http://www.178pt.com/204.html</a><br>          <a href="http://blog.yufeng.info/archives/741" target="_blank" rel="external">http://blog.yufeng.info/archives/741</a></p>]]></content>
      
      
      <categories>
          
          <category> 测试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 硬件 </tag>
            
            <tag> 性能 </tag>
            
            <tag> fio </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Typora 快捷键</title>
      <link href="/arlo/e402bc62/"/>
      <url>/arlo/e402bc62/</url>
      
        <content type="html"><![CDATA[<ul><li>生成目录: <code>[TOC]</code></li><li>无序列表：<code>输入-之后输入空格</code></li><li>有序列表：<code>输入数字+“.”之后输入空格</code></li><li>任务列表：<code>-[空格]空格 文字</code></li><li>标题：<code>Ctrl+数字[1-6]</code></li><li>字体加粗：<code>Ctrl+B</code></li><li>字体倾斜：<code>Ctrl+I</code></li><li>字体下划线：<code>Ctrl+U</code></li><li>字体删除线：<code>Alt+Shift+5</code></li><li>表格：<code>Ctrl+T</code></li><li>代码：<code>Ctrl+Shift+</code>`</li><li>代码块：<code>Ctrl+Shift+K</code></li><li>公式块：<code>Ctrl+Shift+M</code></li><li>插入图片：<code>直接拖动到指定位置即可或者Ctrl+Shift+I</code></li><li>插入超级链接: <code>Ctrl+K</code></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>使用sqlldr导入txt数据</title>
      <link href="/arlo/2d7abdb2/"/>
      <url>/arlo/2d7abdb2/</url>
      
        <content type="html"><![CDATA[<p>将txt或者csv数据导入数据库最方便的方法就是使用sqlldr，使用sqlldr必须有一个控制文件，控制文件能把外部数据和数据库的表和列联系起来。<br><a id="more"></a></p><h1 id="新建数据表"><a href="#新建数据表" class="headerlink" title="新建数据表"></a>新建数据表</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">CREATE TABLE &quot;TENVAIR&quot;.&quot;TEST&quot;</div><div class="line">   (&quot;EMISS_GRIDID&quot; NUMBER(*,0) NOT NULL ENABLE,</div><div class="line">&quot;X&quot; NUMBER(*,0) NOT NULL ENABLE,</div><div class="line">&quot;Y&quot; NUMBER(*,0) NOT NULL ENABLE,</div><div class="line">&quot;EMISS_TYPE&quot; VARCHAR2(16) NOT NULL ENABLE,</div><div class="line">&quot;POLLUTION_TYPE&quot; VARCHAR2(16) NOT NULL ENABLE,</div><div class="line">&quot;JAN&quot; NUMBER(20,10),</div><div class="line">&quot;FEB&quot; NUMBER(20,10),</div><div class="line">&quot;MAR&quot; NUMBER(20,10),</div><div class="line">&quot;APR&quot; NUMBER(20,10),</div><div class="line">&quot;MAY&quot; NUMBER(20,10),</div><div class="line">&quot;JUN&quot; NUMBER(20,10),</div><div class="line">&quot;JUL&quot; NUMBER(20,10),</div><div class="line">&quot;AUG&quot; NUMBER(20,10),</div><div class="line">&quot;SEP&quot; NUMBER(20,10),</div><div class="line">&quot;OCT&quot; NUMBER(20,10),</div><div class="line">&quot;NOV&quot; NUMBER(20,10),</div><div class="line">&quot;DEC&quot; NUMBER(20,10),</div><div class="line">&quot;TOTAL&quot; NUMBER(20,10));</div></pre></td></tr></table></figure><h1 id="数据格式"><a href="#数据格式" class="headerlink" title="数据格式"></a>数据格式</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">EMISS_GRIDID,X,Y,EMISS_TYPE,POLLUTION_TYPE,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC,TOTAL</div><div class="line">10398,158,33,agriculture,NH3,,,,,,,,,,,,,57.5565528870</div><div class="line">10398,158,33,industry,ALD2,,,,,,,,,,,,,0.0081295827</div><div class="line">10398,158,33,industry,ALDX,,,,,,,,,,,,,0.0782553777</div><div class="line">10398,158,33,industry,BC,,,,,,,,,,,,,2.5780515671</div></pre></td></tr></table></figure><h1 id="编写控制文件t-ctl"><a href="#编写控制文件t-ctl" class="headerlink" title="编写控制文件t.ctl"></a>编写控制文件t.ctl</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">load data</div><div class="line">append into table TENVAIR.TEST</div><div class="line">fields terminated by &apos;,&apos;</div><div class="line">TRAILING NULLCOLS</div><div class="line">(</div><div class="line">EMISS_GRIDID,</div><div class="line">X,</div><div class="line">Y,</div><div class="line">EMISS_TYPE,</div><div class="line">POLLUTION_TYPE,</div><div class="line">JAN,</div><div class="line">FEB,</div><div class="line">MAR,</div><div class="line">APR,</div><div class="line">MAY,</div><div class="line">JUN,</div><div class="line">JUL,</div><div class="line">AUG,</div><div class="line">SEP,</div><div class="line">OCT,</div><div class="line">NOV,</div><div class="line">DEC,</div><div class="line">TOTAL)</div></pre></td></tr></table></figure><p><strong>infile ‘EMISS_MEIC.txt’</strong> 表示要导入的文本名为EMISS_MEIC.txt，也可以在执行sqlldr的时候加data=EMISS_MEIC.txt<br><strong>append/insert/replace/truncate into table TABLE_NAME</strong>   append表示使用追加的方式将数据写入表中；insert 表示导入空表，有数据则停止；replace表示原来表中如果有数据，则会被删除（用delete from table语句）;truncate表示原来表中如果有数据，则会被清除（用truncate table语句）<br><strong>fields terminated by ‘,’</strong>  数据中每行记录用”,”分隔<br><strong>TRAILING NULLCOLS</strong>    表的字段没有对应的值时允许为空</p><h1 id="使用sqlldr导入"><a href="#使用sqlldr导入" class="headerlink" title="使用sqlldr导入"></a>使用sqlldr导入</h1><p>如果数据文件是从windows传到linux操作系统上的，需要转换一下文件格式<br><code>dos2unix EMISS_MEIC.txt</code><br><code>sqlldr userid=user/&#39;passwd&#39; control=t.ctl data=EMISS_MEIC.txt  readsize=4194304</code></p><h1 id="查看导入结果"><a href="#查看导入结果" class="headerlink" title="查看导入结果"></a>查看导入结果</h1><p>从日志文件中我们可以看到导入详情，导入1279319条数据，耗时33秒，效率还是非常高的！<br><img src="/images/2019/0420/01.png" alt="sqlldr"><br><img src="/images/2019/0420/02.png" alt="sqlldr"></p>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>oracle开启归档日志模式</title>
      <link href="/arlo/60a79bb7/"/>
      <url>/arlo/60a79bb7/</url>
      
        <content type="html"><![CDATA[<p>在默认情况下，oracle数据库是在非归日志档模式中创建的，在非归档日志模式中，进行日志切换时会直接重写redo log，如果此时数据文件因为介质失败被损坏，则数据库恢复时会丢失掉被重写的数据；在归档日志模式下，数据库可以应用最近一次数据库备份开始生成的所有归档日志文件，保证数据无丢失；大部分的生产数据库以archivelog模式运行。<br>oracle数据库在开启归档日志模式后，会自动启动新的进程：归档器ARCn。默认情况下是开启4个进程，在实际应用中最多可以启动30个归档器进程。<br><a id="more"></a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ ps -ef |grep arc</div><div class="line">oracle   22248     1  0 11:35 ?        00:00:00 ora_arc0_airforecast</div><div class="line">oracle   22250     1  0 11:35 ?        00:00:00 ora_arc1_airforecast</div><div class="line">oracle   22252     1  0 11:35 ?        00:00:00 ora_arc2_airforecast</div><div class="line">oracle   22254     1  0 11:35 ?        00:00:00 ora_arc3_airforecast</div></pre></td></tr></table></figure><h1 id="新建归档模式目录"><a href="#新建归档模式目录" class="headerlink" title="新建归档模式目录"></a>新建归档模式目录</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mkdir /u01/app/oracle/oradata/airforecast/archivelog</div></pre></td></tr></table></figure><h1 id="设置实例参数"><a href="#设置实例参数" class="headerlink" title="设置实例参数"></a>设置实例参数</h1><p>从9i开始后，oracle数据库可以指定10个归档目的地，但实例log_archive_dest_n中的n最大为30，通常情况下需要指定2个或者多个归档目的地来多路复用归档日志文件；在理想情况下，这些归档日志文件应当位于不同的磁盘存储上；实际应用中，一般还是指定一个，非常重要的数据库一般有data guard来保证高可用性。</p><table><thead><tr><th>变量</th><th>描述</th></tr></thead><tbody><tr><td>%d</td><td>唯一的数据看标志符，如果多个数据库归档到同一目录，这是必须要的</td></tr><tr><td>%t</td><td>线程号，适用于RAC数据看，无实际意义</td></tr><tr><td>%r</td><td>场景（incarnation）号，在不完全恢复时需要用到</td></tr><tr><td>%s</td><td>日志切换序列号，保证同一个库中的归档日志不会彼此重写</td></tr></tbody></table><p>修改操作步骤如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">SYS@airforecast&gt; conn / as sysdba</div><div class="line">SYS@airforecast&gt; alter system set log_archive_dest_1=&apos;location=/u01/app/oracle/oradata/airforecast/archivelog&apos; scope = spfile;</div><div class="line">SYS@airforecast&gt; alter system set log_archive_format=&apos;arch_%d_%t_%r_%s.log&apos; scope = spfile;</div></pre></td></tr></table></figure></p><h1 id="重启数据库并开启归档日志模式"><a href="#重启数据库并开启归档日志模式" class="headerlink" title="重启数据库并开启归档日志模式"></a>重启数据库并开启归档日志模式</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">SYS@airforecast&gt; shutdown immediate</div><div class="line">Database closed.</div><div class="line">Database dismounted.</div><div class="line">ORACLE instance shut down.</div><div class="line">SYS@airforecast&gt; startup mount;</div><div class="line">ORACLE instance started.</div><div class="line"></div><div class="line">Total System Global Area 4977278976 bytes</div><div class="line">Fixed Size    2261768 bytes</div><div class="line">Variable Size 1006636280 bytes</div><div class="line">Database Buffers 3959422976 bytes</div><div class="line">Redo Buffers    8957952 bytes</div><div class="line">Database mounted.</div><div class="line">SYS@airforecast&gt; alter database archivelog;</div><div class="line"></div><div class="line">Database altered.</div><div class="line"></div><div class="line">SYS@airforecast&gt; alter database open;</div><div class="line"></div><div class="line">Database altered.</div></pre></td></tr></table></figure><h1 id="确认数据库是否为归档模式"><a href="#确认数据库是否为归档模式" class="headerlink" title="确认数据库是否为归档模式"></a>确认数据库是否为归档模式</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">SYS@airforecast&gt; select log_mode from v$database;</div><div class="line"></div><div class="line">LOG_MODE</div><div class="line">------------</div><div class="line">ARCHIVELOG</div><div class="line"></div><div class="line">SYS@airforecast&gt; select archiver from v$instance;</div><div class="line"></div><div class="line">ARCHIVE</div><div class="line">-------</div><div class="line">STARTED</div></pre></td></tr></table></figure><h1 id="切换日志检查归档日志是否正常"><a href="#切换日志检查归档日志是否正常" class="headerlink" title="切换日志检查归档日志是否正常"></a>切换日志检查归档日志是否正常</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">SYS@airforecast&gt; alter system switch logfile;</div><div class="line"></div><div class="line">System altered.</div><div class="line"></div><div class="line">SYS@airforecast&gt; select name from v$archived_log;</div><div class="line"></div><div class="line">NAME</div><div class="line">------------------------------------------------------------------------------------------------------------------------</div><div class="line">/u01/app/oracle/oradata/airforecast/archivelog/arch_a9652e7f_1_1000805313_5.log</div><div class="line">/u01/app/oracle/oradata/airforecast/archivelog/arch_a9652e7f_1_1000805313_6.log</div></pre></td></tr></table></figure><p>参考链接：<a href="https://www.jianshu.com/p/f8c0e9309ce2" target="_blank" rel="external">https://www.jianshu.com/p/f8c0e9309ce2</a></p>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>表空间操作常用语句</title>
      <link href="/arlo/b76e9b6/"/>
      <url>/arlo/b76e9b6/</url>
      
        <content type="html"><![CDATA[<h1 id="创建表空间T-WORK"><a href="#创建表空间T-WORK" class="headerlink" title="创建表空间T_WORK"></a>创建表空间T_WORK</h1><p><code>create tablespace T_WORK_DATA datafile &#39;/u01/app/oracle/oradata/airforecast/t_work01.dbf&#39; SIZE 200m AUTOEXTEND ON NEXT 32m MAXSIZE 32767M EXTENT MANAGEMENT LOCAL;</code><br><code>alter tablespace T_WORK_DATA add datafile &#39;/u01/app/oracle/oradata/airforecast/t_work02.dbf&#39; size 5M autoextend on maxsize 32767M;</code></p><h1 id="创建临时表空间"><a href="#创建临时表空间" class="headerlink" title="创建临时表空间"></a>创建临时表空间</h1><p><code>CREATE TEMPORARY TABLESPACE T_WORK_TEMP TEMPFILE &#39;/u01/app/oracle/oradata/airforecast/t_work_tmp01.dbf&#39; SIZE 200m AUTOEXTEND ON NEXT 32m MAXSIZE 2048m EXTENT MANAGEMENT LOCAL;</code></p><h1 id="创建T-WORK用户"><a href="#创建T-WORK用户" class="headerlink" title="创建T_WORK用户"></a>创建T_WORK用户</h1><p><code>CREATE USER T_WORK IDENTIFIED BY solution#123 DEFAULT TABLESPACE T_WORK_DATA TEMPORARY TABLESPACE T_WORK_TEMP;</code></p><h1 id="赋予权限"><a href="#赋予权限" class="headerlink" title="赋予权限"></a>赋予权限</h1><p><code>GRANT CONNECT,RESOURCE TO T_WORK;</code><br><a id="more"></a></p><h1 id="修改用户表所属表空间"><a href="#修改用户表所属表空间" class="headerlink" title="修改用户表所属表空间"></a>修改用户表所属表空间</h1><p><code>alter table TABLE_NAME move tablespace TABLESPACENAME</code></p><h1 id="删除表空间"><a href="#删除表空间" class="headerlink" title="删除表空间"></a>删除表空间</h1><p><code>DROP USER T_WORK CASCADE;</code><br><code>DROP TABLESPACE T_WORK_DATA INCLUDING CONTENTS AND DATAFILES;</code></p><h1 id="删除临时表空间"><a href="#删除临时表空间" class="headerlink" title="删除临时表空间"></a>删除临时表空间</h1><p><code>DROP TABLESPACE T_WORK_TEMP INCLUDING CONTENTS AND DATAFILES;</code></p><h1 id="开启自动扩展功能语法"><a href="#开启自动扩展功能语法" class="headerlink" title="开启自动扩展功能语法"></a>开启自动扩展功能语法</h1><p><code>alter database datafile &#39;对应的数据文件路径信息&#39; autoextend on;</code></p><h1 id="关闭自动扩展功能语法"><a href="#关闭自动扩展功能语法" class="headerlink" title="关闭自动扩展功能语法"></a>关闭自动扩展功能语法</h1><p><code>alter database datafile &#39;对应的数据文件路径信息&#39; autoextend off;</code></p><h1 id="查看默认数据表空间"><a href="#查看默认数据表空间" class="headerlink" title="查看默认数据表空间"></a>查看默认数据表空间</h1><p><code>SELECT PROPERTY_NAME, PROPERTY_VALUE FROM DATABASE_PROPERTIES;</code></p><h1 id="查看默认临时表空间"><a href="#查看默认临时表空间" class="headerlink" title="查看默认临时表空间"></a>查看默认临时表空间</h1><p><code>SELECT PROPERTY_NAME, PROPERTY_VALUE FROM DATABASE_PROPERTIES WHERE PROPERTY_NAME=&#39;DEFAULT_TEMP_TABLESPACE&#39;;</code></p><h1 id="查看普通用户的默认表空间和临时表空间"><a href="#查看普通用户的默认表空间和临时表空间" class="headerlink" title="查看普通用户的默认表空间和临时表空间"></a>查看普通用户的默认表空间和临时表空间</h1><p><code>SELECT USERNAME, DEFAULT_TABLESPACE, TEMPORARY_TABLESPACE FROM DBA_USERS;</code><br><code>SELECT DEFAULT_TABLESPACE,TEMPORARY_TABLESPACE FROM DBA_USERS WHERE USERNAME=&#39;T_WORK&#39;;</code></p><h1 id="修改表空间名称"><a href="#修改表空间名称" class="headerlink" title="修改表空间名称"></a>修改表空间名称</h1><p><code>alter tablespace T_WORK RENAME TO T_WORK_DATA;</code></p>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Oracle 11.2.0.4.0打PSU24006111(11.2.0.4.161018)</title>
      <link href="/arlo/582decea/"/>
      <url>/arlo/582decea/</url>
      
        <content type="html"><![CDATA[<p>系统环境：CentOS 6.9 / Oracle 11.2.0.4 x64<br><strong> 软件链接: <a href="https://pan.baidu.com/s/16dlRzILi7p3LTd6lXVQy_g" target="_blank" rel="external">https://pan.baidu.com/s/16dlRzILi7p3LTd6lXVQy_g</a> 提取码: fkrj </strong></p><h1 id="Oracle补丁术语介绍"><a href="#Oracle补丁术语介绍" class="headerlink" title="Oracle补丁术语介绍"></a>Oracle补丁术语介绍</h1><p>补丁概念请参考：<a href="https://blog.csdn.net/DBDeep/article/details/72904608" target="_blank" rel="external">https://blog.csdn.net/DBDeep/article/details/72904608</a><br>我们今天安装的是打PSU补丁，就是DBA&amp;DMA们常论道的PSU。Oracle 选取在每个季度用户下载数量最多，并且得到验证具有较低风险的补丁放入到每个季度的PSU中，修复比较严重的一些问题，包含每个季度的CPU，是累积型的。虽然在描述PSU的时候会用到数据库版本第5位，比如Database PSU 11.2.0.3.5，但实际上打完PSU后并不会真正改变数据库的版本，从v$version中看到的版本还是4位的(11.2.0.3.0)，第5位仍然是0。<br>(1)Windows上没有CPU和PSU，对于Windows和Exadata，Oracle使用Bundle Patch代替PSU，Bundle Patch会包含PSU的内容<br>(2)从11.2.0.2版本开始，一个新的补丁策略被引入，11.2.0.1之后发布的Patch Set本身就是一个完整的安装包，不再需要基础的Release 版本安装。</p><p><em>Note 2118136.2 psu补丁号快速查询Quick Reference to Patch Numbers for Database PSU, SPU(CPU), Bundle Patches and Patchsets (文档 ID 1454618.1)</em></p><a id="more"></a><h1 id="查看当前补丁状态"><a href="#查看当前补丁状态" class="headerlink" title="查看当前补丁状态"></a>查看当前补丁状态</h1><h2 id="检查环境变量"><a href="#检查环境变量" class="headerlink" title="检查环境变量"></a>检查环境变量</h2><p>确保$PATH中包含以下可执行文件:make,ar,ld和nm<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[oracle@ora1 ~]$ which make</div><div class="line">/usr/bin/make</div><div class="line">[oracle@ora1 ~]$ which ar</div><div class="line">/usr/bin/ar</div><div class="line">[oracle@ora1 ~]$ which ld</div><div class="line">/usr/bin/ld</div><div class="line">[oracle@ora1 ~]$ which nm</div><div class="line">/usr/bin/nm</div></pre></td></tr></table></figure></p><h2 id="检查-amp-升级OPatch版本"><a href="#检查-amp-升级OPatch版本" class="headerlink" title="检查&amp;升级OPatch版本"></a>检查&amp;升级OPatch版本</h2><p>必须使用OPatch实用程序版本11.2.0.3.6或更高版本<br><code>$ORACLE_HOME/OPatch/opatch version</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">OPatch Version: 11.2.0.3.4</div></pre></td></tr></table></figure></p><p>这个版本不满足我们的要求，我们需要下载p6880880_112000_Linux-x86-64.zip，替换当前的OPatch<br><code>cd $ORACLE_HOME</code><br><code>mv OPatch OPatch_bak</code><br><code>unzip p6880880_112000_Linux-x86-64.zip -d $ORACLE_HOME</code><br><code>$ORACLE_HOME/OPatch/opatch version</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">OPatch Version: 11.2.0.3.19</div></pre></td></tr></table></figure></p><h2 id="查看当前补丁状态-1"><a href="#查看当前补丁状态-1" class="headerlink" title="查看当前补丁状态"></a>查看当前补丁状态</h2><p><code>opatch lsinventory</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">[oracle@ora1 sf]$ opatch lsinventory</div><div class="line">Oracle Interim Patch Installer version 11.2.0.3.19</div><div class="line">Copyright (c) 2019, Oracle Corporation.  All rights reserved.</div><div class="line"></div><div class="line"></div><div class="line">Oracle Home       : /u01/app/oracle/product/11.2.0.4/db_1</div><div class="line">Central Inventory : /u01/app/oraInventory</div><div class="line">   from           : /u01/app/oracle/product/11.2.0.4/db_1/oraInst.loc</div><div class="line">OPatch version    : 11.2.0.3.19</div><div class="line">OUI version       : 11.2.0.4.0</div><div class="line">Log file location : /u01/app/oracle/product/11.2.0.4/db_1/cfgtoollogs/opatch/opatch2019-01-24_22-21-59PM_1.log</div><div class="line"></div><div class="line">Lsinventory Output file location : /u01/app/oracle/product/11.2.0.4/db_1/cfgtoollogs/opatch/lsinv/lsinventory2019-01-24_22-21-59PM.txt</div><div class="line"></div><div class="line">--------------------------------------------------------------------------------</div><div class="line">Local Machine Information::</div><div class="line">Hostname: localhost</div><div class="line">ARU platform id: 226</div><div class="line">ARU platform description:: Linux x86-64</div><div class="line"></div><div class="line">Installed Top-level Products (1): </div><div class="line"></div><div class="line">Oracle Database 11g                                                  11.2.0.4.0</div><div class="line">There are 1 products installed in this Oracle Home.</div><div class="line"></div><div class="line"></div><div class="line">There are no Interim patches installed in this Oracle Home.</div><div class="line"></div><div class="line"></div><div class="line">--------------------------------------------------------------------------------</div><div class="line"></div><div class="line">OPatch succeeded.</div></pre></td></tr></table></figure></p><h1 id="检测补丁兼容性"><a href="#检测补丁兼容性" class="headerlink" title="检测补丁兼容性"></a>检测补丁兼容性</h1><h2 id="检查补丁是否冲突"><a href="#检查补丁是否冲突" class="headerlink" title="检查补丁是否冲突"></a>检查补丁是否冲突</h2><p>首先我们上传补丁文件p24006111_112040_Linux-x86-64.zip到数据库服务器上<br><code>unzip p24006111_112040_Linux-x86-64.zip</code><br><code>cd 24006111</code><br><code>opatch prereq CheckConflictAgainstOHWithDetail -ph ./</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[oracle@ora1 24006111]$ opatch prereq CheckConflictAgainstOHWithDetail -ph ./</div><div class="line">Oracle Interim Patch Installer version 11.2.0.3.19</div><div class="line">Copyright (c) 2019, Oracle Corporation.  All rights reserved.</div><div class="line"></div><div class="line">PREREQ session</div><div class="line"></div><div class="line">Oracle Home       : /u01/app/oracle/product/11.2.0.4/db_1</div><div class="line">Central Inventory : /u01/app/oraInventory</div><div class="line">   from           : /u01/app/oracle/product/11.2.0.4/db_1/oraInst.loc</div><div class="line">OPatch version    : 11.2.0.3.19</div><div class="line">OUI version       : 11.2.0.4.0</div><div class="line">Log file location : /u01/app/oracle/product/11.2.0.4/db_1/cfgtoollogs/opatch/opatch2019-01-24_22-22-48PM_1.log</div><div class="line"></div><div class="line">Invoking prereq &quot;checkconflictagainstohwithdetail&quot;</div><div class="line"></div><div class="line">Prereq &quot;checkConflictAgainstOHWithDetail&quot; passed.</div><div class="line"></div><div class="line">OPatch succeeded.</div></pre></td></tr></table></figure></p><h2 id="查看组件信息"><a href="#查看组件信息" class="headerlink" title="查看组件信息"></a>查看组件信息</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">set linesize 150;</div><div class="line">set pagesize 9999;</div><div class="line">col comp_name format a40;</div><div class="line">SELECT COMP_NAME, VERSION, STATUS FROM SYS.DBA_REGISTRY;</div></pre></td></tr></table></figure><h2 id="查看补丁状态"><a href="#查看补丁状态" class="headerlink" title="查看补丁状态"></a>查看补丁状态</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">set linesize 500 pagesize 600</div><div class="line">col ACTION_TIME for a30</div><div class="line">col COMMENTS for a30</div><div class="line">select ACTION_TIME, ACTION,version, COMMENTS from sys.DBA_REGISTRY_HISTORY;</div></pre></td></tr></table></figure><p><img src="/images/2019/0124/01.png" alt="psu"></p><h1 id="打补丁"><a href="#打补丁" class="headerlink" title="打补丁"></a>打补丁</h1><h2 id="关闭数据库和监听"><a href="#关闭数据库和监听" class="headerlink" title="关闭数据库和监听"></a>关闭数据库和监听</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[oracle@ora1 24006111]$ sqlplus / as sysdba</div><div class="line"></div><div class="line">SQL*Plus: Release 11.2.0.4.0 Production on Thu Jan 24 23:03:01 2019</div><div class="line"></div><div class="line">Copyright (c) 1982, 2013, Oracle.  All rights reserved.</div><div class="line">SYS@@orcl&gt; shutdown immediate</div><div class="line">Database closed.</div><div class="line">Database dismounted.</div><div class="line">ORACLE instance shut down.</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[oracle@ora1 24006111]$ lsnrctl stop</div><div class="line"></div><div class="line">LSNRCTL for Linux: Version 11.2.0.4.0 - Production on 24-JAN-2019 23:03:45</div><div class="line"></div><div class="line">Copyright (c) 1991, 2013, Oracle.  All rights reserved.</div><div class="line"></div><div class="line">Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=EXTPROC1521)))</div><div class="line">The command completed successfully</div></pre></td></tr></table></figure><p>查看数据库和监听是否彻底关闭，如果未关闭，打补丁过程中会报错。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[oracle@ora1 24006111]$ ps -ef |grep ora_</div><div class="line">oracle    45322  42120  2 23:04 pts/0    00:00:00 grep ora_</div><div class="line">[oracle@ora1 24006111]$ ps -ef |grep tns</div><div class="line">root         21      2  0 16:29 ?        00:00:00 [netns]</div><div class="line">oracle    45324  42120  0 23:04 pts/0    00:00:00 grep tns</div></pre></td></tr></table></figure></p><h2 id="开始打补丁"><a href="#开始打补丁" class="headerlink" title="开始打补丁"></a>开始打补丁</h2><p>每个补丁包里都有Readme.html文件，文件中有很详细的说明和操作流程<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">[oracle@ora1 24006111]$ opatch apply</div><div class="line">Oracle Interim Patch Installer version 11.2.0.3.19</div><div class="line">Copyright (c) 2019, Oracle Corporation.  All rights reserved.</div><div class="line"></div><div class="line"></div><div class="line">Oracle Home       : /u01/app/oracle/product/11.2.0.4/db_1</div><div class="line">Central Inventory : /u01/app/oraInventory</div><div class="line">   from           : /u01/app/oracle/product/11.2.0.4/db_1/oraInst.loc</div><div class="line">OPatch version    : 11.2.0.3.19</div><div class="line">OUI version       : 11.2.0.4.0</div><div class="line">Log file location : /u01/app/oracle/product/11.2.0.4/db_1/cfgtoollogs/opatch/opatch2019-01-24_23-15-07PM_1.log</div><div class="line"></div><div class="line">Verifying environment and performing prerequisite checks...</div><div class="line">OPatch continues with these patches:   17478514  18031668  18522509  19121551  19769489  20299013  20760982  21352635  21948347  22502456  23054359  24006111  </div><div class="line"></div><div class="line">Do you want to proceed? [y|n]</div><div class="line">y</div><div class="line">User Responded with: Y</div><div class="line">All checks passed.</div><div class="line">Provide your email address to be informed of security issues, install and</div><div class="line">initiate Oracle Configuration Manager. Easier for you if you use your My</div><div class="line">Oracle Support Email address/User Name.</div><div class="line">Visit http://www.oracle.com/support/policies.html for details.</div><div class="line">Email address/User Name: </div><div class="line"></div><div class="line">You have not provided an email address for notification of security issues.</div><div class="line">Do you wish to remain uninformed of security issues ([Y]es, [N]o) [N]:  y</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">Please shutdown Oracle instances running out of this ORACLE_HOME on the local system.</div><div class="line">(Oracle Home = &apos;/u01/app/oracle/product/11.2.0.4/db_1&apos;)</div><div class="line"></div><div class="line"></div><div class="line">Is the local system ready for patching? [y|n]</div><div class="line">y</div><div class="line">User Responded with: Y</div><div class="line">Backing up files...</div><div class="line">Applying sub-patch &apos;17478514&apos; to OH &apos;/u01/app/oracle/product/11.2.0.4/db_1&apos;</div><div class="line"></div><div class="line">Patching component oracle.rdbms, 11.2.0.4.0...</div><div class="line"></div><div class="line">……</div><div class="line">Patching component oracle.rdbms.dbscripts, 11.2.0.4.0...</div><div class="line">Composite patch 24006111 successfully applied.</div><div class="line">Log file location: /u01/app/oracle/product/11.2.0.4/db_1/cfgtoollogs/opatch/opatch2019-01-24_23-15-07PM_1.log</div><div class="line"></div><div class="line">OPatch succeeded.</div></pre></td></tr></table></figure></p><h2 id="升级数据字典"><a href="#升级数据字典" class="headerlink" title="升级数据字典"></a>升级数据字典</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">cd $ORACLE_HOME/rdbms/admin</div><div class="line">sqlplus /nolog</div><div class="line">SQL&gt; CONNECT / AS SYSDBA</div><div class="line">SQL&gt; STARTUP</div><div class="line">SQL&gt; @catbundle.sql psu apply </div><div class="line">SQL&gt; QUIT</div></pre></td></tr></table></figure><h2 id="重新编译无效对象"><a href="#重新编译无效对象" class="headerlink" title="重新编译无效对象"></a>重新编译无效对象</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cd $ORACLE_HOME/rdbms/admin</div><div class="line">sqlplus /nolog</div><div class="line">SQL&gt; CONNECT / AS SYSDBA</div><div class="line">SQL&gt; @utlrp.sql</div></pre></td></tr></table></figure><h1 id="验证升级结果"><a href="#验证升级结果" class="headerlink" title="验证升级结果"></a>验证升级结果</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div></pre></td><td class="code"><pre><div class="line">[oracle@ora1 24006111]$ opatch lsinventory</div><div class="line">Oracle Interim Patch Installer version 11.2.0.3.19</div><div class="line">Copyright (c) 2019, Oracle Corporation.  All rights reserved.</div><div class="line"></div><div class="line"></div><div class="line">Oracle Home       : /u01/app/oracle/product/11.2.0.4/db_1</div><div class="line">Central Inventory : /u01/app/oraInventory</div><div class="line">   from           : /u01/app/oracle/product/11.2.0.4/db_1/oraInst.loc</div><div class="line">OPatch version    : 11.2.0.3.19</div><div class="line">OUI version       : 11.2.0.4.0</div><div class="line">Log file location : /u01/app/oracle/product/11.2.0.4/db_1/cfgtoollogs/opatch/opatch2019-01-24_23-36-05PM_1.log</div><div class="line"></div><div class="line">Lsinventory Output file location : /u01/app/oracle/product/11.2.0.4/db_1/cfgtoollogs/opatch/lsinv/lsinventory2019-01-24_23-36-05PM.txt</div><div class="line"></div><div class="line">--------------------------------------------------------------------------------</div><div class="line">Local Machine Information::</div><div class="line">Hostname: localhost</div><div class="line">ARU platform id: 226</div><div class="line">ARU platform description:: Linux x86-64</div><div class="line"></div><div class="line">Installed Top-level Products (1): </div><div class="line"></div><div class="line">Oracle Database 11g                                                  11.2.0.4.0</div><div class="line">There are 1 products installed in this Oracle Home.</div><div class="line"></div><div class="line"></div><div class="line">Interim patches (1) :</div><div class="line"></div><div class="line">Patch  24006111     : applied on Thu Jan 24 23:29:17 CST 2019</div><div class="line">Unique Patch ID:  20508568</div><div class="line">Patch description:  &quot;Database Patch Set Update : 11.2.0.4.161018 (24006111)&quot;</div><div class="line">   Created on 26 Aug 2016, 05:54:48 hrs PST8PDT</div><div class="line">Sub-patch  23054359; &quot;Database Patch Set Update : 11.2.0.4.160719 (23054359)&quot;</div><div class="line">Sub-patch  22502456; &quot;Database Patch Set Update : 11.2.0.4.160419 (22502456)&quot;</div><div class="line">Sub-patch  21948347; &quot;Database Patch Set Update : 11.2.0.4.160119 (21948347)&quot;</div><div class="line">Sub-patch  21352635; &quot;Database Patch Set Update : 11.2.0.4.8 (21352635)&quot;</div><div class="line">Sub-patch  20760982; &quot;Database Patch Set Update : 11.2.0.4.7 (20760982)&quot;</div><div class="line">Sub-patch  20299013; &quot;Database Patch Set Update : 11.2.0.4.6 (20299013)&quot;</div><div class="line">Sub-patch  19769489; &quot;Database Patch Set Update : 11.2.0.4.5 (19769489)&quot;</div><div class="line">Sub-patch  19121551; &quot;Database Patch Set Update : 11.2.0.4.4 (19121551)&quot;</div><div class="line">Sub-patch  18522509; &quot;Database Patch Set Update : 11.2.0.4.3 (18522509)&quot;</div><div class="line">Sub-patch  18031668; &quot;Database Patch Set Update : 11.2.0.4.2 (18031668)&quot;</div><div class="line">Sub-patch  17478514; &quot;Database Patch Set Update : 11.2.0.4.1 (17478514)&quot;</div><div class="line">   Bugs fixed:</div><div class="line">     17184721, 21538558, 16091637, 18092127, 17381384, 15979965, 18441944</div><div class="line">     13837378, 16314254, 16731148, 17835048, 13558557, 17201159, 17853498</div><div class="line">     17246576, 18356166, 18440047, 18681862, 16875449, 19788842, 17296856</div><div class="line">     21330264, 14010183, 17648596, 17551063, 17025461, 17267114, 22507210</div><div class="line">     17912217, 17889583, 18202441, 17040764, 16524926, 17478145, 19358317</div><div class="line">     22148226, 18747196, 18641419, 17036973, 17811789, 14285317, 16542886</div><div class="line">     18009564, 16618694, 8322815, 16692232, 18247991, 22507234, 17570240</div><div class="line">     17848897, 17441661, 14034426, 17465741, 16596890, 17437634, 20506706</div><div class="line">     21343897, 21453153, 18339044, 22321741, 17951233, 18430495, 21787056</div><div class="line">     22380919, 20506715, 17811429, 19721304, 18230522, 19554106, 19458377</div><div class="line">     6599380, 17612828, 22092979, 22321756, 17040527, 17811438, 18641461</div><div class="line">     14657740, 13364795, 21387964, 17346671, 17588480, 18235390, 17889549</div><div class="line">     19309466, 16472716, 20596234, 18331850, 18641451, 17344412, 21179898</div><div class="line">     17546761, 18203835, 18964939, 18203838, 18203837, 17313525, 22195457</div><div class="line">     18139690, 22296366, 14106803, 16837842, 17842825, 22657942, 21352646</div><div class="line">     20657441, 16360112, 22195441, 17389192, 14565184, 17205719, 14354737</div><div class="line">     22195448, 14764829, 13944971, 16571443, 21868720, 17186905, 17080436</div><div class="line">     18673342, 17027426, 19972569, 19972568, 19972566, 17282229, 19972564</div><div class="line">     16870214, 19615136, 17390431, 18762750, 16613964, 18098207, 17957017</div><div class="line">     18471685, 19730508, 21538485, 18264060, 17323222, 17754782, 17600719</div><div class="line">     18317531, 17852463, 17596908, 17655634, 20074391, 16228604, 19972570</div><div class="line">     18996843, 19854503, 16042673, 17835627, 20334344, 18000422, 20861693</div><div class="line">     17393683, 17551709, 20506699, 19006849, 18456514, 18277454, 17258090</div><div class="line">     17174582, 17242746, 16399083, 17824637, 17762296, 17397545, 16450169</div><div class="line">     12364061, 20067212, 18856999, 19211724, 19463893, 21343775, 19463897</div><div class="line">     17853456, 18673304, 20004021, 21668627, 16194160, 17477958, 16538760</div><div class="line">     12982566, 20296213, 18293054, 17610798, 19699191, 18135678, 17311728</div><div class="line">     16785708, 10136473, 17786518, 18315328, 18334586, 12747740, 19032867</div><div class="line">     18096714, 17390160, 17232014, 16422541, 18673325, 18155762, 14015842</div><div class="line">     19827973, 22683225, 17726838, 18554871, 23177648, 18051556, 20803583</div><div class="line">     18282562, 17922254, 15990359, 21972320, 16855292, 16668584, 21343838</div><div class="line">     20299015, 17446237, 18093615, 17694209, 17288409, 17274537, 13955826</div><div class="line">     16934803, 17634921, 17501491, 16315398, 22683212, 17006183, 13829543</div><div class="line">     18191164, 17655240, 19393542, 18384391, 21538567, 16198143, 21847223</div><div class="line">     17892268, 20142975, 19584068, 17165204, 18508861, 21756699, 16901385</div><div class="line">     18554763, 18189036, 17443671, 17385178, 17936109, 14829250, 20925795</div><div class="line">     17478514, 16850630, 13951456, 16595641, 15861775, 14054676, 16912439</div><div class="line">     17299889, 17297939, 18619917, 16833527, 17798953, 17816865, 18607546</div><div class="line">     17571306, 21286665, 17341326, 17851160, 20558005, 17586955, 19049453</div><div class="line">     21051840, 17587063, 16956380, 18328509, 14133975, 18061914, 21051833</div><div class="line">     18522509, 18765602, 18199537, 17332800, 13609098, 18384537, 22502493</div><div class="line">     14338435, 17945983, 21067387, 16392068, 17752995, 21051862, 17237521</div><div class="line">     16863422, 18244962, 19544839, 24433711, 17156148, 18973907, 17877323</div><div class="line">     17449815, 18180390, 17088068, 17037130, 20004087, 19466309, 11733603</div><div class="line">     18084625, 21051858, 18674024, 21051852, 18091059, 16306373, 18306996</div><div class="line">     19915271, 18193833, 17787259, 20631274, 16344544, 14692762, 18614015</div><div class="line">     17346091, 18228645, 17721717, 18436307, 11883252, 21756677, 17891943</div><div class="line">     22353199, 16384983, 19121551, 12816846, 17982555, 17761775, 22243719</div><div class="line">     17265217, 17071721, 16721594, 21756661, 18262334, 15913355, 17891946</div><div class="line">     17672719, 17602269, 17239687, 17042658, 17238511, 17811456, 17284817</div><div class="line">     17752121, 17394950, 16579084, 17011832, 22195465, 14602788, 18325460</div><div class="line">     24476265, 24476274, 12611721, 16903536, 17006570, 16043574, 18783224</div><div class="line">     16494615, 21526048, 19197175, 16069901, 17811447, 17308789, 22195477</div><div class="line">     17865671, 19013183, 17343514, 18316692, 17325413, 16180763, 17348614</div><div class="line">     14368995, 21983325, 17393915, 16285691, 20331945, 17883081, 24316947</div><div class="line">     17705023, 17614227, 22195485, 14084247, 13645875, 16777840, 19727057</div><div class="line">     14852021, 18744139, 18674047, 17716305, 18482502, 19289642, 17622427</div><div class="line">     22195492, 14458214, 18723434, 17767676, 19258504, 17786278, 17082983</div><div class="line">     21351877, 13498382, 18331812, 16065166, 18031668, 22893153, 16943711</div><div class="line">     21517440, 17649265, 13866822, 18094246, 24528741, 14245531, 17783588</div><div class="line">     17082359, 20448824, 18280813, 23330119, 16268425, 17302277, 18018515</div><div class="line">     17215560, 19271443, 17016369, 20777150, 23330124, 20441797, 19769489</div><div class="line">     17545847, 18260550, 13853126, 23536835, 17227277, 9756271, 18868646</div><div class="line">     17614134, 17546973, 19680952, 18704244, 18828868, 18273830, 17050888</div><div class="line">     17360606, 16992075, 17375354, 12905058, 18362222, 17571039, 17468141</div><div class="line">     18436647, 17235750, 21168487, 16220077, 16929165</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">--------------------------------------------------------------------------------</div><div class="line"></div><div class="line">OPatch succeeded.</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">set linesize 150;</div><div class="line">set pagesize 9999;</div><div class="line">col comp_name format a40;</div><div class="line">SELECT COMP_NAME, VERSION, STATUS FROM SYS.DBA_REGISTRY;</div><div class="line">--</div><div class="line">set linesize 500 pagesize 600</div><div class="line">col ACTION_TIME for a30</div><div class="line">col COMMENTS for a30</div><div class="line">select ACTION_TIME, ACTION,version, COMMENTS from sys.DBA_REGISTRY_HISTORY;</div></pre></td></tr></table></figure><p><img src="/images/2019/0124/01.png" alt="psu"></p><h1 id="启动监听"><a href="#启动监听" class="headerlink" title="启动监听"></a>启动监听</h1><p><code>lsnrctl start</code></p><h1 id="补丁回退"><a href="#补丁回退" class="headerlink" title="补丁回退"></a>补丁回退</h1><p><code>opatch rollback -id 24006111</code></p><p>参考文档：<br><a href="http://blog.itpub.net/26736162/viewspace-2096650/" target="_blank" rel="external">http://blog.itpub.net/26736162/viewspace-2096650/</a><br><a href="https://blogs.oracle.com/database4cn/oracle-v4" target="_blank" rel="external">https://blogs.oracle.com/database4cn/oracle-v4</a><br><a href="http://blog.51cto.com/hbxztc/1884214" target="_blank" rel="external">http://blog.51cto.com/hbxztc/1884214</a><br><a href="http://www.snapdba.com/2014/01/oracle-database-11gr2-11-2-0-4-installation-on-oracle-linux-6-4/#.XUJlIegzaUk" target="_blank" rel="external">http://www.snapdba.com/2014/01/oracle-database-11gr2-11-2-0-4-installation-on-oracle-linux-6-4/#.XUJlIegzaUk</a></p>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
            <tag> PSU </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>开源APM工具pinpoint搭建使用</title>
      <link href="/arlo/c47141fa/"/>
      <url>/arlo/c47141fa/</url>
      
        <content type="html"><![CDATA[<p>APM，全称：Application Performance Management （应用程序性能管理）。 在应用服务各节点相互调用的时候，从中记录并传递一个应用级别的标记，这个标记可以用来关联各个服务节点之间的关系。比如两个应用服务节点之间使用 HTTP 作为传输协议的话，那么这些标记就会被加入到 HTTP 头中。这样就可以更加精细化的分析应用性能，也就是计量应用程序在执行不同区域的代码已经完成事务过程找那个所消耗的具体时长，耗费资源情况。<br><strong>商用软件：OneAPM，听云，透视宝，Oracle的EMCC等</strong><br><strong>开源软件：<a href="https://www.infoq.cn/article/apm-Pinpoint-practice" target="_blank" rel="external">Pinpoint，SkyWalking，Zipkin，CAT</a>等</strong></p><p>Pinpoint是开源在github（项目地址：<a href="https://github.com/naver/pinpoint" target="_blank" rel="external">https://github.com/naver/pinpoint</a> ）上的一款APM监控工具，它是用Java编写的，用于大规模分布式系统监控。它对性能的影响最小（只增加约3％资源利用率），安装agent是无侵入式的，只需要在被测试的Tomcat中加上3行内容，添加探针，就可以监控整套程序了。<br><a id="more"></a></p><h1 id="软件环境"><a href="#软件环境" class="headerlink" title="软件环境"></a>软件环境</h1><p>官方给的<a href="http://naver.github.io/pinpoint/quickstart.html" target="_blank" rel="external">快速安装教程</a>，是使用git clone代码，然后build编译安装，这样时间比较慢，而且容易出错，不方便排查，所以我们这里直接从<a href="https://github.com/naver/pinpoint/releases/" target="_blank" rel="external">https://github.com/naver/pinpoint/releases/</a> 下载war包，进行部署！</p><p><em>ps：如果hbase和pinpoint-collector、pinpoint-web部署在同一台机器，不用单独部署zookeeper；如果是下载war包部署，也不用安装maven</em><br><em>ps：不要使用hbase2.0，否则首页server map不显示</em></p><table><thead><tr><th>组件</th><th>版本</th><th>功能</th><th>下载路径</th></tr></thead><tbody><tr><td>zookeeper</td><td>3.4.12</td><td>应用程序协调</td><td><a href="http://mirror.bit.edu.cn/apache/zookeeper/stable/zookeeper-3.4.12.tar.gz" target="_blank" rel="external">http://mirror.bit.edu.cn/apache/zookeeper/stable/zookeeper-3.4.12.tar.gz</a></td></tr><tr><td>hbase</td><td>1.2.9</td><td>存储收集的数据</td><td><a href="http://mirror.bit.edu.cn/apache/hbase/hbase-1.2.9/hbase-1.2.9-bin.tar.gz" target="_blank" rel="external">http://mirror.bit.edu.cn/apache/hbase/hbase-1.2.9/hbase-1.2.9-bin.tar.gz</a></td></tr><tr><td>pinpoint-collector</td><td>1.8.1</td><td>收集各种性能数据</td><td><a href="https://github.com/naver/pinpoint/releases/download/1.8.1/pinpoint-collector-1.8.1.war" target="_blank" rel="external">https://github.com/naver/pinpoint/releases/download/1.8.1/pinpoint-collector-1.8.1.war</a></td></tr><tr><td>pinpoint-web</td><td>1.8.1</td><td>数据WEB网页展示</td><td><a href="https://github.com/naver/pinpoint/releases/download/1.8.1/pinpoint-web-1.8.1.war" target="_blank" rel="external">https://github.com/naver/pinpoint/releases/download/1.8.1/pinpoint-web-1.8.1.war</a></td></tr><tr><td>pinpoint-agent</td><td>1.8.1</td><td>应用关联探针</td><td><a href="https://github.com/naver/pinpoint/releases/download/1.8.1/pinpoint-agent-1.8.1.tar.gz" target="_blank" rel="external">https://github.com/naver/pinpoint/releases/download/1.8.1/pinpoint-agent-1.8.1.tar.gz</a></td></tr><tr><td>Oracle JDK</td><td>1.8</td><td>JAVA运行环境</td><td><a href="https://www.oracle.com/technetwork/java/archive-139210.html" target="_blank" rel="external">https://www.oracle.com/technetwork/java/archive-139210.html</a></td></tr><tr><td>apache-tomcat</td><td>8.5.37</td><td>web容器</td><td><a href="http://mirror.bit.edu.cn/apache/tomcat/tomcat-8/v8.5.37/bin/apache-tomcat-8.5.37.tar.gz" target="_blank" rel="external">http://mirror.bit.edu.cn/apache/tomcat/tomcat-8/v8.5.37/bin/apache-tomcat-8.5.37.tar.gz</a></td></tr><tr><td>apache-maven</td><td>3.3.9</td><td>编译环境</td><td><a href="http://apache.mirrors.lucidnetworks.net/maven/maven-3/" target="_blank" rel="external">http://apache.mirrors.lucidnetworks.net/maven/maven-3/</a></td></tr></tbody></table><h1 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h1><p><img src="/images/2019/0108/01.png" alt="pinpoint"></p><h1 id="支持的模块"><a href="#支持的模块" class="headerlink" title="支持的模块"></a>支持的模块</h1><ul><li>JDK 6+</li><li>Tomcat 6/7/8/9, Jetty 8/9, JBoss EAP 6/7, Resin 4, Websphere 6/7/8, Vertx 3.3/3.4/3.5, Weblogic 10/11g/12c, Undertow</li><li>Spring, Spring Boot (Embedded Tomcat, Jetty), Spring asynchronous communication</li><li>Apache HTTP Client 3.x/4.x, JDK HttpConnector, GoogleHttpClient, OkHttpClient, NingAsyncHttpClient, Akka-http, Apache CXF</li><li>Thrift Client, Thrift Service, DUBBO PROVIDER, DUBBO CONSUMER, GRPC</li><li>ActiveMQ, RabbitMQ, Kafka</li><li>MySQL, Oracle, MSSQL(jtds), CUBRID, POSTGRESQL, MARIA</li><li>Arcus, Memcached, Redis(Jedis, Lettuce), CASSANDRA, MongoDB, Hbase</li><li>iBATIS, MyBatis</li><li>DBCP, DBCP2, HIKARICP, DRUID</li><li>gson, Jackson, Json Lib, Fastjson</li><li>log4j, Logback</li></ul><h1 id="组件兼容性"><a href="#组件兼容性" class="headerlink" title="组件兼容性"></a>组件兼容性</h1><p><img src="/images/2019/0108/02.png" alt="pinpoint"></p><h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><h2 id="查看主机名"><a href="#查看主机名" class="headerlink" title="查看主机名"></a>查看主机名</h2><p><code>cat /etc/hostname</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pinpoint_server</div></pre></td></tr></table></figure></p><h2 id="添加主机名解析"><a href="#添加主机名解析" class="headerlink" title="添加主机名解析"></a>添加主机名解析</h2><p><code>cat /etc/hosts</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</div><div class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</div><div class="line">127.0.0.1 pinpoint_server</div></pre></td></tr></table></figure></p><h2 id="准备所需的软件包"><a href="#准备所需的软件包" class="headerlink" title="准备所需的软件包"></a>准备所需的软件包</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@pinpoint_server ~]# cd /usr/local/src/pinpoint</div><div class="line">[root@pinpoint_server pinpoint]# ll</div><div class="line">total 499488</div><div class="line">-rw-r--r-- 1 root root   9584807 Jan  9 08:52 apache-tomcat-8.5.32.tar.gz</div><div class="line">-rw-r--r-- 1 root root 105514702 Jan  9 08:52 hbase-1.2.9-bin.tar.gz</div><div class="line">-rw-r--r-- 1 root root     16984 Jan  9 08:52 hbase-create.hbase</div><div class="line">-rw-r--r-- 1 root root 183212596 Jan  9 09:03 jdk-8u112-linux-x64.tar.gz</div><div class="line">-rw-r--r-- 1 root root  16507792 Jan  9 08:52 pinpoint-agent-1.8.1.tar.gz</div><div class="line">-rw-r--r-- 1 root root  62644974 Jan  9 08:52 pinpoint-collector-1.8.1.war</div><div class="line">-rw-r--r-- 1 root root  97301169 Jan  9 08:52 pinpoint-web-1.8.1.war</div><div class="line">-rw-r--r-- 1 root root  36667596 Jan  9 08:52 zookeeper-3.4.12.tar.gz</div></pre></td></tr></table></figure><h1 id="安装JDK"><a href="#安装JDK" class="headerlink" title="安装JDK"></a>安装JDK</h1><p><code>tar xf jdk-8u112-linux-x64.tar.gz -C /usr/local/</code><br><code>vim /etc/profile</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">export HISTSIZE=10000</div><div class="line">export HISTTIMEFORMAT=&quot;%F %T &quot;</div><div class="line">export JAVA_HOME=/usr/local/jdk1.8.0_112/</div><div class="line">export JAVA_8_HOME=/usr/local/jdk1.8.0_112/</div><div class="line">export CLASSPATH=.:$JAVA_HOME/lib/:$JAVA_HOME/jre/lib/</div><div class="line">export PATH=$JAVA_HOME/bin:$PATH</div></pre></td></tr></table></figure></p><p><code>source /etc/profile</code></p><h1 id="安装hbase"><a href="#安装hbase" class="headerlink" title="安装hbase"></a>安装hbase</h1><h2 id="解压软件包"><a href="#解压软件包" class="headerlink" title="解压软件包"></a>解压软件包</h2><p><code>tar xf hbase-1.2.9-bin.tar.gz -C /usr/local/</code><br><code>cd /usr/local/hbase-1.2.9/conf/</code></p><h2 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h2><p><code>vim hbase-env.sh</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#在27行左右配置JAVA_HOME</div><div class="line">export JAVA_HOME=/usr/local/jdk1.8.0_112/</div></pre></td></tr></table></figure></p><p><code>vim hbase-site.xml</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&lt;configuration&gt;</div><div class="line">    &lt;property&gt;</div><div class="line">        &lt;name&gt;hbase.rootdir&lt;/name&gt;</div><div class="line">        &lt;value&gt;file:///data/pinpoint/hbase&lt;/value&gt;</div><div class="line">    &lt;/property&gt;</div><div class="line">    &lt;property&gt;</div><div class="line">        &lt;name&gt;hbase.zookeeper.property.dataDir&lt;/name&gt;</div><div class="line">        &lt;value&gt;/data/pinpoint/zookeeper&lt;/value&gt;</div><div class="line">    &lt;/property&gt;</div><div class="line">    &lt;property&gt;</div><div class="line">        &lt;name&gt;hbase.master.port&lt;/name&gt;</div><div class="line">        &lt;value&gt;60000&lt;/value&gt;</div><div class="line">    &lt;/property&gt;</div><div class="line">    &lt;property&gt;</div><div class="line">        &lt;name&gt;hbase.regionserver.port&lt;/name&gt;</div><div class="line">        &lt;value&gt;60020&lt;/value&gt;</div><div class="line">    &lt;/property&gt;</div><div class="line">&lt;/configuration&gt;</div></pre></td></tr></table></figure></p><h2 id="新建数据目录"><a href="#新建数据目录" class="headerlink" title="新建数据目录"></a>新建数据目录</h2><p><code>mkdir -p /data/pinpoint/hbase</code><br><code>mkdir -p /data/pinpoint/zookeeper</code></p><h2 id="启动hbase服务"><a href="#启动hbase服务" class="headerlink" title="启动hbase服务"></a>启动hbase服务</h2><p><code>cd /usr/local/hbase-1.2.9/bin</code><br> <code>./start-hbase.sh</code><br>查看启动日志<br><code>tailf /usr/local/hbase-1.2.9/bin/../logs/hbase-root-master-pinpoint_server.log</code><br>也可以通过web控制台 <a href="http://192.168.6.140:16010/" target="_blank" rel="external">http://192.168.6.140:16010/</a> 来访问hbase<br><img src="/images/2019/0108/03.png" alt="pinpoint"></p><h2 id="导入hbase数据"><a href="#导入hbase数据" class="headerlink" title="导入hbase数据"></a>导入hbase数据</h2><p>下载这个hbase数据 <a href="https://github.com/naver/pinpoint/tree/master/hbase/scripts/hbase-create.hbase" target="_blank" rel="external">https://github.com/naver/pinpoint/tree/master/hbase/scripts/hbase-create.hbase</a><br><em>$HBASE_HOME/bin/hbase shell $PATH_TO_SCRIPTS/hbase-create.hbase</em><br><code>/usr/local/hbase-1.2.9/bin/hbase shell /usr/local/src/pinpoint/hbase-create.hbase</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">2019-01-09 09:20:19,016 WARN  [main] util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable</div><div class="line">0 row(s) in 1.5720 seconds</div><div class="line"></div><div class="line">0 row(s) in 2.2760 seconds</div><div class="line"></div><div class="line">0 row(s) in 4.3110 seconds</div><div class="line"></div><div class="line">0 row(s) in 1.2430 seconds</div><div class="line"></div><div class="line">0 row(s) in 1.2840 seconds</div><div class="line"></div><div class="line">0 row(s) in 1.2550 seconds</div><div class="line"></div><div class="line">0 row(s) in 1.2400 seconds</div><div class="line"></div><div class="line">0 row(s) in 1.2540 seconds</div><div class="line"></div><div class="line">0 row(s) in 2.2630 seconds</div><div class="line"></div><div class="line">0 row(s) in 4.2830 seconds</div><div class="line"></div><div class="line">0 row(s) in 18.4010 seconds</div><div class="line"></div><div class="line">0 row(s) in 2.2570 seconds</div><div class="line"></div><div class="line">0 row(s) in 2.2760 seconds</div><div class="line"></div><div class="line">0 row(s) in 2.2510 seconds</div><div class="line"></div><div class="line">0 row(s) in 2.2520 seconds</div><div class="line"></div><div class="line">0 row(s) in 1.2370 seconds</div><div class="line"></div><div class="line">TABLE                                                                                                                                  </div><div class="line">AgentEvent                                                                                                                             </div><div class="line">AgentInfo                                                                                                                              </div><div class="line">AgentLifeCycle                                                                                                                         </div><div class="line">AgentStat                                                                                                                              </div><div class="line">AgentStatV2                                                                                                                            </div><div class="line">ApiMetaData                                                                                                                            </div><div class="line">ApplicationIndex                                                                                                                       </div><div class="line">ApplicationMapStatisticsCallee_Ver2                                                                                                    </div><div class="line">ApplicationMapStatisticsCaller_Ver2                                                                                                    </div><div class="line">ApplicationMapStatisticsSelf_Ver2                                                                                                      </div><div class="line">ApplicationTraceIndex                                                                                                                  </div><div class="line">HostApplicationMap_Ver2                                                                                                                </div><div class="line">SqlMetaData_Ver2                                                                                                                       </div><div class="line">StringMetaData                                                                                                                         </div><div class="line">TraceV2                                                                                                                                </div><div class="line">Traces                                                                                                                                 </div><div class="line">16 row(s) in 0.0400 seconds</div></pre></td></tr></table></figure></p><p><code>./hbase shell</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">2019-01-09 10:55:54,792 WARN  [main] util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable</div><div class="line">HBase Shell; enter &apos;help&lt;RETURN&gt;&apos; for list of supported commands.</div><div class="line">Type &quot;exit&lt;RETURN&gt;&quot; to leave the HBase Shell</div><div class="line">Version 1.2.9, rfd0d55b1e5ef54eb9bf60cce1f0a8e4c1da073ef, Sat Nov 17 21:43:34 CST 2018</div><div class="line"></div><div class="line">hbase(main):001:0&gt; status &apos;detailed&apos;</div><div class="line">version 1.2.9</div><div class="line">0 regionsInTransition</div><div class="line">active master:  localhost:44182 1546996425069</div><div class="line">0 backup masters</div><div class="line">master coprocessors: []</div><div class="line">1 live servers</div><div class="line">    localhost:33288 1546996426037</div><div class="line">        requestsPerSecond=0.0, numberOfOnlineRegions=498, usedHeapMB=456, maxHeapMB=931, numberOfStores=626, numberOfStorefiles=3, storefileUncompressedSizeMB=0, storefileSizeMB=0, memstoreSizeMB=0, storefileIndexSizeMB=0, readRequestsCount=16623, writeRequestsCount=8095, rootIndexSizeKB=6, totalStaticIndexSizeKB=4, totalStaticBloomSizeKB=0, totalCompactingKVs=0, currentCompactedKVs=0, compactionProgressPct=NaN, coprocessors=[MultiRowMutationEndpoint]</div><div class="line">……</div></pre></td></tr></table></figure></p><p>当然也可以通过web控制台查看数据初始化是否成功！</p><h1 id="安装pinpoint-collector"><a href="#安装pinpoint-collector" class="headerlink" title="安装pinpoint-collector"></a>安装pinpoint-collector</h1><p>部署过程很简单，起一个web容器（tomcat），把下载的war包扔进去就可以了</p><h2 id="解压tomcat"><a href="#解压tomcat" class="headerlink" title="解压tomcat"></a>解压tomcat</h2><p><code>tar xf apache-tomcat-8.5.32.tar.gz -C /usr/local/</code><br><code>cd /usr/local/</code><br><code>mv apache-tomcat-8.5.32/ tomcat_pinpoint-collector</code><br><code>cd tomcat_pinpoint-collector/</code></p><h2 id="删除默认的应用"><a href="#删除默认的应用" class="headerlink" title="删除默认的应用"></a>删除默认的应用</h2><p><code>rm -fr webapps/*</code></p><h2 id="部署-pinpoint-collector-1-8-1-war"><a href="#部署-pinpoint-collector-1-8-1-war" class="headerlink" title="部署 pinpoint-collector-1.8.1.war"></a>部署 pinpoint-collector-1.8.1.war</h2><p>拷贝pinpoint-collector-1.8.1.war到webapps目录下，重命名为ROOT.war,改名只是为了访问的时候不用加上下文对象名称，就是懒~~~<br><code>cp /usr/local/src/pinpoint/pinpoint-collector-1.8.1.war webapps/ROOT.war</code></p><h2 id="启动tomcat服务"><a href="#启动tomcat服务" class="headerlink" title="启动tomcat服务"></a>启动tomcat服务</h2><p><code>bin/startup.sh</code></p><h1 id="安装pinpoint-web"><a href="#安装pinpoint-web" class="headerlink" title="安装pinpoint-web"></a>安装pinpoint-web</h1><h2 id="解压tomcat-1"><a href="#解压tomcat-1" class="headerlink" title="解压tomcat"></a>解压tomcat</h2><p><code>tar xf apache-tomcat-8.5.32.tar.gz -C /usr/local/</code><br><code>cd /usr/local/</code><br><code>mv apache-tomcat-8.5.32 tomcat_pinpoint-web</code></p><h2 id="修改tomcat端口"><a href="#修改tomcat端口" class="headerlink" title="修改tomcat端口"></a>修改tomcat端口</h2><p>由于已经有一个tomcat把默认的端口都占用了，我们这里修改一下tomcat使用到的端口<br><code>cd tomcat_pinpoint-web/conf</code><br><code>sed -i &#39;s/port=&quot;8005&quot;/port=&quot;18005&quot;/g&#39; server.xml</code><br><code>sed -i &#39;s/port=&quot;8080&quot;/port=&quot;18080&quot;/g&#39; server.xml</code><br><code>sed -i &#39;s/port=&quot;8443&quot;/port=&quot;18443&quot;/g&#39; server.xml</code><br><code>sed -i &#39;s/port=&quot;8009&quot;/port=&quot;18009&quot;/g&#39; server.xml</code><br><code>sed -i &#39;s/redirectPort=&quot;8443&quot;/redirectPort=&quot;18443&quot;/g&#39; server.xml</code><br><code>sed -i &quot;s/localhost/192.168.6.140/g&quot; server.xml</code></p><h2 id="删除默认的应用-1"><a href="#删除默认的应用-1" class="headerlink" title="删除默认的应用"></a>删除默认的应用</h2><p><code>rm -fr ../webapps/*</code><br><code>cp /usr/local/src/pinpoint/pinpoint-web-1.8.1.war /usr/local/tomcat_pinpoint-web/webapps/ROOT.war</code><br><code>bin/startup.sh</code><br>访问web控制台<a href="http://192.168.6.140:18080" target="_blank" rel="external">http://192.168.6.140:18080</a><br><img src="/images/2019/0108/04.png" alt="pinpoint"></p><h1 id="安装pinpoint-agent"><a href="#安装pinpoint-agent" class="headerlink" title="安装pinpoint-agent"></a>安装pinpoint-agent</h1><p>部署探针也很简单，就是在tomcat的启动配置文件中添加以下三行内容即可</p><h2 id="添加linux探针"><a href="#添加linux探针" class="headerlink" title="添加linux探针"></a>添加linux探针</h2><p><code>mkdir -p /usr/local/pinpoint-agent</code><br><code>tar xf pinpoint-agent-1.8.1.tar.gz -C  /usr/local/pinpoint-agent</code><br><code>/usr/local/pinpoint-agent</code><br><code>vim pinpoint.config</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">profiler.collector.ip=192.168.6.140</div></pre></td></tr></table></figure></p><h3 id="检测一下agent和服务端的通信情况"><a href="#检测一下agent和服务端的通信情况" class="headerlink" title="检测一下agent和服务端的通信情况"></a>检测一下agent和服务端的通信情况</h3><p>如果有问题，大部分情况下是pinpoint和hbase之间的连通性问题<br><code>sh script/networktest.sh</code><br><img src="/images/2019/0108/05.png" alt="pinpoint"></p><p><code>tar xf apache-tomcat-8.5.32.tar.gz -C /usr/local/</code><br><code>mv apache-tomcat-8.5.32/ tomcat_test</code><br><code>cd tomcat_test/conf/</code><br>和之前一样，因为本机的tomcat端口被占用，我们修改一下相关端口<br><code>sed -i &#39;s/port=&quot;8005&quot;/port=&quot;28005&quot;/g&#39; server.xml</code><br><code>sed -i &#39;s/port=&quot;8080&quot;/port=&quot;28080&quot;/g&#39; server.xml</code><br><code>sed -i &#39;s/port=&quot;8443&quot;/port=&quot;28443&quot;/g&#39; server.xml</code><br><code>sed -i &#39;s/port=&quot;8009&quot;/port=&quot;28009&quot;/g&#39; server.xml</code><br><code>sed -i &#39;s/redirectPort=&quot;8443&quot;/redirectPort=&quot;28443&quot;/g&#39; server.xml</code><br><code>sed -i &quot;s/localhost/192.168.6.140/g&quot; server.xml</code></p><p><code>vim catalina.sh</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># for pinpoint agent</div><div class="line">AGENT_PATH=/usr/local/pinpoint-agent</div><div class="line">AGENT_VERSION=1.8.1</div><div class="line">AGENT_ID=&quot;agent001&quot;</div><div class="line">APPLICATION_NAME=&quot;test_140_28080&quot;</div><div class="line">CATALINA_OPTS=&quot;$CATALINA_OPTS -javaagent:$AGENT_PATH/pinpoint-bootstrap-$AGENT_VERSION.jar&quot;</div><div class="line">CATALINA_OPTS=&quot;$CATALINA_OPTS -Dpinpoint.agentId=$AGENT_ID&quot;</div><div class="line">CATALINA_OPTS=&quot;$CATALINA_OPTS -Dpinpoint.applicationName=$APPLICATION_NAME&quot;</div></pre></td></tr></table></figure><p><img src="/images/2019/0108/06.png" alt="pinpoint"><br><code>bin/startup.sh</code><br><img src="/images/2019/0108/07.png" alt="pinpoint"></p><h2 id="添加windows探针"><a href="#添加windows探针" class="headerlink" title="添加windows探针"></a>添加windows探针</h2><p>由于我这边目前大部分项目都是在windows跑的，我们添加两个windows探针看一下真实的效果<br>解压pinpoint-agent-1.8.1.tar.gz到D:/pinpoint-agent/<br>修改配置文件pinpoint.config<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">profiler.collector.ip=192.168.6.140</div></pre></td></tr></table></figure></p><p>修改D:\apache-tomcat-8082\bin\catalina.bat文件，添加到最前边即可<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">set CATALINA_OPTS=%CATALINA_OPTS% -javaagent:D:/pinpoint-agent/pinpoint-bootstrap-1.8.1.jar</div><div class="line">set CATALINA_OPTS=%CATALINA_OPTS% -Dpinpoint.agentId=agent002</div><div class="line">set CATALINA_OPTS=%CATALINA_OPTS% -Dpinpoint.applicationName=172_8082</div></pre></td></tr></table></figure></p><p><img src="/images/2019/0108/08.png" alt="pinpoint"><br>修改D:\apache-tomcat-ou\bin\catalina.bat文件，添加到最前边即可<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">set CATALINA_OPTS=%CATALINA_OPTS% -javaagent:D:/pinpoint-agent/pinpoint-bootstrap-1.8.1.jar</div><div class="line">set CATALINA_OPTS=%CATALINA_OPTS% -Dpinpoint.agentId=agent003</div><div class="line">set CATALINA_OPTS=%CATALINA_OPTS% -Dpinpoint.applicationName=172_8081</div></pre></td></tr></table></figure></p><p>启动tomcat后，我们打开pinpoint-web控制台<br><img src="/images/2019/0108/09.png" alt="pinpoint"></p><h2 id="微服务springboot添加pinpoint探针"><a href="#微服务springboot添加pinpoint探针" class="headerlink" title="微服务springboot添加pinpoint探针"></a>微服务springboot添加pinpoint探针</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/jdk1.8.0_202/bin/java -jar -javaagent:/usr/local/ths/pinpoint-agent/pinpoint-bootstrap-1.8.4.jar  -Dpinpoint.agentId=monitor-china-server -Dpinpoint.applicationName=chinaserver /usr/local/ths/monitor-china-server.jar</div></pre></td></tr></table></figure><h1 id="web控制台简单应用"><a href="#web控制台简单应用" class="headerlink" title="web控制台简单应用"></a>web控制台简单应用</h1><p>通过这个图，我们就能看到项目应用直接的依赖关系<br><img src="/images/2019/0108/10.png" alt="pinpoint"><br><img src="/images/2019/0108/11.png" alt="pinpoint"><br><img src="/images/2019/0108/12.png" alt="pinpoint"></p><h1 id="删除应用"><a href="#删除应用" class="headerlink" title="删除应用"></a>删除应用</h1><p>如果有调试时产生已经废弃的应用，我们可以使用管理员api调用删除，可以使用应用名称（ <code>/admin/removeApplicationName.pinpoint?applicationName=$APPLICATION_NAME&amp;password=$PASSWORD</code>）或者客户端id（<code>/admin/removeAgentId.pinpoint?applicationName=$APPLICATION_NAME&amp;agentId=$AGENT_ID&amp;password=$PASSWORD</code>）两种方法删除；$PASSWORD为<code>pinpoint-web.properties</code>文件中的<code>admin.password</code>配置项值。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#示例</div><div class="line">http://172.16.10.24:8080/admin/removeApplicationName.pinpoint?applicationName=chinaserver.jar&amp;password=admin</div></pre></td></tr></table></figure></p><p>参考链接；<br><a href="https://www.infoq.cn/article/apm-Pinpoint-practice" target="_blank" rel="external">https://www.infoq.cn/article/apm-Pinpoint-practice</a><br><a href="https://www.cnblogs.com/yyhh/p/6106472.html" target="_blank" rel="external">https://www.cnblogs.com/yyhh/p/6106472.html</a><br><a href="https://github.com/naver/pinpoint/releases" target="_blank" rel="external">https://github.com/naver/pinpoint/releases</a><br><a href="https://blog.csdn.net/wh211212/article/details/80437696" target="_blank" rel="external">https://blog.csdn.net/wh211212/article/details/80437696</a></p><hr>]]></content>
      
      
      <categories>
          
          <category> 监控 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 监控 </tag>
            
            <tag> pinpoint </tag>
            
            <tag> APM </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>记一次oracle故障排查记录</title>
      <link href="/arlo/f82f70f8/"/>
      <url>/arlo/f82f70f8/</url>
      
        <content type="html"><![CDATA[<h1 id="故障现象"><a href="#故障现象" class="headerlink" title="故障现象"></a>故障现象</h1><p>window操作系统，oracle 11.2.0.1.0版本，意外断电后计算机服务中可以启动oracle服务和监听服务，但是无法连接；<br>使用sqlplus连接上去发现数据库未启动，尝试手动starup启动数据库，提示”ORA-03113:通信通道的文件结尾，进程id:7776 会话  ID: 322 序列号：25”的错误。<br>进入到oracle 日志目录下，在alter_yangquan123.log发现有明显报错“ORA-00338: log 1 of thread 1 is more recent than control file”，该错误意思是redo日志中的记录比控制文件新。<br><a id="more"></a></p><h1 id="ORA-00338-log-1-of-thread-1-is-more-recent-than-control-file"><a href="#ORA-00338-log-1-of-thread-1-is-more-recent-than-control-file" class="headerlink" title="ORA-00338: log 1 of thread 1 is more recent than control file"></a>ORA-00338: log 1 of thread 1 is more recent than control file</h1><h2 id="手动创建控制文件"><a href="#手动创建控制文件" class="headerlink" title="手动创建控制文件"></a>手动创建控制文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">oradebug setmypid</div><div class="line">oradebug tracefile_name</div><div class="line">alter database backup controlfile to trace;</div><div class="line">select value from v$diag_info where name =&apos;Diag Trace&apos;;</div></pre></td></tr></table></figure><p><img src="/images/2018/1214/01.png" alt="ora"></p><h2 id="查看错误日志"><a href="#查看错误日志" class="headerlink" title="查看错误日志"></a>查看错误日志</h2><p>在alert_yangquan123.log日志中，我们可以看到以下这段<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">alter database backup controlfile to trace</div><div class="line">Backup controlfile written to trace file e:\app\adminsilu\diag\rdbms\yangquan123\trace\yangquan123_ora_20768.trc</div><div class="line">Completed: alter database backup controlfile to trace</div></pre></td></tr></table></figure></p><p>打开<code>e:\app\adminsilu\diag\rdbms\yangquan123\trace\yangquan123_ora_20768.trc</code>文件，复制一下这段，在sql窗口执行</p><h2 id="手动运行sql语句启动"><a href="#手动运行sql语句启动" class="headerlink" title="手动运行sql语句启动"></a>手动运行sql语句启动</h2><p><code>sqlplus / as sysdba</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">SQL&gt; STARTUP NOMOUNT#在sql窗口执行以下命令</div><div class="line">CREATE CONTROLFILE REUSE DATABASE &quot;YANGQUAN&quot; NORESETLOGS  NOARCHIVELOG</div><div class="line">    MAXLOGFILES 16</div><div class="line">    MAXLOGMEMBERS 3</div><div class="line">    MAXDATAFILES 100</div><div class="line">    MAXINSTANCES 8</div><div class="line">    MAXLOGHISTORY 292</div><div class="line">LOGFILE</div><div class="line">  GROUP 1 &apos;E:\APP\ADMINSILU\ORADATA\YANGQUAN123\REDO01.LOG&apos;  SIZE 50M BLOCKSIZE 512,</div><div class="line">  GROUP 2 &apos;E:\APP\ADMINSILU\ORADATA\YANGQUAN123\REDO02.LOG&apos;  SIZE 50M BLOCKSIZE 512,</div><div class="line">  GROUP 3 &apos;E:\APP\ADMINSILU\ORADATA\YANGQUAN123\REDO03.LOG&apos;  SIZE 50M BLOCKSIZE 512</div><div class="line">-- STANDBY LOGFILE</div><div class="line">DATAFILE</div><div class="line">  &apos;E:\APP\ADMINSILU\ORADATA\YANGQUAN123\SYSTEM01.DBF&apos;,</div><div class="line">  &apos;E:\APP\ADMINSILU\ORADATA\YANGQUAN123\SYSAUX01.DBF&apos;,</div><div class="line">  &apos;E:\APP\ADMINSILU\ORADATA\YANGQUAN123\UNDOTBS01.DBF&apos;,</div><div class="line">  &apos;E:\APP\ADMINSILU\ORADATA\YANGQUAN123\USERS01.DBF&apos;,</div><div class="line">  &apos;E:\APP\ADMINSILU\ORADATA\YANGQUAN123\EXAMPLE01.DBF&apos;,</div><div class="line">  &apos;E:\ORACLE_DATABASEFILES\AIR_DATA.DBF&apos;</div><div class="line">CHARACTER SET ZHS16GBK</div><div class="line">;</div></pre></td></tr></table></figure></p><p>启动之后查看数据库状态<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">select name,open_mode from v$database;#数据库状态已经Open了</div><div class="line">select * from dual;</div></pre></td></tr></table></figure></p><p>但是，但是几秒钟之后实例就宕掉了<br><img src="/images/2018/1214/02.png" alt="ora"></p><h1 id="ORA-00600-internal-error-code-arguments-4194"><a href="#ORA-00600-internal-error-code-arguments-4194" class="headerlink" title="ORA-00600: internal error code, arguments: [4194], [], [], [], [], [], [], [], [], [], [], []"></a>ORA-00600: internal error code, arguments: [4194], [], [], [], [], [], [], [], [], [], [], []</h1><p>再次查看alter日志，发现有新的报错了<code>ORA-00600: internal error code, arguments: [4194], [], [], [], [], [], [], [], [], [], [], []</code><br><img src="/images/2018/1214/03.png" alt="ora"></p><h2 id="通过spfile创建生成pfile"><a href="#通过spfile创建生成pfile" class="headerlink" title="通过spfile创建生成pfile"></a>通过spfile创建生成pfile</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SQL&gt; create pfile from spfile;#创建出来的文件windows在$ORACLE_HOME/database目录下，Linux在$ORACLE_HOME/dbs目录下，格式为initORACLE_SID.ora</div></pre></td></tr></table></figure><h2 id="关闭数据库"><a href="#关闭数据库" class="headerlink" title="关闭数据库"></a>关闭数据库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SQL&gt; shutdown immediate</div></pre></td></tr></table></figure><h2 id="修改pfile"><a href="#修改pfile" class="headerlink" title="修改pfile"></a>修改pfile</h2><p>打开inityangquan123.ora文件，修改其中的两行内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">*.undo_management=&apos;MANUAL&apos;</div><div class="line">*.undo_tablespace=&apos;UNDOTBS&apos;</div></pre></td></tr></table></figure></p><h2 id="使用pfile启动数据库"><a href="#使用pfile启动数据库" class="headerlink" title="使用pfile启动数据库"></a>使用pfile启动数据库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">startup restrict pfile=&apos;E:\app\adminsilu\product\11.2.0\dbhome_1\database\inityangquan123.ora&apos;</div></pre></td></tr></table></figure><h2 id="查看undo文件"><a href="#查看undo文件" class="headerlink" title="查看undo文件"></a>查看undo文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select tablespace_name, status, segment_name from dba_rollback_segs where status != &apos;OFFLINE&apos;;</div><div class="line"> </div><div class="line">TABLESPACE_NAME                STATUS           SEGMENT_NAME</div><div class="line">------------------------------ ---------------- ------------------------------</div><div class="line">SYSTEM                         ONLINE           SYSTEM</div></pre></td></tr></table></figure><h2 id="新建一个UNDO表空间"><a href="#新建一个UNDO表空间" class="headerlink" title="新建一个UNDO表空间"></a>新建一个UNDO表空间</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SQL&gt; create undo tablespace UNDOTBS1 datafile &apos;E:\APP\ADMINSILU\ORADATA\YANGQUAN123\UNDOTBS_01.dbf&apos; size 4G;</div></pre></td></tr></table></figure><h2 id="删除旧的UNDO表空间"><a href="#删除旧的UNDO表空间" class="headerlink" title="删除旧的UNDO表空间"></a>删除旧的UNDO表空间</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SQL&gt; drop tablespace UNDOTBS including contents and datafiles;</div></pre></td></tr></table></figure><h2 id="关闭数据库实例"><a href="#关闭数据库实例" class="headerlink" title="关闭数据库实例"></a>关闭数据库实例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SQL&gt; shutdown immediate;</div></pre></td></tr></table></figure><h2 id="启动数据库实例到NOMOUNT状态"><a href="#启动数据库实例到NOMOUNT状态" class="headerlink" title="启动数据库实例到NOMOUNT状态"></a>启动数据库实例到NOMOUNT状态</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SQL&gt; startup nomount;</div></pre></td></tr></table></figure><h2 id="修改spfile中的undo-tablespace参数"><a href="#修改spfile中的undo-tablespace参数" class="headerlink" title="修改spfile中的undo_tablespace参数"></a>修改spfile中的undo_tablespace参数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter system set undo_tablespace=&apos;UNDOTBS1&apos; scope=spfile;</div></pre></td></tr></table></figure><h2 id="启动数据库实例（使用spfile）"><a href="#启动数据库实例（使用spfile）" class="headerlink" title="启动数据库实例（使用spfile）"></a>启动数据库实例（使用spfile）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">SQL&gt; startup;</div><div class="line">SQL&gt; select name,open_mode from v$database; #查看数据库状态并监测</div></pre></td></tr></table></figure><p>几分钟后发现数据库未关闭，但是日志中依然有报错</p><h1 id="ORA-08102-index-key-not-found，obj-289，file-1，block-2025-2"><a href="#ORA-08102-index-key-not-found，obj-289，file-1，block-2025-2" class="headerlink" title="ORA-08102: index key not found，obj#289，file 1，block 2025(2);"></a>ORA-08102: index key not found，obj#289，file 1，block 2025(2);</h1><h2 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">SQL&gt; col object_name format a15;</div><div class="line">SQL&gt; col owner format a10;</div><div class="line">SQL&gt; select o.owner, o.object_name, o.object_id, o.object_type from dba_objects o where o.object_id = 289;</div><div class="line"></div><div class="line">OWNER      OBJECT_NAME      OBJECT_ID OBJECT_TYPE</div><div class="line">----------    ---------------           ----------      -------------------</div><div class="line">SYS           I_JOB_NEXT             289              INDEX</div><div class="line"></div><div class="line">SQL&gt; drop index i_job_next;</div></pre></td></tr></table></figure><h2 id="重建索引"><a href="#重建索引" class="headerlink" title="重建索引"></a>重建索引</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SQL&gt; create index i_job_next on job$ (next_date);</div></pre></td></tr></table></figure><h1 id="数据库实例未能加到监听中"><a href="#数据库实例未能加到监听中" class="headerlink" title="数据库实例未能加到监听中"></a>数据库实例未能加到监听中</h1><p>检查了各种文件都正常，手动<code>alter system register</code>也不行，无奈之下，使用netca重新配置了监听。</p><p>参考链接：<br><a href="https://blog.csdn.net/zwk626542417/article/details/39667999" target="_blank" rel="external">https://blog.csdn.net/zwk626542417/article/details/39667999</a><br><a href="http://www.cnblogs.com/kerrycode/p/6085447.html" target="_blank" rel="external">http://www.cnblogs.com/kerrycode/p/6085447.html</a><br><a href="https://blog.csdn.net/lwei_998/article/details/5920133" target="_blank" rel="external">https://blog.csdn.net/lwei_998/article/details/5920133</a></p>]]></content>
      
      
      <categories>
          
          <category> Troubleshooting </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>N2N内网穿透(打洞)软件使用</title>
      <link href="/arlo/1d2bb16a/"/>
      <url>/arlo/1d2bb16a/</url>
      
        <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>首先说一下这个<a href="https://github.com/ntop/n2n" target="_blank" rel="external">N2N</a>软件的背景，这个是培训oracle的时候，安装rac需要多块网卡，云服务器不像本地服务器或者虚拟机那边方便，可以随便随便添加网口，使用到N2N这款软件模拟出多块网卡；<br>其实N2N软件的主要功能是内网穿透，就是将服务器的网段可以和本地环境打穿到一个网段里；这个软件如果用在服务器上还是挺可怕的，类似windows下的teamviewer，类似linux下的ssh隧道模式;只要服务器可以上外网(严格说是连接到supermode)，就可以打通，慎用！<br><a id="more"></a></p><h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>N2N 是一款开源的P2P VPN 软件，其作者是著名的开源网管软件ntop的作者Luca Deri。<br>N2N 是一个双层架构的VPN ，它让用户可以在网络层上开发P2P应用的典型功能，而不是在应用层上开发。这意味着用户可以获取本地IP一样的可见度（比如说，同一个n2n网络内的两台PC机可以相互ping通），并且可以通过n2n虚拟网内的IP地址相互访问，而不必关心当前所属的物理网络地址。可以这样说，OpenVPN是把SSL从应用层转移到网络层实现（比如说实现https协议），而n2n则是把P2P的实现从应用层转移到网络层。</p><h1 id="N2N-设计的主要功能"><a href="#N2N-设计的主要功能" class="headerlink" title="N2N 设计的主要功能"></a>N2N 设计的主要功能</h1><ul><li>N2N 是基于P2P 协议之上的两个私有网络间的加密层</li><li>加密是在edge 节点上执行的，使用开放的协议，用户自己定义密钥：你自己控制自己的安全，不需要委托给第三方公司</li><li>每个n2n 用户可以同时隶属于多个网络</li><li>有NAT和穿越防火墙的功能，即使n2n节点位于私网中，也能够访问，防火墙不再是在 IP 层的直接沟通和交流的障碍</li><li>N2N 网络不是独立的，它是能够跨越N2N 和非N2N网络路由的</li></ul><h1 id="N2N-架构组件"><a href="#N2N-架构组件" class="headerlink" title="N2N 架构组件"></a>N2N 架构组件</h1><ul><li>Edge 节点：用户PC 机上安装的用于建立n2n网络的软件。几乎每个edge节点都会建立一个tun/tap设备，作为接入n2n网络的入口。</li><li>Supernode 超级节点：它在edge 节点间建立握手，或为位于防火墙之后的节点中转数据。它的基础作用是注册节点的网络路径，并为不能直通的节点做路由，能够直通的节点间通信，是P2P的。<br>Edge 节点间通过虚拟的tap 网卡交互。每个tap网卡都是一个n2n edge节点。每台PC机可以有多个tap网卡，所以，在n2n网络中，同一台PC机可以属于多个网络。</li></ul><h1 id="搭建N2N环境"><a href="#搭建N2N环境" class="headerlink" title="搭建N2N环境"></a>搭建N2N环境</h1><p>首先我们需要一个公网IP地址，一个可以访问的公网端口(UDP), 我这里刚好有一个华为云的服务器可以用<br>IP: 114.116.xx.xx<br>Port: 6666</p><h2 id="安装软件"><a href="#安装软件" class="headerlink" title="安装软件"></a>安装软件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">yum install -y subversion gcc-c++ openssl-devel git cmake</div><div class="line">cd /usr/src</div><div class="line">svn co https://svn.ntop.org/svn/ntop/trunk/n2n</div><div class="line">cd n2n/n2n_v2</div><div class="line">make</div><div class="line">make PREFIX=/opt/n2n install</div><div class="line">cp supernode /usr/sbin/</div><div class="line">cp edge /usr/sbin/</div></pre></td></tr></table></figure><h2 id="搭建中心服务器-supermode节点"><a href="#搭建中心服务器-supermode节点" class="headerlink" title="搭建中心服务器(supermode节点)"></a>搭建中心服务器(supermode节点)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#创建一个端口为6666的supermode服务，用于建立握手</div><div class="line">/usr/sbin/supernode -l 6666</div><div class="line">#查看6666端口是否存在，可以看到是udp端口</div><div class="line">ss -tnulp |grep 6666</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#新建一个虚拟设备edge0，用于测试</div><div class="line">edge -d edge0 -a 10.10.10.101 -s 255.255.255.0 -c fff -k fff -l 114.116.xxx.xxx:6666 -E -r</div></pre></td></tr></table></figure><p><img src="/images/2018/1205/01.png" alt="n2n"></p><h2 id="创建客户端-egdg节点"><a href="#创建客户端-egdg节点" class="headerlink" title="创建客户端(egdg节点)"></a>创建客户端(egdg节点)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#新建一个虚拟设备edge0，用于测试</div><div class="line">edge -d edge0 -a 10.10.10.102 -s 255.255.255.0 -c fff -k fff -l 114.116.xxx.xxx:6666 -E -r</div></pre></td></tr></table></figure><p>参数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">-d  &lt;接口名&gt; 选项指定了由 edge 命令创建的 TAP 接口的名字; 创建一个虚拟的网卡设备，edge0 就是它的名称</div><div class="line">-a &lt;IP 地址&gt; 选项（静态地）指定了分配给 TAP 接口的 VPN 的 IP 地址。如果你想要使用 DHCP，你需要在其中一台边缘节点上配置一台 DHCP 服务器，然后使用“-a dhcp:0.0.0.0”选项来代替。</div><div class="line">-s &lt;子网掩码&gt;</div><div class="line">-c &lt;组名&gt; 选项指定了 VPN 组的名字（最大长度为 16 个字节）。这个选项可以被用来在同样一组节点中创建多个 VPN。</div><div class="line">-k &lt;密钥&gt; 选项指定了一个由 twofish 加密的密钥来使用。如果你想要将密钥从命令行中隐藏，你可以使用 N2N_KEY 环境变量。</div><div class="line">-u 和 -g选项被用来在创建一个 TAP 接口后降权放弃 root 权限。edge 守护进程将会作为指定的用户/组 ID 运行。</div><div class="line">-l &lt;IP 地址:端口&gt; 选项指定了超级节点的监听 IP 地址和端口号。为了冗余，你可以指定最多两个不同的超级节点（比如 -l &lt;超级节点 A&gt; -l &lt;超级节点 B&gt;）。</div><div class="line">-m 给 TAP 接口分配了一个静态的 MAC 地址。不使用这个参数的话，edge 命令将会随机生成一个 MAC地址。事实上，为一个 VPN 接口强制指定一个静态的 MAC 地址是被强烈推荐的做法。否则，比如当你在一个节点上重启了 edge 守护程序的时候，其它节点的 ARP 缓存将会由于新生成的 MAC 地址而遭到污染，它们将不能向这个节点发送数据，直到被污染的 ARP 记录被消除。</div><div class="line">在使用过程中不免遇到一些奇葩的事，调试是个关键，开启调试模式，可以使用参数“-v -f”。记住先kill 掉之前的 edge 或 supernode 进程再进行调试以免冲突。</div></pre></td></tr></table></figure></p><font color="#FF0000"><em>PS:如果想让新建的虚拟网卡开机后依然生效，需要将以上创建命令写入到/etc/rc.local 文件中，另外centos7操作系统需要chmod +x /etc/rc.d/rc.local</em></font><hr>]]></content>
      
      
      <categories>
          
          <category> 服务器搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vpn </tag>
            
            <tag> n2n </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ksuapc : ORA-1033 foreground process starts before PMON</title>
      <link href="/arlo/1c37e249/"/>
      <url>/arlo/1c37e249/</url>
      
        <content type="html"><![CDATA[<p>开发人员反馈，数据库没有做什么操作，突然连不上了！</p><h1 id="查看数据库日志"><a href="#查看数据库日志" class="headerlink" title="查看数据库日志"></a>查看数据库日志</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">SQL&gt;  select VALUE from v$diag_info where name =&apos;Diag Trace&apos;;  </div><div class="line"></div><div class="line">VALUE</div><div class="line">--------------------------------------------------------------------------------</div><div class="line">/home/u01/app/oracle/diag/rdbms/orcl/ORCL/trace</div></pre></td></tr></table></figure><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd /home/u01/app/oracle/diag/rdbms/orcl/ORCL/trace</div><div class="line">tail -200 alert_ORCL.log</div></pre></td></tr></table></figure><p>发现日志里大量的报错ksuapc : ORA-1033 foreground process starts before PMON 网上搜了下，这是个bug，,该现象是数据库bug 8991997,该bug影响版本为:11.2.0.1/11.1.0.7,在11.2.0.1.1开始修复。<br>大概意思就是监听起来了，数据库还没起来，有大量的外部应用在连接数据库，导致数据库无法正常启动；将数据库监听停止掉，先启动数据库，然后启动监听即可。<br><code>lsnrctl stop</code> 无法正常停止监听程序，我这里使用<code>ps -ef|grep lsnrctl</code>查看监听的进程id,然后使用<code>kill -9 pid</code>杀掉监听，然后安装正常流程启动就可以了。</p><h1 id="启动数据库"><a href="#启动数据库" class="headerlink" title="启动数据库"></a>启动数据库</h1><p><code>sqlplus / as sysdba</code><br><code>SQL&gt; startup</code></p><h1 id="启动监听"><a href="#启动监听" class="headerlink" title="启动监听"></a>启动监听</h1><p><code>lsnrctl start</code></p><p>参考：<a href="http://www.xifenfei.com/2013/05/ksuapc-ora-1033-foreground-process-starts-before-pmon.html" target="_blank" rel="external">http://www.xifenfei.com/2013/05/ksuapc-ora-1033-foreground-process-starts-before-pmon.html</a></p>]]></content>
      
      
      <categories>
          
          <category> Troubleshooting </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>IDM+油猴脚本实现百度云不限速下载</title>
      <link href="/arlo/94c43a11/"/>
      <url>/arlo/94c43a11/</url>
      
        <content type="html"><![CDATA[<p>上周从JimV(<a href="http://template.iit.im/" target="_blank" rel="external">http://template.iit.im/</a>) 上下载了一个系统镜像模板用了两天，为解决这一问题，我使用了IDM下载工具和油猴脚本（chrome插件），测试了一下，速度基本上可以保持在300k左右，这里简单记录一下实现方法。<br><a id="more"></a></p><h1 id="安装IDM下载工具"><a href="#安装IDM下载工具" class="headerlink" title="安装IDM下载工具"></a>安装IDM下载工具</h1><p>官网：<a href="https://www.internetdownloadmanager.com/" target="_blank" rel="external">https://www.internetdownloadmanager.com/</a><br>也可以自己在网上找破解版，安装完成后会监测本机上的浏览器，根据提示安装浏览器插件。</p><h1 id="安装油猴脚本"><a href="#安装油猴脚本" class="headerlink" title="安装油猴脚本"></a>安装油猴脚本</h1><p>在chrome应用市场搜索“Tampermonkey”，安装油猴脚本管理器<br><img src="/images/2018/1126/01.png" alt="idm"><br><img src="/images/2018/1126/02.png" alt="idm"><br><img src="/images/2018/1126/03.png" alt="idm"><br>添加“EX-百度云盘”脚本<br><img src="/images/2018/1126/05.png" alt="idm"><br>打开百度云盘，刷新页面，可以看到多了一个“EX-下载”的按钮<br><img src="/images/2018/1126/06.png" alt="idm"></p><h1 id="分享百度云文件链接，实现下载"><a href="#分享百度云文件链接，实现下载" class="headerlink" title="分享百度云文件链接，实现下载"></a>分享百度云文件链接，实现下载</h1><ul><li>必须把要下载的文件分享出去，在隐身窗口或者退出登录后，打开分享链接，再使用脚本，方才有效！</li><li>现在账户已登录的情况下使用脚本没有效果！！！</li></ul><p><img src="/images/2018/1126/07.png" alt="idm"><br><img src="/images/2018/1126/08.png" alt="idm"></p>]]></content>
      
      
      
    </entry>
    
    <entry>
      <title>CentOS 5等保二级Linux主机问题整改，升级bash，openssl，openssh</title>
      <link href="/arlo/81ca458a/"/>
      <url>/arlo/81ca458a/</url>
      
        <content type="html"><![CDATA[<h1 id="设置系统密码长度、复杂度、生存周期"><a href="#设置系统密码长度、复杂度、生存周期" class="headerlink" title="设置系统密码长度、复杂度、生存周期"></a>设置系统密码长度、复杂度、生存周期</h1><p><code>vim /etc/pam.d/system-auth</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">password    requisite     pam_cracklib.so  minlen=12 ucredit=-1   lcredit=-1   ocredit=-1 retry=3 difok=5</div><div class="line">#minlen（最小长度）12位，ucredit(最少大写字母)1位，lcredit(最少小写字母)1位，ocredit(最少其他字符)1位，retry(重试次数)3次，difok(最少不同字符)5个 dcreit(最少数字字符)0位</div><div class="line">auth        required      pam_tally.so onerr=fail deny=6 unlock_time=300 even_deny_root root_unlock_time=300</div><div class="line">#重试最大次数6次，错误后锁定300秒</div></pre></td></tr></table></figure></p><a id="more"></a><p><code>vim /etc/login.defs</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">PASS_MAX_DAYS   90#密码最长过期天数</div><div class="line">PASS_MIN_DAYS   0#密码最小过期天数</div><div class="line">PASS_MIN_LEN    12#密码最小长度</div><div class="line">PASS_WARN_AGE   7#密码过期警告天数</div></pre></td></tr></table></figure></p><h1 id="设置空闲会话时间"><a href="#设置空闲会话时间" class="headerlink" title="设置空闲会话时间"></a>设置空闲会话时间</h1><p><code>vim /etc/profile</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">export TMOUT=300</div></pre></td></tr></table></figure></p><p><code>source /etc/profile</code></p><h1 id="升级系统补丁"><a href="#升级系统补丁" class="headerlink" title="升级系统补丁"></a>升级系统补丁</h1><p><em>注：仓库配置文件为centos5的配置文件，如果购买了正版的RHEL操作系统，可以使用RHN服务进行更新</em><br><code>vim /etc/yum.repos.d/CentOS-Base.repo</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[base]</div><div class="line">name=CentOS-$releasever - Base</div><div class="line">baseurl=http://vault.centos.org/5.11/os/x86_64/</div><div class="line">gpgcheck=1</div><div class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-5</div><div class="line"></div><div class="line">#released updates </div><div class="line">[updates]</div><div class="line">name=CentOS-$releasever - Updates</div><div class="line">baseurl=http://vault.centos.org/5.11/updates/x86_64/</div><div class="line">gpgcheck=1</div><div class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-5</div></pre></td></tr></table></figure></p><p><code>yum update</code></p><h1 id="安装杀毒软件clamav"><a href="#安装杀毒软件clamav" class="headerlink" title="安装杀毒软件clamav"></a>安装杀毒软件clamav</h1><h2 id="安装centos5的epel-release扩展包"><a href="#安装centos5的epel-release扩展包" class="headerlink" title="安装centos5的epel-release扩展包"></a>安装centos5的epel-release扩展包</h2><p><code>rpm -ivh http://dl.fedoraproject.org/pub/archive/epel/5/x86_64//epel-release-5-4.noarch.rpm</code></p><h2 id="安装杀毒软件clamav-1"><a href="#安装杀毒软件clamav-1" class="headerlink" title="安装杀毒软件clamav"></a>安装杀毒软件clamav</h2><p><code>yum install -y clamav</code></p><h2 id="更新病毒库"><a href="#更新病毒库" class="headerlink" title="更新病毒库"></a>更新病毒库</h2><p><code>freshclam</code></p><h2 id="测试查杀病毒"><a href="#测试查杀病毒" class="headerlink" title="测试查杀病毒"></a>测试查杀病毒</h2><p><code>clamscan -r /tmp</code></p><h1 id="升级bash"><a href="#升级bash" class="headerlink" title="升级bash"></a>升级bash</h1><h2 id="查看bash版本"><a href="#查看bash版本" class="headerlink" title="查看bash版本"></a>查看bash版本</h2><p><code>/bin/bash --version</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">GNU bash, version 3.2.25(1)-release (x86_64-redhat-linux-gnu)</div><div class="line">Copyright (C) 2005 Free Software Foundation, Inc.</div></pre></td></tr></table></figure></p><h2 id="检测漏洞"><a href="#检测漏洞" class="headerlink" title="检测漏洞"></a>检测漏洞</h2><p><code>env -i  X=&#39;() { (a)=&gt;\&#39; bash -c &#39;echo date&#39;; cat echo</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">修复前输出：当前系统时间</div></pre></td></tr></table></figure></p><h2 id="安装基础依赖包"><a href="#安装基础依赖包" class="headerlink" title="安装基础依赖包"></a>安装基础依赖包</h2><p><code>yum -y install gcc gcc-c++ glibc</code></p><h2 id="下载bash最新版"><a href="#下载bash最新版" class="headerlink" title="下载bash最新版"></a>下载bash最新版</h2><p><code>wget http://ftp.gnu.org/gnu/bash/bash-4.4.tar.gz</code></p><h2 id="编译安装bash"><a href="#编译安装bash" class="headerlink" title="编译安装bash"></a>编译安装bash</h2><p><code>./configure</code><br><code>make &amp;&amp; make install</code></p><h2 id="备份旧版本bash，并设置软连接"><a href="#备份旧版本bash，并设置软连接" class="headerlink" title="备份旧版本bash，并设置软连接"></a>备份旧版本bash，并设置软连接</h2><p><code>mv /bin/bash /bin/bash.bak &amp;&amp; ln -s /usr/local/bin/bash /bin/bash</code></p><h2 id="查询升级后版本"><a href="#查询升级后版本" class="headerlink" title="查询升级后版本"></a>查询升级后版本</h2><p><code>/bin/bash --version</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">GNU bash, version 4.4.0(1)-release (x86_64-unknown-linux-gnu)</div><div class="line">Copyright (C) 2016 Free Software Foundation, Inc.</div><div class="line">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</div><div class="line"></div><div class="line">This is free software; you are free to change and redistribute it.</div><div class="line">There is NO WARRANTY, to the extent permitted by law.</div></pre></td></tr></table></figure></p><h2 id="再次检测漏洞"><a href="#再次检测漏洞" class="headerlink" title="再次检测漏洞"></a>再次检测漏洞</h2><p><code>env -i  X=&#39;() { (a)=&gt;\&#39; bash -c &#39;echo date&#39;; cat echo</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">修复后输出：date</div></pre></td></tr></table></figure></p><h1 id="升级openssl"><a href="#升级openssl" class="headerlink" title="升级openssl"></a>升级openssl</h1><h2 id="查询openssl版本"><a href="#查询openssl版本" class="headerlink" title="查询openssl版本"></a>查询openssl版本</h2><p><code>/usr/bin/openssl version -a</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">OpenSSL 0.9.8e-fips-rhel5 01 Jul 2008</div><div class="line">built on: Tue May 31 06:58:30 CDT 2016</div><div class="line">platform: linux-x86_64</div><div class="line">options:  bn(64,64) md2(int) rc4(ptr,int) des(idx,cisc,16,int) blowfish(ptr2) </div><div class="line">compiler: gcc -fPIC -DOPENSSL_PIC -DZLIB -DOPENSSL_THREADS -D_REENTRANT -DDSO_DLFCN -DHAVE_DLFCN_H -DKRB5_MIT -I/usr/kerberos/include -DL_ENDIAN -DTERMIO -Wall -DMD32_REG_T=int -O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -m64 -mtune=generic -Wa,--noexecstack -DOPENSSL_USE_NEW_FUNCTIONS -fno-strict-aliasing -DOPENSSL_BN_ASM_MONT -DSHA1_ASM -DSHA256_ASM -DSHA512_ASM -DMD5_ASM -DAES_ASM</div><div class="line">OPENSSLDIR: &quot;/etc/pki/tls&quot;</div><div class="line">engines:  dynamic</div></pre></td></tr></table></figure></p><p><em>注：受perl版本限制，最新版的openssl1.1.1需要perl5.10+版本，本次升级为1.0.2版本</em></p><h2 id="下载openssl"><a href="#下载openssl" class="headerlink" title="下载openssl"></a>下载openssl</h2><p><code>wget -c https://www.openssl.org/source/openssl-1.0.2-latest.tar.gz</code><br><code>tar xf openssl-1.0.2p.tar.gz</code><br><code>cd openssl-1.0.2p</code></p><h2 id="编译安装openssl"><a href="#编译安装openssl" class="headerlink" title="编译安装openssl"></a>编译安装openssl</h2><p><code>./config --prefix=/usr/local/openssl</code><br><code>make &amp;&amp; make install</code></p><h2 id="备份之前的openssl"><a href="#备份之前的openssl" class="headerlink" title="备份之前的openssl"></a>备份之前的openssl</h2><p><code>mv /usr/bin/openssl /usr/bin/openssl.old &amp;&amp; mv /usr/include/openssl /usr/include/openssl.old</code></p><h2 id="添加软连接"><a href="#添加软连接" class="headerlink" title="添加软连接"></a>添加软连接</h2><p><code>ln -s /usr/local/openssl/bin/openssl /usr/bin/openssl &amp;&amp; ln -s /usr/local/openssl/include/openssl /usr/include/openssl</code></p><h2 id="再次查看openssl版本"><a href="#再次查看openssl版本" class="headerlink" title="再次查看openssl版本"></a>再次查看openssl版本</h2><p><code>/usr/bin/openssl version -a</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">OpenSSL 1.0.2p  14 Aug 2018</div><div class="line">built on: reproducible build, date unspecified</div><div class="line">platform: linux-x86_64</div><div class="line">options:  bn(64,64) rc4(16x,int) des(idx,cisc,16,int) idea(int) blowfish(idx) </div><div class="line">compiler: gcc -I. -I.. -I../include  -DOPENSSL_THREADS -D_REENTRANT -DDSO_DLFCN -DHAVE_DLFCN_H -Wa,--noexecstack -m64 -DL_ENDIAN -O3 -Wall -DOPENSSL_IA32_SSE2 -DOPENSSL_BN_ASM_MONT -DOPENSSL_BN_ASM_MONT5 -DOPENSSL_BN_ASM_GF2m -DRC4_ASM -DSHA1_ASM -DSHA256_ASM -DSHA512_ASM -DMD5_ASM -DAES_ASM -DVPAES_ASM -DBSAES_ASM -DWHIRLPOOL_ASM -DGHASH_ASM -DECP_NISTZ256_ASM</div><div class="line">OPENSSLDIR: &quot;/usr/local/openssl/ssl&quot;</div></pre></td></tr></table></figure></p><h2 id="将OpenSSL-的动态链接库地址写入动态链接装入器"><a href="#将OpenSSL-的动态链接库地址写入动态链接装入器" class="headerlink" title="将OpenSSL 的动态链接库地址写入动态链接装入器"></a>将OpenSSL 的动态链接库地址写入动态链接装入器</h2><p><code>echo &quot;/usr/local/openssl/lib&quot;  &gt;&gt; /etc/ld.so.conf</code><br><em>由于openssh配置时会使用旧版本的openssl库文件，需要先配置以下三个变量，让其指向新版本的opnessl库文件</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">export DEFAULT_LIBPATH=/usr/local/openssl/include/openssl/:/usr/local/openssl/lib/</div><div class="line">export LIBPATH=$&#123;LIBPATH:=$DEFAULT_LIBPATH&#125; </div><div class="line">export LD_LIBRARY_PATH=$&#123;LD_LIBRARY_PATH:=$DEFAULT_LIBPATH&#125;</div><div class="line">export LIBRARY_PATH=$&#123;LIBRARY_PATH:=$DEFAULT_LIBPATH&#125;</div></pre></td></tr></table></figure></p><h2 id="重新加载动态链接库"><a href="#重新加载动态链接库" class="headerlink" title="重新加载动态链接库"></a>重新加载动态链接库</h2><p><code>ldconfig -v</code></p><h1 id="升级openssh"><a href="#升级openssh" class="headerlink" title="升级openssh"></a>升级openssh</h1><h2 id="安装配置telnet-server"><a href="#安装配置telnet-server" class="headerlink" title="安装配置telnet server"></a>安装配置telnet server</h2><p><code>yum -y install telnet-server</code><br><code>vim /etc/xinetd.d/telnet</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">service telnet</div><div class="line">&#123;</div><div class="line">        flags           = REUSE</div><div class="line">        socket_type     = stream</div><div class="line">        wait            = no</div><div class="line">        user            = root</div><div class="line">        server          = /usr/sbin/in.telnetd</div><div class="line">        log_on_failure  += USERID</div><div class="line">        disable         = no#修改yes为no</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p><code>/etc/init.d/xinetd restart</code></p><h2 id="设置防火墙，允许访问23端口"><a href="#设置防火墙，允许访问23端口" class="headerlink" title="设置防火墙，允许访问23端口"></a>设置防火墙，允许访问23端口</h2><p><em>也可以暂时关闭防火墙</em><br><code>iptables -A RH-Firewall-1-INPUT -p tcp -m state --state NEW -m tcp --dport 23 -j ACCEPT</code><br>或者<br><code>service iptables stop</code></p><h2 id="允许root远程telnet登录主机"><a href="#允许root远程telnet登录主机" class="headerlink" title="允许root远程telnet登录主机"></a>允许root远程telnet登录主机</h2><p><code>vim /etc/securetty</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">pts/0</div><div class="line">pts/1</div><div class="line">pts/2</div><div class="line">pts/3</div><div class="line">pts/4</div><div class="line">pts/5</div><div class="line">pts/6</div><div class="line">pts/7</div><div class="line">pts/8</div></pre></td></tr></table></figure></p><h2 id="以下操作使用telnet远程登录主机进行操作"><a href="#以下操作使用telnet远程登录主机进行操作" class="headerlink" title="以下操作使用telnet远程登录主机进行操作"></a>以下操作使用telnet远程登录主机进行操作</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">telnet 192.168.7.70 23</div><div class="line">login:root</div><div class="line">passwd:xxxxxx</div></pre></td></tr></table></figure><h2 id="安装基础包"><a href="#安装基础包" class="headerlink" title="安装基础包"></a>安装基础包</h2><p><code>yum install zlib zlib-devel</code></p><h2 id="备份配置文件"><a href="#备份配置文件" class="headerlink" title="备份配置文件"></a>备份配置文件</h2><p><code>cp -r /etc/ssh /mnt</code><br><code>cp /etc/init.d/sshd /mnt</code><br><code>cp /etc/pam.d/sshd /mnt</code>  </p><h2 id="下载、编译安装openssh"><a href="#下载、编译安装openssh" class="headerlink" title="下载、编译安装openssh"></a>下载、编译安装openssh</h2><p><code>wget https://cdn.openbsd.org/pub/OpenBSD/OpenSSH/portable/openssh-7.9p1.tar.gz</code><br><code>tar xf openssh-7.9p1.tar.gz</code><br><code>cd openssh-7.9p1</code><br><code>./configure -prefix=/usr -sysconfdir=/etc/ssh -with-ssl-dir=/usr/local/openssl -with-zlib -with-pam -with-md5-passwords -with-kerberos5 --without-zlib-version-check</code><br><code>make &amp;&amp; make install</code></p><h2 id="启动sshd访问"><a href="#启动sshd访问" class="headerlink" title="启动sshd访问"></a>启动sshd访问</h2><p><code>/etc/init.d/sshd restart</code></p><h2 id="查看ssh版本"><a href="#查看ssh版本" class="headerlink" title="查看ssh版本"></a>查看ssh版本</h2><p><code>ssh -V</code></p><h1 id="升级后ssh用户无法远程登录"><a href="#升级后ssh用户无法远程登录" class="headerlink" title="升级后ssh用户无法远程登录"></a>升级后ssh用户无法远程登录</h1><h2 id="提示Failed-password-for-root-from-x-x-x-x-port-55776-ssh2"><a href="#提示Failed-password-for-root-from-x-x-x-x-port-55776-ssh2" class="headerlink" title="提示Failed password for root from x.x.x.x port 55776 ssh2"></a>提示Failed password for root from x.x.x.x port 55776 ssh2</h2><p>切记备份/etc/pam.d/sshd, 升级后如果不能远程登录，记得恢复之前备份的/etc/pam.d/sshd,如果忘记备份，可以从同系列主机（centos6就复制centos6的，centos7就复制centos7的）复制该文件，重启sshd服务即可！</p><h2 id="Could-not-get-shadow-information-for-root"><a href="#Could-not-get-shadow-information-for-root" class="headerlink" title="Could not get shadow information for root"></a>Could not get shadow information for root</h2><p>查看selinux 状态<br><code>sestatus</code><br>如果是enabled状态，临时解决方案<code>setenforce 0</code><br>永久生效请修改<code>/etc/selinux/config</code>文件中的<code>SELINUX=disabled</code>，在合适的时候重启主机生效<br><code>sed -i s#SELINUX=enforcing#SELINUX=disabled#g /etc/selinux/config</code><br><code>reboot</code></p><p><a href="https://blog.csdn.net/zougen/article/details/79570500" target="_blank" rel="external">https://blog.csdn.net/zougen/article/details/79570500</a><br><a href="http://leung4080.github.io/linux/2013/08/07/OpenSSL-OpenSSH-升级配置/" target="_blank" rel="external">http://leung4080.github.io/linux/2013/08/07/OpenSSL-OpenSSH-升级配置/</a></p>]]></content>
      
      
      <categories>
          
          <category> 安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Centos7关闭IPv6</title>
      <link href="/arlo/244042e3/"/>
      <url>/arlo/244042e3/</url>
      
        <content type="html"><![CDATA[<h1 id="验证ipv6是否关闭"><a href="#验证ipv6是否关闭" class="headerlink" title="验证ipv6是否关闭"></a>验证ipv6是否关闭</h1><p>cat /proc/sys/net/ipv6/conf/all/disable_ipv6<br>0：开启状态<br>1：关闭状态<br><a id="more"></a></p><h1 id="方法一：-开机不加载IPv6模块"><a href="#方法一：-开机不加载IPv6模块" class="headerlink" title="方法一： 开机不加载IPv6模块"></a>方法一： 开机不加载IPv6模块</h1><h2 id="修改grub文件"><a href="#修改grub文件" class="headerlink" title="修改grub文件"></a>修改grub文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">vi /etc/default/grub </div><div class="line">GRUB_CMDLINE_LINUX=&quot;ipv6.disable=1 crashkernel=auto rd.lvm.lv=centos/root rd.lvm.lv=centos/swap rhgb quiet&quot;</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">grub2-mkconfig -o /boot/grub2/grub.cfg</div></pre></td></tr></table></figure><h2 id="重启服务器，查看模块"><a href="#重启服务器，查看模块" class="headerlink" title="重启服务器，查看模块"></a>重启服务器，查看模块</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">reboot</div><div class="line">lsmod |grep ipv6</div></pre></td></tr></table></figure><h1 id="方法二：命令行修改（推荐）"><a href="#方法二：命令行修改（推荐）" class="headerlink" title="方法二：命令行修改（推荐）"></a>方法二：命令行修改（推荐）</h1><h2 id="修改内核参数"><a href="#修改内核参数" class="headerlink" title="修改内核参数"></a>修改内核参数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">vi /etc/sysctl.conf</div><div class="line">net.ipv6.conf.all.disable_ipv6=1</div></pre></td></tr></table></figure><h2 id="修改网络配置文件"><a href="#修改网络配置文件" class="headerlink" title="修改网络配置文件"></a>修改网络配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">vi /etc/sysconfig/network</div><div class="line">NETWORKING_IPV6=no</div></pre></td></tr></table></figure><h2 id="修改网卡配置文件"><a href="#修改网卡配置文件" class="headerlink" title="修改网卡配置文件"></a>修改网卡配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">vi /etc/sysconfig/network-scripts/ifcfg-XX</div><div class="line">IPV6INIT=no</div></pre></td></tr></table></figure><h2 id="加载内核参数，使其生效"><a href="#加载内核参数，使其生效" class="headerlink" title="加载内核参数，使其生效"></a>加载内核参数，使其生效</h2><p><code>sysctl -p</code></p>]]></content>
      
      
      <categories>
          
          <category> 常识 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>nginx反向代理Jenkins问题</title>
      <link href="/arlo/57829448/"/>
      <url>/arlo/57829448/</url>
      
        <content type="html"><![CDATA[<p>由于只开放了一个端口，要使用jenkins发布业务的话，需要使用nginx把jenkins的端口反向代理出来；关于jenkins搭建参加<a href="http://islocal.cc/arlo/c0b31722/">本博客之前文章</a></p><h1 id="修改jenkins配置文件"><a href="#修改jenkins配置文件" class="headerlink" title="修改jenkins配置文件"></a>修改jenkins配置文件</h1><p><code>vim /etc/sysconfig/jenkins</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># 由于我这里把8080端口占用了，把jenkins修改为7999端口</div><div class="line">JENKINS_PORT=&quot;7999&quot;</div><div class="line"># 为jenkins添加一个上下文对象</div><div class="line">JENKINS_ARGS=&quot;--prefix=/jenkins&quot;</div></pre></td></tr></table></figure></p><a id="more"></a><h1 id="修改nginx配置文件"><a href="#修改nginx配置文件" class="headerlink" title="修改nginx配置文件"></a>修改nginx配置文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div></pre></td><td class="code"><pre><div class="line">worker_processes  1;</div><div class="line">events &#123;</div><div class="line">    worker_connections  1024;</div><div class="line">&#125;</div><div class="line"></div><div class="line">http &#123;</div><div class="line">    include       mime.types;</div><div class="line">    default_type  application/octet-stream;</div><div class="line">    sendfile        on;</div><div class="line">    keepalive_timeout  65;</div><div class="line">    client_max_body_size 60M;</div><div class="line">    client_body_buffer_size 512k;</div><div class="line">    upstream jenkins &#123;</div><div class="line">      keepalive 32;</div><div class="line">      server 127.0.0.1:7999 ;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    server &#123;</div><div class="line">        listen       8080;</div><div class="line">        server_name  localhost;</div><div class="line">        ignore_invalid_headers off; </div><div class="line">#project config file    </div><div class="line">         location /esp-web &#123;</div><div class="line">            root   html;</div><div class="line">            index  index.html index.htm;</div><div class="line">        &#125;</div><div class="line">        location /file &#123;</div><div class="line">            root   html;</div><div class="line">        &#125;</div><div class="line">        location /esp &#123;</div><div class="line">            proxy_pass   http://127.0.0.1:8081/esp;</div><div class="line">        &#125;</div><div class="line">#jenkins config file        </div><div class="line">    location ~ &quot;^/static/[0-9a-fA-F]&#123;8&#125;\/(.*)$&quot; &#123;</div><div class="line">        #rewrite all static files into requests to the root</div><div class="line">        #E.g /static/12345678/css/something.css will become /css/something.css</div><div class="line">        rewrite &quot;^/static/[0-9a-fA-F]&#123;8&#125;\/(.*)&quot; /$1 last;</div><div class="line">    &#125;</div><div class="line">    location /userContent &#123;</div><div class="line">    #have nginx handle all the static requests to the userContent folder files</div><div class="line">    #note : This is the $JENKINS_HOME dir</div><div class="line">root /var/lib/jenkins/;</div><div class="line">    if (!-f $request_filename)&#123;</div><div class="line">      #this file does not exist, might be a directory or a /**view** url</div><div class="line">      rewrite (.*) /$1 last;</div><div class="line">  break;</div><div class="line">    &#125;</div><div class="line">sendfile on;</div><div class="line">  &#125;</div><div class="line">    location @jenkins &#123;</div><div class="line">      sendfile off;</div><div class="line">      proxy_pass         http://jenkins;</div><div class="line">      proxy_redirect     default;</div><div class="line">      proxy_http_version 1.1;</div><div class="line"></div><div class="line">      proxy_set_header   Host              $host;</div><div class="line">      proxy_set_header   X-Real-IP         $remote_addr;</div><div class="line">      proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;</div><div class="line">      proxy_set_header   X-Forwarded-Proto $scheme;</div><div class="line">      proxy_max_temp_file_size 0;</div><div class="line"></div><div class="line">      #this is the maximum upload size</div><div class="line">      client_max_body_size       10m;</div><div class="line">      client_body_buffer_size    128k;</div><div class="line"></div><div class="line">      proxy_connect_timeout      90;</div><div class="line">      proxy_send_timeout         90;</div><div class="line">      proxy_read_timeout         90;</div><div class="line">      proxy_buffering            off;</div><div class="line">      proxy_request_buffering    off; # Required for HTTP CLI commands in Jenkins &gt; 2.54</div><div class="line">      proxy_set_header Connection &quot;&quot;; # Clear for keepalive</div><div class="line">  &#125;</div><div class="line">   location / &#123;</div><div class="line">    # Optional configuration to detect and redirect iPhones</div><div class="line">    if ($http_user_agent ~* &apos;(iPhone|iPod)&apos;) &#123;</div><div class="line">      rewrite ^/$ /view/iphone/ redirect;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    try_files $uri @jenkins;</div><div class="line">  &#125;</div><div class="line">        error_page   500 502 503 504  /50x.html;</div><div class="line">        location = /50x.html &#123;</div><div class="line">            root   html;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h1 id="重启nginx、jenkins"><a href="#重启nginx、jenkins" class="headerlink" title="重启nginx、jenkins"></a>重启nginx、jenkins</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">systemctl restart jenkins.service</div><div class="line">nginx -s reload</div></pre></td></tr></table></figure><p>参考文档：<br><a href="https://wiki.jenkins.io/display/JENKINS/Jenkins+says+my+reverse+proxy+setup+is+broken" target="_blank" rel="external">https://wiki.jenkins.io/display/JENKINS/Jenkins+says+my+reverse+proxy+setup+is+broken</a></p><h2 id="https-www-jianshu-com-p-8315657465ac"><a href="#https-www-jianshu-com-p-8315657465ac" class="headerlink" title="https://www.jianshu.com/p/8315657465ac"></a><a href="https://www.jianshu.com/p/8315657465ac" target="_blank" rel="external">https://www.jianshu.com/p/8315657465ac</a></h2>]]></content>
      
      
      <categories>
          
          <category> Troubleshooting </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Jenkins </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>修改Mariadb数据库存储路径</title>
      <link href="/arlo/1b10686d/"/>
      <url>/arlo/1b10686d/</url>
      
        <content type="html"><![CDATA[<p>拿到手的服务器大量空间在/home分区下，没有在/下，考虑到后期数据库增长量，/分区空间可能不够，决定把Mariadb数据库数据存储路径修改到/home分区下；以下为修改过程<br><a id="more"></a></p><h1 id="关闭数据库服务"><a href="#关闭数据库服务" class="headerlink" title="关闭数据库服务"></a>关闭数据库服务</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">systemctl stop mariadb.service</div></pre></td></tr></table></figure><h1 id="新建新的存储路径，并移动之前的文件"><a href="#新建新的存储路径，并移动之前的文件" class="headerlink" title="新建新的存储路径，并移动之前的文件"></a>新建新的存储路径，并移动之前的文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mkdir /home/data</div><div class="line">mv /var/lib/mysql/ /home/data/</div></pre></td></tr></table></figure><h1 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h1><blockquote><p>cp /usr/share/mysql/my-medium.cnf /etc/my.cnf    #如果是新装的数据库，可以复制一个模板配置文件过来<br><em>注：datadir上面的五行是设置默认字符集为utf8mb4，否则emoji表情是无法正确存储的。</em></p></blockquote><p><code>vim /etc/my.cnf</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[client]</div><div class="line">socket          = /home/data/mysql/mysql.sock</div><div class="line">[mysqld]</div><div class="line"></div><div class="line">init_connect=&apos;SET collation_connection = utf8mb4_unicode_ci&apos;</div><div class="line">init_connect=&apos;SET NAMES utf8mb4&apos;</div><div class="line">character_set_server=utf8mb4</div><div class="line">collation-server=utf8mb4_unicode_ci</div><div class="line">skip-character-set-client-handshake=true</div><div class="line"></div><div class="line">datadir=/home/data/mysql/</div></pre></td></tr></table></figure></p><h1 id="报错"><a href="#报错" class="headerlink" title="报错"></a>报错</h1><p>报错:“[Warning] Can’t create test file /home/data/mysql/sthbb_rwdcdb_36_123.lower-test”.<br>解决方式: 修改/usr/lib/systemd/system/mariadb.service中配置项<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ProtectHome=false</div></pre></td></tr></table></figure></p><h1 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">[root@sthbb_rwdcdb_36_123 data]# mysql -uroot -p</div><div class="line">Enter password: </div><div class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</div><div class="line">Your MariaDB connection id is 3</div><div class="line">Server version: 10.1.36-MariaDB MariaDB Server</div><div class="line"></div><div class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</div><div class="line"></div><div class="line">Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.</div><div class="line"></div><div class="line">MariaDB [(none)]&gt; show global variables like &quot;%datadir%&quot;;</div><div class="line">+---------------+-------------------+</div><div class="line">| Variable_name | Value             |</div><div class="line">+---------------+-------------------+</div><div class="line">| datadir       | /home/data/mysql/ |</div><div class="line">+---------------+-------------------+</div><div class="line">1 row in set (0.00 sec)</div><div class="line"></div><div class="line">MariaDB [(none)]&gt; status</div><div class="line">--------------</div><div class="line">mysql  Ver 15.1 Distrib 10.1.36-MariaDB, for Linux (x86_64) using readline 5.1</div><div class="line"></div><div class="line">Connection id:3</div><div class="line">Current database:</div><div class="line">Current user:root@localhost</div><div class="line">SSL:Not in use</div><div class="line">Current pager:stdout</div><div class="line">Using outfile:&apos;&apos;</div><div class="line">Using delimiter:;</div><div class="line">Server:MariaDB</div><div class="line">Server version:10.1.36-MariaDB MariaDB Server</div><div class="line">Protocol version:10</div><div class="line">Connection:Localhost via UNIX socket</div><div class="line">Server characterset:utf8mb4</div><div class="line">Db     characterset:utf8mb4</div><div class="line">Client characterset:utf8mb4</div><div class="line">Conn.  characterset:utf8mb4</div><div class="line">UNIX socket:/home/data/mysql/mysql.sock</div><div class="line">Uptime:2 min 29 sec</div><div class="line"></div><div class="line">Threads: 1  Questions: 5  Slow queries: 0  Opens: 17  Flush tables: 1  Open tables: 11  Queries per second avg: 0.033</div><div class="line">--------------</div></pre></td></tr></table></figure><p>参考链接：<a href="https://stackoverflow.com/questions/38529205/mariadb-cannot-start-after-update-warning-cant-create-test-file-home-mysql" target="_blank" rel="external">https://stackoverflow.com/questions/38529205/mariadb-cannot-start-after-update-warning-cant-create-test-file-home-mysql</a></p>]]></content>
      
      
      <categories>
          
          <category> Troubleshooting </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
            <tag> Mariadb </tag>
            
            <tag> Troubleshooting </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Oracle 12c远程连接报ORA28040和ORA01017错误</title>
      <link href="/arlo/cb23bc66/"/>
      <url>/arlo/cb23bc66/</url>
      
        <content type="html"><![CDATA[<p>ORA-28040: 没有匹配的验证协议<br>修改<code>$ORACLE_HOME\NETWORK\ADMIN\sqlnet.ora</code>文件，添加以下两行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">SQLNET.ALLOWED_LOGON_VERSION_SERVER=9</div><div class="line">SQLNET.ALLOWED_LOGON_VERSION_CLIENT=9</div></pre></td></tr></table></figure></p><p>ORA-01017的错误的解决方法：<br><code>sqlplus / as sysdba</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ALTER USER username IDENTIFIED BY password</div></pre></td></tr></table></figure></p><p>参考链接：<br><a href="http://blog.itpub.net/28612416/viewspace-2138896/" target="_blank" rel="external">http://blog.itpub.net/28612416/viewspace-2138896/</a><br><a href="https://m.aliyun.com/yunqi/articles/415260" target="_blank" rel="external">https://m.aliyun.com/yunqi/articles/415260</a></p>]]></content>
      
      
      <categories>
          
          <category> Troubleshooting </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>查询Oracle数据库连接和资源消耗常用语句</title>
      <link href="/arlo/5e07e8b7/"/>
      <url>/arlo/5e07e8b7/</url>
      
        <content type="html"><![CDATA[<h1 id="查看数据库连接命令"><a href="#查看数据库连接命令" class="headerlink" title="查看数据库连接命令"></a>查看数据库连接命令</h1><h2 id="查看数据库最大可用连接数"><a href="#查看数据库最大可用连接数" class="headerlink" title="查看数据库最大可用连接数"></a>查看数据库最大可用连接数</h2><p><code>show parameter processes;</code></p><h2 id="查看数据库最大session数"><a href="#查看数据库最大session数" class="headerlink" title="查看数据库最大session数"></a>查看数据库最大session数</h2><p><code>show parameter sessions;</code></p><h2 id="查看数据库当前session数和活动session"><a href="#查看数据库当前session数和活动session" class="headerlink" title="查看数据库当前session数和活动session"></a>查看数据库当前session数和活动session</h2><p><code>select count(*) from v$session;</code><br><code>select count(*) from v$session where status=&#39;ACTIVE&#39;;</code><br><a id="more"></a></p><h2 id="查看数据库当前使用者"><a href="#查看数据库当前使用者" class="headerlink" title="查看数据库当前使用者"></a>查看数据库当前使用者</h2><p><code>SELECT osuser, a.username,cpu_time/executions/1000000||&#39;s&#39;, b.sql_text,machine from v$session a,v$sqlarea b where a.sql_address =b.address order by cpu_time/executions desc;</code></p><h1 id="查看数据库资源使用情况命令"><a href="#查看数据库资源使用情况命令" class="headerlink" title="查看数据库资源使用情况命令"></a>查看数据库资源使用情况命令</h1><h2 id="查看各用户的各种资源占用"><a href="#查看各用户的各种资源占用" class="headerlink" title="查看各用户的各种资源占用"></a>查看各用户的各种资源占用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">SELECT SE.SID, SES.USERNAME, SES.OSUSER, N.NAME, SE.VALUE</div><div class="line">  FROM V$STATNAME N, V$SESSTAT SE, V$SESSION SES</div><div class="line"> WHERE N.STATISTIC# = SE.STATISTIC#</div><div class="line">   AND SE.SID = SES.SID</div><div class="line">   AND SES.USERNAME IS NOT NULL</div><div class="line">   AND N.NAME IN (&apos;CPU used by this session&apos;,</div><div class="line">                  &apos;db block gets&apos;,</div><div class="line">                  &apos;consistent gets&apos;,</div><div class="line">                  &apos;physical reads&apos;,</div><div class="line">                  &apos;free buffer requested&apos;,</div><div class="line">                  &apos;table scans (long tables)&apos;,</div><div class="line">                  &apos;table scan rows gotten&apos;,</div><div class="line">                  &apos;sorts (memory)&apos;,</div><div class="line">                  &apos;sorts (disk)&apos;,</div><div class="line">                  &apos;sorts (rows)&apos;,</div><div class="line">                  &apos;session uga memory max&apos;,</div><div class="line">                  &apos;session pga memory max&apos;)</div><div class="line"> ORDER BY SID, N.STATISTIC#;</div></pre></td></tr></table></figure><p><img src="/images/2018/0906/01.png" alt="z"></p><h2 id="占用资源的SQL-top10之类的数据"><a href="#占用资源的SQL-top10之类的数据" class="headerlink" title="占用资源的SQL top10之类的数据"></a>占用资源的SQL top10之类的数据</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">SELECT B.USERNAME USERNAME,</div><div class="line">       A.DISK_READS READS,</div><div class="line">       A.EXECUTIONS EXEC,</div><div class="line">       A.DISK_READS / DECODE(A.EXECUTIONS, 0, 1, A.EXECUTIONS) RDS_EXEC_RATIO,</div><div class="line">       A.SQL_TEXT STATEMENT</div><div class="line">  FROM V$SQLAREA A, DBA_USERS B</div><div class="line"> WHERE A.PARSING_USER_ID = B.USER_ID</div><div class="line">   AND A.DISK_READS &gt; 100000</div><div class="line"> ORDER BY A.DISK_READS DESC;</div></pre></td></tr></table></figure><p><img src="/images/2018/0906/02.png" alt="z"></p><h2 id="使用频率最高的5个查询"><a href="#使用频率最高的5个查询" class="headerlink" title="使用频率最高的5个查询"></a>使用频率最高的5个查询</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">SELECT SQL_TEXT, EXECUTIONS</div><div class="line">  FROM (SELECT SQL_TEXT,</div><div class="line">               EXECUTIONS,</div><div class="line">               RANK() OVER(ORDER BY EXECUTIONS DESC) EXEC_RANK</div><div class="line">          FROM V$SQL)</div><div class="line">WHERE EXEC_RANK &lt;= 5;</div></pre></td></tr></table></figure><p><img src="/images/2018/0906/03.png" alt="z"></p><h2 id="消耗磁盘读取最多的sql-top5"><a href="#消耗磁盘读取最多的sql-top5" class="headerlink" title="消耗磁盘读取最多的sql top5"></a>消耗磁盘读取最多的sql top5</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">SELECT DISK_READS, SQL_TEXT</div><div class="line">  FROM (SELECT SQL_TEXT,</div><div class="line">               DISK_READS,</div><div class="line">               DENSE_RANK() OVER(ORDER BY DISK_READS DESC) DISK_READS_RANK</div><div class="line">          FROM V$SQL)</div><div class="line"> WHERE DISK_READS_RANK &lt;= 5;</div></pre></td></tr></table></figure><p><img src="/images/2018/0906/04.png" alt="z"></p><h2 id="找出需要大量缓冲读取（逻辑读）操作的查询"><a href="#找出需要大量缓冲读取（逻辑读）操作的查询" class="headerlink" title="找出需要大量缓冲读取（逻辑读）操作的查询"></a>找出需要大量缓冲读取（逻辑读）操作的查询</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">SELECT BUFFER_GETS, SQL_TEXT</div><div class="line">  FROM (SELECT SQL_TEXT,</div><div class="line">               BUFFER_GETS,</div><div class="line">               DENSE_RANK() OVER(ORDER BY BUFFER_GETS DESC) BUFFER_GETS_RANK</div><div class="line">          FROM V$SQL)</div><div class="line"> WHERE BUFFER_GETS_RANK &lt;= 5;</div></pre></td></tr></table></figure><p><img src="/images/2018/0906/05.png" alt="z"></p>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>数据库hang住，应用连接缓慢甚至无法连接</title>
      <link href="/arlo/9598871f/"/>
      <url>/arlo/9598871f/</url>
      
        <content type="html"><![CDATA[<h1 id="问题现象"><a href="#问题现象" class="headerlink" title="问题现象"></a>问题现象</h1><p>数据库抗住，开发人员反映应用断断续续无法连接，远程telnet数据库端口不通</p><h2 id="登录数据库，查看日志位置"><a href="#登录数据库，查看日志位置" class="headerlink" title="登录数据库，查看日志位置"></a>登录数据库，查看日志位置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select value from v$diag_info where name =&apos;Diag Trace&apos;;</div><div class="line"></div><div class="line">VALUE</div><div class="line">--------------------------------------------------------------------------------</div><div class="line">e:\app\administrator\diag\rdbms\sx21\sx21\trace</div></pre></td></tr></table></figure><a id="more"></a><h1 id="报错1：redo日志无法切换"><a href="#报错1：redo日志无法切换" class="headerlink" title="报错1：redo日志无法切换"></a>报错1：redo日志无法切换</h1><h2 id="查看alert-sx21-log日志，发现大量redo日志报错"><a href="#查看alert-sx21-log日志，发现大量redo日志报错" class="headerlink" title="查看alert_sx21.log日志，发现大量redo日志报错"></a>查看alert_sx21.log日志，发现大量redo日志报错</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Checkpoint not complete</div><div class="line">Current log# 2 seq# 76268 mem# 0: E:\APP\ADMINISTRATOR\ORADATA\SX21\REDO02.LOG</div><div class="line">Thread 1 advanced to log sequence 76269 (LGWR switch)</div><div class="line">Current log# 3 seq# 76269 mem# 0: E:\APP\ADMINISTRATOR\ORADATA\SX21\REDO03.LOG</div></pre></td></tr></table></figure><h2 id="增加redo日志"><a href="#增加redo日志" class="headerlink" title="增加redo日志"></a>增加redo日志</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">alter database add logfile group 4 (&apos;E:\APP\ADMINISTRATOR\ORADATA\SX21\REDO04.LOG&apos;) size 50m;</div><div class="line">alter database add logfile group 5 (&apos;E:\APP\ADMINISTRATOR\ORADATA\SX21\REDO05.LOG&apos;) size 50m;</div></pre></td></tr></table></figure><h2 id="查看redo日志"><a href="#查看redo日志" class="headerlink" title="查看redo日志"></a>查看redo日志</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select group#,sequence#,bytes,members,status from v$log;</div></pre></td></tr></table></figure><h2 id="修改-fast-start-mttr-target参数"><a href="#修改-fast-start-mttr-target参数" class="headerlink" title="修改 fast_start_mttr_target参数"></a>修改 fast_start_mttr_target参数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alter system set fast_start_mttr_target = 30 ;</div></pre></td></tr></table></figure><h1 id="报错2："><a href="#报错2：" class="headerlink" title="报错2："></a>报错2：</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">Sat Sep 01 08:37:01 2018</div><div class="line">Errors in file e:\app\administrator\diag\rdbms\sx21\sx21\trace\sx21_mmon_6264.trc  (incident=144681):</div><div class="line">ORA-00445: 后台进程 &quot;m000&quot; 在 120 秒之后仍没有启动</div><div class="line">Sat Sep 01 08:39:06 2018</div><div class="line">Errors in file e:\app\administrator\diag\rdbms\sx21\sx21\trace\sx21_smco_13976.trc  (incident=144698):</div><div class="line">ORA-00445: 后台进程 &quot;W000&quot; 在 120 秒之后仍没有启动</div><div class="line">Sat Sep 01 08:41:12 2018</div><div class="line">Errors in file e:\app\administrator\diag\rdbms\sx21\sx21\trace\sx21_cjq0_21740.trc  (incident=144688):</div><div class="line">ORA-00445: 后台进程 &quot;J000&quot; 在 120 秒之后仍没有启动</div><div class="line">kkjcre1p: unable to spawn jobq slave process </div><div class="line">Errors in file e:\app\administrator\diag\rdbms\sx21\sx21\trace\sx21_cjq0_21740.trc:</div></pre></td></tr></table></figure><p><em>此问题现象为系统内存不足，建议增加内存，或增加sga，由于暂时无法增加系统内存，我先调整了sga</em></p><h2 id="修改sga"><a href="#修改sga" class="headerlink" title="修改sga"></a>修改sga</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">SQL&gt; show parameter sga;</div><div class="line"></div><div class="line">NAME TYPE VALUE</div><div class="line">------------------------------------ ----------- ----------------------------</div><div class="line">lock_sga boolean FALSE</div><div class="line">pre_page_sga boolean FALSE</div><div class="line">sga_max_size big integer 10G</div><div class="line">sga_target big integer 0</div><div class="line">SQL&gt; alter system set sga_max_size=20480M scope=spfile;    #一定要保证SGA_MAX_SIZE小于MEMORY_TARGET，否则启动会报错</div><div class="line">SQL&gt; shutdown immediate</div><div class="line">SQL&gt; startup</div></pre></td></tr></table></figure><h3 id="一定要保证SGA-MAX-SIZE小于MEMORY-TARGET，否则启动会报以下错误"><a href="#一定要保证SGA-MAX-SIZE小于MEMORY-TARGET，否则启动会报以下错误" class="headerlink" title="一定要保证SGA_MAX_SIZE小于MEMORY_TARGET，否则启动会报以下错误"></a>一定要保证SGA_MAX_SIZE小于MEMORY_TARGET，否则启动会报以下错误</h3><p>ORA-00844: Parameter not taking MEMORY_TARGET into account<br>ORA-00851: SGA_MAX_SIZE 21474836480 cannot be set to more than MEMORY_TARGET 10737418240.</p><p><em>解决方法如下，创建一个pfile文件，然后修改内存参数，然后在创建一格spfile，启动数据库</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SQL&gt; create pfile from spfile;</div></pre></td></tr></table></figure></p><p>修改该文件以下参数E:\app\Administrator\product\11.2.0\dbhome_4\database\INITsx21.ORA<br><code>*.memory_target=27487790694</code><br><code>*.sga_max_size=21990232555</code><br><code>*.sga_target=21990232555</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SQL&gt; create spfile from pfile;</div></pre></td></tr></table></figure></p><p>参考文档：</p><p><a href="http://blog.51cto.com/mervin/490322" target="_blank" rel="external">http://blog.51cto.com/mervin/490322</a><br><a href="http://blog.51cto.com/sysadmin/203502" target="_blank" rel="external">http://blog.51cto.com/sysadmin/203502</a><br><a href="http://blog.51cto.com/leoguan/584494" target="_blank" rel="external">http://blog.51cto.com/leoguan/584494</a><br><a href="https://blog.csdn.net/ggwxk1990/article/details/78712204" target="_blank" rel="external">https://blog.csdn.net/ggwxk1990/article/details/78712204</a><br><a href="https://blog.csdn.net/leshami/article/details/5782516" target="_blank" rel="external">https://blog.csdn.net/leshami/article/details/5782516</a></p>]]></content>
      
      
      <categories>
          
          <category> Troubleshooting </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Ambari集成HUE</title>
      <link href="/arlo/8591b53b/"/>
      <url>/arlo/8591b53b/</url>
      
        <content type="html"><![CDATA[<h1 id="Hue介绍"><a href="#Hue介绍" class="headerlink" title="Hue介绍"></a>Hue介绍</h1><p>Hue 是运营和开发Hadoop应用的图形化用户界面。Hue程序被整合到一个类似桌面的环境，以web程序的形式发布，对于单独的用户来说不需要额外的安装。<br><a id="more"></a></p><h1 id="依赖环境配置"><a href="#依赖环境配置" class="headerlink" title="依赖环境配置"></a>依赖环境配置</h1><h2 id="配置Maven3-5-4"><a href="#配置Maven3-5-4" class="headerlink" title="配置Maven3.5.4"></a>配置Maven3.5.4</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">cd /usr/local/src/</div><div class="line">wget http://apache.mirrors.lucidnetworks.net/maven/maven-3/3.5.4/binaries/apache-maven-3.5.4-bin.tar.gz </div><div class="line">tar xf apache-maven-3.5.4-bin.tar.gz -C /usr/local/</div><div class="line">vim  /etc/profile</div><div class="line">export MAVEN_HOME=/usr/local/apache-maven-3.5.4</div><div class="line">export PATH=$PATH:$MAVEN_HOME/bin</div><div class="line">source /etc/profile</div></pre></td></tr></table></figure><h2 id="python-版本2-6-6"><a href="#python-版本2-6-6" class="headerlink" title="python 版本2.6.6+"></a>python 版本2.6.6+</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">python -V</div><div class="line">Python 2.7.5</div></pre></td></tr></table></figure><h2 id="其他依赖工具和包"><a href="#其他依赖工具和包" class="headerlink" title="其他依赖工具和包"></a>其他依赖工具和包</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install ant asciidoc krb5-devel cyrus-sasl-gssapi cyrus-sasl-devel libxml2-devel libxslt-devel libtidy mysql mysql-devel openldap-devel python-devel python-simplejson python-setuptools sqlite-devel gcc gcc-c++ rsync saslwrapper-devel pycrypto gmp-devel libyaml-devel cyrus-sasl-plain cyrus-sasl-devel cyrus-sasl-gssapi libssl-devel libffi-devel libsasl2-dev libsasl2-modules-gssapi-mit libkrb5-dev</div></pre></td></tr></table></figure><h2 id="python模块依赖安装"><a href="#python模块依赖安装" class="headerlink" title="python模块依赖安装"></a>python模块依赖安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">pip install --upgrade pip</div><div class="line">pip install ipdb</div><div class="line">pip install psycopg2</div><div class="line">pip install psycopg2-binary</div></pre></td></tr></table></figure><h1 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">git clone https://github.com/cloudera/hue.git</div><div class="line">make apps（这一步可能遇到很多问题，比如某个包无法下载等，多执行几次就可以通过了）</div><div class="line">make locales（编译多语言版本）</div><div class="line">#注：若只编译简体中文版，需修改$HUE/desktop/core/src/desktop/settings.py文件中：LANGUAGE_CODE = &apos;zh_CN&apos;，并删除LANGUAGES中的其它语言项。</div><div class="line">make install  #（make install PREFIX=/usr/hdp/2.3.4.0-3485/hue HADOOP_HOME=/usr/hdp/current/hadoop-client）</div><div class="line">$HUE/build/env/bin/hue test all  #测试</div><div class="line">ln -s /usr/local/hue/desktop/libs/hadoop/java-lib/hue-plugins-3.9.0-SNAPSHOT.jar /opt/hadoop/hadoop-2.6.0/lib</div><div class="line">useradd hue</div><div class="line">chown -R hue:hue /usr/local/hue #必须新建hue用户，且hue存在home目录，并赋hue目录权限，否则启动报错</div></pre></td></tr></table></figure><h1 id="修改-usr-local-hue-desktop-conf-pseudo-distributed-ini配置"><a href="#修改-usr-local-hue-desktop-conf-pseudo-distributed-ini配置" class="headerlink" title="修改/usr/local/hue/desktop/conf/pseudo-distributed.ini配置"></a>修改/usr/local/hue/desktop/conf/pseudo-distributed.ini配置</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[desktop]</div><div class="line">secret_key=qwertyuiopasdfghjklzxcvbnm1234567890   #key随便写一串就行</div><div class="line">http_host=bigdata05.islocal.cc</div><div class="line">http_port=8888</div><div class="line">time_zone=Asia/Shanghai</div><div class="line">app_blacklist = search,indexer,security   #黑名单：如果不安装oozie的话，jobsub和oozie需同时加入黑名单才能禁用oozie,因为jobsub依赖oozie，否则启动会报错。</div></pre></td></tr></table></figure><h1 id="启动hue"><a href="#启动hue" class="headerlink" title="启动hue"></a>启动hue</h1><p>$HUE/build/env/bin/supervisor &amp;        #在生产环境中使用这个命令<br>$HUE/build/env/bin/hue runcpserver &amp;   #用于development模式<br>打开web页面：<a href="http://bigdata05.islocal.cc:8888" target="_blank" rel="external">http://bigdata05.islocal.cc:8888</a>  #第一次输入的用户名密码为超级管理员的用户密码。<br><strong>启动访问没有问题，即可将/usr/local/hue打成tar包，使用ambari进行集成安装</strong></p><h1 id="Ambari-集成安装HUE"><a href="#Ambari-集成安装HUE" class="headerlink" title="Ambari 集成安装HUE"></a>Ambari 集成安装HUE</h1><h2 id="制作hue-tar包"><a href="#制作hue-tar包" class="headerlink" title="制作hue tar包"></a>制作hue tar包</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">tar cvzf hue-3.11.0.tgz 、/usr/local/hue/</div><div class="line">cp hue-3.11.0.tgz /var/www/html/hdp/HDP/centos7/2.6.5.0-292/hue/hue-3.11.0.tgz</div><div class="line"></div><div class="line">cat /etc/yum.repos.d/HDP.repo</div><div class="line">[HDP-2.6-repo-1]</div><div class="line">name=HDP-2.6-repo-1</div><div class="line">baseurl=http://192.168.6.157/hdp/HDP/centos7/2.6.5.0-292/</div><div class="line">path=/</div><div class="line">enabled=1</div><div class="line">gpgcheck=0</div><div class="line"></div><div class="line">vim /usr/lib/ambari-agent/lib/resource_management/core/sudo.py +142</div><div class="line">fp.write(content.encode(&quot;utf-8&quot;))</div></pre></td></tr></table></figure><h2 id="版本说明"><a href="#版本说明" class="headerlink" title="版本说明"></a>版本说明</h2><p>Github中提供了两个版本的Ambari-Hue：v1.0.0和v2.0.0<br><strong>release-1.0.0</strong></p><ul><li>Ambari: 2.1.0~2.2.2</li><li>Hue: 3.9.0</li></ul><p><strong>release-2.0.0</strong></p><ul><li>Ambari: 2.4.0+</li><li>Hue: 3.10.0+</li></ul><h2 id="下载ambari-hue到Ambari组件服务目录"><a href="#下载ambari-hue到Ambari组件服务目录" class="headerlink" title="下载ambari-hue到Ambari组件服务目录"></a>下载ambari-hue到Ambari组件服务目录</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">VERSION=`hdp-select status hadoop-client | sed &apos;s/hadoop-client - \([0-9]\.[0-9]\).*/\1/&apos;`</div><div class="line">rm -rf /var/lib/ambari-server/resources/stacks/HDP/$VERSION/services/HUE  </div><div class="line"># 我们这里使用hue 3.11版本，手动下载v2.0.0</div><div class="line">wget https://github.com/EsharEditor/ambari-hue-service/archive/v2.0.0.tar.gz</div><div class="line">mkdir -p /var/lib/ambari-server/resources/stacks/HDP/$VERSION/services/HUE</div><div class="line">tar xf v2.0.0.tar.gz -C /var/lib/ambari-server/resources/stacks/HDP/$VERSION/services/HUE</div><div class="line">rm -fr /usr/hdp/current/hadoop-client/lib/hue-plugins-3.11.0-SNAPSHOT.jar</div></pre></td></tr></table></figure><h2 id="重启ambari-server"><a href="#重启ambari-server" class="headerlink" title="重启ambari-server"></a>重启ambari-server</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ambari-server restart</div></pre></td></tr></table></figure><h2 id="通过Ambari安装Hue"><a href="#通过Ambari安装Hue" class="headerlink" title="通过Ambari安装Hue"></a>通过Ambari安装Hue</h2><p><code>On bottom left -&gt; Actions -&gt; Add service -&gt; check Hue server -&gt; Next -&gt; Next -&gt; Change any config you like (e.g. install dir, port) -&gt; Next -&gt; Deploy</code><br>数据库使用默认的SqlLite即可，改成postgresql未安装成功！<br><img src="/images/2018/0726/01.png" alt=""><br><img src="/images/2018/0726/02.png" alt=""></p><h1 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h1><h2 id="Q1：编译报错信息：error-ffi-h-No-such-file-or-directory-HUE-3-10-0编译时报此错误"><a href="#Q1：编译报错信息：error-ffi-h-No-such-file-or-directory-HUE-3-10-0编译时报此错误" class="headerlink" title="Q1：编译报错信息：error: ffi.h: No such file or directory (HUE 3.10.0编译时报此错误)"></a>Q1：编译报错信息：error: ffi.h: No such file or directory (HUE 3.10.0编译时报此错误)</h2><p>A1：解决办法：yum -y install libssl-devel libffi-devel</p><h2 id="Q2：启动运行报错：UnicodeDecodeError-‘ascii’-codec-can’t-decode-byte-0xef-in-position-166-ordinal-not-in-range-128"><a href="#Q2：启动运行报错：UnicodeDecodeError-‘ascii’-codec-can’t-decode-byte-0xef-in-position-166-ordinal-not-in-range-128" class="headerlink" title="Q2：启动运行报错：UnicodeDecodeError: ‘ascii’ codec can’t decode byte 0xef in position 166: ordinal not in range(128)"></a>Q2：启动运行报错：UnicodeDecodeError: ‘ascii’ codec can’t decode byte 0xef in position 166: ordinal not in range(128)</h2><p>A2:<br>问题分析：编码问题,Python的str默认是ascii编码，和unicode编码冲突<br>解决办法：在出现问题的python文件或者页面添加如下3行信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">import sys</div><div class="line">reload(sys)</div><div class="line">sys.setdefaultencoding(&apos;utf-8&apos;)</div></pre></td></tr></table></figure></p><h2 id="Q3-Hue提交Oozie任务，任务一直处于运行状态，Log日志报错信息如下：org-apache-oozie-action-ActionExecutorException-JA009-Cannot-initialize-Cluster-Please-check-your-configuration-for-mapreduce-framework-name-and-the-correspond-server-addresses"><a href="#Q3-Hue提交Oozie任务，任务一直处于运行状态，Log日志报错信息如下：org-apache-oozie-action-ActionExecutorException-JA009-Cannot-initialize-Cluster-Please-check-your-configuration-for-mapreduce-framework-name-and-the-correspond-server-addresses" class="headerlink" title="Q3: Hue提交Oozie任务，任务一直处于运行状态，Log日志报错信息如下：org.apache.oozie.action.ActionExecutorException: JA009: Cannot initialize Cluster. Please check your configuration for mapreduce.framework.name and the correspond server addresses"></a>Q3: Hue提交Oozie任务，任务一直处于运行状态，Log日志报错信息如下：org.apache.oozie.action.ActionExecutorException: JA009: Cannot initialize Cluster. Please check your configuration for mapreduce.framework.name and the correspond server addresses</h2><p>A3: 解决办法：在HDFS是ha模式下，需要配置hue-hadoop中配置信息为：logical_name= hdfs://nncluster</p><h2 id="Q4-NoteBook中提交spark-shell任务："><a href="#Q4-NoteBook中提交spark-shell任务：" class="headerlink" title="Q4: NoteBook中提交spark shell任务："></a>Q4: NoteBook中提交spark shell任务：</h2><p>报错：The Spark session could not be created in the cluster: at org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolTranslatorPB.mkdirs(ClientNamenodeProtocolTranslatorPB.java:558) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:606) at org.apache.hadoop.io.retry.RetryInvocationHandler.invokeMethod(RetryInvocationHandler.java:252) at org.apache.hadoop.io.retry.RetryInvocationHandler.invoke(RetryInvocationHandler.java:104) at com.sun.proxy.$Proxy28.mkdirs(Unknown Source) at org.apache.hadoop.hdfs.DFSClient.primitiveMkdir(DFSClient.java:3018) … 28 more<br>A4: 解决办法：在hadoop的core-site.xml文件中添加spark用户的授权信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;property&gt;</div><div class="line">  &lt;name&gt;hadoop.proxyuser.spark.groups&lt;/name&gt;</div><div class="line">  &lt;value&gt;*&lt;/value&gt;</div><div class="line">&lt;/property&gt;</div><div class="line">&lt;property&gt;</div><div class="line">  &lt;name&gt;hadoop.proxyuser.spark.hosts&lt;/name&gt;</div><div class="line">  &lt;value&gt;*&lt;/value&gt;</div><div class="line">&lt;/property&gt;</div></pre></td></tr></table></figure></p><h2 id="Q5-Hue中确认配置好hive以及在hive中添加了相关配置后，发现依旧无法连接Hiveserver2-无Kerberos认证"><a href="#Q5-Hue中确认配置好hive以及在hive中添加了相关配置后，发现依旧无法连接Hiveserver2-无Kerberos认证" class="headerlink" title="Q5: Hue中确认配置好hive以及在hive中添加了相关配置后，发现依旧无法连接Hiveserver2,无Kerberos认证"></a>Q5: Hue中确认配置好hive以及在hive中添加了相关配置后，发现依旧无法连接Hiveserver2,无Kerberos认证</h2><p>Hue中的报错信息：  Could not start SASL: Error in sasl_client_start (-4) SASL(-4): no mechanism available: No worthy mechs foundHiveserver2日志中的报错信息：  ERROR [HiveServer2-Handler-Pool: Thread-31]: server.TThreadPoolServer (TThreadPoolServer.java:run(296)) - Error occurred during processing of message.  java.lang.RuntimeException: org.apache.thrift.transport.TSaslTransportException: No data or no sasl data in the stream<br>A5: 问题分析：Hue连接Hiveserver2使用的是Python，在Centos操作系统上丢失了一些依赖：cyrus-sasl-plain cyrus-sasl-devel cyrus-sasl-gssapi<br>解决办法：yum -y install cyrus-sasl-plain cyrus-sasl-devel cyrus-sasl-gssapi<br>设置以下配置像为NOSASL或None<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;property&gt;</div><div class="line">  &lt;name&gt;hive.server2.authentication&lt;/name&gt;</div><div class="line">  &lt;value&gt;NOSASL&lt;/value&gt;</div><div class="line">  &lt;!--或者设置为</div><div class="line">    &lt;value&gt;None&lt;/value&gt;</div><div class="line">  --&gt;</div><div class="line">&lt;/property&gt;</div></pre></td></tr></table></figure></p><h2 id="Q6-报错信息：django-core-exceptions-ImproperlyConfigured-psycopg2-version-2-5-4-or-newer-is-required-you-have-2-5-1-dt-dec-pq3-ext"><a href="#Q6-报错信息：django-core-exceptions-ImproperlyConfigured-psycopg2-version-2-5-4-or-newer-is-required-you-have-2-5-1-dt-dec-pq3-ext" class="headerlink" title="Q6 报错信息：django.core.exceptions.ImproperlyConfigured: psycopg2_version 2.5.4 or newer is required; you have 2.5.1 (dt dec pq3 ext)"></a>Q6 报错信息：django.core.exceptions.ImproperlyConfigured: psycopg2_version 2.5.4 or newer is required; you have 2.5.1 (dt dec pq3 ext)</h2><p>A6: 解决方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">pip install --upgrade pip</div><div class="line">pip upgrade psycopg2</div><div class="line">pip install psycopg2-binary</div></pre></td></tr></table></figure></p><h2 id="Q7报错信息：RuntimeError-Model-class-beeswax-models-QueryHistory-doesn’t-declare-an-explicit-app-label-and-isn’t-in-an-application-in-INSTALLED-APPS"><a href="#Q7报错信息：RuntimeError-Model-class-beeswax-models-QueryHistory-doesn’t-declare-an-explicit-app-label-and-isn’t-in-an-application-in-INSTALLED-APPS" class="headerlink" title="Q7报错信息：RuntimeError: Model class beeswax.models.QueryHistory doesn’t declare an explicit app_label and isn’t in an application in INSTALLED_APPS."></a>Q7报错信息：RuntimeError: Model class beeswax.models.QueryHistory doesn’t declare an explicit app_label and isn’t in an application in INSTALLED_APPS.</h2><p>A7:  解决方法，修改配置文件/usr/local/hue/desktop/core/src/desktop/settings.py<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">INSTALLED_APPS = [</div><div class="line">    &apos;beeswax&apos;,</div><div class="line">    &apos;oozie&apos;,</div><div class="line">]</div></pre></td></tr></table></figure></p><h2 id="Q8-web也没访问报错信息：Invalid-HTTP-HOST-header-’bigdata05-islocal-cc-8888’-You-may-need-to-add-u’bigdata05-islocal-cc’-to-ALLOWED-HOSTS"><a href="#Q8-web也没访问报错信息：Invalid-HTTP-HOST-header-’bigdata05-islocal-cc-8888’-You-may-need-to-add-u’bigdata05-islocal-cc’-to-ALLOWED-HOSTS" class="headerlink" title="Q8 web也没访问报错信息：Invalid HTTP_HOST header:’bigdata05.islocal.cc:8888’.You may need to add u’bigdata05.islocal.cc’ to ALLOWED_HOSTS."></a>Q8 web也没访问报错信息：Invalid HTTP_HOST header:’bigdata05.islocal.cc:8888’.You may need to add u’bigdata05.islocal.cc’ to ALLOWED_HOSTS.</h2><p>A8： 解决方法，修改配置文件/usr/local/hue/desktop/core/src/desktop/settings.py<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ALLOWED_HOSTS = [&apos;*&apos;]</div></pre></td></tr></table></figure></p><h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><p><a href="https://eshareditor.github.io/2016/09/14/Hue-编译安装/" target="_blank" rel="external">https://eshareditor.github.io/2016/09/14/Hue-编译安装/</a><br><a href="https://eshareditor.github.io/2016/10/11/Ambari-Hue-Service/" target="_blank" rel="external">https://eshareditor.github.io/2016/10/11/Ambari-Hue-Service/</a><br>SDK文档：<a href="http://cloudera.github.io/hue/docs-3.7.0/sdk/sdk.html#introduction-and-overview" target="_blank" rel="external">http://cloudera.github.io/hue/docs-3.7.0/sdk/sdk.html#introduction-and-overview</a><br>Hue配置信息说明(中文):2018/7/26 <a href="http://www.cloudera.com/content/www/zh-CN/documentation/enterprise/5-3-x/topics/cdh_ig_hue_config.html" target="_blank" rel="external">http://www.cloudera.com/content/www/zh-CN/documentation/enterprise/5-3-x/topics/cdh_ig_hue_config.html</a><br>(英文)<a href="http://archive.cloudera.com/cdh5/cdh/5/hue/user-guide/index.html" target="_blank" rel="external">http://archive.cloudera.com/cdh5/cdh/5/hue/user-guide/index.html</a></p>]]></content>
      
      
      <categories>
          
          <category> 大数据 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ambari </tag>
            
            <tag> HDP </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>关闭Oracle审计日志，解决因AUD$数据过大，导致SYSTEM表空间暴涨的问题</title>
      <link href="/arlo/ddea0a3f/"/>
      <url>/arlo/ddea0a3f/</url>
      
        <content type="html"><![CDATA[<p>生产服务器报错，system表空间满了，拓展了表空间重启服务后正常，但是很好奇system表空间怎么会增长这么快？业务数据默认存放在USERS表空间和TEMP临时表空间中。<br><a id="more"></a></p><h1 id="查询一下system表空间中占用空间最大的表"><a href="#查询一下system表空间中占用空间最大的表" class="headerlink" title="查询一下system表空间中占用空间最大的表"></a>查询一下system表空间中占用空间最大的表</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">SELECT *</div><div class="line">  FROM (SELECT SEGMENT_NAME, SUM(BYTES) / 1024 / 1024 MB</div><div class="line">          FROM DBA_SEGMENTS</div><div class="line">         WHERE TABLESPACE_NAME = &apos;SYSTEM&apos;</div><div class="line">         GROUP BY SEGMENT_NAME</div><div class="line">         ORDER BY 2 DESC)</div><div class="line"> WHERE ROWNUM &lt; 10;</div></pre></td></tr></table></figure><h1 id="查询一下system空间占用比"><a href="#查询一下system空间占用比" class="headerlink" title="查询一下system空间占用比"></a>查询一下system空间占用比</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">SELECT B.TABLESPACE_NAME &quot;表空间&quot;,</div><div class="line">       　B.BYTES / 1024 / 1024 &quot;大小M&quot;,</div><div class="line">       　(B.BYTES - SUM(NVL(A.BYTES, 0))) / 1024 / 1024 &quot;已使用M&quot;,</div><div class="line">       　SUBSTR((B.BYTES - SUM(NVL(A.BYTES, 0))) / (B.BYTES) * 100, 1, 5) &quot;利用率&quot; 　FROM DBA_FREE_SPACE A,</div><div class="line">       DBA_DATA_FILES B 　WHERE A.FILE_ID = B.FILE_ID AND B.TABLESPACE_NAME = &apos;SYSTEM&apos; 　GROUP BY B.TABLESPACE_NAME,</div><div class="line">       B.FILE_NAME,</div><div class="line">       B.BYTES ORDER BY B.TABLESPACE_NAME;</div></pre></td></tr></table></figure><h1 id="查询AUD-占用空间"><a href="#查询AUD-占用空间" class="headerlink" title="查询AUD$占用空间"></a>查询AUD$占用空间</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">SELECT SEGMENT_NAME, BYTES / 1024 / 1024 &quot;占用空间M&quot;</div><div class="line">  FROM DBA_SEGMENTS</div><div class="line"> WHERE SEGMENT_NAME = &apos;AUD$&apos;;</div></pre></td></tr></table></figure><h1 id="查看aud审计策略"><a href="#查看aud审计策略" class="headerlink" title="查看aud审计策略"></a>查看aud审计策略</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">show parameter audit_trail</div></pre></td></tr></table></figure><p>发现数据库启用了DB级别的审计功能，相关审计级别如下：<br>None：是默认值，不做审计；<br>DB：将audit trail 记录在数据库的审计相关表中，如aud$，审计的结果只有连接信息；<br>DB,Extended：这样审计结果里面除了连接信息还包含了当时执行的具体语句；<br>OS：将audit trail 记录在操作系统文件中，文件名由audit_file_dest参数指定；</p><h1 id="截断数据"><a href="#截断数据" class="headerlink" title="截断数据"></a>截断数据</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">truncate table aud$;</div></pre></td></tr></table></figure><h1 id="修改spfile启动文件，关闭审计功能"><a href="#修改spfile启动文件，关闭审计功能" class="headerlink" title="修改spfile启动文件，关闭审计功能"></a>修改spfile启动文件，关闭审计功能</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter system set audit_trail=NONE scope=spfile;</div><div class="line">SQL&gt; shutdown immediate;</div><div class="line">SQL&gt; startup</div></pre></td></tr></table></figure><p><img src="/images/2018/0725/01.png" alt=""><br><img src="/images/2018/0725/02.png" alt=""></p><p>参考链接：<br><a href="https://blog.csdn.net/melody_mr/article/details/41208849" target="_blank" rel="external">https://blog.csdn.net/melody_mr/article/details/41208849</a><br><a href="https://blog.csdn.net/lwei_998/article/details/7394638" target="_blank" rel="external">https://blog.csdn.net/lwei_998/article/details/7394638</a></p>]]></content>
      
      
      <categories>
          
          <category> Troubleshooting </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>自建KMS服务器，激活Windows &amp; Office</title>
      <link href="/arlo/8566e00c/"/>
      <url>/arlo/8566e00c/</url>
      
        <content type="html"><![CDATA[<p>全文转自：<a href="https://lolico.moe/tutorial/linux-kms-server.html" target="_blank" rel="external">https://lolico.moe/tutorial/linux-kms-server.html</a></p><h1 id="One-key-KMS"><a href="#One-key-KMS" class="headerlink" title="One key KMS"></a>One key KMS</h1><p>Linux 快速搭建 KMS 激活服务器，让 PC 激活 Windows 和 Office 并自动续期，告别网上的来路不明的激活工具，防止意外中毒。虽然目前已经有各种 PC 用的 KMS 激活程序，例如KMSAuto或者KMS VL ALL之类的，但是他们都会被 Windows Defender 或者普通的杀毒软件认为是病毒。虽然你“相信”这些软件被报毒是很正常的，直接加入白名单了事，然而你确实不知道你从网上搜索下载的这些激活程序是不是真的经过别人的改造植入了病毒……<br>因此，我们可以利用自己的 Linux VPS 搭建 KMS 激活服务器给自己的 PC 使用，这样既安全无毒又不怕激活丢失。<br>只能激活<strong>VL 版本</strong>（即“<a href="https://baike.baidu.com/item/VOL%E7%89%88" target="_blank" rel="external">团体批量许可证</a>”版）的 Windows，Office 则有办法从零售版转成 VL 版所以不用担心<br><a id="more"></a></p><h1 id="一键搭建-KMS-服务"><a href="#一键搭建-KMS-服务" class="headerlink" title="一键搭建 KMS 服务"></a>一键搭建 KMS 服务</h1><h2 id="下载脚本并运行，根据提示键入y开始安装"><a href="#下载脚本并运行，根据提示键入y开始安装" class="headerlink" title="下载脚本并运行，根据提示键入y开始安装"></a>下载脚本并运行，根据提示键入y开始安装</h2><p>CentOS / Redhat / Fedora<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget https://raw.githubusercontent.com/dakkidaze/one-key-kms/master/one-key-kms-centos.sh &amp;&amp; chmod +x one-key-kms-centos.sh &amp;&amp;./one-key-kms-centos.sh</div></pre></td></tr></table></figure></p><p>Debian / Ubuntu / Mint<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget https://raw.githubusercontent.com/dakkidaze/one-key-kms/master/one-key-kms-debian.sh &amp;&amp; chmod +x one-key-kms-debian.sh &amp;&amp; ./one-key-kms-debian.sh</div></pre></td></tr></table></figure></p><h2 id="下载这个作者写的配套脚本来控制启动-停止-重启等"><a href="#下载这个作者写的配套脚本来控制启动-停止-重启等" class="headerlink" title="下载这个作者写的配套脚本来控制启动/停止/重启等"></a>下载这个作者写的配套脚本来控制启动/停止/重启等</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#下载脚本</div><div class="line">wget https://raw.githubusercontent.com/dakkidaze/one-key-kms/master/kms.sh &amp;&amp; chmod +x kms.sh</div><div class="line">#启动 KMS 服务</div><div class="line">./kms.sh start</div><div class="line">#这个脚本可以使用的参数：</div><div class="line"># start | stop | restart | status</div></pre></td></tr></table></figure><h2 id="如果你的防火墙默认-DROP，那么需要手动放行1688端口"><a href="#如果你的防火墙默认-DROP，那么需要手动放行1688端口" class="headerlink" title="如果你的防火墙默认 DROP，那么需要手动放行1688端口"></a>如果你的防火墙默认 DROP，那么需要手动放行1688端口</h2><p>CentOS / Redhat / Fedora<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iptables -I INPUT -p tcp --dport 1688 -j ACCEPT</div></pre></td></tr></table></figure></p><p>Debian / Ubuntu / Mint<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#如果有 ufw 的话</div><div class="line">ufw allow 1688</div><div class="line">#如果没有的话，这么方便的防火墙工具为啥不装一个嘞~</div></pre></td></tr></table></figure></p><h1 id="激活-Windows"><a href="#激活-Windows" class="headerlink" title="激活 Windows"></a>激活 Windows</h1><p>再次提醒，只能激活 VL 版的系统<br>以管理员身份运行命令提示符或者PowerShell，然后输入以下命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cd /d &quot;%SystemRoot%\system32&quot;</div><div class="line">slmgr /skms 你的KMS服务端主机的IP或者域名</div><div class="line">slmgr /ato</div><div class="line">slmgr /xpr</div></pre></td></tr></table></figure></p><p>这样，每过 180 天，系统都会自动与你的 KMS 服务器通信来激活 Windows，只要到时候你的 KMS 服务器还在，Windows 就能继续激活;当然，你也可以随时通过slmgr /skms这条命令来更换你的 KMS 服务器地址</p><h1 id="激活-Office"><a href="#激活-Office" class="headerlink" title="激活 Office"></a>激活 Office</h1><p>只能激活 VL 版的 Office，如果是零售版，百度一下有很多将零售版转换为 VL 版的方法和批处理脚本；如果你比较懒，也可以直接利用KMSAuto工具来转换<br>首先确定你的 Office 版本所对应的目录名称：</p><table><thead><tr><th style="text-align:center">版本</th><th style="text-align:center">目录名称</th></tr></thead><tbody><tr><td style="text-align:center">2016</td><td style="text-align:center">Office16</td></tr><tr><td style="text-align:center">2013</td><td style="text-align:center">Office15</td></tr><tr><td style="text-align:center">2010</td><td style="text-align:center">Office14</td></tr></tbody></table><p>如果你的 Office 是 32 位的，那么目录就在<br><code>C:\Program Files (x86)\Microsoft Office\目录名称</code><br>如果是 64 位，那么在<br><code>C:\Program Files\Microsoft Office\目录名称</code><br>接下来以管理员身份运行命令提示符或者PowerShell，然后输入以下命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#以 64 位的 Office2016 为例，进入 Office 目录</div><div class="line">cd &quot;C:\Program Files\Microsoft Office\Office16&quot;</div><div class="line">cscript ospp.vbs /sethst:你的KMS服务端主机的IP或者域名</div><div class="line">cscript ospp.vbs /act</div></pre></td></tr></table></figure></p><p><img src="/images/2018/0702/01.png" alt="kms"></p><h1 id="其他说明"><a href="#其他说明" class="headerlink" title="其他说明"></a>其他说明</h1><h2 id="开机自启"><a href="#开机自启" class="headerlink" title="开机自启"></a>开机自启</h2><p>如果只是想简单的让 KMS 服务在 Linux 上开机自启，那么编辑/etc/rc.local文件，在exit 0（如果有）前面加上一句</p><p>假设之前下载的那个 kms.sh 脚本位于 /root/kms.sh<br><code>/root/kms.sh start</code><br>然后保存即可</p><h2 id="守护进程"><a href="#守护进程" class="headerlink" title="守护进程"></a>守护进程</h2><p>如果你有很高的要求，想让 KMS 服务以守护进程的方式运行，防止服务意外终止<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">#Debian / Ubuntu / Mint 使用 apt-get 来安装 supervisor</div><div class="line">#CentOS / Redhat / Fedora 使用 yum 来安装 supervisor</div><div class="line">#这里以 Debian 系统为例</div><div class="line">apt-get install supervisor -y</div><div class="line">echo &quot;[program:kms]</div><div class="line">command=/usr/local/kms/vlmcsd -L 0.0.0.0:1688</div><div class="line">autorestart=true</div><div class="line">autostart=true</div><div class="line">user=root&quot; &gt; /etc/supervisor/conf.d/kms.conf</div><div class="line">/etc/init.d/supervisor restart</div></pre></td></tr></table></figure></p><p>如果你使用守护进程方式运行 KMS 服务，那么就不需要在/etc/rc.local中写入开机启动命令</p><h1 id="windows各版本简洁介绍"><a href="#windows各版本简洁介绍" class="headerlink" title="windows各版本简洁介绍"></a>windows各版本简洁介绍</h1><h2 id="Retail版"><a href="#Retail版" class="headerlink" title="Retail版"></a>Retail版</h2><p>RTL版Retail正式零售版，供市面上架零售。<br>另外，在安装盘的i386文件夹里有一个eula.txt文件，最后有一行EULAID，就是你的版本标识。<br>简体中文正式版是EULAID:WX.4_PRO_RTL_CN；<br>繁体中文正式版是WX.4_PRO_RTL_TW；<br>其中：<br>WX.开头是正式版，WB.开头是测试版；<br>_PRE代表家庭版，_PRO代表专业版；</p><h2 id="VOL版"><a href="#VOL版" class="headerlink" title="VOL版"></a>VOL版</h2><p>Volume OR Volume Licensing for Organizations 翻译过来就是组织团体批量许可，也就是大客户版，比如ZF部门、大型商业机构等统一购买的一般都是大客户版本，一般根据购买数量又可细分为开放式许可( Open License)、选择式许可(Select License)、企业许可协议(Enterprise Agreement)、教育科研许可(Academic Volume Licensing)等5种版本。</p><h2 id="OEM版"><a href="#OEM版" class="headerlink" title="OEM版"></a>OEM版</h2><p>Original Equipment Manufacturer 计算机厂商随机版，只能随计算机一对一出货，不可以单独零售。只能全新安不能从旧有操作系统升级，包装也不像零售版那样精美（反正是随机子打包的，穿的再好也没用<em>_</em>），通常只有一面CD盘和使用授权说明书。比如联想、DELL等出售的WINDOWS操作系统计算机一般都是。</p><h2 id="Alpha版"><a href="#Alpha版" class="headerlink" title="Alpha版"></a>Alpha版</h2><p>Alpha内部测试版，一般不会向外部发布，会有很多Bug，只供测试人员使用，如果您看到Alpha版本了，一般来讲对于微软来讲可能是个不好的消息。<br>Beta版Beta也是测试版，是继Alpha之后推出，这个阶段的版本会不断加入新的功能，改动也会较大，也会面向市场测试。</p><h1 id="RC版"><a href="#RC版" class="headerlink" title="RC版"></a>RC版</h1><p>ReleaseCandidate 测试候选版本，WINDOWS RC版不会再加入新功能，主要测试软件内的BUG。</p><h2 id="RTM版"><a href="#RTM版" class="headerlink" title="RTM版"></a>RTM版</h2><p>Release to Manufacture或者Resin Transfer Molding 供给生产工厂大量压片的版本，内容跟正式版是一样的，不过RTM版也会在时间上再次划分出限制版和评估版的。再次进行市场验证。</p><h2 id="EVAL版"><a href="#EVAL版" class="headerlink" title="EVAL版"></a>EVAL版</h2><p>Evaluation 与“评估版”类似，功能上和零售版没有区别，需要激活。</p><h2 id="CTP版"><a href="#CTP版" class="headerlink" title="CTP版"></a>CTP版</h2><p>Community Test Preview 社区测试试用版</p><p>相关链接：<br><a href="https://lolico.moe/tutorial/linux-kms-server.html" target="_blank" rel="external">https://lolico.moe/tutorial/linux-kms-server.html</a><br><a href="https://hub.docker.com/r/ilemonrain/vlmcsd/" target="_blank" rel="external">https://hub.docker.com/r/ilemonrain/vlmcsd/</a><br><a href="https://github.com/Wind4/vlmcsd" target="_blank" rel="external">https://github.com/Wind4/vlmcsd</a><br><a href="https://github.com/SystemRage/py-kms" target="_blank" rel="external">https://github.com/SystemRage/py-kms</a></p><hr>]]></content>
      
      
      <categories>
          
          <category> 服务器搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> 激活 </tag>
            
            <tag> KMS </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Ambari+HDP大数据平台搭建</title>
      <link href="/arlo/34b2c7a7/"/>
      <url>/arlo/34b2c7a7/</url>
      
        <content type="html"><![CDATA[<h1 id="Ambari-是什么？"><a href="#Ambari-是什么？" class="headerlink" title="Ambari 是什么？"></a>Ambari 是什么？</h1><p>Ambari 跟 Hadoop 等开源软件一样，也是 Apache Software Foundation 中的一个项目，并且是顶级项目。（<a href="http://ambari.apache.org）" target="_blank" rel="external">http://ambari.apache.org）</a> 目前最新的发布版本是 2.6.2.0；Ambari可以简单的理解为开源的Hadoop生态圈（Hive，Yarn，Hbase，Hive，Sqoop，Kafka，Zookeeper，spark 等）平台的管理软件，具备Hadoop组件的安装、管理、运维等基本功能，提供Web UI进行可视化的集群管理，简化了大数据平台的安装、使用难度。<br><a id="more"></a></p><h1 id="基础环境配置"><a href="#基础环境配置" class="headerlink" title="基础环境配置"></a>基础环境配置</h1><h2 id="资源规划"><a href="#资源规划" class="headerlink" title="资源规划"></a>资源规划</h2><table><thead><tr><th style="text-align:center">主机名</th><th style="text-align:center">IP地址</th><th style="text-align:center">操作系统</th></tr></thead><tbody><tr><td style="text-align:center">bigdata01.islocal.cc</td><td style="text-align:center">192.168.6.164</td><td style="text-align:center">CentOS Linux release 7.4.1708 (Core)</td></tr><tr><td style="text-align:center">bigdata02.islocal.cc</td><td style="text-align:center">192.168.6.181</td><td style="text-align:center">CentOS Linux release 7.4.1708 (Core)</td></tr><tr><td style="text-align:center">bigdata03.islocal.cc</td><td style="text-align:center">192.168.6.183</td><td style="text-align:center">CentOS Linux release 7.4.1708 (Core)</td></tr><tr><td style="text-align:center">bigdata04.islocal.cc</td><td style="text-align:center">192.168.6.194</td><td style="text-align:center">CentOS Linux release 7.4.1708 (Core)</td></tr></tbody></table><h2 id="软件版本"><a href="#软件版本" class="headerlink" title="软件版本"></a>软件版本</h2><p>JDK        1.8.1.8.0_112<br>postgresql    10.3<br>Ambari        2.6.2.0-155<br>HDP        2.6.4.0-91<br>HDP-GPL        2.6.4.0-91<br>HDP-UTILS    1.1.0.22    </p><h2 id="下载地址"><a href="#下载地址" class="headerlink" title="下载地址"></a>下载地址</h2><ol><li>首先登陆官方页面<br><a href="https://docs.hortonworks.com/index.html" target="_blank" rel="external">https://docs.hortonworks.com/index.html</a></li><li>选择需要的版本</li><li>点击installation</li><li>选择Install Ambari</li><li>选择左侧的Ambari Repositories、HDP Stack Repositories</li></ol><h2 id="关闭防火墙和Selinux"><a href="#关闭防火墙和Selinux" class="headerlink" title="关闭防火墙和Selinux"></a>关闭防火墙和Selinux</h2><h3 id="关闭防火墙"><a href="#关闭防火墙" class="headerlink" title="关闭防火墙"></a>关闭防火墙</h3><p><code>systemctl stop firewalld.service</code></p><h3 id="禁用防火墙"><a href="#禁用防火墙" class="headerlink" title="禁用防火墙"></a>禁用防火墙</h3><p><code>systemctl disable firewalld.service</code></p><p>#查询防火墙服务状态<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@bigdata01 ~]# systemctl status firewalld.service</div><div class="line">● firewalld.service - firewalld - dynamic firewall daemon</div><div class="line">   Loaded: loaded (/usr/lib/systemd/system/firewalld.service; disabled; vendor preset: enabled)</div><div class="line">   Active: inactive (dead)</div><div class="line">     Docs: man:firewalld(1)</div></pre></td></tr></table></figure></p><h3 id="关闭Selinux"><a href="#关闭Selinux" class="headerlink" title="关闭Selinux"></a>关闭Selinux</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sed -i &apos;s/SELINUX=enforcing/SELINUX=disabled/&apos; /etc/selinux/config</div><div class="line">grep SELINUX=disabled /etc/selinux/config</div><div class="line">setenforce 0</div></pre></td></tr></table></figure><h3 id="查看Selinux状态"><a href="#查看Selinux状态" class="headerlink" title="查看Selinux状态"></a>查看Selinux状态</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@bigdata01 ~]# sestatus </div><div class="line">SELinux status:                 disabled</div></pre></td></tr></table></figure><p>or<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@bigdata01 ~]# getenforce </div><div class="line">Disabled</div></pre></td></tr></table></figure></p><h2 id="新建用户"><a href="#新建用户" class="headerlink" title="新建用户"></a>新建用户</h2><p><code>useradd hadoop &amp;&amp; echo &quot;hadoop:hadoop&quot; | chpasswd</code><br><code>visudo</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">## Allow root to run any commands anywhere </div><div class="line">root    ALL=(ALL)       ALL</div><div class="line">hadoop  ALL=(ALL)       ALL#赋予hadoop用户所有权限</div><div class="line"></div><div class="line">## Allows members of the &apos;sys&apos; group to run networking, software, </div><div class="line">## service management apps and more.</div><div class="line"># %sys ALL = NETWORKING, SOFTWARE, SERVICES, STORAGE, DELEGATING, PROCESSES, LOCATE, DRIVERS</div><div class="line"></div><div class="line">## Allows people in group wheel to run all commands</div><div class="line">%wheel  ALL=(ALL)       ALL</div><div class="line">hadoop          ALL=(ALL)       NOPASSWD: ALL#hadoop用户执行sudo不用输入密码</div></pre></td></tr></table></figure></p><h2 id="hadoop用户免密配置"><a href="#hadoop用户免密配置" class="headerlink" title="hadoop用户免密配置"></a>hadoop用户免密配置</h2><h3 id="配置bigdata01主机上的hosts"><a href="#配置bigdata01主机上的hosts" class="headerlink" title="配置bigdata01主机上的hosts"></a>配置bigdata01主机上的hosts</h3><p><code>[root@bigdata01 ~]# cat /etc/hosts</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</div><div class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</div><div class="line">192.168.6.164bigdata01.islocal.cc</div><div class="line">192.168.6.181bigdata02.islocal.cc</div><div class="line">192.168.6.183bigdata03.islocal.cc</div><div class="line">192.168.6.194bigdata04.islocal.cc</div></pre></td></tr></table></figure></p><h3 id="复制-etc-hosts到其他主机"><a href="#复制-etc-hosts到其他主机" class="headerlink" title="复制/etc/hosts到其他主机"></a>复制/etc/hosts到其他主机</h3><p><code>scp /etc/hosts bigdata02.islocal.cc:/etc/hosts</code><br><code>scp /etc/hosts bigdata03.islocal.cc:/etc/hosts</code><br><code>scp /etc/hosts bigdata04.islocal.cc:/etc/hosts</code></p><h3 id="配置免密"><a href="#配置免密" class="headerlink" title="配置免密"></a>配置免密</h3><p><code>su - hadoop</code><br><code>ssh-keygen    #默认一路回车</code></p><h3 id="拷贝秘钥到其他主机"><a href="#拷贝秘钥到其他主机" class="headerlink" title="拷贝秘钥到其他主机"></a>拷贝秘钥到其他主机</h3><p><code>ssh-copy-id bigdata01.islocal.cc</code><br><code>ssh-copy-id bigdata02.islocal.cc</code><br><code>ssh-copy-id bigdata03.islocal.cc</code><br><code>ssh-copy-id bigdata04.islocal.cc</code></p><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p><code>ssh bigdata01.islocal.cc date</code><br><code>ssh bigdata02.islocal.cc date</code><br><code>ssh bigdata03.islocal.cc date</code><br><code>ssh bigdata04.islocal.cc date</code></p><h2 id="配置时间同步"><a href="#配置时间同步" class="headerlink" title="配置时间同步"></a>配置时间同步</h2><p>如果服务器可以上外网，直接使用公网时间服务器即可<br><code>yum -y install ntpdate</code><br><code>crontab -e</code><br>添加下边这行，保存。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">*/10 * * * * /usr/sbin/ntpdate cn.ntp.org.cn &amp;&amp; hwclock -w</div></pre></td></tr></table></figure></p><h2 id="安装JDK"><a href="#安装JDK" class="headerlink" title="安装JDK"></a>安装JDK</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">mkdir /usr/ths</div><div class="line">tar xf jdk1.8.0_112.tgz -C /usr/ths</div><div class="line"># 安装jce</div><div class="line">http://www.oracle.com/technetwork/java/javase/downloads/jce8-download-2133166.html</div><div class="line">unzip -o -j -q jce_policy-8.zip -d /usr/ths/jdk1.8.0_112/jre/lib/security/</div><div class="line"></div><div class="line">vim /etc/profile</div><div class="line">export EDITOR=/usr/bin/vim</div><div class="line">export HISTSIZE=10000</div><div class="line">export HISTTIMEFORMAT=&quot;%F %T &quot;</div><div class="line">export JAVA_HOME=/usr/ths/jdk1.8.0_112</div><div class="line">export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</div><div class="line"></div><div class="line">source /etc/profile</div></pre></td></tr></table></figure><h2 id="系统参数优化"><a href="#系统参数优化" class="headerlink" title="系统参数优化"></a>系统参数优化</h2><p><code>vim /etc/security/limits.conf</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">* soft nofile 65536</div><div class="line">* hard nofile 65536</div></pre></td></tr></table></figure></p><h1 id="本地仓库搭建"><a href="#本地仓库搭建" class="headerlink" title="本地仓库搭建"></a>本地仓库搭建</h1><p>由于ambari，hdp软件包很大，使用官方的yum源安装比较慢，我们搭建一个本地仓库，使用本地yum源</p><h2 id="安装配置web服务器"><a href="#安装配置web服务器" class="headerlink" title="安装配置web服务器"></a>安装配置web服务器</h2><h3 id="安装依赖包"><a href="#安装依赖包" class="headerlink" title="安装依赖包"></a>安装依赖包</h3><p><code>yum install gcc gcc-c++ make automake autoconf libtool pcre pcre-devel zlib zlib-devel openssl openssl-devel wget</code></p><h3 id="安装nginx"><a href="#安装nginx" class="headerlink" title="安装nginx"></a>安装nginx</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">wget http://nginx.org/download/nginx-1.14.0.tar.gz</div><div class="line">tar xf nginx-1.14.0.tar.gz</div><div class="line">cd nginx-1.14.0</div><div class="line">./configure --prefix=/usr/ths/nginx-1.14.0/ &amp;&amp; make &amp;&amp; make install</div></pre></td></tr></table></figure><h3 id="更换nginx根目录"><a href="#更换nginx根目录" class="headerlink" title="更换nginx根目录"></a>更换nginx根目录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">mkdir -p /var/www/html/</div><div class="line">vim /usr/ths/nginx-1.14.0/conf/nginx.conf</div><div class="line">...</div><div class="line">location / &#123;</div><div class="line">            root   /var/www/html;</div><div class="line">            index  index.html index.htm;</div><div class="line">            autoindex on;#允许列出目录</div><div class="line">        &#125;</div><div class="line">...</div><div class="line">#监测配置文件是否正确</div><div class="line">cd /usr/ths/nginx-1.14.0/sbin</div><div class="line">./nginx -t</div><div class="line">#启动</div><div class="line">./nginx</div></pre></td></tr></table></figure><h2 id="解压文件到nginx发布目录下"><a href="#解压文件到nginx发布目录下" class="headerlink" title="解压文件到nginx发布目录下"></a>解压文件到nginx发布目录下</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mkdir -p  /var/www/html/hdp/</div><div class="line">tar xf ambari-2.6.2.0-centos7.tar.gz -C /var/www/html/</div><div class="line">tar xf HDP-GPL-2.6.4.0-centos7-rpm.tar.gz -C /var/www/html/hdp/</div><div class="line">tar xf HDP-UTILS-1.1.0.22-centos7.tar.gz -C /var/www/html/hdp/</div><div class="line">tar xf HDP-2.6.4.0-centos7-rpm.tar.gz -C /var/www/html/hdp/</div></pre></td></tr></table></figure><p>目录结构如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">[root@bigdata01 ~]# tree -L 4 /var/www/html/</div><div class="line">/var/www/html/</div><div class="line">├── ambari</div><div class="line">│   └── centos7</div><div class="line">│       └── 2.6.2.0-155</div><div class="line">│           ├── ambari</div><div class="line">│           ├── ambari.repo</div><div class="line">│           ├── artifacts.txt</div><div class="line">│           ├── build.id</div><div class="line">│           ├── build_metadata.txt</div><div class="line">│           ├── repodata</div><div class="line">│           ├── RPM-GPG-KEY</div><div class="line">│           ├── smartsense</div><div class="line">│           └── tars</div><div class="line">└── hdp</div><div class="line">    ├── HDP</div><div class="line">    │   └── centos7</div><div class="line">    │       └── 2.6.4.0-91</div><div class="line">    ├── HDP-GPL</div><div class="line">    │   └── centos7</div><div class="line">    │       └── 2.6.4.0-91</div><div class="line">    └── HDP-UTILS</div><div class="line">        └── centos7</div><div class="line">            └── 1.1.0.22</div><div class="line"></div><div class="line">18 directories, 4 files</div></pre></td></tr></table></figure></p><h2 id="安装本地源制作相关工具"><a href="#安装本地源制作相关工具" class="headerlink" title="安装本地源制作相关工具"></a>安装本地源制作相关工具</h2><p><code>yum install yum-utils createrepo</code></p><h2 id="编辑repo文件"><a href="#编辑repo文件" class="headerlink" title="编辑repo文件"></a>编辑repo文件</h2><p><code>cat /etc/yum.repos.d/ambari.repo</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#VERSION_NUMBER=2.6.2.0-155</div><div class="line">[ambari-2.6.2.0]</div><div class="line">name=ambari Version - ambari-2.6.2.0</div><div class="line">baseurl=http://192.168.6.164/ambari/centos7/2.6.2.0-155/</div><div class="line">gpgcheck=0</div></pre></td></tr></table></figure></p><h1 id="安装数据库"><a href="#安装数据库" class="headerlink" title="安装数据库"></a>安装数据库</h1><p>Ambari支持PostgreSQL 9.1.13+,9.3, 9.4 MariaDB 10.1 MySQL 5.6 Oracle 11gr2 Oracle 12c 等版本数据库，我们这里使用postgres数据库。</p><h2 id="创建用户和组"><a href="#创建用户和组" class="headerlink" title="创建用户和组"></a>创建用户和组</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">groupadd postgres    #新增用户组</div><div class="line">useradd -g postgres postgres    #新增用户</div><div class="line">passwd postgres    #为用户设置密码</div></pre></td></tr></table></figure><h2 id="创建数据目录，并授予权限"><a href="#创建数据目录，并授予权限" class="headerlink" title="创建数据目录，并授予权限"></a>创建数据目录，并授予权限</h2><p><code>mkdir -p /usr/ths/data/PGDATA</code><br><code>chown postgres:postgres /usr/ths/data/PGDATA</code><br><code>chmod 700 /usr/ths/data/PGDATA</code></p><h2 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">tar -zxvf  postgresql-10.3.tar.gz</div><div class="line">cd postgresql-10.3</div><div class="line">./configure --prefix=/usr/ths/pgsql-10.3 --without-readline</div><div class="line">sudo make</div><div class="line">sudo make install</div><div class="line">su - postgres   </div><div class="line">/usr/ths/pgsql-10.3/bin/initdb -D /usr/ths/data/PGDATA  #初始化配置和数据库</div></pre></td></tr></table></figure><h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># -D 为数据文件位置  -l 为日志文件位置(日志文件不存在会自动创建)</div><div class="line">/usr/ths/pgsql-10.3/bin/pg_ctl start -D /usr/ths/data/PGDATA -l /usr/ths/data/PGDATA/pgsql.log</div></pre></td></tr></table></figure><p>#可选。 配置环境变量<br><code>vi cat /etc/profile</code><br>追加以下两行到/etc/profile<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">export PG_HOME=/usr/ths/pgsql-10.3</div><div class="line">export PATH=$PG_HOME/bin:$PATH   </div><div class="line">#注意，环境变量要把:$PATH写在后面，可以避免一些版本冲突问题</div></pre></td></tr></table></figure></p><h2 id="配置文件修改"><a href="#配置文件修改" class="headerlink" title="配置文件修改"></a>配置文件修改</h2><p>/usr/ths/data/PGDATA/postgresql.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">listen_addresses = &apos;*&apos;</div></pre></td></tr></table></figure></p><p>pg_hba.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">host all all 192.168.6.1/24 trust</div></pre></td></tr></table></figure></p><h2 id="新建ambari数据库"><a href="#新建ambari数据库" class="headerlink" title="新建ambari数据库"></a>新建ambari数据库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">su - postgres</div><div class="line">#进入psql命令行工具</div><div class="line">psql</div><div class="line">#依次执行以下建库建用户语句</div><div class="line">CREATE DATABASE ambari; </div><div class="line">CREATE USER hdp WITH PASSWORD &apos;solution&apos;;</div><div class="line">GRANT ALL PRIVILEGES ON DATABASE ambari TO hdp; </div><div class="line">\connect ambari; </div><div class="line">CREATE SCHEMA AMBARI AUTHORIZATION hdp;</div><div class="line">ALTER SCHEMA AMBARI OWNER TO hdp;</div><div class="line">ALTER ROLE hdp SET search_path to &apos;AMBARI&apos;, &apos;public&apos;;</div><div class="line">#退出</div><div class="line">\q</div></pre></td></tr></table></figure><p>执行Ambari的DDL语句<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># 以hdp用户，连接ambari库</div><div class="line">psql -U hdp -d ambari</div><div class="line"># 执行DDL语句</div><div class="line">\i /var/lib/ambari-server/resources/Ambari-DDL-Postgres-CREATE.sql</div><div class="line">#执行完毕后，退出</div><div class="line">\q</div></pre></td></tr></table></figure></p><h2 id="设置Ambari使用的PostgreSQL驱动包"><a href="#设置Ambari使用的PostgreSQL驱动包" class="headerlink" title="设置Ambari使用的PostgreSQL驱动包"></a>设置Ambari使用的PostgreSQL驱动包</h2><p><code>wget https://jdbc.postgresql.org/download/postgresql-42.2.2.jar -O /usr/ths/lib/postgresql-42.2.2.jar</code><br>root用户执行<br><code>ambari-server setup --jdbc-db=postgres --jdbc-driver=/usr/ths/lib/postgresql-42.2.2.jar</code></p><h1 id="安装Ambari"><a href="#安装Ambari" class="headerlink" title="安装Ambari"></a>安装Ambari</h1><p><code>yum -y install ambari-server</code></p><h2 id="配置Ambari"><a href="#配置Ambari" class="headerlink" title="配置Ambari"></a>配置Ambari</h2><p><code>ambari-server setup</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#Customize user account for ambari-server daemon [y/n] (n)?  y#自定义设置</div><div class="line">#Enter user account for ambari-server daemon (postgres): hadoop</div><div class="line">#Do you want to change Oracle JDK [y/n] (n)? y#是否修改Jdk</div><div class="line">#Enter choice (1): 3#输入3</div><div class="line">#Path to JAVA_HOME: /usr/ths/jdk1.8.0_112#设置jdk路径</div><div class="line">#Enter advanced database configuration [y/n] (n)? y#是否进入高级数据库设置</div><div class="line">#Enter choice (1): 4#数据库类型4（PostgreSQL）</div><div class="line">#Hostname (localhost): 192.168.6.164#数据库地址</div><div class="line">#Port (5432): 5432#数据库端口</div><div class="line">#Database name (ambari): ambari#数据库名</div><div class="line">#Postgres schema (ambari): ambari</div><div class="line">#Username (ambari): hdp#数据库用户名</div><div class="line">#Enter Database Password (bigdata): solution#数据库密码</div><div class="line">#Re-enter password:你的密码</div><div class="line">#Proceed with configuring remote database connection properties [y/n] (y)? y</div></pre></td></tr></table></figure></p><h2 id="启动ambari-server"><a href="#启动ambari-server" class="headerlink" title="启动ambari-server"></a>启动ambari-server</h2><p><code>ambari-server start</code><br>访问地址：<a href="http://192.168.6.164:8080" target="_blank" rel="external">http://192.168.6.164:8080</a> 默认用户名密码： admin/admin<br><img src="/images/2018/0615/01.png" alt="ambari"></p><h1 id="安装HDP集群"><a href="#安装HDP集群" class="headerlink" title="安装HDP集群"></a>安装HDP集群</h1><h2 id="点击图中的蓝色按钮“Launch-Install-Wizard”启动安装向导。"><a href="#点击图中的蓝色按钮“Launch-Install-Wizard”启动安装向导。" class="headerlink" title="点击图中的蓝色按钮“Launch Install Wizard”启动安装向导。"></a>点击图中的蓝色按钮“Launch Install Wizard”启动安装向导。</h2><p><img src="/images/2018/0615/02.png" alt="ambari"></p><h2 id="设置HDP集群名称"><a href="#设置HDP集群名称" class="headerlink" title="设置HDP集群名称"></a>设置HDP集群名称</h2><p><img src="/images/2018/0615/03.png" alt="ambari"></p><h2 id="选择要安装的HDP版本和本地仓库配置"><a href="#选择要安装的HDP版本和本地仓库配置" class="headerlink" title="选择要安装的HDP版本和本地仓库配置"></a>选择要安装的HDP版本和本地仓库配置</h2><p><img src="/images/2018/0615/04.png" alt="ambari"></p><h2 id="设置ssh私钥"><a href="#设置ssh私钥" class="headerlink" title="设置ssh私钥"></a>设置ssh私钥</h2><p>私钥内容为/home/hadoop/.ssh/id_rsa文件内容，可以下载该文件或者直接复制文件内容<br><img src="/images/2018/0615/05.png" alt="ambari"></p><h2 id="监测ssh免密通信"><a href="#监测ssh免密通信" class="headerlink" title="监测ssh免密通信"></a>监测ssh免密通信</h2><p><img src="/images/2018/0615/06.png" alt="ambari"></p><h2 id="选择要安装的服务"><a href="#选择要安装的服务" class="headerlink" title="选择要安装的服务"></a>选择要安装的服务</h2><p>这里根据自己的安装选择，安装完成后也可以在Services-Action中添加<br><img src="/images/2018/0615/07.png" alt="ambari"></p><h2 id="配置各个服务Master"><a href="#配置各个服务Master" class="headerlink" title="配置各个服务Master"></a>配置各个服务Master</h2><p>这里可以在下拉选项里选择调整一下默认的主机设置，保持资源均衡<br><img src="/images/2018/0615/08.png" alt="ambari"></p><h2 id="服务的Slaves-和-Clients节配置"><a href="#服务的Slaves-和-Clients节配置" class="headerlink" title="服务的Slaves 和 Clients节配置"></a>服务的Slaves 和 Clients节配置</h2><p><img src="/images/2018/0615/09.png" alt="ambari"></p><h2 id="服务器自定义配置"><a href="#服务器自定义配置" class="headerlink" title="服务器自定义配置"></a>服务器自定义配置</h2><p>这里一般出现的红色警告都是需要设置密码的地方，手动填一下即可！<br><img src="/images/2018/0615/10.png" alt="ambari"><br>这里填写之前设置过的postgres数据库hdp用户，填写完成后测试一下<br><img src="/images/2018/0615/11.png" alt="ambari"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">Admin Name : admin</div><div class="line"></div><div class="line">Cluster Name : ARLO</div><div class="line"></div><div class="line">Total Hosts : 4 (4 new)</div><div class="line"></div><div class="line">Repositories:</div><div class="line"></div><div class="line">redhat7 (HDP-2.6): </div><div class="line">http://192.168.6.164/hdp/HDP/centos7/2.6.4.0-91/</div><div class="line">redhat7 (HDP-2.6-GPL): </div><div class="line">http://192.168.6.164/hdp/HDP-GPL/centos7/2.6.4.0-91/</div><div class="line">redhat7 (HDP-UTILS-1.1.0.22): </div><div class="line">http://192.168.6.164/hdp/HDP-UTILS/centos7/1.1.0.22/</div><div class="line">Services:</div><div class="line"></div><div class="line">HDFS</div><div class="line">DataNode : 3 hosts</div><div class="line">NameNode : bigdata01.islocal.cc</div><div class="line">NFSGateway : 1 host</div><div class="line">SNameNode : bigdata02.islocal.cc</div><div class="line">YARN + MapReduce2</div><div class="line">App Timeline Server : bigdata04.islocal.cc</div><div class="line">NodeManager : 1 host</div><div class="line">ResourceManager : bigdata04.islocal.cc</div><div class="line">Tez</div><div class="line">Clients : 1 host</div><div class="line">Hive</div><div class="line">Metastore : bigdata02.islocal.cc</div><div class="line">HiveServer2 : bigdata02.islocal.cc</div><div class="line">WebHCat Server : bigdata02.islocal.cc</div><div class="line">Database : Existing PostgreSQL Database</div><div class="line">HBase</div><div class="line">Master : bigdata01.islocal.cc</div><div class="line">RegionServer : 1 host</div><div class="line">Phoenix Query Server : 0 host</div><div class="line">Pig</div><div class="line">Clients : 1 host</div><div class="line">ZooKeeper</div><div class="line">Server : 3 hosts</div><div class="line">Ambari Metrics</div><div class="line">Metrics Collector : bigdata03.islocal.cc</div><div class="line">Grafana : bigdata03.islocal.cc</div><div class="line">SmartSense</div><div class="line">Activity Analyzer : bigdata01.islocal.cc</div><div class="line">Activity Explorer : bigdata01.islocal.cc</div><div class="line">HST Server : bigdata01.islocal.cc</div><div class="line">Slider</div><div class="line">Clients : 1 host</div></pre></td></tr></table></figure></p><h2 id="开始安装"><a href="#开始安装" class="headerlink" title="开始安装"></a>开始安装</h2><p><img src="/images/2018/0615/12.png" alt="ambari"><br><img src="/images/2018/0615/13.png" alt="ambari"><br><img src="/images/2018/0615/14.png" alt="ambari"><br><img src="/images/2018/0615/15.png" alt="ambari"><br>出现警告，在安装过程完成后，可以进入到service里单独启动一下，看看日志报错详细解决。</p><h2 id="解决完所有告警，效果图如下"><a href="#解决完所有告警，效果图如下" class="headerlink" title="解决完所有告警，效果图如下"></a>解决完所有告警，效果图如下</h2><p><img src="/images/2018/0615/16.png" alt="ambari"></p><h1 id="NameNode-HA配置"><a href="#NameNode-HA配置" class="headerlink" title="NameNode HA配置"></a>NameNode HA配置</h1><h2 id="关闭HBase服务"><a href="#关闭HBase服务" class="headerlink" title="关闭HBase服务"></a>关闭HBase服务</h2><p><strong>这一步非常重要</strong><br><img src="/images/2018/0615/17.png" alt="ambari"></p><h2 id="点击Services-HDFS-Enable-NameNode-HA"><a href="#点击Services-HDFS-Enable-NameNode-HA" class="headerlink" title="点击Services-HDFS-Enable NameNode HA"></a>点击Services-HDFS-Enable NameNode HA</h2><p><img src="/images/2018/0615/18.png" alt="ambari"></p><h2 id="输入Nameservice-ID"><a href="#输入Nameservice-ID" class="headerlink" title="输入Nameservice ID"></a>输入Nameservice ID</h2><p><img src="/images/2018/0615/19.png" alt="ambari"></p><h2 id="选择要安装的主机"><a href="#选择要安装的主机" class="headerlink" title="选择要安装的主机"></a>选择要安装的主机</h2><p><img src="/images/2018/0615/20.png" alt="ambari"></p><h2 id="默认即可"><a href="#默认即可" class="headerlink" title="默认即可"></a>默认即可</h2><p><img src="/images/2018/0615/21.png" alt="ambari"></p><h2 id="根据提示登录到对应主机上执行提示命令"><a href="#根据提示登录到对应主机上执行提示命令" class="headerlink" title="根据提示登录到对应主机上执行提示命令"></a>根据提示登录到对应主机上执行提示命令</h2><p>如下图所示<br><img src="/images/2018/0615/23.png" alt="ambari"></p><h2 id="开始安装组件"><a href="#开始安装组件" class="headerlink" title="开始安装组件"></a>开始安装组件</h2><p><img src="/images/2018/0615/24.png" alt="ambari"><br><img src="/images/2018/0615/25.png" alt="ambari"><br><img src="/images/2018/0615/26.png" alt="ambari"></p><h2 id="初始化组件"><a href="#初始化组件" class="headerlink" title="初始化组件"></a>初始化组件</h2><p><img src="/images/2018/0615/27.png" alt="ambari"><br><img src="/images/2018/0615/28.png" alt="ambari"></p><h2 id="Namenode-HA启用完成，如图所示"><a href="#Namenode-HA启用完成，如图所示" class="headerlink" title="Namenode HA启用完成，如图所示"></a>Namenode HA启用完成，如图所示</h2><p><img src="/images/2018/0615/29.png" alt="ambari"></p><p>参考链接：<br><a href="http://www.cnblogs.com/zhijianliutang/articles/5195045.html" target="_blank" rel="external">http://www.cnblogs.com/zhijianliutang/articles/5195045.html</a><br><a href="https://blog.csdn.net/mawenwu1983/article/details/78983275" target="_blank" rel="external">https://blog.csdn.net/mawenwu1983/article/details/78983275</a><br><a href="http://wiki.ttxit.com/display/hortonworks/Hortonworks" target="_blank" rel="external">http://wiki.ttxit.com/display/hortonworks/Hortonworks</a><br><a href="https://www.ibm.com/developerworks/cn/opensource/os-cn-bigdata-ambari/index.html" target="_blank" rel="external">https://www.ibm.com/developerworks/cn/opensource/os-cn-bigdata-ambari/index.html</a><br><a href="http://blog.51cto.com/hsbxxl/1981411" target="_blank" rel="external">http://blog.51cto.com/hsbxxl/1981411</a></p>]]></content>
      
      
      <categories>
          
          <category> 大数据 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ambari </tag>
            
            <tag> HDP </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Shell版俄罗斯方块(转)</title>
      <link href="/arlo/8656017b/"/>
      <url>/arlo/8656017b/</url>
      
        <content type="html"><![CDATA[<p>在网上看到一篇shell版本的俄罗斯方块游戏，很有趣，转过来记录一下。<br>地址：<a href="http://www.ywnds.com/?p=12325" target="_blank" rel="external">http://www.ywnds.com/?p=12325</a><br><a id="more"></a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div><div class="line">456</div><div class="line">457</div><div class="line">458</div><div class="line">459</div><div class="line">460</div><div class="line">461</div><div class="line">462</div><div class="line">463</div><div class="line">464</div><div class="line">465</div><div class="line">466</div><div class="line">467</div><div class="line">468</div><div class="line">469</div><div class="line">470</div><div class="line">471</div><div class="line">472</div><div class="line">473</div><div class="line">474</div><div class="line">475</div><div class="line">476</div><div class="line">477</div><div class="line">478</div><div class="line">479</div><div class="line">480</div><div class="line">481</div><div class="line">482</div><div class="line">483</div><div class="line">484</div><div class="line">485</div><div class="line">486</div><div class="line">487</div><div class="line">488</div><div class="line">489</div><div class="line">490</div><div class="line">491</div><div class="line">492</div><div class="line">493</div><div class="line">494</div><div class="line">495</div><div class="line">496</div><div class="line">497</div><div class="line">498</div><div class="line">499</div><div class="line">500</div><div class="line">501</div><div class="line">502</div><div class="line">503</div><div class="line">504</div><div class="line">505</div><div class="line">506</div><div class="line">507</div><div class="line">508</div><div class="line">509</div><div class="line">510</div><div class="line">511</div><div class="line">512</div><div class="line">513</div><div class="line">514</div><div class="line">515</div><div class="line">516</div><div class="line">517</div><div class="line">518</div><div class="line">519</div><div class="line">520</div><div class="line">521</div><div class="line">522</div><div class="line">523</div><div class="line">524</div><div class="line">525</div><div class="line">526</div><div class="line">527</div><div class="line">528</div><div class="line">529</div><div class="line">530</div><div class="line">531</div><div class="line">532</div><div class="line">533</div><div class="line">534</div><div class="line">535</div><div class="line">536</div><div class="line">537</div><div class="line">538</div><div class="line">539</div><div class="line">540</div><div class="line">541</div><div class="line">542</div><div class="line">543</div><div class="line">544</div><div class="line">545</div><div class="line">546</div><div class="line">547</div><div class="line">548</div><div class="line">549</div><div class="line">550</div><div class="line">551</div><div class="line">552</div><div class="line">553</div><div class="line">554</div><div class="line">555</div><div class="line">556</div><div class="line">557</div><div class="line">558</div><div class="line">559</div><div class="line">560</div><div class="line">561</div><div class="line">562</div><div class="line">563</div><div class="line">564</div><div class="line">565</div><div class="line">566</div><div class="line">567</div><div class="line">568</div><div class="line">569</div><div class="line">570</div><div class="line">571</div><div class="line">572</div><div class="line">573</div><div class="line">574</div><div class="line">575</div><div class="line">576</div><div class="line">577</div><div class="line">578</div><div class="line">579</div><div class="line">580</div><div class="line">581</div><div class="line">582</div><div class="line">583</div><div class="line">584</div><div class="line">585</div><div class="line">586</div><div class="line">587</div><div class="line">588</div><div class="line">589</div><div class="line">590</div><div class="line">591</div><div class="line">592</div><div class="line">593</div><div class="line">594</div><div class="line">595</div><div class="line">596</div><div class="line">597</div><div class="line">598</div><div class="line">599</div><div class="line">600</div><div class="line">601</div><div class="line">602</div><div class="line">603</div><div class="line">604</div><div class="line">605</div><div class="line">606</div><div class="line">607</div><div class="line">608</div><div class="line">609</div><div class="line">610</div><div class="line">611</div><div class="line">612</div><div class="line">613</div><div class="line">614</div><div class="line">615</div><div class="line">616</div><div class="line">617</div><div class="line">618</div><div class="line">619</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line"> </div><div class="line"># Tetris Game</div><div class="line"># 10.21.2003 xhchen&lt;[email]xhchen@winbond.com.tw[/email]&gt;</div><div class="line"> </div><div class="line">#APP declaration</div><div class="line">APP_NAME=&quot;$&#123;0##*[\\/]&#125;&quot;</div><div class="line">APP_VERSION=&quot;1.0&quot;</div><div class="line"> </div><div class="line"> </div><div class="line">#颜色定义</div><div class="line">cRed=1</div><div class="line">cGreen=2</div><div class="line">cYellow=3</div><div class="line">cBlue=4</div><div class="line">cFuchsia=5</div><div class="line">cCyan=6</div><div class="line">cWhite=7</div><div class="line">colorTable=($cRed $cGreen $cYellow $cBlue $cFuchsia $cCyan $cWhite)</div><div class="line"> </div><div class="line">#位置和大小</div><div class="line">iLeft=3</div><div class="line">iTop=2</div><div class="line">((iTrayLeft = iLeft + 2))</div><div class="line">((iTrayTop = iTop + 1))</div><div class="line">((iTrayWidth = 10))</div><div class="line">((iTrayHeight = 15))</div><div class="line"> </div><div class="line">#颜色设置</div><div class="line">cBorder=$cGreen</div><div class="line">cScore=$cFuchsia</div><div class="line">cScoreValue=$cCyan</div><div class="line"> </div><div class="line">#控制信号</div><div class="line">#改游戏使用两个进程，一个用于接收输入，一个用于游戏流程和显示界面;</div><div class="line">#当前者接收到上下左右等按键时，通过向后者发送signal的方式通知后者。</div><div class="line">sigRotate=25</div><div class="line">sigLeft=26</div><div class="line">sigRight=27</div><div class="line">sigDown=28</div><div class="line">sigAllDown=29</div><div class="line">sigExit=30</div><div class="line"> </div><div class="line">#七中不同的方块的定义</div><div class="line">#通过旋转，每种方块的显示的样式可能有几种</div><div class="line">box0=(0 0 0 1 1 0 1 1)</div><div class="line">box1=(0 2 1 2 2 2 3 2 1 0 1 1 1 2 1 3)</div><div class="line">box2=(0 0 0 1 1 1 1 2 0 1 1 0 1 1 2 0)</div><div class="line">box3=(0 1 0 2 1 0 1 1 0 0 1 0 1 1 2 1)</div><div class="line">box4=(0 1 0 2 1 1 2 1 1 0 1 1 1 2 2 2 0 1 1 1 2 0 2 1 0 0 1 0 1 1 1 2)</div><div class="line">box5=(0 1 1 1 2 1 2 2 1 0 1 1 1 2 2 0 0 0 0 1 1 1 2 1 0 2 1 0 1 1 1 2)</div><div class="line">box6=(0 1 1 1 1 2 2 1 1 0 1 1 1 2 2 1 0 1 1 0 1 1 2 1 0 1 1 0 1 1 1 2)</div><div class="line">#所有其中方块的定义都放到box变量中</div><div class="line">box=($&#123;box0[@]&#125; $&#123;box1[@]&#125; $&#123;box2[@]&#125; $&#123;box3[@]&#125; $&#123;box4[@]&#125; $&#123;box5[@]&#125; $&#123;box6[@]&#125;)</div><div class="line">#各种方块旋转后可能的样式数目</div><div class="line">countBox=(1 2 2 2 4 4 4)</div><div class="line">#各种方块再box数组中的偏移</div><div class="line">offsetBox=(0 1 3 5 7 11 15)</div><div class="line"> </div><div class="line">#每提高一个速度级需要积累的分数</div><div class="line">iScoreEachLevel=50        #be greater than 7</div><div class="line"> </div><div class="line">#运行时数据</div><div class="line">sig=0                #接收到的signal</div><div class="line">iScore=0        #总分</div><div class="line">iLevel=0        #速度级</div><div class="line">boxNew=()        #新下落的方块的位置定义</div><div class="line">cBoxNew=0        #新下落的方块的颜色</div><div class="line">iBoxNewType=0        #新下落的方块的种类</div><div class="line">iBoxNewRotate=0        #新下落的方块的旋转角度</div><div class="line">boxCur=()        #当前方块的位置定义</div><div class="line">cBoxCur=0        #当前方块的颜色</div><div class="line">iBoxCurType=0        #当前方块的种类</div><div class="line">iBoxCurRotate=0        #当前方块的旋转角度</div><div class="line">boxCurX=-1        #当前方块的x坐标位置</div><div class="line">boxCurY=-1        #当前方块的y坐标位置</div><div class="line">iMap=()                #背景方块图表</div><div class="line"> </div><div class="line">#初始化所有背景方块为-1, 表示没有方块</div><div class="line">for ((i = 0; i &lt; iTrayHeight * iTrayWidth; i++)); do iMap[$i]=-1; done</div><div class="line"> </div><div class="line"> </div><div class="line">#接收输入的进程的主函数</div><div class="line">function RunAsKeyReceiver()</div><div class="line">&#123;</div><div class="line">        local pidDisplayer key aKey sig cESC sTTY</div><div class="line"> </div><div class="line">        pidDisplayer=$1</div><div class="line">        aKey=(0 0 0)</div><div class="line"> </div><div class="line">        cESC=`echo -ne &quot;\033&quot;`</div><div class="line">        cSpace=`echo -ne &quot;\040&quot;`</div><div class="line"> </div><div class="line">        #保存终端属性。在read -s读取终端键时，终端的属性会被暂时改变。</div><div class="line">        #如果在read -s时程序被不幸杀掉，可能会导致终端混乱，</div><div class="line">        #需要在程序退出时恢复终端属性。</div><div class="line">        sTTY=`stty -g`</div><div class="line"> </div><div class="line">        #捕捉退出信号</div><div class="line">        trap &quot;MyExit;&quot; INT TERM</div><div class="line">        trap &quot;MyExitNoSub;&quot; $sigExit</div><div class="line"> </div><div class="line">        #隐藏光标</div><div class="line">        echo -ne &quot;\033[?25l&quot;</div><div class="line"> </div><div class="line"> </div><div class="line">        while :</div><div class="line">        do</div><div class="line">                #读取输入。注-s不回显，-n读到一个字符立即返回</div><div class="line">                read -s -n 1 key</div><div class="line"> </div><div class="line">                aKey[0]=$&#123;aKey[1]&#125;</div><div class="line">                aKey[1]=$&#123;aKey[2]&#125;</div><div class="line">                aKey[2]=$key</div><div class="line">                sig=0</div><div class="line"> </div><div class="line">                #判断输入了何种键</div><div class="line">                if [[ $key == $cESC &amp;&amp; $&#123;aKey[1]&#125; == $cESC ]]</div><div class="line">                then</div><div class="line">                        #ESC键</div><div class="line">                        MyExit</div><div class="line">                elif [[ $&#123;aKey[0]&#125; == $cESC &amp;&amp; $&#123;aKey[1]&#125; == &quot;[&quot; ]]</div><div class="line">                then</div><div class="line">                        if [[ $key == &quot;A&quot; ]]; then sig=$sigRotate        #&lt;向上键&gt;</div><div class="line">                        elif [[ $key == &quot;B&quot; ]]; then sig=$sigDown        #&lt;向下键&gt;</div><div class="line">                        elif [[ $key == &quot;D&quot; ]]; then sig=$sigLeft        #&lt;向左键&gt;</div><div class="line">                        elif [[ $key == &quot;C&quot; ]]; then sig=$sigRight        #&lt;向右键&gt;</div><div class="line">                        fi</div><div class="line">                elif [[ $key == &quot;W&quot; || $key == &quot;w&quot; ]]; then sig=$sigRotate        #W, w</div><div class="line">                elif [[ $key == &quot;S&quot; || $key == &quot;s&quot; ]]; then sig=$sigDown        #S, s</div><div class="line">                elif [[ $key == &quot;A&quot; || $key == &quot;a&quot; ]]; then sig=$sigLeft        #A, a</div><div class="line">                elif [[ $key == &quot;D&quot; || $key == &quot;d&quot; ]]; then sig=$sigRight        #D, d</div><div class="line">                elif [[ &quot;[$key]&quot; == &quot;[]&quot; ]]; then sig=$sigAllDown        #空格键</div><div class="line">                elif [[ $key == &quot;Q&quot; || $key == &quot;q&quot; ]]                        #Q, q</div><div class="line">                then</div><div class="line">                        MyExit</div><div class="line">                fi</div><div class="line"> </div><div class="line">                if [[ $sig != 0 ]]</div><div class="line">                then</div><div class="line">                        #向另一进程发送消息</div><div class="line">                        kill -$sig $pidDisplayer</div><div class="line">                fi</div><div class="line">        done</div><div class="line">&#125;</div><div class="line"> </div><div class="line">#退出前的恢复</div><div class="line">function MyExitNoSub()</div><div class="line">&#123;</div><div class="line">        local y</div><div class="line"> </div><div class="line">        #恢复终端属性</div><div class="line">        stty $sTTY</div><div class="line">        ((y = iTop + iTrayHeight + 4))</div><div class="line"> </div><div class="line">        #显示光标</div><div class="line">        echo -e &quot;\033[?25h\033[$&#123;y&#125;;0H&quot;</div><div class="line">        exit</div><div class="line">&#125;</div><div class="line"> </div><div class="line"> </div><div class="line">function MyExit()</div><div class="line">&#123;</div><div class="line">        #通知显示进程需要退出</div><div class="line">        kill -$sigExit $pidDisplayer</div><div class="line"> </div><div class="line">        MyExitNoSub</div><div class="line">&#125;</div><div class="line"> </div><div class="line"> </div><div class="line">#处理显示和游戏流程的主函数</div><div class="line">function RunAsDisplayer()</div><div class="line">&#123;</div><div class="line">        local sigThis</div><div class="line">        InitDraw</div><div class="line"> </div><div class="line">        #挂载各种信号的处理函数</div><div class="line">        trap &quot;sig=$sigRotate;&quot; $sigRotate</div><div class="line">        trap &quot;sig=$sigLeft;&quot; $sigLeft</div><div class="line">        trap &quot;sig=$sigRight;&quot; $sigRight</div><div class="line">        trap &quot;sig=$sigDown;&quot; $sigDown</div><div class="line">        trap &quot;sig=$sigAllDown;&quot; $sigAllDown</div><div class="line">        trap &quot;ShowExit;&quot; $sigExit</div><div class="line"> </div><div class="line">        while :</div><div class="line">        do</div><div class="line">                #根据当前的速度级iLevel不同，设定相应的循环的次数</div><div class="line">                for ((i = 0; i &lt; 21 - iLevel; i++))</div><div class="line">                do</div><div class="line">                        sleep 0.02</div><div class="line">                        sigThis=$sig</div><div class="line">                        sig=0</div><div class="line"> </div><div class="line">                        #根据sig变量判断是否接受到相应的信号</div><div class="line">                        if ((sigThis == sigRotate)); then BoxRotate;        #旋转</div><div class="line">                        elif ((sigThis == sigLeft)); then BoxLeft;        #左移一列</div><div class="line">                        elif ((sigThis == sigRight)); then BoxRight;        #右移一列</div><div class="line">                        elif ((sigThis == sigDown)); then BoxDown;        #下落一行</div><div class="line">                        elif ((sigThis == sigAllDown)); then BoxAllDown;        #下落到底</div><div class="line">                        fi</div><div class="line">                done</div><div class="line">                #kill -$sigDown $$</div><div class="line">                BoxDown        #下落一行</div><div class="line">        done</div><div class="line">&#125;</div><div class="line"> </div><div class="line"> </div><div class="line">#BoxMove(y, x), 测试是否可以把移动中的方块移到(x, y)的位置, 返回0则可以, 1不可以</div><div class="line">function BoxMove()</div><div class="line">&#123;</div><div class="line">        local j i x y xTest yTest</div><div class="line">        yTest=$1</div><div class="line">        xTest=$2</div><div class="line">        for ((j = 0; j &lt; 8; j += 2))</div><div class="line">        do</div><div class="line">                ((i = j + 1))</div><div class="line">                ((y = $&#123;boxCur[$j]&#125; + yTest))</div><div class="line">                ((x = $&#123;boxCur[$i]&#125; + xTest))</div><div class="line">                if (( y &lt; 0 || y &gt;= iTrayHeight || x &lt; 0 || x &gt;= iTrayWidth))</div><div class="line">                then</div><div class="line">                        #撞到墙壁了</div><div class="line">                        return 1</div><div class="line">                fi</div><div class="line">                if (($&#123;iMap[y * iTrayWidth + x]&#125; != -1 ))</div><div class="line">                then</div><div class="line">                        #撞到其他已经存在的方块了</div><div class="line">                        return 1</div><div class="line">                fi</div><div class="line">        done</div><div class="line">        return 0;</div><div class="line">&#125;</div><div class="line"> </div><div class="line"> </div><div class="line">#将当前移动中的方块放到背景方块中去,</div><div class="line">#并计算新的分数和速度级。(即一次方块落到底部)</div><div class="line">function Box2Map()</div><div class="line">&#123;</div><div class="line">        local j i x y xp yp line</div><div class="line"> </div><div class="line">        #将当前移动中的方块放到背景方块中去</div><div class="line">        for ((j = 0; j &lt; 8; j += 2))</div><div class="line">        do</div><div class="line">                ((i = j + 1))</div><div class="line">                ((y = $&#123;boxCur[$j]&#125; + boxCurY))</div><div class="line">                ((x = $&#123;boxCur[$i]&#125; + boxCurX))</div><div class="line">                ((i = y * iTrayWidth + x))</div><div class="line">                iMap[$i]=$cBoxCur</div><div class="line">        done</div><div class="line"> </div><div class="line">        #消去可被消去的行</div><div class="line">        line=0</div><div class="line">        for ((j = 0; j &lt; iTrayWidth * iTrayHeight; j += iTrayWidth))</div><div class="line">        do</div><div class="line">                for ((i = j + iTrayWidth - 1; i &gt;= j; i--))</div><div class="line">                do</div><div class="line">                        if (($&#123;iMap[$i]&#125; == -1)); then break; fi</div><div class="line">                done</div><div class="line">                if ((i &gt;= j)); then continue; fi</div><div class="line"> </div><div class="line">                ((line++))</div><div class="line">                for ((i = j - 1; i &gt;= 0; i--))</div><div class="line">                do</div><div class="line">                        ((x = i + iTrayWidth))</div><div class="line">                        iMap[$x]=$&#123;iMap[$i]&#125;</div><div class="line">                done</div><div class="line">                for ((i = 0; i &lt; iTrayWidth; i++))</div><div class="line">                do</div><div class="line">                        iMap[$i]=-1</div><div class="line">                done</div><div class="line">        done</div><div class="line"> </div><div class="line">        if ((line == 0)); then return; fi</div><div class="line"> </div><div class="line">        #根据消去的行数line计算分数和速度级</div><div class="line">        ((x = iLeft + iTrayWidth * 2 + 7))</div><div class="line">        ((y = iTop + 11))</div><div class="line">        ((iScore += line * 2 - 1))</div><div class="line">        #显示新的分数</div><div class="line">        echo -ne &quot;\033[1m\033[3$&#123;cScoreValue&#125;m\033[$&#123;y&#125;;$&#123;x&#125;H$&#123;iScore&#125;         &quot;</div><div class="line">        if ((iScore % iScoreEachLevel &lt; line * 2 - 1))</div><div class="line">        then</div><div class="line">                if ((iLevel &lt; 20))</div><div class="line">                then</div><div class="line">                        ((iLevel++))</div><div class="line">                        ((y = iTop + 14))</div><div class="line">                        #显示新的速度级</div><div class="line">                        echo -ne &quot;\033[3$&#123;cScoreValue&#125;m\033[$&#123;y&#125;;$&#123;x&#125;H$&#123;iLevel&#125;        &quot;</div><div class="line">                fi</div><div class="line">        fi</div><div class="line">        echo -ne &quot;\033[0m&quot;</div><div class="line"> </div><div class="line"> </div><div class="line">        #重新显示背景方块</div><div class="line">        for ((y = 0; y &lt; iTrayHeight; y++))</div><div class="line">        do</div><div class="line">                ((yp = y + iTrayTop + 1))</div><div class="line">                ((xp = iTrayLeft + 1))</div><div class="line">                ((i = y * iTrayWidth))</div><div class="line">                echo -ne &quot;\033[$&#123;yp&#125;;$&#123;xp&#125;H&quot;</div><div class="line">                for ((x = 0; x &lt; iTrayWidth; x++))</div><div class="line">                do</div><div class="line">                        ((j = i + x))</div><div class="line">                        if (($&#123;iMap[$j]&#125; == -1))</div><div class="line">                        then</div><div class="line">                                echo -ne &quot;  &quot;</div><div class="line">                        else</div><div class="line">                                echo -ne &quot;\033[1m\033[7m\033[3$&#123;iMap[$j]&#125;m\033[4$&#123;iMap[$j]&#125;m[]\033[0m&quot;</div><div class="line">                        fi</div><div class="line">                done</div><div class="line">        done</div><div class="line">&#125;</div><div class="line"> </div><div class="line"> </div><div class="line">#下落一行</div><div class="line">function BoxDown()</div><div class="line">&#123;</div><div class="line">        local y s</div><div class="line">        ((y = boxCurY + 1))        #新的y坐标</div><div class="line">        if BoxMove $y $boxCurX        #测试是否可以下落一行</div><div class="line">        then</div><div class="line">                s=&quot;`DrawCurBox 0`&quot;        #将旧的方块抹去</div><div class="line">                ((boxCurY = y))</div><div class="line">                s=&quot;$s`DrawCurBox 1`&quot;        #显示新的下落后方块</div><div class="line">                echo -ne $s</div><div class="line">        else</div><div class="line">                #走到这儿, 如果不能下落了</div><div class="line">                Box2Map                #将当前移动中的方块贴到背景方块中</div><div class="line">                RandomBox        #产生新的方块</div><div class="line">        fi</div><div class="line">&#125;</div><div class="line"> </div><div class="line">#左移一列</div><div class="line">function BoxLeft()</div><div class="line">&#123;</div><div class="line">        local x s</div><div class="line">        ((x = boxCurX - 1))</div><div class="line">        if BoxMove $boxCurY $x</div><div class="line">        then</div><div class="line">                s=`DrawCurBox 0`</div><div class="line">                ((boxCurX = x))</div><div class="line">                s=$s`DrawCurBox 1`</div><div class="line">                echo -ne $s</div><div class="line">        fi</div><div class="line">&#125;</div><div class="line"> </div><div class="line">#右移一列</div><div class="line">function BoxRight()</div><div class="line">&#123;</div><div class="line">        local x s</div><div class="line">        ((x = boxCurX + 1))</div><div class="line">        if BoxMove $boxCurY $x</div><div class="line">        then</div><div class="line">                s=`DrawCurBox 0`</div><div class="line">                ((boxCurX = x))</div><div class="line">                s=$s`DrawCurBox 1`</div><div class="line">                echo -ne $s</div><div class="line">        fi</div><div class="line">&#125;</div><div class="line"> </div><div class="line"> </div><div class="line">#下落到底</div><div class="line">function BoxAllDown()</div><div class="line">&#123;</div><div class="line">        local k j i x y iDown s</div><div class="line">        iDown=$iTrayHeight</div><div class="line"> </div><div class="line">        #计算一共需要下落多少行</div><div class="line">        for ((j = 0; j &lt; 8; j += 2))</div><div class="line">        do</div><div class="line">                ((i = j + 1))</div><div class="line">                ((y = $&#123;boxCur[$j]&#125; + boxCurY))</div><div class="line">                ((x = $&#123;boxCur[$i]&#125; + boxCurX))</div><div class="line">                for ((k = y + 1; k &lt; iTrayHeight; k++))</div><div class="line">                do</div><div class="line">                        ((i = k * iTrayWidth + x))</div><div class="line">                        if (( $&#123;iMap[$i]&#125; != -1)); then break; fi</div><div class="line">                done</div><div class="line">                ((k -= y + 1))</div><div class="line">                if (( $iDown &gt; $k )); then iDown=$k; fi</div><div class="line">        done</div><div class="line"> </div><div class="line">        s=`DrawCurBox 0`        #将旧的方块抹去</div><div class="line">        ((boxCurY += iDown))</div><div class="line">        s=$s`DrawCurBox 1`        #显示新的下落后的方块</div><div class="line">        echo -ne $s</div><div class="line">        Box2Map                #将当前移动中的方块贴到背景方块中</div><div class="line">        RandomBox        #产生新的方块</div><div class="line">&#125;</div><div class="line"> </div><div class="line"> </div><div class="line">#旋转方块</div><div class="line">function BoxRotate()</div><div class="line">&#123;</div><div class="line">        local iCount iTestRotate boxTest j i s</div><div class="line">        iCount=$&#123;countBox[$iBoxCurType]&#125;        #当前的方块经旋转可以产生的样式的数目</div><div class="line"> </div><div class="line">        #计算旋转后的新的样式</div><div class="line">        ((iTestRotate = iBoxCurRotate + 1))</div><div class="line">        if ((iTestRotate &gt;= iCount))</div><div class="line">        then</div><div class="line">                ((iTestRotate = 0))</div><div class="line">        fi</div><div class="line"> </div><div class="line">        #更新到新的样式, 保存老的样式(但不显示)</div><div class="line">        for ((j = 0, i = ($&#123;offsetBox[$iBoxCurType]&#125; + $iTestRotate) * 8; j &lt; 8; j++, i++))</div><div class="line">        do</div><div class="line">                boxTest[$j]=$&#123;boxCur[$j]&#125;</div><div class="line">                boxCur[$j]=$&#123;box[$i]&#125;</div><div class="line">        done</div><div class="line"> </div><div class="line">        if BoxMove $boxCurY $boxCurX        #测试旋转后是否有空间放的下</div><div class="line">        then</div><div class="line">                #抹去旧的方块</div><div class="line">                for ((j = 0; j &lt; 8; j++))</div><div class="line">                do</div><div class="line">                        boxCur[$j]=$&#123;boxTest[$j]&#125;</div><div class="line">                done</div><div class="line">                s=`DrawCurBox 0`</div><div class="line"> </div><div class="line">                #画上新的方块</div><div class="line">                for ((j = 0, i = ($&#123;offsetBox[$iBoxCurType]&#125; + $iTestRotate) * 8; j &lt; 8; j++, i++))</div><div class="line">                do</div><div class="line">                        boxCur[$j]=$&#123;box[$i]&#125;</div><div class="line">                done</div><div class="line">                s=$s`DrawCurBox 1`</div><div class="line">                echo -ne $s</div><div class="line">                iBoxCurRotate=$iTestRotate</div><div class="line">        else</div><div class="line">                #不能旋转，还是继续使用老的样式</div><div class="line">                for ((j = 0; j &lt; 8; j++))</div><div class="line">                do</div><div class="line">                        boxCur[$j]=$&#123;boxTest[$j]&#125;</div><div class="line">                done</div><div class="line">        fi</div><div class="line">&#125;</div><div class="line"> </div><div class="line"> </div><div class="line">#DrawCurBox(bDraw), 绘制当前移动中的方块, bDraw为1, 画上, bDraw为0, 抹去方块。</div><div class="line">function DrawCurBox()</div><div class="line">&#123;</div><div class="line">        local i j t bDraw sBox s</div><div class="line">        bDraw=$1</div><div class="line"> </div><div class="line">        s=&quot;&quot;</div><div class="line">        if (( bDraw == 0 ))</div><div class="line">        then</div><div class="line">                sBox=&quot;\040\040&quot;</div><div class="line">        else</div><div class="line">                sBox=&quot;[]&quot;</div><div class="line">                s=$s&quot;\033[1m\033[7m\033[3$&#123;cBoxCur&#125;m\033[4$&#123;cBoxCur&#125;m&quot;</div><div class="line">        fi</div><div class="line"> </div><div class="line">        for ((j = 0; j &lt; 8; j += 2))</div><div class="line">        do</div><div class="line">                ((i = iTrayTop + 1 + $&#123;boxCur[$j]&#125; + boxCurY))</div><div class="line">                ((t = iTrayLeft + 1 + 2 * (boxCurX + $&#123;boxCur[$j + 1]&#125;)))</div><div class="line">                #\033[y;xH, 光标到(x, y)处</div><div class="line">                s=$s&quot;\033[$&#123;i&#125;;$&#123;t&#125;H$&#123;sBox&#125;&quot;</div><div class="line">        done</div><div class="line">        s=$s&quot;\033[0m&quot;</div><div class="line">        echo -n $s</div><div class="line">&#125;</div><div class="line"> </div><div class="line"> </div><div class="line">#更新新的方块</div><div class="line">function RandomBox()</div><div class="line">&#123;</div><div class="line">        local i j t</div><div class="line"> </div><div class="line">        #更新当前移动的方块</div><div class="line">        iBoxCurType=$&#123;iBoxNewType&#125;</div><div class="line">        iBoxCurRotate=$&#123;iBoxNewRotate&#125;</div><div class="line">        cBoxCur=$&#123;cBoxNew&#125;</div><div class="line">        for ((j = 0; j &lt; $&#123;#boxNew[@]&#125;; j++))</div><div class="line">        do</div><div class="line">                boxCur[$j]=$&#123;boxNew[$j]&#125;</div><div class="line">        done</div><div class="line"> </div><div class="line"> </div><div class="line">        #显示当前移动的方块</div><div class="line">        if (( $&#123;#boxCur[@]&#125; == 8 ))</div><div class="line">        then</div><div class="line">                #计算当前方块该从顶端哪一行&quot;冒&quot;出来</div><div class="line">                for ((j = 0, t = 4; j &lt; 8; j += 2))</div><div class="line">                do</div><div class="line">                        if (($&#123;boxCur[$j]&#125; &lt; t)); then t=$&#123;boxCur[$j]&#125;; fi</div><div class="line">                done</div><div class="line">                ((boxCurY = -t))</div><div class="line">                for ((j = 1, i = -4, t = 20; j &lt; 8; j += 2))</div><div class="line">                do</div><div class="line">                        if (($&#123;boxCur[$j]&#125; &gt; i)); then i=$&#123;boxCur[$j]&#125;; fi</div><div class="line">                        if (($&#123;boxCur[$j]&#125; &lt; t)); then t=$&#123;boxCur[$j]&#125;; fi</div><div class="line">                done</div><div class="line">                ((boxCurX = (iTrayWidth - 1 - i - t) / 2))</div><div class="line"> </div><div class="line">                #显示当前移动的方块</div><div class="line">                echo -ne `DrawCurBox 1`</div><div class="line"> </div><div class="line">                #如果方块一出来就没处放，Game over!</div><div class="line">                if ! BoxMove $boxCurY $boxCurX</div><div class="line">                then</div><div class="line">                        kill -$sigExit $&#123;PPID&#125;</div><div class="line">                        ShowExit</div><div class="line">                fi</div><div class="line">        fi</div><div class="line"> </div><div class="line"> </div><div class="line"> </div><div class="line">        #清除右边预显示的方块</div><div class="line">        for ((j = 0; j &lt; 4; j++))</div><div class="line">        do</div><div class="line">                ((i = iTop + 1 + j))</div><div class="line">                ((t = iLeft + 2 * iTrayWidth + 7))</div><div class="line">                echo -ne &quot;\033[$&#123;i&#125;;$&#123;t&#125;H        &quot;</div><div class="line">        done</div><div class="line"> </div><div class="line">        #随机产生新的方块</div><div class="line">        ((iBoxNewType = RANDOM % $&#123;#offsetBox[@]&#125;))</div><div class="line">        ((iBoxNewRotate = RANDOM % $&#123;countBox[$iBoxNewType]&#125;))</div><div class="line">        for ((j = 0, i = ($&#123;offsetBox[$iBoxNewType]&#125; + $iBoxNewRotate) * 8; j &lt; 8; j++, i++))</div><div class="line">        do</div><div class="line">                boxNew[$j]=$&#123;box[$i]&#125;;</div><div class="line">        done</div><div class="line"> </div><div class="line">        ((cBoxNew = $&#123;colorTable[RANDOM % $&#123;#colorTable[@]&#125;]&#125;))</div><div class="line"> </div><div class="line">        #显示右边预显示的方块</div><div class="line">        echo -ne &quot;\033[1m\033[7m\033[3$&#123;cBoxNew&#125;m\033[4$&#123;cBoxNew&#125;m&quot;</div><div class="line">        for ((j = 0; j &lt; 8; j += 2))</div><div class="line">        do</div><div class="line">                ((i = iTop + 1 + $&#123;boxNew[$j]&#125;))</div><div class="line">                ((t = iLeft + 2 * iTrayWidth + 7 + 2 * $&#123;boxNew[$j + 1]&#125;))</div><div class="line">                echo -ne &quot;\033[$&#123;i&#125;;$&#123;t&#125;H[]&quot;</div><div class="line">        done</div><div class="line">        echo -ne &quot;\033[0m&quot;</div><div class="line">&#125;</div><div class="line"> </div><div class="line"> </div><div class="line">#初始绘制</div><div class="line">function InitDraw()</div><div class="line">&#123;</div><div class="line">        clear</div><div class="line">        RandomBox        #随机产生方块，这时右边预显示窗口中有方快了</div><div class="line">        RandomBox        #再随机产生方块，右边预显示窗口中的方块被更新，原先的方块将开始下落</div><div class="line">        local i t1 t2 t3</div><div class="line"> </div><div class="line">        #显示边框</div><div class="line">        echo -ne &quot;\033[1m&quot;</div><div class="line">        echo -ne &quot;\033[3$&#123;cBorder&#125;m\033[4$&#123;cBorder&#125;m&quot;</div><div class="line"> </div><div class="line">        ((t2 = iLeft + 1))</div><div class="line">        ((t3 = iLeft + iTrayWidth * 2 + 3))</div><div class="line">        for ((i = 0; i &lt; iTrayHeight; i++))</div><div class="line">        do</div><div class="line">                ((t1 = i + iTop + 2))</div><div class="line">                echo -ne &quot;\033[$&#123;t1&#125;;$&#123;t2&#125;H||&quot;</div><div class="line">                echo -ne &quot;\033[$&#123;t1&#125;;$&#123;t3&#125;H||&quot;</div><div class="line">        done</div><div class="line"> </div><div class="line">        ((t2 = iTop + iTrayHeight + 2))</div><div class="line">        for ((i = 0; i &lt; iTrayWidth + 2; i++))</div><div class="line">        do</div><div class="line">                ((t1 = i * 2 + iLeft + 1))</div><div class="line">                echo -ne &quot;\033[$&#123;iTrayTop&#125;;$&#123;t1&#125;H==&quot;</div><div class="line">                echo -ne &quot;\033[$&#123;t2&#125;;$&#123;t1&#125;H==&quot;</div><div class="line">        done</div><div class="line">        echo -ne &quot;\033[0m&quot;</div><div class="line"> </div><div class="line"> </div><div class="line">        #显示&quot;Score&quot;和&quot;Level&quot;字样</div><div class="line">        echo -ne &quot;\033[1m&quot;</div><div class="line">        ((t1 = iLeft + iTrayWidth * 2 + 7))</div><div class="line">        ((t2 = iTop + 10))</div><div class="line">        echo -ne &quot;\033[3$&#123;cScore&#125;m\033[$&#123;t2&#125;;$&#123;t1&#125;HScore&quot;</div><div class="line">        ((t2 = iTop + 11))</div><div class="line">        echo -ne &quot;\033[3$&#123;cScoreValue&#125;m\033[$&#123;t2&#125;;$&#123;t1&#125;H$&#123;iScore&#125;&quot;</div><div class="line">        ((t2 = iTop + 13))</div><div class="line">        echo -ne &quot;\033[3$&#123;cScore&#125;m\033[$&#123;t2&#125;;$&#123;t1&#125;HLevel&quot;</div><div class="line">        ((t2 = iTop + 14))</div><div class="line">        echo -ne &quot;\033[3$&#123;cScoreValue&#125;m\033[$&#123;t2&#125;;$&#123;t1&#125;H$&#123;iLevel&#125;&quot;</div><div class="line">        echo -ne &quot;\033[0m&quot;</div><div class="line">&#125;</div><div class="line"> </div><div class="line"> </div><div class="line">#退出时显示GameOVer!</div><div class="line">function ShowExit()</div><div class="line">&#123;</div><div class="line">        local y</div><div class="line">        ((y = iTrayHeight + iTrayTop + 3))</div><div class="line">        echo -e &quot;\033[$&#123;y&#125;;0HGameOver!\033[0m&quot;</div><div class="line">        exit</div><div class="line">&#125;</div><div class="line"> </div><div class="line"> </div><div class="line">#显示用法.</div><div class="line">function Usage</div><div class="line">&#123;</div><div class="line">        cat &lt;&lt; EOF</div><div class="line">Usage: $APP_NAME</div><div class="line">Start tetris game.</div><div class="line"> </div><div class="line">  -h, --help              display this help and exit</div><div class="line">      --version           output version information and exit</div><div class="line">EOF</div><div class="line">&#125;</div><div class="line"> </div><div class="line"> </div><div class="line">#游戏主程序在这儿开始.</div><div class="line">if [[ &quot;$1&quot; == &quot;-h&quot; || &quot;$1&quot; == &quot;--help&quot; ]]; then</div><div class="line">        Usage</div><div class="line">elif [[ &quot;$1&quot; == &quot;--version&quot; ]]; then</div><div class="line">        echo &quot;$APP_NAME $APP_VERSION&quot;</div><div class="line">elif [[ &quot;$1&quot; == &quot;--show&quot; ]]; then</div><div class="line">        #当发现具有参数--show时，运行显示函数</div><div class="line">        RunAsDisplayer</div><div class="line">else</div><div class="line">        bash $0 --show&amp;        #以参数--show将本程序再运行一遍</div><div class="line">        RunAsKeyReceiver $!        #以上一行产生的进程的进程号作为参数</div><div class="line">fi</div></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> Interesting </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>SSH隧道实现Yum等代理</title>
      <link href="/arlo/f49b27ae/"/>
      <url>/arlo/f49b27ae/</url>
      
        <content type="html"><![CDATA[<p><strong>背景</strong><br>Linux服务器环境中有部分服务器不能上网，使用yum安装软件极为不便；<br><strong>解决方案</strong><br>可以搭建一个本地代理服务器，在不能联通外网的服务器上将1080端口跳转到另外一台可以上外网的22端口上，实现ssh跳转，设置yum代理，实现软件安装<br><strong>注意事项</strong></p><ul><li>需要一台可以连接公网的服务器A（192.168.6.123）</li><li>需要安装软件的服务器B（192.168.6.141）可以连接上A（192.168.6.123）</li><li>服务器B（192.168.6.141）上需要安装privoxy 和git 基础软件</li><li>所有操作在服务器B（192.168.6.141）上完成</li><li>在centos 6 上，yum只能使用 http, https, ftp 协议的代理。 但在 centos 7上 yum 可以使用 socks5 的代理。</li></ul><a id="more"></a><h1 id="建立SSH隧道"><a href="#建立SSH隧道" class="headerlink" title="建立SSH隧道"></a>建立SSH隧道</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ssh -p 22 -gfND 1080 root@192.168.6.123</div><div class="line">ss -tlnup |grep 1080</div></pre></td></tr></table></figure><h1 id="安装配置privoxy"><a href="#安装配置privoxy" class="headerlink" title="安装配置privoxy"></a>安装配置privoxy</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">yum -y install privoxy</div><div class="line">vim /etc/privoxy/config</div><div class="line">forward-socks5 / 127.0.0.1:1080 .</div><div class="line">#如果允许其他机器访问，需要修改listen-address</div><div class="line">listen-address  0.0.0.0:8118</div></pre></td></tr></table></figure><p>启动privoxy服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">systemctl start privoxy</div><div class="line">systemctl enable privoxy</div></pre></td></tr></table></figure></p><h1 id="为YUM配置代理"><a href="#为YUM配置代理" class="headerlink" title="为YUM配置代理"></a>为YUM配置代理</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#centos7配置方法</div><div class="line">[main]</div><div class="line">proxy=socks5h://localhost:1080</div><div class="line">#centos6配置方法</div><div class="line">[main]</div><div class="line">proxy=http://localhost:8118</div></pre></td></tr></table></figure><h1 id="扩展、配置其他代理"><a href="#扩展、配置其他代理" class="headerlink" title="扩展、配置其他代理"></a>扩展、配置其他代理</h1><h2 id="为CURL配置代理"><a href="#为CURL配置代理" class="headerlink" title="为CURL配置代理"></a>为CURL配置代理</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">vim ~/.curlc</div><div class="line"># socks5h 中的 h 意为远程主机名解析</div><div class="line">socks5 = &quot;socks5h://127.0.0.1:1080&quot;</div></pre></td></tr></table></figure><h2 id="为wget配置代理"><a href="#为wget配置代理" class="headerlink" title="为wget配置代理"></a>为wget配置代理</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">vim /etc/wgetrc</div><div class="line">http_proxy = http://localhost:8118</div><div class="line">https_proxy = http://localhost:8118</div><div class="line">ftp_proxy = http://localhost:8118</div><div class="line">use_proxy = on</div><div class="line">wait = 15</div></pre></td></tr></table></figure><h2 id="为pip配置代理"><a href="#为pip配置代理" class="headerlink" title="为pip配置代理"></a>为pip配置代理</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mkdir ~/.pip</div><div class="line">vim ~/.pip/pip.conf</div><div class="line">[global]</div><div class="line">proxy = 127.0.0.1:8118</div><div class="line">trusted-host = mirrors.aliyun.com</div></pre></td></tr></table></figure><h2 id="为git设置http-https-代理"><a href="#为git设置http-https-代理" class="headerlink" title="为git设置http https 代理"></a>为git设置http https 代理</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">#设置</div><div class="line">git config --global https.proxy &apos;socks5h://127.0.0.1:1080&apos;</div><div class="line">git config --global http.proxy &apos;socks5h://127.0.0.1:1080&apos;</div><div class="line">#查看</div><div class="line">git config --global --get http.proxy</div><div class="line">git config --global --get https.proxy</div><div class="line">#取消</div><div class="line">git config --global --unset http.proxy</div><div class="line">git config --global --unset https.proxy</div></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 常识 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> SSH </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>expdp/impdp数据泵工具运用</title>
      <link href="/arlo/2148c304/"/>
      <url>/arlo/2148c304/</url>
      
        <content type="html"><![CDATA[<p>Oracle数据库常用的备份方式有，exp/imp, expdp/impdp和rman；<br>RMAN备份内容包括:整个数据库,表空间,数据文件,指定的数据文件,控制文件,归档日志文件,参数文件等，打开归档日志后，可以做到不丢失数据，后期再详细分析研究。<br><a id="more"></a><br>使用expdp和impdp时应该注重的事项：<br>1、exp和imp是客户端工具程序，它们既可以在客户端使用，也可以在服务端使用。<br>2、expdp和impdp是服务端的工具程序，他们只能在oracle服务端使用，不能在客户端使用。<br>3、imp只适用于exp导出的文件，不适用于expdp导出文件；impdp只适用于expdp导出的文件，而不适用于exp导出文件。<br>4、对于10g以上的服务器，使用exp通常不能导出0行数据的空表，而此时必须使用expdp导出。</p><h1 id="查询备份和恢复数据库的数据库信息"><a href="#查询备份和恢复数据库的数据库信息" class="headerlink" title="查询备份和恢复数据库的数据库信息"></a>查询备份和恢复数据库的数据库信息</h1><p>尽量保证数据库的版本和字符集等信息一致，否则会有很多坑。</p><h2 id="查看数据库的版本"><a href="#查看数据库的版本" class="headerlink" title="查看数据库的版本"></a>查看数据库的版本</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select * from v$version;</div></pre></td></tr></table></figure><h2 id="查看数据库编码"><a href="#查看数据库编码" class="headerlink" title="查看数据库编码"></a>查看数据库编码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SELECT * FROM V$NLS_PARAMETERS WHERE PARAMETER IN (&apos;NLS_CHARACTERSET&apos;, &apos;NLS_NCHAR_CHARACTERSET&apos;);</div></pre></td></tr></table></figure><h1 id="查看管理员目录"><a href="#查看管理员目录" class="headerlink" title="查看管理员目录"></a>查看管理员目录</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sqlplus / as sysdba</div><div class="line">SQL&gt; select * from dba_directories;</div></pre></td></tr></table></figure><h1 id="创建管理员目录并授权"><a href="#创建管理员目录并授权" class="headerlink" title="创建管理员目录并授权"></a>创建管理员目录并授权</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">SQL&gt; create directory dump_dir as &apos;/opt/db_backup&apos;;  #可以使用默认的目录，也可以自己新建目录</div><div class="line">SQL&gt; grant read,write on directory dump_dir to scott;</div></pre></td></tr></table></figure><h1 id="使用expdp导出数据"><a href="#使用expdp导出数据" class="headerlink" title="使用expdp导出数据"></a>使用expdp导出数据</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">1)导出用户</div><div class="line">expdp scott/tiger@orcl schemas=scott dumpfile=expdp.dmp directory=dump_dir</div><div class="line">expdp userid=&quot;&apos;sys/passwd@orcl as sysdba&apos;&quot;  schemas=scott dumpfile=scott.dmp directory=DATA_PUMP_DIR   #使用sys用户导出写法</div><div class="line">2)导出表</div><div class="line">expdp scott/tiger@orcl tables=emp,dept dumpfile=expdp.dmp directory=dump_dir</div><div class="line">3)按查询条件导</div><div class="line">expdp scott/tiger@orcl directory=dump_dir dumpfile=expdp.dmp tables=emp query=&apos;where deptno=20&apos;</div><div class="line">4)按表空间导</div><div class="line">expdp system/manager@orcl directory=dump_dir dumpfile=tablespace.dmp tablespaces=temp,example</div><div class="line">5)导整个数据库</div><div class="line">expdp system/manager@orcl directory=dump_dir dumpfile=full.dmp full=y;</div><div class="line">expdp userid=&quot;&apos;sys/passwd@orcl as sysdba&apos;&quot; full=y directory=DATA_PUMP_DIR dumpfile=full.dmp#使用sys用户导出写法</div></pre></td></tr></table></figure><h1 id="用impdp导入数据"><a href="#用impdp导入数据" class="headerlink" title="用impdp导入数据"></a>用impdp导入数据</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">1)导入用户（从用户scott导入到用户scott）</div><div class="line">impdp scott/tiger@orcl directory=dump_dir dumpfile=expdp.dmp schemas=scott</div><div class="line">impdp userid=&quot;&apos;sys/passwd@orcl as sysdba&apos;&quot; schemas=scott dumpfile=scott.dmp directory=DATA_PUMP_DIR#使用sys用户导出写法</div><div class="line">2)导入表（从scott用户中把表dept和emp导入到system用户中）</div><div class="line">impdp system/manager@orcl directory=dump_dir dumpfile=expdp.dmp tables=scott.dept,scott.emp remap_schema=scott:system</div><div class="line">3)导入表空间</div><div class="line">impdp system/manager@orcl directory=dump_dir dumpfile=tablespace.dmp tablespaces=example</div><div class="line">4)导入数据</div><div class="line">impdb system/manager@orcl directory=dump_dir dumpfile=full.dmp full=y</div><div class="line">impdp userid=&quot;&apos;sys/passwd@orcl as sysdba&apos;&quot; full=y directory=DATA_PUMP_DIR dumpfile=full.dmp</div><div class="line">5)追加数据</div><div class="line">impdp system/manager@orcl directory=dump_dir dumpfile=expdp.dmp schemas=system table_exists_action</div><div class="line"></div><div class="line">--#####--</div><div class="line">--如果要导到的用户与导出dumpfile的用户名不一样则要使用remap_schema代替schemas，将旧用户名指向新用户名：</div><div class="line">impdp user_new/pass_new directory=impexp dumpfile=lsdb.dmp loggfile=lsdb.log remap_schema=user_old:user_new</div><div class="line"></div><div class="line">--如果要导到的表空间名称不一样，则要使用remap_tablespace将旧表空间名指向新表空间名：</div><div class="line">impdp ls/lsdb123# directory=impexp dumpfile=lsdb.dmp loggfile=lsdb.log schemas=ls remap_tablespace=tablespace_old:tablespace_new</div><div class="line"></div><div class="line">--如果要导到的用户名和表空间名与原来导出时的都不一样，那么要同时使用remap_schema和remap_tablespace：</div><div class="line">impdp user_new/pass_new directory=impexp dumpfile=lsdb.dmp logfile=lsdb.log remap_schema=user_old:user_new  remap_tablespace=tablespace_old:tablespace_new</div><div class="line"></div><div class="line">--如果导出的dmp文件中有多个表空间，那么remap_tablespace写多个：</div><div class="line">impdp ls/lsdb123# directory=impexp dumpfile=lsdb.dmp loggfile=lsdb.log schemas=ls remap_tablespace=&apos;(tablespace_old1:tablespace_new1,tablespace_old2:tablespace_new2)&apos;</div><div class="line"></div><div class="line">--如果原先已有数据，想使用覆盖导入使用table_exists_action=replace：</div><div class="line">impdp ls/lsdb123# directory=impexp dumpfile= lsdb.dmp logfile= lsdb.log  schemas= ls table_exists_action=replace</div><div class="line"></div><div class="line">--如果expdp限制了单个文件大小使用%U导出多个文件（比如6个），则导入：</div><div class="line">impdp lsdb/lsdb123# directory=impexp dumpfile=lsdb_%U.dmp logfile= lsdb.log  schemas= lsdb  parallel=6</div></pre></td></tr></table></figure><h1 id="expdp的compression参数选项（压缩）"><a href="#expdp的compression参数选项（压缩）" class="headerlink" title="expdp的compression参数选项（压缩）"></a>expdp的compression参数选项（压缩）</h1><p><strong><em> COMPRESSION=[ALL | DATA_ONLY | METADATA_ONLY | NONE] </em></strong><br>Oracle 11g中新增了几种压缩方法。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ALL: 对导出的元数据和表数据都进行压缩，得到的导出文件是最小的，耗时也是最长的。（据说压缩比可以达到 1/7）</div><div class="line">DATA_ONLY: 仅对表数据进行压缩，对于大数据量的导出效果明显，会比METADATA_ONLY方式得到更小的压缩文件。</div><div class="line">METADATA_ONLY: 仅对元数据进行压缩，而不会对表数据进行压缩，这种压缩执行后效果一般不是很明显，不过速度比较快。</div><div class="line">NONE: 不进行任何的压缩，导出后的文件也是最大的。</div><div class="line">DEFAULT: 默认方式，即不指定COMPRESSION参数，会采用默认的压缩方式METADATA_ONLY。</div></pre></td></tr></table></figure></p><h1 id="impdp的TABLE-EXISTS-ACTION参数选项"><a href="#impdp的TABLE-EXISTS-ACTION参数选项" class="headerlink" title="impdp的TABLE_EXISTS_ACTION参数选项"></a>impdp的TABLE_EXISTS_ACTION参数选项</h1><p>默认值是skip，但若设置了CONTENT=DATA_ONLY，则默认值是APPEND，不是SKIP。<br><strong><em> TABLE_EXISTS_ACTION=[SKIP | APPEND | TRUNCATE | REPLACE] </em></strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">SKIP：跳过这张表，继续下一个对象。如果CONTENT设置了DATA_ONLY参数，则不能使用SKIP。</div><div class="line">APPEND：会加载数据至对象，但不会影响已存在的行。</div><div class="line">TRUNCATE：删除已存在的行，然后加载所有的数据。</div><div class="line">REPLACE：drop已存在的表，然后create并加载数据。如果CONTENT设置了DATA_ONLY，则不能使用REPLACE。</div></pre></td></tr></table></figure></p><h1 id="导入过程中，常用查询语句"><a href="#导入过程中，常用查询语句" class="headerlink" title="导入过程中，常用查询语句"></a>导入过程中，常用查询语句</h1><h2 id="查询表空间使用量，如果不够，可以添加文件"><a href="#查询表空间使用量，如果不够，可以添加文件" class="headerlink" title="查询表空间使用量，如果不够，可以添加文件"></a>查询表空间使用量，如果不够，可以添加文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">SELECT FILE_NAME, TABLESPACE_NAME, BYTES / 1024 / 1024 &quot;bytes MB&quot;,MAXBYTES / 1024 / 1024 &quot;maxbytes MB&quot;  FROM DBA_DATA_FILES WHERE TABLESPACE_NAME = &apos;USERS&apos;;</div><div class="line">ALTER TABLESPACE USERS ADD DATAFILE &apos;/u01/app/oracle/oradata/sjzdb/users02.dbf&apos; SIZE 5M AUTOEXTEND ON MAXSIZE 32767M;</div></pre></td></tr></table></figure><h2 id="查看SCHEMAS占用的表空间大小"><a href="#查看SCHEMAS占用的表空间大小" class="headerlink" title="查看SCHEMAS占用的表空间大小"></a>查看SCHEMAS占用的表空间大小</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SELECT OWNER, SUM(BYTES) / 1024 / 1024 / 1024 SCHEMA_SIZE_GIG  FROM SYS.DBA_SEGMENTS GROUP BY OWNER;</div></pre></td></tr></table></figure><h2 id="查询schemas下的所有表"><a href="#查询schemas下的所有表" class="headerlink" title="查询schemas下的所有表"></a>查询schemas下的所有表</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SELECT TABLE_NAME FROM SYS.DBA_TABLES WHERE OWNER = &apos;AIR_FORECAST&apos;;</div></pre></td></tr></table></figure><p>参考链接：<br><a href="http://blog.sina.com.cn/s/blog_67d41beb0100ixnb.html" target="_blank" rel="external">http://blog.sina.com.cn/s/blog_67d41beb0100ixnb.html</a><br><a href="https://blog.csdn.net/bisal/article/details/51482968" target="_blank" rel="external">https://blog.csdn.net/bisal/article/details/51482968</a><br><a href="http://www.htz.pw/2015/05/20/expdp的compression测试.html" target="_blank" rel="external">http://www.htz.pw/2015/05/20/expdp的compression测试.html</a><br><a href="https://www.cnblogs.com/lsdb/p/7660774.html" target="_blank" rel="external">https://www.cnblogs.com/lsdb/p/7660774.html</a></p>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>等保三级安全要求之开源软件实现</title>
      <link href="/arlo/764ae16c/"/>
      <url>/arlo/764ae16c/</url>
      
        <content type="html"><![CDATA[<h1 id="等级划分"><a href="#等级划分" class="headerlink" title="等级划分"></a>等级划分</h1><blockquote><p>《信息安全等级保护管理办法》规定，国家信息安全等级保护坚持自主定级、自主保护的原则。信息系统的安全保护等级应当根据信息系统在国家安全、经济建设、社会生活中的重要程度，信息系统遭到破坏后对国家安全、社会秩序、公共利益以及公民、法人和其他组织的合法权益的危害程度等因素确定。<br>信息系统的安全保护等级分为以下五级：<br>第一级，信息系统受到破坏后，会对公民、法人和其他组织的合法权益造成损害，但不损害国家安全、社会秩序和公共利益。第一级信息系统运营、使用单位应当依据国家有关管理规范和技术标准进行保护。<br>第二级，信息系统受到破坏后，会对公民、法人和其他组织的合法权益产生严重损害，或者对社会秩序和公共利益造成损害，但不损害国家安全。国家信息安全监管部门对该级信息系统安全等级保护工作进行指导。<br>第三级，信息系统受到破坏后，会对社会秩序和公共利益造成严重损害，或者对国家安全造成损害。国家信息安全监管部门对该级信息系统安全等级保护工作进行监督、检查。<br>第四级，信息系统受到破坏后，会对社会秩序和公共利益造成特别严重损害，或者对国家安全造成严重损害。国家信息安全监管部门对该级信息系统安全等级保护工作进行强制监督、检查。<br>第五级，信息系统受到破坏后，会对国家安全造成特别严重损害。国家信息安全监管部门对该级信息系统安全等级保护工作进行专门监督、检查。</p></blockquote><p><strong>本文目的主要是调研等保三级的硬件可以使用哪些软件来替换（有些有硬性要求另说），整理一版放在这里，以后的项目中如果有使用到，就不用在一一查找了。</strong><br><a id="more"></a></p><h1 id="安全管理中心系统"><a href="#安全管理中心系统" class="headerlink" title="安全管理中心系统"></a>安全管理中心系统</h1><h2 id="OSSIM"><a href="#OSSIM" class="headerlink" title="OSSIM"></a>OSSIM</h2><p>OSSIM即开源安全信息管理系统(OPEN SOURCE SECURITY INFORMATION MANAGEMENT)，是一个非常流行和完整的开源安全架构体系。OSSIM通过将开源产品进行集成，从而提供一种能够实现安全监控功能的基础平台。 它的目的是提供一种集中式、有组织的、能够更好地进行监测和显示的框架式系统。OSSIM由数据收集、监视、检测、审计以及控制台这五个模块构成。这5个模块包含了目前安全领域从事件预防到事件处理一个完整的过程，在目前的安全架构 中，OSSIM是最为完备的。这五个功能模块又被划分为三个层次，分别是高层的安全信息显示控制面板、中层的风险和活动监控以及底层的证据控制台和网络监控，各个层次提供不同功能，共同保证系统的安全运转。</p><h1 id="开源堡垒机-运维审计系统"><a href="#开源堡垒机-运维审计系统" class="headerlink" title="开源堡垒机/运维审计系统"></a>开源堡垒机/运维审计系统</h1><h2 id="Jumpserver"><a href="#Jumpserver" class="headerlink" title="Jumpserver"></a>Jumpserver</h2><p>Jumpserver是全球首款完全开源的堡垒机，使用 GNU GPL v2.0 开源协议，是符合 4A 的专业运维审计系统。支持支持RDP和SSH协议的跳转,支持命令，会话记录，支持资产管理，日志审计；</p><h2 id="GateOne"><a href="#GateOne" class="headerlink" title="GateOne"></a>GateOne</h2><p>Gateone是一个基于tornado和html5技术的开源web ssh项目，功能很强大， 支持多个账户多个终端窗口连接远程机器， 支持多种认证登陆方式， 支持嵌入到各种web应用，支持多种插件等等。暂不支持windows</p><h2 id="Teleport"><a href="#Teleport" class="headerlink" title="Teleport"></a>Teleport</h2><p>Teleport是触维软件推出的一款简单易用的堡垒机系统，具有小巧、易用、易于集成的特点，支持RDP和SSH协议的跳转。</p><h2 id="麒麟开源堡垒机"><a href="#麒麟开源堡垒机" class="headerlink" title="麒麟开源堡垒机"></a>麒麟开源堡垒机</h2><p>麒麟堡垒机全协议支持、网管功能、3A系统功能、动态口令功能、SSL VPN功能、CA证书功能，支持RDP和SSH协议的跳转。</p><h1 id="开源入侵检测系统-IDS-IPS"><a href="#开源入侵检测系统-IDS-IPS" class="headerlink" title="开源入侵检测系统(IDS/IPS)"></a>开源入侵检测系统(IDS/IPS)</h1><h2 id="Snort"><a href="#Snort" class="headerlink" title="Snort"></a>Snort</h2><p>Snort是最好的入侵检测系统（IDS）工具。它所需要的是一些在上面运行的硬件以及安装、配置和维护的时间。Snort可以在任何操作系统上运行，包括Windows和Linux。<br>Snort 一直都是网络入侵检测（IDS）和入侵防御工具（IPS）的领导者，并且，随着开源社区的持续发展，为其母公司Sourcefire（多年 来，Sourcefire提供有供应商支持和即时更新的功能齐全的商业版本Snort，同时仍然免费提供功能有限的免费版本Snort）持续不断的支 持，Snort很可能会继续保持其领导地位。<br>虽然Snort“称霸”这个市场，但也有其他供应商提供类似的免费工具。很多这些入侵检测系统（IDS）供应商（即使不是大多数）结合Snort或其他开源软件的引擎来创建强大的免费入侵检测服务。</p><h2 id="Security-Onion"><a href="#Security-Onion" class="headerlink" title="Security Onion"></a>Security Onion</h2><p>Security Onion是用于网络监控和入侵检测的基于Ubuntu的Linux发行版。该镜像可以作为传感器分布在网络中，以监控多个VLAN和子网，这很适用于 VMware和虚拟环境。该配置只能用作IDS，目前不能当作IPS运行。然而，你可以选择把它作为网络和主机入侵检测部署，以及利用Squil、Bro IDS和OSSEC等服务来执行该服务的IDS功能。该工具的wiki信息和文档信息很丰富，漏洞和错误也有记录和审查。虽然Security Onion很强大，但它仍然需要不断发展，当然这需要时间。</p><h2 id="OSSEC"><a href="#OSSEC" class="headerlink" title="OSSEC"></a>OSSEC</h2><p>OSSEC是一个开源主机入侵检测系统（HIDS），它的功能不只是入侵检测。与大多数开源IDS产品一样，有多种附加模块可以结合该 IDS的核心功能。除了网络入侵检测外，OSSEC客户端能够执行文件完整性监控和rootkit检测，并有实时报警，这些功能都是集中管理，并能根据企 业的需求创建不同政策。OSSEC客户端在大多数操作系统上本地运行，包括Linux各版本、Mac OSX和Windows。它还通过趋势科技的全球支持团队提供商业支持，这是一个非常成熟的产品。</p><h2 id="OpenWIPS-NG"><a href="#OpenWIPS-NG" class="headerlink" title="OpenWIPS-NG"></a>OpenWIPS-NG</h2><p>OpenWIPS-NG是一个免费的无线IDS / IPS，它依赖于服务器、传感器和接口。它可以在普通硬件上运行。其创建者是Aircrack-NG的开发者，该系统使用Aircrack-NG内置的很 多功能和服务来进行扫描、检测和入侵防御。OpenWIPS-NG是模块化的，允许管理员下载插件来增加功能。其文件并不像某些系统一样详细，但它允许公司在预算紧张的情况下执行WIPS。</p><h2 id="Suricata"><a href="#Suricata" class="headerlink" title="Suricata"></a>Suricata</h2><p>在所有目前可用的IDS/IPS系统中，Suricata最能够与Snort相抗衡。该系统有一个类似Snort的架构，依赖于像 Snort等的签名，甚至可以使用VRT Snort规则和Snort本身使用的相同的Emerging Threat规则集。Suricata比Snort更新，它将有机会赶超Snort。如果Snort不是你企业的选择，这个免费的工具最适合运行在你的企 业网络中。</p><h2 id="Bro-IDS"><a href="#Bro-IDS" class="headerlink" title="Bro IDS"></a>Bro IDS</h2><p>Bro IDS类似于Security Onion，它使用更多IDS规则来确定攻击来源。Bro IDS使用工具组合，曾经它使用基于Snort的签名转换成Bro签名，不过现在不再是如此，现在用户能够为Bro IDS编写自定义签名。该系统有很多详细文档信息，并已有超过15年的历史。</p><h2 id="Prelude-IDS"><a href="#Prelude-IDS" class="headerlink" title="Prelude IDS"></a>Prelude IDS</h2><p>从设计的方式来看定位于适应大型网络的需求， 实现了网络探测器、日志分析器、告警信息集中查看分析工具。其网络探测器部分基本上翻版了Snort的功能，完全兼容Snort的规则集。</p><h2 id="Firestorm"><a href="#Firestorm" class="headerlink" title="Firestorm"></a>Firestorm</h2><p>是一个非常高性能的网络入侵检测系统(NIDS)。目前它仅实现了探测器部分，完全兼容Snort的规则集，但计划包括对分析、报告、远程控制台和实时传感器配置的真正支持。它完全可插拔，因此非常灵活，，可以把告警信息记录到Prelude IDS的管理器， 自称性能上比Snort强很多。</p><h2 id="NetSTAT"><a href="#NetSTAT" class="headerlink" title="NetSTAT"></a>NetSTAT</h2><p>基于STAT(State Transition Analysis Technique，状态迁移分析技术)描述攻击的研究成果，使用特有的STATL语言描述攻击，攻击描述文本被STATL解释工具转换为C++代码编译进检测引擎来实现检测功能，目前已经发布了STATL语言解释转换工具及一个基本的示例网络探测器部分(很少的几个检测功能例子)。要熟练使用这个IDS工具需要比较强的编程功底，但用此IDS可以实现很复杂的检测功能。</p><h2 id="Bro"><a href="#Bro" class="headerlink" title="Bro"></a>Bro</h2><p>是一个Vern Paxson实现的实时网络入侵检测软件，于98年对外发布，BSD license，它的最初设计目标是实现一个在100M网络下实时告警、机制与策略分离、高可扩展性的入侵检测及网络监视审计系统。</p><h1 id="开源的web应用防火墙"><a href="#开源的web应用防火墙" class="headerlink" title="开源的web应用防火墙"></a>开源的web应用防火墙</h1><p>Web应用防火墙提供应用层的安全。从本质上讲，WAF提供全面的web应用安全解决方案，确保数据和Web应用程序是安全的。<br>Web应用防火墙，适用于跨站点脚本，SQL注入等，可以为Web应用程序提供安全的Web应用程序框架。Web应用防火墙允许您配置规则，通过识别阻止恶意内容。下面给出了10个最流行和广泛使用的开源的Web应用防火墙：</p><h2 id="ModSecurity的（Trustwave公司SpiderLabs）"><a href="#ModSecurity的（Trustwave公司SpiderLabs）" class="headerlink" title="ModSecurity的（Trustwave公司SpiderLabs）"></a>ModSecurity的（Trustwave公司SpiderLabs）</h2><p>ModSecurity是一个最古老的和广泛使用的开放源码的Web应用程序防火墙能够检测应用层威胁在互联网上，并针对一系列Web应用程序的安全问题提供了安全保障。它提供非病毒的开放来源执照，它可以集成到Apache程序。近日，ModSecurity的发布2.6.0版提供的功能安全浏览API集成，敏感数据的跟踪和数据修改功能。</p><h2 id="AQTRONIX-WebKnight"><a href="#AQTRONIX-WebKnight" class="headerlink" title="AQTRONIX WebKnight"></a>AQTRONIX WebKnight</h2><p>AQTRONIX WebKnight是一个开源应用程序专为Web服务器和IIS防火墙，它是通过GNU - 通用公共许可证授权。它提供了缓冲区溢出，目录遍历编码和SQL注入攻击识别/限制功能。</p><h2 id="ESAPI-WAF"><a href="#ESAPI-WAF" class="headerlink" title="ESAPI WAF"></a>ESAPI WAF</h2><p>ESAPI WAF是Aspect安全开发的，它被设计为提供保护，而不是在应用层网络层。它是基于Java的WAF提供完整的安全性，从网上攻击。一些解决方案的独特功能包括出站过滤功能，降低信息泄漏。配置驱动的，而不是代码的基础，它使安装方便，只需添加在文本文件中的配置细节。</p><h2 id="WebCastellum"><a href="#WebCastellum" class="headerlink" title="WebCastellum"></a>WebCastellum</h2><p>WebCastellum是一个基于Java的Web应用防火墙，可以保护应用程序对跨站脚本，SQL注入，命令注入，参数操纵，它可以轻松地集成到一个基于Java的应用程序。它是基于新技术和提供保护，它可以使用现有的代码。</p><h2 id="Binarysec"><a href="#Binarysec" class="headerlink" title="Binarysec"></a>Binarysec</h2><p>Binarysec为Apache是​​Web应用程序防火墙软件，它可以保护应用程序免受非法HTTP和阻止可疑的请求以及。它提供保护，防止跨站点脚本，赞扬注射，参数篡改，缓冲区溢出，目录遍历，SQL注入攻击阻塞。这需要不超过10分钟来安装软件，在一台机器上，其用户界面可以管理Apache服务器和许多网站。</p><h2 id="Guardian-JUMPERZ-NET"><a href="#Guardian-JUMPERZ-NET" class="headerlink" title="Guardian@JUMPERZ.NET"></a>Guardian@JUMPERZ.NET</h2><p>Guardian@JUMPERZ.NET HTTPS / HTTP是一个开源应用层防火墙，HTTP / HTTPS流量评估保护Web应用程序免受外部攻击。Guardian@JUMPERZ.NET立即断开TCP连接，当应用程序来接触与恶意/未经授权的请求。</p><h2 id="OpenWAF"><a href="#OpenWAF" class="headerlink" title="OpenWAF"></a>OpenWAF</h2><p>Art of defense是一个总部设在旧金山的Web应用程序的安全性提供者上开源OpenWAF的2011年2月启动了一个项目。这也是第一家提供Apache服务器的分布式Web应用防火墙。</p><h2 id="Ironbee"><a href="#Ironbee" class="headerlink" title="Ironbee"></a>Ironbee</h2><p>Qualys公司创建基于云的开源Web应用程序防火墙 - Ironbee代替了传统的IP数据包检查的HTTP评估数据。它甚至可以跟踪跨站点脚本代码的攻击。Ironbee出版通过Apache许可证版本2，它提供无版权转让。它具有模块化结构，是相当容易使用。</p><h2 id="Profense"><a href="#Profense" class="headerlink" title="Profense"></a>Profense</h2><p>ZION安全提供了一个开放源码的Web应用防火墙类似ModSecurity的，被称为Profense。Zion所提供的Web应用防火墙本质上是一个7层防火墙（也被称为“代理防火墙”），并检查交通封锁内容。</p><h2 id="Smoothwall"><a href="#Smoothwall" class="headerlink" title="Smoothwall"></a>Smoothwall</h2><p>Smoothwall提供了强大的网络安全工具来管理电子邮件。开放源码的网页过滤引擎被称为Smoothwall DansGuardian的。它具有灵活的用户规则和一个完全集成的网页过滤和安全组件。更重要的是，它提供了身份验证的网络访问和 traffic blocking。Smoothwall免费防火墙安全加固Linux的GNU操作系统。</p><h2 id="X-WAF"><a href="#X-WAF" class="headerlink" title="X-WAF"></a>X-WAF</h2><p>X-WAF是一款适用中、小企业的云WAF系统，让中、小企业也可以非常方便地拥有自己的免费云WAF。</p><h1 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h1><h2 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h2><p>工作在网络的7层之上，可以针对http应用做一些分流的策略，比如针对域名、目录结构，它的正则规则比HAProxy更为强大和灵活，这也是它目前广泛流行的主要原因之一，Nginx单凭这点可利用的场合就远多于LVS了。</p><h2 id="HAProxy"><a href="#HAProxy" class="headerlink" title="HAProxy"></a>HAProxy</h2><p>HAProxy 是一款提供高可用性、负载均衡以及基于TCP（第四层）和HTTP（第七层）应用的代理软件，支持虚拟主机，它是免费、快速并且可靠的一种解决方案。 HAProxy特别适用于那些负载特大的web站点，这些站点通常又需要会话保持或七层处理。HAProxy运行在时下的硬件上，完全可以支持数以万计的 并发连接。并且它的运行模式使得它可以很简单安全的整合进您当前的架构中， 同时可以保护你的web服务器不被暴露到网络上。</p><h2 id="LVS"><a href="#LVS" class="headerlink" title="LVS"></a>LVS</h2><p>LVS 使用Linux内核集群实现一个高性能、高可用的负载均衡服务器，它具有很好的可伸缩性（Scalability)、可靠性（Reliability)和可管理性（Manageability)。抗负载能力强、是工作在网络4层之上仅作分发之用，没有流量的产生，这个特点也决定了它在负载均衡软件里的性能最强的，对内存和cpu资源消耗比较低。</p><h1 id="病毒过滤"><a href="#病毒过滤" class="headerlink" title="病毒过滤"></a>病毒过滤</h1><h2 id="ClamaV"><a href="#ClamaV" class="headerlink" title="ClamaV"></a>ClamaV</h2><p>ClamAV 杀毒是Linux平台最受欢迎的杀毒软件，ClamAV属于免费开源产品，支持多种平台，如：Linux/Unix、MAC OS X、Windows、OpenVMS。ClamAV是基于病毒扫描的命令行工具，但同时也有支持图形界面的ClamTK工具。ClamAV主要用于邮件服务器扫描邮件。它有多种接口从邮件服务器扫描邮件，支持文件格式有如：ZIP、RAR、TAR、GZIP、BZIP2、HTML、DOC、PDF,、SIS CHM、RTF等等。ClamAV有自动的数据库更新器，还可以从共享库中运行。命令行的界面让ClamAV运行流畅。</p><h2 id="Avria"><a href="#Avria" class="headerlink" title="Avria"></a>Avria</h2><p>另一个Linux下最好的杀毒软件是Avria免费杀毒版，Avria提供可扩展配置，控制你的计算机成为可能。它有一些很强大的特性，例如：简单的脚本安装方式、命令行扫描器、自动更新(产品、引擎、VDF)、自我完整性程序检查等等。</p><h2 id="AVG-免费版杀毒"><a href="#AVG-免费版杀毒" class="headerlink" title="AVG 免费版杀毒"></a>AVG 免费版杀毒</h2><p>现在有超过10亿用户使用AVG杀毒，同样是Linux机器中不错的杀毒专家，免费版提供的特性比高级版要少。AVG目前还不支持图形界面。提供防病毒和防间谍工具，AVG运行速度很快，占用系统资源很少，支持主流Linux版本如：Debian、Ubuntu、Red hat、Cent OS、FreeBSD等等</p><h1 id="VPN"><a href="#VPN" class="headerlink" title="VPN"></a>VPN</h1><h2 id="OpenVPN"><a href="#OpenVPN" class="headerlink" title="OpenVPN"></a>OpenVPN</h2><p>OpenVPN 是一个基于 OpenSSL 库的应用层 VPN 实现。和传统 VPN 相比，它的优点是简单易用。</p><p>参考链接：<br><a href="https://blog.csdn.net/chinajust/article/details/78663972" target="_blank" rel="external">https://blog.csdn.net/chinajust/article/details/78663972</a><br><a href="http://www.aqniu.com/tools-tech/667.html" target="_blank" rel="external">http://www.aqniu.com/tools-tech/667.html</a><br><a href="http://www.cnnetsec.com/1006.html" target="_blank" rel="external">http://www.cnnetsec.com/1006.html</a><br><a href="https://blog.csdn.net/chengxuyuanyonghu/article/details/60468470" target="_blank" rel="external">https://blog.csdn.net/chengxuyuanyonghu/article/details/60468470</a><br><a href="https://klionsec.github.io/2017/09/22/snortpentest/" target="_blank" rel="external">https://klionsec.github.io/2017/09/22/snortpentest/</a></p>]]></content>
      
      
      <categories>
          
          <category> 安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 等保 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Oracle 11g静默安装官方提供的examples</title>
      <link href="/arlo/56125275/"/>
      <url>/arlo/56125275/</url>
      
        <content type="html"><![CDATA[<p>之前安装oracle的时候，没有安装默认的示例，练习过程中，教程常用的hr等用户都没有，可以从官网下载示例来安装。</p><h1 id="下载官方example包"><a href="#下载官方example包" class="headerlink" title="下载官方example包"></a>下载官方example包</h1><p>登录<a href="http://www.oracle.com" target="_blank" rel="external">http://www.oracle.com</a> 到下载页浏览就可以找到名为 linux.x64_11gR2_examples.zip<br><code>unzip linux.x64_11gR2_examples.zip</code><br><a id="more"></a></p><h1 id="编辑rsp静默安装文件"><a href="#编辑rsp静默安装文件" class="headerlink" title="编辑rsp静默安装文件"></a>编辑rsp静默安装文件</h1><p><code>cp examples/response/demos_install.rsp .</code><br><code>egrep -v &quot;^$|^#&quot; /home/oracle/demos_install.rsp</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">ORACLE_HOSTNAME=siluxa_oracle</div><div class="line">UNIX_GROUP_NAME=oinstall</div><div class="line">INVENTORY_LOCATION=/u01/app/oraInventory/</div><div class="line">SELECTED_LANGUAGES=en,zh_CN</div><div class="line">ORACLE_HOME=/u01/app/oracle/product/11.1.0/db_1</div><div class="line">ORACLE_BASE=/u01/app/oracle</div></pre></td></tr></table></figure></p><h1 id="静默安装example"><a href="#静默安装example" class="headerlink" title="静默安装example"></a>静默安装example</h1><p><code>./runInstaller -silent -responseFile /home/oracle/demos_install.rsp -ignorePrereq</code></p><h1 id="执行sql脚本文件，安装特定模式"><a href="#执行sql脚本文件，安装特定模式" class="headerlink" title="执行sql脚本文件，安装特定模式"></a>执行sql脚本文件，安装特定模式</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">[oracle@siluxa_oracle human_resources]$ sqlplus sys/solution as sysdba</div><div class="line"></div><div class="line">SQL*Plus: Release 11.2.0.1.0 Production on Fri May 4 18:01:11 2018</div><div class="line"></div><div class="line">Copyright (c) 1982, 2009, Oracle.  All rights reserved.</div><div class="line"></div><div class="line"></div><div class="line">Connected to:</div><div class="line">Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production</div><div class="line">With the Partitioning, OLAP, Data Mining and Real Application Testing options</div><div class="line"></div><div class="line">SYS@orcl&gt;  @?/demo/schema/human_resources/hr_main.sql</div><div class="line"></div><div class="line">specify password for HR as parameter 1:</div><div class="line">Enter value for 1: 123</div><div class="line"></div><div class="line">specify default tablespeace for HR as parameter 2:</div><div class="line">Enter value for 2: users</div><div class="line"></div><div class="line">specify temporary tablespace for HR as parameter 3:</div><div class="line">Enter value for 3: temp</div><div class="line"></div><div class="line">specify password for SYS as parameter 4:</div><div class="line">Enter value for 4: solution</div><div class="line"></div><div class="line">specify log path as parameter 5:</div><div class="line">Enter value for 5: $ORACLE_HOME/demo/schema/log/</div></pre></td></tr></table></figure><p><img src="/images/2018/0504/01.png" alt="z"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">HR@orcl&gt; select table_name from user_tables;</div><div class="line"></div><div class="line">TABLE_NAME</div><div class="line">------------------------------</div><div class="line">REGIONS</div><div class="line">LOCATIONS</div><div class="line">JOB_HISTORY</div><div class="line">JOBS</div><div class="line">EMPLOYEES</div><div class="line">DEPARTMENTS</div><div class="line">COUNTRIES</div><div class="line"></div><div class="line">7 rows selected.</div></pre></td></tr></table></figure></p><p>这样就算安装完成了，可以使用hr进行学习了。</p><p>参考地址：<a href="https://blog.csdn.net/smstong/article/details/45891187" target="_blank" rel="external">https://blog.csdn.net/smstong/article/details/45891187</a></p>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>将绿色版Tomcat/Nginx注册成服务，实现开机自启动</title>
      <link href="/arlo/956f976/"/>
      <url>/arlo/956f976/</url>
      
        <content type="html"><![CDATA[<p>我们常用的Tomcat，不管是在windows下还是linux下基本上都是绿色版本，解压、启动后直接使用。<br>这就产生了一个问题，不能开机自自动，很不方便，linux下可以添加到/etc/rc.local实现开机自启，windows下也可以添加到开机启动项里；不过注册为系统服务更加方便一些，这里记录一下方法。<br><a id="more"></a></p><h1 id="注册Tomcat服务"><a href="#注册Tomcat服务" class="headerlink" title="注册Tomcat服务"></a>注册Tomcat服务</h1><h2 id="检查系统环境"><a href="#检查系统环境" class="headerlink" title="检查系统环境"></a>检查系统环境</h2><p>确保64位的操作系统下是64位的Jdk<br><img src="/images/2018/0426/01.png" alt="tomcat"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">F:\&gt;java -d64 -version</div><div class="line">java version &quot;1.7.0_80&quot;</div><div class="line">Java(TM) SE Runtime Environment (build 1.7.0_80-b15)</div><div class="line">Java HotSpot(TM) 64-Bit Server VM (build 24.80-b11, mixed mode)</div></pre></td></tr></table></figure></p><h2 id="使用tomcat自身工具注册服务"><a href="#使用tomcat自身工具注册服务" class="headerlink" title="使用tomcat自身工具注册服务"></a>使用tomcat自身工具注册服务</h2><p>进入到tomcat bin目录下，执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">#注册服务</div><div class="line">service.bat install &apos;服务名&apos; </div><div class="line">#服务名中不能有&quot;-&quot;,&quot;_&quot;，否则在服务中看不到</div><div class="line">F:\apache-tomcat-7.0.70(zabbix)\bin&gt;service.bat install tomcat7070 </div><div class="line">Installing the service &apos;tomcat7070&apos; ...</div><div class="line">Using CATALINA_HOME:    &quot;F:\apache-tomcat-7.0.70(zabbix)&quot;</div><div class="line">Using CATALINA_BASE:    &quot;F:\apache-tomcat-7.0.70(zabbix)&quot;</div><div class="line">Using JAVA_HOME:        &quot;C:\Program Files\Java\jdk1.7.0_80&quot;</div><div class="line">Using JRE_HOME:         &quot;C:\Program Files\Java\jdk1.7.0_80\jre&quot;</div><div class="line">Using JVM:              &quot;C:\Program Files\Java\jdk1.7.0_80\jre\bin\server\jvm.dll&quot;</div><div class="line">The service &apos;tomcat7070&apos; has been installed.</div><div class="line"></div><div class="line">#卸载服务</div><div class="line">service.bat remove &apos;服务名&apos; </div><div class="line"></div><div class="line">F:\apache-tomcat-7.0.70(zabbix)\bin&gt;service.bat remove tomcat7070</div><div class="line">Removing the service &apos;tomcat7070&apos; ...</div><div class="line">Using CATALINA_BASE:    &quot;F:\apache-tomcat-7.0.70(zabbix)&quot;</div><div class="line">The service &apos;tomcat7070&apos; has been removed</div></pre></td></tr></table></figure></p><p><img src="/images/2018/0426/02.png" alt="tomcat"></p><h1 id="设置服务依赖关系"><a href="#设置服务依赖关系" class="headerlink" title="设置服务依赖关系"></a>设置服务依赖关系</h1><p>如果项目中有多个tomcat，有先后启动顺序的话，可以使用到服务里的依赖关系,比如tomcat8080启动时候监测tomcat8081是否启动（8080依赖8081），就可以按下边这种方法设置。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sc config &quot;tomcat8080&quot; depend= tomcat8081</div></pre></td></tr></table></figure></p><h1 id="设置访问自动启动"><a href="#设置访问自动启动" class="headerlink" title="设置访问自动启动"></a>设置访问自动启动</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">set autoconfig enabled=&#123;yes|no&#125;</div></pre></td></tr></table></figure><h1 id="注册Nginx服务方法一"><a href="#注册Nginx服务方法一" class="headerlink" title="注册Nginx服务方法一"></a>注册Nginx服务方法一</h1><h2 id="进入github下载WinSW-NET4-exe"><a href="#进入github下载WinSW-NET4-exe" class="headerlink" title="进入github下载WinSW.NET4.exe"></a>进入github下载WinSW.NET4.exe</h2><p><a href="https://github.com/kohsuke/winsw/releases/download/winsw-v2.1.2/WinSW.NET4.exe" target="_blank" rel="external">https://github.com/kohsuke/winsw/releases/download/winsw-v2.1.2/WinSW.NET4.exe</a><br>将WinSW.NET4.exe 拷贝到 D:\nginx-1.16.1目录下，并重命名为nginx-server.exe</p><h2 id="编写配置文件"><a href="#编写配置文件" class="headerlink" title="编写配置文件"></a>编写配置文件</h2><p>在D:\nginx-1.16.1目录下新建 nginx-server.xml 配置文件，内容如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</div><div class="line">&lt;service&gt;</div><div class="line">  &lt;id&gt;Nginx&lt;/id&gt;</div><div class="line">  &lt;name&gt;Nginx&lt;/name&gt;</div><div class="line">  &lt;description&gt;Nginx&lt;/description&gt;</div><div class="line">  &lt;executable&gt;D:\nginx-1.16.1\nginx.exe&lt;/executable&gt;</div><div class="line">  &lt;startargument&gt;-p&lt;/startargument&gt;</div><div class="line">  &lt;startargument&gt;D:\nginx-1.16.1&lt;/startargument&gt;  </div><div class="line">  &lt;logpath&gt;D:\nginx-1.16.1\logs&lt;/logpath&gt;</div><div class="line">  &lt;logmode&gt;roll&lt;/logmode&gt;  </div><div class="line">  &lt;stopexecutable&gt;D:\nginx-1.16.1\nginx.exe&lt;/stopexecutable&gt;</div><div class="line">  &lt;stopargument&gt;-p&lt;/stopargument&gt;</div><div class="line">  &lt;stopargument&gt;D:\nginx-1.16.1&lt;/stopargument&gt;</div><div class="line">  &lt;stopargument&gt;-s&lt;/stopargument&gt;</div><div class="line">  &lt;stopargument&gt;stop&lt;/stopargument&gt;</div><div class="line">  &lt;stoptimeout&gt;6sec&lt;/stoptimeout&gt;</div><div class="line">&lt;/service&gt;</div></pre></td></tr></table></figure></p><h2 id="注册并启动服务"><a href="#注册并启动服务" class="headerlink" title="注册并启动服务"></a>注册并启动服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">D:\&gt;d:\nginx-1.16.1\nginx-server.exe install</div><div class="line">2019-11-12 15:34:26,555 INFO  - Installing the service with id &apos;Nginx&apos;</div><div class="line"></div><div class="line">D:\nginx-1.16.1&gt;net start Nginx</div><div class="line">Nginx 服务正在启动 .</div><div class="line">Nginx 服务已经启动成功。</div></pre></td></tr></table></figure><h1 id="注册Nginx服务方法二"><a href="#注册Nginx服务方法二" class="headerlink" title="注册Nginx服务方法二"></a>注册Nginx服务方法二</h1><h2 id="下载Windows-Server-2003-Resource-Kit-Tools"><a href="#下载Windows-Server-2003-Resource-Kit-Tools" class="headerlink" title="下载Windows Server 2003 Resource Kit Tools"></a>下载Windows Server 2003 Resource Kit Tools</h2><p>其实我们只需要里边instsrv.exe、srvany.exe这两个工具<br><a href="https://www.microsoft.com/en-IE/download/details.aspx?id=17657" target="_blank" rel="external">https://www.microsoft.com/en-IE/download/details.aspx?id=17657</a></p><h2 id="注册Nginx服务"><a href="#注册Nginx服务" class="headerlink" title="注册Nginx服务"></a>注册Nginx服务</h2><p>安装完上述工具，打开C:\Program Files (x86)\Windows Resource Kits\Tools， 复制srvany.exe到nginx.exe同级目录下。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sc create &quot;Nginx&quot; binPath=&quot;D:\deploy\nginx-1.12.1\srvany.exe&quot; start=auto</div></pre></td></tr></table></figure></p><h2 id="导入注册表"><a href="#导入注册表" class="headerlink" title="导入注册表"></a>导入注册表</h2><p>复制一下内容，保存为.reg格式文件，双击导入到注册表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Windows Registry Editor Version 5.00 </div><div class="line">[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Nginx\Parameters]  </div><div class="line">&quot;Application&quot;=&quot;D:\\deploy\\nginx-1.12.1\\nginx.exe&quot;  </div><div class="line">&quot;AppParameters&quot;=&quot;&quot;  </div><div class="line">&quot;AppDirectory&quot;=&quot;D:\\deploy\\nginx-1.12.1&quot;</div></pre></td></tr></table></figure></p><h2 id="启动关闭服务"><a href="#启动关闭服务" class="headerlink" title="启动关闭服务"></a>启动关闭服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># 启动</div><div class="line">C:\&gt;net start Nginx</div><div class="line">Nginx 服务正在启动 .</div><div class="line">Nginx 服务已经启动成功。</div><div class="line"># 关闭</div><div class="line">windows下nginx默认会启动两个进程，如果使用net stop Nginx的话只能关闭一个nginx进程，不能完全关闭</div><div class="line">taskkill /F /IM nginx.exe</div></pre></td></tr></table></figure><p>参考资料：<br><a href="http://www.cnblogs.com/xwdreamer/p/3411986.html" target="_blank" rel="external">http://www.cnblogs.com/xwdreamer/p/3411986.html</a><br><a href="http://wlbbswl.iteye.com/blog/840538" target="_blank" rel="external">http://wlbbswl.iteye.com/blog/840538</a><br><a href="https://blog.csdn.net/qq_16022261/article/details/53836004" target="_blank" rel="external">https://blog.csdn.net/qq_16022261/article/details/53836004</a><br><a href="http://koda.iteye.com/blog/600725" target="_blank" rel="external">http://koda.iteye.com/blog/600725</a></p>]]></content>
      
      
      <categories>
          
          <category> 常识 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tomcat </tag>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Zabbix(9)结合sensor监控cpu温度</title>
      <link href="/arlo/ce74a028/"/>
      <url>/arlo/ce74a028/</url>
      
        <content type="html"><![CDATA[<p>zabbix 可以通过sensors-detect检测内核模块，使用zabbix监控系统自定义监控项，采集监控数据并设置告警。可以监控物理机器(虚拟机获取不到)的温度。<br><a id="more"></a></p><h1 id="安装sensors"><a href="#安装sensors" class="headerlink" title="安装sensors"></a>安装sensors</h1><p>安装、运行sensors，可以看到每颗cpu的温度<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">[root@siluxa2 src]# yum install lm_sensors</div><div class="line">[root@siluxa2 src]# sensors</div><div class="line">i350bb-pci-0100</div><div class="line">Adapter: PCI adapter</div><div class="line">loc1:         +50.0°C  (high = +120.0°C, crit = +110.0°C)</div><div class="line"></div><div class="line">coretemp-isa-0000</div><div class="line">Adapter: ISA adapter</div><div class="line">Physical id 0:  +55.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 0:         +45.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 1:         +46.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 2:         +45.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 3:         +46.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 4:         +46.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 8:         +46.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 9:         +46.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 10:        +46.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 11:        +44.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 12:        +45.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line"></div><div class="line">coretemp-isa-0001</div><div class="line">Adapter: ISA adapter</div><div class="line">Physical id 1:  +49.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 0:         +42.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 1:         +41.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 2:         +41.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 3:         +41.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 4:         +42.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 8:         +41.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 9:         +42.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 10:        +41.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 11:        +41.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 12:        +41.0°C  (high = +80.0°C, crit = +90.0°C)</div></pre></td></tr></table></figure></p><h1 id="配置zabbix-agent客户端文件"><a href="#配置zabbix-agent客户端文件" class="headerlink" title="配置zabbix agent客户端文件"></a>配置zabbix agent客户端文件</h1><p>修改客户端配置文件zabbix_agentd.conf<br>第一次自定义监控时要设置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">UnsafeUserParameters=1</div></pre></td></tr></table></figure></p><p>在配置文件中添加一行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">UserParameter=get_temp_cpu[*],sensors|grep &quot;Physical id $1&quot;|cut -c 17-20</div></pre></td></tr></table></figure></p><h1 id="添加监控项"><a href="#添加监控项" class="headerlink" title="添加监控项"></a>添加监控项</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">sensor[device,sensor,&lt;mode&gt;]</div><div class="line">读取硬件传感器</div><div class="line">device - 设备名称  </div><div class="line">sensor - 传感器名称  </div><div class="line">mode - 可选值:avg, max, min</div><div class="line">示例key: sensor[w83781d-i2c-0-2d,temp1] Prior to Zabbix 1.8.4, the sensor[temp1] format was used. On Linux 2.6+, 读取/sys/class/hwmon. On OpenBSD, 读取hw.sensors MIB.示例keys: sensor[cpu0,temp0] – CPU0的温度 sensor[cpu[0-2]$,temp,avg] – cpu平均温度Zabbix 1.8.4开始支持OpenBSD</div></pre></td></tr></table></figure><p>我这里添加两颗cpu为例！<br><img src="/images/2018/0419/01.png" alt="z"><br><img src="/images/2018/0419/02.png" alt="z"></p><h1 id="添加触发器"><a href="#添加触发器" class="headerlink" title="添加触发器"></a>添加触发器</h1><p><img src="/images/2018/0419/03.png" alt="z"><br><img src="/images/2018/0419/04.png" alt="z"></p><h1 id="添加图形"><a href="#添加图形" class="headerlink" title="添加图形"></a>添加图形</h1><p><img src="/images/2018/0419/05.png" alt="z"></p><h1 id="查看图形"><a href="#查看图形" class="headerlink" title="查看图形"></a>查看图形</h1><p><img src="/images/2018/0419/06.png" alt="z"></p><p>参考链接：<a href="http://xy.uyun.cn/post/1865.html" target="_blank" rel="external">http://xy.uyun.cn/post/1865.html</a></p>]]></content>
      
      
      <categories>
          
          <category> 监控 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 运维 </tag>
            
            <tag> 自动化 </tag>
            
            <tag> zabbix </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Zabbix(8)使用ansible批量部署zabbix agent</title>
      <link href="/arlo/7c94dafb/"/>
      <url>/arlo/7c94dafb/</url>
      
        <content type="html"><![CDATA[<p>相同系统环境部署zabbix agent，可以使用ansible playbook来实现，大概分为以下几步。<br><a id="more"></a></p><h1 id="ansible-目录结构"><a href="#ansible-目录结构" class="headerlink" title="ansible 目录结构"></a>ansible 目录结构</h1><p>[root@sl_confluence ansible]# pwd<br>/etc/ansible<br>[root@sl_confluence ansible]# tree<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">.</div><div class="line">├── ansible.cfg</div><div class="line">├── hosts</div><div class="line">├── roles</div><div class="line">│   └── zabbix_agent</div><div class="line">│       ├── files</div><div class="line">│       │   └── zabbix-agent-3.4.8-1.el6.x86_64.rpm</div><div class="line">│       ├── tasks</div><div class="line">│       │   └── main.yml</div><div class="line">│       └── templates</div><div class="line">│           └── zabbix_agentd.conf.j2</div><div class="line">└── zabbix_agent.yml</div><div class="line"></div><div class="line">5 directories, 6 files</div></pre></td></tr></table></figure></p><h1 id="查看-hosts文件"><a href="#查看-hosts文件" class="headerlink" title="查看 hosts文件"></a>查看 hosts文件</h1><p>[root@sl_confluence ansible]#  cat hosts<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[zabbix_agent]</div><div class="line">dbserver</div></pre></td></tr></table></figure></p><p>[root@sl_confluence ansible]# cat zabbix_agent.yml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">- hosts: zabbix_agent</div><div class="line">  user: root</div><div class="line">  vars:</div><div class="line">     zabbix_serverip: 192.168.6.186 # zabbix 服务器IP</div><div class="line">     zabbix_activeip: 192.168.6.186 # zabbix 服务器IP</div><div class="line">     agent_hostname: &apos;&#123;&#123; ansible_hostname &#125;&#125;&apos; # 客户端hostname</div><div class="line">     agent_ip: &apos;&#123;&#123; ansible_eth0.ipv4.address &#125;&#125;&apos; # 客户端IP 根据实际情况修改自己的网卡名字eth0 改成自己服务器</div><div class="line">  roles:</div><div class="line">    - zabbix_agent</div></pre></td></tr></table></figure></p><p>[root@sl_confluence tasks]# cat main.yml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- name: copy zabbix_agentd </div><div class="line">  copy: src=/etc/ansible/roles/zabbix_agent/files/zabbix-agent-3.4.8-1.el6.x86_64.rpm dest=/usr/local/src/zabbix-agent-3.4.8-1.el6.x86_64.rpm</div><div class="line">- name: install zabbix-agend</div><div class="line">  shell: rpm -ivh /usr/local/src/zabbix-agent-3.4.8-1.el6.x86_64.rpm # 安装zabbix agentd</div><div class="line">- name: up zabbix-agent file client  # 上传配置文件</div><div class="line">  template: src=zabbix_agentd.conf.j2 dest=/etc/zabbix/zabbix_agentd.conf</div><div class="line">- name: enabled service zabbix-agent # 打开zabbix-agent 开机启动</div><div class="line">  service: name=zabbix-agent enabled=yes</div><div class="line">- name: start  service zabbix-agent # 启动zabbix-agent</div><div class="line">  service: name=zabbix-agent  state=started</div></pre></td></tr></table></figure></p><h1 id="定义zabbix-agent-conf模板文件"><a href="#定义zabbix-agent-conf模板文件" class="headerlink" title="定义zabbix_agent.conf模板文件"></a>定义zabbix_agent.conf模板文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@sl_confluence templates]# cat zabbix_agentd.conf.j2 </div><div class="line">PidFile=/var/run/zabbix/zabbix_agentd.pid</div><div class="line">LogFile=/var/log/zabbix/zabbix_agentd.log</div><div class="line">EnableRemoteCommands=1</div><div class="line">Server=&#123;&#123;zabbix_serverip&#125;&#125;</div><div class="line">ListenPort=10050</div><div class="line">ServerActive=&#123;&#123;zabbix_activeip&#125;&#125;</div><div class="line">Hostname=&#123;&#123;ansible_hostname&#125;&#125;</div><div class="line">AllowRoot=1</div><div class="line">Include=/etc/zabbix/zabbix_agentd.d/*.conf</div></pre></td></tr></table></figure><h1 id="执行安装"><a href="#执行安装" class="headerlink" title="执行安装"></a>执行安装</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible-playbook zabbix_agent.yml</div></pre></td></tr></table></figure><p><img src="/images/2018/0417/04.png" alt="z"></p>]]></content>
      
      
      <categories>
          
          <category> 监控 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 运维 </tag>
            
            <tag> 自动化 </tag>
            
            <tag> zabbix </tag>
            
            <tag> Ansible </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Zabbix(7)监控端口、服务存活</title>
      <link href="/arlo/429ab963/"/>
      <url>/arlo/429ab963/</url>
      
        <content type="html"><![CDATA[<p>之前添加的tomcat监控，只能监控到jvm，类，线程之类的参数，不能监控tomcat本身的存活状态，总感觉有点美中不足；网上找了下，监控端口、服务还是挺简单的，这里记录一下。<br><a id="more"></a></p><h1 id="zabbix有三种监控端口的监控项方法"><a href="#zabbix有三种监控端口的监控项方法" class="headerlink" title="zabbix有三种监控端口的监控项方法"></a>zabbix有三种监控端口的监控项方法</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line">1.net.tcp.listen[port] </div><div class="line">用于监听端口是否开启 </div><div class="line">1表示开启 0表示未开启 </div><div class="line">2.net.tcp.port[,port] </div><div class="line">是否 可 以 </div><div class="line">连 接 到 指 </div><div class="line">定的 TCP </div><div class="line">端口 </div><div class="line">0 – 无法连接 </div><div class="line">1 – 可以连接 </div><div class="line">ip – IP 地址(默认是 127.0. </div><div class="line">0.1) </div><div class="line">port – 端口 </div><div class="line">范例: </div><div class="line">net.tcp.port[,80] </div><div class="line">检测 web 服务器端口是否运行中</div><div class="line">3.net.tcp.service[service,,] </div><div class="line">检 测 服 务 </div><div class="line">是否开启， </div><div class="line">并 且 端 口 </div><div class="line">可用 </div><div class="line">0 – 服务挂了 </div><div class="line">1 – 服务运行中 </div><div class="line">service – 如下: ssh, ntp, </div><div class="line">ldap, smtp, ftp, http, p </div><div class="line">op, nntp,imap, tcp, https, telnet </div><div class="line">ip – IP地址 (默认127.0.0. </div><div class="line">1) </div><div class="line">port – 端口 (默认情况为标 </div><div class="line">准端口号) </div><div class="line">示例 key: </div><div class="line">net.tcp.service[ftp,,45] – 检测 45 端口 </div><div class="line">上得 FTP 是否运行中 </div><div class="line">Zabbix 1.8.3 支持的版本请使用 service.n </div><div class="line">tp 代替 ntp. </div><div class="line">https 和 telnet 服务从 2.0 和 2.2 开始支持</div><div class="line"></div><div class="line">4.net.tcp.service.perf[service,,] </div><div class="line">检 测 服 务 </div><div class="line">器性能 </div><div class="line">0 – 服务挂了; </div><div class="line">seconds – 链接到 </div><div class="line">服务器端口消耗的时 </div><div class="line">间 </div><div class="line">service – 如下:ssh, ntp, </div><div class="line">ldap, smtp, ftp, http, po </div><div class="line">p, nntp,imap, tcp, https, </div><div class="line">telnet </div><div class="line">ip – IP地址 (默认127.0.0. </div><div class="line">1) </div><div class="line">port – 端口 (默认情况为标 </div><div class="line">准端口号)</div><div class="line">5.net.udp.listen[port] </div><div class="line">检测 UDP </div><div class="line">端 口 是 否 </div><div class="line">在监听 </div><div class="line">0 – 未监听 </div><div class="line">1 – 监听中 </div><div class="line">port – udp 端口 范例: </div><div class="line">net.udp.listen[68]</div></pre></td></tr></table></figure><h1 id="监控tomcat-8080端口"><a href="#监控tomcat-8080端口" class="headerlink" title="监控tomcat 8080端口"></a>监控tomcat 8080端口</h1><h2 id="添加监控项"><a href="#添加监控项" class="headerlink" title="添加监控项"></a>添加监控项</h2><p><img src="/images/2018/0417/01.png" alt="z"></p><h2 id="添加触发器"><a href="#添加触发器" class="headerlink" title="添加触发器"></a>添加触发器</h2><p><img src="/images/2018/0417/02.png" alt="z"></p><h2 id="添加图形"><a href="#添加图形" class="headerlink" title="添加图形"></a>添加图形</h2><p><img src="/images/2018/0417/03.png" alt="z"></p><p>参考链接：<a href="http://www.cnblogs.com/saneri/p/6126786.html" target="_blank" rel="external">http://www.cnblogs.com/saneri/p/6126786.html</a></p>]]></content>
      
      
      <categories>
          
          <category> 监控 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> zabbix </tag>
            
            <tag> 监控 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Centos6环境下搭建及破解confluence</title>
      <link href="/arlo/58cb2af9/"/>
      <url>/arlo/58cb2af9/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Confluence是一个专业的企业知识管理与协同软件，也可以用于构建企业wiki。使用简单，但它强大的编辑和站点管理特征能够帮助团队成员之间共享信息、文档协作、集体讨论，信息推送。【来自百度百科】</p></blockquote><a id="more"></a><p>我们只是需要一个知识库……<br>公司没有专门的知识库，企业wiki，团队的人资料文档都放在自己手里，你懂的？工作的文档一直都是svn提交，查看起来很不方便；长时间下来，没有技术共享、交流，积累；多方询问，别人推荐使用confluence，先搭建起来用用看。</p><h1 id="系统环境"><a href="#系统环境" class="headerlink" title="系统环境"></a>系统环境</h1><p>Centos 6.9<br>Jdk 1.8.112<br>Mysql 5.7.20<br>Atlassian-confluence-6.3.1</p><h1 id="安装jdk"><a href="#安装jdk" class="headerlink" title="安装jdk"></a>安装jdk</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">tar xf jdk-8u112-linux-x64.tar.gz -C /usr/local/</div><div class="line">-- 配置环境变量</div><div class="line">vim /etc/profile</div><div class="line">export JAVA_HOME=/usr/local/jdk1.8.0_112/</div><div class="line">export CLASSPATH=.:$JAVA_HOME/lib/:$JAVA_HOME/jre/lib/</div><div class="line">export PATH=$JAVA_HOME/bin:$PATH</div><div class="line">-- 使环境变量生效</div><div class="line">source /etc/profile</div></pre></td></tr></table></figure><h1 id="安装mysql"><a href="#安装mysql" class="headerlink" title="安装mysql"></a>安装mysql</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">wget https://mirrors.huaweicloud.com/repository/toolkit/mysql/Downloads/MySQL-5.7/mysql-5.7.20-1.el6.x86_64.rpm-bundle.tar</div><div class="line">tar xf mysql-5.7.20-1.el6.x86_64.rpm-bundle.tar </div><div class="line">yum localinstall mysql-community-common-5.7.20-1.el6.x86_64.rpm mysql-community-client-5.7.20-1.el6.x86_64.rpm mysql-community-server-5.7.20-1.el6.x86_64.rpm mysql-community-libs-compat-5.7.20-1.el6.x86_64.rpm mysql-community-libs-5.7.20-1.el6.x86_64.rpm mysql-community-devel-5.7.20-1.el6.x86_64.rpm</div><div class="line">-- 修改mysql参数</div><div class="line">vim /etc/my.cnf</div><div class="line">max_allowed_packet = 256M</div><div class="line">innodb_log_file_size=512M</div><div class="line">--启动mysqld服务</div><div class="line">/etc/init.d/mysqld start</div><div class="line">--查看初始密码</div><div class="line">grep &apos;temporary password&apos; /var/log/mysqld.log </div><div class="line">2018-04-03T02:44:31.357861Z 1 [Note] A temporary password is generated for root@localhost: OUGiG=n-l8lY</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">[root@3g3MplC6 ~]# mysql -uroot -pOUGiG=n-l8lY</div><div class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</div><div class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</div><div class="line">Your MySQL connection id is 12</div><div class="line">Server version: 5.7.20</div><div class="line"></div><div class="line">Copyright (c) 2000, 2017, Oracle and/or its affiliates. All rights reserved.</div><div class="line"></div><div class="line">Oracle is a registered trademark of Oracle Corporation and/or its</div><div class="line">affiliates. Other names may be trademarks of their respective</div><div class="line">owners.</div><div class="line"></div><div class="line">Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.</div><div class="line">--mysql5.7密码策略比较高，设置一下复杂度和长度</div><div class="line">mysql&gt; set global validate_password_policy=0;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; set global validate_password_length=1;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line">--修改一下root用户的密码为&apos;ffffff&apos;(生产环境不建议这么操作)</div><div class="line">mysql&gt; alter user root@localhost identified by &apos;ffffff&apos;;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line">--创建一个mysql数据库confluence，创建用户confluence，密码为confluencepwd</div><div class="line">mysql -uroot -p&apos;ffffff&apos; -e &quot;create database confluence default character set utf8 collate utf8_bin;grant  all on confluence.* to &apos;confluence&apos;@&apos;%&apos; identified by &apos;confluencepwd&apos;;&quot;</div></pre></td></tr></table></figure><h1 id="安装confluence"><a href="#安装confluence" class="headerlink" title="安装confluence"></a>安装confluence</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">wget https://www.atlassian.com/software/confluence/downloads/binary/atlassian-confluence-6.3.1-x64.bin</div><div class="line">数据库驱动包和破解补丁包: 链接: https://pan.baidu.com/s/1YfwGC2NDBVs3udsVb-i6fA 密码: ix7u</div><div class="line">chmod +x atlassian-confluence-6.3.1-x64.bin</div><div class="line">./atlassian-confluence-6.3.1-x64.bin</div><div class="line">/etc/init.d/confluence stop</div><div class="line">上传以下两个包到此目录下/opt/atlassian/confluence/confluence/WEB-INF/lib</div><div class="line">atlassian-extras-3.2.jar</div><div class="line">mysql-connector-java-5.1.42-bin.jar</div><div class="line">/etc/init.d/confluence start</div></pre></td></tr></table></figure><p>可以看到安装目录为<br>Installation Directory: /opt/atlassian/confluence<br>Home Directory: /var/atlassian/application-data/confluence<br>默认端口为8090<br><img src="/images/2018/0403/01.png" alt="confluence"></p><h1 id="配置confluence"><a href="#配置confluence" class="headerlink" title="配置confluence"></a>配置confluence</h1><p><a href="http://192.168.6.186:8090" target="_blank" rel="external">http://192.168.6.186:8090</a></p><h2 id="设置为中文语言"><a href="#设置为中文语言" class="headerlink" title="设置为中文语言"></a>设置为中文语言</h2><p><img src="/images/2018/0403/02.png" alt="confluence"></p><h2 id="产品安装"><a href="#产品安装" class="headerlink" title="产品安装"></a>产品安装</h2><p><img src="/images/2018/0403/03.png" alt="confluence"></p><h2 id="直接下一步"><a href="#直接下一步" class="headerlink" title="直接下一步"></a>直接下一步</h2><p><img src="/images/2018/0403/04.png" alt="confluence"></p><h2 id="复制服务器ID，点击获得授权码"><a href="#复制服务器ID，点击获得授权码" class="headerlink" title="复制服务器ID，点击获得授权码"></a>复制服务器ID，点击获得授权码</h2><p><img src="/images/2018/0403/05.png" alt="confluence"></p><h2 id="参考图片设置"><a href="#参考图片设置" class="headerlink" title="参考图片设置"></a>参考图片设置</h2><p><img src="/images/2018/0403/06.png" alt="confluence"><br><img src="/images/2018/0403/07.png" alt="confluence"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">服务器ID：</div><div class="line">BZ0A-OLZE-ZYYB-3PFX</div><div class="line">授权码：</div><div class="line">AAABLA0ODAoPeNptkF9rwjAUxd/zKQJ72PYQSaOiCIFp24FQragbU/aShesWqLHepKLffqmdzP15C</div><div class="line">ISce8753dwsK6DDEilvU84HXT4QEY2TJRU86pMEnEZTerOzMt7ZTVGB1UDvFoAHwPvXAU0PqqhUP</div><div class="line">UBihPMlUR5kbWe8w3ibBKNX2k/VFmTE+/2e6ImH/b6ld1uiQ2griOYA0mMFzcPCK/SAcqMKBxd/O</div><div class="line">lGm+BPw3X/lz4wG62B5KuHcGueTSTqPx8OMFI30DOhqjyAh1XqwKuyVHkuDpyv8bo2f47uyxjUdR</div><div class="line">3OrLGnWHydytOZDlmfrlK1XqxFrzx5fyCKdynBYFkWdnhC8S75wwnw2Tn5KZ9xptX0DzDdPLlBJF</div><div class="line">l0M//PMKtQfysHvb/4EqFmR3DAtAhUAjJ5DzWcXkYufaw72NYIZs/rFeJgCFEocDK77ZwHKpPhhI</div><div class="line">vo1bD3HDmJIX02f3</div></pre></td></tr></table></figure></p><p><img src="/images/2018/0403/08.png" alt="confluence"></p><h2 id="选择MySQL"><a href="#选择MySQL" class="headerlink" title="选择MySQL"></a>选择MySQL</h2><p><img src="/images/2018/0403/09.png" alt="confluence"></p><h2 id="选择JDBC"><a href="#选择JDBC" class="headerlink" title="选择JDBC"></a>选择JDBC</h2><p><img src="/images/2018/0403/10.png" alt="confluence"><br>根据下图显示，在数据库URL添加<code>?useSSL=false&amp;amp;useUnicode=true&amp;amp;characterEncoding=utf8</code><br><code>&amp;amp;是代替&amp;</code>，否则启动会报错，这里没有改的话，可以在/var/atlassian/application-data/confluence/confluence.cfg.xml文件中修改<br><img src="/images/2018/0403/11.png" alt="confluence"></p><h2 id="选择空白站点"><a href="#选择空白站点" class="headerlink" title="选择空白站点"></a>选择空白站点</h2><p><img src="/images/2018/0403/12.png" alt="confluence"></p><h2 id="在Confluence中管理用户与组"><a href="#在Confluence中管理用户与组" class="headerlink" title="在Confluence中管理用户与组"></a>在Confluence中管理用户与组</h2><p><img src="/images/2018/0403/13.png" alt="confluence"></p><h2 id="配置系统管理员账户"><a href="#配置系统管理员账户" class="headerlink" title="配置系统管理员账户"></a>配置系统管理员账户</h2><p><img src="/images/2018/0403/14.png" alt="confluence"></p><h2 id="配置完成"><a href="#配置完成" class="headerlink" title="配置完成"></a>配置完成</h2><p><img src="/images/2018/0403/15.png" alt="confluence"></p><h1 id="破解confluence"><a href="#破解confluence" class="headerlink" title="破解confluence"></a>破解confluence</h1><p>替换<code>/opt/atlassian/confluence/confluence/WEB-INF/lib/atlassian-extras-decoder-v2-3.2.jar</code>包，进行破解</p><p>参考链接:<br><a href="https://blog.csdn.net/wh211212/article/details/76131569" target="_blank" rel="external">https://blog.csdn.net/wh211212/article/details/76131569</a><br><a href="http://www.confluence.cn" target="_blank" rel="external">http://www.confluence.cn</a></p>]]></content>
      
      
      <categories>
          
          <category> 服务器搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> confluence </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Oracle RAC手动启动与关闭及常用命令</title>
      <link href="/arlo/d56aba68/"/>
      <url>/arlo/d56aba68/</url>
      
        <content type="html"><![CDATA[<p>在经历了几次服务器意外断电，启动rac报错；觉得之前直接“shutdown -h now”这种方式还是太“粗暴”，需要一种“温柔”的方式来操作她。</p><h1 id="查看一下RAC节点的服务状态"><a href="#查看一下RAC节点的服务状态" class="headerlink" title="查看一下RAC节点的服务状态"></a>查看一下RAC节点的服务状态</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">[grid@rac1 ~]$ crs_stat -t -v</div><div class="line">Name           Type           R/RA   F/FT   Target    State     Host        </div><div class="line">----------------------------------------------------------------------</div><div class="line">ora.DATA.dg    ora....up.type 0/5    0/     ONLINE    ONLINE    rac1        </div><div class="line">ora....ER.lsnr ora....er.type 0/5    0/     ONLINE    ONLINE    rac1        </div><div class="line">ora....N1.lsnr ora....er.type 0/5    0/0    ONLINE    ONLINE    rac1        </div><div class="line">ora.OCR.dg     ora....up.type 0/5    0/     ONLINE    ONLINE    rac1        </div><div class="line">ora....DISK.dg ora....up.type 0/5    0/     ONLINE    ONLINE    rac1        </div><div class="line">ora.asm        ora.asm.type   0/5    0/     ONLINE    ONLINE    rac1        </div><div class="line">ora.cvu        ora.cvu.type   0/5    0/0    ONLINE    ONLINE    rac1        </div><div class="line">ora.gsd        ora.gsd.type   0/5    0/     OFFLINE   OFFLINE               </div><div class="line">ora....network ora....rk.type 0/5    0/     ONLINE    ONLINE    rac1        </div><div class="line">ora.oc4j       ora.oc4j.type  0/1    0/2    ONLINE    ONLINE    rac2        </div><div class="line">ora.ons        ora.ons.type   0/3    0/     ONLINE    ONLINE    rac1        </div><div class="line">ora.orcl.db    ora....se.type 0/2    0/1    ONLINE    ONLINE    rac1        </div><div class="line">ora....SM1.asm application    0/5    0/0    ONLINE    ONLINE    rac1        </div><div class="line">ora....C1.lsnr application    0/5    0/0    ONLINE    ONLINE    rac1        </div><div class="line">ora.rac1.gsd   application    0/5    0/0    OFFLINE   OFFLINE               </div><div class="line">ora.rac1.ons   application    0/3    0/0    ONLINE    ONLINE    rac1        </div><div class="line">ora.rac1.vip   ora....t1.type 0/0    0/0    ONLINE    ONLINE    rac1        </div><div class="line">ora....SM2.asm application    0/5    0/0    ONLINE    ONLINE    rac2        </div><div class="line">ora....C2.lsnr application    0/5    0/0    OFFLINE   OFFLINE               </div><div class="line">ora.rac2.gsd   application    0/5    0/0    OFFLINE   OFFLINE               </div><div class="line">ora.rac2.ons   application    0/3    0/0    ONLINE    ONLINE    rac2        </div><div class="line">ora.rac2.vip   ora....t1.type 0/0    0/0    ONLINE    ONLINE    rac2        </div><div class="line">ora.scan1.vip  ora....ip.type 0/0    0/0    ONLINE    ONLINE    rac1        </div><div class="line">ora.sx21.db    ora....se.type 0/2    0/1    ONLINE    ONLINE    rac1</div></pre></td></tr></table></figure><a id="more"></a><h1 id="关闭RAC"><a href="#关闭RAC" class="headerlink" title="关闭RAC"></a>关闭RAC</h1><p>关闭顺序：关闭数据库(实例)–&gt;关闭ASM实例–&gt;关闭节点服务</p><h2 id="关闭数据库"><a href="#关闭数据库" class="headerlink" title="关闭数据库"></a>关闭数据库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">--关闭数据库</div><div class="line">srvctl stop database -d sx21</div><div class="line">srvctl stop database -d orcl</div></pre></td></tr></table></figure><h2 id="关闭ASM实例"><a href="#关闭ASM实例" class="headerlink" title="关闭ASM实例"></a>关闭ASM实例</h2><p>从11.2 Grid Infrastructure开始， ASM diskgroups也注册为CRS资源。而diskgroup资源是依赖于ASM的，所以不能首先要停止’ora.ASM.dg’这个服务，或者直接使用-f选项强制停止ASM。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">-- 查看asm磁盘相关信息</div><div class="line">sqlplus / as sysasm</div><div class="line">SQL&gt; select instance_name,status from v$instance;</div><div class="line">SQL&gt; col name format a10</div><div class="line">SQL&gt; set line 9999</div><div class="line">SQL&gt; col path format a15</div><div class="line">SQL&gt; select group_number,path,name,disk_number,total_mb,free_mb,create_date,mount_status,mount_date from v$asm_disk order by group_number desc,disk_number;</div><div class="line">SQL&gt; select name,state,free_mb,required_mirror_free_mb,usable_file_mb from v$asm_diskgroup;</div></pre></td></tr></table></figure></p><p><img src="/images/2018/0402/01.png" alt="rac"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">--关闭磁盘组， 状态从ONLINE变成OFFLINE</div><div class="line">srvctl stop diskgroup -g data</div><div class="line">srvctl stop diskgroup -g ocr</div><div class="line">srvctl stop diskgroup -g votingdisk</div></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">--关闭asm</div><div class="line">srvctl stop asm -n rac1</div><div class="line">srvctl stop asm -n rac2</div></pre></td></tr></table></figure><h2 id="关闭各节点的服务包括：listener、gsd、ons、vip"><a href="#关闭各节点的服务包括：listener、gsd、ons、vip" class="headerlink" title="关闭各节点的服务包括：listener、gsd、ons、vip"></a>关闭各节点的服务包括：listener、gsd、ons、vip</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">srvctl stop nodeapps -n rac1</div><div class="line">srvctl stop nodeapps -n rac2</div></pre></td></tr></table></figure><h1 id="启动RAC"><a href="#启动RAC" class="headerlink" title="启动RAC"></a>启动RAC</h1><p>启动顺序：启动节点服务–&gt;启动ASM实例–&gt;启动数据库实例</p><h2 id="启动各节点的服务包括：listener、gsd、ons、vip"><a href="#启动各节点的服务包括：listener、gsd、ons、vip" class="headerlink" title="启动各节点的服务包括：listener、gsd、ons、vip"></a>启动各节点的服务包括：listener、gsd、ons、vip</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">srvctl start nodeapps -n rac1</div><div class="line">srvctl start nodeapps -n rac2</div></pre></td></tr></table></figure><h2 id="启动asm"><a href="#启动asm" class="headerlink" title="启动asm"></a>启动asm</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">srvctl start asm -n rac1</div><div class="line">srvctl start asm -n rac2</div></pre></td></tr></table></figure><h2 id="启动数据库"><a href="#启动数据库" class="headerlink" title="启动数据库"></a>启动数据库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">srvctl start database -d sx21</div><div class="line">srvctl start database -d orcl</div></pre></td></tr></table></figure><h1 id="RAC常用操作命令"><a href="#RAC常用操作命令" class="headerlink" title="RAC常用操作命令"></a>RAC常用操作命令</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">--查看集群状态</div><div class="line">crsctl stat res -t</div><div class="line">crsctl check cluster -all</div><div class="line">crs_stat -t -v</div><div class="line">--查看数据库配置</div><div class="line">srvctl config database -d sx21</div><div class="line">--查看数据库状态</div><div class="line">srvctl status database -d sx21</div><div class="line">--启动数据库</div><div class="line">srvctl start database -d sx21</div><div class="line">--关闭数据库</div><div class="line">srvctl stop database -d sx21</div><div class="line"></div><div class="line">--查看asm状态</div><div class="line">srvctl status asm -n rac1</div><div class="line">srvctl status asm -n rac2</div><div class="line">--关闭asm 状态从ONLINE变成OFFLINE</div><div class="line">srvctl stop diskgroup -g data</div><div class="line">srvctl stop diskgroup -g ocr</div><div class="line">srvctl stop diskgroup -g votingdisk</div><div class="line">--开启asm </div><div class="line">srvctl start diskgroup -g data</div><div class="line">srvctl start diskgroup -g ocr</div><div class="line">srvctl start diskgroup -g votingdisk</div><div class="line"></div><div class="line">--查看vip状态</div><div class="line">srvctl status vip -n rac1 -v</div><div class="line">--启动vip</div><div class="line">srvctl start vip -n rac1 -v</div><div class="line">--停止vip</div><div class="line">srvctl stop vip -n rac2 -f -v</div><div class="line">srvctl stop vip -n rac1 -f -v</div><div class="line">-- 查看asm磁盘相关信息</div><div class="line">sqlplus / as sysasm</div><div class="line">SQL&gt; select instance_name,status from v$instance;</div><div class="line">SQL&gt; col name format a10</div><div class="line">SQL&gt; set line 9999</div><div class="line">SQL&gt; col path format a15</div><div class="line">SQL&gt; select group_number,path,name,disk_number,total_mb,free_mb,create_date,mount_status,mount_date from v$asm_disk order by group_number desc,disk_number;</div><div class="line">SQL&gt; select name,state,free_mb,required_mirror_free_mb,usable_file_mb from v$asm_diskgroup;</div><div class="line">---------------------------------------------------------</div><div class="line">以下操作需要使用root用户</div><div class="line">-- 单一节点启动</div><div class="line">crsctl start has</div><div class="line">crsctl start crs</div><div class="line">crsctl check crs</div><div class="line">-- 所有节点启动</div><div class="line">crsctl status cluster -n rac1 rac2</div><div class="line">crsctl start cluster -all</div><div class="line">crsctl check cluster -all</div></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>记录一次oracle rac数据库启动故障修复过程</title>
      <link href="/arlo/1b263496/"/>
      <url>/arlo/1b263496/</url>
      
        <content type="html"><![CDATA[<p>周末测试服务器意外断电关机了，早上启动起来机器，发现数据库起不来了，以下记录一下排查过程。<br>经过查看sx21和orcl两个数据库都是“Instance Shutdown”状态。<br><a id="more"></a></p><h1 id="查看rac启动状态"><a href="#查看rac启动状态" class="headerlink" title="查看rac启动状态"></a>查看rac启动状态</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">[grid@rac1 ~]$ crsctl stat res -t</div><div class="line">--------------------------------------------------------------------------------</div><div class="line">NAME           TARGET  STATE        SERVER                   STATE_DETAILS       </div><div class="line">--------------------------------------------------------------------------------</div><div class="line">Local Resources</div><div class="line">--------------------------------------------------------------------------------</div><div class="line">ora.DATA.dg</div><div class="line">               ONLINE  ONLINE       rac1                                         </div><div class="line">               ONLINE  ONLINE       rac2                                         </div><div class="line">ora.LISTENER.lsnr</div><div class="line">               ONLINE  ONLINE       rac1                                         </div><div class="line">               ONLINE  ONLINE       rac2                                         </div><div class="line">ora.OCR.dg</div><div class="line">               ONLINE  ONLINE       rac1                                         </div><div class="line">               ONLINE  ONLINE       rac2                                         </div><div class="line">ora.VOTINGDISK.dg</div><div class="line">               ONLINE  ONLINE       rac1                                         </div><div class="line">               ONLINE  ONLINE       rac2                                         </div><div class="line">ora.asm</div><div class="line">               ONLINE  ONLINE       rac1                     Started             </div><div class="line">               ONLINE  ONLINE       rac2                     Started             </div><div class="line">ora.gsd</div><div class="line">               OFFLINE OFFLINE      rac1                                         </div><div class="line">               OFFLINE OFFLINE      rac2                                         </div><div class="line">ora.net1.network</div><div class="line">               ONLINE  ONLINE       rac1                                         </div><div class="line">               ONLINE  ONLINE       rac2                                         </div><div class="line">ora.ons</div><div class="line">               ONLINE  ONLINE       rac1                                         </div><div class="line">               ONLINE  ONLINE       rac2                                         </div><div class="line">--------------------------------------------------------------------------------</div><div class="line">Cluster Resources</div><div class="line">--------------------------------------------------------------------------------</div><div class="line">ora.LISTENER_SCAN1.lsnr</div><div class="line">      1        ONLINE  ONLINE       rac1                                         </div><div class="line">ora.cvu</div><div class="line">      1        ONLINE  ONLINE       rac1                                         </div><div class="line">ora.oc4j</div><div class="line">      1        ONLINE  ONLINE       rac2                                         </div><div class="line">ora.orcl.db</div><div class="line">      1        ONLINE  OFFLINE                               Instance Shutdown   </div><div class="line">      2        ONLINE  OFFLINE                               Instance Shutdown   </div><div class="line">ora.rac1.vip</div><div class="line">      1        ONLINE  ONLINE       rac1                                         </div><div class="line">ora.rac2.vip</div><div class="line">      1        ONLINE  ONLINE       rac2                                         </div><div class="line">ora.scan1.vip</div><div class="line">      1        ONLINE  ONLINE       rac1                                         </div><div class="line">ora.sx21.db</div><div class="line">      1        ONLINE  OFFLINE                               Instance Shutdown   </div><div class="line">      2        ONLINE  OFFLINE                               Instance Shutdown</div></pre></td></tr></table></figure><h1 id="手动启动数据库"><a href="#手动启动数据库" class="headerlink" title="手动启动数据库"></a>手动启动数据库</h1><h2 id="手动启动sx21数据库报错"><a href="#手动启动sx21数据库报错" class="headerlink" title="手动启动sx21数据库报错"></a>手动启动sx21数据库报错</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[grid@rac1 ~]$ srvctl start database -d sx21</div><div class="line">PRCR-1079 : Failed to start resource ora.sx21.db</div><div class="line">CRS-5017: The resource action &quot;ora.sx21.db start&quot; encountered the following error: </div><div class="line">ORA-00600: internal error code, arguments: [kcratr_scan_lastbwr], [], [], [], [], [], [], [], [], [], [], []</div><div class="line">. For details refer to &quot;(:CLSN00107:)&quot; in &quot;/u01/app/11.2.0/grid/log/rac1/agent/crsd/oraagent_oracle/oraagent_oracle.log&quot;.</div><div class="line"></div><div class="line">CRS-5017: The resource action &quot;ora.sx21.db start&quot; encountered the following error: </div><div class="line">ORA-01157: cannot identify/lock data file 6 - see DBWR trace file</div><div class="line">ORA-01110: data file 6: &apos;/u01/app/oracle/11g/dbs/E:APPADMINISTRATORORADATASX21ALK.DBF&apos;</div><div class="line">. For details refer to &quot;(:CLSN00107:)&quot; in &quot;/u01/app/11.2.0/grid/log/rac2/agent/crsd/oraagent_oracle/oraagent_oracle.log&quot;.</div><div class="line"></div><div class="line">CRS-2674: Start of &apos;ora.sx21.db&apos; on &apos;rac1&apos; failed</div><div class="line">CRS-2674: Start of &apos;ora.sx21.db&apos; on &apos;rac2&apos; failed</div><div class="line">CRS-2632: There are no more servers to try to place resource &apos;ora.sx21.db&apos; on that would satisfy its placement policy</div></pre></td></tr></table></figure><h2 id="手动启动orcl数据库报错"><a href="#手动启动orcl数据库报错" class="headerlink" title="手动启动orcl数据库报错"></a>手动启动orcl数据库报错</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[grid@rac1 ~]$ srvctl start database -d orcl</div><div class="line">PRCC-1014 : orcl was already running</div><div class="line">PRCR-1004 : Resource ora.orcl.db is already running</div><div class="line">PRCR-1079 : Failed to start resource ora.orcl.db</div><div class="line">CRS-5017: The resource action &quot;ora.orcl.db start&quot; encountered the following error: </div><div class="line">ORA-01589: must use RESETLOGS or NORESETLOGS option for database open</div><div class="line">. For details refer to &quot;(:CLSN00107:)&quot; in &quot;/u01/app/11.2.0/grid/log/rac2/agent/crsd/oraagent_oracle/oraagent_oracle.log&quot;.</div><div class="line"></div><div class="line">CRS-2674: Start of &apos;ora.orcl.db&apos; on &apos;rac2&apos; failed</div><div class="line">CRS-2528: Unable to place an instance of &apos;ora.orcl.db&apos; as all possible servers are occupied by the resource</div></pre></td></tr></table></figure><h1 id="恢复数据库sx21"><a href="#恢复数据库sx21" class="headerlink" title="恢复数据库sx21"></a>恢复数据库sx21</h1><p>另外开一个窗口，连接sx21数据库；恢复数据库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">[root@rac1 ~]# su - oracle</div><div class="line">[oracle@rac1 ~]$ export ORACLE_SID=sx211</div><div class="line">[oracle@rac1 ~]$ sqlplus / as sysdba</div><div class="line"></div><div class="line">SQL*Plus: Release 11.2.0.4.0 Production on Mon Apr 2 09:43:52 2018</div><div class="line"></div><div class="line">Copyright (c) 1982, 2013, Oracle.  All rights reserved.</div><div class="line"></div><div class="line">Connected to an idle instance.</div><div class="line"></div><div class="line">SQL&gt; startup</div><div class="line">ORACLE instance started.</div><div class="line"></div><div class="line">Total System Global Area 2471931904 bytes</div><div class="line">Fixed Size    2255752 bytes</div><div class="line">Variable Size  687867000 bytes</div><div class="line">Database Buffers 1761607680 bytes</div><div class="line">Redo Buffers   20201472 bytes</div><div class="line">Database mounted.</div><div class="line">ORA-00600: internal error code, arguments: [kcratr_scan_lastbwr], [], [], [],</div><div class="line">[], [], [], [], [], [], [], []</div><div class="line"></div><div class="line"></div><div class="line">SQL&gt; select open_mode from v$database;</div><div class="line"></div><div class="line">OPEN_MODE</div><div class="line">--------------------</div><div class="line">MOUNTED</div><div class="line"></div><div class="line">SQL&gt; alter database open resetlogs;</div><div class="line">alter database open resetlogs</div><div class="line">*</div><div class="line">ERROR at line 1:</div><div class="line">ORA-01139: RESETLOGS option only valid after an incomplete database recovery</div><div class="line"></div><div class="line"></div><div class="line">SQL&gt; recover database;</div><div class="line">Media recovery complete.</div><div class="line">SQL&gt; alter database open;</div><div class="line"></div><div class="line">Database altered.</div></pre></td></tr></table></figure></p><h1 id="恢复数据库orcl"><a href="#恢复数据库orcl" class="headerlink" title="恢复数据库orcl"></a>恢复数据库orcl</h1><p>另外orcl实例，情况不太一样；直接恢复的话，会报错；需要我们手动指定恢复文件。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div></pre></td><td class="code"><pre><div class="line">[oracle@rac1 ~]$ export ORACLE_SID=orcl11</div><div class="line">[oracle@rac1 ~]$ sqlplus / as sysdba</div><div class="line"></div><div class="line">SQL*Plus: Release 11.2.0.4.0 Production on Mon Apr 2 09:51:24 2018</div><div class="line"></div><div class="line">Copyright (c) 1982, 2013, Oracle.  All rights reserved.</div><div class="line"></div><div class="line">Connected to an idle instance.</div><div class="line"></div><div class="line">SQL&gt; startup</div><div class="line">ORACLE instance started.</div><div class="line"></div><div class="line">Total System Global Area 2471931904 bytes</div><div class="line">Fixed Size    2255752 bytes</div><div class="line">Variable Size  687867000 bytes</div><div class="line">Database Buffers 1761607680 bytes</div><div class="line">Redo Buffers   20201472 bytes</div><div class="line">Database mounted.</div><div class="line">ORA-00600: internal error code, arguments: [kcratr_nab_less_than_odr], [1],</div><div class="line">[115], [49383], [49388], [], [], [], [], [], [], []</div><div class="line"></div><div class="line">-- 查看数据库模式</div><div class="line">SQL&gt; select open_mode from v$database;</div><div class="line"></div><div class="line">OPEN_MODE</div><div class="line">--------------------</div><div class="line">MOUNTED</div><div class="line">--此时数据库启动到mount状态，尝试以resetlogs方式open数据库，也无法打开</div><div class="line">SQL&gt;  alter database open resetlogs;        </div><div class="line"> alter database open resetlogs</div><div class="line">*</div><div class="line">ERROR at line 1:</div><div class="line">ORA-01139: RESETLOGS option only valid after an incomplete database recovery</div><div class="line"></div><div class="line"></div><div class="line">SQL&gt; recover database;</div><div class="line">ORA-00283: recovery session canceled due to errors</div><div class="line">ORA-00600: internal error code, arguments: [krr_read_5], [115], [49383], [],</div><div class="line">[], [], [], [], [], [], [], []</div><div class="line">--查看当前日志文件情况</div><div class="line">SQL&gt; select v1.group#, member, sequence#, first_change#  from v$log v1, v$logfile v2 where v1.group# = v2.group#;</div><div class="line"></div><div class="line">    GROUP#</div><div class="line">----------</div><div class="line">MEMBER</div><div class="line">--------------------------------------------------------------------------------</div><div class="line"> SEQUENCE# FIRST_CHANGE#</div><div class="line">---------- -------------</div><div class="line"> 1</div><div class="line">+DATA/orcl/onlinelog/group_1.261.970078827</div><div class="line">       115 4674751</div><div class="line"></div><div class="line"> 2</div><div class="line">+DATA/orcl/onlinelog/group_2.262.970078829</div><div class="line">       114 4622551</div><div class="line"></div><div class="line">    GROUP#</div><div class="line">----------</div><div class="line">MEMBER</div><div class="line">--------------------------------------------------------------------------------</div><div class="line"> SEQUENCE# FIRST_CHANGE#</div><div class="line">---------- -------------</div><div class="line"></div><div class="line"> 3</div><div class="line">+DATA/orcl/onlinelog/group_3.266.970078993</div><div class="line">65 4646182</div><div class="line"></div><div class="line"> 4</div><div class="line">+DATA/orcl/onlinelog/group_4.267.970078995</div><div class="line"></div><div class="line">    GROUP#</div><div class="line">----------</div><div class="line">MEMBER</div><div class="line">--------------------------------------------------------------------------------</div><div class="line"> SEQUENCE# FIRST_CHANGE#</div><div class="line">---------- -------------</div><div class="line">66 4688519</div><div class="line"></div><div class="line">SQL&gt; recover database using backup controlfile until cancel;</div><div class="line">ORA-00279: change 4674751 generated at 04/01/2018 15:33:57 needed for thread 1</div><div class="line">ORA-00289: suggestion : /u01/app/oracle/11g/dbs/arch1_115_970078828.dbf</div><div class="line">ORA-00280: change 4674751 for thread 1 is in sequence #115</div><div class="line">-- 记录住这里提示的change号和sqeuence号，去上边记录中查找文件名</div><div class="line"></div><div class="line">Specify log: &#123;&lt;RET&gt;=suggested | filename | AUTO | CANCEL&#125;</div><div class="line">+DATA/orcl/onlinelog/group_1.261.970078827</div><div class="line">-- 输入文件路径名称，进行恢复</div><div class="line">ORA-00279: change 4674751 generated at 04/01/2018 10:23:59 needed for thread 2</div><div class="line">ORA-00289: suggestion : /u01/app/oracle/11g/dbs/arch2_65_970078828.dbf</div><div class="line">ORA-00280: change 4674751 for thread 2 is in sequence #65</div><div class="line"></div><div class="line">Specify log: &#123;&lt;RET&gt;=suggested | filename | AUTO | CANCEL&#125;</div><div class="line">+DATA/orcl/onlinelog/group_3.266.970078993</div><div class="line">ORA-00279: change 4688519 generated at 04/01/2018 18:01:42 needed for thread 2</div><div class="line">ORA-00289: suggestion : /u01/app/oracle/11g/dbs/arch2_66_970078828.dbf</div><div class="line">ORA-00280: change 4688519 for thread 2 is in sequence #66</div><div class="line">ORA-00278: log file &apos;+DATA/orcl/onlinelog/group_3.266.970078993&apos; no longer</div><div class="line">needed for this recovery</div><div class="line"></div><div class="line"></div><div class="line">Specify log: &#123;&lt;RET&gt;=suggested | filename | AUTO | CANCEL&#125;</div><div class="line">+DATA/orcl/onlinelog/group_4.267.970078995</div><div class="line">Log applied.</div><div class="line">Media recovery complete.</div><div class="line">--恢复完成后，再次可以正常打开数据库，重启数据库正常。</div><div class="line">SQL&gt; alter database open resetlogs;</div><div class="line"></div><div class="line">Database altered.</div><div class="line"></div><div class="line">SQL&gt; select open_mode from v$database;</div><div class="line"></div><div class="line">OPEN_MODE</div><div class="line">--------------------</div><div class="line">READ WRITE</div></pre></td></tr></table></figure></p><p>参考链接：<br><a href="https://www.cnblogs.com/jionjionyou/p/5602019.html" target="_blank" rel="external">https://www.cnblogs.com/jionjionyou/p/5602019.html</a><br><a href="https://blog.csdn.net/linucle/article/details/8778046" target="_blank" rel="external">https://blog.csdn.net/linucle/article/details/8778046</a></p>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>使用wgrib2将GFS数据导入到mysql</title>
      <link href="/arlo/551cdbc9/"/>
      <url>/arlo/551cdbc9/</url>
      
        <content type="html"><![CDATA[<h1 id="GFS数据来源"><a href="#GFS数据来源" class="headerlink" title="GFS数据来源"></a>GFS数据来源</h1><blockquote><p>数据来源采自美国国家环境预报中心的GFS(全球预报系统)，该系统每天发布4次全球范围的气象数据，分辨率最高可达到0.25° x 0.25°，精度还是比较可观的。<br>GFS数据提供FTP下载方式：<a href="http://www.ftp.ncep.noaa.gov/data/nccf/com/gfs/prod/" target="_blank" rel="external">http://www.ftp.ncep.noaa.gov/data/nccf/com/gfs/prod/</a><br>每次发布的数据保存在命名为gfs.YYYYMMDDHH的文件夹中。本次需要的数据精度为0.25°（0p25），所以数据的文件名为：gfs.t{HH}z.pgrb2.0p25.f{XXX}<br>其中HH表示发布的时间，XXX表示未来几小时的预报数据。例如gfs.t00z.pgrb2.0p25.f001 表示0时发布的未来1小时气象数据信息。<br>那么问题来了，这个文件太大了，因为分辨率比较高，每个文件高达200多MB，不仅下载速度慢，处理慢，对存储空间也是一个考验。<br>于是找到了一个可以在线过滤要下载数据的地址：<br><a href="http://nomads.ncep.noaa.gov/cgi-bin/filter_gfs_0p25.pl" target="_blank" rel="external">http://nomads.ncep.noaa.gov/cgi-bin/filter_gfs_0p25.pl</a><br>这个网站允许用户仅下载过滤后的文件，并提供下载网址，这样文件就会小很多。<br>例如，在本项目中，仅需要下载降雨数据（PWAT），并且经纬度范围为特定区域，每次发布的数据全部下载下来也才8M多点。<br>那么要想获得GRIB文件中的数据，则需要用到一个软件wgrib2,，该软件在ncep网站上提供源码下载。</p></blockquote><a id="more"></a><h1 id="Mysql安装配置"><a href="#Mysql安装配置" class="headerlink" title="Mysql安装配置"></a>Mysql安装配置</h1><h2 id="查看mysql安装"><a href="#查看mysql安装" class="headerlink" title="查看mysql安装"></a>查看mysql安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@siluxa_oracle grib2]# rpm -qa |grep -i mysql</div><div class="line">mysql-community-common-5.6.36-2.el6.x86_64</div><div class="line">mysql-community-client-5.6.36-2.el6.x86_64</div><div class="line">mysql-community-server-5.6.36-2.el6.x86_64</div><div class="line">mysql-community-libs-compat-5.6.37-2.el6.x86_64</div><div class="line">mysql-community-libs-5.6.36-2.el6.x86_64</div><div class="line">mysql-community-devel-5.6.39-2.el6.x86_64</div></pre></td></tr></table></figure><h1 id="创建数据库和表"><a href="#创建数据库和表" class="headerlink" title="创建数据库和表"></a>创建数据库和表</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># 创建数据库</div><div class="line">CREATE DATABASE weatherDB DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;</div><div class="line"># 创建表</div><div class="line">create table wgrib2 (rt datetime, vt datetime, lat double, lon double, param varchar(80), level varchar(30), value double); </div><div class="line"># 创建用户和表，并赋予权限(实验环境可以直接用root，生产环境强烈建议使用普通用户)</div><div class="line">-- CREATE USER wgrib2 IDENTIFIED BY &apos;ffffff&apos;;</div><div class="line">-- GRANT ALL on weatherDB.* to wgrib2@&quot;%&quot; Identified by &quot;ffffff&quot;;</div></pre></td></tr></table></figure><h1 id="编译安装wgrib2软件包"><a href="#编译安装wgrib2软件包" class="headerlink" title="编译安装wgrib2软件包"></a>编译安装wgrib2软件包</h1><h2 id="编译安装wgrib2"><a href="#编译安装wgrib2" class="headerlink" title="编译安装wgrib2"></a>编译安装wgrib2</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#安装gcc和gfortran编译器</div><div class="line">yum install gcc gcc-gfortran -y</div><div class="line">#下载wgrib2软件包</div><div class="line">wget http://www.ftp.cpc.ncep.noaa.gov/wd51we/wgrib2/wgrib2.tgz -O  /usr/local/src/wgrib2.tgz</div><div class="line">cd /usr/local/src</div><div class="line">tar wgrib2.tgz</div><div class="line">cd grib2/</div><div class="line">#设置编译环境</div><div class="line">export CC=gcc</div><div class="line">export FC=gfortran</div><div class="line"># 启用mysql支持，修改第114行</div><div class="line">vim makefile  </div><div class="line">USE_MYSQL=1</div><div class="line"># 编译</div><div class="line">make</div></pre></td></tr></table></figure><h2 id="查看wgrib2配置"><a href="#查看wgrib2配置" class="headerlink" title="查看wgrib2配置"></a>查看wgrib2配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">[root@siluxa_oracle grib2]#cd wgrib2</div><div class="line">[root@siluxa_oracle grib2]# ./wgrib2 -config</div><div class="line">wgrib2 v0.2.0.7 12/2017  Wesley Ebisuzaki, Reinoud Bokhorst, John Howard, Jaakko Hyvätti, Dusan Jovic, Daniel Lee, Kristian Nilssen, Karl Pfeiffer, Pablo Romero, Manfred Schwarb, Gregor Schee, Arlindo da Silva, Niklas Sondell, Sam Trahan, Sergey Varlamov</div><div class="line">    stock build</div><div class="line"></div><div class="line">Compiled on 11:02:41 Mar 15 2018</div><div class="line"></div><div class="line">Netcdf package: &quot;3.6.3&quot; of Mar 15 2018 11:02:16 $ is installed</div><div class="line">libaec-1.0.2.tar.gz is installed</div><div class="line">Jasper 1.900.1 is installed</div><div class="line">mysql package is installed</div><div class="line">regex package is installed</div><div class="line">tigge package is installed</div><div class="line">IPOLATES iplib.v3.0.0 is installed, default vectors:</div><div class="line">    UGRD/VGRD VUCSH/VVCSH UFLX/VFLX UGUST/VGUST USTM/VSTM VDFUA/VDFVA MAXUW/MAXVW </div><div class="line">    UOGRD/VOGRD UICE/VICE U-GWD/V-GWD USSD/VSSD </div><div class="line">Geolocation library status (by search order)</div><div class="line">  gctpc geolocation is enabled</div><div class="line">  spherical geolocation is enabled</div><div class="line">UDF package is not installed</div><div class="line">version ftime=2</div><div class="line">maximum number of arguments on command line: 10000</div><div class="line">maximum number of -match,-not,-if, and -not_if options: 2000</div><div class="line">maximum number of -match_fs,-not_fs,-if_fs, and -not_if_fs options: 2000</div><div class="line">maximum number of -fgrep, -egrep, -fgrep_v, -egrep_v options: 200</div><div class="line">RPN registers: 0..19</div><div class="line">memory files: @mem:0, @mem:1 .. @mem:19</div><div class="line">stdout buffer length: 30000</div><div class="line">default decoding: g2clib emulation</div><div class="line">g2clib decoders are not installed</div><div class="line">Supported decoding: simple, complex, rle, ieee, png, jpeg2000, CCSDS AEC</div><div class="line">user gribtable: (none)</div><div class="line">C compiler: gcc (GCC) 4.4.7 20120313 (Red Hat 4.4.7-18)</div><div class="line">Fortran compiler: gfortran</div><div class="line">OpenMP: control number of threads with environment variable OMP_NUM_THREADS</div><div class="line">INT_MAX:   2147483647</div><div class="line">ULONG_MAX: 18446744073709551615</div></pre></td></tr></table></figure><h1 id="将gfs数据导入到mysql中"><a href="#将gfs数据导入到mysql中" class="headerlink" title="将gfs数据导入到mysql中"></a>将gfs数据导入到mysql中</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./wgrib2 /mnt/wgrib2/gfs_20180313_0000_0p25_240.240 -mysql 192.168.6.123 root ffffff weatherDB wgrib2</div></pre></td></tr></table></figure><p><img src="/images/2018/0315/01.png" alt="wgrib2"></p><h2 id="可以过滤性导入数据，格式为-if-“：”-后跟参数"><a href="#可以过滤性导入数据，格式为-if-“：”-后跟参数" class="headerlink" title="可以过滤性导入数据，格式为 -if “：” 后跟参数"></a>可以过滤性导入数据，格式为 -if “：” 后跟参数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#下边这条命令是将“10 m above ground”的数据导入到wind表中</div><div class="line">./wgrib2  /mnt/wgrib2/gfs.t00z.pgrb2.0p25.f000 -if &quot;:10 m above ground&quot; -mysql 192.168.6.123 root ffffff weatherDB wind</div></pre></td></tr></table></figure><h2 id="查看导入结果"><a href="#查看导入结果" class="headerlink" title="查看导入结果"></a>查看导入结果</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mysql -uroot -pffffff</div><div class="line">mysql&gt; use weatherDB;</div><div class="line">mysql&gt; select * from `weatherDB`.`wgrib2` limit 0, 20;</div></pre></td></tr></table></figure><p><img src="/images/2018/0315/02.png" alt="wgrib2"></p><h1 id="自动下载gfs数据，并导入mysql脚本"><a href="#自动下载gfs数据，并导入mysql脚本" class="headerlink" title="自动下载gfs数据，并导入mysql脚本"></a>自动下载gfs数据，并导入mysql脚本</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">[root@mysql gfs_data]# cat d_gfs00.sh </div><div class="line">#!/bin/bash</div><div class="line">v_time1=`date &quot;+%Y%m%d00&quot;`</div><div class="line">gfs_dir=/data/gfs_data/$v_time1</div><div class="line"># 0. 删除2天前的数据</div><div class="line">find /data/gfs_data/ -type d -mtime +2 -exec rm -fr &#123;&#125; \;</div><div class="line"># 1. 判断目录是否存在，如果不存在新建目录</div><div class="line">if [ ! -d &quot;$gfs_dir&quot; ];then</div><div class="line">    mkdir -p $gfs_dir</div><div class="line">Else</div><div class="line">    echo &quot;文件夹已经存在&quot;</div><div class="line">fi</div><div class="line"># 2. 判断目录下是否有文件</div><div class="line">filenum=`ls $gfs_dir |wc -l`</div><div class="line">if [ 9 -ne $filenum ];then</div><div class="line">    /usr/bin/perl /data/gfs_data/get_gfs.pl data $v_time1 0 24 3 all &apos;VGRD.10 m above ground|UGRD.10 m above ground&apos; $gfs_dir  &gt;/dev/null 2&gt;&amp;1</div><div class="line">else</div><div class="line">    echo &quot;文件已经下载&quot;</div><div class="line">fi</div><div class="line"># 3. 清空数据库</div><div class="line">mysql -uwgrib2 -pwg#123 -e &apos;truncate table weatherDB.wind&apos; </div><div class="line"># 4. 导入文件到数据库</div><div class="line"></div><div class="line">for file in $(ls $gfs_dir)</div><div class="line">do</div><div class="line">    /usr/local/grib2/wgrib2/wgrib2 $gfs_dir/$file -mysql localhost  wgrib2 &apos;wg#123&apos; weatherDB wind &gt;/dev/null 2&gt;&amp;1</div><div class="line">done</div></pre></td></tr></table></figure><p>ps：<br>如果是使用Mariadb数据的话，还需要安装<code>MariaDB-libs mysql-devel MariaDB-shared openssl-devel</code>依赖</p><p>参考链接：<br><a href="http://blog.csdn.net/pch1982cn/article/details/74292772" target="_blank" rel="external">http://blog.csdn.net/pch1982cn/article/details/74292772</a><br><a href="http://www.cpc.ncep.noaa.gov/products/wesley/wgrib2/index.html" target="_blank" rel="external">http://www.cpc.ncep.noaa.gov/products/wesley/wgrib2/index.html</a><br><a href="http://www.nco.ncep.noaa.gov/pmb/products/gfs/gfs.t00z.pgrb2f00.npoess.shtml" target="_blank" rel="external">http://www.nco.ncep.noaa.gov/pmb/products/gfs/gfs.t00z.pgrb2f00.npoess.shtml</a><br>数据下载地址:<br>ftp://ftpprd.ncep.noaa.gov/pub/data/nccf/com/gfs/prod/<br>在线过滤要下载数据的地址:<br><a href="http://nomads.ncep.noaa.gov" target="_blank" rel="external">http://nomads.ncep.noaa.gov</a></p>]]></content>
      
      
      <categories>
          
          <category> 大气模型 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
            <tag> wgrib2 </tag>
            
            <tag> GFS </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>安装rlwrap，使SqlPlus工具支持上下左右键</title>
      <link href="/arlo/d9547628/"/>
      <url>/arlo/d9547628/</url>
      
        <content type="html"><![CDATA[<p>SqlPlus 工具中默认不支持上下左右键调出历史命令，很不方便；需安装rlwrap。<br><a id="more"></a></p><h1 id="安装依赖包"><a href="#安装依赖包" class="headerlink" title="安装依赖包"></a>安装依赖包</h1><p><code>yum -y install gcc libtermcap-devel readline readline-devel</code></p><h1 id="获取安装文件"><a href="#获取安装文件" class="headerlink" title="获取安装文件"></a>获取安装文件</h1><p><code>wget https://fossies.org/linux/privat/rlwrap-0.43.tar.gz</code></p><h1 id="安装rlwrap"><a href="#安装rlwrap" class="headerlink" title="安装rlwrap"></a>安装rlwrap</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">tar xf rlwrap-0.43.tar.gz</div><div class="line">cd rlwrap-0.43/</div><div class="line">./configure &amp;&amp; make install</div></pre></td></tr></table></figure><h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">su - oracle</div><div class="line">vim .bash_profile</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">alias sqlplus=&apos;rlwrap sqlplus&apos;</div><div class="line">alias rman=&apos;rlwrap rman&apos;</div><div class="line">alias asmcmd=&apos;rlwrap asmcmd&apos;</div></pre></td></tr></table></figure><p><code>source .bash_profile</code></p><h1 id="扩展，设置sqlplus登录提示符"><a href="#扩展，设置sqlplus登录提示符" class="headerlink" title="扩展，设置sqlplus登录提示符"></a>扩展，设置sqlplus登录提示符</h1><p><code>vim $ORACLE_HOME/sqlplus/admin/glogin.sql</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">set linesize 120 pagesize 9999</div><div class="line">SET SQLPROMPT &quot;_USER&apos;@&apos;_CONNECT_IDENTIFIER&gt; &quot;</div></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 常识 </tag>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Sonar代码质量管理工具安装</title>
      <link href="/arlo/96c3f480/"/>
      <url>/arlo/96c3f480/</url>
      
        <content type="html"><![CDATA[<p>Sonar(SonarQube)是一款静态代码检查工具，采用B/S架构，帮助检查代码缺陷，改善代码质量，提高开发速度，通过插件形式，可以支持Java、C、C++、JavaScripe等等二十几种编程语言的代码质量管理与检测；通过客户端插件分析源代码，sonar客户端可以采用IDE插件、Sonar-Scanner插件、Ant插件和Maven插件方式，并通过各种不同的分析机制对项目源代码进行分析和扫描，并把分析扫描后的结果上传到sonar的数据库，通过sonar web界面对分析结果进行管理。<br><a id="more"></a><br>可以从七个维度检测代码质量:</p><ul><li>复杂度分布(complexity):代码复杂度过高将难以理解</li><li>重复代码(duplications):程序中包含大量复制、粘贴的代码而导致代码臃肿，sonar可以展示源码中重复严重的地方</li><li>单元测试统计(unit tests):统计并展示单元测试覆盖率，开发或测试可以清楚测试代码的覆盖情况</li><li>代码规则检查(coding rules):通过Findbugs,PMD,CheckStyle等检查代码是否符合规范</li><li>注释率(comments):若代码注释过少，特别是人员变动后，其他人接手比较难接手；若过多，又不利于阅读</li><li>潜在的Bug(potential bugs):通过Findbugs,PMD,CheckStyle等检测潜在的bug</li><li>结构与设计(architecture &amp; design):找出循环，展示包与包、类与类之间的依赖、检查程序之间耦合度<!--more--></li></ul><h1 id="系统环境"><a href="#系统环境" class="headerlink" title="系统环境"></a>系统环境</h1><p>操作系统： CentOS 7.x<br>Msql Server:   5.7.17<br>Java    ： JDK1.8<br>Sonar    ： sonarqube-6.7.1.zip<br>Sonar-scanner：sonar-scanner-cli-3.0.3.778-linux.zip</p><h1 id="服务器安装"><a href="#服务器安装" class="headerlink" title="服务器安装"></a>服务器安装</h1><h2 id="安装MySQL服务器"><a href="#安装MySQL服务器" class="headerlink" title="安装MySQL服务器"></a>安装MySQL服务器</h2><p><em>MariaDB 10.2在安装过程中检测为Mysql 5.5，不能满足需求</em><br><code>wget http://download.softagency.net/MySQL/Downloads/MySQL-5.7/mysql-5.7.17-1.el7.x86_64.rpm-bundle.tar</code><br><code>tar xf mysql-5.7.17-1.el7.x86_64.rpm-bundle.tar</code><br><code>yum localinstall mysql-community-server-5.7.17-1.el7.x86_64.rpm mysql-community-client-5.7.17-1.el7.x86_64.rpm  mysql-community-common-5.7.17-1.el7.x86_64.rpm mysql-community-client-5.7.17-1.el7.x86_64.rpm mysql-community-libs-5.7.17-1.el7.x86_64.rpm</code><br><code>vim /etc/my.cnf</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#[mysqld]下添加一行 </div><div class="line">innodb_buffer_pool_size = 128M</div><div class="line">max_allowed_packet = 128M</div></pre></td></tr></table></figure></p><p>启动mysql服务<br><code>systemctl start mysqld</code><br>初始化mysql服务<br><code>mysql_secure_installation</code><br>默认密码在日志中可以看到<br><img src="/images/2018/0202/01.png" alt="sonar"><br>创建sonar数据库和用户，并赋予权限<br><code>mysql -uroot -p&#39;mysql_root_password&#39;</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select version();</div><div class="line">mysql5.7密码强度比较高，我们做实验调整一下；设置一下复杂度和长度</div><div class="line">mysql&gt; set global validate_password_policy=0;</div><div class="line">mysql&gt; set global validate_password_length=1;</div><div class="line">mysql&gt; CREATE DATABASE `sonar` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;</div><div class="line">mysql&gt; CREATE USER &apos;sonar&apos;@&apos;%&apos; IDENTIFIED BY &apos;sonar&apos;;</div><div class="line">mysql&gt; GRANT ALL ON sonar.* TO &apos;sonar&apos;@&apos;%&apos;;</div><div class="line">mysql&gt; flush privileges;</div><div class="line">mysql -usonar -psonar -hlocalhost</div></pre></td></tr></table></figure></p><h2 id="安装JDK"><a href="#安装JDK" class="headerlink" title="安装JDK"></a>安装JDK</h2><p>下载地址：<a href="http://www.oracle.com/technetwork/java/archive-139210.html" target="_blank" rel="external">http://www.oracle.com/technetwork/java/archive-139210.html</a><br><code>tar xf jdk-8u112-linux-x64.tar.gz -C /usr/local/</code><br><code>vim /etc/profile</code><br>添加以下三行环境变量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">export JAVA_HOME=/usr/local/jdk1.8.0_112/</div><div class="line">export CLASSPATH=.:$JAVA_HOME/lib/:$JAVA_HOME/jre/lib/</div><div class="line">export PATH=$JAVA_HOME/bin:$PATH</div></pre></td></tr></table></figure></p><h2 id="安装sonar"><a href="#安装sonar" class="headerlink" title="安装sonar"></a>安装sonar</h2><h3 id="系统参数配置"><a href="#系统参数配置" class="headerlink" title="系统参数配置"></a>系统参数配置</h3><p>新建用户<br>sonar 不允许以root用户启动<br><code>useradd sonar</code><br><code>echo sonar|passwd --stdin sonar</code><br>修改内核参数<br><code>sysctl -w vm.max_map_count=262144</code><br><code>sysctl -w fs.file-max=65536</code><br>修改用户文件打开最大数<br><code>vim /etc/security/limits.conf</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sonar       hard    nofile           65536</div><div class="line">sonar       soft    nofile           65536</div></pre></td></tr></table></figure></p><h3 id="下载地址：https-www-sonarqube-org-downloads"><a href="#下载地址：https-www-sonarqube-org-downloads" class="headerlink" title="下载地址：https://www.sonarqube.org/downloads/"></a>下载地址：<a href="https://www.sonarqube.org/downloads/" target="_blank" rel="external">https://www.sonarqube.org/downloads/</a></h3><p><code>unzip sonarqube-6.7.1.zip -d /usr/local</code></p><h3 id="配置sonar"><a href="#配置sonar" class="headerlink" title="配置sonar"></a>配置sonar</h3><p><code>vim /usr/local/sonarqube-6.7.1/conf/sonar.properties</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">sonar.jdbc.username=sonar</div><div class="line">sonar.jdbc.password=sonar</div><div class="line">sonar.jdbc.url=jdbc:mysql://localhost:3306/sonar?useUnicode=true&amp;characterEncoding=utf8&amp;rewriteBatchedStatements=true&amp;useConfigs=maxPerformance&amp;useSSL=false</div><div class="line">sonar.web.host=0.0.0.0</div><div class="line">sonar.web.context=/sonar</div><div class="line">sonar.web.port=9000</div></pre></td></tr></table></figure></p><p><code>vim /usr/local/sonarqube-6.7.1/conf/wrapper.conf</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wrapper.java.command=/usr/local/jdk1.8.0_112/bin/java</div></pre></td></tr></table></figure></p><p><code>chown sonar.sonar /usr/local/sonarqube-6.7.1 -R</code><br>切换至sonar用户下<br><code>su - sonar</code><br>可以将此路径加入到环境变量中<br><code>cd /usr/local/sonarqube-6.7.1/bin/linux-x86-64</code><br><code>./sonar.sh start</code><br>可以监控/usr/local/sonarqube-6.7.1/logs目录下的log,第一次启动时间会长一些，因为要给数据库建表<br><code>访问地址http://192.168.6.178:9000/sonar/</code><br>默认用户名/密码:   admin/admin<br><img src="/images/2018/0202/02.png" alt="jenkins"><br>安装一个中文插件，安装完成后重启<br><img src="/images/2018/0202/03.png" alt="jenkins"><br><img src="/images/2018/0202/04.png" alt="jenkins"></p><h3 id="开启SCM"><a href="#开启SCM" class="headerlink" title="开启SCM"></a>开启SCM</h3><p><img src="/images/2018/0202/13.png" alt="jenkins"></p><h1 id="客户端SonarQube-Scanner安装"><a href="#客户端SonarQube-Scanner安装" class="headerlink" title="客户端SonarQube Scanner安装"></a>客户端SonarQube Scanner安装</h1><p>下载地址<a href="https://docs.sonarqube.org/display/SCAN/Analyzing+with+SonarQube+Scanner" target="_blank" rel="external">https://docs.sonarqube.org/display/SCAN/Analyzing+with+SonarQube+Scanner</a><br>SonarQube Scanner作为客户端，放在一个可以读取代码的位置即可，可以和SonarQube 服务端放在一台机器上，也可以分开部署；</p><h2 id="配置sonarqube-scanner"><a href="#配置sonarqube-scanner" class="headerlink" title="配置sonarqube scanner"></a>配置sonarqube scanner</h2><p>我这里部署在本地windows系统上，将D:\Program Files (x86)\sonar-scanner-3.0.3.778-windows\bin加入到环境变量PATH中<br>编辑D:\Program Files (x86)\sonar-scanner-3.0.3.778-windows\conf\sonar-scanner.properties配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">#Configure here general information about the environment, such as SonarQube DB details for example</div><div class="line">#No information about specific project should appear here</div><div class="line">#----- Default SonarQube server</div><div class="line">sonar.host.url=http://192.168.6.178:9000/sonar</div><div class="line">sonar.jdbc.username=sonar</div><div class="line">sonar.jdbc.password=sonar</div><div class="line">sonar.jdbc.url=jdbc:mysql://192.168.6.178:3306/sonar?useUnicode=true&amp;characterEncoding=utf8&amp;rewriteBatchedStatements=true&amp;useConfigs=maxPerformance&amp;useSSL=false</div><div class="line">#----- Default source code encoding</div><div class="line">sonar.sourceEncoding=UTF-8</div></pre></td></tr></table></figure></p><h2 id="配置项目"><a href="#配置项目" class="headerlink" title="配置项目"></a>配置项目</h2><p>在项目代码根目录下新建一个sonar-project.properties文件,内容如下<br><code>sonar.projectKey和sonar.projectName自己定义即可。</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"># must be unique in a given SonarQube instance</div><div class="line">sonar.projectKey=silu</div><div class="line"># this is the name and version displayed in the SonarQube UI. Was mandatory prior to SonarQube 6.1.</div><div class="line">sonar.projectName=sxapp</div><div class="line">sonar.projectVersion=1.0</div><div class="line"> </div><div class="line"># Path is relative to the sonar-project.properties file. Replace &quot;\&quot; by &quot;/&quot; on Windows.</div><div class="line"># This property is optional if sonar.modules is set. </div><div class="line">sonar.sources=.</div><div class="line">sonar.language=java</div><div class="line"># Encoding of the source code. Default is default system encoding</div><div class="line">sonar.sourceEncoding=UTF-8</div></pre></td></tr></table></figure></p><h1 id="客户端SonarQube-Scanner使用"><a href="#客户端SonarQube-Scanner使用" class="headerlink" title="客户端SonarQube Scanner使用"></a>客户端SonarQube Scanner使用</h1><h2 id="用SonarQube-Scanner分析"><a href="#用SonarQube-Scanner分析" class="headerlink" title="用SonarQube Scanner分析"></a>用SonarQube Scanner分析</h2><p>在项目根目录下执行sonar-scanner即可开始代码监测<br><img src="/images/2018/0202/06.png" alt="jenkins"><br>在web页面上刷新一下就看到看到结果了<br><img src="/images/2018/0202/07.png" alt="jenkins"><br><strong>Q:</strong>Please provide compiled classes of your project with sonar.java.binaries property<br><img src="/images/2018/0202/05.png" alt="jenkins"><br><strong>A:</strong>这是因为sonar-java插件太新了，可以下载一个旧版本的插件进行替换<br><a href="https://sonarsource.bintray.com/Distribution/sonar-java-plugin/sonar-java-plugin-4.10.0.10260.jar" target="_blank" rel="external">https://sonarsource.bintray.com/Distribution/sonar-java-plugin/sonar-java-plugin-4.10.0.10260.jar</a><br>下载完成后拷贝到C:\Users\nsxq.sonar\cache\2936e4ebd1e34b1646a3b66a51d30af7\ （类似这个）目录下，<br>并修改名称为sonar-java-plugin-4.15.0.12310.jar(不要问我为什么要改成这个版本号，因为运行sonar-scanner提示是这个版本号)</p><h2 id="用Maven调用SonarQube-Scanner分析"><a href="#用Maven调用SonarQube-Scanner分析" class="headerlink" title="用Maven调用SonarQube Scanner分析"></a>用Maven调用SonarQube Scanner分析</h2><h3 id="安装maven3"><a href="#安装maven3" class="headerlink" title="安装maven3"></a>安装maven3</h3><p>下载地址<a href="http://apache.mirrors.lucidnetworks.net/maven/maven-3/" target="_blank" rel="external">http://apache.mirrors.lucidnetworks.net/maven/maven-3/</a><br>下载完成解压后，配置环境变量，验证<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mvn --version</div><div class="line">Apache Maven 3.3.9 (bb52d8502b132ec0a5a3f4c09453c07478323dc5; 2015-11-11T00:41:47+08:00)</div><div class="line">Maven home: D:\Program Files (x86)\apache-maven-3.3.9-bin\apache-maven-3.3.9\bin\..</div><div class="line">Java version: 1.8.0_141, vendor: Oracle Corporation</div><div class="line">Java home: C:\Program Files\Java\jdk1.8.0_141\jre</div><div class="line">Default locale: zh_CN, platform encoding: GBK</div><div class="line">OS name: &quot;windows 10&quot;, version: &quot;10.0&quot;, arch: &quot;amd64&quot;, family: &quot;dos&quot;</div></pre></td></tr></table></figure></p><h3 id="配置maven全局设置settings-xml"><a href="#配置maven全局设置settings-xml" class="headerlink" title="配置maven全局设置settings.xml"></a>配置maven全局设置settings.xml</h3><p>添加以下配置到本来的settings.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&lt;settings&gt;</div><div class="line">    &lt;pluginGroups&gt;</div><div class="line">        &lt;pluginGroup&gt;org.sonarsource.scanner.maven&lt;/pluginGroup&gt;</div><div class="line">    &lt;/pluginGroups&gt;</div><div class="line">    &lt;profiles&gt;</div><div class="line">        &lt;profile&gt;</div><div class="line">            &lt;id&gt;sonar&lt;/id&gt;</div><div class="line">            &lt;activation&gt;</div><div class="line">                &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;</div><div class="line">            &lt;/activation&gt;</div><div class="line">            &lt;properties&gt;</div><div class="line">                &lt;!-- Optional URL to server. Default value is http://localhost:9000 --&gt;</div><div class="line">                &lt;sonar.host.url&gt;</div><div class="line">                  http://myserver:9000</div><div class="line">                &lt;/sonar.host.url&gt;</div><div class="line">            &lt;/properties&gt;</div><div class="line">        &lt;/profile&gt;</div><div class="line">     &lt;/profiles&gt;</div><div class="line">&lt;/settings&gt;</div></pre></td></tr></table></figure></p><p>添加完成后，我的配置文件如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line">&lt;settings</div><div class="line">xsi:schemaLocation=&quot;http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd&quot;</div><div class="line">xmlns=&quot;http://maven.apache.org/SETTINGS/1.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt;</div><div class="line">&lt;localRepository&gt;C:\Users\nsxq\.m2\repository\&lt;/localRepository&gt;</div><div class="line">&lt;pluginGroups&gt;</div><div class="line">        &lt;pluginGroup&gt;org.sonarsource.scanner.maven&lt;/pluginGroup&gt;</div><div class="line">    &lt;/pluginGroups&gt;</div><div class="line">&lt;servers&gt;</div><div class="line">&lt;server&gt;</div><div class="line">&lt;username&gt;test&lt;/username&gt;</div><div class="line">&lt;password&gt;test&lt;/password&gt;</div><div class="line">&lt;id&gt;THSArtifactory&lt;/id&gt;</div><div class="line">&lt;/server&gt;</div><div class="line">&lt;/servers&gt;</div><div class="line">&lt;mirrors&gt;</div><div class="line">&lt;mirror&gt;</div><div class="line">&lt;mirrorOf&gt;*&lt;/mirrorOf&gt;</div><div class="line">&lt;name&gt;ths-repos&lt;/name&gt;</div><div class="line">&lt;url&gt;http://192.168.0.45/artifactory/ths-repos&lt;/url&gt;</div><div class="line">&lt;id&gt;THSArtifactory&lt;/id&gt;</div><div class="line">&lt;/mirror&gt;</div><div class="line">&lt;mirror&gt;</div><div class="line">       &lt;id&gt;alimaven&lt;/id&gt;</div><div class="line">      &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;</div><div class="line">      &lt;name&gt;aliyun maven&lt;/name&gt;</div><div class="line">       &lt;url&gt;http://maven.aliyun.com/nexus/content/repositories/central/&lt;/url&gt;</div><div class="line">   &lt;/mirror&gt;</div><div class="line">&lt;/mirrors&gt;</div><div class="line">&lt;profiles&gt;</div><div class="line">&lt;profile&gt;</div><div class="line">&lt;repositories&gt;</div><div class="line">&lt;repository&gt;</div><div class="line">&lt;snapshots&gt;</div><div class="line">&lt;enabled&gt;false&lt;/enabled&gt;</div><div class="line">&lt;/snapshots&gt;</div><div class="line">&lt;id&gt;central&lt;/id&gt;</div><div class="line">&lt;name&gt;ths-repos&lt;/name&gt;</div><div class="line">&lt;url&gt;http://192.168.0.45/artifactory/ths-repos&lt;/url&gt;</div><div class="line">&lt;/repository&gt;</div><div class="line">&lt;repository&gt;</div><div class="line">&lt;snapshots /&gt;</div><div class="line">&lt;id&gt;snapshots&lt;/id&gt;</div><div class="line">&lt;name&gt;ths-repos&lt;/name&gt;</div><div class="line">&lt;url&gt;http://192.168.0.45/artifactory/ths-repos&lt;/url&gt;</div><div class="line">&lt;/repository&gt;</div><div class="line">&lt;/repositories&gt;</div><div class="line">&lt;pluginRepositories&gt;</div><div class="line">&lt;pluginRepository&gt;</div><div class="line">&lt;snapshots&gt;</div><div class="line">&lt;enabled&gt;false&lt;/enabled&gt;</div><div class="line">&lt;/snapshots&gt;</div><div class="line">&lt;id&gt;central&lt;/id&gt;</div><div class="line">&lt;name&gt;ths-repos&lt;/name&gt;</div><div class="line">&lt;url&gt;http://192.168.0.45/artifactory/ths-repos&lt;/url&gt;</div><div class="line">&lt;/pluginRepository&gt;</div><div class="line">&lt;pluginRepository&gt;</div><div class="line">&lt;snapshots /&gt;</div><div class="line">&lt;id&gt;snapshots&lt;/id&gt;</div><div class="line">&lt;name&gt;ths-repos&lt;/name&gt;</div><div class="line">&lt;url&gt;http://192.168.0.45/artifactory/ths-repos&lt;/url&gt;</div><div class="line">&lt;/pluginRepository&gt;</div><div class="line">&lt;/pluginRepositories&gt;</div><div class="line">&lt;id&gt;artifactory&lt;/id&gt;</div><div class="line">&lt;/profile&gt;</div><div class="line">        &lt;profile&gt;</div><div class="line">            &lt;id&gt;sonar&lt;/id&gt;</div><div class="line">            &lt;activation&gt;</div><div class="line">                &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;</div><div class="line">            &lt;/activation&gt;</div><div class="line">            &lt;properties&gt;</div><div class="line">                &lt;!-- Optional URL to server. Default value is http://localhost:9000 --&gt;</div><div class="line">                &lt;sonar.host.url&gt;</div><div class="line">                  http://192.168.6.178:9000/sonar</div><div class="line">                &lt;/sonar.host.url&gt;</div><div class="line">            &lt;/properties&gt;</div><div class="line">        &lt;/profile&gt;</div><div class="line">&lt;/profiles&gt;</div><div class="line">&lt;activeProfiles&gt;</div><div class="line">&lt;activeProfile&gt;artifactory&lt;/activeProfile&gt;</div><div class="line">&lt;/activeProfiles&gt;</div><div class="line">&lt;/settings&gt;</div></pre></td></tr></table></figure></p><h3 id="测试maven项目"><a href="#测试maven项目" class="headerlink" title="测试maven项目"></a>测试maven项目</h3><p>下载一个maven测试项目代码<br><code>git clone https://github.com/SonarSource/sonar-scanning-examples.git</code><br><code>cd D:\sonar-scanning-examples\sonarqube-scanner-maven</code><br><code>mvn clean install sonar:sonar</code><br><img src="/images/2018/0202/08.png" alt="jenkins"><br>web页面查看<br><img src="/images/2018/0202/09.png" alt="jenkins"></p><h2 id="用Jenkins调用SonarQube-Scanner分析"><a href="#用Jenkins调用SonarQube-Scanner分析" class="headerlink" title="用Jenkins调用SonarQube Scanner分析"></a>用Jenkins调用SonarQube Scanner分析</h2><h3 id="安装sonarqube插件"><a href="#安装sonarqube插件" class="headerlink" title="安装sonarqube插件"></a>安装sonarqube插件</h3><p>系统管理–&gt;管理插件–&gt;可选插件<br>SonarQube Scanner for Jenkins<br>Mashup Portlets</p><h3 id="配置SonarQube-servers"><a href="#配置SonarQube-servers" class="headerlink" title="配置SonarQube servers"></a>配置SonarQube servers</h3><p>系统管理–&gt;系统配置–&gt;SonarQube servers<br><img src="/images/2018/0202/10.png" alt="jenkins"><br>系统管理–&gt;全局工具配置–&gt;SonarQube Scanner<br><img src="/images/2018/0202/11.png" alt="jenkins"><br>JOB配置<br><img src="/images/2018/0202/14.png" alt="jenkins"><br><img src="/images/2018/0202/15.png" alt="jenkins"><br>key,name,version三个字段是自定义的，sources路径是当前路径的话，用.表示就可以了；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">sonar.projectKey=ths.project</div><div class="line">sonar.projectName=AirForcast</div><div class="line">sonar.projectVersion=1.0</div><div class="line">sonar.language=java</div><div class="line">sonar.java.binaries=./target/test-classes/ </div><div class="line">sonar.sources=.</div></pre></td></tr></table></figure></p><p><img src="/images/2018/0202/16.png" alt="jenkins"><br><img src="/images/2018/0202/17.png" alt="jenkins"><br>点击查看监测结果！</p><h1 id="其他问题"><a href="#其他问题" class="headerlink" title="其他问题"></a>其他问题</h1><p><strong>Q1：</strong><br>ERROR web[][o.s.s.p.Platform] Web server startup failed: Unsupported mysql version: 5.5. Minimal supported version is 5.6.<br><strong>A1:</strong><br>不要使用mariadb，mariadb10.2检测到是mysql5.5<br><strong>Q2:</strong><br>Native memory allocation (mmap) failed to map 42467328 bytes for committing reserved memory.<br><strong>A2:</strong><br>1.将虚拟机内存调整大，调整到4Gb；<br>2.保证swap空间正常（我安装操作系统的时候没有设置swap分区，折腾了好一会儿）；<br>3.修改此文件中的/usr/local/sonarqube-6.7.1/elasticsearch/config/jvm.options     -Xms512m -Xmx512m<br><strong>Q3:</strong><br>mvn clean install sonar:sonar 上传分析数据时候报错。可以查看sonar日志web.log相关报错“Failed to upload report - 500: An error has occurred. Please contact your administrator”<br><img src="/images/2018/0202/12.png" alt="jenkins"><br><strong>A3:</strong><br>1.修改mysqld参数max_allowed_packet = 128M<br>2.重启mysqld服务<br>3.重启sonarqube服务（一定要重启）</p><p>参考链接：<br><a href="https://docs.sonarqube.org/display/SONAR/Installing+the+Server" target="_blank" rel="external">https://docs.sonarqube.org/display/SONAR/Installing+the+Server</a><br><a href="https://docs.sonarqube.org/display/SCAN/Analyzing+with+SonarQube+Scanner" target="_blank" rel="external">https://docs.sonarqube.org/display/SCAN/Analyzing+with+SonarQube+Scanner</a><br><a href="https://my.oschina.net/zxcholmes/blog/1529732" target="_blank" rel="external">https://my.oschina.net/zxcholmes/blog/1529732</a><br><a href="https://www.ibm.com/developerworks/cn/devops/1612_qusm_jenkins/index.html" target="_blank" rel="external">https://www.ibm.com/developerworks/cn/devops/1612_qusm_jenkins/index.html</a></p>]]></content>
      
      
      <categories>
          
          <category> 自动化运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 运维 </tag>
            
            <tag> 自动化 </tag>
            
            <tag> Sonar </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Bginfo--Windows系统信息显示工具</title>
      <link href="/arlo/ea6f862b/"/>
      <url>/arlo/ea6f862b/</url>
      
        <content type="html"><![CDATA[<p>经常维护多台Windows服务器，在服务器之间来回切换，经常容易搞混，为大家推荐一个维护利器BGinfo。<br><a id="more"></a></p><h1 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h1><p>下载地址：<a href="https://download.sysinternals.com/files/BGInfo.zip" target="_blank" rel="external">https://download.sysinternals.com/files/BGInfo.zip</a><br>下载、解压完成后，双击Bginfo64,同意即可价值默认信息；这里是我觉得平时会用到的参数信息。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">主机名称:&lt;Host Name&gt;</div><div class="line">系统版本:&lt;OS Version&gt;</div><div class="line">服务补丁包:&lt;Service Pack&gt;</div><div class="line">系统启动时间:&lt;Boot Time&gt;</div><div class="line">当前用户名:&lt;User Name&gt;</div><div class="line">------------------------------</div><div class="line">CPU:&lt;CPU&gt;</div><div class="line">内存:&lt;Memory&gt;</div><div class="line">磁盘可用空间:&lt;Free Space&gt;</div><div class="line">------------------------------</div><div class="line">IP Address:&lt;IP Address&gt;</div><div class="line">MAC Address:&lt;MAC Address&gt;</div><div class="line">Subnet Mask:&lt;Subnet Mask&gt;</div><div class="line">Default Gateway:&lt;Default Gateway&gt;</div><div class="line">DNS Server:&lt;DNS Server&gt;</div></pre></td></tr></table></figure></p><p>点击file-save as 保存D:\BGInfo为名为systeminfo.cgi<br><img src="/images/2018/0122/01.png" alt="bginfo"><br>Background：可以定义直接在当前壁纸上显示、指定一个壁纸路径或纯色显示。<br>Position：可配置信息输出位置（9个选项）以及多显示器输出支持<em>(偏爱右上)</em><br>Desktops：用于配置用户远程登录、控制台登录时的显示方式<br>Preview：预览配置效果<br><img src="/images/2018/0122/02.png" alt="bginfo"></p><h1 id="配置开机启动"><a href="#配置开机启动" class="headerlink" title="配置开机启动"></a>配置开机启动</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">1. </div><div class="line">在windows资源管理器输入shell:startup 快速打开当前用户的「启动」文件夹</div><div class="line">2. </div><div class="line">新建一个.bat文件，内容为D:\BGInfo\Bginfo64.exe systeminfo.bgi /timer:0 /nolicprompt /silent</div></pre></td></tr></table></figure><p>PS:</p><ol><li>此工具很方便，但是不能根据系统信息，自行刷新，可以添加计划任务进行刷新。</li><li>此工具大规模部署建议使用域环境操作。</li></ol><p>参考链接：<br><a href="https://docs.microsoft.com/en-us/sysinternals/downloads/bginfo" target="_blank" rel="external">https://docs.microsoft.com/en-us/sysinternals/downloads/bginfo</a><br><a href="https://www.sysgeek.cn/bginfo/" target="_blank" rel="external">https://www.sysgeek.cn/bginfo/</a></p>]]></content>
      
      
      <categories>
          
          <category> 常识 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> bginfo </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>部署office在线预览服务器(Office Web Apps Server)</title>
      <link href="/arlo/5b552504/"/>
      <url>/arlo/5b552504/</url>
      
        <content type="html"><![CDATA[<p>Office Web Apps Server 是一种 Office 服务器产品，可提供在浏览器中查看和编辑 Office 文件的服务。可提供浏览器版 Word、PowerPoint、Excel 和 OneNote。<br><a id="more"></a></p><h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><p>网络环境<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">服务器名ip地址</div><div class="line">dc.islocal.cc192.168.6.111</div><div class="line">apps.islocal.cc192.168.6.112</div></pre></td></tr></table></figure></p><p>软件环境<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">操作系统Windows Server 2012 R2 Standard</div><div class="line">.NET Framework 4.5.2</div><div class="line">Office Web Apps Servercn_office_web_apps_server_2013_with_sp1_x64_dvd_3832995.iso</div><div class="line">Office Web Apps Server SP1wacserversp2013-kb2880558-fullfile-x64-glb.exe</div><div class="line">语言包wacserverlanguagepack.exe</div></pre></td></tr></table></figure></p><h1 id="规划-Office-Web-Apps-Server"><a href="#规划-Office-Web-Apps-Server" class="headerlink" title="规划 Office Web Apps Server"></a>规划 Office Web Apps Server</h1><h2 id="Office-Web-Apps-Server-支持的操作系统"><a href="#Office-Web-Apps-Server-支持的操作系统" class="headerlink" title="Office Web Apps Server 支持的操作系统"></a>Office Web Apps Server 支持的操作系统</h2><p>您可以在以下操作系统上运行 Office Web Apps Server：</p><blockquote><p>安装了 Windows Server 2008 R2 x64 版本更新的 64 位版本 Windows Server 2008 R2 Service Pack 1 (SP1) Standard、Enterprise 或 Datacenter<br>Windows Server 2012 Standard 或 Datacenter 的 64 位版本<br>64 位版本的 Windows Server 2012 R2。若要使用此操作系统，则必须使用 Office Web Apps Server Service Pack 1 (SP1)。</p></blockquote><h2 id="Office-Web-Apps-Server-的域要求"><a href="#Office-Web-Apps-Server-的域要求" class="headerlink" title="Office Web Apps Server 的域要求"></a>Office Web Apps Server 的域要求</h2><p>Office Web Apps Server 场中的服务器都必须是域的一部分。它们可以在同一个域 （推荐） 中或位于同一个林中的不同域中。但是，如果您尝试在域控制器上安装它，Office Web Apps Server 将不起作用。</p><h2 id="Office-Web-Apps-Server-需要的服务器角色、服务及其他软件"><a href="#Office-Web-Apps-Server-需要的服务器角色、服务及其他软件" class="headerlink" title="Office Web Apps Server 需要的服务器角色、服务及其他软件"></a>Office Web Apps Server 需要的服务器角色、服务及其他软件</h2><p>首先，以下是部署 Office Web Apps Server 时不应执行的一些操作。</p><blockquote><p>请勿在运行 Office Web Apps Server 的服务器上安装任何其他服务器应用程序。包括 Exchange Server、SharePoint Server、Lync Server 和 SQL Server。如果您的服务器不足，则可以在这些服务器的其中一台上的虚拟机实例中运行 Office Web Apps Server。<br>不要在端口 80、443 或 809 上安装依赖 Web 服务器 (IIS) 角色的任何服务或角色，因为 Office Web Apps Server 会定期删除这些端口上的 Web 应用程序。<br>不要安装任何版本的 Office。如果已经安装，在安装 Office Web Apps Server 之前必须将其卸载。<br>不要在域控制器上安装 Office Web Apps Server。它不会在包含 Active Directory 域服务 (AD DS) 的服务器上运行。</p></blockquote><p><img src="/images/2018/0119/00.png" alt="owa"></p><h1 id="搭建域控服务器-DC"><a href="#搭建域控服务器-DC" class="headerlink" title="搭建域控服务器(DC)"></a>搭建域控服务器(DC)</h1><p>打开服务器管理，添加角色和功能<br><img src="/images/2018/0119/01.png" alt="owa"><br>默认下一步<br><img src="/images/2018/0119/02.png" alt="owa"><br>基于角色或基于功能的安装<br><img src="/images/2018/0119/03.png" alt="owa"><br>从服务器池中选择服务器，可以看到本机名称和ip地址<br><img src="/images/2018/0119/04.png" alt="owa"><br>勾选“DNS服务器”和“Active Directory域服务”<br><img src="/images/2018/0119/05.png" alt="owa"><br>默认下一步<br><img src="/images/2018/0119/06.png" alt="owa"><br><img src="/images/2018/0119/07.png" alt="owa"><br><img src="/images/2018/0119/08.png" alt="owa"><br>最后确认一下所有选择，开始安装<br><img src="/images/2018/0119/09.png" alt="owa"><br><img src="/images/2018/0119/10.png" alt="owa"><br>安装完成<br><img src="/images/2018/0119/11.png" alt="owa"><br>服务器管理器-AD DS- 将此服务器升级为域控制器<br><img src="/images/2018/0119/12.png" alt="owa"><br>添加新林，输入根域名islocal.cc<br><img src="/images/2018/0119/14.png" alt="owa"><br>设置一个目录服务还原模式密码<br><img src="/images/2018/0119/15.png" alt="owa"><br><img src="/images/2018/0119/16.png" alt="owa"><br><img src="/images/2018/0119/17.png" alt="owa"><br><img src="/images/2018/0119/18.png" alt="owa"><br><img src="/images/2018/0119/19.png" alt="owa"><br><img src="/images/2018/0119/20.png" alt="owa"><br>至此，与控制搭建工作已经完成！</p><h1 id="owa服务器加入域控"><a href="#owa服务器加入域控" class="headerlink" title="owa服务器加入域控"></a>owa服务器加入域控</h1><h2 id="apps服务器上操作"><a href="#apps服务器上操作" class="headerlink" title="apps服务器上操作"></a>apps服务器上操作</h2><p>设置apps服务器ip地址，将dns地址设置为域控地址192.168.6.111<br><img src="/images/2018/0119/21.png" alt="owa"><br>点击系统属性-计算机名-更改-域-输入域名；输入域控服务器的用户名密码，成功加入，重启服务器<br><img src="/images/2018/0119/22.png" alt="owa"></p><h2 id="域控上操作"><a href="#域控上操作" class="headerlink" title="域控上操作"></a>域控上操作</h2><p>服务器管理器-管理-添加服务器<br><img src="/images/2018/0119/23.png" alt="owa"><br>输入服务器名称，添加到计算机<br><img src="/images/2018/0119/24.png" alt="owa"><br>在所有服务器可以看到已经添加完成<br><img src="/images/2018/0119/25.png" alt="owa"><br><em>使用域管理员登录apps服务器，登录格式为：用户名：islocal\administrator，密码：域管理员密码</em><br><em>加入域后，ping不通服务器，服务器本地关闭域防火墙</em></p><h1 id="owa软件安装"><a href="#owa软件安装" class="headerlink" title="owa软件安装"></a>owa软件安装</h1><h2 id="安装-NET-Framework-4-5-2"><a href="#安装-NET-Framework-4-5-2" class="headerlink" title="安装.NET Framework 4.5.2"></a>安装.NET Framework 4.5.2</h2><p>下载地址 <a href="https://www.microsoft.com/zh-cn/download/details.aspx?id=42643" target="_blank" rel="external">https://www.microsoft.com/zh-cn/download/details.aspx?id=42643</a></p><h2 id="安装IIS"><a href="#安装IIS" class="headerlink" title="安装IIS"></a>安装IIS</h2><p><strong><font color="red">参考本文贴的第一张图，一定要安装全iis组件。</font></strong></p><h2 id="以管理员身份打开-Windows-PowerShell-提示符，然后运行此命令示例来安装必需的角色和服务"><a href="#以管理员身份打开-Windows-PowerShell-提示符，然后运行此命令示例来安装必需的角色和服务" class="headerlink" title="以管理员身份打开 Windows PowerShell 提示符，然后运行此命令示例来安装必需的角色和服务"></a>以管理员身份打开 Windows PowerShell 提示符，然后运行此命令示例来安装必需的角色和服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Add-WindowsFeature Web-Server,Web-Mgmt-Tools,Web-Mgmt-Console,Web-WebServer,Web-Common-Http,Web-Default-Doc,Web-Static-Content,Web-Performance,Web-Stat-Compression,Web-Dyn-Compression,Web-Security,Web-Filtering,Web-Windows-Auth,Web-App-Dev,Web-Net-Ext45,Web-Asp-Net45,Web-ISAPI-Ext,Web-ISAPI-Filter,Web-Includes,InkandHandwritingServices,NET-Framework-Features,NET-Framework-Core,NET-HTTP-Activation,NET-Non-HTTP-Activ,NET-WCF-HTTP-Activation45</div></pre></td></tr></table></figure><p><img src="/images/2018/0119/26.png" alt="owa"></p><h2 id="安装Office-Web-Apps-Server"><a href="#安装Office-Web-Apps-Server" class="headerlink" title="安装Office Web Apps Server"></a>安装Office Web Apps Server</h2><p>下载地址Office Web Apps Server<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ed2k://|file|cn_office_web_apps_server_2013_with_sp1_x64_dvd_3832995.iso|530315264|C33F5E985FB1B7CC74A28FAA4857458C|/</div></pre></td></tr></table></figure></p><p>加载到本地光驱，双击setup.exe开始安装<br><img src="/images/2018/0119/28.png" alt="owa"><br>选择文件安装位置<br><img src="/images/2018/0119/29.png" alt="owa"><br><img src="/images/2018/0119/30.png" alt="owa"><br><img src="/images/2018/0119/31.png" alt="owa"></p><h2 id="安装Office-Web-Apps-Server-SP1补丁包（2012R2必须项）"><a href="#安装Office-Web-Apps-Server-SP1补丁包（2012R2必须项）" class="headerlink" title="安装Office Web Apps Server SP1补丁包（2012R2必须项）"></a>安装Office Web Apps Server SP1补丁包（2012R2必须项）</h2><p>下载地址：<a href="https://support.microsoft.com/zh-cn/help/2880558/description-of-microsoft-office-web-apps-server-service-pack-1-sp1" target="_blank" rel="external">https://support.microsoft.com/zh-cn/help/2880558/description-of-microsoft-office-web-apps-server-service-pack-1-sp1</a><br><img src="/images/2018/0119/32.png" alt="owa"><br><img src="/images/2018/0119/33.png" alt="owa"></p><h2 id="安装语言包"><a href="#安装语言包" class="headerlink" title="安装语言包"></a>安装语言包</h2><p>下载地址：<a href="https://www.microsoft.com/zh-cn/download/details.aspx?id=35490" target="_blank" rel="external">https://www.microsoft.com/zh-cn/download/details.aspx?id=35490</a><br><img src="/images/2018/0119/34.png" alt="owa"></p><h1 id="owa服务器配置"><a href="#owa服务器配置" class="headerlink" title="owa服务器配置"></a>owa服务器配置</h1><h2 id="导入OfficeWebApps模块"><a href="#导入OfficeWebApps模块" class="headerlink" title="导入OfficeWebApps模块"></a>导入OfficeWebApps模块</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Import-Module -Name OfficeWebApps</div></pre></td></tr></table></figure><h2 id="创建一个Office-Web-Apps-Server"><a href="#创建一个Office-Web-Apps-Server" class="headerlink" title="创建一个Office Web Apps Server"></a>创建一个Office Web Apps Server</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">New-OfficeWebAppsFarm -InternalURL http://192.168.6.112 -AllowHttp -EditingEnabled</div><div class="line">Set-OfficeWebAppsFarm -OpenFromUrlEnabled:$true</div></pre></td></tr></table></figure><p><img src="/images/2018/0119/35.png" alt="owa"></p><h1 id="验证安装结果"><a href="#验证安装结果" class="headerlink" title="验证安装结果"></a>验证安装结果</h1><p><a href="http://192.168.6.112/hosting/discovery" target="_blank" rel="external">http://192.168.6.112/hosting/discovery</a><br><img src="/images/2018/0119/36.png" alt="owa"><br><a href="http://192.168.6.112/op/generate.aspx" target="_blank" rel="external">http://192.168.6.112/op/generate.aspx</a><br><img src="/images/2018/0119/37.png" alt="owa"><br>这里的测试文档URL必须使用域名，IP地址会报错“<span>很抱歉，由于某种原因不能为您打开。如果是本地定义的域名，只需要在预览服务器上添加一条hosts即可。<br><img src="/images/2018/0119/38.png" alt="owa"><br><img src="/images/2018/0119/39.png" alt="owa"></span></p><h1 id="其他解决方案"><a href="#其他解决方案" class="headerlink" title="其他解决方案"></a>其他解决方案</h1><ul><li>Collabora Online<br><code>https://www.collaboraoffice.com/collabora-online/</code></li><li>ONLYOFFICE<br><code>https://helpcenter.onlyoffice.com/server/document.aspx</code></li><li>永中DCS<br><code>http://dcs.yozosoft.com/examples.html</code></li><li>idocv<br><code>https://www.idocv.com</code></li><li>百度<br><code>https://cloud.baidu.com/product/doc.html</code></li></ul><p>参考链接：<br><a href="https://technet.microsoft.com/zh-cn/library/jj219455.aspx" target="_blank" rel="external">https://technet.microsoft.com/zh-cn/library/jj219455.aspx</a><br><a href="http://www.cnblogs.com/timelyxyz/p/3645134.html" target="_blank" rel="external">http://www.cnblogs.com/timelyxyz/p/3645134.html</a><br><a href="http://blog.csdn.net/duanchuanttao/article/details/53467060" target="_blank" rel="external">http://blog.csdn.net/duanchuanttao/article/details/53467060</a><br><a href="http://blog.csdn.net/ituff/article/details/23880431" target="_blank" rel="external">http://blog.csdn.net/ituff/article/details/23880431</a></p>]]></content>
      
      
      <categories>
          
          <category> 服务器搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> 域控 </tag>
            
            <tag> office </tag>
            
            <tag> 在线预览 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Scp拷贝大文件出现stalled故障解决方法</title>
      <link href="/arlo/8954c4ab/"/>
      <url>/arlo/8954c4ab/</url>
      
        <content type="html"><![CDATA[<p>最近倒腾oracle数据库异地备份，由于端口限制不能使用rsync（首选），只能使用scp脚本自动拷贝到本地服务器，数据库按用户备份的，最大一个文件53G，发现每次都拷贝不完就中断了；之前以为是网络的问题导致shell退出，今天开了screen，手动执行脚本，特地跟踪了一下，发现出现stalled的故障；网上有找到的方法有以下几种，个人认为第三种更治根。<br><a id="more"></a></p><h1 id="限速"><a href="#限速" class="headerlink" title="限速"></a>限速</h1><p><code>scp -l 1000 /from/path  /to/path  #单位为Kbit，1000Kbit/8=125Kb</code></p><h1 id="修改内核参数"><a href="#修改内核参数" class="headerlink" title="修改内核参数"></a>修改内核参数</h1><p><code>echo 0 &gt; /proc/sys/net/ipv4/tcp_sack</code></p><h1 id="调整mtu值"><a href="#调整mtu值" class="headerlink" title="调整mtu值"></a>调整mtu值</h1><p>由于我的网络是PPPoE拨号的，最佳mtu值应为1492<br><code>ifconfig eth0 mtu 1492</code><br>or<br><code>ip link set dev eth0 mtu 1492</code></p><p>参考资料<br><a href="https://www.gpforums.co.nz/threads/399001-MTU-Value-1492-vs-1500" target="_blank" rel="external">https://www.gpforums.co.nz/threads/399001-MTU-Value-1492-vs-1500</a><br><a href="https://stackoverflow.com/questions/11985008/sending-a-large-file-with-scp-to-a-certain-server-stalls-at-exactly-2112-kb" target="_blank" rel="external">https://stackoverflow.com/questions/11985008/sending-a-large-file-with-scp-to-a-certain-server-stalls-at-exactly-2112-kb</a><br><a href="http://www.tp-link.com/tw/article/?faqid=190" target="_blank" rel="external">http://www.tp-link.com/tw/article/?faqid=190</a><br><a href="http://www.cnblogs.com/wjoyxt/p/6873714.html" target="_blank" rel="external">http://www.cnblogs.com/wjoyxt/p/6873714.html</a></p>]]></content>
      
      
      <categories>
          
          <category> Troubleshooting </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 常识 </tag>
            
            <tag> Scp </tag>
            
            <tag> MTU </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Oracle表空间扩容</title>
      <link href="/arlo/989e9822/"/>
      <url>/arlo/989e9822/</url>
      
        <content type="html"><![CDATA[<p>在新装完的oracle数据库中导入数据，由于数据量比较大，报以下错误；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ORA-39171: Job is experiencing a resumable wait.</div><div class="line">ORA-01653: unable to extend table AIR_FORECAST.T_WRF_DATA by 8192 in tablespace USERS</div></pre></td></tr></table></figure></p><a id="more"></a><p>此故障是由于数据库的表空间满了，造成的数据无法正常导入，我们需要手动来扩容表空间</p><h1 id="查询当前实例名"><a href="#查询当前实例名" class="headerlink" title="查询当前实例名"></a>查询当前实例名</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select instance_name from v$instance;</div></pre></td></tr></table></figure><h1 id="查询表空间名"><a href="#查询表空间名" class="headerlink" title="查询表空间名"></a>查询表空间名</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select tablespace_name from sys.dba_tablespaces;</div></pre></td></tr></table></figure><h1 id="查询默认表空间"><a href="#查询默认表空间" class="headerlink" title="查询默认表空间"></a>查询默认表空间</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">select a.property_name, a.property_value from database_properties a where a.property_name like &apos;%DEFAULT%&apos;;</div><div class="line">……</div><div class="line">DEFAULT_PERMANENT_TABLESPACE</div><div class="line">USERS</div><div class="line">……</div></pre></td></tr></table></figure><h1 id="查看表空间使用情况"><a href="#查看表空间使用情况" class="headerlink" title="查看表空间使用情况"></a>查看表空间使用情况</h1><h2 id="在PL-SQL-Developer-中执行一下SQL语句"><a href="#在PL-SQL-Developer-中执行一下SQL语句" class="headerlink" title="在PL SQL Developer 中执行一下SQL语句"></a>在PL SQL Developer 中执行一下SQL语句</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SELECT a.tablespace_name &quot;表空间名&quot;,a.bytes / 1024 / 1024 &quot;表空间大小(M)&quot;,(a.bytes - b.bytes) / 1024 / 1024 &quot;已使用空间(M)&quot;,b.bytes / 1024 / 1024 &quot;空闲空间(M)&quot;,round(((a.bytes - b.bytes) / a.bytes) * 100, 2) &quot;使用比&quot;FROM (SELECT tablespace_name, sum(bytes) bytes FROM dba_data_files GROUP BY tablespace_name) a,(SELECT tablespace_name, sum(bytes) bytes, max(bytes) largest FROM dba_free_space GROUP BY tablespace_name) b WHERE a.tablespace_name = b.tablespace_name ORDER BY ((a.bytes - b.bytes) / a.bytes) DESC</div></pre></td></tr></table></figure><h2 id="查看USERS表空间文件及使用量"><a href="#查看USERS表空间文件及使用量" class="headerlink" title="查看USERS表空间文件及使用量"></a>查看USERS表空间文件及使用量</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SELECT file_name,tablespace_name,bytes / 1024 / 1024 &quot;bytes MB&quot;,maxbytes / 1024 / 1024 &quot;maxbytes MB&quot; FROM dba_data_files WHERE tablespace_name = &apos;USERS&apos;;</div></pre></td></tr></table></figure><h2 id="查看USERS表空间文件是否自动扩展"><a href="#查看USERS表空间文件是否自动扩展" class="headerlink" title="查看USERS表空间文件是否自动扩展"></a>查看USERS表空间文件是否自动扩展</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SELECT file_id, file_name, tablespace_name, autoextensible, increment_by FROM dba_data_files WHERE tablespace_name = &apos;USERS&apos; ORDER BY file_id desc;</div></pre></td></tr></table></figure><p>查看”autoextensible”对应的值是YES还是NO，若是NO，说明MSMS表空间的自动扩展功能没有开，改成YES就可以了。</p><h2 id="查询所有的schema所占空间大小"><a href="#查询所有的schema所占空间大小" class="headerlink" title="查询所有的schema所占空间大小"></a>查询所有的schema所占空间大小</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select owner, sum(bytes)/1024/1024/1024 schema_size_gig from sys.dba_segments group by owner;</div></pre></td></tr></table></figure><h1 id="增加表空间文件"><a href="#增加表空间文件" class="headerlink" title="增加表空间文件"></a>增加表空间文件</h1><h2 id="查看表空间文件"><a href="#查看表空间文件" class="headerlink" title="查看表空间文件"></a>查看表空间文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SELECT * FROM dba_data_files t WHERE t.tablespace_name=&apos;USERS&apos;;</div></pre></td></tr></table></figure><p>查看得知我们的表空间文件在/u01/app/oracle/oradata/sx21/目录下，新建的文件也放在此目录下,方便后期管理</p><h2 id="查看表空间文件自增长文件最大值"><a href="#查看表空间文件自增长文件最大值" class="headerlink" title="查看表空间文件自增长文件最大值"></a>查看表空间文件自增长文件最大值</h2><p>因为Oracle的物理文件最大只允许4194303个数据块(datablock).需要查看一下本地block块大小<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">数据块的大小        物理文件的最大值 M</div><div class="line">===============================================               </div><div class="line">2048                  8191 M</div><div class="line">4096                  16383 M</div><div class="line">8192                  32767 M</div><div class="line">16384                 65535 M</div></pre></td></tr></table></figure></p><h2 id="查看oracle数据库block大小"><a href="#查看oracle数据库block大小" class="headerlink" title="查看oracle数据库block大小"></a>查看oracle数据库block大小</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">在sqlplus窗口中执行</div><div class="line">SQL&gt; show parameter db_block_size;</div><div class="line"></div><div class="line">NAME     TYPE VALUE</div><div class="line">------------------------------------ ----------- ------------------------------</div><div class="line">db_block_size     integer 8192</div><div class="line">在pl/SQL窗口中执行</div><div class="line">SQL&gt; select value from v$parameter where name=&apos;db_block_size&apos;;</div><div class="line"></div><div class="line">VALUE</div><div class="line">--------------------------------------------------------------------------------</div><div class="line">8192</div></pre></td></tr></table></figure><h2 id="添加表空间文件"><a href="#添加表空间文件" class="headerlink" title="添加表空间文件"></a>添加表空间文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter tablespace USERS add datafile &apos;/u01/app/oracle/oradata/sx21/users02.dbf&apos; size 5M autoextend on maxsize 32767M;</div></pre></td></tr></table></figure><h2 id="ASM添加表空间文件"><a href="#ASM添加表空间文件" class="headerlink" title="ASM添加表空间文件"></a>ASM添加表空间文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter tablespace USERS add datafile &apos;+DATA&apos; size 5M autoextend on maxsize 32767M;</div><div class="line">SQL&gt; select name from v$datafile;</div></pre></td></tr></table></figure><p><em>注意：ASM增加数据文件或者创建表空间不需要指定数据文件名，只要指定 diskgroup即可,ASM会自动命名。</em></p><h1 id="验证添加的表空间文件"><a href="#验证添加的表空间文件" class="headerlink" title="验证添加的表空间文件"></a>验证添加的表空间文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select file_name,file_id,tablespace_name FROM dba_data_files WHERE tablespace_name=&apos;USERS&apos;;</div><div class="line"></div><div class="line">FILE_NAME</div><div class="line">--------------------------------------------------------------------------------</div><div class="line">   FILE_ID TABLESPACE_NAME</div><div class="line">---------- ------------------------------</div><div class="line">/u01/app/oracle/oradata/sx21/users01.dbf</div><div class="line"> 4 USERS</div><div class="line"></div><div class="line">/u01/app/oracle/oradata/sx21/users02.dbf</div><div class="line"> 5 USERS</div></pre></td></tr></table></figure><h1 id="扩展阅读"><a href="#扩展阅读" class="headerlink" title="扩展阅读"></a>扩展阅读</h1><p><a href="http://www.dba-oracle.com/t_bigfile_tablespace_tips.htm" target="_blank" rel="external">http://www.dba-oracle.com/t_bigfile_tablespace_tips.htm</a></p><p>参考资料：<br><a href="http://blog.csdn.net/u013806814/article/details/48400861" target="_blank" rel="external">http://blog.csdn.net/u013806814/article/details/48400861</a><br><a href="http://blog.itpub.net/27042095/viewspace-1100993/" target="_blank" rel="external">http://blog.itpub.net/27042095/viewspace-1100993/</a><br><a href="http://blog.sina.com.cn/s/blog_9d4799c701017pw1.html" target="_blank" rel="external">http://blog.sina.com.cn/s/blog_9d4799c701017pw1.html</a><br><a href="https://blog.csdn.net/qq_33547950/article/details/79257882" target="_blank" rel="external">https://blog.csdn.net/qq_33547950/article/details/79257882</a></p>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>CentOS6.9环境静默安装Oracle11g</title>
      <link href="/arlo/6dacbf16/"/>
      <url>/arlo/6dacbf16/</url>
      
        <content type="html"><![CDATA[<h1 id="系统基础环境"><a href="#系统基础环境" class="headerlink" title="系统基础环境"></a>系统基础环境</h1><p>操作系统：CentOS 6.9 x64<br>Iptables：off<br>Selinux：disabled<br><a id="more"></a></p><h2 id="修改主机名"><a href="#修改主机名" class="headerlink" title="修改主机名"></a>修改主机名</h2><p>安装oracle后不要修改主机名，会引起故障<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">vim /etc/sysconfig/network</div><div class="line">NETWORKING=yes</div><div class="line">HOSTNAME=&quot;dbserver&quot;</div></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hostname dbserver</div></pre></td></tr></table></figure><p>添加一条hosts记录，主机名映射<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">127.0.0.1dbserver</div></pre></td></tr></table></figure></p><h2 id="基础软件安装"><a href="#基础软件安装" class="headerlink" title="基础软件安装"></a>基础软件安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">#默认是不安装32位软件包的，添加此选项</div><div class="line">echo &apos;multilib_policy=all&apos; &gt;&gt; /etc/yum.conf</div><div class="line">yum -y install  binutils-* compat-libstdc++-* elfutils-libelf-*  elfutils-libelf-devel-* gcc-* gcc-c++-* glibc-* glibc-common-* glibc-devel-*  glibc-headers-* ksh-* libaio-*  libaio-devel-* libgcc-*  libstdc++* libstdc++-devel* make-*  sysstat-* unixODBC-* unixODBC-devel-* mksh</div><div class="line">#监测一下软件是否安装全</div><div class="line">rpm -q \</div><div class="line">binutils \</div><div class="line">compat-libstdc++-33 \</div><div class="line">elfutils-libelf \</div><div class="line">elfutils-libelf-devel \</div><div class="line">expat \</div><div class="line">gcc \</div><div class="line">gcc-c++ \</div><div class="line">glibc \</div><div class="line">glibc-common \</div><div class="line">glibc-devel \</div><div class="line">glibc-headers \</div><div class="line">libaio \</div><div class="line">libaio-devel \</div><div class="line">libgcc \</div><div class="line">libstdc++ \</div><div class="line">libstdc++-devel \</div><div class="line">make \</div><div class="line">pdksh \</div><div class="line">sysstat \</div><div class="line">unixODBC \</div><div class="line">unixODBC-devel | grep &quot;not installed&quot;</div></pre></td></tr></table></figure><h2 id="修改PAM配置文件"><a href="#修改PAM配置文件" class="headerlink" title="修改PAM配置文件"></a>修改PAM配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">vim /etc/pam.d/login</div><div class="line">session    required     /lib64/security/pam_limits.so</div><div class="line">session    required     pam_limits.so</div></pre></td></tr></table></figure><h2 id="修改内核参数"><a href="#修改内核参数" class="headerlink" title="修改内核参数"></a>修改内核参数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">vim /etc/sysctl.conf</div><div class="line">fs.aio-max-nr = 1048576 </div><div class="line">fs.file-max = 6815744 </div><div class="line">kernel.shmmni = 4096 </div><div class="line">kernel.sem = 250 32000 100 128 </div><div class="line">net.ipv4.ip_local_port_range = 9000 65500 </div><div class="line">net.core.rmem_default = 262144 </div><div class="line">net.core.rmem_max = 4194304 </div><div class="line">net.core.wmem_default = 262144 </div><div class="line">net.core.wmem_max = 1048586</div><div class="line"></div><div class="line"></div><div class="line">#重新加载生效</div><div class="line">sysctl –p</div></pre></td></tr></table></figure><h2 id="修改系统资源限制"><a href="#修改系统资源限制" class="headerlink" title="修改系统资源限制"></a>修改系统资源限制</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">vim /etc/security/limits.conf  </div><div class="line">oracle  soft  nproc   2047 </div><div class="line">oracle  hard  nproc   16384 </div><div class="line">oracle  soft  nofile  1024 </div><div class="line">oracle  hard  nofile  65536</div><div class="line">oraclesoft  stack   10240</div></pre></td></tr></table></figure><h1 id="Oracle相关环境配置"><a href="#Oracle相关环境配置" class="headerlink" title="Oracle相关环境配置"></a>Oracle相关环境配置</h1><h2 id="新建用户"><a href="#新建用户" class="headerlink" title="新建用户"></a>新建用户</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">groupadd -g 500 oinstall</div><div class="line">groupadd -g 501 dba</div><div class="line">useradd -u 500 -g oinstall -G dba oracle</div><div class="line">#设置oracle用户密码为oracle</div><div class="line">echo &quot;oracle:oracle&quot; | chpasswd</div></pre></td></tr></table></figure><h2 id="修改用户配置文件"><a href="#修改用户配置文件" class="headerlink" title="修改用户配置文件"></a>修改用户配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">vim /etc/profile</div><div class="line">if [ $USER = &quot;oracle&quot; ]; then</div><div class="line">   if [ $SHELL = &quot;/bin/ksh&quot; ]; then</div><div class="line">       ulimit -p 16384</div><div class="line">       ulimit -n 65536</div><div class="line">   else</div><div class="line">       ulimit -u 16384 -n 65536</div><div class="line">   fi</div><div class="line">fi</div></pre></td></tr></table></figure><h2 id="新建目录并设置权限"><a href="#新建目录并设置权限" class="headerlink" title="新建目录并设置权限"></a>新建目录并设置权限</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mkdir -p /u01/app/oracle/product/11.2.0/db_1</div><div class="line">mkdir -p /u01/app/oraInventory</div><div class="line">chown -R oracle.oinstall /u01/app/oracle</div><div class="line">chown -R oracle.oinstall /u01/app/oraInventory</div><div class="line">chmod -R 775 /u01/app</div></pre></td></tr></table></figure><h2 id="设置oracle用户环境变量"><a href="#设置oracle用户环境变量" class="headerlink" title="设置oracle用户环境变量"></a>设置oracle用户环境变量</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">su - oracle</div><div class="line">$ vim ~/.bash_profile </div><div class="line">export ORACLE_BASE=/u01/app/oracle</div><div class="line">export ORACLE_HOME=$ORACLE_BASE/product/11.2.0/db_1</div><div class="line">export ORACLE_SID=sx21</div><div class="line">export PATH=$PATH:$ORACLE_HOME/bin</div><div class="line">export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib</div><div class="line">export NLS_LANG=American_America.ZHS16GBK</div></pre></td></tr></table></figure><h2 id="检查环境变量是否生效"><a href="#检查环境变量是否生效" class="headerlink" title="检查环境变量是否生效"></a>检查环境变量是否生效</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">source ~/.bash_profile</div><div class="line">env |grep ORA</div><div class="line">ORACLE_SID=sx21</div><div class="line">ORACLE_BASE=/u01/app/oracle</div><div class="line">ORACLE_HOME=/u01/app/oracle/product/11.2.0/db_1</div></pre></td></tr></table></figure><h2 id="准备软件安装包"><a href="#准备软件安装包" class="headerlink" title="准备软件安装包"></a>准备软件安装包</h2><p>下载地址: <a href="http://www.oracle.com/technetwork/database/enterprise-edition/downloads/112010-linx8664soft-100572.html" target="_blank" rel="external">http://www.oracle.com/technetwork/database/enterprise-edition/downloads/112010-linx8664soft-100572.html</a><br>可以使用cksum校验文件完整性<br>linux.x64_11gR2_database_1of2.zip (1,239,269,270 bytes) (cksum - 3152418844)<br>linux.x64_11gR2_database_2of2.zip (1,111,416,131 bytes) (cksum - 3669256139)</p><h2 id="解压软件包"><a href="#解压软件包" class="headerlink" title="解压软件包"></a>解压软件包</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">unzip linux.x64_11gR2_database_1of2.zip</div><div class="line">unzip linux.x64_11gR2_database_2of2.zip</div></pre></td></tr></table></figure><p>解压后得到/home/oracle/database/response目录，该目录中有三个rsp文件，用来作为静默安装时的应答文件的模板。<br>备份三个文件并修改其内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">db_install.rsp安装应答</div><div class="line">netca.rsp建立监听、本地服务名等网络设置的应答</div><div class="line">dbca.rsp创建数据库应答</div></pre></td></tr></table></figure></p><h1 id="静默安装数据库软件"><a href="#静默安装数据库软件" class="headerlink" title="静默安装数据库软件"></a>静默安装数据库软件</h1><h2 id="修改db-install-rsp-文件"><a href="#修改db-install-rsp-文件" class="headerlink" title="修改db_install.rsp 文件"></a>修改db_install.rsp 文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">egrep -v &quot;^#|^$&quot; db_install.rsp</div><div class="line">oracle.install.responseFileVersion=/oracle/install/rspfmt_dbinstall_response_schema_v11_2_0</div><div class="line">oracle.install.option=INSTALL_DB_SWONLY</div><div class="line">ORACLE_HOSTNAME=dbserver</div><div class="line">UNIX_GROUP_NAME=oinstall</div><div class="line">INVENTORY_LOCATION=/u01/app/oraInventory</div><div class="line">SELECTED_LANGUAGES=en,zh_CN</div><div class="line">ORACLE_HOME=/u01/app/oracle/product/11.2.0/db_1</div><div class="line">ORACLE_BASE=/u01/app/oracle/</div><div class="line">oracle.install.db.InstallEdition=EE</div><div class="line">oracle.install.db.EEOptionsSelection=false</div><div class="line">oracle.install.db.optionalComponents=oracle.rdbms.partitioning:11.2.0.4.0,oracle.oraolap:11.2.0.4.0,oracle.rdbms.dm:11.2.0.4.0,oracle.rdbms.dv:11.2.0.4.0,oracle.rdbms.lbac:11.2.0.4.0,oracle.rdbms.rat:11.2.0.4.0</div><div class="line">oracle.install.db.DBA_GROUP=dba</div><div class="line">oracle.install.db.OPER_GROUP=dba</div><div class="line">oracle.install.db.CLUSTER_NODES=</div><div class="line">oracle.install.db.isRACOneInstall=</div><div class="line">oracle.install.db.racOneServiceName=</div><div class="line">oracle.install.db.config.starterdb.type=</div><div class="line">oracle.install.db.config.starterdb.globalDBName=orcl</div><div class="line">oracle.install.db.config.starterdb.SID=orcl</div><div class="line">oracle.install.db.config.starterdb.characterSet=ZHS16GBK</div><div class="line">oracle.install.db.config.starterdb.memoryOption=true</div><div class="line">oracle.install.db.config.starterdb.memoryLimit=81920</div><div class="line">oracle.install.db.config.starterdb.installExampleSchemas=false</div><div class="line">oracle.install.db.config.starterdb.enableSecuritySettings=true</div><div class="line">oracle.install.db.config.starterdb.password.ALL=solution#123$$</div><div class="line">oracle.install.db.config.starterdb.password.SYS=</div><div class="line">oracle.install.db.config.starterdb.password.SYSTEM=</div><div class="line">oracle.install.db.config.starterdb.password.SYSMAN=</div><div class="line">oracle.install.db.config.starterdb.password.DBSNMP=</div><div class="line">oracle.install.db.config.starterdb.control=DB_CONTROL</div><div class="line">oracle.install.db.config.starterdb.gridcontrol.gridControlServiceURL=</div><div class="line">oracle.install.db.config.starterdb.automatedBackup.enable=false</div><div class="line">oracle.install.db.config.starterdb.automatedBackup.osuid=</div><div class="line">oracle.install.db.config.starterdb.automatedBackup.ospwd=</div><div class="line">oracle.install.db.config.starterdb.storageType=</div><div class="line">oracle.install.db.config.starterdb.fileSystemStorage.dataLocation=</div><div class="line">oracle.install.db.config.starterdb.fileSystemStorage.recoveryLocation=</div><div class="line">oracle.install.db.config.asm.diskGroup=</div><div class="line">oracle.install.db.config.asm.ASMSNMPPassword=</div><div class="line">MYORACLESUPPORT_USERNAME=</div><div class="line">MYORACLESUPPORT_PASSWORD=</div><div class="line">SECURITY_UPDATES_VIA_MYORACLESUPPORT=</div><div class="line">DECLINE_SECURITY_UPDATES=true</div><div class="line">PROXY_HOST=</div><div class="line">PROXY_PORT=</div><div class="line">PROXY_USER=</div><div class="line">PROXY_PWD=</div><div class="line">PROXY_REALM=</div><div class="line">COLLECTOR_SUPPORTHUB_URL=</div><div class="line">oracle.installer.autoupdates.option=</div><div class="line">oracle.installer.autoupdates.downloadUpdatesLoc=</div><div class="line">AUTOUPDATES_MYORACLESUPPORT_USERNAME=</div><div class="line">AUTOUPDATES_MYORACLESUPPORT_PASSWORD=</div></pre></td></tr></table></figure><h2 id="执行静默安装"><a href="#执行静默安装" class="headerlink" title="执行静默安装"></a>执行静默安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$ pwd</div><div class="line">/home/oracle/database</div><div class="line">./runInstaller -silent -ignorePrereq -ignoreSysPrereqs -responseFile /home/oracle/database/response/db_install.rsp</div><div class="line"></div><div class="line">Starting Oracle Universal Installer...</div><div class="line"></div><div class="line">Checking Temp space: must be greater than 120 MB.   Actual 26363 MB    Passed</div><div class="line">Checking swap space: must be greater than 150 MB.   Actual 4095 MB    Passed</div><div class="line">Preparing to launch Oracle Universal Installer from /tmp/OraInstall2017-12-27_02-06-55PM. Please wait ...[oracle@dbserver database]$ You can find the log of this install session at:</div><div class="line"> /u01/app/oraInventory/logs/installActions2017-12-27_02-06-55PM.log</div></pre></td></tr></table></figure><p>安装过程中可以另开一个窗口跟踪查看日志<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">tailf /u01/app/oraInventory/logs/installActions2017-12-27_02-06-55PM.log</div><div class="line"></div><div class="line">……</div><div class="line"></div><div class="line">INFO: Completed validating state &lt;finish&gt;</div><div class="line">INFO: Terminating all background operations</div><div class="line">INFO: Terminated all background operations</div><div class="line">INFO: Successfully executed the flow in SILENT mode</div><div class="line">INFO: Finding the most appropriate exit status for the current application</div><div class="line">INFO: Exit Status is 0</div><div class="line">INFO: Shutdown Oracle Database 11g Release 2 Installer</div><div class="line">INFO: Unloading Setup Driver</div></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"> #!/bin/sh </div><div class="line"> #Root scripts to run</div><div class="line"></div><div class="line">/u01/app/oraInventory/orainstRoot.sh</div><div class="line">/u01/app/oracle/product/11.2.0/db_1/root.sh</div><div class="line">To execute the configuration scripts:</div><div class="line"> 1. Open a terminal window </div><div class="line"> 2. Log in as &quot;root&quot; </div><div class="line"> 3. Run the scripts </div><div class="line"> 4. Return to this window and hit &quot;Enter&quot; key to continue </div><div class="line"></div><div class="line">Successfully Setup Software.</div></pre></td></tr></table></figure><p>一直到主窗口出现以上提示，以root用户打开一个窗口，一次执行下面操作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@dbserver ~]# /u01/app/oraInventory/orainstRoot.sh</div><div class="line">Changing permissions of /u01/app/oraInventory.</div><div class="line">Adding read,write permissions for group.</div><div class="line">Removing read,write,execute permissions for world.</div><div class="line"></div><div class="line">Changing groupname of /u01/app/oraInventory to oinstall.</div><div class="line">The execution of the script is complete.</div><div class="line">[root@dbserver ~]# /u01/app/oracle/product/11.2.0/db_1/root.sh</div><div class="line">Check /u01/app/oracle/product/11.2.0/db_1/install/root_dbserver_2017-12-27_14-23-43.log for the output of root script</div></pre></td></tr></table></figure></p><h1 id="静默安装监听"><a href="#静默安装监听" class="headerlink" title="静默安装监听"></a>静默安装监听</h1><p>使用默认配置文件，不用修改<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">$ORACLE_HOME/bin/netca /silent /responseFile /home/oracle/database/response/netca.rsp</div><div class="line"></div><div class="line"></div><div class="line">Parsing command line arguments:</div><div class="line">    Parameter &quot;silent&quot; = true</div><div class="line">    Parameter &quot;responsefile&quot; = /home/oracle/database/response/netca.rsp</div><div class="line">Done parsing command line arguments.</div><div class="line">Oracle Net Services Configuration:</div><div class="line">Profile configuration complete.</div><div class="line">Oracle Net Listener Startup:</div><div class="line">    Running Listener Control: </div><div class="line">      /u01/app/oracle/product/11.2.0/db_1/bin/lsnrctl start LISTENER</div><div class="line">    Listener Control complete.</div><div class="line">    Listener started successfully.</div><div class="line">Listener configuration complete.</div><div class="line">Oracle Net Services configuration successful. The exit code is 0</div></pre></td></tr></table></figure></p><p>默认监听是开启状态<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">[oracle@dbserver database]$ lsnrctl status</div><div class="line"></div><div class="line">LSNRCTL for Linux: Version 11.2.0.1.0 - Production on 27-DEC-2017 14:26:34</div><div class="line"></div><div class="line">Copyright (c) 1991, 2009, Oracle.  All rights reserved.</div><div class="line"></div><div class="line">Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=EXTPROC1521)))</div><div class="line">STATUS of the LISTENER</div><div class="line">------------------------</div><div class="line">Alias                     LISTENER</div><div class="line">Version                   TNSLSNR for Linux: Version 11.2.0.1.0 - Production</div><div class="line">Start Date                27-DEC-2017 14:25:48</div><div class="line">Uptime                    0 days 0 hr. 0 min. 50 sec</div><div class="line">Trace Level               off</div><div class="line">Security                  ON: Local OS Authentication</div><div class="line">SNMP                      OFF</div><div class="line">Listener Parameter File   /u01/app/oracle/product/11.2.0/db_1/network/admin/listener.ora</div><div class="line">Listener Log File         /u01/app/oracle/diag/tnslsnr/dbserver/listener/alert/log.xml</div><div class="line">Listening Endpoints Summary...</div><div class="line">  (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1521)))</div><div class="line">  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=dbserver)(PORT=1521)))</div><div class="line">The listener supports no services</div><div class="line">The command completed successfully</div></pre></td></tr></table></figure></p><h1 id="静默新建实例"><a href="#静默新建实例" class="headerlink" title="静默新建实例"></a>静默新建实例</h1><h2 id="修改dbca-rsp配置"><a href="#修改dbca-rsp配置" class="headerlink" title="修改dbca.rsp配置"></a>修改dbca.rsp配置</h2><p>这里只需要修改[CREATEDATABASE]部分即可，其他的保持默认<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">$ egrep -v &quot;^#|^$&quot; dbca.rsp </div><div class="line">[GENERAL]</div><div class="line">RESPONSEFILE_VERSION = &quot;11.2.0&quot;</div><div class="line">OPERATION_TYPE = &quot;createDatabase&quot;</div><div class="line">[CREATEDATABASE]</div><div class="line">GDBNAME = &quot;sx21&quot;</div><div class="line">SID = &quot;sx21&quot;</div><div class="line">TEMPLATENAME = &quot;General_Purpose.dbc&quot;</div><div class="line">SYSPASSWORD = &quot;solution#123&quot;</div><div class="line">SYSTEMPASSWORD = &quot;solution#123&quot;</div><div class="line">CHARACTERSET = &quot;ZHS16GBK&quot;</div><div class="line">NATIONALCHARACTERSET= &quot;AL16UTF16&quot;</div><div class="line">[createTemplateFromDB]</div><div class="line">SOURCEDB = &quot;myhost:1521:orcl&quot;</div><div class="line">SYSDBAUSERNAME = &quot;system&quot;</div><div class="line">TEMPLATENAME = &quot;My Copy TEMPLATE&quot;</div><div class="line">[createCloneTemplate]</div><div class="line">SOURCEDB = &quot;orcl&quot;</div><div class="line">TEMPLATENAME = &quot;My Clone TEMPLATE&quot;</div><div class="line">[DELETEDATABASE]</div><div class="line">SOURCEDB = &quot;orcl&quot;</div><div class="line">[generateScripts]</div><div class="line">TEMPLATENAME = &quot;New Database&quot;</div><div class="line">GDBNAME = &quot;orcl11.us.oracle.com&quot;</div><div class="line">[CONFIGUREDATABASE]</div><div class="line">[ADDINSTANCE]</div><div class="line">DB_UNIQUE_NAME = &quot;orcl11g.us.oracle.com&quot;</div><div class="line">NODELIST=</div><div class="line">SYSDBAUSERNAME = &quot;sys&quot;</div><div class="line">[DELETEINSTANCE]</div><div class="line">DB_UNIQUE_NAME = &quot;orcl11g.us.oracle.com&quot;</div><div class="line">INSTANCENAME = &quot;orcl11g&quot;</div><div class="line">SYSDBAUSERNAME = &quot;sys&quot;</div></pre></td></tr></table></figure></p><h2 id="执行静默安装-1"><a href="#执行静默安装-1" class="headerlink" title="执行静默安装"></a>执行静默安装</h2><p>不清楚是什么原因，我执行静默安装命令，屏幕就一直闪烁，不能输入密码，所以我将密码写到dbca.rsp文件中了，可以避免此问题！<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">$ORACLE_HOME/bin/dbca -silent -responseFile /home/oracle/database/response/dbca.rsp</div><div class="line"></div><div class="line"></div><div class="line">Copying database files</div><div class="line">1% complete</div><div class="line">2% complete</div><div class="line">4% complete</div><div class="line">37% complete</div><div class="line">Creating and starting Oracle instance</div><div class="line">38% complete</div><div class="line">40% complete</div><div class="line">45% complete</div><div class="line">50% complete</div><div class="line">51% complete</div><div class="line">56% complete</div><div class="line">57% complete</div><div class="line">61% complete</div><div class="line">62% complete</div><div class="line">Completing Database Creation</div><div class="line">66% complete</div><div class="line">70% complete</div><div class="line">73% complete</div><div class="line">74% complete</div><div class="line">85% complete</div><div class="line">86% complete</div><div class="line">98% complete</div><div class="line">100% complete</div><div class="line">Look at the log file &quot;/u01/app/oracle/cfgtoollogs/dbca/sx21/sx21.log&quot; for further details.</div></pre></td></tr></table></figure></p><h1 id="验证安装结果"><a href="#验证安装结果" class="headerlink" title="验证安装结果"></a>验证安装结果</h1><h2 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">[oracle@dbserver app]$ ps -ef |grep ora_</div><div class="line">oracle    5432     1  0 17:02 ?        00:00:00 ora_pmon_sx21</div><div class="line">oracle    5434     1  0 17:02 ?        00:00:00 ora_vktm_sx21</div><div class="line">oracle    5438     1  0 17:02 ?        00:00:00 ora_gen0_sx21</div><div class="line">oracle    5440     1  0 17:02 ?        00:00:00 ora_diag_sx21</div><div class="line">oracle    5442     1  0 17:02 ?        00:00:00 ora_dbrm_sx21</div><div class="line">oracle    5444     1  0 17:02 ?        00:00:00 ora_psp0_sx21</div><div class="line">oracle    5446     1  0 17:02 ?        00:00:00 ora_dia0_sx21</div><div class="line">oracle    5448     1  0 17:02 ?        00:00:01 ora_mman_sx21</div><div class="line">oracle    5450     1  0 17:02 ?        00:00:00 ora_dbw0_sx21</div><div class="line">oracle    5452     1  0 17:02 ?        00:00:00 ora_lgwr_sx21</div><div class="line">oracle    5454     1  0 17:02 ?        00:00:00 ora_ckpt_sx21</div><div class="line">oracle    5456     1  0 17:02 ?        00:00:00 ora_smon_sx21</div><div class="line">oracle    5458     1  0 17:02 ?        00:00:00 ora_reco_sx21</div><div class="line">oracle    5460     1  0 17:02 ?        00:00:00 ora_mmon_sx21</div><div class="line">oracle    5462     1  0 17:02 ?        00:00:00 ora_mmnl_sx21</div><div class="line">oracle    5464     1  0 17:02 ?        00:00:00 ora_d000_sx21</div><div class="line">oracle    5466     1  0 17:02 ?        00:00:00 ora_s000_sx21</div><div class="line">oracle    5558     1  0 17:02 ?        00:00:00 ora_qmnc_sx21</div><div class="line">oracle    5575     1  0 17:02 ?        00:00:00 ora_cjq0_sx21</div><div class="line">oracle    5579     1  0 17:02 ?        00:00:00 ora_q000_sx21</div><div class="line">oracle    5581     1  0 17:02 ?        00:00:00 ora_q001_sx21</div><div class="line">oracle    5585  1550  0 17:04 pts/0    00:00:00 grep ora_</div></pre></td></tr></table></figure><h2 id="监听"><a href="#监听" class="headerlink" title="监听"></a>监听</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">[oracle@dbserver app]$ lsnrctl status</div><div class="line"></div><div class="line">LSNRCTL for Linux: Version 11.2.0.1.0 - Production on 27-DEC-2017 17:04:44</div><div class="line"></div><div class="line">Copyright (c) 1991, 2009, Oracle.  All rights reserved.</div><div class="line"></div><div class="line">Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=EXTPROC1521)))</div><div class="line">STATUS of the LISTENER</div><div class="line">------------------------</div><div class="line">Alias                     LISTENER</div><div class="line">Version                   TNSLSNR for Linux: Version 11.2.0.1.0 - Production</div><div class="line">Start Date                27-DEC-2017 16:49:14</div><div class="line">Uptime                    0 days 0 hr. 15 min. 32 sec</div><div class="line">Trace Level               off</div><div class="line">Security                  ON: Local OS Authentication</div><div class="line">SNMP                      OFF</div><div class="line">Listener Parameter File   /u01/app/oracle/product/11.2.0/db_1/network/admin/listener.ora</div><div class="line">Listener Log File         /u01/app/oracle/diag/tnslsnr/dbserver/listener/alert/log.xml</div><div class="line">Listening Endpoints Summary...</div><div class="line">  (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1521)))</div><div class="line">  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=dbserver)(PORT=1521)))</div><div class="line">Services Summary...</div><div class="line">Service &quot;sx21&quot; has 1 instance(s).</div><div class="line">  Instance &quot;sx21&quot;, status READY, has 1 handler(s) for this service...</div><div class="line">Service &quot;sx21XDB&quot; has 1 instance(s).</div><div class="line">  Instance &quot;sx21&quot;, status READY, has 1 handler(s) for this service...</div><div class="line">The command completed successfully</div></pre></td></tr></table></figure><h2 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">[oracle@dbserver app]$ sqlplus /nolog</div><div class="line"></div><div class="line">SQL*Plus: Release 11.2.0.1.0 Production on Wed Dec 27 17:05:57 2017</div><div class="line"></div><div class="line">Copyright (c) 1982, 2009, Oracle.  All rights reserved.</div><div class="line"></div><div class="line">SQL&gt; conn /as sysdba</div><div class="line">Connected.</div><div class="line">SQL&gt; shutdown immediate</div><div class="line">Database closed.</div><div class="line">Database dismounted.</div><div class="line">ORACLE instance shut down.</div><div class="line">SQL&gt; startup</div><div class="line">ORACLE instance started.</div><div class="line"></div><div class="line">Total System Global Area 3340451840 bytes</div><div class="line">Fixed Size    2217952 bytes</div><div class="line">Variable Size 1811941408 bytes</div><div class="line">Database Buffers 1509949440 bytes</div><div class="line">Redo Buffers   16343040 bytes</div><div class="line">Database mounted.</div><div class="line">Database opened.</div></pre></td></tr></table></figure><h2 id="静默删除数据库实例"><a href="#静默删除数据库实例" class="headerlink" title="静默删除数据库实例"></a>静默删除数据库实例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dbca -silent -deleteDatabase -sourcedb orcl -sid orcl -sysDBAUserName sys -sysDBAPassword password</div></pre></td></tr></table></figure><h1 id="扩展配置"><a href="#扩展配置" class="headerlink" title="扩展配置"></a>扩展配置</h1><p>由于默认审计日志默认是开启状态，长时间使用后会早上SYSTEM表空间撑爆，磁盘占用率高，建议关闭<br>sqlplus / as sysdba<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">SQL&gt; show parameter audit_trail</div><div class="line">SQL&gt; alter system set audit_trail=none scope=spfile;</div><div class="line">SQL&gt; shutdown immediate;</div><div class="line">SQL&gt; startup</div></pre></td></tr></table></figure></p><h1 id="错误解析"><a href="#错误解析" class="headerlink" title="错误解析"></a>错误解析</h1><h2 id="WARNING-My-Oracle-Support-Username-Email-Address-Not-Specified"><a href="#WARNING-My-Oracle-Support-Username-Email-Address-Not-Specified" class="headerlink" title="[WARNING] - My Oracle Support Username/Email Address Not Specified"></a>[WARNING] - My Oracle Support Username/Email Address Not Specified</h2><p><code>DECLINE_SECURITY_UPDATES=true</code></p><h2 id="FATAL-INS-10101-The-given-response-file-response-db-install-rsp-is-not-found"><a href="#FATAL-INS-10101-The-given-response-file-response-db-install-rsp-is-not-found" class="headerlink" title="[FATAL] [INS-10101] The given response file response/db_install.rsp is not found."></a>[FATAL] [INS-10101] The given response file response/db_install.rsp is not found.</h2><p><code>响应文件写为绝对路径/usr/local/src/oracle/database/response/db_install.rsp</code></p><h2 id="FATAL-INS-00001-Unknown-irrecoverable-error"><a href="#FATAL-INS-00001-Unknown-irrecoverable-error" class="headerlink" title="[FATAL] [INS-00001] Unknown irrecoverable error"></a>[FATAL] [INS-00001] Unknown irrecoverable error</h2><p><code>设置的密码中不能有%</code></p><h1 id="常用语句"><a href="#常用语句" class="headerlink" title="常用语句"></a>常用语句</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">--创建表空间</div><div class="line">CREATE TABLESPACE TS_TENV datafile &apos;/u01/app/oracle/oradata/monitor/ts_tenv01.dbf&apos; SIZE 200m AUTOEXTEND ON NEXT 32m MAXSIZE 32767M EXTENT MANAGEMENT LOCAL;</div><div class="line">CREATE TABLESPACE TS_WEATHER datafile &apos;/u01/app/oracle/oradata/monitor/ts_weather01.dbf&apos; SIZE 200m AUTOEXTEND ON NEXT 32m MAXSIZE 32767M EXTENT MANAGEMENT LOCAL;</div><div class="line"></div><div class="line">--创建临时表空间</div><div class="line">CREATE TEMPORARY TABLESPACE TS_TENV_TEMP TEMPFILE &apos;/u01/app/oracle/oradata/monitor/ts_tenv_temp01.dbf&apos; SIZE 200m AUTOEXTEND ON NEXT 32m MAXSIZE 2048m EXTENT MANAGEMENT LOCAL;</div><div class="line">CREATE TEMPORARY TABLESPACE TS_WEATHER_TEMP TEMPFILE &apos;/u01/app/oracle/oradata/monitor/ts_weather_temp01.dbf&apos; SIZE 200m AUTOEXTEND ON NEXT 32m MAXSIZE 2048m EXTENT MANAGEMENT LOCAL;</div><div class="line"></div><div class="line">创建用户指定默认表空间</div><div class="line">--新建用户</div><div class="line">CREATE USER TENV IDENTIFIED BY tenv#123 DEFAULT TABLESPACE TS_TENV TEMPORARY TABLESPACE TS_TENV;</div><div class="line">CREATE USER WEATHER IDENTIFIED BY weather#123 DEFAULT TABLESPACE TS_WEATHER TEMPORARY TABLESPACE TS_WEATHER;</div><div class="line"></div><div class="line">--如果先新建用户了，使用以下命令修改默认表空间</div><div class="line">alter user TENV default tablespace TS_TENV;</div><div class="line">alter user WEATHER default tablespace TS_WEATHER;</div><div class="line">--授权连接权限</div><div class="line">GRANT CONNECT TO TENV; </div><div class="line">GRANT CONNECT TO WEATHER; </div><div class="line">--授权表空间</div><div class="line">GRANT UNLIMITED TABLESPACE TO TENV;</div><div class="line">GRANT UNLIMITED TABLESPACE TO WEATHER;</div><div class="line"></div><div class="line">--修改密码有效期为永久</div><div class="line">ALTER PROFILE DEFAULT LIMIT PASSWORD_LIFE_TIME UNLIMITED ;</div><div class="line">SELECT * FROM dba_profiles WHERE profile=&apos;DEFAULT&apos; AND resource_name=&apos;PASSWORD_LIFE_TIME&apos;;</div><div class="line">--解锁账号</div><div class="line">alter user 用户名 identified by 原密码;</div><div class="line">alter user db_user account unlock;</div><div class="line">--查看每个用户连接数</div><div class="line">select username,count(username) from v$session where username is not null group by username;</div></pre></td></tr></table></figure><p>参考文档：<br><a href="https://www.jianshu.com/p/b4200e721bfd" target="_blank" rel="external">https://www.jianshu.com/p/b4200e721bfd</a><br><a href="http://blog.51cto.com/wzlinux/1710941" target="_blank" rel="external">http://blog.51cto.com/wzlinux/1710941</a></p>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>枚举卷期间出错: 客户端无法连接到请求中指定的目标……</title>
      <link href="/arlo/143cd09f/"/>
      <url>/arlo/143cd09f/</url>
      
        <content type="html"><![CDATA[<p>存储：华为/OceanStor 2600 V3<br>网络：FC<br>服务器：Windows Server 2012 R2<br>更新系统补丁重启后连接存储提示以下错误：</p><blockquote><p>枚举存储期间出错。枚举卷期间出错: 客户端无法连接到请求中指定的目标。 请验证该目标上的服务是否正在运行以及是否正在接受请求。 有关目标(通常是 IIS 或 WinRM)上运行的 WS 管理服务，请查阅日志和文档。 如果目标是 WinRM 服务，则在目标上运行以下命令来分析和配置 WinRM 服务: “winrm quickconfig”。</p></blockquote><a id="more"></a><p><img src="/images/2017/1206/02.png" alt="stor"><br>这个错误应该跟 WinRM 服务有关，找到服务启用“ Windows Remote Management（WinRM）”服务后恢复正常;顺便设置服务为开机自启动。<br><img src="/images/2017/1206/03.png" alt="stor"></p>]]></content>
      
      
      <categories>
          
          <category> Troubleshooting </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> 华为 </tag>
            
            <tag> 存储 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>搭建ftp服务器并配置虚拟用户登录</title>
      <link href="/arlo/5cd2f164/"/>
      <url>/arlo/5cd2f164/</url>
      
        <content type="html"><![CDATA[<p>vsftpd 是“very secure FTP daemon”的缩写，安全性是它的一个最大的特点。<br>本次搭建ftp服务器，采用虚拟用户登录；所谓虚拟用户就是没有使用真实的系统用户，只是通过映射到真实的账户和设置权限的目的。虚拟用户不能登录操作系统。<br><a id="more"></a></p><h1 id="系统环境"><a href="#系统环境" class="headerlink" title="系统环境"></a>系统环境</h1><p>CentOS 6.9<br>SELinux disabled</p><h1 id="软件安装"><a href="#软件安装" class="headerlink" title="软件安装"></a>软件安装</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install db4 db4-utils vsftpd</div></pre></td></tr></table></figure><h1 id="创建虚拟用户的宿主用户"><a href="#创建虚拟用户的宿主用户" class="headerlink" title="创建虚拟用户的宿主用户"></a>创建虚拟用户的宿主用户</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">useradd -u 600 -d /data/ftproot -s /sbin/nologin slvftp</div></pre></td></tr></table></figure><h1 id="创建用户名密码文件"><a href="#创建用户名密码文件" class="headerlink" title="创建用户名密码文件"></a>创建用户名密码文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">vim account.txt</div><div class="line">slftp1</div><div class="line">xxxxxx</div><div class="line">slftp2</div><div class="line">yyyyyy</div></pre></td></tr></table></figure><h1 id="生成虚拟用户认证文件"><a href="#生成虚拟用户认证文件" class="headerlink" title="生成虚拟用户认证文件"></a>生成虚拟用户认证文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">db_load -T -t hash -f ./account.txt /etc/vsftpd/account.db</div><div class="line">#安全原因，修改认证文件权限</div><div class="line">chmod 600 /etc/vsftpd/account.db</div><div class="line">#执行完此操作，建议删除account.txt</div></pre></td></tr></table></figure><h1 id="配置认证文件"><a href="#配置认证文件" class="headerlink" title="配置认证文件"></a>配置认证文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">vim /etc/pam.d/vsftpd.sl</div><div class="line">auth required /lib64/security/pam_userdb.so db=/etc/vsftpd/account</div><div class="line">account required /lib64/security/pam_userdb.so db=/etc/vsftpd/account</div><div class="line">#我这里是64位的操作系统，写的是/lib64,如果是32位的操作系统，写成/lib即可</div></pre></td></tr></table></figure><h1 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">vim /etc/vsftpd/vsftpd.conf</div><div class="line">#虚拟用户权限与匿名用户权限相同，虚拟用户权限单独设定</div><div class="line">virtual_use_local_privs=NO</div><div class="line">#服务器独立运行</div><div class="line">listen=YES</div><div class="line">#设定不允许匿名访问</div><div class="line">anonymous_enable=NO</div><div class="line">#设定本地用户可以访问。注：如使用虚拟宿主用户，在该项目设定为NO的情况下所有虚拟用户将无法访问</div><div class="line">local_enable=YES</div><div class="line">#使用户不能离开主目录</div><div class="line">chroot_list_enable=YES</div><div class="line">chroot_list_enable=YES</div><div class="line">chroot_list_file=/etc/vsftpd/chroot_list</div><div class="line">#设定支持ASCII模式的上传和下载功能</div><div class="line">ascii_upload_enable=YES</div><div class="line">ascii_download_enable=YES</div><div class="line">#PAM认证文件名。PAM将根据/etc/pam.d/vsftpd.sl进行认证</div><div class="line">pam_service_name=vsftpd.sl</div><div class="line">#设定启用虚拟用户功能</div><div class="line">guest_enable=YES</div><div class="line">#指定虚拟用户的宿主用户，CentOS中已经有内置的ftp用户了</div><div class="line">guest_username=slvftp</div><div class="line">#设定虚拟用户个人vsftp的CentOS FTP服务文件存放路径。存放虚拟用户个性的CentOS FTP服务文件(配置文件名=虚拟用户名)</div><div class="line">user_config_dir=/etc/vsftpd/user_config/</div><div class="line">#配置vsftpd日志（可选）</div><div class="line">xferlog_enable=YES</div><div class="line">xferlog_std_format=YES</div><div class="line">xferlog_file=/var/log/xferlog</div><div class="line">dual_log_enable=YES</div><div class="line">vsftpd_log_file=/var/log/vsftpd.log</div><div class="line">#开启被动(PASV)模式</div><div class="line">pasv_enable=yes</div><div class="line">pasv_min_port=10240</div><div class="line">pasv_max_port=10250</div></pre></td></tr></table></figure><h1 id="新建chroot-list空文件"><a href="#新建chroot-list空文件" class="headerlink" title="新建chroot_list空文件"></a>新建chroot_list空文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">touch /etc/vsftpd/chroot_list</div></pre></td></tr></table></figure><h1 id="创建虚拟用户的配置目录文件"><a href="#创建虚拟用户的配置目录文件" class="headerlink" title="创建虚拟用户的配置目录文件"></a>创建虚拟用户的配置目录文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">mkdir /etc/vsftpd/user_config/</div><div class="line">#虚拟用户配置文件名必须与用户名一致</div><div class="line">vim /etc/vsftpd/user_config/slftp1</div><div class="line">guest_username=slvftp #虚拟用户的宿主用户</div><div class="line">local_root=/data/ftproot/slftp1  #虚拟用户根目录</div><div class="line">local_enable=YES</div><div class="line">write_enable=YES  #写权限</div><div class="line">anon_umask=022</div><div class="line">anon_world_readable_only=NO</div><div class="line">anon_upload_enable=YES #上传权限</div><div class="line">anon_mkdir_write_enable=YES  #创建文件夹权限</div><div class="line">anon_other_write_enable=YES  #其他权限</div><div class="line">##############</div><div class="line">vim /etc/vsftpd/user_config/slftp2</div><div class="line">guest_username=slvftp</div><div class="line">local_root=/data/ftproot/slftp2</div><div class="line">local_enable=YES</div><div class="line">write_enable=YES</div><div class="line">anon_umask=022</div><div class="line">anon_world_readable_only=NO</div><div class="line">anon_upload_enable=YES</div><div class="line">anon_mkdir_write_enable=YES</div><div class="line">anon_other_write_enable=YES</div></pre></td></tr></table></figure><h1 id="创建ftp根目录"><a href="#创建ftp根目录" class="headerlink" title="创建ftp根目录"></a>创建ftp根目录</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mkdir -pv /data/ftproot/slftp&#123;1,2&#125;</div><div class="line">chmod 700 -R /data/ftproot</div><div class="line">chown slvftp.slvftp -R /data/ftproot</div></pre></td></tr></table></figure><h1 id="重启vsftp服务"><a href="#重启vsftp服务" class="headerlink" title="重启vsftp服务"></a>重启vsftp服务</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/etc/init.d/vsftpd restart</div></pre></td></tr></table></figure><h1 id="防火墙开放端口"><a href="#防火墙开放端口" class="headerlink" title="防火墙开放端口"></a>防火墙开放端口</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT </div><div class="line">iptables -A INPUT -p icmp -j ACCEPT </div><div class="line">iptables -A INPUT -i lo -j ACCEPT </div><div class="line">iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT</div><div class="line">#主要是下边这两条</div><div class="line">iptables -A INPUT -m state --state NEW -m tcp -p tcp --dport 21 -j ACCEPT</div><div class="line">iptables -A INPUT -m state --state NEW -m tcp -p tcp --dport 10240:10250 -j ACCEPT</div><div class="line">#所有允许规则应该在这条之前</div><div class="line">iptables -A INPUT -j REJECT --reject-with icmp-host-prohibited</div></pre></td></tr></table></figure><h1 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">yum -y install lftp</div><div class="line">lftp user:passwd@127.0.0.1</div></pre></td></tr></table></figure><p><img src="/images/2017/1206/01.png" alt="ftp"><br>参考文档：<a href="https://dumplings.cc/bu-shu-vsftpyu-pei-zhi-xu-ni-yong-hu-deng-lu/" target="_blank" rel="external">https://dumplings.cc/bu-shu-vsftpyu-pei-zhi-xu-ni-yong-hu-deng-lu/</a></p>]]></content>
      
      
      <categories>
          
          <category> 服务器搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ftp </tag>
            
            <tag> vsftp </tag>
            
            <tag> 服务器 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Oracle RAC环境搭建(Oracle Linux 6.9+Oracle 11g R2+FreeNas)</title>
      <link href="/arlo/e07eb088/"/>
      <url>/arlo/e07eb088/</url>
      
        <content type="html"><![CDATA[<p>捣腾Oracle RAC环境已经半月有余，从对RAC一无所知到环境搭建成功，期间遇到很多坑，填了很多坑；特写此篇，记录一下搭建的过程，以备忘！话不多说，开干！<br><img src="/images/2017/1123/00.png" alt="rac"><br>网络环境：<br>网络分为三个部分，Public网络用于访问业务应用，Priv网络用于检测心跳，Storge网络用于连接存储；VIP，rac-scan网络应与Public网络在同一网段<br><a id="more"></a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">主机名Public网络Priv网络Storge网络VIP</div><div class="line">rac1192.168.100.11172.16.10.11172.16.20.1192.168.100.21</div><div class="line">rac2192.168.100.12172.16.10.12172.16.20.12192.168.100.22</div><div class="line">rac-scan192.168.100.23</div><div class="line">freenas172.16.20.13</div></pre></td></tr></table></figure></p><p>软件环境：<br><a href="https://mirrors.dotsrc.org/oracle-linux/OL6/U9/x86_64/" target="_blank" rel="external">Oracle Linux6.9</a><br><a href="http://www.oracle.com/technetwork/database/enterprise-edition/downloads/112010-linx8664soft-100572.html" target="_blank" rel="external">Grid</a><br><a href="http://www.oracle.com/technetwork/database/enterprise-edition/downloads/112010-linx8664soft-100572.html" target="_blank" rel="external">Oracle Database 11g</a><br><a href="http://www.oracle.com/technetwork/server-storage/linux/asmlib/ol6-1709075.html" target="_blank" rel="external">ASMlib</a><br><a href="http://www.freenas.com.cn" target="_blank" rel="external">FreeNas</a></p><p>RAC搭建分为五个部分：</p><ul><li>基础环境准备</li><li>共享存储搭建</li><li>网络搭建</li><li>Grid 安装</li><li>Database 安装</li></ul><h1 id="基础环境准备"><a href="#基础环境准备" class="headerlink" title="基础环境准备"></a>基础环境准备</h1><p>基础环境如无特别指明，都是需要在两台机器上操作的。</p><h2 id="虚拟机环境搭建"><a href="#虚拟机环境搭建" class="headerlink" title="虚拟机环境搭建"></a>虚拟机环境搭建</h2><h3 id="虚拟机资源配置"><a href="#虚拟机资源配置" class="headerlink" title="虚拟机资源配置"></a>虚拟机资源配置</h3><p>rac1:4核/8G/200G<br>rac2:4核/8G/200G<br>freenas:2核/2G/100G+(200G+200G+20G+20G)</p><h3 id="网络环境配置"><a href="#网络环境配置" class="headerlink" title="网络环境配置"></a>网络环境配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">虚拟机名称网卡1网卡2网卡3</div><div class="line">rac1VMnet1(NAT模式)VMnet2(仅主机模式)VMnet3(仅主机模式)</div><div class="line">rac2VMnet1(NAT模式)VMnet2(仅主机模式)VMnet3(仅主机模式)</div><div class="line">freenasVMnet1(NAT模式)</div><div class="line">VMnet1:192.168.100.0/24</div><div class="line">VMnet2:172.16.10.0/24</div><div class="line">VMnet3:172.16.20.0/24</div></pre></td></tr></table></figure><h3 id="操作系统安装"><a href="#操作系统安装" class="headerlink" title="操作系统安装"></a>操作系统安装</h3><p>安装图形界面环境<br>(过程略……)</p><h2 id="操作系统配置"><a href="#操作系统配置" class="headerlink" title="操作系统配置"></a>操作系统配置</h2><h3 id="修改主机名"><a href="#修改主机名" class="headerlink" title="修改主机名"></a>修改主机名</h3><p>rac1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">vim /etc/sysconfig/network</div><div class="line">HOSTNAME=rac1</div></pre></td></tr></table></figure></p><p>rac2<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">vim /etc/sysconfig/network</div><div class="line">HOSTNAME=rac2</div></pre></td></tr></table></figure></p><h3 id="配置hosts"><a href="#配置hosts" class="headerlink" title="配置hosts"></a>配置hosts</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</div><div class="line">########public#######</div><div class="line">192.168.100.11rac1</div><div class="line">192.168.100.12  rac2</div><div class="line"></div><div class="line">#######priv#########</div><div class="line">172.16.10.11rac1-priv</div><div class="line">172.16.10.12rac2-priv</div><div class="line"></div><div class="line">######vip###########</div><div class="line">192.168.100.21rac1-vip</div><div class="line">192.168.100.22rac2-vip</div><div class="line">192.168.100.23rac-scan</div><div class="line"></div><div class="line">172.16.20.13freenas</div></pre></td></tr></table></figure><h3 id="配置时间同步"><a href="#配置时间同步" class="headerlink" title="配置时间同步"></a>配置时间同步</h3><p>关闭ntpd服务，使用oracle自身的集群时间同步<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</div><div class="line">ntpdate cn.ntp.org.cn</div><div class="line">vim /etc/sysconfig/ntpd</div><div class="line">SYNC_HWCLOCK=yes</div><div class="line">OPTIONS=&quot;-x -u ntp:ntp -p /var/run/ntpd.pid&quot;</div><div class="line">/etc/init.d/ntpd stop</div><div class="line">chkconfig ntpd off</div><div class="line">mv /etc/ntp.conf /etc/ntp.conf.bak</div></pre></td></tr></table></figure></p><h3 id="基础软件安装"><a href="#基础软件安装" class="headerlink" title="基础软件安装"></a>基础软件安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">#默认是不安装32位软件包的，添加此选项</div><div class="line">echo &apos;multilib_policy=all&apos; &gt;&gt; /etc/yum.conf</div><div class="line">yum -y install  binutils-* compat-libstdc++-* elfutils-libelf-*  elfutils-libelf-devel-* gcc-* gcc-c++-* glibc-* glibc-common-* glibc-devel-*  glibc-headers-* libaio-*  libaio-devel-* libgcc-*  libstdc++* libstdc++-devel* make-*  sysstat-* unixODBC-* unixODBC-devel-* ksh-* mksh pdksh</div><div class="line">#监测一下软件是否安装全</div><div class="line">rpm -q \</div><div class="line">binutils \</div><div class="line">compat-libstdc++-33 \</div><div class="line">elfutils-libelf \</div><div class="line">elfutils-libelf-devel \</div><div class="line">expat \</div><div class="line">gcc \</div><div class="line">gcc-c++ \</div><div class="line">glibc \</div><div class="line">glibc-common \</div><div class="line">glibc-devel \</div><div class="line">glibc-headers \</div><div class="line">libaio \</div><div class="line">libaio-devel \</div><div class="line">libgcc \</div><div class="line">libstdc++ \</div><div class="line">libstdc++-devel \</div><div class="line">make \</div><div class="line">pdksh \</div><div class="line">sysstat \</div><div class="line">unixODBC \</div><div class="line">unixODBC-devel | grep &quot;not installed&quot;</div></pre></td></tr></table></figure><h3 id="修改PAM配置文件"><a href="#修改PAM配置文件" class="headerlink" title="修改PAM配置文件"></a>修改PAM配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">vi /etc/pam.d/login</div><div class="line">session    required     /lib64/security/pam_limits.so</div></pre></td></tr></table></figure><h3 id="设置内核参数"><a href="#设置内核参数" class="headerlink" title="设置内核参数"></a>设置内核参数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">vi /etc/sysctl.conf</div><div class="line"></div><div class="line">fs.aio-max-nr = 1048576 </div><div class="line">fs.file-max = 6815744 </div><div class="line">kernel.shmmni = 4096 </div><div class="line">kernel.sem = 250 32000 100 128 </div><div class="line">net.ipv4.ip_local_port_range = 9000 65500 </div><div class="line">net.core.rmem_default = 262144 </div><div class="line">net.core.rmem_max = 4194304 </div><div class="line">net.core.wmem_default = 262144 </div><div class="line">net.core.wmem_max = 1048586</div><div class="line"></div><div class="line">重新加载生效</div><div class="line">sysctl –p</div></pre></td></tr></table></figure><h3 id="创建用户grid"><a href="#创建用户grid" class="headerlink" title="创建用户grid"></a>创建用户grid</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">groupadd -g 1000 oinstall </div><div class="line">groupadd -g 1001 asmadmin </div><div class="line">groupadd -g 1002 asmdba </div><div class="line">groupadd -g 1003 asmoper</div><div class="line">useradd -u 1100 -g oinstall -G asmadmin,asmdba,asmoper -d /home/grid -s /bin/bash grid</div><div class="line">#设置密码grid用户密码为oracle</div><div class="line">echo oracle|passwd --stdin grid</div></pre></td></tr></table></figure><h4 id="配置grid用户环境变量"><a href="#配置grid用户环境变量" class="headerlink" title="配置grid用户环境变量"></a>配置grid用户环境变量</h4><p><strong>RAC1：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">su - grid</div><div class="line">#vi .bash_profile</div><div class="line"></div><div class="line">#export PS1=&quot;`/bin/hostname -s`-&gt;&quot;</div><div class="line">export TMP=/tmp</div><div class="line">export TMPDIR=$TMP</div><div class="line">export ORACLE_SID=+ASM1</div><div class="line">export ORACLE_BASE=/u01/app/grid</div><div class="line">export ORACLE_HOME=/u01/app/11.2.0/grid</div><div class="line">export TNS_ADMIN=$ORACLE_HOME/network/admin</div><div class="line">export PATH=/usr/sbin:$PATH</div><div class="line">export PATH=$PATH:$ORACLE_HOME/bin</div><div class="line">export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib</div><div class="line">export LANG=en_US.UTF-8</div><div class="line">export NLS_LANG=AMERICAN_AMERICA.ZHS16GBK</div><div class="line"></div><div class="line">#使配置文件生效</div><div class="line">source .bash_profile</div></pre></td></tr></table></figure></p><p><strong>RAC2：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">su - grid</div><div class="line">#vi .bash_profile</div><div class="line"></div><div class="line">#export PS1=&quot;`/bin/hostname -s`-&gt;&quot;</div><div class="line">export TMP=/tmp</div><div class="line">export TMPDIR=$TMP</div><div class="line">export ORACLE_SID=+ASM2</div><div class="line">export ORACLE_BASE=/u01/app/grid</div><div class="line">export ORACLE_HOME=/u01/app/11.2.0/grid</div><div class="line">export TNS_ADMIN=$ORACLE_HOME/network/admin</div><div class="line">export PATH=/usr/sbin:$PATH</div><div class="line">export PATH=$PATH:$ORACLE_HOME/bin</div><div class="line">export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib</div><div class="line">export LANG=en_US.UTF-8</div><div class="line">export NLS_LANG=AMERICAN_AMERICA.ZHS16GBK</div><div class="line"></div><div class="line">#使配置文件生效</div><div class="line">source .bash_profile</div></pre></td></tr></table></figure></p><h3 id="创建用户oracle"><a href="#创建用户oracle" class="headerlink" title="创建用户oracle"></a>创建用户oracle</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">su - root</div><div class="line">groupadd -g 1200 dba</div><div class="line">groupadd -g 1201 oper</div><div class="line">useradd -u 1101 -g oinstall -G dba,oper,asmdba -d /home/oracle -s /bin/bash oracle</div><div class="line">#设置密码grid用户密码为oracle</div><div class="line">echo oracle|passwd --stdin oracle</div></pre></td></tr></table></figure><h4 id="配置oracle用户环境变量"><a href="#配置oracle用户环境变量" class="headerlink" title="配置oracle用户环境变量"></a>配置oracle用户环境变量</h4><p><strong>RAC1：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">su - oracle</div><div class="line">#vi .bash_profile</div><div class="line"></div><div class="line">#export PS1=&quot;`/bin/hostname -s`-&gt;&quot;</div><div class="line">export TMP=/tmp</div><div class="line">export TMPDIR=$TMP</div><div class="line">export ORACLE_HOSTNAME=rac1</div><div class="line">export ORACLE_SID=orcl1</div><div class="line">export ORACLE_UNQNAME=orcl</div><div class="line">export ORACLE_BASE=/u01/app/oracle</div><div class="line">export ORACLE_HOME=$ORACLE_BASE/11g</div><div class="line">export TNS_ADMIN=$ORACLE_HOME/network/admin</div><div class="line">export PATH=/usr/sbin:$PATH</div><div class="line">export PATH=$PATH:$ORACLE_HOME/bin</div><div class="line">export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib</div><div class="line">export LANG=en_US.UTF-8</div><div class="line">export NLS_LANG=AMERICAN_AMERICA.ZHS16GBK</div><div class="line"></div><div class="line">#使配置文件生效</div><div class="line">source .bash_profile</div></pre></td></tr></table></figure></p><p><strong>RAC2：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">su - oracle</div><div class="line">#vi .bash_profile</div><div class="line"></div><div class="line">#export PS1=&quot;`/bin/hostname -s`-&gt;&quot;</div><div class="line">export TMP=/tmp</div><div class="line">export TMPDIR=$TMP</div><div class="line">export ORACLE_HOSTNAME=rac2</div><div class="line">export ORACLE_SID=orcl2</div><div class="line">export ORACLE_UNQNAME=orcl</div><div class="line">export ORACLE_BASE=/u01/app/oracle</div><div class="line">export ORACLE_HOME=$ORACLE_BASE/11g</div><div class="line">export TNS_ADMIN=$ORACLE_HOME/network/admin</div><div class="line">export PATH=/usr/sbin:$PATH</div><div class="line">export PATH=$PATH:$ORACLE_HOME/bin</div><div class="line">export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib</div><div class="line">export LANG=en_US.UTF-8</div><div class="line">export NLS_LANG=AMERICAN_AMERICA.ZHS16GBK</div><div class="line"></div><div class="line">#使配置文件生效</div><div class="line">source .bash_profile</div></pre></td></tr></table></figure></p><h3 id="创建目录，修改权限"><a href="#创建目录，修改权限" class="headerlink" title="创建目录，修改权限"></a>创建目录，修改权限</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">su - root</div><div class="line">mkdir -p /u01/app/grid </div><div class="line">mkdir -p /u01/app/11.2.0/grid</div><div class="line">chown -R grid:oinstall /u01</div><div class="line">chown -R grid:oinstall /u01/app/11.2.0/grid</div><div class="line">mkdir -p /u01/app/oracle</div><div class="line">chown -R oracle:oinstall /u01/app/oracle</div><div class="line">chmod -R 775 /u01</div><div class="line">export LANG=en_US.UTF-8</div><div class="line">export NLS_LANG=AMERICAN_AMERICA.ZHS16GBK</div></pre></td></tr></table></figure><h3 id="配置profile"><a href="#配置profile" class="headerlink" title="配置profile"></a>配置profile</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">vim /etc/profile</div><div class="line">if [ \$USER = &quot;oracle&quot; ] || [ \$USER = &quot;grid&quot; ];then </div><div class="line">    if [ \$SHELL = &quot;/bin/ksh&quot; ];then </div><div class="line">               ulimit -p 16384 </div><div class="line">               ulimit -n 65536 </div><div class="line">    else </div><div class="line">               ulimit -u 16384 -n 65536 </div><div class="line">    fi </div><div class="line">    umask 022 </div><div class="line">fi</div></pre></td></tr></table></figure><h3 id="修改Oracle用户限制"><a href="#修改Oracle用户限制" class="headerlink" title="修改Oracle用户限制"></a>修改Oracle用户限制</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">vi /etc/security/limits.conf</div><div class="line">oracle soft nproc 2047</div><div class="line">oracle hard nproc 16384</div><div class="line">oracle soft nofile 1024</div><div class="line">oracle hard nofile 65536</div><div class="line">oracle soft stack 10240</div><div class="line">oracle hard stack 32768</div><div class="line"></div><div class="line">grid soft nproc 2047</div><div class="line">grid hard nproc 16384</div><div class="line">grid soft nofile 1024</div><div class="line">grid hard nofile 65536</div><div class="line">grid soft stack 10240</div><div class="line">grid hard stack 32768</div></pre></td></tr></table></figure><h3 id="ssh-互信"><a href="#ssh-互信" class="headerlink" title="ssh 互信"></a>ssh 互信</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">su - grid</div><div class="line">ssh-keygen (一路回车)</div><div class="line">ssh-copy-id -i rac2</div><div class="line">ssh-copy-id -i rac1</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">su - oracle</div><div class="line">ssh-keygen (一路回车)</div><div class="line">ssh-copy-id -i rac2</div><div class="line">ssh-copy-id -i rac1</div></pre></td></tr></table></figure><p>测试一下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ssh rac1 date</div><div class="line">Thu Nov 23 14:00:03 CST 2017</div><div class="line">ssh rac2 date</div><div class="line">Thu Nov 23 14:00:24 CST 2017</div></pre></td></tr></table></figure></p><h1 id="使用FreeNas搭建iscsi存储"><a href="#使用FreeNas搭建iscsi存储" class="headerlink" title="使用FreeNas搭建iscsi存储"></a>使用FreeNas搭建iscsi存储</h1><h2 id="安装操作系统"><a href="#安装操作系统" class="headerlink" title="安装操作系统"></a>安装操作系统</h2><p>使用FreeNAS-9.2.1.7-RELEASE-x64.iso镜像搭建NAS存储，一块系统磁盘，四块存储盘<br><img src="/images/2017/1123/01.png" alt="rac"><br>选择1 Install/Upgrade 安装FreeNAS<br><img src="/images/2017/1123/02.png" alt="rac"><br>选择第一块系统磁盘<br><img src="/images/2017/1123/03.png" alt="rac"><br>全新安装(虚拟机环境之前安装过，新环境应该没有这一步)<br><img src="/images/2017/1123/04.png" alt="rac"><br>安装警告，例行问候，选择Yes<br><img src="/images/2017/1123/05.png" alt="rac"><br>安装完成<br><img src="/images/2017/1123/06.png" alt="rac"><br>重启系统<br><img src="/images/2017/1123/07.png" alt="rac"></p><h2 id="配置网络"><a href="#配置网络" class="headerlink" title="配置网络"></a>配置网络</h2><p>提示是否删除现有的配置，输入n<br><img src="/images/2017/1123/08.png" alt="rac"><br>是否配置DHCP，输入n；是否配置IPv4,输入y；输入ip地址、子网掩码；是否配置IPv6,输入n<br><img src="/images/2017/1123/09.png" alt="rac"><br>配置完成后，即可通过url来管理freenas，访问地址为<a href="http://172.16.20.13" target="_blank" rel="external">http://172.16.20.13</a><br><img src="/images/2017/1123/10.png" alt="rac"><br>新版本第一次登录会让修改密码<br>ps:如果密码忘记，可以在刚才的步骤里选择7）Reset WebGUI login credentials，在此步骤可以输入新密码<br><img src="/images/2017/1123/11.png" alt="rac"></p><h2 id="配置iscsi"><a href="#配置iscsi" class="headerlink" title="配置iscsi"></a>配置iscsi</h2><p>设置中文语言，上海时区<br><img src="/images/2017/1123/12.png" alt="rac"><br>开启iSCSI服务<br><img src="/images/2017/1123/13.png" alt="rac"><br>配置全局目标，设置iSCSI名称iqn.2017-11.cc.islocal.istgt<br><img src="/images/2017/1123/14.png" alt="rac"><br>配置Portals<br><img src="/images/2017/1123/15.png" alt="rac"><br>配置初始的授权<br><img src="/images/2017/1123/16.png" alt="rac"><br>配置授权用户grid<br><img src="/images/2017/1123/17.png" alt="rac"><br>添加iscsi目标设备<br><img src="/images/2017/1123/18.png" alt="rac"><br>依次添加4块存储磁盘<br><img src="/images/2017/1123/19.png" alt="rac"><br><img src="/images/2017/1123/20.png" alt="rac"><br>关联添加的存储设备为LUN<br><img src="/images/2017/1123/21.png" alt="rac"><br><img src="/images/2017/1123/22.png" alt="rac"></p><h1 id="安装Grid-Infrastructure"><a href="#安装Grid-Infrastructure" class="headerlink" title="安装Grid Infrastructure"></a>安装Grid Infrastructure</h1><blockquote><p>如果使用Centos6.x操作系统安装rac，建议使用UEK内核;uek内核是Oracle Linux、Oracle Database、中间件和硬件工程师团队合作的结果，是一个快速、现代、可靠的内核，专门针对Oracle软件和硬件进行了优化。随着硬件的快速发展，为了更好的兼容并支持快速发展的硬件，Linux系统版本及内核也在不断的更新，uek正是在这样的环境下应运而生的产物。<br>安装uek内核可以参考以下文档<br><a href="https://docs.oracle.com/cd/E37670_01/E37355/html/ol_obtain_uek.html" target="_blank" rel="external">https://docs.oracle.com/cd/E37670_01/E37355/html/ol_obtain_uek.html</a><br><a href="https://docs.oracle.com/cd/E52668_01/E39381/html/ol_import_gpg.html" target="_blank" rel="external">https://docs.oracle.com/cd/E52668_01/E39381/html/ol_import_gpg.html</a><br><a href="http://www.oracle.com/technetwork/server-storage/linux/asmlib/index-101839.html" target="_blank" rel="external">http://www.oracle.com/technetwork/server-storage/linux/asmlib/index-101839.html</a></p></blockquote><h2 id="ASM-分区创建"><a href="#ASM-分区创建" class="headerlink" title="ASM 分区创建"></a>ASM 分区创建</h2><h3 id="方法一：使用ASMlib创建ASM分区"><a href="#方法一：使用ASMlib创建ASM分区" class="headerlink" title="方法一：使用ASMlib创建ASM分区"></a>方法一：使用ASMlib创建ASM分区</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">yum -y install oracleasm-support oracle-rdbms-server-11gR2-preinstall</div><div class="line">rpm -ivh http://download.oracle.com/otn_software/asmlib/oracleasmlib-2.0.12-1.el6.x86_64.rpm</div></pre></td></tr></table></figure><p>上传linux.x64_11gR2_grid.zip到/usr/local/src目录下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cd /usr/local/src/</div><div class="line">unzip linux.x64_11gR2_grid.zip</div><div class="line">/usr/local/src/grid/rpm</div><div class="line">rpm -ivh cvuqdisk-1.0.7-1.rpm</div></pre></td></tr></table></figure></p><h4 id="初始化asm"><a href="#初始化asm" class="headerlink" title="初始化asm"></a>初始化asm</h4><p><strong>RAC1</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@rac1 rpm]# /etc/init.d/oracleasm configure -i</div><div class="line">Configuring the Oracle ASM library driver.</div><div class="line"></div><div class="line">This will configure the on-boot properties of the Oracle ASM library</div><div class="line">driver.  The following questions will determine whether the driver is</div><div class="line">loaded on boot and what permissions it will have.  The current values</div><div class="line">will be shown in brackets (&apos;[]&apos;).  Hitting &lt;ENTER&gt; without typing an</div><div class="line">answer will keep that current value.  Ctrl-C will abort.</div><div class="line"></div><div class="line">Default user to own the driver interface [grid]: grid</div><div class="line">Default group to own the driver interface [oinstall]: oinstall</div><div class="line">Start Oracle ASM library driver on boot (y/n) [y]: y</div><div class="line">Scan for Oracle ASM disks on boot (y/n) [y]: y</div><div class="line">Writing Oracle ASM library driver configuration: done</div><div class="line">Initializing the Oracle ASMLib driver:                     [  OK  ]</div><div class="line">Scanning the system for Oracle ASMLib disks:               [  OK  ]</div></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/sbin/oracleasm init</div></pre></td></tr></table></figure><p><strong>RAC2</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@rac2 src]# /etc/init.d/oracleasm configure -i</div><div class="line">Configuring the Oracle ASM library driver.</div><div class="line"></div><div class="line">This will configure the on-boot properties of the Oracle ASM library</div><div class="line">driver.  The following questions will determine whether the driver is</div><div class="line">loaded on boot and what permissions it will have.  The current values</div><div class="line">will be shown in brackets (&apos;[]&apos;).  Hitting &lt;ENTER&gt; without typing an</div><div class="line">answer will keep that current value.  Ctrl-C will abort.</div><div class="line"></div><div class="line">Default user to own the driver interface [grid]: grid</div><div class="line">Default group to own the driver interface [oinstall]: oinstall</div><div class="line">Start Oracle ASM library driver on boot (y/n) [y]: y</div><div class="line">Scan for Oracle ASM disks on boot (y/n) [y]: y</div><div class="line">Writing Oracle ASM library driver configuration: done</div><div class="line">Initializing the Oracle ASMLib driver:                     [  OK  ]</div><div class="line">Scanning the system for Oracle ASMLib disks:               [  OK  ]</div></pre></td></tr></table></figure></p><h4 id="配置iscsi客户端"><a href="#配置iscsi客户端" class="headerlink" title="配置iscsi客户端"></a>配置iscsi客户端</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install iscsi-initiator-utils</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@rac1 rpm]# iscsiadm -m discovery -t sendtargets -p 172.16.20.13</div><div class="line">172.16.20.13:3260,1 iqn.2017-11.cc.islocal.istgt:iscsi</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@rac1 rpm]# /etc/init.d/iscsi restart</div><div class="line">Stopping iscsi:                                            [  OK  ]</div><div class="line">Starting iscsi:                                            [  OK  ]</div></pre></td></tr></table></figure><blockquote><p>iscsi命令拓展<br>查看iscsi target信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">iscsiadm -m node -p ip_addr</div><div class="line">iscsiadm -m node session -p ip_addr</div><div class="line">iscsiadm -m node discovery -P ip_addr</div></pre></td></tr></table></figure></p><p>登录target连接<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iscsiadm -m node -T iqn.2017-11.cc.islocal.istgt:iscsi -p ip_addr -l</div></pre></td></tr></table></figure></p><p>登出target连接<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iscsiadm -m node -T iqn.2017-11.cc.islocal.istgt:iscsi -p ip_addr -u</div></pre></td></tr></table></figure></p><p>删除target条目记录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iscsiadm -m node -o delete -T iqn.2017-11.cc.islocal.istgt:iscsi -p ip_addr</div></pre></td></tr></table></figure></p></blockquote><h4 id="磁盘分区"><a href="#磁盘分区" class="headerlink" title="磁盘分区"></a>磁盘分区</h4><p>fdisk -l  可以发现已经识别到4个磁盘sdb,sdc,sdd,sde,对磁盘进行分区<br><strong>“n/p/1/回车/回车/w”</strong><br><img src="/images/2017/1123/23.png" alt="rac"><br><img src="/images/2017/1123/24.png" alt="rac"></p><h4 id="创建ASM分区"><a href="#创建ASM分区" class="headerlink" title="创建ASM分区"></a>创建ASM分区</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">/etc/init.d/oracleasm createdisk ASMDATA /dev/sdb1</div><div class="line">/etc/init.d/oracleasm createdisk BACKUP /dev/sdc1</div><div class="line">/etc/init.d/oracleasm createdisk OCR /dev/sdd1</div><div class="line">/etc/init.d/oracleasm createdisk VOTINGDISK /dev/sde1</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@rac1 rpm]# /etc/init.d/oracleasm scandisks</div><div class="line">Scanning the system for Oracle ASMLib disks:               [  OK  ]</div><div class="line">[root@rac1 rpm]# /etc/init.d/oracleasm listdisks</div><div class="line">ASMDATA</div><div class="line">BACKUP</div><div class="line">OCR</div><div class="line">VOTINGDISK</div></pre></td></tr></table></figure><h4 id="在rac2上发现asm磁盘"><a href="#在rac2上发现asm磁盘" class="headerlink" title="在rac2上发现asm磁盘"></a>在rac2上发现asm磁盘</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install iscsi-initiator-utils</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@rac2 rpm]# iscsiadm -m discovery -t sendtargets -p 172.16.20.13</div><div class="line">172.16.20.13:3260,1 iqn.2017-11.cc.islocal.istgt:iscsi</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@rac2 rpm]# /etc/init.d/iscsi restart</div><div class="line">Stopping iscsi:                                            [  OK  ]</div><div class="line">Starting iscsi:                                            [  OK  ]</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@rac2 ~]# start_udev </div><div class="line">Starting udev:                                             [  OK  ]</div><div class="line">[root@rac2 src]# /etc/init.d/oracleasm scandisks</div><div class="line">Scanning the system for Oracle ASMLib disks:               [  OK  ]</div><div class="line">[root@rac2 src]# /etc/init.d/oracleasm listdisks</div><div class="line">ASMDATA</div><div class="line">BACKUP</div><div class="line">OCR</div><div class="line">VOTINGDISK</div></pre></td></tr></table></figure><h3 id="方法二：使用udev方式创建ASM分区"><a href="#方法二：使用udev方式创建ASM分区" class="headerlink" title="方法二：使用udev方式创建ASM分区"></a>方法二：使用udev方式创建ASM分区</h3><h4 id="配置iscsi客户端-1"><a href="#配置iscsi客户端-1" class="headerlink" title="配置iscsi客户端"></a>配置iscsi客户端</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install iscsi-initiator-utils</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@rac1 rpm]# iscsiadm -m discovery -t sendtargets -p 172.16.20.13</div><div class="line">172.16.20.13:3260,1 iqn.2017-11.cc.islocal.istgt:iscsi</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@rac1 rpm]# /etc/init.d/iscsi restart</div><div class="line">Stopping iscsi:                                            [  OK  ]</div><div class="line">Starting iscsi:                                            [  OK  ]</div></pre></td></tr></table></figure><p>将ASM磁盘添加到udev，防止开始发现磁盘顺序不一致导致的异常问题<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@rac1 ~]# /sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/sdb1</div><div class="line">3300000007a38757b</div><div class="line">[root@rac1 ~]# /sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/sdc1</div><div class="line">3300000008853f678</div><div class="line">[root@rac1 ~]# /sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/sdd1</div><div class="line">3300000009b03058c</div><div class="line">[root@rac1 ~]# /sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/sde1</div><div class="line">3300000006968868f</div></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@rac1 rules.d]# vim 99-iscsi-asm.rules</div><div class="line">KERNEL==&quot;sd*&quot;, BUS==&quot;scsi&quot;, PROGRAM==&quot;/sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/$name&quot;, RESULT==&quot;3300000007a38757b&quot;, NAME=&quot;asm-data&quot;, OWNER=&quot;grid&quot;, GROUP=&quot;oinstall&quot;, MODE=&quot;0660&quot;</div><div class="line">KERNEL==&quot;sd*&quot;, BUS==&quot;scsi&quot;, PROGRAM==&quot;/sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/$name&quot;, RESULT==&quot;3300000008853f678&quot;, NAME=&quot;asm-backup&quot;, OWNER=&quot;grid&quot;, GROUP=&quot;oinstall&quot;, MODE=&quot;0660&quot;</div><div class="line">KERNEL==&quot;sd*&quot;, BUS==&quot;scsi&quot;, PROGRAM==&quot;/sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/$name&quot;, RESULT==&quot;3300000009b03058c&quot;, NAME=&quot;asm-ocr&quot;, OWNER=&quot;grid&quot;, GROUP=&quot;oinstall&quot;, MODE=&quot;0660&quot;</div><div class="line">KERNEL==&quot;sd*&quot;, BUS==&quot;scsi&quot;, PROGRAM==&quot;/sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/$name&quot;, RESULT==&quot;3300000006968868f&quot;, NAME=&quot;asm-vdisk&quot;, OWNER=&quot;grid&quot;, GROUP=&quot;oinstall&quot;, MODE=&quot;0660&quot;</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@rac1 rules.d]# scp 99-iscsi-asm.rules rac2:/etc/udev/rules.d/99-iscsi-asm.rules</div><div class="line">[root@rac1 rules.d]# start_udev </div><div class="line">Starting udev:                                             [  OK  ]</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@rac1 rules.d]# ll /dev/asm-*</div><div class="line">brw-rw---- 1 grid asmadmin 8, 33 Nov 23 17:48 /dev/asm-backup</div><div class="line">brw-rw---- 1 grid asmadmin 8, 17 Nov 23 17:48 /dev/asm-data</div><div class="line">brw-rw---- 1 grid asmadmin 8, 49 Nov 23 17:48 /dev/asm-ocr</div><div class="line">brw-rw---- 1 grid asmadmin 8, 65 Nov 23 17:48 /dev/asm-vdisk</div></pre></td></tr></table></figure><p>在rac2上发现asm磁盘<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install iscsi-initiator-utils</div></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@rac2 rpm]# iscsiadm -m discovery -t sendtargets -p 172.16.20.13</div><div class="line">172.16.20.13:3260,1 iqn.2017-11.cc.islocal.istgt:iscsi</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@rac2 rpm]# /etc/init.d/iscsi restart</div><div class="line">Stopping iscsi:                                            [  OK  ]</div><div class="line">Starting iscsi:                                            [  OK  ]</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@rac2 ~]# start_udev </div><div class="line">Starting udev:                                             [  OK  ]</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@rac2 ~]# ll /dev/asm-*</div><div class="line">brw-rw---- 1 grid asmadmin 8, 33 Nov 23 17:54 /dev/asm-backup</div><div class="line">brw-rw---- 1 grid asmadmin 8, 17 Nov 23 17:54 /dev/asm-data</div><div class="line">brw-rw---- 1 grid asmadmin 8, 49 Nov 23 17:54 /dev/asm-ocr</div><div class="line">brw-rw---- 1 grid asmadmin 8, 65 Nov 23 17:54 /dev/asm-vdisk</div></pre></td></tr></table></figure><h2 id="安装Grid"><a href="#安装Grid" class="headerlink" title="安装Grid"></a>安装Grid</h2><p>建议直接用grid用户登录图形桌面，而不是root登录su - grid切换过去。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rac1-&gt;cd /usr/local/src/grid</div><div class="line">rac1-&gt;./runcluvfy.sh stage -pre crsinst -n rac1,rac2 -fixup -verbose</div></pre></td></tr></table></figure></p><p>安装前监测一下环境，如果有failed，按照要求去修复，我这里有几个软件包太新，不是太影响，我们就开始安装吧。<br>执行./runInstaller，开始安装<br><img src="/images/2017/1123/25.png" alt="rac"><br>安装和配置一个GI集群<br><img src="/images/2017/1123/26.png" alt="rac"><br>高级安装<br><img src="/images/2017/1123/27.png" alt="rac"><br>添加中文支持<br><img src="/images/2017/1123/28.png" alt="rac"><br>取消GNS选项，保持SCAN Name和hosts里配置的一样<br><img src="/images/2017/1123/29.png" alt="rac"><br>添加rac2<br><img src="/images/2017/1123/30.png" alt="rac"><br>根据之前配置的网络，配置网络类型<br><img src="/images/2017/1123/31.png" alt="rac"><br>选择ASM存储<br><img src="/images/2017/1123/32.png" alt="rac"><br><em>这里遇到几个几个坑，详细说一下吧；1.如果默认没有在候选磁盘(Candidate Disks)里,选择所有磁盘(All disks),看看是否可以显示出来；2.如果还是没有发现，点一下改变其他路径(Change Discovery Path),rhel系列系统默认路径是/dev/raw/\</em>, 我这里是/dev/asm-*;3.如果磁盘显示出来是灰色，不能选择，可能是练习的时候，之前已经使用过磁盘做过asm了，可以执行“dd if=/dev/zero of=/dev/rhdisk2 bs=1024 count=100”，然后重新开始安装试试，如果还不行，请从存储方面开始排查；4.我这里配置的udev方式发现保证磁盘的唯一性，现在发现一个问题，start_udev后可以发现磁盘，/dev/asm-*都生成了；执行oraclescandisk后发现不了ASM磁盘，/dev/oracleasm/disks/目录下是空的，但是安装时候找到了，是可用状态，有点小疑惑。*<br>ASM提供三种冗余模式，我们使用External；ASM三种模式后期学习了，在单独写一篇吧。<br><img src="/images/2017/1123/33.png" alt="rac"><br>选择Yes<br><img src="/images/2017/1123/34.png" alt="rac"><br>默认<br><img src="/images/2017/1123/35.png" alt="rac"><br>默认的三个组<br><img src="/images/2017/1123/36.png" alt="rac"><br>默认安装路径<br><img src="/images/2017/1123/37.png" alt="rac"><br><img src="/images/2017/1123/38.png" alt="rac"><br><img src="/images/2017/1123/39.png" alt="rac"><br>忽略ALL<br><img src="/images/2017/1123/40.png" alt="rac"><br>所有的配置信息<br><img src="/images/2017/1123/41.png" alt="rac"><br>安装完成，使用root账号依次在rac1，rac2上执行脚本;<br><img src="/images/2017/1123/42.png" alt="rac"><br>如果你执行root.sh出现以下错误，恭喜你！这个问题折磨了我太久，后来在网上看到这是一个bug！<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">CRS-4124: Oracle High Availability Services startup failed.</div><div class="line">CRS-4000: Command Start failed, or completed with errors.</div><div class="line">ohasd failed to start: Inappropriate ioctl for device</div><div class="line">ohasd failed to start at /opt/app/11.2.0/grid/crs/install/rootcrs.pl line 443.</div></pre></td></tr></table></figure></p><p>此错误<a href="http://blog.sina.com.cn/s/blog_563c17780102ux53.html" target="_blank" rel="external">解决方法</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">删除之前的配置：/u01/app/11.2.0/grid/crs/install/roothas.pl -deconfig -force -verbose</div><div class="line">窗口1：/u01/app/11.2.0/grid/root.sh</div><div class="line">窗口2：/bin/dd if=/var/tmp/.oracle/npohasd of=/dev/null bs=1024 count=1  （刚开始执行root.sh时候，还没生成npohash文件，等日志出现“Adding daemon to inittab”的时候，在窗口2中使用root用户执行此命令，等root.sh执行成功后，ctrl+c结束此命令即可）</div></pre></td></tr></table></figure></p><p><img src="/images/2017/1123/43.png" alt="rac"><br>出现以下提示，方为脚本执行成功。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Configure Oracle Grid Infrastructure for a Cluster ... succeeded</div><div class="line">Updating inventory properties for clusterware</div><div class="line">Starting Oracle Universal Installer...</div><div class="line"></div><div class="line">Checking swap space: must be greater than 500 MB.   Actual 7999 MB    Passed</div><div class="line">The inventory pointer is located at /etc/oraInst.loc</div><div class="line">The inventory is located at /u01/app/oraInventory</div></pre></td></tr></table></figure></p><p>这个错误没事，直接点击Next<br><img src="/images/2017/1123/44.png" alt="rac"><br>完成安装<br><img src="/images/2017/1123/45.png" alt="rac"></p><h2 id="验证安装状态"><a href="#验证安装状态" class="headerlink" title="验证安装状态"></a>验证安装状态</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">su - grid</div><div class="line">crs_stat -t</div><div class="line">crsctl check cluster -all</div><div class="line">olsnodes -s -n -t</div><div class="line">crsctl check crs</div><div class="line">srvctl status asm</div><div class="line">srvctl status scan</div><div class="line">srvctl status vip -n rac1</div><div class="line">srvctl status scan_listener</div></pre></td></tr></table></figure><p><img src="/images/2017/1123/46.png" alt="rac"><br><img src="/images/2017/1123/47.png" alt="rac"></p><h2 id="创建ASM磁盘组"><a href="#创建ASM磁盘组" class="headerlink" title="创建ASM磁盘组"></a>创建ASM磁盘组</h2><p>在grid 用户下，执行 asmca，启动 asm 磁盘组创建向导<br>DATA组，存放数据文件，包括/dev/asm-data,/dev/asm-backup;VOTINGDISK组，存放闪回文件，包含/dev/asm-vdisk<br>Disk Groups，点击create 按钮，在弹出的创建界面中填写磁盘组名称，选择external(none)，并勾选成员，选择完毕后点击 ok；<br><img src="/images/2017/1123/48.png" alt="rac"><br><img src="/images/2017/1123/49.png" alt="rac"><br><img src="/images/2017/1123/50.png" alt="rac"><br>确认stat为2 of 2时,退出asmca<br><img src="/images/2017/1123/51.png" alt="rac"></p><h1 id="安装oracle11gr2-database-软件"><a href="#安装oracle11gr2-database-软件" class="headerlink" title="安装oracle11gr2 database 软件"></a>安装oracle11gr2 database 软件</h1><p>建议直接用oracle用户登录图形桌面，而不是root登录su - oracle切换过去。这个安装过程也很简单，基本上和单机版的一样；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rac1-&gt;cd /usr/local/src/database</div><div class="line">rac1-&gt;./runInstaller</div></pre></td></tr></table></figure></p><p><img src="/images/2017/1123/52.png" alt="rac"><br>创建和配置一个数据库<br><img src="/images/2017/1123/53.png" alt="rac"><br>服务器模式<br><img src="/images/2017/1123/54.png" alt="rac"><br>选择rac集群中的节点<br><img src="/images/2017/1123/55.png" alt="rac"><br>高级安装<br><img src="/images/2017/1123/56.png" alt="rac"><br>添加中文支持<br><img src="/images/2017/1123/57.png" alt="rac"><br>服务器版本<br><img src="/images/2017/1123/58.png" alt="rac"><br>默认安装路径<br><img src="/images/2017/1123/59.png" alt="rac"><br>一般用途<br><img src="/images/2017/1123/60.png" alt="rac"><br>实例名称，SID名称<br><img src="/images/2017/1123/61.png" alt="rac"><br><code>(ps:这里的截图稍微有点问题，sid应该是orcl，不是orcl1)</code><br>自动分配内存<br><img src="/images/2017/1123/62.png" alt="rac"><br>选择中文字符集<br><img src="/images/2017/1123/63.png" alt="rac"><br><img src="/images/2017/1123/64.png" alt="rac"><br>连接asm存储的密码<br><img src="/images/2017/1123/65.png" alt="rac"><br>不备份<br><img src="/images/2017/1123/66.png" alt="rac"><br>选择DATA磁盘组<br><img src="/images/2017/1123/67.png" alt="rac"><br>设置sys/system密码<br><img src="/images/2017/1123/68.png" alt="rac"><br>默认管理组<br><img src="/images/2017/1123/69.png" alt="rac"><br>监测依赖<br><img src="/images/2017/1123/70.png" alt="rac"><br>配置信息<br><img src="/images/2017/1123/71.png" alt="rac"><br><img src="/images/2017/1123/72.png" alt="rac"><br>安装完成<br><img src="/images/2017/1123/73.png" alt="rac"><br><img src="/images/2017/1123/74.png" alt="rac"><br>依次执行脚本<br><img src="/images/2017/1123/75.png" alt="rac"><br><img src="/images/2017/1123/76.png" alt="rac"><br><img src="/images/2017/1123/77.png" alt="rac"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Entries will be added to the /etc/oratab file as needed by</div><div class="line">Database Configuration Assistant when a database is created</div><div class="line">Finished running generic part of root.sh script.</div><div class="line">Now product-specific root actions will be performed.</div><div class="line">Finished product-specific root actions.</div></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sqlplus system/oracle@orcl</div><div class="line">select inst_id,instance_number,instance_name from gv$instance;</div></pre></td></tr></table></figure><p><img src="/images/2017/1123/78.png" alt="rac"></p><p>参考资料：<br><a href="http://v.qq.com/vplus/91c845f5c21fd8a6a25e9827b38c171e" target="_blank" rel="external">http://v.qq.com/vplus/91c845f5c21fd8a6a25e9827b38c171e</a><br><a href="http://www.dba-oracle.com/t_reset_an_asm_diskgroup.htm" target="_blank" rel="external">http://www.dba-oracle.com/t_reset_an_asm_diskgroup.htm</a><br><a href="http://www.oracle.com/technetwork/cn/articles/hunter-rac11gr2-iscsi-083834-zhs.html" target="_blank" rel="external">http://www.oracle.com/technetwork/cn/articles/hunter-rac11gr2-iscsi-083834-zhs.html</a><br><a href="http://blog.csdn.net/u010098331/article/details/50767353" target="_blank" rel="external">http://blog.csdn.net/u010098331/article/details/50767353</a><br><a href="https://docs.oracle.com/cd/E11882_01/doc.112/e28441/require.htm#CDMIG110" target="_blank" rel="external">https://docs.oracle.com/cd/E11882_01/doc.112/e28441/require.htm#CDMIG110</a><br><a href="http://blog.sina.com.cn/s/blog_563c17780102ux53.html" target="_blank" rel="external">http://blog.sina.com.cn/s/blog_563c17780102ux53.html</a><br><a href="https://blogs.oracle.com/database4cn/11gr2-crsgrid-scansingle-client-access-name" target="_blank" rel="external">https://blogs.oracle.com/database4cn/11gr2-crsgrid-scansingle-client-access-name</a></p><hr>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 集群 </tag>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
            <tag> RAC </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Windows组策略几个问题小计</title>
      <link href="/arlo/9bdfcc8c/"/>
      <url>/arlo/9bdfcc8c/</url>
      
        <content type="html"><![CDATA[<h1 id="桌面没有“计算机”"><a href="#桌面没有“计算机”" class="headerlink" title="桌面没有“计算机”"></a>桌面没有“计算机”</h1><p>开始-运行-输入以下内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rundll32.exe shell32.dll,Control_RunDLL desk.cpl,,0</div></pre></td></tr></table></figure></p><h1 id="注册表编辑被管理员禁用"><a href="#注册表编辑被管理员禁用" class="headerlink" title="注册表编辑被管理员禁用"></a>注册表编辑被管理员禁用</h1><p><img src="/images/2017/1031/01.png" alt="windows"><br>第一步：打开组策略窗口，开始-运行-gptdit.msc<br>第二步：选择用户配置-管理模板-系统，双击系统选项找到【阻止访问注册表编辑工具】<br>第三步：双击【阻止访问注册表编辑工具】选择已禁用，点击确定。<br>第四步：在开始-运行输入regedit，打开注册表。 说明注册表已经可以访问了。<br><a id="more"></a></p><h1 id="服务灰色，无法正常使用"><a href="#服务灰色，无法正常使用" class="headerlink" title="服务灰色，无法正常使用"></a>服务灰色，无法正常使用</h1><p>MMC 在该文档中引用的管理单元受到策略限制<br><img src="/images/2017/1031/02.png" alt="windows"><br><img src="/images/2017/1031/03.png" alt="windows"><br>第一步：开始-运行-regedit，启动注册表编辑器<br>第二步：HKEY_CURRENT_USER\Software\Policies\Microsoft\MMC{58221C66-EA27-11CF-ADCF-00AA00A80033}\Restrict_Run，将值设为0<br><img src="/images/2017/1031/04.png" alt="windows"></p><h1 id="任务管理器无法正常使用"><a href="#任务管理器无法正常使用" class="headerlink" title="任务管理器无法正常使用"></a>任务管理器无法正常使用</h1><p><img src="/images/2017/1031/05.png" alt="windows"><br>第一步：打开组策略窗口，开始-运行-gptdit.msc<br>第二步：选择用户配置-管理模板-系统-Ctrl+Alt+Del选项<br>第三步：在该列表中打开 删除“任务管理器” 的属性，在 删除“任务管理器” 属性中的“设置”选项卡中点选“已禁用”，确定。<br><img src="/images/2017/1031/06.png" alt="windows"></p><h1 id="要远程登录，你需要具有通过远程桌面服务进行的登录权限"><a href="#要远程登录，你需要具有通过远程桌面服务进行的登录权限" class="headerlink" title="要远程登录，你需要具有通过远程桌面服务进行的登录权限"></a>要远程登录，你需要具有通过远程桌面服务进行的登录权限</h1><p><img src="/images/2017/1031/07.png" alt="windows"><br>要远程登录，你需要具有通过远程桌面服务进行的登录权限。默认情况下，远程桌面用户组的成员有这项权限。如果你所属的组没有这项权限，或者远程桌面用户组已经删除了这项权限，那么需要手动为你授予这一权限<br>第一步：gpedit进入策略组:计算机配置-&gt;Windows设置-&gt;安全设置-&gt;本地策略-&gt;用户权限分配<br>第二步：找到拒绝通过远程桌面服务登录,把里面的账号去了即可</p><h1 id="修改远程登录3389端口"><a href="#修改远程登录3389端口" class="headerlink" title="修改远程登录3389端口"></a>修改远程登录3389端口</h1><p>第一步: 打开“开始→运行”，输入“regedit”，打开注册表，<br>第二步: 进入[HKEY_LOCAL_MACHINE/SYSTEM/CurrentControlSet/Control/Terminal Server/Wds/rdpwd/Tds/tcp]，将PortNamber值(默认值是3389)，修改为新的端口，例如12389，注意使用十进制。<br>第三部：进入[HKEY_LOCAL_MACHINE/SYSTEM/CurrentControlSet/Control/Terminal Server/WinStations/RDP-Tcp]，将PortNumber值(默认是3389)修改为新的端口，如12389，注意使用十进制。</p><h1 id="修改远程桌面最大连接数"><a href="#修改远程桌面最大连接数" class="headerlink" title="修改远程桌面最大连接数"></a>修改远程桌面最大连接数</h1><p>第一步: 打开组策略设置gpedit.msc–&gt;计算机配置–&gt;管理模板–&gt;Windows 组件–&gt;远程桌面服务–&gt;远程桌面会话主机–&gt;连接–&gt;限制连接数量<br>第二步: 打开组策略设置gpedit.msc–&gt;计算机配置–&gt;管理模板–&gt;Windows 组件–&gt;远程桌面服务–&gt;远程桌面会话主机–&gt;连接–&gt;将远程桌面服务用户限制到单独的远程桌面服务会话(已禁用)</p><h1 id="Win10家庭版找不到gpedit-msc组策略"><a href="#Win10家庭版找不到gpedit-msc组策略" class="headerlink" title="Win10家庭版找不到gpedit.msc组策略"></a>Win10家庭版找不到gpedit.msc组策略</h1><p>复制一下内容，新建一个.bat文件，然后使用管理员身份运行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">@echo off</div><div class="line"></div><div class="line">pushd &quot;%~dp0&quot;</div><div class="line"></div><div class="line">dir /b C:\Windows\servicing\Packages\Microsoft-Windows-GroupPolicy-ClientExtensions-Package~3*.mum &gt;List.txt</div><div class="line"></div><div class="line">dir /b C:\Windows\servicing\Packages\Microsoft-Windows-GroupPolicy-ClientTools-Package~3*.mum &gt;&gt;List.txt</div><div class="line"></div><div class="line">for /f %%i in (&apos;findstr /i . List.txt 2^&gt;nul&apos;) do dism /online /norestart /add-package:&quot;C:\Windows\servicing\Packages\%%i&quot;</div><div class="line"></div><div class="line">pause</div></pre></td></tr></table></figure></p><h1 id="出现身份验证错误，要求的函数不受支持"><a href="#出现身份验证错误，要求的函数不受支持" class="headerlink" title="出现身份验证错误，要求的函数不受支持"></a>出现身份验证错误，要求的函数不受支持</h1><p>在本地计算机上操作，非远程计算机！！！</p><h2 id="修改组策略解决"><a href="#修改组策略解决" class="headerlink" title="修改组策略解决"></a>修改组策略解决</h2><p><img src="/images/2017/1031/08.png" alt="windows"><br>此错误原因是检查更新了KB4103718的补丁造成的。</p><p>使用微软官方建议修改本地组策略：</p><ol><li>开始运行输入gpedit.msc</li><li>计算机配置&gt;管理模板&gt;系统&gt;凭据分配&gt;加密Oracle修正 选择启用并选择易受攻击。</li><li>易受攻击– 使用 CredSSP 的客户端应用程序将通过支持回退到不安全的版本使远程服务器遭受攻击，但使用 CredSSP 的服务将接受未修补的客户端。</li></ol><p><img src="/images/2017/1031/09.png" alt="windows"><br>PS:该操作仅用于专业版，如果是家庭版请考虑升级(本人是家庭版，在X宝上买的key升级为专业版了);<br>或者卸载KB4103718补丁重启。</p><h2 id="修改注册表解决"><a href="#修改注册表解决" class="headerlink" title="修改注册表解决"></a>修改注册表解决</h2><p>Windows10家庭版的用户，因为系统中没有组策略编辑器，需要修改注册表来实现。 </p><ol><li>开始-运行-输入 “regedit”</li><li>找到注册表路径：HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System\CredSSP\Parameters  </li><li>一般系统下，大概到了System后面再没有后面的路径，需要自行手动新建\CredSSP\Parameters </li><li>先新建项“CredSSP”，然后在CredSSP下新建项“Parameters” </li><li>然后在“Parameters”下新建DWORD(32位)，名称为“AllowEncryptionOracle”，设置值为“2”。 </li><li>然后进行尝试，如果不行，请重启一下自己的计算机。 </li></ol><h1 id="Windows远程桌面密码不能保存"><a href="#Windows远程桌面密码不能保存" class="headerlink" title="Windows远程桌面密码不能保存"></a>Windows远程桌面密码不能保存</h1><ol><li>打开组策略设置gpedit.msc </li><li>计算机配置 &gt;&gt; 管理模板 &gt;&gt; 系统 &gt;&gt; 凭据分配 下面的 “允许分配保存的凭据用于仅NTLM服务器身份验证”</li><li>选择已启用，点击显示将TERMSRV/*添加到列表中</li></ol><h1 id="没有远程桌面授权服务器可以提供许可证，远程会话被中断"><a href="#没有远程桌面授权服务器可以提供许可证，远程会话被中断" class="headerlink" title="没有远程桌面授权服务器可以提供许可证，远程会话被中断"></a>没有远程桌面授权服务器可以提供许可证，远程会话被中断</h1><ol><li>开始-运行-输入 “regedit”</li><li>找到注册表路径：HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\RCM\GracePeriod</li><li>删除右侧子项，如下图所示；如果删除报错，请修改GracePeriod权限，增加administrator的权限（可用120天）<br><img src="/images/2017/1031/10.png" alt="windows"></li></ol><h1 id="修复图片查看器"><a href="#修复图片查看器" class="headerlink" title="修复图片查看器"></a>修复图片查看器</h1><p>复制以下内容，新建.reg文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">Windows Registry Editor Version 5.00</div><div class="line"></div><div class="line"> ; Change Extension&apos;s File Type</div><div class="line"></div><div class="line"> [HKEY_CURRENT_USER\Software\Classes\.jpg]</div><div class="line"></div><div class="line"> @=&quot;PhotoViewer.FileAssoc.Tiff&quot;</div><div class="line"></div><div class="line"> ; Change Extension&apos;s File Type</div><div class="line"></div><div class="line"> [HKEY_CURRENT_USER\Software\Classes\.jpeg]</div><div class="line"></div><div class="line"> @=&quot;PhotoViewer.FileAssoc.Tiff&quot;</div><div class="line"></div><div class="line"> ; Change Extension&apos;s File Type</div><div class="line"></div><div class="line"> [HKEY_CURRENT_USER\Software\Classes\.gif]</div><div class="line"></div><div class="line"> @=&quot;PhotoViewer.FileAssoc.Tiff&quot;</div><div class="line"></div><div class="line"> ; Change Extension&apos;s File Type</div><div class="line"></div><div class="line"> [HKEY_CURRENT_USER\Software\Classes\.png]</div><div class="line"></div><div class="line"> @=&quot;PhotoViewer.FileAssoc.Tiff&quot;</div><div class="line"></div><div class="line"> ; Change Extension&apos;s File Type</div><div class="line"></div><div class="line"> [HKEY_CURRENT_USER\Software\Classes\.bmp]</div><div class="line"></div><div class="line"> @=&quot;PhotoViewer.FileAssoc.Tiff&quot;</div><div class="line"></div><div class="line"> ; Change Extension&apos;s File Type</div><div class="line"></div><div class="line"> [HKEY_CURRENT_USER\Software\Classes\.tiff]</div><div class="line"></div><div class="line"> @=&quot;PhotoViewer.FileAssoc.Tiff&quot;</div><div class="line"></div><div class="line"> ; Change Extension&apos;s File Type</div><div class="line"></div><div class="line"> [HKEY_CURRENT_USER\Software\Classes\.ico]</div><div class="line"></div><div class="line"> @=&quot;PhotoViewer.FileAssoc.Tiff&quot;</div></pre></td></tr></table></figure><p>参考地址：<br><a href="http://ytweb.blog.51cto.com/5865824/1177266" target="_blank" rel="external">http://ytweb.blog.51cto.com/5865824/1177266</a><br><a href="https://jingyan.baidu.com/article/3a2f7c2e6ab84626afd61114.html" target="_blank" rel="external">https://jingyan.baidu.com/article/3a2f7c2e6ab84626afd61114.html</a><br><a href="http://blog.sina.com.cn/s/blog_4298a2c80102vii4.html" target="_blank" rel="external">http://blog.sina.com.cn/s/blog_4298a2c80102vii4.html</a><br><a href="http://www.cnblogs.com/q149072205/p/6097433.html" target="_blank" rel="external">http://www.cnblogs.com/q149072205/p/6097433.html</a><br><a href="http://blog.csdn.net/flyingdream123/article/details/50724107" target="_blank" rel="external">http://blog.csdn.net/flyingdream123/article/details/50724107</a><br><a href="http://www.soncs.com/NewsShow/144.html" target="_blank" rel="external">http://www.soncs.com/NewsShow/144.html</a></p>]]></content>
      
      
      <categories>
          
          <category> Troubleshooting </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> 组策略 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Win10无法正常连接sslvpn</title>
      <link href="/arlo/e72ff5d/"/>
      <url>/arlo/e72ff5d/</url>
      
        <content type="html"><![CDATA[<h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><p>Dell燃7000<br>Win 10 64bit<br>Hangzhou DPtech Co.,Ltd. SSL VPN</p><h1 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h1><p>1、无法创建虚拟网卡<br>2、使用vpn自带的修复工具后驱动不对，“Windows 无法验证此设备所需的驱动程序的数字签名。该值受安全引导策略保护，无法进行修改或删除”</p><h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><p>1、重新笔记本<br>2、进入BIOS-Secure Boot，取消Windows UEFI模式<br>3、删除Secure Key(可以备份一下，我没备份，删除后暂时未发现异常)<br>4、重启后秒拨<br>参考：<a href="http://www.cnblogs.com/easyc/p/6132581.html" target="_blank" rel="external">http://www.cnblogs.com/easyc/p/6132581.html</a></p>]]></content>
      
      
      <categories>
          
          <category> Troubleshooting </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> vpn </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Jenkins使用Publish Over CIFS插件实现静态页面部署到Windows服务器</title>
      <link href="/arlo/9a888771/"/>
      <url>/arlo/9a888771/</url>
      
        <content type="html"><![CDATA[<p>发布静态内容操作很简单，一般分两步；一、获取svn内容。二、拷贝到服务器发布目录；<br>以前静态内容都是在Linux环境下使用Nginx发布，持续集成发布的时候<a href="http://wiki.hudson-ci.org/display/HUDSON/SCP+plugin" target="_blank" rel="external">Hudson SCP publisher plugin</a>,调用linux下Scp命令，通过SSH协议拷贝到发布目录就可以了；<br>最近遇到一个问题，需要发布静态页面到Windows服务器下。不论是IIS，还是Nginx，也都存在一个拷贝内容到发布目录的问题，Windows下采取目录共享方式，通过CIFS协议拷贝。<br><a id="more"></a></p><h1 id="共享发布目录"><a href="#共享发布目录" class="headerlink" title="共享发布目录"></a>共享发布目录</h1><p>共享nginx发布目录jzhome<br><img src="/images/2017/1024/01.png" alt="jenkins"></p><h1 id="Nginx-配置文件修改"><a href="#Nginx-配置文件修改" class="headerlink" title="Nginx 配置文件修改"></a>Nginx 配置文件修改</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">……</div><div class="line"> server &#123;</div><div class="line">        listen       80;</div><div class="line">        server_name  localhost;</div><div class="line">        location / &#123;</div><div class="line">    root   html;</div><div class="line">            index  index.html index.htm;</div><div class="line">        &#125;</div><div class="line">location /mypic &#123;</div><div class="line">    proxy_pass   http://127.0.0.1:8888/mypic;</div><div class="line">&#125;</div><div class="line">location /JzAir &#123;</div><div class="line">    proxy_pass   http://127.0.0.1:9999/JzAir;</div><div class="line">&#125;</div><div class="line">        location /Jzapp &#123;</div><div class="line">    proxy_pass   http://127.0.0.1:8080/Jzapp;</div><div class="line">&#125;</div><div class="line">location /jzhome &#123;</div><div class="line">    root   F:\\deploy\\nginx-1.12.1\\;</div><div class="line">    index  index.html index.htm;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">……</div></pre></td></tr></table></figure><h1 id="安装Jenkins插件"><a href="#安装Jenkins插件" class="headerlink" title="安装Jenkins插件"></a>安装Jenkins插件</h1><p>安装<a href="https://plugins.jenkins.io/publish-over-cifs" target="_blank" rel="external">Publish Over CIFS</a>插件，安装完成后重启Jenkins</p><h1 id="配置CIFS"><a href="#配置CIFS" class="headerlink" title="配置CIFS"></a>配置CIFS</h1><p>Jenkins-系统管理-系统配置-Publish over CIFS<br><img src="/images/2017/1024/02.png" alt="jenkins"></p><h1 id="配置Job"><a href="#配置Job" class="headerlink" title="配置Job"></a>配置Job</h1><p>Job-构建后步骤<br><img src="/images/2017/1024/03.png" alt="jenkins"><br><em>PS:这里有点比较难懂一点，Source files要一个能包含所有发布内容的父级目录，所以当发布内容为abc/html/xxx,我们在获取svn代码的时候，获取到abc这一层，这里Source files填写html/**,Remove prefix填写html,Remote directory为空，就可以将html目录下的所有内容发布到共享服务器上</em><br><img src="/images/2017/1024/04.png" alt="jenkins"></p><h2 id=""><a href="#" class="headerlink" title=""></a><img src="/images/2017/1024/05.png" alt="jenkins"></h2>]]></content>
      
      
      <categories>
          
          <category> 自动化运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 运维 </tag>
            
            <tag> 自动化 </tag>
            
            <tag> Jenkins </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Zabbix(6)监控SQL Server数据库</title>
      <link href="/arlo/35d80780/"/>
      <url>/arlo/35d80780/</url>
      
        <content type="html"><![CDATA[<p>监控SQL Server相对来说比较简单，首先我们下载一个MS SQL的模板文件<br>下载地址：<a href="https://share.zabbix.com/databases/microsoft-sql-server/template-ms-sql-2012" target="_blank" rel="external">https://share.zabbix.com/databases/microsoft-sql-server/template-ms-sql-2012</a><br><a id="more"></a></p><h1 id="修改zabbix-agent-conf文件"><a href="#修改zabbix-agent-conf文件" class="headerlink" title="修改zabbix_agent.conf文件"></a>修改zabbix_agent.conf文件</h1><p>添加下边这行到配置文件最后<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">UserParameter=sqldatabasename.discovery,powershell -NoProfile -ExecutionPolicy Bypass -File C:\zabbix\scripts\SQLBaseName_To_Zabbix.ps1</div></pre></td></tr></table></figure></p><h1 id="将powershell脚本放在目录下"><a href="#将powershell脚本放在目录下" class="headerlink" title="将powershell脚本放在目录下"></a>将powershell脚本放在目录下</h1><p>将SQLBaseName_To_Zabbix.ps1脚本放在C:\zabbix\scripts\目录下</p><h1 id="重启zabbix-agent"><a href="#重启zabbix-agent" class="headerlink" title="重启zabbix agent"></a>重启zabbix agent</h1><p>重启客户端zabbix agent服务</p><h1 id="导入模板文件"><a href="#导入模板文件" class="headerlink" title="导入模板文件"></a>导入模板文件</h1><p>导入模板MS SQL 2012.xml</p><h1 id="关联模板"><a href="#关联模板" class="headerlink" title="关联模板"></a>关联模板</h1><p><img src="/images/2017/1019/00.png" alt="zabbix_mssql"></p><h1 id="查看最新数据"><a href="#查看最新数据" class="headerlink" title="查看最新数据"></a>查看最新数据</h1><p><img src="/images/2017/1019/01.png" alt="zabbix_mssql"></p>]]></content>
      
      
      <categories>
          
          <category> 监控 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> zabbix </tag>
            
            <tag> 监控 </tag>
            
            <tag> MSSQL </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Zabbix(5)通过JMX监控Tomcat</title>
      <link href="/arlo/e35d6a2a/"/>
      <url>/arlo/e35d6a2a/</url>
      
        <content type="html"><![CDATA[<p>Zabbix监控tomcat主要使用的是zabbix的zabbix-java-gateway。从Zabbix 2.0开始，内置了监控JMX的功能，叫做“Zabbix Java Gateway”，在Zabbix Server和Zabbix Proxy上启动名为“Zabbix Java Gateway”的进程，当需要获取JMX数据时，Zabbix Server会“问”JMX Gateway，然后JMX Gateway根据JMX管理API去查询需要的数据。在使用时，Java程序不需要在代码中新增任何东西，只需要在启动的时候加上一些JVM参数，使得它可以支持使用端口监控JMX。JMX的全称是Java Management Extensions，即Java管理扩展。Java程序会开放一些端口，用来获取运行状况。<br><a id="more"></a></p><h1 id="安装jmx服务器"><a href="#安装jmx服务器" class="headerlink" title="安装jmx服务器"></a>安装jmx服务器</h1><h2 id="安装jdk"><a href="#安装jdk" class="headerlink" title="安装jdk"></a>安装jdk</h2><p><a href="http://www.oracle.com/technetwork/java/archive-139210.html" target="_blank" rel="external">下载JDK</a><br><a href="http://islocal.cc/2017/09/27/JDK环境变量配置/">配置环境变量</a></p><h2 id="安装jmx服务"><a href="#安装jmx服务" class="headerlink" title="安装jmx服务"></a>安装jmx服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install zabbix-java-gateway</div></pre></td></tr></table></figure><h2 id="配置jmx服务"><a href="#配置jmx服务" class="headerlink" title="配置jmx服务"></a>配置jmx服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">egrep -v &apos;#|^$&apos; /etc/zabbix/zabbix_java_gateway.conf</div><div class="line">LISTEN_IP=&quot;0.0.0.0&quot;</div><div class="line">LISTEN_PORT=10052</div><div class="line">PID_FILE=&quot;/var/run/zabbix/zabbix_java.pid&quot;</div><div class="line">START_POLLERS=5</div><div class="line">TIMEOUT=3</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">systemctl start zabbix-java-gateway</div><div class="line">systemctl enable zabbix-java-gateway</div></pre></td></tr></table></figure><h2 id="修改zabbix-server配置"><a href="#修改zabbix-server配置" class="headerlink" title="修改zabbix server配置"></a>修改zabbix server配置</h2><p><em>添加以下三行，这里配置的StartJavaPollers值要小于之前java_gateway中的START_POLLERS</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">tail -n 3 /etc/zabbix/zabbix_server.conf </div><div class="line">JavaGateway=127.0.0.1</div><div class="line">JavaGatewayPort=10052     </div><div class="line">StartJavaPollers=3</div></pre></td></tr></table></figure></p><p>修改zabbix_server.conf后重启服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">systemctl restart zabbix-server</div></pre></td></tr></table></figure></p><h1 id="Tomcat配置修改"><a href="#Tomcat配置修改" class="headerlink" title="Tomcat配置修改"></a>Tomcat配置修改</h1><h2 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h2><p>Windows下tomcat在F:\apache-tomcat-7.0.70(zabbix)\bin\catalina.bat中set “CURRENT_DIR=%cd%”下添加以下内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">set CATALINA_OPTS=-Dcom.sun.management.jmxremote.port=12345 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false</div><div class="line"># 如果zabbix添加JMX后报错“java.net.SocketTimeoutException: connection timed out: service:jmx:rmi:///jndi/rmi:/”  添加此参数 -Djava.rmi.server.hostname=192.168.6.124</div></pre></td></tr></table></figure></p><h2 id="测试JMX"><a href="#测试JMX" class="headerlink" title="测试JMX"></a>测试JMX</h2><p>下载以下两个jar包放在tomcat lib目录下。<br>下载<a href="http://crawler.archive.org/cmdline-jmxclient/cmdline-jmxclient-0.10.3.jar" target="_blank" rel="external">cmdline-jmxclient-0.10.3.jar</a><br>下载<a href="https://archive.apache.org/dist/tomcat/tomcat-7/v7.0.77/bin/extras/catalina-jmx-remote.jar" target="_blank" rel="external">catalina-jmx-remote.jar</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">F:\apache-tomcat-7.0.70(zabbix)\lib&gt;java -jar cmdline-jmxclient-0.10.3.jar - 192.168.6.124:12345 java.lang:type=Memory NonHeapMemoryUsage</div><div class="line">10/10/2017 16:31:57 +0800 org.archive.jmx.Client NonHeapMemoryUsage:</div><div class="line">committed: 24838144</div><div class="line">init: 12746752</div><div class="line">max: 100663296</div><div class="line">used: 24806392</div></pre></td></tr></table></figure></p><h1 id="在zabbix-web页面中添加JMX端口"><a href="#在zabbix-web页面中添加JMX端口" class="headerlink" title="在zabbix web页面中添加JMX端口"></a>在zabbix web页面中添加JMX端口</h1><h2 id="导入模板"><a href="#导入模板" class="headerlink" title="导入模板"></a>导入模板</h2><p>zabbix自带的”Template App Generic Java JMX”和”Template App Apache Tomcat JMX”模板很多都获取不到数据，从网上找了个模板，监控项不多，但是都是很实用的。<br><img src="/images/2017/1010/06.png" alt="zabbix"><br><img src="/images/2017/1010/07.png" alt="zabbix"></p><h2 id="添加JMX端口"><a href="#添加JMX端口" class="headerlink" title="添加JMX端口"></a>添加JMX端口</h2><p>jmx的端口一定要与在catalina.bat下配置的jmxremote.port一样<br><img src="/images/2017/1010/04.png" alt="zabbix"></p><h2 id="关联模板"><a href="#关联模板" class="headerlink" title="关联模板"></a>关联模板</h2><p><img src="/images/2017/1010/05.png" alt="zabbix"></p><h2 id="查看图形"><a href="#查看图形" class="headerlink" title="查看图形"></a>查看图形</h2><p><img src="/images/2017/1010/08.png" alt="zabbix"></p><p>参考链接：<br><a href="http://wzlinux.blog.51cto.com/8021085/1692444" target="_blank" rel="external">http://wzlinux.blog.51cto.com/8021085/1692444</a><br><a href="http://blog.csdn.net/jhfsdfs/article/details/65629174" target="_blank" rel="external">http://blog.csdn.net/jhfsdfs/article/details/65629174</a><br><a href="http://www.fblinux.com/?p=616" target="_blank" rel="external">http://www.fblinux.com/?p=616</a></p><hr>]]></content>
      
      
      <categories>
          
          <category> 监控 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> zabbix </tag>
            
            <tag> 监控 </tag>
            
            <tag> tomcat </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Oracle删除用户报错ORA-01940: cannot drop a user that is currently connected</title>
      <link href="/arlo/dd79d161/"/>
      <url>/arlo/dd79d161/</url>
      
        <content type="html"><![CDATA[<p>oracle导入数据之前，删除用户时候报错“ORA-01940: cannot drop a user that is currently connected”，原因是因为用户正在连接使用。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">SQL&gt; drop user air_forecast cascade;</div><div class="line">drop user air_forecast cascade</div><div class="line">*</div><div class="line">ERROR at line 1:</div><div class="line">ORA-01940: cannot drop a user that is currently connected</div></pre></td></tr></table></figure></p><a id="more"></a><h1 id="查询一下当前用户连接"><a href="#查询一下当前用户连接" class="headerlink" title="查询一下当前用户连接"></a>查询一下当前用户连接</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select sid,serial# from v$session where username=&apos;AIR_FORECAST&apos;;</div><div class="line">       SID    SERIAL#</div><div class="line">---------- ----------</div><div class="line">       237 2083</div><div class="line">       252 3564</div></pre></td></tr></table></figure><p><img src="/images/2017/1010/01.png" alt="oracle"></p><h1 id="杀掉占用进程"><a href="#杀掉占用进程" class="headerlink" title="杀掉占用进程"></a>杀掉占用进程</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter system kill session &apos;237,2083&apos;;</div><div class="line"></div><div class="line">System altered.</div><div class="line"></div><div class="line">SQL&gt; alter system kill session &apos;252,3564&apos;;</div><div class="line"></div><div class="line">System altered.</div></pre></td></tr></table></figure><h1 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">SQL&gt; drop user air_forecast cascade;</div><div class="line"></div><div class="line"></div><div class="line">User dropped.</div></pre></td></tr></table></figure><p><img src="/images/2017/1010/02.png" alt="oracle"></p><p>PS：上述语句中没有状态列，所以看到删除的进程还在，其实是已经标记为KILLED状态了(status 为要删除用户的session状态，如果还为inactive，说明没有被kill掉，如果状态为killed，说明已kill)，删除进程后使用如下语句查询.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select saddr,sid,serial#,paddr,username,status from v$session where username is not null;</div></pre></td></tr></table></figure></p><h1 id="导入用户数据"><a href="#导入用户数据" class="headerlink" title="导入用户数据"></a>导入用户数据</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select * from dba_directories;#查询存储文件目录，将备份文件拷贝到此目录下</div><div class="line">shell&gt; impdp userid=&quot;&apos;sys/password@sx21 as sysdba&apos;&quot; schemas=air_forecast directory=DATA_PUMP_DIR dumpfile=AIR_FORECAST.DMP</div></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
            <tag> Troubleshooting </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Oracle数据库错误表SYS.AUD$无法通过8192(在表空间SYSTEM中)扩展</title>
      <link href="/arlo/1998d04e/"/>
      <url>/arlo/1998d04e/</url>
      
        <content type="html"><![CDATA[<p>数据库报错信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[Content]</div><div class="line">ORA-00604: 递归 SQL 级别 1 出现错误</div><div class="line">ORA-01653: 表 SYS.AUD$ 无法通过 8192 (在表空间 SYSTEM 中) 扩展</div><div class="line">ORA-02002: 写入审计线索时出错</div><div class="line">ORA-00604: 递归 SQL 级别 1 出现错误</div><div class="line">ORA-01653: 表 SYS.AUD$ 无法通过 8192 (在表空间 SYSTEM 中) 扩展</div></pre></td></tr></table></figure></p><a id="more"></a><p>该错误原因为表空间无法扩展故障，查找后得知单个表空间文件最大32G，有两个方法扩大表空间<br>（1）创建多个数据文件，都不能超过32g<br>（2）创建大表空间。create bigfile tablespace  他的上限是8EB，不过，oracle10及以后版本才能用。<br>这里我们使用第一种方法处理一下此故障。</p><h1 id="Windows下切换SID"><a href="#Windows下切换SID" class="headerlink" title="Windows下切换SID"></a>Windows下切换SID</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">C:\Users\Administrator&gt;SET ORACLE_SID=sx21</div><div class="line">C:\Users\Administrator&gt;sqlplus /nolog</div><div class="line">SQL&gt; conn /as sysdba</div><div class="line"># 查询当前实例</div><div class="line">SQL&gt; select instance_name from v$instance；</div><div class="line">INSTANCE_NAME</div><div class="line">----------------</div><div class="line">sx21</div></pre></td></tr></table></figure><h1 id="增加一个表空间文件"><a href="#增加一个表空间文件" class="headerlink" title="增加一个表空间文件"></a>增加一个表空间文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># 查询表空间路径</div><div class="line">SQL&gt; SELECT FILE_NAME,TABLESPACE_NAME,AUTOEXTENSIBLE FROM dba_data_files WHERE TABLESPACE_NAME=&apos;SYSTEM&apos;;</div><div class="line"># 在同路径目录下添加一个表空间文件</div><div class="line">SQL&gt; ALTER TABLESPACE &quot;SYSTEM&quot; ADD DATAFILE &apos;E:\APP\ADMINISTRATOR\ORADATA\SX21\SYSTEM02.DBF&apos; SIZE 1000M AUTOEXTEND ON NEXT 50M MAXSIZE UNLIMITED;</div></pre></td></tr></table></figure><h1 id="执行完成后重新查看表空间使用情况"><a href="#执行完成后重新查看表空间使用情况" class="headerlink" title="执行完成后重新查看表空间使用情况"></a>执行完成后重新查看表空间使用情况</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SQL&gt; SELECT UPPER(F.TABLESPACE_NAME) &quot;表空间名&quot;, D.TOT_GROOTTE_MB &quot;表空间大小(M)&quot;, D.TOT_GROOTTE_MB - F.TOTAL_BYTES &quot;已使用空间(M)&quot;, TO_CHAR(ROUND((D.TOT_GROOTTE_MB - F.TOTAL_BYTES) / D.TOT_GROOTTE_MB * 100,2),&apos;990.99&apos;) &quot;使用比&quot;, F.TOTAL_BYTES &quot;空闲空间(M)&quot;, F.MAX_BYTES &quot;最大块(M)&quot; FROM (SELECT TABLESPACE_NAME, ROUND(SUM(BYTES) / (1024 * 1024), 2) TOTAL_BYTES, ROUND(MAX(BYTES) / (1024 * 1024), 2) MAX_BYTES FROM SYS.DBA_FREE_SPACE GROUP BY TABLESPACE_NAME) F, (SELECT DD.TABLESPACE_NAME, ROUND(SUM(DD.BYTES) / (1024 * 1024), 2) TOT_GROOTTE_MB FROM SYS.DBA_DATA_FILES DD GROUP BY DD.TABLESPACE_NAME) D WHERE D.TABLESPACE_NAME = F.TABLESPACE_NAME ORDER BY 4 DESC;</div></pre></td></tr></table></figure><p><img src="/images/2017/1009/01.png" alt="oracle"></p><p>参考链接：<a href="http://www.jydba.net/oracle数据文件大小的限制/" target="_blank" rel="external">http://www.jydba.net/oracle数据文件大小的限制/</a></p>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
            <tag> Troubleshooting </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Zabbix(4)通过orabbix插件监控Oracle数据库</title>
      <link href="/arlo/780360a7/"/>
      <url>/arlo/780360a7/</url>
      
        <content type="html"><![CDATA[<p>DBforBIX可以支持市面上主流的数据库监控，包括Oracle，Mysql，PostgreSQL，MSSQL，DB2，这篇文章简单的记录一下我监控oracle的过程；<br>软件环境：<br>Jdk 1.8.0_112<br>zabbix 3.4.2<br>orabbix 1.2.3<br><a id="more"></a></p><h1 id="安装jdk"><a href="#安装jdk" class="headerlink" title="安装jdk"></a>安装jdk</h1><p>下载jdk：<a href="http://www.oracle.com/technetwork/java/archive-139210.html" target="_blank" rel="external">http://www.oracle.com/technetwork/java/archive-139210.html</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">tar xf jdk-8u112-linux-x64.tar.gz -C /usr/local/</div><div class="line">vim /etc/profile</div><div class="line">export JAVA_HOME=/usr/local/jdk1.8.0_112/</div><div class="line">export CLASSPATH=.:$JAVA_HOME/lib/:$JAVA_HOME/jre/lib/</div><div class="line">export PATH=$JAVA_HOME/bin:$PATH</div></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">source /etc/profile</div></pre></td></tr></table></figure><h1 id="oracle中增加监控用户权限"><a href="#oracle中增加监控用户权限" class="headerlink" title="oracle中增加监控用户权限"></a>oracle中增加监控用户权限</h1><h2 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">su - oracle</div><div class="line">$ sqlplus /nolog</div><div class="line">SQL&gt; conn /as sysdba</div><div class="line">SQL&gt; CREATE USER ZABBIX  IDENTIFIED BY &apos;&lt;PASSWORD&gt;&apos; DEFAULT TABLESPACE SYSTEM TEMPORARY TABLESPACE TEMP PROFILE DEFAULT ACCOUNT UNLOCK;</div><div class="line">SQL&gt; CREATE USER ZABBIX  IDENTIFIED BY zabbix DEFAULT TABLESPACE SYSTEM TEMPORARY TABLESPACE TEMP PROFILE DEFAULT ACCOUNT UNLOCK;</div></pre></td></tr></table></figure><h2 id="赋予权限"><a href="#赋予权限" class="headerlink" title="赋予权限"></a>赋予权限</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">GRANT CONNECT TO ZABBIX;</div><div class="line">GRANT RESOURCE TO ZABBIX;</div><div class="line">GRANT CREATE SESSION TO ZABBIX;</div><div class="line">GRANT SELECT ANY DICTIONARY TO ZABBIX;</div><div class="line">GRANT UNLIMITED TABLESPACE TO ZABBIX;</div><div class="line">GRANT SELECT ANY DICTIONARY TO ZABBIX;</div></pre></td></tr></table></figure><p>如果是oracle11g的话，需执行以下语句<br><em>执行以下语句的时候，注意一下全角半角标点符号</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">SQL&gt; exec dbms_network_acl_admin.create_acl(acl =&gt;&apos;resolve.xml&apos;,description =&gt; &apos;resolve acl&apos;, principal =&gt;&apos;ZABBIX&apos;,is_grant =&gt; true, privilege =&gt; &apos;resolve&apos;);</div><div class="line">SQL&gt; exec dbms_network_acl_admin.assign_acl(acl =&gt;&apos;resolve.xml&apos;, host =&gt;&apos;*&apos;);</div></pre></td></tr></table></figure></p><p>验证语句<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select utl_inaddr.get_host_name(&apos;127.0.0.1&apos;) from dual;</div></pre></td></tr></table></figure></p><h1 id="安装orabbix"><a href="#安装orabbix" class="headerlink" title="安装orabbix"></a>安装orabbix</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">wget https://nchc.dl.sourceforge.net/project/orabbix/orabbix-1.2.3.zip</div><div class="line">mkdir /usr/local/orabbix</div><div class="line">mv orabbix-1.2.3.zip /usr/local/orabbix/</div><div class="line">unzip orabbix-1.2.3.zip</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cp config.props.sample config.props</div><div class="line">vim config.props</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">ZabbixServerList=ZabbixServer</div><div class="line">ZabbixServer.Address=192.168.6.103</div><div class="line">ZabbixServer.Port=10051</div><div class="line">OrabbixDaemon.Sleep=300</div><div class="line">OrabbixDaemon.MaxThreadNumber=100</div><div class="line">#DatabaseList这里配置的主机名一定要和Zabbix里添加的主机名称一致，否则获取不到数据</div><div class="line">DatabaseList=vm00</div><div class="line">DatabaseList.MaxActive=10</div><div class="line">DatabaseList.MaxWait=100</div><div class="line">DatabaseList.MaxIdle=1</div><div class="line">vm00.Url=jdbc:oracle:thin:@192.168.6.100:1521:ORCL</div><div class="line">vm00.User=ZABBIX</div><div class="line">vm00.Password=zabbix</div><div class="line">vm00.MaxActive=10</div><div class="line">vm00.MaxWait=100</div><div class="line">vm00.MaxIdle=1</div><div class="line">vm00.QueryListFile=./conf/query.props</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">cd /usr/local/orabbix</div><div class="line">vim run.sh</div><div class="line">修改java为/usr/local/jdk1.8.0_112/bin/java</div><div class="line">chmod +x run.sh</div><div class="line">cp init.d/orabbix /etc/init.d/</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">vim /etc/init.d/orabbix</div><div class="line">修改orabbix=/opt/orabbix为orabbix=/usr/local/orabbix</div><div class="line">chmod +x /etc/init.d/orabbix</div><div class="line">chkconfig --level 35 --add orabbix </div><div class="line">/etc/init.d/orabbix start</div></pre></td></tr></table></figure><p>如果出现异常，可以查看日志排查 /usr/local/orabbix/logs/orabbix.log</p><h1 id="导入模板"><a href="#导入模板" class="headerlink" title="导入模板"></a>导入模板</h1><p>将/usr/local/orabbix/template/Orabbix_export_full.xml模板导入<br><img src="/images/2017/0930/01.png" alt="zabbix_install"><br><img src="/images/2017/0930/02.png" alt="zabbix_install"><br>添加主机，关联oracle数据库监控模板<br><img src="/images/2017/0930/03.png" alt="zabbix_install"><br>默认的配置文件无法正常获取到dbfilesize和dbsize，需要手动修改一下配置文件<br>/usr/local/orabbix/conf/query.props<br>在配置文件最后添加<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">dbfilesize.Query=select to_char(sum(bytes/1024/1024/10), &apos;FM99999999999999990&apos;) retvalue from dba_data_files</div><div class="line"> </div><div class="line">dbsize.Query=SELECT to_char(sum(  NVL(a.bytes/1024/1024/10 - NVL(f.bytes/1024/1024/10, 0), 0)), &apos;FM99999999999999990&apos;) retvalue \</div><div class="line">FROM sys.dba_tablespaces d, \</div><div class="line">(select tablespace_name, sum(bytes) bytes from dba_data_files group by tablespace_name) a, \</div><div class="line">(select tablespace_name, sum(bytes) bytes from dba_free_space group by tablespace_name) f \ </div><div class="line">WHERE d.tablespace_name = a.tablespace_name(+) AND d.tablespace_name = f.tablespace_name(+) \</div><div class="line">AND NOT (d.extent_management like &apos;LOCAL&apos; AND d.contents like &apos;TEMPORARY&apos;)</div></pre></td></tr></table></figure></p><p>在QueryList最后添加,dbfilesize,dbsize<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">QueryList=archive,audit,dbblockgets,dbconsistentgets,dbhitratio,dbphysicalread,dbversion,hitratio_body,hitratio_sqlarea,hitratio_table_proc, \</div><div class="line">lio_current_read,locks,maxprocs,maxsession,miss_latch,pga_aggregate_target, pga,phio_datafile_reads,phio_datafile_writes,phio_redo_writes,pinhitratio_body,pinhitratio_sqlarea,pinhitratio_table-proc,pinhitratio_</div><div class="line">trigger, \</div><div class="line">pool_dict_cache,pool_free_mem,pool_lib_cache,pool_misc,pool_sql_area,procnum,session_active,session_inactive,session,session_system,sga_buffer_cache, \</div><div class="line">sga_fixed,sga_java_pool,sga_large_pool,sga_log_buffer,sga_shared_pool,tbl_space,userconn,waits_controfileio,waits_directpath_read, \</div><div class="line">waits_file_io,waits_latch,waits_logwrite,waits_multiblock_read,waits_singleblock_read,hitratio_trigger,lio_block_changes,lio_consistent_read,waits_other,waits_sqlnet,users_locked,uptime,dbfilesize,dbsize</div></pre></td></tr></table></figure></p><p><img src="/images/2017/0930/04.png" alt="zabbix_install"><br>可以在最新数据里看到已经监控到的数据<br><img src="/images/2017/0930/05.png" alt="zabbix_install"></p><h1 id="orabbix-for-zabbix4-x"><a href="#orabbix-for-zabbix4-x" class="headerlink" title="orabbix for zabbix4.x"></a>orabbix for zabbix4.x</h1><p>如果使用的zabbix4.x版本，orabbix1.2.3默认是不能获取到监控项的，可以参考<a href="https://github.com/snickerjp/orabbix，重新编译orabbix-1.2.3.jar，替换目前版本即可；如果不想编译，这里有现成的" target="_blank" rel="external">https://github.com/snickerjp/orabbix，重新编译orabbix-1.2.3.jar，替换目前版本即可；如果不想编译，这里有现成的</a>: <a href="https://pan.baidu.com/s/1-QmNXEphOtJL6c-OZg9Q-A" target="_blank" rel="external">https://pan.baidu.com/s/1-QmNXEphOtJL6c-OZg9Q-A</a> 提取码: 76zt 失效联系我。</p><p>参考链接：<br><a href="https://www.kancloud.cn/devops-centos/centos-linux-devops/361200" target="_blank" rel="external">https://www.kancloud.cn/devops-centos/centos-linux-devops/361200</a><br><a href="http://fengwan.blog.51cto.com/508652/1722118" target="_blank" rel="external">http://fengwan.blog.51cto.com/508652/1722118</a><br><a href="http://www.smartmarmot.com/wiki/index.php?title=DBforBIX#Install_steps_for_Oracle" target="_blank" rel="external">http://www.smartmarmot.com/wiki/index.php?title=DBforBIX#Install_steps_for_Oracle</a></p>]]></content>
      
      
      <categories>
          
          <category> 监控 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
            <tag> zabbix </tag>
            
            <tag> 监控 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Zabbix(3)邮件报警配置</title>
      <link href="/arlo/3efe0c83/"/>
      <url>/arlo/3efe0c83/</url>
      
        <content type="html"><![CDATA[<p>报警的方式有很多，邮件，短信，微信，钉钉，最简单的方式这种脚本去发邮件，在此记录一下配置过程。</p><h1 id="配置邮件发送"><a href="#配置邮件发送" class="headerlink" title="配置邮件发送"></a>配置邮件发送</h1><h2 id="安装mailx"><a href="#安装mailx" class="headerlink" title="安装mailx"></a>安装mailx</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install mailx</div></pre></td></tr></table></figure><p>安装好，自己就有软链接了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@vm03 ~]# ls -l /usr/bin/mail</div><div class="line">lrwxrwxrwx 1 root root 5 May  6 02:07 /usr/bin/mail -&gt; mailx</div></pre></td></tr></table></figure></p><a id="more"></a><h2 id="配置mailx"><a href="#配置mailx" class="headerlink" title="配置mailx"></a>配置mailx</h2><p>vim /etc/mail.rc<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">set from=user@aliyun.com</div><div class="line">set smtp=smtp.aliyun.com</div><div class="line">set smtp-auth-user=user@aliyun.com</div><div class="line">set smtp-auth-password=&apos;&lt;password&gt;&apos;</div><div class="line">set smtp-auth=login</div></pre></td></tr></table></figure></p><h2 id="发送一封测试邮件"><a href="#发送一封测试邮件" class="headerlink" title="发送一封测试邮件"></a>发送一封测试邮件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">echo &apos;test&apos; |mailx -s &apos;abc&apos; abc@qq.com</div></pre></td></tr></table></figure><h2 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">vim /etc/zabbix/zabbix_server.conf</div><div class="line">AlertScriptsPath=/usr/lib/zabbix/alertscripts</div></pre></td></tr></table></figure><h2 id="发送邮件脚本"><a href="#发送邮件脚本" class="headerlink" title="发送邮件脚本"></a>发送邮件脚本</h2><p>vim z_sendmail.sh<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line">messages=`echo $3 | tr &apos;\r\n&apos; &apos;\n&apos;`</div><div class="line">subject=`echo $2 | tr &apos;\r\n&apos; &apos;\n&apos;`</div><div class="line">echo &quot;$&#123;messages&#125;&quot; | mail -s &quot;$&#123;subject&#125;&quot; $1 &gt;&gt;/tmp/sendmail.log 2&gt;&amp;1</div></pre></td></tr></table></figure></p><h2 id="使用脚本发送一封测试邮件"><a href="#使用脚本发送一封测试邮件" class="headerlink" title="使用脚本发送一封测试邮件"></a>使用脚本发送一封测试邮件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">chmod +x z_sendmail.sh</div><div class="line">touch /tmp/sendmail.log</div><div class="line">chown zabbix.zabbix /tmp/sendmail.log</div><div class="line">./z_sendmail.sh user@qq.com &quot;hello&quot; &quot;abc&quot;</div></pre></td></tr></table></figure><h1 id="添加报警类型"><a href="#添加报警类型" class="headerlink" title="添加报警类型"></a>添加报警类型</h1><h2 id="创建报警类型z-sendmail"><a href="#创建报警类型z-sendmail" class="headerlink" title="创建报警类型z_sendmail"></a>创建报警类型z_sendmail</h2><p>管理-报警媒介类型-创建媒体类型<br><img src="/images/2017/0929/15.png" alt="zabbix_install"><br><img src="/images/2017/0929/16.png" alt="zabbix_install"><br>脚本参数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">名称：z_sendmail</div><div class="line">类型：脚本</div><div class="line">脚本名称：z_sendmail.sh</div><div class="line">添加以下3个参数，分别对应z_sendmail.sh脚本需要的3个参数</div><div class="line">收件人地址:&#123;ALERT.SENDTO&#125;</div><div class="line">主题:&#123;ALERT.SUBJECT&#125;</div><div class="line">详细内容:&#123;ALERT.MESSAGE&#125;</div></pre></td></tr></table></figure></p><h2 id="设置用户报警媒介"><a href="#设置用户报警媒介" class="headerlink" title="设置用户报警媒介"></a>设置用户报警媒介</h2><p><img src="/images/2017/0929/17.png" alt="zabbix_install"><br><img src="/images/2017/0929/18.png" alt="zabbix_install"></p><h1 id="配置触发器告警"><a href="#配置触发器告警" class="headerlink" title="配置触发器告警"></a>配置触发器告警</h1><h2 id="修改默认的告警模板"><a href="#修改默认的告警模板" class="headerlink" title="修改默认的告警模板"></a>修改默认的告警模板</h2><p>设置为“‘非维护状态’且‘报警值&gt;=警告’”时触发动作<br><img src="/images/2017/0929/20.png" alt="zabbix_install"></p><h2 id="故障操作"><a href="#故障操作" class="headerlink" title="故障操作"></a>故障操作</h2><p><em>ps:这个模板标题不会乱码，其他的标题需要做utf8转码gb2312</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">默认接收人：故障&#123;TRIGGER.STATUS&#125;:服务器 &#123;HOSTNAME1&#125;:&#123;TRIGGER.NAME&#125;</div><div class="line">默认信息:</div><div class="line">告警主机:&#123;HOSTNAME1&#125;</div><div class="line">告警时间:&#123;EVENT.DATE&#125; &#123;EVENT.TIME&#125;</div><div class="line">告警等级:&#123;TRIGGER.SEVERITY&#125;</div><div class="line">告警信息: &#123;TRIGGER.NAME&#125;</div><div class="line">告警项目:&#123;TRIGGER.KEY1&#125;</div><div class="line">问题详情:&#123;ITEM.NAME&#125;:&#123;ITEM.VALUE&#125;</div><div class="line">当前状态:&#123;TRIGGER.STATUS&#125;:&#123;ITEM.VALUE1&#125;</div><div class="line">事件ID:&#123;EVENT.ID&#125;</div><div class="line">请至Montoring-Events中查看详细情况。</div></pre></td></tr></table></figure></p><p><img src="/images/2017/0929/21.png" alt="zabbix_install"></p><h2 id="恢复操作"><a href="#恢复操作" class="headerlink" title="恢复操作"></a>恢复操作</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">默认接收人：恢复&#123;TRIGGER.STATUS&#125;:服务器&#123;HOSTNAME1&#125;:&#123;TRIGGER.NAME&#125;</div><div class="line">默认信息：告警主机:&#123;HOSTNAME1&#125;</div><div class="line">告警时间:&#123;EVENT.DATE&#125; &#123;EVENT.TIME&#125;</div><div class="line">告警等级:&#123;TRIGGER.SEVERITY&#125;</div><div class="line">告警信息: &#123;TRIGGER.NAME&#125;</div><div class="line">告警项目:&#123;TRIGGER.KEY1&#125;</div><div class="line">问题详情:&#123;ITEM.NAME&#125;:&#123;ITEM.VALUE&#125;</div><div class="line">当前状态:&#123;TRIGGER.STATUS&#125;:&#123;ITEM.VALUE1&#125;</div><div class="line">事件ID:&#123;EVENT.ID&#125;</div><div class="line">报警已恢复，请放松心情。</div></pre></td></tr></table></figure><p><img src="/images/2017/0929/22.png" alt="zabbix_install"></p><h1 id="测试告警"><a href="#测试告警" class="headerlink" title="测试告警"></a>测试告警</h1><p>关闭zabbix agent，测试邮件<br><img src="/images/2017/0929/23.png" alt="zabbix_install"></p><p><em>ps:我用qq邮箱+授权码方式测试邮件，手动发送可以，系统提示发送成功，就是收不到，浪费了一天时间，坑好深！使用阿里云邮箱测试顺利！</em></p>]]></content>
      
      
      <categories>
          
          <category> 监控 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> zabbix </tag>
            
            <tag> 监控 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Zabbix(2)监控客户端安装</title>
      <link href="/arlo/b6f2d4bf/"/>
      <url>/arlo/b6f2d4bf/</url>
      
        <content type="html"><![CDATA[<h1 id="linux-客户端安装"><a href="#linux-客户端安装" class="headerlink" title="linux 客户端安装"></a>linux 客户端安装</h1><h2 id="安装客户端软件"><a href="#安装客户端软件" class="headerlink" title="安装客户端软件"></a>安装客户端软件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rpm -ivh http://repo.zabbix.com/zabbix/3.4/rhel/7/x86_64/zabbix-release-3.4-2.el7.noarch.rpm</div><div class="line">yum install zabbix-agent</div></pre></td></tr></table></figure><a id="more"></a><h2 id="配置连接服务器信息"><a href="#配置连接服务器信息" class="headerlink" title="配置连接服务器信息"></a>配置连接服务器信息</h2><p>vim /etc/zabbix/zabbix_agentd.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Server=192.168.6.103</div><div class="line">ServerActive=192.168.6.103</div><div class="line">Hostname=silu1</div></pre></td></tr></table></figure></p><h2 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">systemctl start zabbix-agent</div><div class="line">systemctl enable zabbix-agent</div></pre></td></tr></table></figure><h2 id="添加主机"><a href="#添加主机" class="headerlink" title="添加主机"></a>添加主机</h2><p><em>主机名称一定要和配置文件中的Hostname一致</em><br><img src="/images/2017/0929/11.png" alt="zabbix_install"><br><em>如果使用主动模式，这里的ip地址填写0.0.0.0</em><br><img src="/images/2017/0929/12.png" alt="zabbix_install"><br><img src="/images/2017/0929/13.png" alt="zabbix_install"></p><h1 id="Windows-客户端安装"><a href="#Windows-客户端安装" class="headerlink" title="Windows 客户端安装"></a>Windows 客户端安装</h1><h2 id="安装windows-客户端"><a href="#安装windows-客户端" class="headerlink" title="安装windows 客户端"></a>安装windows 客户端</h2><p>下载客户端软件 <a href="https://www.zabbix.com/downloads/3.4.0/zabbix_agents_3.4.0.win.zip" target="_blank" rel="external">https://www.zabbix.com/downloads/3.4.0/zabbix_agents_3.4.0.win.zip</a><br>解压到C盘根目录</p><h2 id="配置连接服务器信息-1"><a href="#配置连接服务器信息-1" class="headerlink" title="配置连接服务器信息"></a>配置连接服务器信息</h2><p>C:\zabbix_agents_3.4.0.win\conf\zabbix_agentd.win.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Server=192.168.6.103</div><div class="line">ServerActive=192.168.6.103</div><div class="line">Hostname=silu2</div></pre></td></tr></table></figure></p><h2 id="注册服务"><a href="#注册服务" class="headerlink" title="注册服务"></a>注册服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">C:\&gt;c:\zabbix_agents_3.4.0.win\bin\win64\zabbix_agentd.exe -i -c c:\zabbix_agents_3.4.0.win\conf\zabbix_agentd.win.conf</div></pre></td></tr></table></figure><h2 id="启动服务-1"><a href="#启动服务-1" class="headerlink" title="启动服务"></a>启动服务</h2><p>使用以下命令启动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">net start &quot;Zabbix Agent&quot;</div></pre></td></tr></table></figure></p><p>或者在本地服务中启动<br><img src="/images/2017/0929/14.png" alt="zabbix_install"></p><h2 id="添加主机-1"><a href="#添加主机-1" class="headerlink" title="添加主机"></a>添加主机</h2><p>和linux方法以下，选择Windows模板即可</p>]]></content>
      
      
      <categories>
          
          <category> 监控 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> zabbix </tag>
            
            <tag> 监控 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Zabbix(1)监控搭建</title>
      <link href="/arlo/3b5e53af/"/>
      <url>/arlo/3b5e53af/</url>
      
        <content type="html"><![CDATA[<p>Zabbix是一款能够监控各种网络参数以及服务器健康性、完整性的分布式监控软件；<br><a id="more"></a><br><strong>系统环境</strong><br>Centos    7.3.1611<br>Selinux    off<br>Iptables    off<br>Firewalld    off<br><strong>软件环境</strong><br>Zabbix    3.4.2<br>Httpd    2.4.6<br>Php    5.4.16<br>MariaDB    10.2.7</p><h1 id="使用部署包安装zabbix"><a href="#使用部署包安装zabbix" class="headerlink" title="使用部署包安装zabbix"></a>使用部署包安装zabbix</h1><h2 id="安装zabbix-server"><a href="#安装zabbix-server" class="headerlink" title="安装zabbix server"></a>安装zabbix server</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rpm -ivh http://repo.zabbix.com/zabbix/3.4/rhel/7/x86_64/zabbix-release-3.4-2.el7.noarch.rpm</div><div class="line">yum install zabbix-server-mysql zabbix-web-mysql</div></pre></td></tr></table></figure><h2 id="配置数据库"><a href="#配置数据库" class="headerlink" title="配置数据库"></a>配置数据库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">vim /etc/yum.repos.d/MariaDB.repo</div><div class="line">[mariadb]</div><div class="line">name = MariaDB</div><div class="line">baseurl = http://yum.mariadb.org/10.3/centos7-amd64</div><div class="line">gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB</div><div class="line">gpgcheck=1</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">yum install MariaDB-server MariaDB-client</div><div class="line">cp /usr/share/mysql/my-medium.cnf /etc/my.cnf</div><div class="line">systemctl start mariadb.service</div><div class="line">systemctl enable mariadb.service</div><div class="line">mysql_secure_installation</div><div class="line">#初始化数据库，设置root密码</div><div class="line">mysql -uroot -p&lt;password&gt;</div><div class="line">mysql&gt; create database zabbix character set utf8 collate utf8_bin;</div><div class="line">mysql&gt; grant all privileges on zabbix.* to zabbix@localhost identified by &apos;&lt;password&gt;&apos;;</div><div class="line">mysql&gt; quit;</div><div class="line">cd /usr/share/doc/zabbix-server-mysql-3.4.2</div><div class="line">zcat create.sql.gz | mysql -uroot zabbix -p</div></pre></td></tr></table></figure><h2 id="配置zabbix-server-conf参数"><a href="#配置zabbix-server-conf参数" class="headerlink" title="配置zabbix_server.conf参数"></a>配置zabbix_server.conf参数</h2><p>vim /etc/zabbix/zabbix_server.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">DBHost=localhost</div><div class="line">DBName=zabbix</div><div class="line">DBUser=zabbix</div><div class="line">DBPassword=zabbix</div></pre></td></tr></table></figure></p><h2 id="启动Zabbix-Server"><a href="#启动Zabbix-Server" class="headerlink" title="启动Zabbix Server"></a>启动Zabbix Server</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">systemctl start zabbix-server</div><div class="line">systemctl enable zabbix-server</div></pre></td></tr></table></figure><h2 id="编辑Zabbix前端的PHP配置"><a href="#编辑Zabbix前端的PHP配置" class="headerlink" title="编辑Zabbix前端的PHP配置"></a>编辑Zabbix前端的PHP配置</h2><p>Zabbix前端的Apache配置文件位于 /etc/httpd/conf.d/zabbix.conf 。一些PHP设置已经完成了配置。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">php_value max_execution_time 300</div><div class="line">php_value memory_limit 128M</div><div class="line">php_value post_max_size 16M</div><div class="line">php_value upload_max_filesize 2M</div><div class="line">php_value max_input_time 300</div><div class="line">php_value always_populate_raw_post_data -1</div><div class="line">php_value date.timezone Asia/Shanghai</div></pre></td></tr></table></figure></p><h2 id="启动httpd"><a href="#启动httpd" class="headerlink" title="启动httpd"></a>启动httpd</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">systemctl start httpd</div><div class="line">systemctl enable httpd</div></pre></td></tr></table></figure><h1 id="配置zabbix前端"><a href="#配置zabbix前端" class="headerlink" title="配置zabbix前端"></a>配置zabbix前端</h1><h2 id="在浏览器中配置zabbix"><a href="#在浏览器中配置zabbix" class="headerlink" title="在浏览器中配置zabbix"></a>在浏览器中配置zabbix</h2><p>Zabbix前端可以在浏览器中通过 <a href="http://zabbixserver/zabbix" target="_blank" rel="external">http://zabbixserver/zabbix</a> 进行访问。<br><img src="/images/2017/0929/01.png" alt="zabbix_install"></p><h3 id="确认所有php参数都设置ok"><a href="#确认所有php参数都设置ok" class="headerlink" title="确认所有php参数都设置ok"></a>确认所有php参数都设置ok</h3><p><img src="/images/2017/0929/02.png" alt="zabbix_install"></p><h3 id="填写mysql数据库信息，用户名密码"><a href="#填写mysql数据库信息，用户名密码" class="headerlink" title="填写mysql数据库信息，用户名密码"></a>填写mysql数据库信息，用户名密码</h3><p><img src="/images/2017/0929/03.png" alt="zabbix_install"><br><img src="/images/2017/0929/04.png" alt="zabbix_install"></p><h3 id="确认所有配置信息正确"><a href="#确认所有配置信息正确" class="headerlink" title="确认所有配置信息正确"></a>确认所有配置信息正确</h3><p><img src="/images/2017/0929/05.png" alt="zabbix_install"><br><img src="/images/2017/0929/06.png" alt="zabbix_install"></p><h3 id="默认的用户名／密码为-Admin-zabbix"><a href="#默认的用户名／密码为-Admin-zabbix" class="headerlink" title="默认的用户名／密码为 Admin/zabbix"></a>默认的用户名／密码为 Admin/zabbix</h3><p><img src="/images/2017/0929/07.png" alt="zabbix_install"><br><img src="/images/2017/0929/08.png" alt="zabbix_install"></p><h1 id="系统配置"><a href="#系统配置" class="headerlink" title="系统配置"></a>系统配置</h1><h2 id="配置中文界面"><a href="#配置中文界面" class="headerlink" title="配置中文界面"></a>配置中文界面</h2><h3 id="替换中文字体"><a href="#替换中文字体" class="headerlink" title="替换中文字体"></a>替换中文字体</h3><p>在Windows系统里找一个中文字体（华文楷体）C:\Windows\Fonts\STKAITI.TTF上传到zabbix服务器替换掉默认的字体/usr/share/fonts/dejavu/DejaVuSans.ttf</p><h3 id="开启中文支持"><a href="#开启中文支持" class="headerlink" title="开启中文支持"></a>开启中文支持</h3><p>如果默认中文(zh_CN)支持被关闭，可以将zh_CN后边的false选项修改为true；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">vim /usr/share/zabbix/include/locales.inc.php</div><div class="line">function getLocales() &#123;</div><div class="line">        return [</div><div class="line">                &apos;en_GB&apos; =&gt; [&apos;name&apos; =&gt; _(&apos;English (en_GB)&apos;),     &apos;display&apos; =&gt; true],</div><div class="line">                &apos;en_US&apos; =&gt; [&apos;name&apos; =&gt; _(&apos;English (en_US)&apos;),     &apos;display&apos; =&gt; true],</div><div class="line">                &apos;bg_BG&apos; =&gt; [&apos;name&apos; =&gt; _(&apos;Bulgarian (bg_BG)&apos;),   &apos;display&apos; =&gt; false],</div><div class="line">                &apos;zh_CN&apos; =&gt; [&apos;name&apos; =&gt; _(&apos;Chinese (zh_CN)&apos;),     &apos;display&apos; =&gt; true],</div><div class="line">……</div></pre></td></tr></table></figure></p><h3 id="在web界面修改用户资料、语言"><a href="#在web界面修改用户资料、语言" class="headerlink" title="在web界面修改用户资料、语言"></a>在web界面修改用户资料、语言</h3><p><img src="/images/2017/0929/09.png" alt="zabbix_install"></p><h2 id="启用zabbix-server监控"><a href="#启用zabbix-server监控" class="headerlink" title="启用zabbix server监控"></a>启用zabbix server监控</h2><h3 id="安装zabbix-agent"><a href="#安装zabbix-agent" class="headerlink" title="安装zabbix agent"></a>安装zabbix agent</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">yum install zabbix-agent</div><div class="line">systemctl start zabbix-agent</div></pre></td></tr></table></figure><h3 id="在配置-主机中启用zabbix-server"><a href="#在配置-主机中启用zabbix-server" class="headerlink" title="在配置-主机中启用zabbix server"></a>在配置-主机中启用zabbix server</h3><p><img src="/images/2017/0929/10.png" alt="zabbix_install"></p><h1 id="CentOS-6-x-安装Zabbix"><a href="#CentOS-6-x-安装Zabbix" class="headerlink" title="CentOS 6.x 安装Zabbix"></a>CentOS 6.x 安装Zabbix</h1><p>CentOS 6.x 默认的php版本太低，需借助第三方源升级php;<br>建议PHP≥5.4 MySql≥5.6<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">rpm -Uvh http://rpms.famillecollet.com/enterprise/remi-release-6.rpm</div><div class="line">yum -y install --enablerepo=remi --enablerepo=remi-php56 php php-opcache php-devel php-mbstring php-mcrypt php-mysqlnd php-phpunit-PHPUnit php-pecl-xdebug php-pecl-xhprof  php-gd php-mysql php-bcmath php-ldap</div><div class="line">rpm -ql zabbix-web | grep example.conf</div><div class="line">cp /usr/share/doc/zabbix-web-3.4.8/httpd22-example.conf /etc/httpd/conf.d/zabbix.conf</div></pre></td></tr></table></figure></p><p><img src="/images/2017/0929/24.png" alt="zabbix_install"><br>参考资料:<br><a href="https://www.zabbix.com/documentation/3.4/zh/manual" target="_blank" rel="external">https://www.zabbix.com/documentation/3.4/zh/manual</a><br><a href="http://www.rfyy.net/archives/1742.html" target="_blank" rel="external">http://www.rfyy.net/archives/1742.html</a><br><a href="https://www.zabbix.com/documentation/3.4/manual/installation/install_from_packages/rhel_centos" target="_blank" rel="external">https://www.zabbix.com/documentation/3.4/manual/installation/install_from_packages/rhel_centos</a></p>]]></content>
      
      
      <categories>
          
          <category> 监控 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> zabbix </tag>
            
            <tag> 监控 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>JDK环境变量配置</title>
      <link href="/arlo/3f60947a/"/>
      <url>/arlo/3f60947a/</url>
      
        <content type="html"><![CDATA[<h1 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h1><p>我的jdk安装在 C:\Program Files\Java\jdk1.8.0_202 目录下，以下为配置过程：<br>1.我的电脑-（右键）属性-高级系统设置-高级-环境变量<br>2.系统变量-新建<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">变量名：JAVA_HOME</div><div class="line">变量值：C:\Program Files\Java\jdk1.8.0_202</div></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">变量名：CLASSPATH</div><div class="line">变量值：%JAVA_HOME%\lib\tools.jar;%JAVA_HOME%\lib\dt.jar</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">变量名：Path</div><div class="line">变量值：C:\Program Files (x86)\Intel\iCLS Client\;C:\Program Files\Intel\iCLS Client\;%SystemRoot%\system32;%SystemRoot%;%SystemRoot%\System32\Wbem;%SYSTEMROOT%\System32\WindowsPowerShell\v1.0\;C:\Program Files (x86)\Intel\OpenCL SDK\2.0\bin\x86;C:\Program Files (x86)\Intel\OpenCL SDK\2.0\bin\x64;C:\Program Files\Intel\Intel(R) Management Engine Components\DAL;C:\Program Files\Intel\Intel(R) Management Engine Components\IPT;C:\Program Files (x86)\Intel\Intel(R) Management Engine Components\DAL;C:\Program Files (x86)\Intel\Intel(R) Management Engine Components\IPT;E:\Program Files\TortoiseSVN\bin;%JAVA_HOME%\bin;%JAVA_HOME%\jre\bin</div></pre></td></tr></table></figure><h1 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h1><p>编辑/etc/profile 文件，在文件最后添加以下内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">export JAVA_HOME=/usr/local/jdk1.8.0_202/</div><div class="line">export CLASSPATH=.:$JAVA_HOME/lib/:$JAVA_HOME/jre/lib/</div><div class="line">export PATH=$JAVA_HOME/bin:$PATH</div></pre></td></tr></table></figure></p><p><code>source /etc/profile</code></p><font color="red"><strong>保留系统以前自己配置的项，不要动！</strong></font>  ]]></content>
      
      
      <categories>
          
          <category> 常识 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 常识 </tag>
            
            <tag> Windows </tag>
            
            <tag> jdk </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>WindowsUpdate不能更新，错误提示8024402F解决方法</title>
      <link href="/arlo/e0a98909/"/>
      <url>/arlo/e0a98909/</url>
      
        <content type="html"><![CDATA[<p>Windows系统下WindowsUpdate不能更新了，显示的是8024402F错误。<br>微软上看到了解决方法：使用以下DNS服务：<br>首选DNS服务器：4.2.2.1<br>备用DNS服务器：4.2.2.2<br>使用以后马上见效果。</p>]]></content>
      
      
      <categories>
          
          <category> Troubleshooting </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> 更新 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Jenkins持续集成发布时tomcat不能删除目录下文件</title>
      <link href="/arlo/fd00fe8d/"/>
      <url>/arlo/fd00fe8d/</url>
      
        <content type="html"><![CDATA[<p>使用jenkins自动发布到tomcat时遇到一个问题，发布的时候不能自动删除tomcat下的工程目录，必须关闭tomcat之后，才能删除；提示如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&quot;org.codehaus.cargo.container.tomcat.internal.TomcatManagerException: The Tomcat Manager responded &quot;FAIL - Unable to delete [C:\ths\Tomcat8082-alk\webapps\SuperStation]. The continued presence of this file may cause problems.&quot;</div></pre></td></tr></table></figure></p><a id="more"></a><p><img src="/images/2017/0829/00.png" alt="jenkins"></p><h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><p>在<context>元素中增加一个属性antiResourceLocking=”true” antiJARLocking=”true”，默认是”false”。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;Context reloadable=&quot;true&quot; antiJARLocking=&quot;true&quot; antiResourceLocking=&quot;true&quot;&gt;</div></pre></td></tr></table></figure></context></p><p>实际上，这两个参数就是配置Tomcat的资源锁定和Jar包锁定策略。</p><h2 id="antiJARLocking"><a href="#antiJARLocking" class="headerlink" title="antiJARLocking"></a>antiJARLocking</h2><p>先来看看应用的antiJARLocking属性设置为true时，Tomcat是怎么处理的。<br>针对antiJARLocking属性的处理集中在WebappClassLoader的getResource和findResourceInternal方法里，主要原理是将包含在Jar包里的资源抽取放到应用的工作目录（work里应用对应的目录）下去。<br>把这个属性设置为true之后，部署应用就可以在work\Catalina\localhost\struts2-blank\loader目录下看到被解压的Jar包内容。<br>antiJARLocking属性在有的时候并不会生效，从WebappClassLoader的getResource和findResource方法逻辑里可以看出一些端倪，在一些情况下（通过对Loader的delegate、searchExternalFirst等相关属性进行配置），资源的获取并不是WebappClassLoader去做的，而是其父加载器的getResource方法或父类的findResource方法去做的，WebappClassLoader的父类是URLClassLoader、父加载器是URLClassLoader实例。</p><h2 id="antiResourceLocking"><a href="#antiResourceLocking" class="headerlink" title="antiResourceLocking"></a>antiResourceLocking</h2><p>当antiResourceLocking设置为true的时候，Tomcat不会锁定应用下的任何文件。那Tomcat是怎么做到这一点的呢？<br>在Tomcat的架构里，应用也是一个级别的容器，对应的接口是Context；各级容器本身都具备生命周期，而且配置了多个生命周期监听器来监听容器不同的生命周期过程。Tomcat在初始化的时候，给Context增加了一个生命周期监听器org.apache.catalina.startup.ContextConfig；然后在Context真正开始启动之前，会有一个BEFORE_START_EVENT状态，ContextConfig监听到这个状态的事件后，就会针对antiResourceLocking进行处理。<br>总结一下，就是如果应用的antiResourceLocking属性设置为true，就将应用的doc base移到临时目录下，让Tomca不会占用webapps下的文件。Tomcat里java.io.tmpdir默认指向Tomcat的temp目录。</p><h1 id="副作用"><a href="#副作用" class="headerlink" title="副作用"></a>副作用</h1><p>从上面的分析来看，antiResourceLocking为true有几个副作用：<br>1) 会延长应用的启动时间，因为多了临时目录的清理和往临时目录拷贝应用内容的操作；<br>2) 如果不知道这个属性的原理，修改webapps下应用的JSP，那就不会动态重加载到新的页面内容了，因为应用的doc base已经不再在webapps下了；<br>3) 停止Tomcat的时候，临时目录下实际的doc base会被删掉，<br>结合第二条和第三条，如果要修改应用的JSP，那必须将改动同时拷贝到两个目录下（原始doc base和临时目录下的doc base）。<br>所以Tomcat里这个属性缺省为false。在使用Tomcat 6.0.24之前的版本时，如果要用这个属性解决文件被锁的问题，三思而行。</p><p>参考链接：<a href="http://blog.csdn.net/yanjun008/article/details/41249753" target="_blank" rel="external">http://blog.csdn.net/yanjun008/article/details/41249753</a></p>]]></content>
      
      
      <categories>
          
          <category> Troubleshooting </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 运维 </tag>
            
            <tag> 自动化 </tag>
            
            <tag> Jenkins </tag>
            
            <tag> tomcat </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Linux下如何拨VPN</title>
      <link href="/arlo/350a96fc/"/>
      <url>/arlo/350a96fc/</url>
      
        <content type="html"><![CDATA[<p>由于公司的svn和maven仓库地址都在内网，使用Centos系统搭建持续集成的时候，没有办法访问服务器，又不想换Windows环境；于是想办法在linux下拨通vpn！<br><a id="more"></a></p><h1 id="安装vpn客户端"><a href="#安装vpn客户端" class="headerlink" title="安装vpn客户端"></a>安装vpn客户端</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install pptp pptp-setup</div></pre></td></tr></table></figure><h1 id="创建一个vpn连接"><a href="#创建一个vpn连接" class="headerlink" title="创建一个vpn连接"></a>创建一个vpn连接</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pptpsetup --create pptpd --server SERVER_IP --username USERNAME --password PASSWORD --encrypt --start</div></pre></td></tr></table></figure><p><em><br>–create是创建的连接名称<br>–server是vpn的ip地址;<br>–username是用户名<br>–password是密码，也可以没这个参数，命令稍后会自动询问。这样可以保证账号安全<br>–encrypt 是表示需要加密，不必指定加密方式，命令会读取配置文件中的加密方式<br>–start是表示创建连接完后马上连接</em></p><h1 id="编辑配置文件"><a href="#编辑配置文件" class="headerlink" title="编辑配置文件"></a>编辑配置文件</h1><p>创建vpn连接完成后，会有两个配置文件(ps:<strong>有域的情况下，配置文件中\需要写成\\</strong>)<br>vim /etc/ppp/peers/pptpd<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"># written by pptpsetup</div><div class="line">pty &quot;pptp 1.2.3.4 --nolaunchpppd&quot;</div><div class="line">lock</div><div class="line">noauth</div><div class="line">nobsdcomp</div><div class="line">nodeflate</div><div class="line">name domain\\username                                                                                                                                                                       </div><div class="line">remotename pptpd</div><div class="line">ipparam pptpd</div><div class="line">require-mppe-128</div></pre></td></tr></table></figure></p><p>vim /etc/ppp/chap-secrets<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># Secrets for authentication using CHAP</div><div class="line"># client    server  secret          IP addresses</div><div class="line"></div><div class="line"># added by pptpsetup for pptpd</div><div class="line">domain\\username pptpd &quot;password&quot; *</div></pre></td></tr></table></figure></p><h1 id="复制开启-断开脚本"><a href="#复制开启-断开脚本" class="headerlink" title="复制开启\断开脚本"></a>复制开启\断开脚本</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cp /usr/share/doc/ppp-2.4.5/scripts/pon /usr/sbin/</div><div class="line">cp /usr/share/doc/ppp-2.4.5/scripts/poff /usr/sbin/</div><div class="line">chmod +x /usr/sbin/pon /usr/sbin/poff</div></pre></td></tr></table></figure><p><em><br>pon vpnname 开启vpn<br>poff vpnname 断开vpn</em></p><h1 id="尝试拨vpn"><a href="#尝试拨vpn" class="headerlink" title="尝试拨vpn"></a>尝试拨vpn</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pon pptpd</div></pre></td></tr></table></figure><h1 id="查看连接情况"><a href="#查看连接情况" class="headerlink" title="查看连接情况"></a>查看连接情况</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ip a</div></pre></td></tr></table></figure><p><img src="/images/2017/0823/00.png" alt="vpn"><br>如果有异常的话，可以跟踪系统日志排查<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tailf /var/log/messages</div></pre></td></tr></table></figure></p><h1 id="设置路由"><a href="#设置路由" class="headerlink" title="设置路由"></a>设置路由</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">route add -net 192.168.0.0/24 dev ppp0</div></pre></td></tr></table></figure><p><img src="/images/2017/0823/01.png" alt="vpn"></p>]]></content>
      
      
      <categories>
          
          <category> 常识 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 常识 </tag>
            
            <tag> vpn </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Jenkins邮件通知配置</title>
      <link href="/arlo/c26ec4ea/"/>
      <url>/arlo/c26ec4ea/</url>
      
        <content type="html"><![CDATA[<p>Jenkins<a href="http://islocal.cc/2017/04/27/jenkins-%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">环境搭建</a>完成了,项目自动化编译打包也调通了，但是我们不能保证每次都是正常的，根据自己的情况(构建失败，构建状态不稳定)配置邮件通知是有必要的；这篇文章我采用腾讯qq邮箱来发送，使用公司邮箱来接收；</p><h1 id="常用的几种方式"><a href="#常用的几种方式" class="headerlink" title="常用的几种方式"></a>常用的几种方式</h1><ul><li>使用内置的邮件插进（使用全局的配置，只能有一个接收方）</li><li>使用邮件扩展插件【Email Extension Plugin】（使用全局的配置，能有多个接收方，但是只能有一个发送方）</li><li>使用邮件扩展插件【Email Extension Plugin】+Groovy脚本（实现每个Job对应不同的发送邮件，多个发送方）</li><li>开发邮件转发中间件或者使用Foxmail这些工具来转发（每个Job发送到对应的邮箱，然后中间件负责转发到成员列表的邮箱。对发送插件没什么要求，只要能发送即可）<br><em>(这篇文章只说一下前两种方式)</em><a id="more"></a><h1 id="使用QQ邮箱发送"><a href="#使用QQ邮箱发送" class="headerlink" title="使用QQ邮箱发送"></a>使用QQ邮箱发送</h1>qq授权码设置参考：<a href="http://service.mail.qq.com/cgi-bin/help?subtype=1&amp;&amp;id=28&amp;&amp;no=1001256" target="_blank" rel="external">http://service.mail.qq.com/cgi-bin/help?subtype=1&amp;&amp;id=28&amp;&amp;no=1001256</a><h1 id="使用内置的邮件插件"><a href="#使用内置的邮件插件" class="headerlink" title="使用内置的邮件插件"></a>使用内置的邮件插件</h1><h2 id="配置管理员邮件地址"><a href="#配置管理员邮件地址" class="headerlink" title="配置管理员邮件地址"></a>配置管理员邮件地址</h2>系统管理–&gt;系统设置–&gt;Jenkins Location<br><img src="/images/2017/0822/03.png" alt="jenkins"><h2 id="配置邮件通知"><a href="#配置邮件通知" class="headerlink" title="配置邮件通知"></a>配置邮件通知</h2>系统管理–&gt;系统设置–&gt;邮件通知–&gt;高级，配置如下：<br><strong>这里密码填写我们神的“qq授权码”</strong><br><img src="/images/2017/0822/00.png" alt="jenkins"><h2 id="测试邮件提醒"><a href="#测试邮件提醒" class="headerlink" title="测试邮件提醒"></a>测试邮件提醒</h2>勾选“通过发送测试邮件测试配置”<br><img src="/images/2017/0822/01.png" alt="jenkins"><br>看到“Email was successfully sent”即为成功，去邮箱里看一下<br><img src="/images/2017/0822/02.png" alt="jenkins"><h1 id="使用邮件拓展插件"><a href="#使用邮件拓展插件" class="headerlink" title="使用邮件拓展插件"></a>使用邮件拓展插件</h1>系统管理–&gt;系统设置–&gt;Extended E-mail Notification<br><img src="/images/2017/0822/04.png" alt="jenkins"><br><img src="/images/2017/0822/05.png" alt="jenkins"><h2 id="邮件内容配置"><a href="#邮件内容配置" class="headerlink" title="邮件内容配置"></a>邮件内容配置</h2>以下是参考<a href="http://blog.csdn.net/wangmuming/article/details/22925357" target="_blank" rel="external">网上的配置</a>：<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">Default Subject: 构建通知:$PROJECT_NAME - Build # $BUILD_NUMBER - $BUILD_STATUS!  Default Content!</div><div class="line">Default Content:</div><div class="line">(本邮件是程序自动下发的，请勿回复！)&lt;br/&gt;&lt;hr/&gt;</div><div class="line"></div><div class="line">项目名称：$PROJECT_NAME&lt;br/&gt;&lt;hr/&gt;</div><div class="line"></div><div class="line">构建编号：$BUILD_NUMBER&lt;br/&gt;&lt;hr/&gt;</div><div class="line"></div><div class="line">svn版本号：$&#123;SVN_REVISION&#125;&lt;br/&gt;&lt;hr/&gt;</div><div class="line"></div><div class="line">构建状态：$BUILD_STATUS&lt;br/&gt;&lt;hr/&gt;</div><div class="line"></div><div class="line">触发原因：$&#123;CAUSE&#125;&lt;br/&gt;&lt;hr/&gt;</div><div class="line"></div><div class="line">构建日志地址：&lt;a href=&quot;$&#123;BUILD_URL&#125;console&quot;&gt;$&#123;BUILD_URL&#125;console&lt;/a&gt;&lt;br/&gt;&lt;hr/&gt;</div><div class="line"></div><div class="line">构建地址：&lt;a href=&quot;$BUILD_URL&quot;&gt;$BUILD_URL&lt;/a&gt;&lt;br/&gt;&lt;hr/&gt;</div><div class="line"></div><div class="line">变更集:$&#123;JELLY_SCRIPT,template=&quot;html&quot;&#125;&lt;br/&gt;&lt;hr/&gt;</div></pre></td></tr></table></figure></li></ul><h2 id="全局属性详解"><a href="#全局属性详解" class="headerlink" title="全局属性详解"></a>全局属性详解</h2><p><em><br>Default Content Type：指定构建后发送邮件内容的类型，有Text和HTML两种。<br>Use List-ID Email Header：为所有的邮件设置一个List-ID的邮件信头，这样你就可以在邮件客户端使用过滤。<br>Add ‘Precedence: bulk’ Email Header：设置优先级。<br>Default Recipients：自定义默认电子邮件收件人列表。如果没有被项目配置覆盖,该插件会使用这个列表。<br>Reply To List：回复列表<br>Emergency reroute：如果这个字段不为空，所有的电子邮件将被单独发送到该地址（或地址列表）。<br>Excluded Committers：防止邮件被邮件系统认为是垃圾邮件,邮件列表应该没有扩展的账户名(如:@domain.com),并且使用逗号分隔。<br>Default Subject：自定义邮件通知的默认主题名称。该选项能在邮件的主题字段中替换一些参数，这样你就可以在构建中包含指定的输出信息。<br>Maximum Attachment Size：邮件最大附件大小。<br>Default Pre-send Script：默认发送前执行的脚本。<br>Enable Debug Mode：启用插件的调试模式。这将增加额外的日志输出，构建日志以及Jenkins的日志。在调试时是有用的，但不能用于生产。<br>Enable Security：启用时，会禁用发送脚本的能力，直接进入Jenkins实例。如果用户试图访问Jenkins管理对象实例，将抛出一个安全异常。<br>Content Token Reference：邮件中可以使用的变量，所有的变量都是可选的。具体介绍请查看全局邮件变量章节。</em></p><h2 id="Job中邮件配置"><a href="#Job中邮件配置" class="headerlink" title="Job中邮件配置"></a>Job中邮件配置</h2><p>在构建后操作——”Add Post-build Actions”选项中勾选”Editable Email Notification”标签<br><img src="/images/2017/0822/06.png" alt="jenkins"><br><em><br>Project Recipient List：这是一个以逗号(或者空格)分隔的收件人邮件的邮箱地址列表。允许您为每封邮件指定单独的列表。Ps：如果你想在默认收件人的基础上添加收件人：$DEFAULT_RECIPIENTS,&lt;新的收件人&gt;<br>Default Subject：允许你配置此项目邮件的主题。<br>Default Content：跟Default Subject的作用一样，但是是替换邮件内容。<br>Attach Build Log：附件构建日志。<br>Compress Build Log before sending：发送前压缩生成日志（zip格式）。</em></p><h3 id="添加触发器"><a href="#添加触发器" class="headerlink" title="添加触发器"></a>添加触发器</h3><p><img src="/images/2017/0822/07.png" alt="jenkins"></p><h3 id="查看构建失败日志"><a href="#查看构建失败日志" class="headerlink" title="查看构建失败日志"></a>查看构建失败日志</h3><p><img src="/images/2017/0822/08.png" alt="jenkins"></p><h3 id="查看收件箱"><a href="#查看收件箱" class="headerlink" title="查看收件箱"></a>查看收件箱</h3><p><img src="/images/2017/0822/09.png" alt="jenkins"></p><p>参考链接：<a href="http://www.cnblogs.com/yangxia-test/p/4366172.html" target="_blank" rel="external">http://www.cnblogs.com/yangxia-test/p/4366172.html</a></p><hr>]]></content>
      
      
      <categories>
          
          <category> 自动化运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 运维 </tag>
            
            <tag> 自动化 </tag>
            
            <tag> Jenkins </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Jenkins打包不能发现本地仓库包</title>
      <link href="/arlo/d4636f97/"/>
      <url>/arlo/d4636f97/</url>
      
        <content type="html"><![CDATA[<p>jenkins里新建了一个maven风格的项目，打包过程中找不到ojdbc的包，然后手动下载，加载到本地仓库中了，jenkins依然提示找不到这个包。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[ERROR] Failed to execute goal on project atmosphere: Could not resolve dependencies for project com.ths:atmosphere:war:0.0.1-SNAPSHOT: Failure to find com.oracle:ojdbc14:jar:10.2.0.4.0 in https://repo.maven.apache.org/maven2 was cached in the local repository, resolution will not be reattempted until the update interval of central has elapsed or updates are forced -&gt; [Help 1]</div><div class="line">org.apache.maven.lifecycle.LifecycleExecutionException: Failed to execute goal on project atmosphere: Could not resolve dependencies for project com.ths:atmosphere:war:0.0.1-SNAPSHOT: Failure to find com.oracle:ojdbc14:jar:10.2.0.4.0 in https://repo.maven.apache.org/maven2 was cached in the local repository, resolution will not be reattempted until the update interval of central has elapsed or updates are forced</div><div class="line">at org.apache.maven.lifecycle.internal.LifecycleDependencyResolver.getDependencies(LifecycleDependencyResolver.java:221)</div></pre></td></tr></table></figure></p><a id="more"></a><h1 id="手动加载jar包到本地仓库"><a href="#手动加载jar包到本地仓库" class="headerlink" title="手动加载jar包到本地仓库"></a>手动加载jar包到本地仓库</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/apache-maven-3.3.9/bin/mvn install:install-file -DgroupId=com.oracle -DartifactId=ojdbc14 -Dversion=10.2.0.4.0 -Dpackaging=jar -Dfile=/usr/local/src/ojdbc14-10.2.0.4.0.jar</div></pre></td></tr></table></figure><h1 id="手动maven编译打包"><a href="#手动maven编译打包" class="headerlink" title="手动maven编译打包"></a>手动maven编译打包</h1><p>在工作目录下尝试手动编译打包，可以成功<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/apache-maven-3.3.9/bin/mvn compile install package</div></pre></td></tr></table></figure></p><p>然后我茫然了，同一台机器，同一个版本的jdk，同一个版本的mvn，同一份代码；本地maven编译打包可以成功，通过jenkins调用maven打包就找不到ojdbc的包，失败了；容我喝杯白开水压压惊！<br>我仔细排查了jenkins里边的配置，maven的全局配置使用的是默认的；maven版本和本地是一样的3.3.9；maven的仓库是默认地址~/.m2/repository;终于发现问题的所在了，<br><strong><em>原因就是maven的仓库是不一样的；本地执行maven编译打包使用的是root用户，仓库地址为/root/.m2/repository; jenkins程序是以jenkins用户启动起来的，默认的仓库地址为/var/lib/jenkins/.m2/repository/;</em></strong><br>我之前手动导入jar只导入到root用户下的仓库中了；</p><h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><h2 id="直接拷贝jar包到"><a href="#直接拷贝jar包到" class="headerlink" title="直接拷贝jar包到"></a>直接拷贝jar包到</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cp /root/.m2/repository/com/oracle/ojdbc14/10.2.0.4.0/ojdbc14-10.2.0.4.0.jar /var/lib/jenkins/.m2/repository/com/oracle/ojdbc14/10.2.0.4.0/ojdbc14-10.2.0.4.0.jar</div></pre></td></tr></table></figure><h2 id="修改本地maven仓库的地址"><a href="#修改本地maven仓库的地址" class="headerlink" title="修改本地maven仓库的地址"></a>修改本地maven仓库的地址</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">vim $MAVEN_HOME/conf/settings.xml</div><div class="line"></div><div class="line">&lt;localRepository&gt;/path/.m2/repository&lt;/localRepository&gt;</div></pre></td></tr></table></figure><h1 id="扩展阅读"><a href="#扩展阅读" class="headerlink" title="扩展阅读"></a>扩展阅读</h1><p>maven仓库的优先级别：<em>本地仓库 &gt;profile &gt; pom中的repository &gt; mirror</em><br><a href="http://toozhao.com/2012/07/13/compare-priority-of-maven-repository/" target="_blank" rel="external">http://toozhao.com/2012/07/13/compare-priority-of-maven-repository/</a>    </p>]]></content>
      
      
      <categories>
          
          <category> 自动化运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 运维 </tag>
            
            <tag> 自动化 </tag>
            
            <tag> Jenkins </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Tomcat启动慢原因排查</title>
      <link href="/arlo/d8e5626d/"/>
      <url>/arlo/d8e5626d/</url>
      
        <content type="html"><![CDATA[<h1 id="故障现象1"><a href="#故障现象1" class="headerlink" title="故障现象1"></a>故障现象1</h1><h2 id="Tomcat启动异常，卡在以下提示处"><a href="#Tomcat启动异常，卡在以下提示处" class="headerlink" title="Tomcat启动异常，卡在以下提示处"></a>Tomcat启动异常，卡在以下提示处</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">INFO: validateJarFile(/usr/local/apache-tomcat-7.0.79/webapps/thsbox/WEB-INF/lib/tomcat-servlet-api-8.5.15.jar) - jar not loaded. See Servlet Spec 3.0, section 10.7.2. Offending class: javax/servlet/Servlet.class</div><div class="line">Aug 17, 2017 2:36:19 PM org.apache.catalina.startup.TldConfig execute</div><div class="line">INFO: At least one JAR was scanned for TLDs yet contained no TLDs. Enable debug logging for this logger for a complete list of JARs that were scanned but no TLDs were found in them. Skipping unneeded JARs during scanning can improve startup time and JSP compilation time.</div></pre></td></tr></table></figure><a id="more"></a><h2 id="关闭TLDs"><a href="#关闭TLDs" class="headerlink" title="关闭TLDs"></a>关闭TLDs</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">vim  /usr/local/apache-tomcat-7.0.79/conf/context.xml</div><div class="line"></div><div class="line">&lt;Context processTlds=&quot;false&quot;&gt;</div><div class="line">    &lt;!-- Default set of monitored resources --&gt;</div><div class="line">    &lt;WatchedResource&gt;WEB-INF/web.xml&lt;/WatchedResource&gt;</div><div class="line">    ……</div><div class="line">&lt;/Context&gt;</div></pre></td></tr></table></figure><h2 id="屏蔽jar包"><a href="#屏蔽jar包" class="headerlink" title="屏蔽jar包"></a>屏蔽jar包</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">vim /usr/local/apache-tomcat-7.0.79/conf/catalina.properties</div><div class="line"></div><div class="line">tomcat.util.scan.StandardJarScanFilter.jarsToSkip=\</div><div class="line">tomcat-servlet-api-8.5.15.jar</div></pre></td></tr></table></figure><p>更改以上两个地方，日志还是会打印出来，启动还是卡主</p><h1 id="故障现象2"><a href="#故障现象2" class="headerlink" title="故障现象2"></a>故障现象2</h1><p>起初以为是启动不起来了，后来一直等着，发现只是很慢，可以启动起来的,在7分钟左右<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">INFO: Server startup in 432720 ms</div></pre></td></tr></table></figure></p><p>跟踪日志有重大发现<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">WARNING: Creation of SecureRandom instance for session ID generation using [SHA1PRNG] took [422,085] milliseconds</div></pre></td></tr></table></figure></p><h2 id="第一种修改方法"><a href="#第一种修改方法" class="headerlink" title="第一种修改方法"></a>第一种修改方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">vim /usr/local/jdk1.8.0_112/jre/lib/security/java.security</div><div class="line"></div><div class="line">#securerandom.source=file:/dev/random</div><div class="line">securerandom.source=file:/dev/./random</div></pre></td></tr></table></figure><p>修改完成后<em>INFO: Server startup in 118722 ms</em>(还是慢)</p><h2 id="第二种修改方法"><a href="#第二种修改方法" class="headerlink" title="第二种修改方法"></a>第二种修改方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">vim /usr/local/apache-tomcat-7.0.79/bin/catalina.sh</div><div class="line">修改第232行</div><div class="line">JAVA_OPTS=&quot;$JAVA_OPTS $JSSE_OPTS -Djava.security.egd=file:/dev/./urandom&quot;</div></pre></td></tr></table></figure><p>修改完成后<em>INFO: Server startup in 8985 ms</em></p><p>参考：<a href="http://www.cnblogs.com/raphael5200/p/6844510.html" target="_blank" rel="external">http://www.cnblogs.com/raphael5200/p/6844510.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> tomcat </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Lustre文件系统部署</title>
      <link href="/arlo/c6d9ba0c/"/>
      <url>/arlo/c6d9ba0c/</url>
      
        <content type="html"><![CDATA[<p>软件下载<br><a href="https://downloads.hpdd.intel.com/public/lustre/" target="_blank" rel="external">https://downloads.hpdd.intel.com/public/lustre/</a><br><a href="https://downloads.hpdd.intel.com/public/e2fsprogs/1.42.7.wc1/" target="_blank" rel="external">https://downloads.hpdd.intel.com/public/e2fsprogs/1.42.7.wc1/</a><br><a href="http://mirror.symnds.com/software/zfsonlinux/repo/epel-testing/6/x86_64/ldiskfsprogs-1.42.7.wc1.3chaos-7.ch5.1.1.x86_64.rpm" target="_blank" rel="external">http://mirror.symnds.com/software/zfsonlinux/repo/epel-testing/6/x86_64/ldiskfsprogs-1.42.7.wc1.3chaos-7.ch5.1.1.x86_64.rpm</a></p><p>查看lustre版本和操作系统对应关系参考：<a href="https://wiki.hpdd.intel.com/display/PUB/Lustre+Support+Matrix" target="_blank" rel="external">https://wiki.hpdd.intel.com/display/PUB/Lustre+Support+Matrix</a></p><p>2.4以后的版本支持多个mds<br>查看lustre版本<br>lctl get_param version</p><p>&lt;未完待续&gt;</p><p>参考文档：<br><a href="http://www.google.com.pg/patents/CN102169448A?cl=zh" target="_blank" rel="external">http://www.google.com.pg/patents/CN102169448A?cl=zh</a><br><a href="http://cdn.opensfs.org/wp-content/uploads/2014/10/6-LUG-Inspur-WWWrevised.pdf" target="_blank" rel="external">http://cdn.opensfs.org/wp-content/uploads/2014/10/6-LUG-Inspur-WWWrevised.pdf</a></p>]]></content>
      
      
      <categories>
          
          <category> HPC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Lustre </tag>
            
            <tag> 文件系统 </tag>
            
            <tag> 分布式 </tag>
            
            <tag> 集群 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Lustre文件系统简介</title>
      <link href="/arlo/ab1d26cf/"/>
      <url>/arlo/ab1d26cf/</url>
      
        <content type="html"><![CDATA[<p>Lustre是一款开源的，基于对象存储的集群并行分布式文件系统，具有很高的扩展性、可用性、易用性、性能等，在高性能计算中应用很广泛，世界十大超级计算中心当中的七个以及超过50%的全球top50超级计算机都在使用Lustre。可以支持上万个节点，数以PB的数量存储系统。从1999年lustre项目起，他的版权所有者就在不断的变换，从lustre项目组到Sun公司到Oracle再到Whamclound，最终被因特尔收购。<br><a id="more"></a><br>基于对象的文件系统将文件的元数据和文件数据分离开来，存储在不同的服务器上。文件系统的客户用利用元数据服务器和对象存储服务器来为用户提供一个完整的文件系统抽象。基于对象的文件系统具有性能优势，文件系统客户通过对象存储服务器来访问文件内容，而元数据服务器只有在文件打开时才需要连接。</p><h1 id="Lustre文件系统包括三种主要的功能单元"><a href="#Lustre文件系统包括三种主要的功能单元" class="headerlink" title="Lustre文件系统包括三种主要的功能单元"></a>Lustre文件系统包括三种主要的功能单元</h1><h2 id="元数据服务器MDS-Metadata-Server"><a href="#元数据服务器MDS-Metadata-Server" class="headerlink" title="元数据服务器MDS(Metadata Server)"></a>元数据服务器MDS(Metadata Server)</h2><p>元数据服务器（metadata servers，MDSes）。一个Lustre文件系统通常拥有两个元数据服务器（active和standby），一个元数据服务器则拥有若干元数据目标（metadata targets，MDTs）。元数据目标存储名字空间元数据：文件名、目录、访问权限、文件结构等信息。不同于诸如GPFS和PanFS等基于块并由元数据服务器控制所有块分配的分布式文件系统，Lustre元数据服务器仅仅关心路径搜索和权限检查而不会牵涉任何的文件I/O操作。该特性避免元数据服务器成为集群扩展的瓶颈。单个文件系统拥有多个元数据目标是从2.4开始引入的新特性。</p><h2 id="对象存储服务器OSS-Object-Storage-Server"><a href="#对象存储服务器OSS-Object-Storage-Server" class="headerlink" title="对象存储服务器OSS(Object Storage Server)"></a>对象存储服务器OSS(Object Storage Server)</h2><p>对象存储服务器（object storage servers，OSSes）将文件数据存储于一个或多个对象存储目标（object storage targets，OSTs）中。取决于服务器硬件，一个对象存储服务器通常有二到八个对象存储目标，每个对象存储目标管理一个本地文件系统。Lustre文件系统的空间等于所有对象存储目标的容量总和。</p><h2 id="客户端Client"><a href="#客户端Client" class="headerlink" title="客户端Client"></a>客户端Client</h2><p>客户机（Clients）能访问并使用数据。Lustre为所有客户机提供统一的命名空间。<br>Lustre支持多种网络类型，包括Infiniband，Omni-Path，以太网等。如果远程直接内存访问（RDMA）传输可用，Lustre将利用它提高吞吐量降低CPU使用率。</p><p>参考链接：<br><a href="https://zh.wikipedia.org/wiki/Lustre" target="_blank" rel="external">https://zh.wikipedia.org/wiki/Lustre</a><br><a href="https://www.ibm.com/developerworks/cn/linux/l-ofs/index.html" target="_blank" rel="external">https://www.ibm.com/developerworks/cn/linux/l-ofs/index.html</a><br><a href="http://blog.csdn.net/fsdev/article/details/7310975" target="_blank" rel="external">http://blog.csdn.net/fsdev/article/details/7310975</a><br><a href="http://mp.weixin.qq.com/s/QvBEU6yebkChMPNmcCZrWQ" target="_blank" rel="external">http://mp.weixin.qq.com/s/QvBEU6yebkChMPNmcCZrWQ</a></p>]]></content>
      
      
      <categories>
          
          <category> HPC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Lustre </tag>
            
            <tag> 文件系统 </tag>
            
            <tag> 分布式 </tag>
            
            <tag> 集群 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Mariadb(MHA)高可用集群搭建</title>
      <link href="/arlo/49c257f9/"/>
      <url>/arlo/49c257f9/</url>
      
        <content type="html"><![CDATA[<p>MHA（Master High Availability）目前在MySQL高可用方面是一个相对成熟的解决方案，它由日本DeNA公司youshimaton（现就职于Facebook公司）开发，是一套优秀的作为MySQL高可用性环境下故障切换和主从提升的高可用软件。在MySQL故障切换过程中，MHA能做到在0~30秒之内自动完成数据库的故障切换操作，并且在进行故障切换的过程中，MHA能在最大程度上保证数据的一致性，以达到真正意义上的高可用。<br><a id="more"></a><br>该软件由两部分组成：MHA Manager（管理节点）和MHA Node（数据节点）。MHA Manager可以单独部署在一台独立的机器上管理多个master-slave集群，也可以部署在一台slave节点上。MHA Node运行在每台MySQL服务器上，MHA Manager会定时探测集群中的master节点，当master出现故障时，它可以自动将最新数据的slave提升为新的master，然后将所有其他的slave重新指向新的master。整个故障转移过程对应用程序完全透明。</p><p>在MHA自动故障切换过程中，MHA试图从宕机的主服务器上保存二进制日志，最大程度的保证数据的不丢失，但这并不总是可行的。例如，如果主服务器硬件故障或无法通过ssh访问，MHA没法保存二进制日志，只进行故障转移而丢失了最新的数据。使用MySQL 5.5的半同步复制，可以大大降低数据丢失的风险。MHA可以与半同步复制结合起来。如果只有一个slave已经收到了最新的二进制日志，MHA可以将最新的二进制日志应用于其他所有的slave服务器上，因此可以保证所有节点的数据一致性。<br>目前MHA主要支持一主多从的架构，要搭建MHA,要求一个复制集群中必须最少有三台数据库服务器，一主二从，即一台充当master，一台充当备用master，另外一台充当从库，因为至少需要三台服务器，出于机器成本的考虑，淘宝也在该基础上进行了改造，目前淘宝TMHA已经支持一主一从。</p><p>MHA工作原理总结为以下几条：</p><ul><li>从宕机崩溃的master保存二进制日志事件（binlog events）;</li><li>识别含有最新更新的slave;</li><li>应用差异的中继日志(relay log) 到其他slave;</li><li>应用从master保存的二进制日志事件(binlog events);</li><li>提升一个slave为新master;</li><li>使用其他的slave连接新的master进行复制。</li></ul><h1 id="配置基础环境"><a href="#配置基础环境" class="headerlink" title="配置基础环境"></a>配置基础环境</h1><h2 id="mysql主充复制集群搭建"><a href="#mysql主充复制集群搭建" class="headerlink" title="mysql主充复制集群搭建"></a>mysql主充复制集群搭建</h2><p>mha的环境是基于mysql主从复制环境上搭建的，主从复制请参考<strong><a href="http://islocal.cc/arlo/b48c6366/">http://islocal.cc/arlo/b48c6366/</a></strong> ，本文搭建的为一主三从环境</p><h1 id="配置互相无密码验证"><a href="#配置互相无密码验证" class="headerlink" title="配置互相无密码验证"></a>配置互相无密码验证</h1><h2 id="配置hosts"><a href="#配置hosts" class="headerlink" title="配置hosts"></a>配置hosts</h2><p>复制到到其他几台机器<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">cat /etc/hosts</div><div class="line">192.168.6.126mysql_a#从库#node</div><div class="line">192.168.6.127mysql_b#主库#node</div><div class="line">192.168.6.128mysql_c#备用主库#node</div><div class="line">192.168.6.102vm02#从库#manager</div></pre></td></tr></table></figure></p><h2 id="mysql-a"><a href="#mysql-a" class="headerlink" title="mysql_a"></a>mysql_a</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ssh-keygen </div><div class="line">ssh-copy-id mysql_b</div><div class="line">ssh-copy-id mysql_c</div><div class="line">sssh-copy-id vm02</div></pre></td></tr></table></figure><h2 id="mysql-b"><a href="#mysql-b" class="headerlink" title="mysql_b"></a>mysql_b</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ssh-keygen </div><div class="line">ssh-copy-id mysql_a</div><div class="line">ssh-copy-id mysql_c</div><div class="line">sssh-copy-id vm02</div></pre></td></tr></table></figure><h2 id="mysql-c"><a href="#mysql-c" class="headerlink" title="mysql_c"></a>mysql_c</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ssh-keygen </div><div class="line">ssh-copy-id mysql_a</div><div class="line">ssh-copy-id mysql_b</div><div class="line">ssh-copy-id vm02</div></pre></td></tr></table></figure><h2 id="vm02"><a href="#vm02" class="headerlink" title="vm02"></a>vm02</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ssh-keygen </div><div class="line">ssh-copy-id mysql_a</div><div class="line">ssh-copy-id mysql_b</div><div class="line">ssh-copy-id mysql_c</div></pre></td></tr></table></figure><h1 id="mysql-配置"><a href="#mysql-配置" class="headerlink" title="mysql 配置"></a>mysql 配置</h1><h2 id="建立mysql用户，赋予权限"><a href="#建立mysql用户，赋予权限" class="headerlink" title="建立mysql用户，赋予权限"></a>建立mysql用户，赋予权限</h2><p>在3台mysql服务器上分别新建mha用户，并授权<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">MariaDB [test_repl]&gt; grant all privileges on *.* to &apos;mha&apos;@&apos;mysql_a&apos; identified by &apos;222222&apos;;</div><div class="line">MariaDB [test_repl]&gt; grant all privileges on *.* to &apos;mha&apos;@&apos;mysql_b&apos; identified by &apos;222222&apos;;</div><div class="line">MariaDB [test_repl]&gt; grant all privileges on *.* to &apos;mha&apos;@&apos;mysql_c&apos; identified by &apos;222222&apos;;</div><div class="line">MariaDB [test_repl]&gt; grant all privileges on *.* to &apos;mha&apos;@&apos;vm02&apos; identified by &apos;222222&apos;;</div></pre></td></tr></table></figure></p><h2 id="修改mysql参数"><a href="#修改mysql参数" class="headerlink" title="修改mysql参数"></a>修改mysql参数</h2><p>在2台slave上修改<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql -e &apos;set global read_only=1&apos;</div><div class="line">mysql -uroot -pffffff -e &apos;show slave status\G&apos;|egrep &apos;Slave_IO|Slave_SQL&apos;</div></pre></td></tr></table></figure></p><h1 id="安装mha-manager"><a href="#安装mha-manager" class="headerlink" title="安装mha manager"></a>安装mha manager</h1><h2 id="安装mha-manager-1"><a href="#安装mha-manager-1" class="headerlink" title="安装mha manager"></a>安装mha manager</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@vm02 src]# yum install perl-DBD-MySQL perl-Config-Tiny perl-Log-Dispatch perl-Parallel-ForkManager perl-Time-HiRes -y</div><div class="line">[root@vm02 src]# cd mha4mysql-manager-0.56/</div><div class="line">[root@vm02 mha4mysql-manager-0.56]# perl Makefile.PL </div><div class="line">[root@vm02 mha4mysql-manager-0.56]# make &amp;&amp; make install</div><div class="line">[root@vm02 ~]# cp /usr/local/src/mha4mysql-manager-0.56/samples/scripts/master_ip_failover /usr/local/bin/</div><div class="line">[root@vm02 ~]# cp /usr/local/src/mha4mysql-manager-0.56/samples/scripts/master_ip_online_change /usr/local/bin/</div></pre></td></tr></table></figure><h2 id="主配置文件"><a href="#主配置文件" class="headerlink" title="主配置文件"></a>主配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">[server default]</div><div class="line">user=mha</div><div class="line">password=222222</div><div class="line">ping_interval=1</div><div class="line">remote_workdir=/tmp</div><div class="line">repl_user=repl</div><div class="line">repl_password=111111</div><div class="line">ssh_user=root</div><div class="line"></div><div class="line">manager_workdir=/var/log/masterha/app1</div><div class="line">manager_log=/var/log/masterha/app1/manager.log</div><div class="line">master_binlog_dir= /var/lib/mysql/</div><div class="line">master_ip_failover_script= /usr/local/bin/master_ip_failover</div><div class="line">master_ip_online_change_script= /usr/local/bin/master_ip_online_change</div><div class="line">report_script=/usr/local/send_report</div><div class="line">secondary_check_script= /usr/local/bin/masterha_secondary_check -s mysql_b -s mysql_c --master_host=mysql_b --master_ip=192.168.6.127 --master_port=3306</div><div class="line">shutdown_script=&quot;&quot;</div><div class="line"></div><div class="line"></div><div class="line">[server1]</div><div class="line">hostname=mysql_b</div><div class="line">port=3306</div><div class="line"></div><div class="line">[server2]</div><div class="line">master_binlog_dir=/var/lib/mysql</div><div class="line">hostname=mysql_c</div><div class="line">port=3306</div><div class="line">candidate_master=1</div><div class="line">check_repl_delay=0</div><div class="line"></div><div class="line">[server3]</div><div class="line">master_binlog_dir=/var/lib/mysql</div><div class="line">hostname=mysql_a</div><div class="line">port=3306</div><div class="line"></div><div class="line">[server4]</div><div class="line">master_binlog_dir=/var/lib/mysql</div><div class="line">hostname=vm02</div><div class="line">port=3306</div></pre></td></tr></table></figure><h1 id="安装mha-node"><a href="#安装mha-node" class="headerlink" title="安装mha node"></a>安装mha node</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># yum install perl-ExtUtils-CBuilder perl-ExtUtils-MakeMaker  perl-DBD-MySQL </div><div class="line">[root@mysql_a mha4mysql-node-0.56]# ansible mysql -a &apos;perl Makefile.PL chdir=/usr/local/src/mha4mysql-node-0.56/&apos;</div><div class="line">[root@mysql_a mha4mysql-node-0.56]# ansible mysql -a &apos;make chdir=/usr/local/src/mha4mysql-node-0.56/&apos;</div><div class="line">[root@mysql_a mha4mysql-node-0.56]# ansible mysql -a &apos;make install chdir=/usr/local/src/mha4mysql-node-0.56/&apos;</div></pre></td></tr></table></figure><h2 id="测试ssh连通性"><a href="#测试ssh连通性" class="headerlink" title="测试ssh连通性"></a>测试ssh连通性</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">[root@vm02 ~]# masterha_check_ssh --conf=/etc/mastermha/app1.cnf</div><div class="line">Wed Aug  2 17:12:59 2017 - [warning] Global configuration file /etc/masterha_default.cnf not found. Skipping.</div><div class="line">Wed Aug  2 17:12:59 2017 - [info] Reading application default configurations from /etc/mastermha/app1.cnf..</div><div class="line">Wed Aug  2 17:12:59 2017 - [info] Reading server configurations from /etc/mastermha/app1.cnf..</div><div class="line">Wed Aug  2 17:12:59 2017 - [info] Starting SSH connection tests..</div><div class="line">Wed Aug  2 17:13:00 2017 - [debug] </div><div class="line">Wed Aug  2 17:13:00 2017 - [debug]  Connecting via SSH from root@mysql_a(192.168.6.126:22) to root@mysql_b(192.168.6.127:22)..</div><div class="line">Wed Aug  2 17:13:00 2017 - [debug]   ok.</div><div class="line">Wed Aug  2 17:13:00 2017 - [debug]  Connecting via SSH from root@mysql_a(192.168.6.126:22) to root@mysql_c(192.168.6.128:22)..</div><div class="line">Wed Aug  2 17:13:00 2017 - [debug]   ok.</div><div class="line">Wed Aug  2 17:13:01 2017 - [debug] </div><div class="line">Wed Aug  2 17:13:00 2017 - [debug]  Connecting via SSH from root@mysql_b(192.168.6.127:22) to root@mysql_a(192.168.6.126:22)..</div><div class="line">Wed Aug  2 17:13:00 2017 - [debug]   ok.</div><div class="line">Wed Aug  2 17:13:00 2017 - [debug]  Connecting via SSH from root@mysql_b(192.168.6.127:22) to root@mysql_c(192.168.6.128:22)..</div><div class="line">Wed Aug  2 17:13:00 2017 - [debug]   ok.</div><div class="line">Wed Aug  2 17:13:01 2017 - [debug] </div><div class="line">Wed Aug  2 17:13:01 2017 - [debug]  Connecting via SSH from root@mysql_c(192.168.6.128:22) to root@mysql_a(192.168.6.126:22)..</div><div class="line">Wed Aug  2 17:13:01 2017 - [debug]   ok.</div><div class="line">Wed Aug  2 17:13:01 2017 - [debug]  Connecting via SSH from root@mysql_c(192.168.6.128:22) to root@mysql_b(192.168.6.127:22)..</div><div class="line">Wed Aug  2 17:13:01 2017 - [debug]   ok.</div><div class="line">Wed Aug  2 17:13:01 2017 - [info] All SSH connection tests passed successfully.</div></pre></td></tr></table></figure><p><img src="/images/2017/0807/01.png" alt="mariadb"></p><h2 id="测试主从复制"><a href="#测试主从复制" class="headerlink" title="测试主从复制"></a>测试主从复制</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vm02 ~]# masterha_check_repl --conf=/etc/mastermha/app1.cnf</div></pre></td></tr></table></figure><h1 id="报错"><a href="#报错" class="headerlink" title="报错"></a>报错</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Thu Aug  3 17:10:16 2017 - [info] MHA::MasterMonitor version 0.56.</div><div class="line">Thu Aug  3 17:10:18 2017 - [error][/usr/local/share/perl5/MHA/MasterMonitor.pm, ln401] Error happend on checking configurations. Use of uninitialized value in string eq at /usr/local/share/perl5/MHA/Server.pm line 236.</div><div class="line">Thu Aug  3 17:10:18 2017 - [error][/usr/local/share/perl5/MHA/MasterMonitor.pm, ln500] Error happened on monitoring servers.</div><div class="line">Thu Aug  3 17:10:18 2017 - [info] Got exit code 1 (Not master dead).</div></pre></td></tr></table></figure><p><em>解决方法还没找到，所以就卡在这里了，网上也没找到有效的解决方法；好悲催，有知道的可以知道我一下，联系方式关于里边有；我怀疑是不是因为我mha0.56和Mariadb10.2.7版本不匹配，或者Mariadb太新导致的；先放一放，后期找到解决方法了再处理吧。</em></p><p>参考：<a href="http://www.cnblogs.com/gomysql/p/3675429.html" target="_blank" rel="external">http://www.cnblogs.com/gomysql/p/3675429.html</a></p>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 集群 </tag>
            
            <tag> 数据库 </tag>
            
            <tag> Mysql </tag>
            
            <tag> Mariadb </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Mariadb 读写分离集群搭建</title>
      <link href="/arlo/b48c6366/"/>
      <url>/arlo/b48c6366/</url>
      
        <content type="html"><![CDATA[<h1 id="基础环境配置"><a href="#基础环境配置" class="headerlink" title="基础环境配置"></a>基础环境配置</h1><p>iptables: disabled<br>selinux:  disabled<br>|系统        |主机名        |IP地址            |角色          |<br>|CentOS 7.2 x64    |mysql_a    |192.168.6.126    |Atlas代理服务 |<br>|CentOS 7.2 x64    |mysql_b    |192.168.6.127    |Mysql主服务器 |<br>|CentOS 7.2 x64    |mysql_c    |192.168.6.128    |Mysql 从服务器|<br><a id="more"></a></p><h2 id="在mysql-a上安装ansible"><a href="#在mysql-a上安装ansible" class="headerlink" title="在mysql_a上安装ansible"></a>在mysql_a上安装ansible</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@mysql_a ~]# yum -y install epel-release</div><div class="line">[root@mysql_a ~]# yum -y install ansible</div><div class="line">[root@mysql_a ~]# vim /etc/ansible/hosts</div><div class="line">[mysql]</div><div class="line">mysql_b</div><div class="line">mysql_c</div></pre></td></tr></table></figure><h2 id="建立无密码通信"><a href="#建立无密码通信" class="headerlink" title="建立无密码通信"></a>建立无密码通信</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@mysql_a ~]# ssh-keygen -t rsa</div><div class="line">[root@mysql_a ~]# ssh-copy-id -i ~/.ssh/id_rsa.pub mysql_b</div><div class="line">[root@mysql_a ~]# ssh-copy-id -i ~/.ssh/id_rsa.pub mysql_c</div></pre></td></tr></table></figure><h2 id="保持服务器时间同步"><a href="#保持服务器时间同步" class="headerlink" title="保持服务器时间同步"></a>保持服务器时间同步</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@mysql_a ~]# ansible mysql -a &apos;timedatectl set-timezone Asia/Shanghai&apos;</div><div class="line">[root@mysql_a ~]# ansible mysql -a &apos;timedatectl set-ntp true&apos;</div><div class="line">[root@mysql_a ~]# ansible mysql -a &apos;ntpdate cn.ntp.org.cn&apos;</div></pre></td></tr></table></figure><h2 id="配置三台服务器的hosts"><a href="#配置三台服务器的hosts" class="headerlink" title="配置三台服务器的hosts"></a>配置三台服务器的hosts</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">cat /etc/hosts</div><div class="line">192.168.6.126   mysql_a</div><div class="line">192.168.6.127   mysql_b</div><div class="line">192.168.6.128   mysql_c</div><div class="line">[root@mysql_a ~]# ansible mysql -m copy -a &apos;src=/etc/hosts dest=/etc/hosts&apos;</div></pre></td></tr></table></figure><h1 id="搭建Mariadb-mysql-主从复制"><a href="#搭建Mariadb-mysql-主从复制" class="headerlink" title="搭建Mariadb(mysql)主从复制"></a>搭建Mariadb(mysql)主从复制</h1><h2 id="配置Mariadb-yum源"><a href="#配置Mariadb-yum源" class="headerlink" title="配置Mariadb yum源"></a>配置Mariadb yum源</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@mysql_a ~]# vim /etc/yum.repos.d/MariaDB.repo</div><div class="line"># MariaDB 10.2 CentOS repository list - created 2017-07-27 03:36 UTC</div><div class="line"># http://downloads.mariadb.org/mariadb/repositories/</div><div class="line">[mariadb]</div><div class="line">name = MariaDB</div><div class="line">baseurl = http://yum.mariadb.org/10.2/centos7-amd64</div><div class="line">gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB</div><div class="line">gpgcheck=1</div></pre></td></tr></table></figure><h2 id="安装Mariadb-mysql"><a href="#安装Mariadb-mysql" class="headerlink" title="安装Mariadb(mysql)"></a>安装Mariadb(mysql)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@mysql_a ~]# ansible mysql -m copy -a &apos;src=/etc/yum.repos.d/MariaDB.repo dest=/etc/yum.repos.d/MariaDB.repo&apos;</div><div class="line">[root@mysql_a ~]# ansible mysql -m yum -a &apos;name=MariaDB-server state=installed&apos;</div><div class="line">[root@mysql_a ~]# ansible mysql -m yum -a &apos;name=MariaDB-client state=installed&apos;</div></pre></td></tr></table></figure><p><strong>Ps：也可以下载以下几个rpm包，使用yum localinstall *.rpm 进行安装（速度会快一些）</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@mysql_b mariadb]# ll</div><div class="line">total 171204</div><div class="line">-rw-r--r-- 1 root root   8353220 Aug  1 13:56 galera-25.3.20-1.rhel7.el7.centos.x86_64.rpm</div><div class="line">-rw-r--r-- 1 root root  50251656 Aug  1 09:46 MariaDB-10.2.7-centos7-x86_64-client.rpm</div><div class="line">-rw-r--r-- 1 root root    158012 Aug  1 09:46 MariaDB-10.2.7-centos7-x86_64-common.rpm</div><div class="line">-rw-r--r-- 1 root root   2975776 Aug  1 09:46 MariaDB-10.2.7-centos7-x86_64-compat.rpm</div><div class="line">-rw-r--r-- 1 root root 113565340 Aug  1 09:46 MariaDB-10.2.7-centos7-x86_64-server.rpm</div></pre></td></tr></table></figure></p><h2 id="拷贝模板配置文件"><a href="#拷贝模板配置文件" class="headerlink" title="拷贝模板配置文件"></a>拷贝模板配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@mysql_a ~]# ansible mysql -a &apos;cp /usr/share/mysql/my-medium.cnf /etc/my.cnf&apos;</div></pre></td></tr></table></figure><h2 id="各服务器上执行初始化操作"><a href="#各服务器上执行初始化操作" class="headerlink" title="各服务器上执行初始化操作"></a>各服务器上执行初始化操作</h2><p>mysql_secure_installation</p><h2 id="修改mysql-b配置文件"><a href="#修改mysql-b配置文件" class="headerlink" title="修改mysql_b配置文件"></a>修改mysql_b配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">vim /etc/my.cnf</div><div class="line">log-bin=/var/lib/mysql/mysql-bin</div><div class="line">binlog_format=row</div><div class="line">server-id = 127</div><div class="line">sync_binlog = 1</div><div class="line">innodb_support_xa = 1</div><div class="line">innodb-flush-log-at-trx-commit=1</div></pre></td></tr></table></figure><h2 id="建立授权账号"><a href="#建立授权账号" class="headerlink" title="建立授权账号"></a>建立授权账号</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@mysql_b mariadb]# mysql -uroot -pffffff</div><div class="line">MariaDB [mysql]&gt; grant replication slave on *.* to &apos;repl&apos;@&apos;192.168.6.%&apos; identified by &apos;111111&apos;;</div><div class="line">MariaDB [(none)]&gt; show master status;</div><div class="line">+------------------+----------+--------------+------------------+</div><div class="line">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB |</div><div class="line">+------------------+----------+--------------+------------------+</div><div class="line">| mysql-bin.000002 |      342 |              |                  |</div><div class="line">+------------------+----------+--------------+------------------+</div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure><h2 id="修改mysql-c配置文件"><a href="#修改mysql-c配置文件" class="headerlink" title="修改mysql_c配置文件"></a>修改mysql_c配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">vim /etc/my.cnf</div><div class="line">binlog_format=row</div><div class="line">server-id  = 128</div><div class="line">replicate-ignore-db=mysql</div><div class="line">relay_log=relay-bin</div></pre></td></tr></table></figure><h2 id="重启两台Mariadb-mysql-服务"><a href="#重启两台Mariadb-mysql-服务" class="headerlink" title="重启两台Mariadb(mysql)服务"></a>重启两台Mariadb(mysql)服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@mysql_a ~]# ansible mysql -a &apos;systemctl restart mariadb.service&apos;</div></pre></td></tr></table></figure><h2 id="开启主从同步"><a href="#开启主从同步" class="headerlink" title="开启主从同步"></a>开启主从同步</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@mysql_c mysql]# mysql -uroot –pffffff</div><div class="line">MariaDB [(none)]&gt; stop slave;</div><div class="line">MariaDB [(none)]&gt; change master to master_host=&apos;mysql_b&apos;, master_user=&apos;repl&apos;, master_password=&apos;111111&apos;,master_log_file=&apos;mysql-bin.000002&apos;,master_log_pos=342;</div><div class="line">MariaDB [(none)]&gt; start slave;</div><div class="line">MariaDB [(none)]&gt; show slave status\G</div></pre></td></tr></table></figure><p><img src="/images/2017/0801/01.png" alt="mariadb"></p><h1 id="Atlas安装配置"><a href="#Atlas安装配置" class="headerlink" title="Atlas安装配置"></a>Atlas安装配置</h1><h2 id="安装Mariadb-Mysql-客户端"><a href="#安装Mariadb-Mysql-客户端" class="headerlink" title="安装Mariadb(Mysql)客户端"></a>安装Mariadb(Mysql)客户端</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@mysql_a mariadb]# yum install MariaDB-client</div><div class="line">[root@mysql_a mariadb]# systemctl status mariadb.service //确保Atlas本机没有mysql服务被启动</div><div class="line">Unit mariadb.service could not be found.</div></pre></td></tr></table></figure><h2 id="安装atlas"><a href="#安装atlas" class="headerlink" title="安装atlas"></a>安装atlas</h2><p>下载的时候有两个软件包带分片功能的Atlas-sharding 和Atlas，我们下后边这个（el6的包centos7可以安装）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@mysql_a src]# axel https://github.com/Qihoo360/Atlas/releases/download/2.2.1/Atlas-2.2.1.el6.x86_64.rpm</div><div class="line">[root@mysql_a src]# rpm -ivh Atlas-2.2.1.el6.x86_64.rpm</div></pre></td></tr></table></figure></p><p>安装目录为/usr/local/mysql-proxy/，会在此目录下生成bin,conf,lib,log四个目录</p><h2 id="生成一个加密字符串，配置文件中会用到"><a href="#生成一个加密字符串，配置文件中会用到" class="headerlink" title="生成一个加密字符串，配置文件中会用到"></a>生成一个加密字符串，配置文件中会用到</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@mysql_a bin]# ./encrypt 111111</div><div class="line">kOVJsquUepY=</div></pre></td></tr></table></figure><h2 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h2><p><em>360团队很良心，中文注释很详细</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line">[root@mysql_a bin]# vim /usr/local/mysql-proxy/conf/test.cnf</div><div class="line">[mysql-proxy]</div><div class="line"></div><div class="line">#带#号的为非必需的配置项目</div><div class="line"></div><div class="line">#管理接口的用户名</div><div class="line">admin-username = nsxq</div><div class="line"></div><div class="line">#管理接口的密码</div><div class="line">admin-password = ffffff</div><div class="line"></div><div class="line">#Atlas后端连接的MySQL主库的IP和端口，可设置多项，用逗号分隔</div><div class="line">proxy-backend-addresses = 192.168.6.127:3306</div><div class="line"></div><div class="line">#Atlas后端连接的MySQL从库的IP和端口，@后面的数字代表权重，用来作负载均衡，若省略则默认为1，可设置多项，用逗号分隔</div><div class="line">proxy-read-only-backend-addresses = 192.168.6.128:3306@1</div><div class="line"></div><div class="line">#用户名与其对应的加密过的MySQL密码，密码使用PREFIX/bin目录下的加密程序encrypt加密，下行的user1和user2为示例，将其替换为你的MySQL的用户名和加密密码！</div><div class="line">pwds = atlas:kOVJsquUepY=</div><div class="line"></div><div class="line">#设置Atlas的运行方式，设为true时为守护进程方式，设为false时为前台方式，一般开发调试时设为false，线上运行时设为true,true后面不能有空格。</div><div class="line">daemon = true</div><div class="line"></div><div class="line">#设置Atlas的运行方式，设为true时Atlas会启动两个进程，一个为monitor，一个为worker，monitor在worker意外退出后会自动将其重启，设为false时只有worker，没有monitor，一般开发调试时设为false，线上&gt;</div><div class="line">运行时设为true,true后面不能有空格。</div><div class="line">keepalive = true</div><div class="line"></div><div class="line">#工作线程数，对Atlas的性能有很大影响，可根据情况适当设置</div><div class="line">event-threads = 8</div><div class="line"></div><div class="line">#日志级别，分为message、warning、critical、error、debug五个级别</div><div class="line">log-level = message</div><div class="line"></div><div class="line">#日志存放的路径</div><div class="line">log-path = /usr/local/mysql-proxy/log</div><div class="line"></div><div class="line">#SQL日志的开关，可设置为OFF、ON、REALTIME，OFF代表不记录SQL日志，ON代表记录SQL日志，REALTIME代表记录SQL日志且实时写入磁盘，默认为OFF</div><div class="line">#sql-log = OFF</div><div class="line"></div><div class="line">#慢日志输出设置。当设置了该参数时，则日志只输出执行时间超过sql-log-slow（单位：ms)的日志记录。不设置该参数则输出全部日志。</div><div class="line">#sql-log-slow = 10</div><div class="line"></div><div class="line">#实例名称，用于同一台机器上多个Atlas实例间的区分</div><div class="line">#instance = test</div><div class="line"></div><div class="line">#Atlas监听的工作接口IP和端口</div><div class="line">proxy-address = 0.0.0.0:1234 </div><div class="line">#分表设置，此例中person为库名，mt为表名，id为分表字段，3为子表数量，可设置多项，以逗号分隔，若不分表则不需要设置该项</div><div class="line">#tables = person.mt.id.3</div><div class="line"></div><div class="line">#默认字符集，设置该项后客户端不再需要执行SET NAMES语句</div><div class="line">#charset = utf8</div><div class="line"></div><div class="line">#允许连接Atlas的客户端的IP，可以是精确IP，也可以是IP段，以逗号分隔，若不设置该项则允许所有IP连接，否则只允许列表中的IP连接</div><div class="line">#client-ips = 127.0.0.1, 192.168.1</div><div class="line"></div><div class="line">#Atlas前面挂接的LVS的物理网卡的IP(注意不是虚IP)，若有LVS且设置了client-ips则此项必须设置，否则可以不设置</div><div class="line">#lvs-ips = 192.168.1.1</div></pre></td></tr></table></figure></p><h2 id="启动Atlas服务"><a href="#启动Atlas服务" class="headerlink" title="启动Atlas服务"></a>启动Atlas服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@mysql_a bin]# ./mysql-proxyd test start</div><div class="line">[root@mysql_a mariadb]# ps -ef |grep mysql</div><div class="line">root     21456     1  0 15:24 ?        00:00:00 /usr/local/mysql-proxy/bin/mysql-proxy --defaults-file=/usr/local/mysql-proxy/conf/test.cnf</div><div class="line">root     21457 21456  0 15:24 ?        00:00:00 /usr/local/mysql-proxy/bin/mysql-proxy --defaults-file=/usr/local/mysql-proxy/conf/test.cnf</div><div class="line">root     21607 20025  0 15:35 pts/0    00:00:00 grep --color=auto mysql</div></pre></td></tr></table></figure><h2 id="通过Atlas访问"><a href="#通过Atlas访问" class="headerlink" title="通过Atlas访问"></a>通过Atlas访问</h2><h3 id="通过管理接口访问"><a href="#通过管理接口访问" class="headerlink" title="通过管理接口访问"></a>通过管理接口访问</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@mysql_a mariadb]# mysql -h127.0.0.1 -P2345 -unsxq –pffffff</div></pre></td></tr></table></figure><h3 id="通过工作接口访问"><a href="#通过工作接口访问" class="headerlink" title="通过工作接口访问"></a>通过工作接口访问</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">要保证这个用户在主从节点上都有权限，在主从节点上都添加一个用户</div><div class="line">MariaDB [mysql]&gt; grant all on *.* to atlas@&apos;192.168.6.%&apos; identified by &apos;111111&apos;;</div><div class="line">[root@mysql_a mariadb]# mysql -h127.0.0.1 -P1234 -uatlas -p111111</div></pre></td></tr></table></figure><p>参考连接：<br><a href="https://github.com/Qihoo360/Atlas/wiki" target="_blank" rel="external">https://github.com/Qihoo360/Atlas/wiki</a><br><a href="http://www.cnblogs.com/yyhh/p/5084844.html" target="_blank" rel="external">http://www.cnblogs.com/yyhh/p/5084844.html</a></p>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Mysql </tag>
            
            <tag> Mariadb </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Mariadb主从复制集群</title>
      <link href="/arlo/fe63d61c/"/>
      <url>/arlo/fe63d61c/</url>
      
        <content type="html"><![CDATA[<p>Centos7系统中将Mysql置换为Mariadb了；Mariadb是Mysql数据库被Oracle公司收购之后Mysql之前的开发者基于mysql开发的开源数据库，完全兼容mysql；更详细的纠葛请自行google。<br>Mysql的主从复制是指从服务器向主服务器索取二进制binlog文件，在从服务器上把日志文件重新执行，从而获取主服务器数据，保证从服务器和主服务器的数据保持同步。但由于是异步的复制，从服务器在一定程度上落后于主服务器，刚写入到主服务器上的数据可能服务在从服务器上查询得到。<br><a id="more"></a></p><h1 id="复制原理过程"><a href="#复制原理过程" class="headerlink" title="复制原理过程"></a>复制原理过程</h1><ul><li>从服务器创建I/O线程连接主数据库，向主数据请库服务器求二进制日志文件（binlog）</li><li>主服务器上启动Binlog Dump,将二进制日志文件发送给I/O线程，I/O线程获取数据后将数据卸载从库的中继日志中（relay log）</li><li>SQL线程读取中继日志并执行</li></ul><h1 id="日志方式"><a href="#日志方式" class="headerlink" title="日志方式"></a>日志方式</h1><ul><li><strong>statement</strong>：基于语句级别的binlog，记录修改数据的sql语句。</li><li><strong>row</strong>： 基于行级别的binlog逐行记录数据的变更。</li><li><strong>mixed</strong>：由Mysql数据库自动选择哪种方式记录binlog。<br>raw格式下日志文件会很大，会影响磁盘的I/O,在传输过程中也会影响带宽，根据情况自行选择。</li></ul><h1 id="集群环境搭建"><a href="#集群环境搭建" class="headerlink" title="集群环境搭建"></a>集群环境搭建</h1><p>系统：Centos7 x64<br>软件：Mariadb 10.2 stable</p><h2 id="保持服务器时间同步"><a href="#保持服务器时间同步" class="headerlink" title="保持服务器时间同步"></a>保持服务器时间同步</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">timedatectl set-timezone Asia/Shanghai</div><div class="line">timedatectl set-ntp true</div><div class="line">ntpdate cn.ntp.org.cn</div></pre></td></tr></table></figure><h2 id="安装Mariadb软件"><a href="#安装Mariadb软件" class="headerlink" title="安装Mariadb软件"></a>安装Mariadb软件</h2><h3 id="配置yum源"><a href="#配置yum源" class="headerlink" title="配置yum源"></a>配置yum源</h3><p>参考<a href="https://downloads.mariadb.org/mariadb/repositories/" target="_blank" rel="external">https://downloads.mariadb.org/mariadb/repositories/</a><br>vim /etc/yum.repos.d/MariaDB.repo<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># MariaDB 10.2 CentOS repository list - created 2017-07-27 03:36 UTC</div><div class="line"># http://downloads.mariadb.org/mariadb/repositories/</div><div class="line">[mariadb]</div><div class="line">name = MariaDB</div><div class="line">baseurl = http://yum.mariadb.org/10.2/centos7-amd64</div><div class="line">gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB</div><div class="line">gpgcheck=1</div></pre></td></tr></table></figure></p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install MariaDB-server MariaDB-client</div></pre></td></tr></table></figure><h2 id="启动服务，并设置开机启动"><a href="#启动服务，并设置开机启动" class="headerlink" title="启动服务，并设置开机启动"></a>启动服务，并设置开机启动</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">systemctl start mariadb.service</div><div class="line">systemctl enable mariadb.service</div></pre></td></tr></table></figure><h2 id="初始化服务器"><a href="#初始化服务器" class="headerlink" title="初始化服务器"></a>初始化服务器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">可以初始化过程中设置密码</div><div class="line">mysql_secure_installation</div><div class="line">也可以进入数据库后设置密码</div><div class="line">update user set password=PASSWORD(&quot;SOME_ROOT_PASSWORD&quot;) where User=&apos;root&apos;;</div></pre></td></tr></table></figure><h2 id="配置主服务器"><a href="#配置主服务器" class="headerlink" title="配置主服务器"></a>配置主服务器</h2><p>将以下配置添加到my.cnf中[mysqld]下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">server-id=102#服务器ID号(取值范围为1到2的32次方-1的整数，建议使用ip地址最后一位，保持唯一性),写成server_id 不生效</div><div class="line">log-bin=/var/lib/mysql/mariadb-bin #二进制文件存放位置</div><div class="line">binlog_format=row#日志类型为raw</div><div class="line">sync_binlog = 1#事务一提交，就将二进制日志同步至磁盘上</div><div class="line">innodb_support_xa = 1#支持分布式事务</div><div class="line">innodb-flush-log-at-trx-commit=1#针对innodb的设置</div></pre></td></tr></table></figure></p><p>给slave开相应的权限<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">GRANT REPLICATION SLAVE ON *.* TO ‘repl’@‘192.168.6.103’ IDENTIFIED BY ‘123456’;</div></pre></td></tr></table></figure></p><h2 id="配置从服务器"><a href="#配置从服务器" class="headerlink" title="配置从服务器"></a>配置从服务器</h2><p>将以下配置添加到my.cnf中[mysqld]下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">server-id=103#服务器ID号(取值范围为1到2的32次方-1的整数，建议使用ip地址最后一位，保持唯一性)</div><div class="line">read_only = 1#从服务器为只读状态（确保数据的一致性）</div><div class="line">log-bin=/var/lib/mysql/mariadb-bin #中继日志存放目录   </div><div class="line">replicate-ignore-db=mysql#不需要同步的数据库（忽略的库最好配置在slave上，让master有最全的binlog）</div></pre></td></tr></table></figure></p><p><font color="red">Mysql版本从5.1.7以后开始就不支持“master-host”类似的参数；</font><br>在从库上执行如下命令；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">change master to master_host=&apos;192.168.6.102&apos;, master_user=&apos;repl&apos;, master_password=&apos;123456&apos;;    #好像不需要master_log_file和master_log_pos也可以;</div><div class="line">slave start;</div><div class="line">show slave status\G  #查看同步状态</div></pre></td></tr></table></figure></p><p><img src="/images/2017/0726/00.png" alt="mariadb"></p><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>在主服务器上新建数据库，建表，插入数据;在从库上查询；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">mysql -uroot -pffffff</div><div class="line">MariaDB [(none)]&gt; create database test_repl;</div><div class="line">MariaDB [(none)]&gt; use test_repl;</div><div class="line">MariaDB [test_repl]&gt; CREATE TABLE Persons (</div><div class="line">PersonID int,</div><div class="line">LastName varchar(255),</div><div class="line">FirstName varchar(255),</div><div class="line">Address varchar(255),</div><div class="line">City varchar(255)</div><div class="line">);</div><div class="line">MariaDB [test_repl]&gt; INSERT INTO Persons VALUES (1, &quot;LastName1&quot;, &quot;FirstName1&quot;, &quot;Address1&quot;, &quot;City1&quot;);</div></pre></td></tr></table></figure></p><p>在从库上查询；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mysql -uroot -pffffff</div><div class="line">MariaDB [(none)]&gt; use test_repl;</div><div class="line">MariaDB [test_repl]&gt; select * from Persons;</div></pre></td></tr></table></figure></p><p>可以在主库上看到连接的从库信息（一主多从很有用）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">MariaDB [test_repl]&gt; show slave hosts;</div><div class="line">+-----------+------+------+-----------+</div><div class="line">| Server_id | Host | Port | Master_id |</div><div class="line">+-----------+------+------+-----------+</div><div class="line">|         3 |      | 3306 |         1 |</div><div class="line">+-----------+------+------+-----------+</div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure></p><h1 id="问题记录"><a href="#问题记录" class="headerlink" title="问题记录"></a>问题记录</h1><h2 id="Q1："><a href="#Q1：" class="headerlink" title="Q1："></a>Q1：</h2><p>Q：Got fatal error 1236 from master when reading data from binary log: ‘Could not find first log file name in binary log index file’<br>A：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">MariaDB [test_repl]&gt; stop slave;</div><div class="line">MariaDB [test_repl]&gt; reset slave;</div><div class="line">MariaDB [test_repl]&gt; start slave;</div></pre></td></tr></table></figure></p><h2 id="Q2"><a href="#Q2" class="headerlink" title="Q2:"></a>Q2:</h2><p>Q:Could not execute Update_rows event on table mysql.user; Can’t find record in ‘user’, Error_code: 1032; handler error HA_ERR_KEY_NOT_FOUND; the event’s master log mariadb-bin.000003, end_log_pos 1749<br>A:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">MariaDB [test_repl]&gt; stop slave;  </div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line">MariaDB [test_repl]&gt; set global sql_slave_skip_counter=1;  </div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line">MariaDB [test_repl]&gt; start slave;</div><div class="line">Query OK, 0 rows affected (0.01 sec)</div></pre></td></tr></table></figure></p><h2 id="Q3："><a href="#Q3：" class="headerlink" title="Q3："></a>Q3：</h2><p>Q：<br>Last_SQL_Errno: 1146<br>Last_SQL_Error: Unable to load replication GTID slave state from mysql.gtid_slave_pos: Table ‘mysql.gtid_slave_pos’ doesn’t exist<br>A:<br>主从的版本是一样是，不清楚为什么会出现这样的问题，使用mysql_upgrade升级修复了一下好了；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql_upgrade -uroot -pffffff</div></pre></td></tr></table></figure></p><h1 id="扩展阅读"><a href="#扩展阅读" class="headerlink" title="扩展阅读"></a>扩展阅读</h1><p>Mysql默认的复制是异步的，Mysql(5.5以后版本)<strong><a href="http://www.cnblogs.com/ivictor/p/5735580.html" target="_blank" rel="external">半同步复制</a></strong></p><p>参考链接：<br><a href="https://linux.cn/article-5491-1.html" target="_blank" rel="external">https://linux.cn/article-5491-1.html</a><br><a href="http://joelhy.github.io/2015/02/06/mariadb-master-slave-replication/" target="_blank" rel="external">http://joelhy.github.io/2015/02/06/mariadb-master-slave-replication/</a><br><a href="http://www.cnblogs.com/gomysql/p/3662492.html" target="_blank" rel="external">http://www.cnblogs.com/gomysql/p/3662492.html</a></p><hr>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Mysql </tag>
            
            <tag> Mariadb </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Linux下多线程下载工具Axel</title>
      <link href="/arlo/1a27e5da/"/>
      <url>/arlo/1a27e5da/</url>
      
        <content type="html"><![CDATA[<p>Linux 平台下默认的下载工具是wget，可在慢速或不稳定的网络连接下保持健壮性，如果由于网络问题下载失败，它将继续重试，直到整个文件下载完成；但是wget不支持多线程下载，这里推荐一个axel，可实现对同一个文件建立多个连接，每个连接下载单独的文件片段以更快地完成下载，支持HTTP,HTTPS,FTP,FTPS协议；<br><a id="more"></a></p><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="源码安装"><a href="#源码安装" class="headerlink" title="源码安装"></a>源码安装</h2><p>下载地址<a href="https://sourceforge.net/projects/axel2/files/" target="_blank" rel="external">https://sourceforge.net/projects/axel2/files/</a></p><h2 id="包管理器安装"><a href="#包管理器安装" class="headerlink" title="包管理器安装"></a>包管理器安装</h2><p>看教程说epel源中带有这个工具，但是我Centos 6.8 没发现；于是自已下载一个rpm包安装，推荐下载地址 <a href="http://pkgs.org/" target="_blank" rel="external">http://pkgs.org/</a></p><h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><h2 id="基本用法如下："><a href="#基本用法如下：" class="headerlink" title="基本用法如下："></a>基本用法如下：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alex [选项][下载目录][下载地址]</div></pre></td></tr></table></figure><h2 id="参数如下："><a href="#参数如下：" class="headerlink" title="参数如下："></a>参数如下：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">-s 指定每秒下载最大的比特数（如限速为512KB/s，设置为 -s 512000）</div><div class="line">-n 指定同时打开的下载线程数 (如指定10个线程，设置为 -n 10)</div><div class="line">-o 指定下载路径（如下载到/tmp目录，设置为 -o /tmp；也可以指定下载后的文件名，如下载后文件名为test.tgz,设置为 -o /tmp/test.tgz）</div><div class="line">-S 搜索镜像，并下载</div><div class="line">-v 打印更多状态信息</div><div class="line">-a 打印简洁的进度信息</div><div class="line">-q 不显示下载进度</div></pre></td></tr></table></figure><h1 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">axel -n 10 -a -o /tmp ftp://ftpprd.ncep.noaa.gov/pub/data/nccf/com/gfs/prod/enkf.20170724/12/gdas.t12z.atmf009s.mem011.nemsio</div></pre></td></tr></table></figure><h1 id="断点续传"><a href="#断点续传" class="headerlink" title="断点续传"></a>断点续传</h1><p><strong>如果下载过程中下载中断可以再执行下载命令即可恢复上次的下载进度</strong>。axel 默认具有恢复未完成的下载的行为。Axel 在下载文件时定期更新状态文件（扩展名为 .st）。由于某些原因，下载中途停止了？不用担心，只要使用相同的 axel 命令，它将会检查 file 和 file.st，如果找到，它会从停止处恢复下载。</p><p>参考：<a href="http://man.linuxde.net/axel" target="_blank" rel="external">http://man.linuxde.net/axel</a></p>]]></content>
      
      
      <categories>
          
          <category> 常识 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 常识 </tag>
            
            <tag> 下载 </tag>
            
            <tag> axel </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Intel编译器(parallel_studio_xe)安装</title>
      <link href="/arlo/e5fb788a/"/>
      <url>/arlo/e5fb788a/</url>
      
        <content type="html"><![CDATA[<h1 id="软件环境"><a href="#软件环境" class="headerlink" title="软件环境"></a>软件环境</h1><p>CentOS 7.2 x64<br>parallel_studio_xe_2013_update2_intel64.tgz<br>intel_eval.lic</p><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="安装依赖环境"><a href="#安装依赖环境" class="headerlink" title="安装依赖环境"></a>安装依赖环境</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# yum -y install libstdc++.so.5 gcc-c++</div></pre></td></tr></table></figure><h2 id="开始安装"><a href="#开始安装" class="headerlink" title="开始安装"></a>开始安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@vm00 src]# tar xf parallel_studio_xe_2013_update2_intel64</div><div class="line">[root@vm00 src]# cd parallel_studio_xe_2013_update2_intel64</div><div class="line">[root@vm00 parallel_studio_xe_2013_update2_intel64]# ./install.sh</div></pre></td></tr></table></figure><a id="more"></a><h2 id="初始化，欢迎界面"><a href="#初始化，欢迎界面" class="headerlink" title="初始化，欢迎界面"></a>初始化，欢迎界面</h2><p>-——————————————————————————-<br>Initializing, please wait…<br>-——————————————————————————-</p><p>Step no: 1 of 7 | Welcome<br>-——————————————————————————-<br>Welcome to the Intel(R) Parallel Studio XE 2013 Update 2 for Linux* installation<br>program.</p><p>-——————————————————————————-<br>You will complete the steps below during this installation:<br>Step 1 : Welcome<br>Step 2 : License<br>Step 3 : Activation<br>Step 4 : Intel(R) Software Improvement Program<br>Step 5 : Options<br>Step 6 : Installation<br>Step 7 : Complete<br>-——————————————————————————-<br>Press “Enter” key to continue or “q” to quit: <font color="red"><strong>回车</strong></font><br>-——————————————————————————-<br>Checking the prerequisites. It can take several minutes. Please wait…<br>-——————————————————————————-</p><h2 id="提示不支持的操作系统，跳过即可"><a href="#提示不支持的操作系统，跳过即可" class="headerlink" title="提示不支持的操作系统，跳过即可"></a>提示不支持的操作系统，跳过即可</h2><p>Step no: 1 of 7 | Options &gt; Missing Optional Pre-requisite(s)<br>-——————————————————————————-<br>There are one or more optional unresolved issues. It is highly recommended to<br>resolve them all before you continue the installation. You can fix them without<br>exiting from the installation and re-check. Or you can quit from the<br>installation, fix them and run the installation again.<br>-——————————————————————————-<br>Missing optional pre-requisites<br>– Intel(R) Composer XE 2013 Update 2 for Linux*: unsupported OS<br>-——————————————————————————-</p><ol><li>Skip missing optional pre-requisites [default]</li><li>Show the detailed info about issue(s)</li><li>Re-check the pre-requisites</li></ol><p>h. Help<br>b. Back to the previous menu<br>q. Quit<br>-——————————————————————————-<br>Please type a selection or press “Enter” to accept default choice [1]: <font color="red">回车</font> </p><h2 id="接受条约，输入accept"><a href="#接受条约，输入accept" class="headerlink" title="接受条约，输入accept"></a>接受条约，输入accept</h2><p>Step no: 2 of 7 | License<br>-——————————————————————————-<br>As noted in the Intel(R) Software Development Product End User License<br>Agreement, the Intel(R) Software Development Product you install will send Intel<br>the products serial number and other system information to help Intel improve<br>the product and validate license compliance. No personal information will be<br>transmitted.<br>-——————————————————————————-<br>To continue with the installation of this product you are required to accept<br>the terms and conditions of the End User License Agreement (EULA). The EULA<br>is displayed using the “more” utility. Press the spacebar to advance to the<br>next page or enter “q” to skip to the end. After reading the EULA, you must<br>enter “accept” to continue the installation or “decline” to return to the<br>previous menu.<br>-——————————————————————————-<br>IMPORTANT - READ BEFORE COPYING, INSTALLING OR USING.<br>Do not copy, install, distribute, public display, or use the Materials provided<br>under this license agreement (“Agreement”), until you have carefully read the<br>following terms and conditions.</p><p>By copying, installing, distributing, publicly displaying, or otherwise using<br>the Materials, you agree to be bound by the terms of this Agreement.<br>If you do not agree to the terms of this Agreement, do not copy,<br>install, distribute, publicly display, or use the Materials.</p><p>End User License Agreement for the Intel(R) Software Development Products<br>(Version May 2012)</p><ol><li>LICENSE DEFINITIONS: </li></ol><p>A.    “Materials” are defined as the software, documentation, license key<br>codes (if applicable) and other materials, including any updates and upgrade<br>thereto, that are provided to you under this Agreement.  Materials also<br>include the Redistributables, Cluster OpenMP Library, and Sample Source<br>as defined below.</p><p>B.    “Redistributables” are the files listed in the following text files that<br>may be included in the Materials for the applicable Intel Software Development<br>Product: clredist.txt, credist.txt, fredist.txt, redist.txt, redist-rt.txt.</p><p>C.    “Cluster OpenMP Library”, is comprised of the files listed in the<br>“clredist.txt” file specified above, is the Intel(R) Cluster OpenMP<em> Library<br>add-on option to the Intel(R) C++ Compiler for Linux</em> and<br>Intel(R) Fortran Compiler for Linux* products (“Intel Compiler for Linux”).<br>The use of the Cluster OpenMP Library is conditioned on having a valid license<br>from Intel for the Cluster OpenMP Library and for either Intel(R) C++ Compiler<br>for Linux or Intel(R) Fortran Compiler for Linux, and further is governed by the<br>terms and conditions of the license agreement for applicable the Intel Compiler<br>for Linux.</p><p>D.    “Source Code” is defined as the Materials provided in human readable<br>format, and includes modification that you make or are made on your behalf.  </p><p>E.    “Sample Source” is the Source Code file(s) that: (i) demonstrate certain<br>limited functions included in the binary libraries of the Intel(R) Integrated<br>Performance Primitives (“Intel(R) IPPs”); (ii) are identified as Intel IPP<br>sample source code; (iii) are obtained separately from Intel after you register<br>your copy of the Intel(R) IPPs product with Intel; and (iv) are subject to all<br>of the terms and conditions of this Agreement.</p><p>F.    “Microsoft Platforms” means any current and future Microsoft operating<br>system products, Microsoft run-time technologies (such as the .NET Framework),<br>and Microsoft application platforms<br>(such as Microsoft Office or Microsoft Dynamics) that Microsoft offers.</p><ol><li>LICENSE GRANT:</li></ol><p>A.    Subject to all of the terms and conditions of this Agreement,<br>Intel Corporation (“Intel”) grants to you a non-exclusive, non-assignable,<br>copyright license to use the Materials. </p><p>B.    Subject to all of the terms and conditions of this Agreement, Intel<br>grants to you a non-exclusive, non-assignable copyright license to modify the<br>Materials, or any portions thereof, that are (i) provided in Source Code form<br>or, (ii) are defined as Redistributables and are provided in text form.</p><p>C.    Subject to all of the terms and conditions of this Agreement and any<br>specific restrictions which may appear in the Redistributables text files, Intel<br>grants to you a non-exclusive, non-assignable, fully-paid copyright license to<br>distribute (except if you received the Materials under an Evaluation License<br>as specified below) the Redistributables, including any modifications pursuant<br>to Section 2.B, or any portions thereof, as part of the product or application<br>you developed using the Materials.  If such application is a software<br>development library, then attribution, as specified in the product release notes<br>of the corresponding Materials shall be displayed prominently in that product’s<br>or application’s associated documentation and on the product or application’s<br>web site (if any). </p><ol><li>LICENSE RESTRICTIONS:</li></ol><p>A.    If you receive your first copy of the Materials electronically, and a<br>second copy on media, then you may use the second copy only in accordance with<br>your applicable license stated in this Agreement, or for backup or archival<br>purposes.  You may not provide the second copy to another user.</p><p>B.    You may NOT:  (i) use, copy, distribute, or publicly display the<br>Materials except as provided in this Agreement; (ii) rent or lease the Materials<br>to any third party; (iii) assign this Agreement or transfer the Materials<br>without the express written consent of Intel; (iv) modify, adapt, or translate<br>the Materials in whole or in part except as provided in this Agreement;<br>(v) reverse engineer, decompile, or disassemble the Materials; (vi) attempt to<br>modify or tamper with the normal function of a license manager that regulates<br>usage of the Materials; (vii) distribute, sublicense or transfer the Source<br>Code form of any components of the Materials or derivatives thereof to any third<br>party except as provided in this Agreement; (viii) distribute Redistributables<br>except as part of a larger program that adds significant primary functionality<br>different from that of the Redistributables; (ix) distribute the<br>Redistributables to run on a platform other than a Microsoft Platform if per the<br>accompanying user documentation the Materials are meant to execute only on a<br>Microsoft Platform; (x) include the Redistributables in malicious, deceptive,<br>or unlawful programs; or (xi) modify or distribute the Source Code of any<br>Redistributable so that any part of it becomes subject to an Excluded License.<br>An “Excluded License” is one that requires, as a condition of use, modification,<br>or distribution, that the licensed software or other software incorporated into,<br>derived from or distributed with such software (a) be disclosed or distributed<br>in Source Code form; (b) be licensed by the user to third parties for the<br>purpose of making and/or distributing derivative works;<br>or (c) be redistributable at no charge.  Open source software includes, without<br>limitation, software licensed or distributed under any of the<br>following licenses or distribution models, or licenses or distribution models<br>substantially similar to any of the following: (a) GNU’s General Public License<br>(GPL) or Lesser/Library GPL (LGPL), (b) the Artistic License (e.g., PERL),<br>(c) the Mozilla Public License, (d) the Netscape Public License, (e) the Sun<br>Community Source License (SCSL), (f) the Sun Industry Source License (SISL),<br>and (g) the Common Public License (CPL).</p><p>C.    The scope and term of your license depends on the type of license you<br>are provided by Intel.  The variety of license types are set forth below, which<br>may not be available for all “Intel(R) Software Development Products” and<br>therefore may not apply to the Materials.  For more information on the types of<br>licenses, please contact Intel or your sales representative.</p><p>i.    PRE-RELEASE LICENSE:  If you are using the Materials under the control<br>of a pre-release license, (a) the Materials are deemed to be pre-release code<br>(e.g., alpha or beta release, etc), which may not be fully functional and which<br>Intel may substantially modify in development of a  commercial version, and for<br>which Intel makes no assurances that it will ever develop or make generally<br>available a commercial version, and (b) if you are an individual, you have the<br>right to use the Materials only for the duration of the pre-release term, which<br>is specified in the Materials, or until the commercial release, if any, of the<br>Materials, whichever is shorter.  You may install copies of the Materials on an<br>unlimited number of computers provided that you are the only individual using<br>the Materials and only one copy of the Materials is in use at any one time.<br>A separate license is required for each additional use and/or individual user<br>in all other cases, including without limitation, use by persons, computer<br>systems, and other use methods known now and in the future.  If you are an<br>entity, Intel grants you the right to designate one individual within your<br>organization to have the sole right to use the Materials in the manner<br>specified provided above.</p><p>ii.    EVALUATION LICENSE: If you are using the Materials under the control<br>of an evaluation license, you as an individual may use the Materials only for<br>internal evaluation purposes and only for the term of the evaluation, which<br>may be controlled by the license key code for the Materials.<br>NOTWITHSTANDING ANYTHING TO THE CONTRARY ELSEWHERE IN THIS<br>AGREEMENT, YOU MAY NOT DISTRIBUTE ANY PORTION OF THE MATERIALS, AND THE<br>APPLICATION AND/OR PRODUCT DEVELOPED BY YOU MAY ONLY BE USED FOR<br>EVALUATION PURPOSES AND ONLY FOR THE TERM OF THE EVALUATION.  You may<br>install copies of the Materials on a reasonable number of computers to conduct<br>your evaluation provided that you are the only individual using the Materials<br>and only one copy of the Materials is in use at any one time.  A separate<br>license is required for each additional use and/or individual user in all other<br>cases, including without limitation, use by persons, computer systems, and other<br>use methods known now and in the future.  Intel may provide you with a license<br>code key that enables the Materials for an evaluation license.  If you are an<br>entity, Intel grants you the right to designate one individual within your<br>organization to have the sole right to use the Materials in the manner<br>provided above.</p><p>iii.    NONCOMMERCIAL-USE LICENSE:  If you are using the Materials under the<br>control of a noncommercial-use license, if you are an individual, you as an<br>individual may use the Materials only for non-commercial use where you receive<br>no fee, salary or any other form of compensation.  The Materials may not be used<br>for any other purpose, whether “for profit” or “not for profit.”  Any work<br>performed or produced as a result of use of the Materials cannot be performed<br>or produced for the benefit of other parties for a fee, compensation or any<br>other<br>reimbursement or remuneration.  You may install copies of the Materials on an<br>unlimited number of computers provided that you are the only individual using<br>the Materials and only one copy of the Materials is in use at any one time.<br>A separate license is required for each additional use and/or individual user<br>in all other cases, including without limitation, use by persons, computer<br>systems, and other methods of use known now and in the future.  Intel will<br>provide you with a license code key that enables the Materials for a<br>noncommercial-use license.  If you obtained a time-limited noncommercial-use<br>license, the duration (time period) of your license and your ability to use the<br>Materials is limited to the time period of the obtained license, which is<br>controlled by the license key code for the Materials.  If you are an entity,<br>Intel grants you the right to designate one individual within your organization<br>to have the sole right to use the Materials in the manner provided above.</p><p>iv.    SINGLE-USER LICENSE: If you are using the Materials under the control<br>of a single-user license, you as an individual may install and use the Materials<br>on an unlimited number of computers provided that you are the only individual<br>using the Materials and only one copy of the Materials is in use at any one<br>time.  A separate license is required for each additional use and/or individual<br>user in all other cases, including without limitation, use by persons, computer<br>systems, and other methods of use known now and in the future.  Intel will<br>provide you with a license code key that enables the Materials for a single-user<br>license.  If you obtained a time-limited single-user license, the term of your<br>license and your ability to use the Materials is limited to the specified time<br>period, which is controlled by the license key code for the Materials.  If you<br>are an entity, Intel grants you the right to designate one individual within<br>your organization to have the sole right to use the Materials in the manner<br>provided above.</p><p>v.    NODE-LOCKED LICENSE: If you are using the Materials under the control of<br> a node-locked license, you may use the Materials only on a single designated<br>computer by no more than the authorized number of concurrent users.  A separate<br>license is required for each additional concurrent user and use, and/or computer<br>systems in all other cases, including without limitation, use by persons,<br>computer systems, and other methods of use known now and in the future.  Intel<br>will provide you with a license code key that enables the Materials for a Node-<br>Locked license up to the authorized number of concurrent users.  If you obtained<br>a time-limited node-locked license, the term of your license and your ability to<br>use the Materials is limited to the specified time, which is controlled by the<br>license key code for the Materials.</p><p>vi.    FLOATING LICENSE: If you are using the Materials under the control of a<br>floating license, you may (a) install the Materials on an unlimited number of<br>computers that are connected to the designated network and (b) use the Material<br>by no more than the authorized number of concurrent individual users.<br>A separate license is required for each additional concurrent individual user<br>and each additional use by a computer system and/or network on which the<br>Materials are used. You understand that you must obtain a  separate license for<br>every and any use of the Materials under a floating license, regardless of<br>whether such use is, without limitation, by persons, computer systems, and other<br>methods of use known now and in the future.  Intel will provide you with a<br>license code key that enables the Materials for a floating license up to the<br>authorized number of concurrent users.  If you obtained a time-limited Floating<br>license, the duration (time period) of your license and your ability to use the<br>Materials is limited to the time period of the obtained license, which is<br>controlled by the license key code for the Materials.  Intel Library Floating<br>License: If the Materials are the Intel(R) Math Kernel Library or the Intel(R)<br>Integrated Performance Primitives Library or the Intel(R) Threading Building<br>Blocks (either “Intel Library”), then the Intel Library is provided to you as an<br>add-on option to either the Intel(R) C++ Compiler product or the Intel(R)<br>Fortran Compiler product (either, an “Intel Compiler”) for which you have a<br>Floating license, and as such, in addition to the terms and conditions above,<br>the Intel Library may only be used by the authorized concurrent users (as noted<br>above) of that Intel Compiler Floating license.</p><p>D.    DISTRIBUTION:  Distribution of the Redistributables is also subject to<br>the following limitations:  You (i) shall be solely responsible to your<br>customers for any update or support obligation or other liability which may<br>arise from the distribution, (ii) shall not make any statement that your product<br>is “certified”, or that its performance is guaranteed, by Intel, (iii) shall not<br>use Intel’s name or trademarks to market your product without written<br>permission, (iv) shall use a license agreement that prohibits disassembly and<br>reverse engineering of the Redistributables, (v) shall indemnify, hold harmless,<br>and defend Intel and its suppliers from and against any claims or lawsuits,<br>including attorney’s fees, that arise or result from your distribution of<br>any product.</p><p>E.    Intel(R) Integrated Performance Primitives (Intel IPP). The following<br>terms and conditions apply only to the Intel IPP.</p><p>i.    Notwithstanding anything in this Agreement to the contrary, if you<br>implement the Sample Sources in your application or if you use Intel IPP to<br>implement algorithms that are protected by others’ licenses then you may need<br>additional licenses from various entities. Should any such additional licenses<br>be required, you are solely responsible for obtaining any such licenses and<br>agree to obtain any such licenses at your own expense.</p><p>ii.    Notwithstanding anything herein to the contrary, a valid license to<br>Intel IPP is a prerequisite to any license for Sample Source, and possession of<br>Sample Source does not grant any license to Intel IPP (or any portion thereof).<br>To access Sample Source, you must first register your licensed copy of the Intel<br>IPP with Intel.  By downloading, installing or copying any Sample Source file,<br>you agree to be bound by terms of this Agreement.</p><p>F.    SOFTWARE TRANSFER:  Except for Pre-Release Licenses or Evaluation<br>Licenses or Non-Commercial Licenses, as specified above, you may permanently<br>transfer the Materials you received pursuant to a license type listed in<br>Section 3(C) above, and all of your rights under this Agreement, to another<br>party (“Recipient”) solely in conjunction with a change of ownership, merger,<br>acquisition, sale or transfer of all, substantially all or any part of your<br>business or assets or otherwise, either voluntarily, by operation of law of<br>otherwise subject to the following: You must notify Intel of the transfer by<br>sending a letter to Intel (i) identifying the legal entities of Recipient and<br>you, (ii) identifying the Materials (i.e., the specific Intel software products)<br>and the associated serial numbers to be transferred, (iii) certifying that you<br>retain no copies of the Materials, (iv) certifying that the Recipient has agreed<br>in writing to be bound by all of the terms and conditions of this Agreement, (v)<br>certifying that the Recipient has been notified that in order to receive support<br>from Intel for the Materials they must notify Intel in writing of the transfer<br>and provide Intel with the information specified in subsection (ii) above along<br>with the name and email address of the individual assigned to use the Materials,<br>and (vi) providing your email address so that we may confirm receipt of your<br>letter.  Please send such letter to:</p><p>Intel Corporation<br>2111 NE 25th Avenue<br>Hillsboro, OR 97124<br>Attn: DPD Contracts Management, JF1-15</p><ol><li><p>COPYRIGHT: Title to the Materials, modifications thereto provided by<br>Intel and all copies thereof remain with Intel or its suppliers.  The Materials<br>are protected by intellectual property rights, including without limitation,<br>United States copyright laws and international treaty provisions.  You will not<br>remove any copyright or other proprietary notice from the Materials.  You agree<br>to prevent any unauthorized copying of the Materials.  Except as expressly<br>provided herein, no license or right is granted to you directly or by<br>implication, inducement, estoppel or otherwise; specifically Intel does not<br>grant any express or implied right to you under Intel patents, copyrights,<br>trademarks, or trade secrets.</p></li><li><p>NO WARRANTY, NO SUPPORT AND LIMITED REPLACEMENT:  THE MATERIALS AND<br>INFORMATION ARE PROVIDED “AS IS” WITH NO WARRANTIES, EXPRESS OR IMPLIED. INTEL<br>SPECIFICALLY DISCLAIMS ANY AND ALL WARRANTIES, INCLUDING WITHOUT LIMITATION,<br>ANY IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE,<br>NON-INFRINGEMENT OF INTELLECTUAL PROPERTY RIGHTS, OR ANY WARRANTY OTHERWISE<br>ARISING OUT OF ANY PROPOSAL, SPECIFICATION, OR SAMPLE.  If the media on which<br>the Materials are furnished are found to be defective in material or workmanship<br>under normal use for a period of ninety (90) days from the date of receipt,<br>Intel’s entire liability and your exclusive remedy shall be the replacement of<br>the media.  This offer is void if the media defect results from accident, abuse,<br>or misapplication.</p></li></ol><p>Intel may make changes to the Materials, or to items referenced therein, at any<br>time without notice, but is not obligated to support, update or provide training<br>for the Materials. Intel may in its sole discretion offer such support, update<br>or training services under separate terms at Intel’s then-current rates. You may<br>request additional information on Intel’s service offerings from an Intel sales<br>representative.</p><ol><li><p>LIMITATION OF LIABILITY:  NEITHER INTEL NOR ITS SUPPLIERS SHALL BE<br>LIABLE FOR ANY DAMAGES WHATSOEVER (INCLUDING, WITHOUT LIMITATION, DAMAGES FOR<br>LOSS OF BUSINESS PROFITS, BUSINESS INTERRUPTION, LOSS OF BUSINESS INFORMATION,<br>OR OTHER LOSS) ARISING OUT OF THE USE OF OR INABILITY TO USE THE SOFTWARE, EVEN<br>IF INTEL HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.  BECAUSE SOME<br>JURISDICTIONS PROHIBIT THE EXCLUSION OR LIMITATION OF LIABILITY FOR<br>CONSEQUENTIAL OR INCIDENTAL DAMAGES, THE ABOVE LIMITATION MAY NOT APPLY TO<br>YOU.</p></li><li><p>UNAUTHORIZED USE:  THE MATERIALS ARE NOT DESIGNED, INTENDED, OR<br>AUTHORIZED FOR USE IN ANY TYPE OF SYSTEM OR APPLICATION IN WHICH THE FAILURE OF<br>THE MATERIALS COULD CREATE A SITUATION WHERE PERSONAL INJURY OR DEATH MAY OCCUR<br>(e.g.,  MEDICAL SYSTEMS, LIFE SUSTAINING OR LIFE SAVING SYSTEMS).  Should you<br>use the Materials for any such unintended or unauthorized use, you hereby<br>indemnify, defend, and hold Intel and its officers, subsidiaries and affiliates<br>harmless against all claims, costs, damages, and expenses, and reasonable<br>attorney fees arising out of, directly or indirectly, such use and any claim of<br>product liability, personal injury or death associated with such unintended or<br>unauthorized use, even if such claim alleges that Intel was negligent regarding<br>the design or manufacture of the Materials.</p></li><li><p>USER SUBMISSIONS:  This Agreement does not obligate you to provide Intel<br>with materials, information, comments, suggestions or other communication<br>regarding the Materials.  However, you agree that any material, information,<br>comments, suggestions or other communication you transmit or post to an Intel<br>website (including but not limited to, submissions to the Intel Premier Support<br>and/or other customer support websites or online portals) or provide to Intel<br>under this Agreement related to the features, functions, performance or use<br>of the Materials are deemed non-confidential and non-proprietary<br>(“Communications”).  Intel will have no obligations with respect to the<br>Communications.  You hereby grant to Intel a non-exclusive, perpetual,<br>irrevocable, royalty-free, copyright license to copy, modify, create derivative<br>works, publicly display, disclose, distribute, license and sublicense through<br>multiple tiers of distribution and licensees, incorporate and otherwise use the<br>Communications and all data, images, sounds, text, and other things embodied<br>therein, including derivative works thereto, for any and all commercial or<br>non-commercial purposes. You are prohibited from posting or transmitting to or<br>from an Intel website or provide to Intel any unlawful, threatening, libelous,<br>defamatory, obscene, pornographic, or other material that would violate any law.<br>If you wish to provide Intel with information that you intend to be treated as<br>confidential information, Intel requires that such confidential information be<br>provided pursuant to a non-disclosure agreement (“NDA”), so please contact your<br>Intel representative to ensure the proper NDA is in place.</p></li></ol><p>Nothing in this Agreement will be construed as preventing Intel from reviewing<br>your Communications and errors or defects in Intel products discovered while<br>reviewing your Communications. Furthermore, nothing in this Agreement will be<br>construed as preventing Intel from implementing independently-developed<br>enhancements to Intel’s own error diagnosis methodology to detect errors or<br>defects in Intel products discovered while reviewing your Communications or to<br>implement bug fixes or enhancements in Intel products. The foregoing may include<br>the right to include your Communications in regression test suites. </p><ol><li><p>CONSENT.  You agree that Intel, its subsidiaries or suppliers may<br>collect and use technical and related information, including but not limited to<br>technical information about your computer, system and application software, and<br>peripherals, that is gathered periodically to facilitate the provision of<br>software updates, product support and other services to you (if any) related to<br>the Materials, and to verify compliance with the terms of this Agreement.  Intel<br>may use this information, as long as it is in a form that does not personally<br>identify you, to improve our products or to develop and provide services or<br>technologies to you.</p></li><li><p>TERMINATION OF THIS LICENSE: This Agreement becomes effective on the<br>date you accept this Agreement and will continue until terminated as provided<br>for in this Agreement.  If you are using the Materials under the control of a<br>time-limited license, for example an Evaluation License, this Agreement<br>terminates without notice on the last day of the time period, which is specified<br>in the Materials, and/or controlled by the license key code for the Materials.<br>Intel may terminate this license immediately if you are in breach of any of its<br>terms and conditions and such breach is not cured within thirty (30) days of<br>written notice from Intel.  Upon termination, you will immediately return to<br>Intel or destroy the Materials and all copies thereof.  In the event of<br>termination of this Agreement, the license grant to any Redistributables<br>distributed by you in accordance with the terms and conditions of this<br>Agreement, prior to the effective date of such termination, shall survive any<br>such termination of this Agreement</p></li><li><p>U.S. GOVERNMENT RESTRICTED RIGHTS: The technical data and computer<br>software covered by this license is a “Commercial Item,” as such term is defined<br>by the FAR 2.101 (48 C.F.R. 2.101) and is “commercial computer software” and<br>“commercial computer software documentation” as specified under FAR 12.212<br>(48 C.F.R. 12.212) or DFARS 227.7202 (48 C.F.R. 227.7202), as applicable. This<br>commercial computer software and related documentation is provided to end users<br>for use by and on behalf of the U.S. Government, with only those rights as are<br>granted to all other end users pursuant to the terms and conditions herein. Use<br>for or on behalf of the U.S. Government is permitted only if the party acquiring<br>or using this software is properly authorized by an appropriate U.S. Government<br>official. This use by or for the U.S. Government clause is in lieu of, and<br>supersedes, any other FAR, DFARS, or other provision that addresses Government<br>rights in the computer software or documentation covered by this license.  All<br>copyright licenses granted to the U.S. Government are coextensive with the<br>technical data and computer software licenses granted herein. The U.S.<br>Government shall only have the right to reproduce, distribute, perform, display,<br>and prepare derivative works as needed to implement those rights.</p></li><li><p>GENERAL PROVISIONS</p></li></ol><p>A.    ENTIRE AGREEMENT: This Agreement is intended to be the entire agreement<br>between you and Intel with respect to matters contained herein, and supersedes<br>all prior or contemporaneous agreements and negotiations with respect to those<br>matters.  No waiver of any breach or default shall constitute a waiver of any<br>subsequent breach or default.  If any provision of this Agreement is determined<br>by a court to be unenforceable, you and Intel will deem the provision to be<br>modified to the extent necessary to allow it to be enforced to the extent<br>permitted by law, or if it cannot be modified, the provision will be severed and<br>deleted from this Agreement, and the remainder of the Agreement will continue in<br>effect.  Any change, modification or waiver to this Agreement must be in writing<br>and signed by an authorized representative of you and an officer (or delegate)<br>of Intel, and must specifically identify this Agreement by its title (e.g.,<br>“End User License Agreement for the Intel(R) Software Development Products”) and<br>version, i.e., May 2012).</p><p>B.    APPLICABLE LAWS: Any claim arising under or relating to this Agreement<br>shall be governed by the internal substantive laws of the State of Delaware,<br>without regard to principles of conflict of laws.  You agree that the terms of<br>the United Nations Convention on Contracts for the Sale of Goods do not apply<br>to this Agreement. You agree that your distribution and export/re-export of the<br>Software and permitted modifications shall be in compliance with the laws,<br>regulations, orders or other restrictions of applicable export laws.</p><ol><li>THIRD PARTY PROGRAMS.  The Materials may include third party programs<br>or materials that are governed by the third party’s license terms, including<br>without limitation, open source software.  The license terms associated with<br>such third party programs or materials govern your use of same, and Intel is<br>not liable for such third party programs or materials.</li></ol><ul><li>Other names and brands may be claimed as the property of others</li></ul><p>-——————————————————————————-<br>Do you agree to be bound by the terms and conditions of this license agreement?<br>Type “accept” to continue or “decline” to back to the previous menu:  <font color="red"><strong>accept</strong></font> </p><h2 id="选择激活方式，选择4使用激活文件"><a href="#选择激活方式，选择4使用激活文件" class="headerlink" title="选择激活方式，选择4使用激活文件"></a>选择激活方式，选择4使用激活文件</h2><p>Step no: 3 of 7 | Activation<br>-——————————————————————————-<br>If you have purchased this product and have the serial number and a connection<br>to the internet you can choose to activate the product at this time. Activation<br>is a secure and anonymous one-time process that verifies your software licensing<br>rights to use the product. Alternatively, you can choose to evaluate the<br>product or defer activation by choosing the evaluate option. Evaluation software<br>will time out in about one month. Also you can use license file, license<br>manager, or remote activation if the system you are installing on does not<br>have internet access activation options.<br>-——————————————————————————-</p><ol><li>Use existing license [default]</li><li>I want to activate my product using a serial number</li><li>I want to evaluate my product or activate later </li><li>I want to activate either remotely, or by using a license file, or by using a<br>license manager</li></ol><p>h. Help<br>b. Back to the previous menu<br>q. Quit<br>-——————————————————————————-<br>Please type a selection or press “Enter” to accept default choice [1]: <font color="red">4</font> </p><h2 id="指定license文件"><a href="#指定license文件" class="headerlink" title="指定license文件"></a>指定license文件</h2><p>Step no: 3 of 7 | Activation &gt; Advanced activation<br>-——————————————————————————-<br>You can use license file, license manager, or the system you are installing on<br>does not have internet access activation options.<br>-——————————————————————————-</p><ol><li>Use a different computer with internet access [default]</li><li>Use a license file</li><li>Use a license server</li></ol><p>h. Help<br>b. Back to the previous menu<br>q. Quit<br>-——————————————————————————-<br>Please type a selection or press “Enter” to accept default choice [1]:  <font color="red"><strong>2</strong></font><br>Note: Press “Enter” key to back to the previous menu.<br>Please type the full path to your license file(s):<font color="red"><strong>/root/intel_eval.lic</strong></font><br>-——————————————————————————-<br>Activation completed successfully.<br>-——————————————————————————-<br>Press “Enter” key to continue:  <font color="red"><strong>回车</strong></font></p><h2 id="是否加入改进，2为不加入"><a href="#是否加入改进，2为不加入" class="headerlink" title="是否加入改进，2为不加入"></a>是否加入改进，2为不加入</h2><p>Step no: 4 of 7 | Intel(R) Software Improvement Program<br>-——————————————————————————-<br>Help improve your experience with Intel(R) software</p><p>Participate in the design of future Intel software. Select ‘Yes’ to give us<br>permission to learn about how you use your Intel software and we will do the<br>rest.</p><pre><code>- No Personal contact information is collected- There are no surveys or additional follow-up emails by opting in- You can stop participating at any timeLearn more about Intel(R) Software Improvement Programhttp://software.intel.com/en-us/articles/software-improvement-program</code></pre><p>With your permission, Intel may automatically receive anonymous information<br>about how you use your current and future Intel software.<br>-——————————————————————————-</p><ol><li>Yes, I am willing to participate and improve Intel software. (Recommended)</li><li>No, I don’t want to participate in the Intel(R) Software Improvement Program<br>at this time.</li></ol><p>b. Back to the previous menu<br>q. Quit<br>-——————————————————————————-<br>Please type a selection: <font color="red">2</font></p><h2 id="最后一次确认安装路径，可修改"><a href="#最后一次确认安装路径，可修改" class="headerlink" title="最后一次确认安装路径，可修改"></a>最后一次确认安装路径，可修改</h2><p>Step no: 5 of 7 | Options<br>-——————————————————————————-<br>You are now ready to begin installation. You can use all default installation<br>settings by simply choosing the “Start installation Now” option or you can<br>customize these settings by selecting any of the change options given below<br>first. You can view a summary of the settings by selecting<br>“Show pre-install summary”.<br>-——————————————————————————-</p><ol><li><p>Start installation Now</p></li><li><p>Change install directory      [ /opt/intel ]</p></li><li>Change components to install  [ Custom ]</li><li>Change advanced options</li><li>Show pre-install summary</li></ol><p>h. Help<br>b. Back to the previous menu<br>q. Quit<br>-——————————————————————————-<br>Please type a selection or press “Enter” to accept default choice [1]: <font color="red">回车</font></p><h2 id="检测安装环境，跳过即可"><a href="#检测安装环境，跳过即可" class="headerlink" title="检测安装环境，跳过即可"></a>检测安装环境，跳过即可</h2><p>Step no: 5 of 7 | Options &gt; Missing Optional Pre-requisite(s)<br>-——————————————————————————-<br>There are one or more optional unresolved issues. It is highly recommended to<br>resolve them all before you continue the installation. You can fix them without<br>exiting from the installation and re-check. Or you can quit from the<br>installation, fix them and run the installation again.<br>-——————————————————————————-<br>Missing optional pre-requisites<br>– Intel(R) Composer XE 2013 Update 2 for Linux<em>: No compatible Java</em> Runtime<br>Environment (JRE) found<br>-——————————————————————————-</p><ol><li>Skip missing optional pre-requisites [default]</li><li>Show the detailed info about issue(s)</li><li>Re-check the pre-requisites</li></ol><p>h. Help<br>b. Back to the previous menu<br>q. Quit<br>-——————————————————————————-<br>Please type a selection or press “Enter” to accept default choice [1]: <font color="red">回车</font></p><h2 id="开始安装-1"><a href="#开始安装-1" class="headerlink" title="开始安装"></a>开始安装</h2><p>Step no: 6 of 7 | Installation<br>-——————————————————————————-<br>Each component will be installed individually. If you cancel the installation,<br>components that have been completely installed will remain on your system. This<br>installation may take several minutes, depending on your system and the options<br>you selected.<br>-——————————————————————————-<br>Installing Intel Debugger 13.0 on Intel(R) 64 component… done<br>-——————————————————————————-<br>Finalizing installation… done<br>-——————————————————————————-</p><h2 id="安装完成"><a href="#安装完成" class="headerlink" title="安装完成"></a>安装完成</h2><p>Step no: 7 of 7 | Complete<br>-——————————————————————————-<br>Thank you for installing and using the<br>Intel(R) Parallel Studio XE 2013 Update 2 for Linux*</p><p>Reminder: Intel(R) VTune(TM) Amplifier XE users must be members of the “vtune”<br>permissions group in order to use Event-based Sampling.</p><p>To register your product purchase, visit<br><a href="https://registrationcenter.intel.com/RegCenter/registerexpress.aspx?media=5G9" target="_blank" rel="external">https://registrationcenter.intel.com/RegCenter/registerexpress.aspx?media=5G9</a></p><p>To get started using Intel(R) VTune(TM) Amplifier XE 2013 Update 4:</p><pre><code>- To set your environment variables: source</code></pre><p>/opt/intel/vtune_amplifier_xe_2013/amplxe-vars.sh</p><pre><code>- To start the graphical user interface: amplxe-gui- To use the command-line interface: amplxe-cl- For more getting started resources: /opt/intel/vtune_amplifier_xe_2013/  documentation/en/welcomepage/get_started.html.</code></pre><p>To get started using Intel(R) Inspector XE 2013 Update 4:</p><pre><code>- To set your environment variables: source</code></pre><p>/opt/intel/inspector_xe_2013/inspxe-vars.sh</p><pre><code>- To start the graphical user interface: inspxe-gui- To use the command-line interface: inspxe-cl- For more getting started resources: /opt/intel/inspector_xe_2013/  documentation/en/welcomepage/get_started.html.</code></pre><p>To get started using Intel(R) Advisor XE 2013 Update 2:</p><pre><code>- To set your environment variables: source</code></pre><p>/opt/intel/advisor_xe_2013/advixe-vars.sh</p><pre><code>- To start the graphical user interface: advixe-gui- To use the command-line interface: advixe-cl- For more getting started resources: /opt/intel/advisor_xe_2013/  documentation/en/welcomepage/get_started.html.</code></pre><p>To get started using Intel(R) Composer XE 2013 Update 2 for Linux*:</p><pre><code>- Set the environment variables for a terminal window using one of the  following (replace &quot;intel64&quot; with &quot;ia32&quot; if you are using a 32-bit  platform).  For csh/tcsh:       $ source /opt/intel/bin/compilervars.csh intel64  For bash:       $ source /opt/intel/bin/compilervars.sh intel64  To invoke the installed compilers:       For C++: icpc       For C: icc       For Fortran: ifort  To get help, append the -help option or precede with the man command.- For more getting started resources:       /opt/intel/composer_xe_2013/Documentation/en_US/get_started_lc.htm.       /opt/intel/composer_xe_2013/Documentation/en_US/get_started_lf.htm.</code></pre><p>To view movies and additional training, visit<br><a href="http://www.intel.com/software/products" target="_blank" rel="external">http://www.intel.com/software/products</a>.</p><p>-——————————————————————————-<br>q. Quit [default]<br>-——————————————————————————-<br>Please type a selection or press “Enter” to accept default choice [q]: <font color="red">回车</font></p><h2 id="设置环境变量"><a href="#设置环境变量" class="headerlink" title="设置环境变量"></a>设置环境变量</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@vm00 parallel_studio_xe_2013_update2_intel64]# source /opt/intel/bin/compilervars.sh intel64</div><div class="line">将此行内容加入到/etc/profile中，否则重启后失效</div></pre></td></tr></table></figure><h2 id="验证安装的正确性"><a href="#验证安装的正确性" class="headerlink" title="验证安装的正确性"></a>验证安装的正确性</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@vm00 parallel_studio_xe_2013_update2_intel64]# icc -v</div><div class="line">icc version 13.1.0 (gcc version 4.4.7 compatibility)</div></pre></td></tr></table></figure><p>参考链接：<a href="http://www.cnblogs.com/iDove/p/4103231.html" target="_blank" rel="external">http://www.cnblogs.com/iDove/p/4103231.html</a></p>]]></content>
      
      
      <categories>
          
          <category> HPC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Intel </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Centos7下Rsync服务器搭建配置</title>
      <link href="/arlo/98679d8a/"/>
      <url>/arlo/98679d8a/</url>
      
        <content type="html"><![CDATA[<p>之前写了个<a href="http://islocal.cc/2017/06/16/windows-下使用expdp自动备份多用户oracle脚本">Windows下oracle多用户自动备份的脚本</a>，这个备份完数据还是存在服务器本地的，如果系统宕机的话，数据还是没有了，这样的备份是没有意义滴；所以我们需要把数据转移到其他的存储上，常用的方式是使用Rsync工具来保持同步数据，接下来我们搭建一个简单的Rsync服务器。<br><a id="more"></a></p><h1 id="安装部署rsync服务器"><a href="#安装部署rsync服务器" class="headerlink" title="安装部署rsync服务器"></a>安装部署rsync服务器</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@sftp_server ~]# yum -y install rsync</div><div class="line">[root@sftp_server ~]# mkdir -p /etc/rsyncd/</div><div class="line">[root@sftp_server ~]# touch /etc/rsyncd/rsyncd.conf</div><div class="line">[root@sftp_server ~]# ln -s /etc/rsyncd/rsyncd.conf /etc/rsyncd.conf</div></pre></td></tr></table></figure><h1 id="配置rsync服务器"><a href="#配置rsync服务器" class="headerlink" title="配置rsync服务器"></a>配置rsync服务器</h1><h2 id="主配置文件-etc-rsyncd-conf"><a href="#主配置文件-etc-rsyncd-conf" class="headerlink" title="主配置文件/etc/rsyncd.conf"></a>主配置文件/etc/rsyncd.conf</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">[root@sftp_server ~]# cat /etc/rsyncd.conf </div><div class="line">uid = root                         </div><div class="line">gid = root                                  </div><div class="line">use chroot = yes                             </div><div class="line">hosts allow=192.168.10.33/24</div><div class="line">hosts deny=*</div><div class="line">max connections=5</div><div class="line">pid file = /var/run/rsyncd.pid </div><div class="line">secrets file = /etc/rsyncd/rsyncd.secrets </div><div class="line">motd file = /etc/rsyncd/rsyncd.motd  </div><div class="line">log file = /var/log/rsync.log</div><div class="line">transfer logging = yes  </div><div class="line">log format = %t %a %m %f %b</div><div class="line">syslog facility = local3</div><div class="line">timeout = 300</div><div class="line"></div><div class="line"></div><div class="line">[db_backup]                               </div><div class="line">path = /data/backup/                       </div><div class="line">list=yes                                   </div><div class="line">read only = no    </div><div class="line">ignore errors                              </div><div class="line">auth users = rdatabase                          </div><div class="line">comment = Oracle Database Backup</div></pre></td></tr></table></figure><h2 id="密码验证文件-etc-rsyncd-rsyncd-secrets"><a href="#密码验证文件-etc-rsyncd-rsyncd-secrets" class="headerlink" title="密码验证文件/etc/rsyncd/rsyncd.secrets"></a>密码验证文件/etc/rsyncd/rsyncd.secrets</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@sftp_server ~]# cat /etc/rsyncd/rsyncd.secrets </div><div class="line">rdatabase:sss</div><div class="line">[root@sftp_server ~]# chown root.root /etc/rsyncd/rsyncd.secrets</div><div class="line">[root@sftp_server ~]# chmod 600 /etc/rsyncd/rsyncd.secrets</div></pre></td></tr></table></figure><h2 id="欢迎提示信息文件-etc-rsyncd-rsyncd-motd"><a href="#欢迎提示信息文件-etc-rsyncd-rsyncd-motd" class="headerlink" title="欢迎提示信息文件/etc/rsyncd/rsyncd.motd"></a>欢迎提示信息文件/etc/rsyncd/rsyncd.motd</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@sftp_server ~]# cat /etc/rsyncd/rsyncd.motd</div><div class="line">+++++++++++++++++++++++++++</div><div class="line">+ Oracle Database Backup! +</div><div class="line">+++++++++++++++++++++++++++</div></pre></td></tr></table></figure><h2 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@sftp_server ~]# systemctl start rsyncd.service</div><div class="line">[root@sftp_server ~]# systemctl enable rsyncd.service</div></pre></td></tr></table></figure><h2 id="防火墙配置"><a href="#防火墙配置" class="headerlink" title="防火墙配置"></a>防火墙配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">firewall-cmd --zone=public --add-port=873/tcp --permanent</div><div class="line">firewall-cmd --zone=public --add-service=rsyncd --permanent</div><div class="line">firewall-cmd --reload</div></pre></td></tr></table></figure><h1 id="客户端配置"><a href="#客户端配置" class="headerlink" title="客户端配置"></a>客户端配置</h1><p>有几个细节地方需要主机</p><ol><li>rsync命令执行的时候，前边的是src(源)，后边的是dest(目标)</li><li>路径后有/只会同步目录下的内容，路径后没有/，会把当前目录（路径的最后一层）同步过去 </li></ol><h2 id="linux客户端配置"><a href="#linux客户端配置" class="headerlink" title="linux客户端配置"></a>linux客户端配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># yum install -y rsync</div><div class="line">[airmodel@silu ~]$ rsync -avzP /tmp/data/ rdatabase@192.168.6.23::db_backup  #把本机/tmp/data/目录下的内容同步到rsync服务器db_backup模块配置的目录中去，如果要将rsync服务器上内容同步至本机，路径位置换一下即可</div></pre></td></tr></table></figure><h2 id="windows-客户端配置"><a href="#windows-客户端配置" class="headerlink" title="windows 客户端配置"></a>windows 客户端配置</h2><ol><li>下载free版本的cwrsync软件 <a href="https://itefix.net/cwrsync" target="_blank" rel="external">https://itefix.net/cwrsync</a> </li><li>在c盘根目录新建一个密码文件password.rsync，内容为sss（这里写的密码和rsync服务器上的要对应，只写密码，不需要用户名）</li><li>cwrsync不识别Windows路径，C盘需要写为/cygdrive/c，E盘需要写为/cygdrive/e</li><li>新建一个计划任务，实现自动化备份，操作可以参考以下示例<br>以下实例内容为：将本地E:\database_backup\目录下的内容同步至rsync服务的db_backup模块中定义的路径中去，密码文件为C:\password.rsync </li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">C:\cwRsync_5.5.0_x86_Free\bin\rsync.exe -azvP --password-file=/cygdrive/c/password.rsync /cygdrive/e/database_backup/ rdatabase@192.168.6.23::db_backup</div></pre></td></tr></table></figure><h1 id="更优方式"><a href="#更优方式" class="headerlink" title="更优方式"></a>更优方式</h1><p>linux下可以部署inotify+rsync，实现实时同步数据</p><hr>]]></content>
      
      
      <categories>
          
          <category> 常识 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rsync </tag>
            
            <tag> 同步 </tag>
            
            <tag> 备份 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Aansible palybook 创建lvm并自动挂载</title>
      <link href="/arlo/1e1aab57/"/>
      <url>/arlo/1e1aab57/</url>
      
        <content type="html"><![CDATA[<p>由于工作中经常会遇到添加磁盘，分区，挂载这种操作，使用ansible后再也不用一台台的搞了；主要使用到lvg，lvol，filesystem，mount模块；<br><a id="more"></a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">- hosts: test</div><div class="line">  vars:</div><div class="line">    vg_name: &quot;vgtest&quot;</div><div class="line">    lv_name: &quot;lvtest&quot;</div><div class="line">    pvs_name: &quot;/dev/sdb&quot;</div><div class="line">    dir_path: &quot;/data&quot;</div><div class="line">  tasks:</div><div class="line">    - name: 创建一个vg</div><div class="line">      lvg: </div><div class="line">        vg: &quot;&#123;&#123;vg_name&#125;&#125;&quot; </div><div class="line">        pvs: &quot;&#123;&#123;pvs_name&#125;&#125;&quot;</div><div class="line">        pesize: 4</div><div class="line">    - name: 创建一个lv </div><div class="line">      lvol:</div><div class="line">        vg: &quot;&#123;&#123;vg_name&#125;&#125;&quot;</div><div class="line">        lv: &quot;&#123;&#123;lv_name&#125;&#125;&quot;</div><div class="line">        size: 100%PVS</div><div class="line">    - name: 格式化lv</div><div class="line">      filesystem: </div><div class="line">        fstype: ext4 </div><div class="line">        dev: &quot;/dev/&#123;&#123;vg_name&#125;&#125;/&#123;&#123;lv_name&#125;&#125;&quot;</div><div class="line">    - name: 获取UUID</div><div class="line">      shell: blkid /dev/&quot;&#123;&#123;vg_name&#125;&#125;&quot;/&quot;&#123;&#123;lv_name&#125;&#125;&quot; |awk &apos;&#123;print $2&#125;&apos;</div><div class="line">      register: result</div><div class="line">      ignore_errors: True</div><div class="line">    - name: 创建挂载目录 </div><div class="line">      file: </div><div class="line">        path: &quot;&#123;&#123;dir_path&#125;&#125;&quot;</div><div class="line">        state: directory</div><div class="line">        mode: 0755</div><div class="line">    - name: 使用UUID挂载lvm分区 </div><div class="line">      mount: </div><div class="line">         path: /data</div><div class="line">         src:  &quot;&#123;&#123;result.stdout&#125;&#125;&quot;</div><div class="line">         fstype: ext4</div><div class="line">         state: mounted</div></pre></td></tr></table></figure></p><p>由于我一直习惯使用UUID挂载分区（UUID是每个分区的唯一标识），所以我加了一步获取UUID的操作，这步也可以略去，挂载的时候使用分区名称进行挂载；还有一点就是使用lvm分区的时候，将整个磁盘做成pv是不需要进行分区操作的，这点比较方便；如果要做分区操作的话，可以使用以下playbook：<br><figure class="highlight plain"><figcaption><span>hosts: test</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">vars:</div><div class="line">  dev_name1: &quot;/dev/sdb&quot;</div><div class="line">  dev_name2: &quot;/dev/sdb1&quot;</div><div class="line">tasks:</div><div class="line">  - name: Disk Partition    </div><div class="line">    shell : fdisk &quot;&#123;&#123;dev_name1&#125;&#125;&quot; &lt; /tmp/fdisk_temp.conf  </div><div class="line">  - name: Disk Mkfs ext4    </div><div class="line">    filesystem: </div><div class="line">      fstype: ext4 </div><div class="line">      dev: &quot;&#123;&#123;dev_name2&#125;&#125;&quot;</div><div class="line">  - name: Disk Mount    </div><div class="line">    shell: blkid /dev/sdb1 |awk &apos;&#123;print $2&#125;&apos;| sed -n &apos;s/$/     \/data     ext4     defaults     0 0/p&apos; &gt;&gt; /etc/fstab &amp;&amp; mount -a</div></pre></td></tr></table></figure></p><p>受控机/tmp/fdisk_temp.conf内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">n</div><div class="line">p</div><div class="line">1</div><div class="line">1</div><div class="line"></div><div class="line">w</div><div class="line">q</div></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> 自动化运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 运维 </tag>
            
            <tag> 自动化 </tag>
            
            <tag> Ansible </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Ansible Playbook入门篇</title>
      <link href="/arlo/45b10f7e/"/>
      <url>/arlo/45b10f7e/</url>
      
        <content type="html"><![CDATA[<p>playbook 是由一组ansible调用module命令的集合，使用yaml语言编写，执行顺序自上而下；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">命令格式：ansible-playbook test.yml</div></pre></td></tr></table></figure></p><a id="more"></a><h1 id="Playbook-组成"><a href="#Playbook-组成" class="headerlink" title="Playbook 组成"></a>Playbook 组成</h1><p><strong>Target section: 定义将要执行playbook的远程主机组</strong>  </p><ul><li>name：执行过程中会打印出来变量的值</li><li>hosts：定义远程的主机组</li><li>user：执行该任务组的用户</li><li>remote_user: 与user一样，任选其一</li><li>sudo：如果设置为yes，执行该任务组的用户在执行任务的时候获取root权限</li><li>sudo_user：如果sudo设置为yes，user设置为user1，sudo_user设置为user2，那么user1会获取user2权限</li><li>connection：通过什么方式连接到远程主机，默认是ssh</li><li>gather_facts：除非明确定义不需要在远程主机上执行setup模块，否则会默认自动执行；不需要执行setup模块，需False该选项。  </li></ul><p><strong>Variable section：定义playbook运行时需要使用的变量</strong>  </p><ul><li>vars：格式为“变量名称:变量值”</li><li>vars_files：将变量名称和变量值定义在一个文件中，调用该文件，文件格式为每行一个“变量名称:变量值”</li><li>vars_prompt：定义一个变量，通过交互方式让用户输入变量值  </li></ul><p><strong>Task section：定义将要在远程主机上执行的任务列表</strong>  </p><ul><li>tasks： #三种写法如下  </li></ul><ol><li>调用模块<br>name: 定义名称<br>action：模块名称 模块参数调用</li><li>直接使用模块<br>name: 定义名称<br>模块名称：调用方法</li><li>模块使用<br>name：定义名称<br>模块名称：<br>模块参数调用  </li></ol><p><strong>Handler section：定义task执行完成以后需要调用的任务</strong><br>满足一下两点才能达到触发的效果，否则会不生效。</p><ol><li>必须在tasks中使用notify调用</li><li>在notify中定义内容一定要和tasks中定义的 - name 内容一样  </li></ol><h1 id="新建用户的示例"><a href="#新建用户的示例" class="headerlink" title="新建用户的示例"></a>新建用户的示例</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# cat test.yaml </div><div class="line">- name: &quot;新建用户&quot;</div><div class="line">  hosts: test</div><div class="line">  user: root</div><div class="line">  vars:</div><div class="line">    user: &quot;user3&quot;</div><div class="line">    password: &quot;$1$01a9gEpb$nlv.OmSa1c4jDaGgeoDKi0&quot;   #加密后的密码，可以参考上篇文章中user模块使用</div><div class="line">    uid: &quot;700&quot;</div><div class="line">  tasks:</div><div class="line">    - name: &quot;新建用户&quot;</div><div class="line">      user: name=&quot;&#123;&#123;user&#125;&#125;&quot; password=&quot;&#123;&#123;password&#125;&#125;&quot; uid=&quot;&#123;&#123;uid&#125;&#125;&quot;</div><div class="line">#      user: name=&quot;&#123;&#123;user&#125;&#125;&quot; state=absent remove=yes    #删除用户的话就使用这行</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible-playbook test.yaml</div></pre></td></tr></table></figure><p><img src="/images/2017/0622/00.png" alt="playbook"></p><h1 id="修改selinux，安装epel扩展包"><a href="#修改selinux，安装epel扩展包" class="headerlink" title="修改selinux，安装epel扩展包"></a>修改selinux，安装epel扩展包</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# cat test2.yml</div><div class="line">- hosts: test</div><div class="line">  vars:</div><div class="line">    packages: &quot;epel-release&quot;</div><div class="line">  tasks:</div><div class="line">    - name: &quot;永久关闭selinux&quot;</div><div class="line">      command: sed -i s/SELINUX=enforcing/SELINUX=disabled/g /etc/selinux/config</div><div class="line">    - name: &quot;安装epel扩展包&quot;</div><div class="line">      yum: name=&#123;&#123;packages&#125;&#125; state=present</div><div class="line">      notify:</div><div class="line">      - reboot system</div><div class="line">  handlers:</div><div class="line">    - name: reboot system</div><div class="line">      command: reboot</div></pre></td></tr></table></figure><p>参考链接：<a href="http://breezey.blog.51cto.com/2400275/1757624" target="_blank" rel="external">http://breezey.blog.51cto.com/2400275/1757624</a></p>]]></content>
      
      
      <categories>
          
          <category> 自动化运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 运维 </tag>
            
            <tag> 自动化 </tag>
            
            <tag> Ansible </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Ansible 模块篇</title>
      <link href="/arlo/7a718f23/"/>
      <url>/arlo/7a718f23/</url>
      
        <content type="html"><![CDATA[<p>Ansible 之所以能自动化完成这么多操作，都是依赖于丰富的模块；类似Jenkins软件的强大的插件支持</p><p>查看模块<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible-doc -l</div></pre></td></tr></table></figure></p><p>查看模块参数用法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible-doc -s module</div><div class="line">[root@vm00 ~]# ansible-doc help module</div></pre></td></tr></table></figure></p><p>ansible 命令格式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible 主机或组-m 模块名-a &apos;模块参数&apos;</div></pre></td></tr></table></figure></p><a id="more"></a><h1 id="command-模块"><a href="#command-模块" class="headerlink" title="command 模块"></a>command 模块</h1><p><strong>默认缺省模块</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible all -m command -a &quot;/bin/echo &apos;hello,sir.&apos;&quot;</div><div class="line">[root@vm00 ~]# ansible all -a &apos;chdir=/usr/local/src/ tar -cvzf test.tgz file&apos;</div></pre></td></tr></table></figure></p><h1 id="shell-模块"><a href="#shell-模块" class="headerlink" title="shell 模块"></a>shell 模块</h1><p>和command一样；支持管道<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible test -m shell -a &apos;ps -ef |grep java&apos;</div></pre></td></tr></table></figure></p><h1 id="raw-模块"><a href="#raw-模块" class="headerlink" title="raw 模块"></a>raw 模块</h1><p>和command一样；支持管道</p><h1 id="ping-模块"><a href="#ping-模块" class="headerlink" title="ping 模块"></a>ping 模块</h1><p>测试主机连通性，没有参数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible all -m ping</div></pre></td></tr></table></figure></p><h1 id="setup-模块"><a href="#setup-模块" class="headerlink" title="setup 模块"></a>setup 模块</h1><p>查看主机参数配置<br>filter 过滤参数，相当于grep功能<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible vm02 -m setup</div></pre></td></tr></table></figure></p><p>将所有主机的信息输入到/tmp/facts目录下，每台主机的信息输入到主机名文件中（/etc/ansible/hosts里的主机名）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible all -m setup --tree /tmp/facts</div></pre></td></tr></table></figure></p><p>获取主机ip地址<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible vm02 -m setup -a &apos;filter=ansible_default_ipv4&apos;</div></pre></td></tr></table></figure></p><p>获取主机内存使用情况<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible vm02 -m setup -a &apos;filter=ansible_memory_mb&apos;</div></pre></td></tr></table></figure></p><p>获取主机名<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible vm02 -m setup -a &apos;filter=ansible_nodename&apos;</div></pre></td></tr></table></figure></p><h1 id="file-模块"><a href="#file-模块" class="headerlink" title="file 模块"></a>file 模块</h1><p>file模块主要用于远程主机上的文件操作，file模块包含如下选项：<br>force：需要在两种情况下强制创建软链接，一种是源文件不存在但之后会建立的情况下；另一种是目标软链接已存在,需要先取消之前的软链，然后创建新的软链，有两个选项：yes|no<br>group：定义文件/目录的属组<br>mode：定义文件/目录的权限<br>owner：定义文件/目录的属主<br>path：必选项，定义文件/目录的路径<br>recurse：递归的设置文件的属性，只对目录有效<br>src：要被链接的源文件的路径，只应用于state=link的情况<br>dest：被链接到的路径，只应用于state=link的情况<br>state：  </p><ul><li>directory：如果目录不存在，创建目录</li><li>file：即使文件不存在，也不会被创建</li><li>link：创建软链接</li><li>hard：创建硬链接</li><li>touch：如果文件不存在，则会创建一个新的文件，如果文件或目录已存在，则更新其最后修改时间</li><li>absent：删除目录、文件或者取消链接文件</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible nsxq -m file -a &apos;src=/etc/hosts dest=/tmp/hosts&apos;</div><div class="line">[root@vm00 ~]# ansible nsxq -a &apos;ls -lh /tmp/hosts&apos;</div><div class="line">[root@vm00 ~]# ansible nsxq -m file -a &quot;path=/tmp/file1 state=touch&quot;</div><div class="line">[root@vm00 ~]# ansible nsxq -m file -a &quot;dest=/tmp/hosts mode=600 owner=airmodel group=airmodel&quot;</div><div class="line">[root@vm00 ~]# ansible nsxq -m file -a &quot;dest=/opt/test mode=755 owner=airmodel group=airmodel state=directory&quot;</div></pre></td></tr></table></figure><h1 id="copy模块"><a href="#copy模块" class="headerlink" title="copy模块"></a>copy模块</h1><p>复制文件到远程主机，copy模块包含如下选项：<br>backup：在覆盖之前将原文件备份，备份文件包含时间信息。有两个选项：yes|no<br>content：用于替代”src”,可以直接设定指定文件的值<br>dest：必选项。要将源文件复制到的远程主机的绝对路径，如果源文件是一个目录，那么该路径也必须是个目录<br>directory_mode：递归的设定目录的权限，默认为系统默认权限<br>force：如果目标主机包含该文件，但内容不同，如果设置为yes，则强制覆盖，如果为no，则只有当目标主机的目标位置不存在该文件时，才复制。默认为yes<br>others：所有的file模块里的选项都可以在这里使用<br>src：要复制到远程主机的文件在本地的地址，可以是绝对路径，也可以是相对路径。如果路径是一个目录，它将递归复制。在这种情况下，如果路径使用”/“来结尾，则只复制目录里的内容，如果没有使用”/“来结尾，则包含目录在内的整个内容全部复制，类似于rsync。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible nsxq -m copy -a &quot;src=/etc/hosts dest=/tmp/hosts&quot;</div><div class="line">[root@vm00 ~]# ansible test -m copy -a &apos;src=/etc/fstab dest=/tmp/fstab owner=airmodel group=airmodel mode=644 backup=yes&apos;</div></pre></td></tr></table></figure></p><h1 id="service-模块"><a href="#service-模块" class="headerlink" title="service 模块"></a>service 模块</h1><p>管理服务，该模块包含如下选项：<br>arguments：给命令行提供一些选项<br>enabled：是否开机启动 yes|no<br>name：必选项，服务名称<br>pattern：定义一个模式，如果通过status指令来查看服务的状态时，没有响应，就会通过ps指令在进程中根据该模式进行查找，如果匹配到，则认为该服务依然在运行<br>runlevel：运行级别<br>sleep：如果执行了restarted，在则stop和start之间沉睡几秒钟<br>state：对当前服务执行启动，停止、重启、重新加载等操作（started,stopped,restarted,reloaded）<br>ansible nsxq -m service -a ‘name=nginx state=started enabled=yes’<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible test -m service -a &apos;name=httpd state=started enabled=yes&apos;</div></pre></td></tr></table></figure></p><h1 id="cron-模块"><a href="#cron-模块" class="headerlink" title="cron 模块"></a>cron 模块</h1><p>用于管理计划任务包含如下选项：<br>backup：对远程主机上的原任务计划内容修改之前做备份<br>cron_file：如果指定该选项，则用该文件替换远程主机上的cron.d目录下的用户的任务计划<br>day：日（1-31，<em>，</em>/2,……）<br>hour：小时（0-23，<em>，</em>/2，……）<br>minute：分钟（0-59，<em>，</em>/2，……）<br>month：月（1-12，<em>，</em>/2，……）<br>weekday：周（0-7，<em>，……）<br>job：要执行的任务，依赖于state=present<br>name：该任务的描述<br>special_time：指定什么时候执行，参数：reboot,yearly,annually,monthly,weekly,daily,hourly<br>state：确认该任务计划是创建还是删除<br>user：以哪个用户的身份执行<br>时间不特意指定的话，默认是 </em> <em> </em> <em> </em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible nsxq -m cron -a &apos;name=&quot;update ntp time&quot; hour=2 user=root job=&quot;/usr/sbin/ntpdate cn.ntp.org.cn&quot;&apos;</div><div class="line">[root@vm00 ~]# ansible nsxq -m cron -a &apos;name=&quot;update ntp time&quot; state=absent&apos;</div><div class="line">[root@vm00 ~]# ansible test -m cron -a &quot;name=&apos;show date&apos; job=&apos;/root/test.sh&apos; backup=&apos;True&apos; hour=2 minute=*/5&quot;</div></pre></td></tr></table></figure></p><h1 id="yum-模块"><a href="#yum-模块" class="headerlink" title="yum 模块"></a>yum 模块</h1><p>使用yum包管理器来管理软件包，其选项有：<br>config_file：yum的配置文件<br>disable_gpg_check：关闭gpg_check<br>disablerepo：不启用某个源<br>enablerepo：启用某个源<br>name：要进行操作的软件包的名字，也可以传递一个url或者一个本地的rpm包的路径<br>state：状态（present，absent，latest，installed）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible nsxq -m yum a &apos;name=httpd state=latest&apos;</div><div class="line">[root@vm00 ~]# ansible nsxq -m yum a &apos;name=&quot;@Development Tools&quot; state=present&apos;</div><div class="line">卸载操作</div><div class="line">[root@vm00 ~]# ansible test -m yum -a &quot;name=httpd state=absent&quot;</div></pre></td></tr></table></figure></p><h1 id="user模块"><a href="#user模块" class="headerlink" title="user模块"></a>user模块</h1><p>user模块是请求的是useradd, userdel, usermod三个指令。</p><p>home：指定用户的家目录，需要与createhome配合使用<br>groups：指定用户的属组<br>uid：指定用的uid<br>password：指定用户的密码<br>name：指定用户名<br>createhome：是否创建家目录 yes|no<br>system：是否为系统用户<br>remove：当state=absent时，remove=yes则表示连同家目录一起删除，等价于userdel -r<br>state：是创建还是删除<br>shell：指定用户的shell环境<br>指定password的时候，需要指定加密后的密码，明文会直接写到/etc/shadow文件中，用户无法登陆<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# echo &quot;ffffff&quot; | openssl passwd -1 -salt $(&lt; /dev/urandom tr -dc &apos;[:alnum:]&apos; | head -c 32) -stdin</div><div class="line">[root@vm00 ~]# ansible test -m user -a &apos;createhome=yes home=/home/user1 password=&quot;$1$01a9gEpb$nlv.OmSa1c4jDaGgeoDKi0&quot; name=user1 state=present shell=/bin/bash&apos;</div><div class="line">[root@vm00 ~]# ansible test -m user -a &apos;name=user1 state=absent remove=yes&apos;</div></pre></td></tr></table></figure></p><h1 id="group-模块"><a href="#group-模块" class="headerlink" title="group 模块"></a>group 模块</h1><p>goup模块请求的是groupadd, groupdel, groupmod 三个指令。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible test -m group -a &apos;name=group1 gid=700 state=present&apos;</div></pre></td></tr></table></figure></p><h1 id="synchronize-模块"><a href="#synchronize-模块" class="headerlink" title="synchronize 模块"></a>synchronize 模块</h1><p>使用rsync同步文件，其参数如下：<br>archive: 归档，相当于同时开启recursive(递归)、links、perms、times、owner、group、-D选项都为yes ，默认该项为开启<br>checksum: 跳过检测sum值，默认关闭<br>compress:是否开启压缩<br>copy_links：复制链接文件，默认为no ，注意后面还有一个links参数<br>delete: 删除不存在的文件，默认no<br>dest：目录路径<br>dest_port：默认目录主机上的端口 ，默认是22，走的ssh协议<br>dirs：传速目录不进行递归，默认为no，即进行目录递归<br>rsync_opts：rsync参数部分<br>set_remote_user：主要用于/etc/ansible/hosts中定义或默认使用的用户与rsync使用的用户不同的情况<br>mode: push或pull 模块，缺省模式是push；push模的话，一般用于从本机向远程主机上传文件，push的时候src是本机上的文件或目录; pull 模式用于从远程主机上取文件；pull的时候src是目标主机上的文件或目录<br>目录后边跟/表示同步目录下内容，不加/把目录同步过去<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible test -m synchronize -a &apos;src=/etc/hosts dest=/tmp mode=push&apos;</div><div class="line">[root@vm00 ~]# ansible test -m synchronize -a &apos;src=/etc/fstab dest=/tmp mode=pull&apos;</div></pre></td></tr></table></figure></p><h1 id="filesystem-模块"><a href="#filesystem-模块" class="headerlink" title="filesystem 模块"></a>filesystem 模块</h1><p>在块设备上创建文件系统<br>选项：<br>dev：目标块设备<br>force：在一个已有文件系统 的设备上强制创建<br>fstype：文件系统的类型<br>opts：传递给mkfs命令的选项<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible test -a &apos;dd if=/dev/zero of=/abc.img bs=4k count=10000&apos;</div><div class="line">[root@vm00 ~]# ansible test -a &apos;losetup /dev/loop0 /abc.img&apos;</div><div class="line">[root@vm00 ~]# ansible test -m filesystem -a &apos;fstype=ext4 dev=/dev/loop0 force=yes opts=-F&apos;</div></pre></td></tr></table></figure></p><h1 id="mount-模块"><a href="#mount-模块" class="headerlink" title="mount 模块"></a>mount 模块</h1><p>配置挂载点<br>选项：<br>dump<br>fstype：必选项，挂载文件的类型<br>name：必选项，挂载点<br>opts：传递给mount命令的参数<br>src：必选项，要挂载的文件<br>state：必选项 </p><ul><li>present：只处理fstab中的配置 </li><li>absent：删除挂载点 </li><li>mounted：自动创建挂载点并挂载之 </li><li>umounted：卸载</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible test -m mount -a &apos;name=/opt/abc src=/abc.img fstype=ext4 opts=loop state=mounted&apos;</div></pre></td></tr></table></figure><p>模块的参数太多了，这篇文章基本上是copy过来的，这里贴一下出处：<a href="http://breezey.blog.51cto.com/2400275/1555530" target="_blank" rel="external">http://breezey.blog.51cto.com/2400275/1555530</a></p>]]></content>
      
      
      <categories>
          
          <category> 自动化运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 运维 </tag>
            
            <tag> 自动化 </tag>
            
            <tag> Ansible </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Ansible 入门篇</title>
      <link href="/arlo/40fad05f/"/>
      <url>/arlo/40fad05f/</url>
      
        <content type="html"><![CDATA[<p>Ansible (is Simple IT Automation) ,是一款自动化运维工具，基于强大的模块功能通过SSH协议推送到被管理端，可以实现的批量系统部署，批量程序部署，批量执行命令等</p><p><strong>特性</strong></p><ul><li>不需要安装客户端，基于ssh连接管理</li><li>不需要配置服务，安装Ansible工具，可以执行命令就可以</li><li>拥有大量的模块</li><li>支持YAML语法</li><li>安装配置简单(门槛低)</li><li>被管理机器支持Windows</li></ul><p><strong>组成部分</strong></p><ul><li>Ansible 核心</li><li>Inventory Ansible管理主机的清单</li><li>Modules 包括Ansible自带的核心模块和自定义模块</li><li>Plugins 完成模块功能的补充，包括连接插件、邮件插件等</li><li>Playbooks 编排文件，定义Ansible多任务配置文件，实现Ansible自动执行<a id="more"></a></li></ul><h1 id="安装ansible软件"><a href="#安装ansible软件" class="headerlink" title="安装ansible软件"></a>安装ansible软件</h1><p>需要主机有python环境，这个安装没啥说的，一键搞定，so easy！<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install ansible</div></pre></td></tr></table></figure></p><h1 id="配置管理主机清单"><a href="#配置管理主机清单" class="headerlink" title="配置管理主机清单"></a>配置管理主机清单</h1><p>默认的主机清单文件是/etc/ansible/hosts </p><ol><li>可以修改/etc/ansible/ansible.cfg文件中[defaults]下的#inventory参数来修改，</li><li>可以在执行命令时候使用-i参数来指定hosts文件</li></ol><h2 id="最简单的配置主机和组"><a href="#最简单的配置主机和组" class="headerlink" title="最简单的配置主机和组"></a>最简单的配置主机和组</h2><p>配置成主机名的时候，要确保主机名可以被解析(hosts或dns)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[web]</div><div class="line">vm01</div><div class="line">vm02</div><div class="line">[db]</div><div class="line">192.168.6.100</div><div class="line">192.168.6.101</div></pre></td></tr></table></figure></p><h2 id="自定义参数"><a href="#自定义参数" class="headerlink" title="自定义参数"></a>自定义参数</h2><p>ansible_ssh_user 用于指定管理远程主机的账号<br>ansible_ssh_pass 用于指定管理远程主机的密码<br>ansible_ssh_host 用于指定被管理的主机<br>ansible_ssh_port 用于指定ssh的端口<br>ansible_sudo_pass 用于sudo连接用户时的密码<br>ansible_sudo_exec 如果sudo命令不在默认路径，需要指定sudo命令路径<br>ansible_shell_type 目标系统的shell的类型，默认sh<br>ansible_ssh_private_key_file 指定key文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[webservers]</div><div class="line">192.168.10.12  ansible_ssh_pass=123456 ansible_ssh_user=root</div><div class="line">192.168.10.13  ansible_ssh_pass=123456 ansible_ssh_user=root ansible_ssh_port=3055</div><div class="line">vm03 ansible_ssh_pass=123567 ansible_ssh_user=root</div></pre></td></tr></table></figure></p><h2 id="指定主机范围"><a href="#指定主机范围" class="headerlink" title="指定主机范围"></a>指定主机范围</h2><p>01:20 表示192.168.6.1到192.168.6.20共20台主机<br>a:f   表示dba.islocal.cc 到dbf.islocal.cc共6台主机<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[db]</div><div class="line">192.168.6.[01:20]</div><div class="line">db[a:f].islocal.cc</div></pre></td></tr></table></figure></p><h2 id="主机组嵌套，"><a href="#主机组嵌套，" class="headerlink" title="主机组嵌套，"></a>主机组嵌套，</h2><p>使用children关键字<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[mfs:children]</div><div class="line">mfs_a</div><div class="line">mfs_b</div><div class="line">mfs_c</div><div class="line">[mfs_a]</div><div class="line">vm01</div><div class="line">[mfs_b]</div><div class="line">vm02</div><div class="line">[mfs_c]</div><div class="line">vm03</div></pre></td></tr></table></figure></p><p>测试一下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ansible mfs -m ping</div><div class="line">ansible mfs_c -m ping</div></pre></td></tr></table></figure></p><h2 id="调用匹配主机或主机组"><a href="#调用匹配主机或主机组" class="headerlink" title="调用匹配主机或主机组"></a>调用匹配主机或主机组</h2><h3 id="匹配所有"><a href="#匹配所有" class="headerlink" title="匹配所有"></a>匹配所有</h3><p>all 或者 *<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible all -m ping</div></pre></td></tr></table></figure></p><h3 id="匹配组"><a href="#匹配组" class="headerlink" title="匹配组"></a>匹配组</h3><p>直接写组名就ok<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible test -m ping</div></pre></td></tr></table></figure></p><h3 id="逻辑非"><a href="#逻辑非" class="headerlink" title="逻辑非"></a>逻辑非</h3><p>目标主机在nsxq组不在test组中，逻辑非使用！<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible nsxq:!test -m ping</div></pre></td></tr></table></figure></p><h3 id="逻辑与"><a href="#逻辑与" class="headerlink" title="逻辑与"></a>逻辑与</h3><p>目标主机在nsxq组并在test中，逻辑与使用&amp;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible nsxq:&amp;test -m ping</div></pre></td></tr></table></figure></p><h3 id="支持正则匹配"><a href="#支持正则匹配" class="headerlink" title="支持正则匹配"></a>支持正则匹配</h3><p>匹配一web或者db开头.islocal.cc 的主机<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible ~(web|db).*\.islocal\.cc -m ping</div></pre></td></tr></table></figure></p><h1 id="设置主机互信，配置SSH免密码登录"><a href="#设置主机互信，配置SSH免密码登录" class="headerlink" title="设置主机互信，配置SSH免密码登录"></a>设置主机互信，配置SSH免密码登录</h1><p>由于ansible是基于ssh来远程管理，执行操作命令的，每次输入密码的话会很繁琐，配置ssh免密码就显得很方便</p><ol><li>-k 命令会提示输入密码</li><li>修改配置文件/etc/ansible/ansible.cfg<br>host_key_checking=False   #当第一次连接远程主机时，会提示输入yes/no,跳过此环节</li></ol><p>配置ssh免密码登录，可以参考我之前的另一篇文章<strong><a href="http://islocal.cc/2017/06/18/批量修改主机密码-批量ssh免密码验证/">SSH免密码验证</a></strong></p><h1 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h1><p>查看模块<br>ansible-doc -l<br>查看模块参数用法<br>ansible-doc -s module<br>ansible-doc help module</p><h2 id="setup-模块"><a href="#setup-模块" class="headerlink" title="setup 模块"></a>setup 模块</h2><p>查看主机参数配置<br>ansible all -m setup</p><h2 id="ping-模块"><a href="#ping-模块" class="headerlink" title="ping 模块"></a>ping 模块</h2><p>测试主机连通性<br>ansible all -m ping</p><h2 id="file-模块"><a href="#file-模块" class="headerlink" title="file 模块"></a>file 模块</h2><p>[root@vm00 ~]# ansible nsxq -m file -a ‘src=/etc/hosts dest=/tmp/hosts’<br>[root@vm00 ~]# ansible nsxq -a ‘ls -lh /tmp/hosts’<br>[root@vm00 ~]# ansible nsxq -m file -“path=/tmp/file1 state=touch”<br>[root@vm00 ~]# ansible nsxq -m file -a “dest=/tmp/hosts mode=600 owner=airmodel group=airmodel”<br>[root@vm00 ~]# ansible nsxq -m file -a “dest=/opt/test mode=755 owner=airmodel group=airmodel state=directory”</p><h2 id="copy模块"><a href="#copy模块" class="headerlink" title="copy模块"></a>copy模块</h2><p>ansible nsxq -m copy -a “src=/etc/hosts dest=/tmp/hosts” </p><h2 id="command-模块【默认模块】"><a href="#command-模块【默认模块】" class="headerlink" title="command 模块【默认模块】"></a>command 模块【默认模块】</h2><p>ansible all -m command -a “/bin/echo ‘hello,sir.’”<br>ansible all -a ‘chdir=/usr/local/src/ tar -cvzf test.tgz file’</p><h2 id="shell-模块"><a href="#shell-模块" class="headerlink" title="shell 模块"></a>shell 模块</h2><p>和command一样；支持管道</p><h2 id="raw-模块"><a href="#raw-模块" class="headerlink" title="raw 模块"></a>raw 模块</h2><p>和command一样</p><h2 id="service-模块"><a href="#service-模块" class="headerlink" title="service 模块"></a>service 模块</h2><p>ansible nsxq -m service -a ‘name=nginx state=started enabled=yes’</p><h2 id="cron-模块"><a href="#cron-模块" class="headerlink" title="cron 模块"></a>cron 模块</h2><p>ansible nsxq -m cron -a ‘name=”update ntp time” hour=2 user=root job=”/usr/sbin/ntpdate cn.ntp.org.cn”‘<br>ansible nsxq -m cron -a ‘name=”update ntp time” state=absent’</p><h2 id="filesystem-模块"><a href="#filesystem-模块" class="headerlink" title="filesystem 模块"></a>filesystem 模块</h2><h2 id="yum-模块"><a href="#yum-模块" class="headerlink" title="yum 模块"></a>yum 模块</h2><p>ansible nsxq -m yum a ‘name=httpd state=installed’<br>ansible nsxq -m yum a ‘name=”@Development Tools” state=present’</p><h2 id="user-模块"><a href="#user-模块" class="headerlink" title="user 模块"></a>user 模块</h2><p>ansible nsxq -m user -a ‘createhome=yes home=/home/user1 password=”ffffff” name=user1 state=present shell=/bin/bash’</p><h2 id="synchronize-模块"><a href="#synchronize-模块" class="headerlink" title="synchronize 模块"></a>synchronize 模块</h2><p>目录后边跟/表示同步目录下内容，不加/把目录同步过去<br>ansible nsxq -m synchronize -a ‘src=/etc/hosts dest=/opt/‘</p><h2 id="filesystem-模块-1"><a href="#filesystem-模块-1" class="headerlink" title="filesystem 模块"></a>filesystem 模块</h2><p>ansible test -m filesystem -a ‘dev=/disk.img fstype=ext4 opts=-F’</p><h2 id="mount-模块"><a href="#mount-模块" class="headerlink" title="mount 模块"></a>mount 模块</h2><p>ansible test -m mount -a ‘fstype=ext4 name=/aaa src=/dev/loop0 state=mounted’</p><hr>]]></content>
      
      
      <categories>
          
          <category> 自动化运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 运维 </tag>
            
            <tag> 自动化 </tag>
            
            <tag> Ansible </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Except实践之 修改主机密码&amp;添加用户&amp;ssh免密码验证</title>
      <link href="/arlo/45fa6416/"/>
      <url>/arlo/45fa6416/</url>
      
        <content type="html"><![CDATA[<p>最近运维工作中遇到大批量的主机需要添加账户，修改密码，实现无密码验证等工作，由于这种工作完全是重复性的，可以借助脚本（更好的方式是自动化运维工具）来解决，主要是使用到expect工具，该工具主要用来处理自动交互式任务进行通信，不需要人为干预；今天就把用到的脚本在此记录一下，以备后用。<br><a id="more"></a></p><h1 id="批量修改主机密码"><a href="#批量修改主机密码" class="headerlink" title="批量修改主机密码"></a>批量修改主机密码</h1><p>脚本内容如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# cat chpasswd.sh </div><div class="line">#!/bin/bash</div><div class="line">file=&quot;iplist.txt&quot;</div><div class="line">for ip in `awk &apos;/^[^#]/&#123;print $1&#125;&apos; $file`; do</div><div class="line">    port=`awk -v I=$ip &apos;&#123;if(I==$1)print $3&#125;&apos; $file`</div><div class="line">    user=`awk -v I=$ip &apos;&#123;if(I==$1)print $2&#125;&apos; $file`</div><div class="line">    pass=`awk -v I=$ip &apos;&#123;if(I==$1)print $4&#125;&apos; $file`</div><div class="line">    newpass=`awk -v I=$ip &apos;&#123;if(I==$1)print $5&#125;&apos; $file`</div><div class="line"></div><div class="line">expect -c &quot;</div><div class="line">    spawn ssh -p$port $user@$ip</div><div class="line">    set timeout 2</div><div class="line">    expect &#123;</div><div class="line">        \&quot;(yes/no)\&quot; &#123;send \&quot;yes\r\&quot;;exp_continue&#125;</div><div class="line">        \&quot;password:\&quot; &#123;send \&quot;$pass\r\&quot;;exp_continue&#125;</div><div class="line">        \&quot;$user@*\&quot; &#123;send \&quot;echo \&apos;$newpass\&apos; |passwd --stdin $user\r exit\r\&quot;;exp_continue&#125;</div><div class="line"></div><div class="line">#\&quot;$user@*\&quot;  &#123;send \&quot;df -h\r exit\r\&quot;;exp_continue&#125;</div><div class="line">    &#125;&quot;</div><div class="line">done</div></pre></td></tr></table></figure></p><p>iplist.txt 格式如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# cat iplist.txt </div><div class="line">#     ip     user    port    passwd    newpasswd</div><div class="line">#------------------------------------------------</div><div class="line">192.168.6.101  root    22    ffffff    gggggg</div><div class="line">192.168.6.102  root    22    ffffff    gggggg</div></pre></td></tr></table></figure></p><h1 id="批量主机ssh免密码验证"><a href="#批量主机ssh免密码验证" class="headerlink" title="批量主机ssh免密码验证"></a>批量主机ssh免密码验证</h1><h2 id="手动操作ssh无密码验证"><a href="#手动操作ssh无密码验证" class="headerlink" title="手动操作ssh无密码验证"></a>手动操作ssh无密码验证</h2><h3 id="设置hosts记录"><a href="#设置hosts记录" class="headerlink" title="设置hosts记录"></a>设置hosts记录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# cat /etc/hosts</div><div class="line">\#127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4 oracle11g</div><div class="line">\#::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</div><div class="line">192.168.6.100 vm00</div><div class="line">192.168.6.101 vm01</div><div class="line">192.168.6.102 vm02</div></pre></td></tr></table></figure><h3 id="新建用户并设置密码（每台机器都执行）"><a href="#新建用户并设置密码（每台机器都执行）" class="headerlink" title="新建用户并设置密码（每台机器都执行）"></a>新建用户并设置密码（每台机器都执行）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# useradd -u 600 airmodel</div><div class="line">[root@vm00 ~]# echo &quot;ffffff&quot; |passwd --stdin airmodel</div><div class="line">Changing password for user airmodel.</div><div class="line">passwd: all authentication tokens updated successfully.</div></pre></td></tr></table></figure><h3 id="配置无密码访问key"><a href="#配置无密码访问key" class="headerlink" title="配置无密码访问key"></a>配置无密码访问key</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# su - airmodel</div><div class="line">[airmodel@vm00 ~]$ ssh-keygen </div><div class="line">Generating public/private rsa key pair.</div><div class="line">Enter file in which to save the key (/home/airmodel/.ssh/id_rsa): </div><div class="line">Created directory &apos;/home/airmodel/.ssh&apos;.</div><div class="line">Enter passphrase (empty for no passphrase): </div><div class="line">Enter same passphrase again: </div><div class="line">Your identification has been saved in /home/airmodel/.ssh/id_rsa.</div><div class="line">Your public key has been saved in /home/airmodel/.ssh/id_rsa.pub.</div><div class="line">The key fingerprint is:</div><div class="line">3a:d9:04:80:20:6a:90:8a:cd:c7:ee:fb:2d:d9:03:cd airmodel@vm00</div><div class="line">The key&apos;s randomart image is:</div><div class="line">+--[ RSA 2048]----+</div><div class="line">|+o ..            |</div><div class="line">|= .  .           |</div><div class="line">|++ .  .          |</div><div class="line">|+ o o  .         |</div><div class="line">|   o   oS        |</div><div class="line">|    . .=E        |</div><div class="line">|   .  ++.        |</div><div class="line">|    . ooo        |</div><div class="line">|    .o....       |</div><div class="line">+-----------------+</div></pre></td></tr></table></figure><p><img src="/images/2017/0618/01.png" alt="图片"></p><h3 id="将生成的公钥拷贝到其他主机"><a href="#将生成的公钥拷贝到其他主机" class="headerlink" title="将生成的公钥拷贝到其他主机"></a>将生成的公钥拷贝到其他主机</h3><p>标准命令格式：ssh-copy-id -i ~/.ssh/id_rsa.pub user@server<br>偷懒可以写成下边这种：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[airmodel@vm00 ~]$ ssh-copy-id -i vm02</div><div class="line">airmodel@vm02&apos;s password: </div><div class="line">Now try logging into the machine, with &quot;ssh &apos;vm02&apos;&quot;, and check in:</div><div class="line"></div><div class="line">  .ssh/authorized_keys</div><div class="line"></div><div class="line">to make sure we haven&apos;t added extra keys that you weren&apos;t expecting.</div></pre></td></tr></table></figure></p><h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><p>1.公钥会被拷贝到目标主机的 /home/user/.ssh/authorized_keys 文件中<br>2.[airmodel@vm00 ~]$ ssh vm02 无密码访问</p><h2 id="多主机自动化配置ssh免密脚本"><a href="#多主机自动化配置ssh免密脚本" class="headerlink" title="多主机自动化配置ssh免密脚本"></a>多主机自动化配置ssh免密脚本</h2><h3 id="添加用户脚本"><a href="#添加用户脚本" class="headerlink" title="添加用户脚本"></a>添加用户脚本</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# cat padduser.sh </div><div class="line">#!/bin/bash</div><div class="line">file=&quot;iplist2.txt&quot;</div><div class="line">newuser=&quot;airmodel&quot;</div><div class="line">newpass=&quot;ffffff&quot;</div><div class="line">for ip in `awk &apos;/^[^#]/&#123;print $1&#125;&apos; $file`; do</div><div class="line">    port=`awk -v I=$ip &apos;&#123;if(I==$1)print $3&#125;&apos; $file`</div><div class="line">    loginuser=`awk -v I=$ip &apos;&#123;if(I==$1)print $2&#125;&apos; $file`</div><div class="line">    pass=`awk -v I=$ip &apos;&#123;if(I==$1)print $4&#125;&apos; $file`</div><div class="line">expect -c &quot;</div><div class="line">    spawn ssh -p$port $loginuser@$ip</div><div class="line">    set timeout 2</div><div class="line">    expect &#123;</div><div class="line">        \&quot;(yes/no)\&quot; &#123;send \&quot;yes\r\&quot;;exp_continue&#125;</div><div class="line">        \&quot;password:\&quot; &#123;send \&quot;$pass\r\&quot;;exp_continue&#125;</div><div class="line">        \&quot;$user@*\&quot; &#123;send \&quot;useradd -u 600 $newuser &amp;&amp; echo \&apos;$newpass\&apos; |passwd --stdin $newuser\r exit\r\&quot;;exp_continue&#125;</div><div class="line">#\&quot;$user@*\&quot;  &#123;send \&quot;df -h\r exit\r\&quot;;exp_continue&#125;</div><div class="line">    &#125;&quot;</div><div class="line">done</div></pre></td></tr></table></figure><p>iplist2.txt内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#     ip     user    port    passwd    </div><div class="line">#--------------------------------------</div><div class="line">192.168.6.102  root    22    ffffff</div></pre></td></tr></table></figure></p><h3 id="多主机拷贝ssh公钥"><a href="#多主机拷贝ssh公钥" class="headerlink" title="多主机拷贝ssh公钥"></a>多主机拷贝ssh公钥</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line">#批量ssh无密码验证</div><div class="line">for p in $(cat /opt/iplist3.txt)</div><div class="line">do</div><div class="line">ip=$(echo &quot;$p&quot;|cut -f1 -d &quot;:&quot;)</div><div class="line">password=$(echo &quot;$p&quot;|cut -f2 -d &quot;:&quot;)</div><div class="line"></div><div class="line">expect -c &quot;   </div><div class="line">spawn ssh-copy-id -i /home/airmodel/.ssh/id_rsa.pub airmodel@$ip  </div><div class="line">        expect &#123;   </div><div class="line">                \&quot;*yes/no*\&quot; &#123;send \&quot;yes\r\&quot;; exp_continue&#125;   </div><div class="line">                \&quot;*password*\&quot; &#123;send \&quot;$password\r\&quot;; exp_continue&#125;   </div><div class="line">                \&quot;*Password*\&quot; &#123;send \&quot;$password\r\&quot;;&#125;   </div><div class="line">        &#125;   </div><div class="line">&quot;   </div><div class="line">done</div></pre></td></tr></table></figure><p>iplist3.txt 格式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">#user:passwd</div><div class="line">#-----------</div><div class="line">vm01:ffffff</div><div class="line">vm02:ffffff</div><div class="line">vm03:ffffff</div><div class="line">vm04:ffffff</div><div class="line">vm05:ffffff</div></pre></td></tr></table></figure></p><p>参考连接：<br><a href="http://zqscm.qiniucdn.com/data/20110709133541/index.html" target="_blank" rel="external">http://zqscm.qiniucdn.com/data/20110709133541/index.html</a><br><a href="https://blog.slogra.com/post-674.html" target="_blank" rel="external">https://blog.slogra.com/post-674.html</a><br><a href="http://blog.csdn.net/fanren224/article/details/63250184" target="_blank" rel="external">http://blog.csdn.net/fanren224/article/details/63250184</a></p>]]></content>
      
      
      <categories>
          
          <category> 自动化运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 运维 </tag>
            
            <tag> 自动化 </tag>
            
            <tag> expect </tag>
            
            <tag> 脚本 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Windows 下使用expdp自动备份多用户oracle脚本</title>
      <link href="/arlo/85974653/"/>
      <url>/arlo/85974653/</url>
      
        <content type="html"><![CDATA[<p>Windows下多Oracle实例，根据用户自动备份<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">@echo off   </div><div class="line">echo ================================================   </div><div class="line">echo  Windows环境下Oracle数据库的自动备份脚本  </div><div class="line">echo  1. 使用当前日期命名备份文件。  </div><div class="line">echo  2. 自动删除30天前的备份。  </div><div class="line">echo ================================================  </div><div class="line">::以“YYYYMMDD”格式取出当前时间。  </div><div class="line">set BACKUPDATE=%date:~0,4%%date:~5,2%%date:~8,2%  </div><div class="line">set DATADIR=E:\database_backup\%BACKUPDATE%</div><div class="line">echo 本次备份目录是%DATADIR%</div><div class="line">echo ================================================ </div><div class="line">echo 开始备份数据库</div><div class="line">for %%u in (AIR_FORECAST,ALK,AIR_FZ,TSUBJECT,TMAIN,TCODE,AIR_YBYJ,AIR_FXPT,INVENTORY,TENV,NEWMBGL) do expdp userid=&apos;sys/密码@实例 as sysdba&apos; schemas=%%u directory=DATA_PUMP_DIR dumpfile=%%u.dmp</div><div class="line">echo 移动文件到数据库备份目录</div><div class="line">if not exist &quot;E:\database_backup\%BACKUPDATE%&quot; mkdir E:\database_backup\%BACKUPDATE%  </div><div class="line">MOVE /Y E:\app\Administrator\admin\SX21\dpdump\* E:\database_backup\%BACKUPDATE%</div><div class="line">::删除30天前的备份</div><div class="line">forfiles /p E:\database_backup\  /m 201* /d -30 /c &quot;cmd /c if @isdir==TRUE (rmdir /q /s @path) else (del /f @path)&quot;  </div><div class="line">exit</div></pre></td></tr></table></figure></p><p>参考：<br><a href="http://www.cnblogs.com/peterpanzsy/p/3442784.html" target="_blank" rel="external">http://www.cnblogs.com/peterpanzsy/p/3442784.html</a><br><a href="http://blog.csdn.net/smasegain/article/details/46759267" target="_blank" rel="external">http://blog.csdn.net/smasegain/article/details/46759267</a></p>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>NIS 服务器搭建记录</title>
      <link href="/arlo/3e02ce74/"/>
      <url>/arlo/3e02ce74/</url>
      
        <content type="html"><![CDATA[<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>NIS是Network Information Services (NIS server)的缩写，是为了管理一个网络中的用户账号 ，以方便用户在不同的主机上登录时只需要一个账号即可，它将用户的账号保存在一个主机上，用户登录时只需向其发送请求确认账号是否正确。<br><a id="more"></a></p><h2 id="NIS-的主要功能：管理帐户信息"><a href="#NIS-的主要功能：管理帐户信息" class="headerlink" title="NIS 的主要功能：管理帐户信息"></a>NIS 的主要功能：管理帐户信息</h2><p><strong>服务器端文件名    档案内容</strong><br>/etc/passwd        提供用户账号、UID、GID、家目录所在、Shell 等等<br>/etc/group        提供群组数据以及 GID 的对应，还有该群组的加入人员<br>/etc/hosts        主机名与 IP 的对应，常用于 private IP 的主机名对应<br>/etc/services        每一种服务 (daemons) 所对应的埠口 (port number)<br>/etc/protocols        基础的 TCP/IP 封包协定，如 TCP, UDP, ICMP 等<br>/etc/rpc        每种 RPC 服务器所对应的程序号码<br>/var/yp/ypservers    NIS 服务器所提供的数据库</p><h1 id="NIS-Server端配置"><a href="#NIS-Server端配置" class="headerlink" title="NIS Server端配置"></a>NIS Server端配置</h1><p>yp-tools ：提供 NIS 相关的查寻指令功能。<br>ypbind ：提供 NIS Client 端的设定软件。<br>ypserv ：提供 NIS Server 端的设定软件。<br>rpcbind ：就是 RPC ，系统一般会安装上。</p><h2 id="安装NIS-Server-端软件"><a href="#安装NIS-Server-端软件" class="headerlink" title="安装NIS Server 端软件"></a>安装NIS Server 端软件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@sg010 ~]# yum -y install yp-tools ypbind ypserv rpcbind</div><div class="line">[root@sg010 ~]#  rpm -qa | grep &apos;^yp&apos;</div></pre></td></tr></table></figure><p>ypbind-1.20.4-33.el6.x86_64<br>yp-tools-2.9-12.el6.x86_64<br>ypserv-2.19-31.el6.x86_64<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg010 ~]#  rpm -qa | grep rpcbind</div></pre></td></tr></table></figure></p><p>rpcbind-0.2.0-13.el6_9.x86_64</p><h2 id="配置hosts文件"><a href="#配置hosts文件" class="headerlink" title="配置hosts文件"></a>配置hosts文件</h2><p>Hosts文件中之前的记录不要动，新增包含nis server 和 nis client 的主机与ip对应记录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[[root@sg010 ~]# vim /etc/sysconfig/network</div><div class="line">\#增加以下两行</div><div class="line">NISDOMAIN=hpcnis</div><div class="line">YPSERV_ARGS=&quot;-p 1011&quot;</div></pre></td></tr></table></figure></p><h2 id="配置nis服务"><a href="#配置nis服务" class="headerlink" title="配置nis服务"></a>配置nis服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@sg010 ~]# egrep -v &apos;^$|#&apos; /etc/ypserv.conf </div><div class="line">dns: no</div><div class="line">files: 30</div><div class="line">xfr_check_port: yes</div><div class="line">\*   : *       : shadow.byname    : port</div><div class="line">\*   : *       : passwd.adjunct.byname : port</div><div class="line">127.0.0.0/255.0.0.0:*:*:none</div><div class="line">218.193.126.128/255.255.255.128:*:*:none</div><div class="line">59.77.252.0/255.255.255.192:*:*:none</div><div class="line">\*:*:*:deny</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@sg010 ~]# vim /etc/sysconfig/yppasswdd</div><div class="line">YPPASSWDD_ARGS=&quot;--port 1012&quot;</div></pre></td></tr></table></figure><h2 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h2><p>启动后查看一下三个服务状态<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg010 ~]# /etc/init.d/rpcbind status</div></pre></td></tr></table></figure></p><p>rpcbind (pid  18813) is running…<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg010 ~]# /etc/init.d/ypserv status</div></pre></td></tr></table></figure></p><p>ypserv (pid  21054) is running…<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg010 ~]# /etc/init.d/yppasswdd status</div></pre></td></tr></table></figure></p><p>rpc.yppasswdd (pid  23087) is running…<br>并设置开机自启动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@sg010 ~]# chkconfig --level 35 ypserv on</div><div class="line">[root@sg010 ~]# chkconfig --level 35 yppasswdd on</div><div class="line">[root@sg010 ~]# chkconfig --level 35 rpcbind on</div></pre></td></tr></table></figure></p><h2 id="添加用户，设置密码"><a href="#添加用户，设置密码" class="headerlink" title="添加用户，设置密码"></a>添加用户，设置密码</h2><p>[root@sg010 ~]# useradd -u 1001 nisuser1<br>[root@sg010 ~]# echo ffffff|passwd –stdin nisuser1<br>[root@sg010 ~]# /usr/lib64/yp/ypinit -m<br><img src="/images/2017/0614/00.png" alt="图片"></p><h1 id="Client-端配置"><a href="#Client-端配置" class="headerlink" title="Client 端配置"></a>Client 端配置</h1><p>[root@sg011 ~]# yum -y install ypbind yp-tools<br>[root@sg011 ~]# rpm -qa |grep ‘^yp’<br>yp-tools-2.9-12.el6.x86_64<br>ypbind-1.20.4-30.el6.x86_64</p><h2 id="配置NIS"><a href="#配置NIS" class="headerlink" title="配置NIS"></a>配置NIS</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg011 ~]# setup</div></pre></td></tr></table></figure><p>xshell 的配色方案修改过，所以这里看到的图片颜色也不是那种蓝底色的<br>勾选NIS，启用NIS验证<br><img src="/images/2017/0614/01.png" alt="图片"><br>填写NIS的服务器域名和服务器地址<br><img src="/images/2017/0614/02.png" alt="图片"><br>Starting rpcbind:                                          [  OK  ]<br>Starting NIS service:                                      [  OK  ]<br>Binding NIS service: .                                     [  OK  ]<br><strong>刚才的步骤其实就是做了以下操作</strong></p><ul><li>/etc/sysconfig/network (加入 NISDOMAIN 项目)</li><li>/etc/yp.conf (亦即是 ypbind 的配置文件)</li><li>/etc/nsswitch.conf (修改许多主机验证功能的顺序)</li><li>/etc/sysconfig/authconfig (CentOS 的认证机制)</li><li>/etc/pam.d/system-auth (许多登入所需要的 PAM 认证过程)</li><li>启动了rpcbind 和 ypbind服务</li></ul><h3 id="etc-sysconfig-network"><a href="#etc-sysconfig-network" class="headerlink" title="/etc/sysconfig/network"></a>/etc/sysconfig/network</h3><p><img src="/images/2017/0614/03.png" alt="图片"></p><h3 id="etc-yp-conf"><a href="#etc-yp-conf" class="headerlink" title="/etc/yp.conf"></a>/etc/yp.conf</h3><p><img src="/images/2017/0614/04.png" alt="图片"> </p><h3 id="etc-nsswitch-conf"><a href="#etc-nsswitch-conf" class="headerlink" title="/etc/nsswitch.conf"></a>/etc/nsswitch.conf</h3><p>主机验证顺序<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">passwd:     files nis</div><div class="line">shadow:     files nis</div><div class="line">group:      files nis</div><div class="line">\#hosts:     db files nisplus nis dns</div><div class="line">hosts:      files nis dns</div></pre></td></tr></table></figure></p><h3 id="etc-sysconfig-authconfig"><a href="#etc-sysconfig-authconfig" class="headerlink" title="/etc/sysconfig/authconfig"></a>/etc/sysconfig/authconfig</h3><p>启用NIS<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">USENIS=yes</div></pre></td></tr></table></figure></p><h3 id="etc-pam-d-system-auth"><a href="#etc-pam-d-system-auth" class="headerlink" title="/etc/pam.d/system-auth"></a>/etc/pam.d/system-auth</h3><p>在pam验证过程中增加了nis<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">password    sufficient    pam_unix.so sha512 shadow nis nullok try_first_pass use_authtok</div></pre></td></tr></table></figure></p><h2 id="客户端简单粗暴的验证方法"><a href="#客户端简单粗暴的验证方法" class="headerlink" title="客户端简单粗暴的验证方法"></a>客户端简单粗暴的验证方法</h2><h3 id="切换用户验证"><a href="#切换用户验证" class="headerlink" title="切换用户验证"></a>切换用户验证</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@sg011 ~]# grep nisuser1 /etc/passwd</div><div class="line">[root@sg011 ~]# su - nisuser1</div></pre></td></tr></table></figure><p>su: warning: cannot change directory to /home/nisuser1: No such file or directory<br>-bash-4.1$<br><img src="/images/2017/0614/05.png" alt="图片"></p><h3 id="没有用户主目录"><a href="#没有用户主目录" class="headerlink" title="没有用户主目录"></a>没有用户主目录</h3><p>两种解决方式</p><ol><li>新建一个/home/nisuser1目录,cp /etc/skel/* /home/niuser1</li><li>使用nfs，挂载nis server的home目录，客户端和服务器使用的是同一个用户目录，保持一致性（推荐）<h2 id="修改用户的默认shell"><a href="#修改用户的默认shell" class="headerlink" title="修改用户的默认shell"></a>修改用户的默认shell</h2>在客户端执行 ypchsh<br><img src="/images/2017/0614/06.png" alt="图片"> </li></ol><p>参考：<a href="http://cn.linux.vbird.org/linux_server/0430nis.php" target="_blank" rel="external">http://cn.linux.vbird.org/linux_server/0430nis.php</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> NIS </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>NFS 服务器搭建记录</title>
      <link href="/arlo/dd17c5bd/"/>
      <url>/arlo/dd17c5bd/</url>
      
        <content type="html"><![CDATA[<h1 id="系统环境"><a href="#系统环境" class="headerlink" title="系统环境"></a>系统环境</h1><p>Centos 6.5<br>Iptables：off<br>Selinux：disabled</p><p>由于MBR分区表只支持2T的硬盘，/dev/sdb是一块10T的硬盘，使用GPT分区表，需要使用parted工具分区<br><a id="more"></a></p><h1 id="使用fdisk查看磁盘"><a href="#使用fdisk查看磁盘" class="headerlink" title="使用fdisk查看磁盘"></a>使用fdisk查看磁盘</h1><p>ps：这个之后又增加了一块10T的硬盘，这个截图早一点，没提现出来<br><img src="/images/2017/0613/00.png" alt="插入图片01"></p><h1 id="使用parted工具分区"><a href="#使用parted工具分区" class="headerlink" title="使用parted工具分区"></a>使用parted工具分区</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# parted /dev/sdb</div></pre></td></tr></table></figure><p>GNU Parted 2.1<br>Using /dev/sdb<br>Welcome to GNU Parted! Type ‘help’ to view a list of commands.<br>(parted) <font color="red">print</font><br>Model: VMware Virtual disk (scsi)<br>Disk /dev/sdb: 9896GB<br>Sector size (logical/physical): 512B/512B<br>Partition Table:  <font color="red">gpt</font>  </p><p>Number  Start  End  Size  File system  Name  Flags</p><p>(parted)<font color="red"> mkpart primary 0 10T</font><br>Warning: The resulting partition is not properly aligned for best performance.<br>Ignore/Cancel?<font color="red"> Ignore </font><br>(parted)<font color="red"> print </font><br>Model: VMware Virtual disk (scsi)<br>Disk /dev/sdb: 9896GB<br>Sector size (logical/physical): 512B/512B<br>Partition Table: gpt</p><p>Number  Start   End     Size    File system  Name     Flags<br> 1      17.4kB  9896GB  9896GB               primary</p><p>(parted) <font color="red"> quit </font><br>Information: You may need to update /etc/fstab.<br><img src="/images/2017/0613/01.png" alt="插入图片01"><br>(parted) <font color="red"> set 1 lvm on </font><br>(parted) <font color="red"> print  </font><br>Model: VMware Virtual disk (scsi)<br>Disk /dev/sdb: 9896GB<br>Sector size (logical/physical): 512B/512B<br>Partition Table: gpt</p><p>Number  Start   End     Size    File system  Name     Flags<br> 1      17.4kB  9896GB  9896GB  ext4         primary  lvm<br>(parted) <font color="red"> quit </font><br>Information: You may need to update /etc/fstab.<br><img src="/images/2017/0613/05.png" alt="插入图片01"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# parted /dev/sdc</div></pre></td></tr></table></figure></p><p>GNU Parted 2.1<br>Using /dev/sdc<br>Welcome to GNU Parted! Type ‘help’ to view a list of commands.<br>(parted)<font color="red"> print   </font><br>Error: /dev/sdc: unrecognised disk label<br>(parted) <font color="red"> mklabel gpt </font><br>(parted) <font color="red"> print </font><br>Model: VMware Virtual disk (scsi)<br>Disk /dev/sdc: 11.0TB<br>Sector size (logical/physical): 512B/512B<br>Partition Table: gpt</p><p>Number  Start  End  Size  File system  Name  Flags</p><p>(parted)<font color="red"> mkpart primary 0 10995G </font><br>Warning: The resulting partition is not properly aligned for best performance.<br>Ignore/Cancel?<font color="red"> Ignore   </font><br>(parted)<font color="red"> print </font><br>Model: VMware Virtual disk (scsi)<br>Disk /dev/sdc: 11.0TB<br>Sector size (logical/physical): 512B/512B<br>Partition Table: gpt</p><p>Number  Start   End     Size    File system  Name     Flags<br> 1      17.4kB  11.0TB  11.0TB               primary</p><p>(parted) <font color="red"> set 1 lvm on   </font><br>(parted) <font color="red"> print  </font><br>Model: VMware Virtual disk (scsi)<br>Disk /dev/sdc: 11.0TB<br>Sector size (logical/physical): 512B/512B<br>Partition Table: gpt</p><p>Number  Start   End     Size    File system  Name     Flags<br> 1      17.4kB  11.0TB  11.0TB               primary  lvm</p><p>(parted) <font color="red"> quit </font><br>Information: You may need to update /etc/fstab.<br><img src="/images/2017/0613/06.png" alt="插入图片01"></p><h1 id="lvm-划分"><a href="#lvm-划分" class="headerlink" title="lvm 划分"></a>lvm 划分</h1><h2 id="创建pv"><a href="#创建pv" class="headerlink" title="创建pv"></a>创建pv</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# pvcreate /dev/sdb1 /dev/sdc1</div></pre></td></tr></table></figure><p>  dev_is_mpath: failed to get device for 8:17<br>  Physical volume “/dev/sdb1” successfully created<br>  dev_is_mpath: failed to get device for 8:33<br>  Physical volume “/dev/sdc1” successfully created<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# pvdisplay</div></pre></td></tr></table></figure></p><p>— Physical volume —<br>  PV Name               /dev/sda2<br>  VG Name               vg_sg020<br>  PV Size               193.51 GiB / not usable 3.00 MiB<br>  Allocatable           yes (but full)<br>  PE Size               4.00 MiB<br>  Total PE              49538<br>  Free PE               0<br>  Allocated PE          49538<br>  PV UUID               BF6Ikw-eYtl-HfNM-Nnmt-WLK4-xb8O-KAnZtB</p><p>  “/dev/sdb1” is a new physical volume of “9.00 TiB”<br>  — NEW Physical volume —<br>  PV Name               /dev/sdb1<br>  VG Name<br>  PV Size               9.00 TiB<br>  Allocatable           NO<br>  PE Size               0<br>  Total PE              0<br>  Free PE               0<br>  Allocated PE          0<br>  PV UUID               aPPVxz-oeWE-lP9l-AeZU-p699-pffd-O7T3dW</p><p>  “/dev/sdc1” is a new physical volume of “10.00 TiB”<br>  — NEW Physical volume —<br>  PV Name               /dev/sdc1<br>  VG Name<br>  PV Size               10.00 TiB<br>  Allocatable           NO<br>  PE Size               0<br>  Total PE              0<br>  Free PE               0<br>  Allocated PE          0<br>  PV UUID               MWbqIl-WI66-JCsc-x0Re-UqjL-HgXB-Vw1jge<br><img src="/images/2017/0613/07.png" alt="插入图片01"></p><h2 id="创建vg"><a href="#创建vg" class="headerlink" title="创建vg"></a>创建vg</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# vgcreate vg_fuz /dev/sdb1 /dev/sdc1</div></pre></td></tr></table></figure><p>  Volume group “vg_fuz” successfully created<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# vgdisplay</div></pre></td></tr></table></figure></p><p>— Volume group —<br>  VG Name               vg_fuz<br>  System ID<br>  Format                lvm2<br>  Metadata Areas        2<br>  Metadata Sequence No  1<br>  VG Access             read/write<br>  VG Status             resizable<br>  MAX LV                0<br>  Cur LV                0<br>  Open LV               0<br>  Max PV                0<br>  Cur PV                2<br>  Act PV                2<br>  VG Size               19.00 TiB<br>  PE Size               4.00 MiB<br>  Total PE              4980734<br>  Alloc PE / Size       0 / 0<br>  Free  PE / Size       4980734 / 19.00 TiB<br>  VG UUID               ruDcio-mmt5-z6YD-7HS0-fbst-GIlT-SwmvcF</p><p>  — Volume group —<br>  VG Name               vg_sg020<br>  System ID<br>  Format                lvm2<br>  Metadata Areas        1<br>  Metadata Sequence No  4<br>  VG Access             read/write<br>  VG Status             resizable<br>  MAX LV                0<br>  Cur LV                3<br>  Open LV               3<br>  Max PV                0<br>  Cur PV                1<br>  Act PV                1<br>  VG Size               193.51 GiB<br>  PE Size               4.00 MiB<br>  Total PE              49538<br>  Alloc PE / Size       49538 / 193.51 GiB<br>  Free  PE / Size       0 / 0<br>  VG UUID               2E6Hdt-xWhi-DyLX-pDva-3WTw-fDNx-Qytoqg<br><img src="/images/2017/0613/08.png" alt="插入图片01"></p><h2 id="创建lv"><a href="#创建lv" class="headerlink" title="创建lv"></a>创建lv</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# lvcreate -n lv_fuz -l 4980734 vg_fuz</div></pre></td></tr></table></figure><p>Logical volume “lv_fuz” created<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# lvdisplay</div></pre></td></tr></table></figure></p><p>— Logical volume —<br>  LV Path                /dev/vg_fuz/lv_fuz<br>  LV Name                lv_fuz<br>  VG Name                vg_fuz<br>  LV UUID                JTUEVa-9JPb-0VaD-5JH8-fwov-MuUS-gp1Gdr<br>  LV Write Access        read/write<br>  LV Creation host, time sg020, 2017-06-14 09:27:14 +0800<br>  LV Status              available<br>  # open                 0<br>  LV Size                19.00 TiB<br>  Current LE             4980734<br>  Segments               2<br>  Allocation             inherit<br>  Read ahead sectors     auto<br>  - currently set to     256<br>  Block device           253:3</p><p>  — Logical volume —<br>  LV Path                /dev/vg_sg020/lv_root<br>  LV Name                lv_root<br>  VG Name                vg_sg020<br>  LV UUID                5yHVBf-Qt3u-fzb2-gwNL-opy3-0ewQ-0ypYsc<br>  LV Write Access        read/write<br>  LV Creation host, time livedvd.centos, 2017-06-09 15:49:11 +0800<br>  LV Status              available<br>  # open                 1<br>  LV Size                50.00 GiB<br>  Current LE             12800<br>  Segments               1<br>  Allocation             inherit<br>  Read ahead sectors     auto<br>  - currently set to     256<br>  Block device           253:0</p><p>  — Logical volume —<br>  LV Path                /dev/vg_sg020/lv_home<br>  LV Name                lv_home<br>  VG Name                vg_sg020<br>  LV UUID                d1bsIq-ZeVr-mxk1-Mu2U-7H1R-wXMX-rWZ9hj<br>  LV Write Access        read/write<br>  LV Creation host, time livedvd.centos, 2017-06-09 15:49:19 +0800<br>  LV Status              available<br>  # open                 1<br>  LV Size                124.11 GiB<br>  Current LE             31772<br>  Segments               1<br>  Allocation             inherit<br>  Read ahead sectors     auto<br>  - currently set to     256<br>  Block device           253:2</p><p>  — Logical volume —<br>  LV Path                /dev/vg_sg020/lv_swap<br>  LV Name                lv_swap<br>  VG Name                vg_sg020<br>  LV UUID                wGW4BB-KB5g-UUZ8-FwLQ-pTYy-Eoc2-ji102r<br>  LV Write Access        read/write<br>  LV Creation host, time livedvd.centos, 2017-06-09 15:49:37 +0800<br>  LV Status              available<br>  # open                 1<br>  LV Size                19.40 GiB<br>  Current LE             4966<br>  Segments               1<br>  Allocation             inherit<br>  Read ahead sectors     auto<br>  - currently set to     256<br>  Block device           253:1<br><img src="/images/2017/0613/09.png" alt="插入图片01"></p><h1 id="格式化分区"><a href="#格式化分区" class="headerlink" title="格式化分区"></a>格式化分区</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# mkfs.ext4 /dev/vg_fuz/lv_fuz</div></pre></td></tr></table></figure><p><em><br>mke2fs 1.41.12 (17-May-2010)<br>mkfs.ext4: Size of device /dev/vg_fuz/lv_fuz too big to be expressed in 32 bits<br>    using a blocksize of 4096.</em><br><strong><font color="red"> ext4格式的分区，不支持大于16TB的硬盘分区，我们使用xfs格式</font></strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# yum install xfsprogs</div><div class="line">[root@sg020 ~]# mkfs.xfs /dev/vg_fuz/lv_fuz</div></pre></td></tr></table></figure></p><p><img src="/images/2017/0613/02.png" alt="插入图片01"></p><h1 id="查找分区UUID"><a href="#查找分区UUID" class="headerlink" title="查找分区UUID"></a>查找分区UUID</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# blkid /dev/vg_fuz/lv_fuz</div></pre></td></tr></table></figure><p>/dev/vg_fuz/lv_fuz: UUID=”3c2731e9-eac4-4e05-b103-be061e4c009c” TYPE=”xfs”</p><h1 id="添加到fstab"><a href="#添加到fstab" class="headerlink" title="添加到fstab"></a>添加到fstab</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# mkdir /data</div><div class="line">[root@sg020 ~]# echo &apos;UUID=3c2731e9-eac4-4e05-b103-be061e4c009c /data xfs    defaults        0 0&apos;  &gt;&gt; /etc/fstab</div></pre></td></tr></table></figure><h1 id="挂载分区"><a href="#挂载分区" class="headerlink" title="挂载分区"></a>挂载分区</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# mount –a</div><div class="line">[root@sg020 ~]# mount |column –t</div></pre></td></tr></table></figure><p><img src="/images/2017/0613/03.png" alt="插入图片01"> </p><h1 id="查看安装nfs软件"><a href="#查看安装nfs软件" class="headerlink" title="查看安装nfs软件"></a>查看安装nfs软件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# yum -y install nfs-utils rpcbind</div><div class="line">[root@sg020 ~]# rpm -qa |grep nfs</div></pre></td></tr></table></figure><p>nfs-utils-1.2.3-39.el6.x86_64<br>nfs-utils-lib-1.1.5-6.el6.x86_64<br>nfs4-acl-tools-0.3.3-6.el6.x86_6<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# rpm -qa |grep rpcbind</div></pre></td></tr></table></figure></p><p>rpcbind-0.2.0-11.el6.x86_64<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">/etc/exports文件内容格式：</div><div class="line">&lt;输出目录&gt; [客户端1 选项（访问权限,用户映射,其他）] [客户端2 选项（访问权限,用户映射,其他）]</div></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# cat /etc/exports </div><div class="line">/data218.193.126.128/25(insecure,rw,async,no_root_squash)  59.77.252.0/26(insecure,rw,async,no_root_squash)</div></pre></td></tr></table></figure><p><em><br><strong><br>NFS的常用目录<br>/etc/exports                           NFS服务的主要配置文件<br>/usr/sbin/exportfs                   NFS服务的管理命令<br>/usr/sbin/showmount              客户端的查看命令<br>/var/lib/nfs/etab                      记录NFS分享出来的目录的完整权限设定值<br>/var/lib/nfs/xtab                      记录曾经登录过的客户端信息</strong></em></p><h1 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# /etc/init.d/rpcbind start</div></pre></td></tr></table></figure><p>Starting rpcbind:                                          [  OK  ]<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# /etc/init.d/nfs start</div></pre></td></tr></table></figure></p><p>Starting NFS services:                                     [  OK  ]<br>Starting NFS quotas:                                       [  OK  ]<br>Starting NFS mountd:                                       [  OK  ]<br>Starting NFS daemon:                                       [  OK  ]<br>Starting RPC idmapd:                                       [  OK  ]<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# chkconfig --level 35 rpcbind on</div><div class="line">[root@sg020 ~]# chkconfig --level 35 nfs on</div></pre></td></tr></table></figure></p><h2 id="重新共享所有目录并输出详细信息"><a href="#重新共享所有目录并输出详细信息" class="headerlink" title="重新共享所有目录并输出详细信息"></a>重新共享所有目录并输出详细信息</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# exportfs -rv</div></pre></td></tr></table></figure><p>exporting 218.193.126.128/25:/data<br>exporting 59.77.252.0/26:/data</p><h2 id="卸载所有共享目"><a href="#卸载所有共享目" class="headerlink" title="卸载所有共享目"></a>卸载所有共享目</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# exportfs -au</div></pre></td></tr></table></figure><h1 id="客户端挂载"><a href="#客户端挂载" class="headerlink" title="客户端挂载"></a>客户端挂载</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@sg011 ~]#  mount -t nfs sg020:/data/ /data</div><div class="line">[root@sg011 ~]#  echo “sg020:/data             /data   nfs nolock 0 0” &gt;&gt; /etc/fstab</div><div class="line">[root@sg011~]# mount –a</div><div class="line">[root@sg011 ~]# mount |column –t</div></pre></td></tr></table></figure><p><img src="/images/2017/0613/04.png" alt="插入图片01"> </p><h2 id="user-amp-group-是nobody的问题"><a href="#user-amp-group-是nobody的问题" class="headerlink" title="user &amp; group 是nobody的问题"></a>user &amp; group 是nobody的问题</h2><p>由于centos6以后采用的是nfs v4，所以在挂载后，服务端和客户端看到的信息不一致，客户端看到文件的user和group都是nobody 或nfsnobody，以下是解决办法</p><h3 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h3><p>修改配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># vi /etc/idmapd.conf</div><div class="line">Domain = hpcnfs</div></pre></td></tr></table></figure></p><p>重启服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">/etc/init.d/rpcidmapd restart </div><div class="line">chkconfig --level 35  rpcidmapd on</div></pre></td></tr></table></figure></p><h3 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h3><p>修改配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># vi /etc/idmapd.conf</div><div class="line">Domain = hpcnfs</div></pre></td></tr></table></figure></p><p>清除缓存<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nfsidmap -c</div></pre></td></tr></table></figure></p><p>重启服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">/etc/init.d/rpcidmapd restart </div><div class="line">chkconfig --level 35  rpcidmapd on</div></pre></td></tr></table></figure></p><h1 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h1><h2 id="重启之后，如果客户端提示“Stale-file-handle”，三种解决方法："><a href="#重启之后，如果客户端提示“Stale-file-handle”，三种解决方法：" class="headerlink" title="重启之后，如果客户端提示“Stale file handle”，三种解决方法："></a>重启之后，如果客户端提示“Stale file handle”，三种解决方法：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">1. umount /data;mount -a</div><div class="line">2. fuser -km /data; mount -a</div><div class="line">3. umount -lv /data; mount -a</div></pre></td></tr></table></figure><h2 id="lvm扩容，“resize2fs-Device-or-resource-busy-while-trying-to-open”，解决方法如下："><a href="#lvm扩容，“resize2fs-Device-or-resource-busy-while-trying-to-open”，解决方法如下：" class="headerlink" title="lvm扩容，“resize2fs: Device or resource busy while trying to open”，解决方法如下："></a>lvm扩容，“resize2fs: Device or resource busy while trying to open”，解决方法如下：</h2><p>其实做lvm不需要分区，直接将整个盘做成pv；扩容的vg时候，可以更懒一点，pv都不用做，直接vgextend；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vgextend vg_fuz /dev/sdc</div></pre></td></tr></table></figure></p><p>在扩容lv的时候，更加方便的做法是使用pe扩容，而不是容量（-L是容量，-l是PE，可以通过vgdisplay查看剩余）；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">lvextend -l +3000 /dev/vg_fuz/lv_fuz</div></pre></td></tr></table></figure></p><p>fdisk可以看到到容量已经变化了，但是df还看不出来，我们可以使用resize2fs命令重设；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">resize2fs /dev/vg_fuz/lv_fuz</div></pre></td></tr></table></figure></p><p>xfs 文件系统 resize2fs已经不适用了，需要用到一个新的命令xfs_growfs；</p><pre><code>xfs_growfs /dev/vg_fuz/lv_fuz</code></pre><p><img src="/images/2017/0613/10.png" alt="插入图片01"><br>因为整个环境是内网环境，需要拨vpn才能访问，我没有配置iptables，nfs的iptables配置也比较麻烦，回头研究一下；<br>另，今天遇到一个很有意思的情况（其实就是自己学艺不精），由于Nfs给两个网段提供服务，牵扯到一个跨网段的问题；我看了下服务器上的配置的网络情况，根据ip地址所在的网段（218.193.126.x和59.77.252.x）和子网掩码（25和26），配置了/data 218.193.126.0/25(insecure,rw,async,no_all_squash) 59.77.252.0/26(insecure,rw,async,no_all_squash)，之后的情况就很诡异，59这个网络是可以正常访问的，218这个网络提示没有权限（mount.nfs: access denied by server while mounting sg020:/data/），搞得我很纳闷，配置到精确的ip地址就没有问题；后来经群里高手点播，网络和掩码的计算（218.193.126.0/25意思应该是218.193.126.1~218.193.126.127），我的服务器ip是不在范围内的，回头需要补习一下网络基础。</p>]]></content>
      
      
      
        <tags>
            
            <tag> Nfs </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Oracle TNS-12541、TNS-00511 无监听程序</title>
      <link href="/arlo/6e04db84/"/>
      <url>/arlo/6e04db84/</url>
      
        <content type="html"><![CDATA[<p>一台Windows服务器上安装的oralce服务器很卡，于是同事就重启了一下，然后……，你想到了，起不来了。折腾了好久，服务器终于起来了，oracle起不来，记录一下故障原因</p><h1 id="提示错误信息"><a href="#提示错误信息" class="headerlink" title="提示错误信息"></a>提示错误信息</h1><p>如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">Fatal NI connect error 12541, connecting to:</div><div class="line"> (DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=WIN-EPRQ7FK9EK2)(PORT=1521))(CONNECT_DATA=(SID=orcl)(CID=(PROGRAM=E:\app\Administrator\product\11.2.0\dbhome_4\bin\emagent.exe)(HOST=WIN-EPRQ7FK9EK2)(USER=SYSTEM))))</div><div class="line"></div><div class="line">  VERSION INFORMATION:</div><div class="line">TNS for 64-bit Windows: Version 11.2.0.1.0 - Production</div><div class="line">Windows NT TCP/IP NT Protocol Adapter for 64-bit Windows: Version 11.2.0.1.0 - Production</div><div class="line">  Time: 13-6月 -2017 10:58:58</div><div class="line">  Tracing not turned on.</div><div class="line">  Tns error struct:</div><div class="line">    ns main err code: 12541</div><div class="line">    TNS-12541: TNS: 无监听程序</div><div class="line">    ns secondary err code: 12560</div><div class="line">    nt main err code: 511</div><div class="line">    TNS-00511: 无监听程序</div><div class="line">    nt secondary err code: 61</div><div class="line">    nt OS err code: 0</div></pre></td></tr></table></figure></p><a id="more"></a><h1 id="故障原因"><a href="#故障原因" class="headerlink" title="故障原因"></a>故障原因</h1><p>oracle运行时间过长，<strong>listener.log日志超过4G</strong>导致，此为oracle bug；BUG号为9879101 : THE CONNECT THROUGH LISTENER WAS SLOW WHEN LISTNER LOG GROWED 4GB</p><h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><ol><li>找到日志文件 E:\app\Administrator\diag\tnslsnr*<em>WIN-EPRQ7FK9EK2*</em>\listener\trace\listener.log</li><li>经查看，该日志大小为4.00 GB (4,294,967,340 字节)</li><li>删除该文件，启动监听、服务，恢复正常</li></ol><h1 id="顺手写个脚本放计划任务里"><a href="#顺手写个脚本放计划任务里" class="headerlink" title="顺手写个脚本放计划任务里"></a>顺手写个脚本放计划任务里</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">@echo off   </div><div class="line">echo ================================================   </div><div class="line">echo  E:\app\Administrator\diag\tnslsnr\WIN-EPRQ7FK9EK2\listener\trace\listener.log 备份文件，用来解决日志问超过4G，数据库监听死掉问题   </div><div class="line">echo ================================================  </div><div class="line">::以“YYYYMMDD”格式取出当前时间。  </div><div class="line">set BACKUPDATE=%date:~0,4%%date:~5,2%%date:~8,2%  </div><div class="line">set DATADIR=E:\app\Administrator\diag\tnslsnr\WIN-EPRQ7FK9EK2\listener\trace\</div><div class="line"></div><div class="line">echo 备份日志文件</div><div class="line">e:</div><div class="line">cd %DATADIR%</div><div class="line">lsnrctl set log_status off</div><div class="line">rename listener.log listener.log_%BACKUPDATE%</div><div class="line">lsnrctl set log_status on</div><div class="line">echo 删除30天以前的日志文件</div><div class="line">forfiles -p %DATADIR% -s -m listener.log_* -d -30 -c &quot;cmd /c del @path&quot;</div></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>在已存在的目录中增加一层路径</title>
      <link href="/arlo/ffa6a879/"/>
      <url>/arlo/ffa6a879/</url>
      
        <content type="html"><![CDATA[<p>由于之前项目上考虑不周，路径配置的有问题，现在需要在已有的目录中某一级增加一层目录，需要解决几个问题；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">/data/Model3/WeatherForecast/CAMX/2017/05/01/&#123;d1,d2,d3&#125;</div><div class="line">/data/Model3/WeatherForecast/CAMX/2017/05/01/00/&#123;d1,d2,d3&#125;</div></pre></td></tr></table></figure></p><ol><li>多级目录，多个参数，CAMX/2017/05/01 这四个参数是变化的</li><li>判断父级目录是否存在，存在后增加一层目录</li><li>移动之前的数据到当前目录<a id="more"></a>以下是我写的脚本，能满足使用，稍显繁琐，求优化！<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line">dir=&apos;/data/Model3/WeatherForecast&apos;</div><div class="line">#dir1=&quot;NAQMPSDAY&quot;</div><div class="line">dir1=&quot;CAMX CAMxDAY CMAQDAY CMAQ.WRF NAQMPS NAQMPSDAY WRF WRFCHEM WRFCHEMDAY&quot;</div><div class="line">dir2=&quot;2016 2017&quot;</div><div class="line">for i1 in $dir1;</div><div class="line">do</div><div class="line">    for i2 in $dir2;</div><div class="line">    do</div><div class="line">        for i3 in &#123;01..12&#125;;</div><div class="line">        do</div><div class="line">            for i4 in &#123;01..31&#125;;</div><div class="line">            do</div><div class="line">                dir4=&quot;$dir/$i1/$i2/$i3/$i4&quot;</div><div class="line">#                echo $dir4</div><div class="line">                if [ -d $dir4 ];then</div><div class="line">                    cd $dir4</div><div class="line">                    mkdir $dir4/00</div><div class="line">                    mv d* $dir4/00</div><div class="line">                fi</div><div class="line">            done</div><div class="line">        done</div><div class="line">    done</div><div class="line">done</div></pre></td></tr></table></figure></li></ol><p>以下是执行前后的效果对比图（使用tree -L 5 &gt; 2.txt生成）<br><img src="/images/2017/0525/01.png" alt="s"></p>]]></content>
      
      
      <categories>
          
          <category> 常识 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
            <tag> 脚本 </tag>
            
            <tag> linux常识 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Oracle 多实例启动</title>
      <link href="/arlo/6b9bbb19/"/>
      <url>/arlo/6b9bbb19/</url>
      
        <content type="html"><![CDATA[<p>oracle 服务器上配置了两个实例，orcl和sx21，启动服务的时候需要手动修改一下环境变量ORACLE_SID,在此记录一下。<br><a id="more"></a></p><h1 id="手动启动"><a href="#手动启动" class="headerlink" title="手动启动"></a>手动启动</h1><h2 id="oracle-用户的环境变量-bash-profile"><a href="#oracle-用户的环境变量-bash-profile" class="headerlink" title="oracle 用户的环境变量.bash_profile"></a>oracle 用户的环境变量.bash_profile</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">ORACLE_BASE=/u01/app/oracle</div><div class="line">ORACLE_HOME=$ORACLE_BASE/product/11.1.0/db_1</div><div class="line">ORACLE_SID=orcl</div><div class="line">PATH=$PATH:$ORACLE_HOME/bin:$HOME/bin</div><div class="line">LD_LIBRARY_PATH=$ORACLE_HOME/lib</div><div class="line">export PATH ORACLE_BASE ORACLE_HOME ORACLE_SID PATH LD_LIBRARY_PATH</div><div class="line">export LANG=zh_CN.UTF-8</div><div class="line">export NLS_LANG=AMERICAN_AMERICA.ZHS16GBK</div></pre></td></tr></table></figure><h2 id="查看环境变量"><a href="#查看环境变量" class="headerlink" title="查看环境变量"></a>查看环境变量</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[oracle@localhost ~]$ echo $ORACLE_HOME</div><div class="line">/u01/app/oracle/product/11.1.0/db_1</div><div class="line">[oracle@localhost ~]$ echo $ORACLE_SID</div><div class="line">orcl</div></pre></td></tr></table></figure><h2 id="启动oracle服务"><a href="#启动oracle服务" class="headerlink" title="启动oracle服务"></a>启动oracle服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">su - oracle</div><div class="line">sqlplus /nolog</div><div class="line">sql&gt; conn /as sysdba</div><div class="line">sql&gt; startup</div><div class="line">sql&gt; exit</div></pre></td></tr></table></figure><h2 id="修改ORACLE-SID环境变量，再次执行第3步的启动操作"><a href="#修改ORACLE-SID环境变量，再次执行第3步的启动操作" class="headerlink" title="修改ORACLE_SID环境变量，再次执行第3步的启动操作"></a>修改ORACLE_SID环境变量，再次执行第3步的启动操作</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">export ORACLE_SID=SX21</div></pre></td></tr></table></figure><h2 id="启动监听服务"><a href="#启动监听服务" class="headerlink" title="启动监听服务"></a>启动监听服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">lsnrctl start</div></pre></td></tr></table></figure><h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[oracle@localhost ~]$ sqlplus sys/password@SX21 as sysdba</div></pre></td></tr></table></figure><p><img src="/images/2017/0518/01.png" alt="oracle"></p><h1 id="自动启动"><a href="#自动启动" class="headerlink" title="自动启动"></a>自动启动</h1><h2 id="修改控制文件"><a href="#修改控制文件" class="headerlink" title="修改控制文件"></a>修改控制文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">vim /etc/oratab</div><div class="line">orcl:/u01/app/oracle/product/11.1.0/db_1:Y</div><div class="line">sx21:/u01/app/oracle/product/11.1.0/db_1:Y</div><div class="line">CQ:/u01/app/oracle/product/11.1.0/db_1:Y</div></pre></td></tr></table></figure><h2 id="修改dbstart文件"><a href="#修改dbstart文件" class="headerlink" title="修改dbstart文件"></a>修改dbstart文件</h2><p><em>修改第80行: ORACLE_HOME_LISTNER=$1为ORACLE_HOME_LISTNER=$ORACLE_HOME</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">vim /u01/app/oracle/product/11.1.0/db_1/bin/dbstart</div><div class="line">……</div><div class="line">ORACLE_HOME_LISTNER=$ORACLE_HOME</div><div class="line">……</div></pre></td></tr></table></figure></p><h2 id="修改dbshut文件"><a href="#修改dbshut文件" class="headerlink" title="修改dbshut文件"></a>修改dbshut文件</h2><p><em>修改第50行: ORACLE_HOME_LISTNER=$1为ORACLE_HOME_LISTNER=$ORACLE_HOME</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">vim /u01/app/oracle/product/11.1.0/db_1/bin/dbshut</div><div class="line">……</div><div class="line">ORACLE_HOME_LISTNER=$ORACLE_HOME</div><div class="line">……</div></pre></td></tr></table></figure></p><h2 id="修改开机启动文件"><a href="#修改开机启动文件" class="headerlink" title="修改开机启动文件"></a>修改开机启动文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">vim /etc/rc.local</div><div class="line">su - oracle -lc &quot;/u01/app/oracle/product/11.1.0/db_1/bin/lsnrctl start&quot;</div><div class="line">su - oracle -lc &quot;/u01/app/oracle/product/11.1.0/db_1/bin/dbstart&quot;</div></pre></td></tr></table></figure><h1 id="常用的三个图形控制如下"><a href="#常用的三个图形控制如下" class="headerlink" title="常用的三个图形控制如下"></a>常用的三个图形控制如下</h1><h2 id="启动em控制台"><a href="#启动em控制台" class="headerlink" title="启动em控制台"></a>启动em控制台</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">emctl start dbconsole</div><div class="line">#添加到开机启动文件中</div><div class="line">su - oracle -lc &quot;$ORACLE_HOME/bin/emctl start dbconsole&quot;</div></pre></td></tr></table></figure><h2 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dbca</div></pre></td></tr></table></figure><h2 id="配置监听"><a href="#配置监听" class="headerlink" title="配置监听"></a>配置监听</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">netca</div><div class="line">netmgr</div></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Oracle入门</title>
      <link href="/arlo/9f698189/"/>
      <url>/arlo/9f698189/</url>
      
        <content type="html"><![CDATA[<p>服务、监听<br>启动oracle服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">su - oracle</div><div class="line">sqlplus /nolog</div><div class="line">sql&gt; conn /as sysdba</div><div class="line">sql&gt; startup</div><div class="line">sql&gt; exit</div></pre></td></tr></table></figure></p><p>启动监听服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">lsnrctl start</div></pre></td></tr></table></figure></p><a id="more"></a><p>配置监听<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">netca</div></pre></td></tr></table></figure></p><p>启动em控制台<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">emctl start dbconsole</div></pre></td></tr></table></figure></p><p>创建数据库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dbca</div></pre></td></tr></table></figure></p><p>连接数据库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sqlplus /nolog</div><div class="line">conn / as sysdba;</div></pre></td></tr></table></figure></p><p>连接数据库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">conn system/password;</div></pre></td></tr></table></figure></p><p>断开数据库连接<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">disc[onnect]</div></pre></td></tr></table></figure></p><p>将屏幕上的内容输入到文件中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">spool d:\a.txt</div><div class="line">……</div><div class="line">spool off;</div></pre></td></tr></table></figure></p><p>创建用户</p><p>密码必须以字母开头<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">create user xiaoming identified by m123;</div></pre></td></tr></table></figure></p><p>sys用户：超级管理员，权限最高，dba角色，默认密码：change_on_install<br>system用户：系统管理员，没有create database权限，默认密码：manager<br>普通用户：新建的用户无登录数据库权限<br>查看当前用户<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">show user；</div></pre></td></tr></table></figure></p><p>修改密码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">1. passw[ord]</div><div class="line">2. alter user 用户名 identified by 新密码;</div></pre></td></tr></table></figure></p><p>删除用户<br>如果用户已经创建表，删除的时候加一个cascade参数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">drop user 用户名 cascade</div></pre></td></tr></table></figure></p><p>如果一个用户正在被占用，报错<em>ORA-01940: cannot drop a user that is currently connected</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SELECT &apos;ALTER SYSTEM KILL SESSION &apos;||&apos;&apos;&apos;&apos;||SID||&apos;&apos;&apos;&apos;||&apos;,&apos;||&apos;&apos;&apos;&apos;||SERIAL#||&apos;&apos;&apos;&apos;||&apos;;&apos; as KILLER FROM V$SESSION WHERE USERNAME=&apos;USER&apos;;</div></pre></td></tr></table></figure></p><p>授予权限<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">grant select on emp to xiaoming;</div><div class="line">grant all on emp to xiaoming;</div></pre></td></tr></table></figure></p><p>收回权限<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">revoke all on emp to xiaoming;</div></pre></td></tr></table></figure></p><p>收回上级权限，下级权限也相应取消<br>对象权限授权<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">grant select on emp to xiaoming with grant option;</div><div class="line">conn xiaoming/m1234;</div><div class="line">grant select on scott.emp to xiaohong;</div></pre></td></tr></table></figure></p><p>系统权限授权<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">grant connect to xiaoming with admin option;</div><div class="line">conn xiaoming/1234;</div><div class="line">grant connect to xiaohong;</div></pre></td></tr></table></figure></p><p>用户口令管理<br>建立数据库时候，oracle会建立默认的default的profile，当没有给用户指定profile的时候，oracle会将default的profile分配给用户<br>创建profile文件<br>用户输入3次错误密码后被锁定2天<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">create profile lock_account limit failed_login_attempts 3 password_lock_time 2;</div><div class="line">alter user xiaoming profile lock_account;</div></pre></td></tr></table></figure></p><p>用户解锁<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alter user xiaoming account unlock;</div></pre></td></tr></table></figure></p><p>定期修改密码<br>要求用每隔30天修改登录密码，宽限期为2天，32天后没有修改将不能登录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">create profile myprofile limit password_life_time 30 password_grace_time 2;</div><div class="line">alter user xiaoming profile myprofile;</div></pre></td></tr></table></figure></p><p>口令历史<br>希望用户修改密码的时候，不能使用之前的密码；使用口令历史，oracle会将之前的密码存在数据字典中，当用户修改密码时，oracle会将新输入的密码和旧密码进行比对，如果一样，会提示重新输入。<br>不能使用10内使用过的密码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">create profile password_history limit password_life_time 10 password_grace_time 2 password_reuse_time 10</div><div class="line">alter user xiaoming profile password_history;</div></pre></td></tr></table></figure></p><p>删除profile文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">drop profile password_history [cascade]</div></pre></td></tr></table></figure></p><p>###############Day2############<br>创建表<br>必须以字母开头<br>长度不能超过30个字符<br>不能使用oracle保留字<br>只能使用a-zA-Z0-9$#</p><p>字符型<br>char 2000<br>varchar2 4000<br>clob 4000+<br>数字型<br>number 整数，小数 -(10^38) ~ 10^38<br>日期类型<br>date  包含年月日和时分秒<br>timestamp 时间戳，精度更高<br>图片<br>blob</p><p>创建student表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">create table student(</div><div class="line">xh number(4),</div><div class="line">xm varchar2(20),</div><div class="line">sex char(2),</div><div class="line">birthday date,</div><div class="line">sal num(7,2)</div><div class="line">);</div></pre></td></tr></table></figure></p><p>添加一个字段<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alter table student add(classID number(2));</div></pre></td></tr></table></figure></p><p>修改字段长度<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alter table student modify(xm varchar2(30));</div></pre></td></tr></table></figure></p><p>修改字段的类型/或者名字（不能有数据）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alter table student modify (xm char(30));</div></pre></td></tr></table></figure></p><p>删除一个字段<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alter table student drop column sal;</div></pre></td></tr></table></figure></p><p>修改表名字<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rename student to stu;</div></pre></td></tr></table></figure></p><p>删除表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">drop table student;</div></pre></td></tr></table></figure></p><p>修改日期默认格式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alter session set nls_date_format=&apos;mm-dd-yyyy&apos;</div></pre></td></tr></table></figure></p><p>插入数据<br>插入所有字段<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">insert into student values(1,&apos;小明&apos;,&apos;男&apos;,&apos;03-14-2017&apos;,3200.00)</div></pre></td></tr></table></figure></p><p>插入部分字段<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">insert into student(xh,xm,sex) values(&apos;23&apos;,小张&apos;,&apos;男&apos;)</div></pre></td></tr></table></figure></p><p>插入空值<br>修改数据<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">update student set sex=&apos;女&apos; where xm=&apos;小明&apos;;</div></pre></td></tr></table></figure></p><p>修改多个字段，用逗号隔开</p><p>将一行数据复制多条<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">insert into users (userid,username,userpass) select * from users;</div></pre></td></tr></table></figure></p><p>查询字段为[非]空<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select * from student where brithday is [not] null;</div></pre></td></tr></table></figure></p><p>删除数据,不删除表结构，记录在日志中，删除之前建立一个回滚点savepoint aa;可恢复<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">delete from student;</div></pre></td></tr></table></figure></p><p>删除数据后回滚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rollback to aa;</div></pre></td></tr></table></figure></p><p>删除表的结构和数据<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">drop table student;</div></pre></td></tr></table></figure></p><p>删除表数据，不删除表结构，不记录在日志中，不可恢复，速度快；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">truncate table student;</div></pre></td></tr></table></figure></p><p>查看表结构<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">desc table_name;</div></pre></td></tr></table></figure></p><p>查询所有列<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select * from dept;</div></pre></td></tr></table></figure></p><p>查询指定列<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select ename,sal,job,deption from dept;</div></pre></td></tr></table></figure></p><p>取消重复行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select distinct deptno,job from emp;</div></pre></td></tr></table></figure></p><p>打开显示操作时间<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">set timing on;</div></pre></td></tr></table></figure></p><p>nvl处理null值，当字段为null，当0处理<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select sal*13+nvl(comm,0)*13 &quot;年工资&quot;,ename,comm from emp;</div></pre></td></tr></table></figure></p><p>like<br>%表示0到多个字符<br>_表示任意单个字符</p><p>多个值匹配<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select * from emp where empno in(123,234,500);</div></pre></td></tr></table></figure></p><p>or &amp; and<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select * from emp where (sal&gt;500 or job=&apos;Manager&apos;) and ename like &apos;J%&apos;;</div></pre></td></tr></table></figure></p><p>默认排序低到高<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">order by [asc/desc]</div><div class="line">select * from emp order by sal;</div><div class="line">`</div></pre></td></tr></table></figure></p><p>按部门编号升序，薪水降序列；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select * from emp order by depto, sal desc;</div></pre></td></tr></table></figure></p><p>列别名排序<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select ename,(sal+nvl(comm,0))*12 [as] &quot;年薪&quot; from emp order by &quot;年薪&quot;;</div></pre></td></tr></table></figure></p><p>复杂查询<br>max，min，avg，sum，count<br>查询一个最高工资，最低工资<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select max(sal),min(sal) from emp;</div></pre></td></tr></table></figure></p><p>查出最高工资员工<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select ename,sal from emp where sal=(select max(sal) from emp);</div></pre></td></tr></table></figure></p><p>显示工资高于平均工资的员工<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select * from emp where sal&gt;(select avg(sal) from emp);</div></pre></td></tr></table></figure></p><p>group by<br>按部门分组，查出部门平均工资和最高工资<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select avg(sal),max(sal),deptno from emp group by deptno;</div></pre></td></tr></table></figure></p><p>显示每个部门的每种岗位的平均工资，最高工资<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select avg(sal),max(sal),deptno,job from emp group by deptno,job;</div></pre></td></tr></table></figure></p><p>having</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select avg(sal),max(sal),deptno  from emp group by deptno having avg(sal)&gt;2000;</div></pre></td></tr></table></figure><p>同一条语句出现顺序，优先级group by &gt; having &gt; order by<br>在选择列中，如果有列，表达式和分组函数，那么这些列和表达式中必须有一个出现在group by字句中，否则会报错</p><p>多表查询<br>多表查询的条件是至少不能少于表的个数-1<br>笛卡尔集<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select a1.ename,a1.sal,a2.dname from emp a1, dept a2 where a1.deptno=a2.deptno;</div></pre></td></tr></table></figure></p><p>between 在两者之间<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select a1.ename,a1.sal,a2.grade from emp a1,salgrade a2 where a1.sal between  a2.losal and a2.hisal;</div></pre></td></tr></table></figure></p><p>多表排序<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select a1.ename,a2.dname,a1.sal from emp a1,dept a2 where a1.deptno=a2.deptno order by a1.deptno;</div></pre></td></tr></table></figure></p><p>自连接</p><p>子查询<br>数据库执行sql语句从左到右<br>单行子查询<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select * from emp where deptno=(select deptno from emp where ename=&apos;SMITH&apos;);</div></pre></td></tr></table></figure></p><p>多行子查询<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select * from emp where job in(select distinct job from emp where deptno=10);</div></pre></td></tr></table></figure></p><p>all<br>查出工资比部门30的所有员工的工资都高的员工的姓名，工资和部门号<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">select ename,sal,deptno from emp where sal&gt;all(select all from emp where deptno=30);</div><div class="line">select * from emp where sal&gt;(select max(sal) from emp where deptno=30)</div></pre></td></tr></table></figure></p><p>any<br>查出工资比部门30的任意一个员工的工资高的员工的姓名，工资和部门号<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">select ename,sal,dept from emp where sal&gt;any(select all from emp where deptno=30);</div><div class="line">select * from emp where sal&gt;(select min(sal) from emp where deptno=30)</div></pre></td></tr></table></figure></p><p>多列子查询<br>查出与SMITH部门和岗位完全相同的所有职员<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select * from emp where (deptno,job)=(select deptno,job from emp where ename=&apos;SMITH&apos;);</div></pre></td></tr></table></figure></p><p>查询高于自己部门平均工资的员工的信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select a2.ename,a2.sal,a2.deptno,a1.mysal from emp a2,(select deptno,avg(sal) mysql from emp group by deptno) a1 where a2.deptno=a1.deptno and a2.sal &gt; a1.mysal;</div></pre></td></tr></table></figure></p><p>内嵌视图就是子查询当一个表使用，当在from子句中使用子查询时，必须给子查询指定别名；<br>列加别名可以加as，表加别名不能加as</p><p>分页查询<br>一共有三种方式</p><ol><li><p>rownum 分页</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select * from (select a1.*,rownum rn from (select * from emp) a1 where rownum&lt;=10) where rn&gt;6;</div></pre></td></tr></table></figure></li><li><p>ROWID 分页<br>速度最快</p></li><li><p>按分析函数分页<br>速度最慢</p></li></ol><p>查询结果创建新表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">create table mytable (id,name,sal,job,deptno) as select empno,ename,sal from emp;</div></pre></td></tr></table></figure></p><p>合并查询<br>为了合并多个select语句的结果，可以使用集合操作符号union，union all，intersect，minus.<br>union<br>去多个select查询结果的并集，取消重复行<br>union all<br>和union 类似，不取消重复行，or关系<br>intersect<br>取交集结果<br>minus<br>取差集（一个集合完全包含另一个集合，取没有的部分）</p><p>数据库管理员职责：</p><ol><li>安装和升级oracle数据库</li><li>建库，表空间，表，视图，索引……</li><li>指定并实施备份和恢复计划</li><li>数据库权限管理，调优，故障排除，</li><li>对于高级dba，要求能参与项目开发，会编写sql语句，存储过程，触发器，规则，约束，包</li></ol><p>sys用户：<br>所有oracle的数据字典的基表和动态视图都存在sys用户中；<br>sys拥有dba（数据库管理员角色），sysdba（系统管理员），sysoper（系统操作员） 角色和权限；<br>是oracle最高权限用户，必须以as sysdba或as sysoper形式登录，不能以normal方式登录数据库</p><p>system 用户：<br>存放次级用户内部数据;<br>拥有dba，sysdba角色及权限；</p><p>显示oracle 初始化参数<br>show parameter;</p><p>数据库的逻辑备份和恢复</p><p>导出表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">exp userid=username/passwd@sid tables=(table1,table2,table3) file=/path/x.dmp</div></pre></td></tr></table></figure></p><p>导入表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">imp userid=username/passwd@sid tables=(table1,table2,table3) file=/path/x.dmp</div></pre></td></tr></table></figure></p><p>使用直接导出方式<br>这种方式比默认常规的方式速度要快，当数据量大时，可以考虑这种方法，这时需要数据库的字符集要与客户端的字符集完全一致，否则报错<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">exp userid=username/passwd@sid tables=(table1,table2,table3) file=/path/x.dmp direct=y</div></pre></td></tr></table></figure></p><p>导出表结构<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">exp userid=username/passwd@sid tables=(table1,table2,table3) file=/path/x.dmp rows=n</div></pre></td></tr></table></figure></p><p>导出方案<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">exp username/passwd@sid owner=username file=/path/x.dmp</div></pre></td></tr></table></figure></p><p>导出数据库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">exp userid=system/passwd@sid full=y inctype=complete file=/path/xx.dmp</div><div class="line">imp userid=system/manager full=y file=/path/xx.dmp</div></pre></td></tr></table></figure></p><p>数据字典记录了数据库的系统信息，它是只读表和视图的集合，数据字典的所有者为sys用户，用户只能在数据字典上执行查询操作，而其维护和修改是由系统自动完成的<br>数据字典包括字典基表和数据字典动态视图，其中基表存储数据库的基本信息，普通用户不能直接访问数据字典的基表，数据字典视图是基于数据字典基表所建立的视图，普通用户可以通过查询数据字典的视图取得系统信息<br>数据字典视图主要包括user_xxx,all_xxx,dba_xxx三种类型</p><p>user_tables;<br>用于显示当前用户拥有的所有表，只返回用户所对应方案的所有表；<br>select table_name from user_tables;<br>all_tables;<br>用于显示当前用户可以访问的所有表;<br>select table_name from all_tables;<br>dba_tables;<br>用户显示所有方案拥有的数据库表。但是查询这种数据库字典视图，要求用户必须是dba角色或是有select any table系统权限。<br>select table_name from dba_tables;</p><p>用户名，权限，角色<br>dba_users  可以显示所有数据库用户的详细信息；<br>dba_sys_privs 可以显示用户所具有的系统权限；<br>dba_tab_privs 可以显示用户具有的对象权限;<br>dba_col_privs 可以显示用户具有的列权限；<br>dba_role_privs 可以显示用户所具有的角色。</p><p>查询oracle中所有的系统权限，一般是dba<br>select <em> from system_privilege_map order by name;<br>查询oracle中所有的角色，一般是dba<br>select </em> from dba_roles;<br>查询oracle中所有的对象权限，一般是dba<br>select distinct privilege from dba_tab_privs;<br>查询数据表的表空间<br>select tablespace_name from dba_tablespaces;</p><p>oracle 有多少种角色？<br>select <em> from dba_roles;<br>查询一种角色有多少种权限？<br>a. 一个角色包含的系统权限<br>select </em> from dba_sys_privs where grantee=’CONNECT’;<br>select <em> from role_sys_privs where role=’CONNECT’;<br>b. 一个角色包含的对象权限<br>select </em> from dba_tab_privs where grantee=’CONNECT’;<br>如何查看某个用户具有什么样的角色？<br>select * from dba_role_privs where grantee=’SCOTT’;</p><p>显示当前用户可以访问的所有数据字典视图<br>select <em> from dict where comments like ‘%grant%’<br>显示当前数据库的全称<br>select </em> from global_name;</p>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ecFlow安装小记</title>
      <link href="/arlo/8af01e65/"/>
      <url>/arlo/8af01e65/</url>
      
        <content type="html"><![CDATA[<p>在数值天气预报系统中有大量的计算机任务，这些任务之间又存在错综复杂的关系，如何管理和维护大量的复杂的任务成为一个难题，ecFlow正是为解决这一问题而诞生的。ecFlow是为欧洲中期天气预报中心（ECMWF）制作的产品，作为气象应用软件项目的一部分，用于工作流的管理和监控。<br>它具有如下功能：</p><ul><li>提供基于文本的任务定义语言以及python接口对计算机任务进行定义 </li><li>可以设定任务间的依赖关系，并在依赖关系满足时触发任务 </li><li>提供任务出错时的容错机制  </li><li>提供图形化的界面实时查看任务运行状况以及报错信息，用不同颜色来表示任务的运行状态，还可以根据需要自定义显示任务运行的进度。  </li></ul><p>ecFlow是基于客户端/服务端的模式工作的，即先启动一个ecFlow的服务端，计算机任务作为客户端，客户端任务在运行过程中将自己的状态发送到服务端，服务端根据收到的信息更新作业状态。<br><a id="more"></a></p><blockquote><p>本来是就Centos 6.9来安装ecflow的，由于ecflow要求Python版本必须大于2.7，而默认的是2.6.6，自行升级了python，编译后是各种报错，qt也装不上，实在是折腾累了，于是更换为centos7.2操作系统，默认python版本2.7.5，编译一切正常；</p></blockquote><h1 id="依赖关系"><a href="#依赖关系" class="headerlink" title="依赖关系"></a>依赖关系</h1><ul><li>cmake</li><li>g++</li><li>Python 2.7 or Python3</li><li>Xlib, X11, XMotif for <a href="https://software.ecmwf.int/wiki/display/ECFLOW/Glossary#term-ecflowview" target="_blank" rel="external">ecflowview</a> </li><li>Qt for <a href="https://software.ecmwf.int/wiki/display/ECFLOW/ecFlowUI+Documentation" target="_blank" rel="external">ecFlowUI</a></li></ul><h2 id="下载地址"><a href="#下载地址" class="headerlink" title="下载地址"></a>下载地址</h2><p>ecFlow：<a href="https://software.ecmwf.int/wiki/display/SUP/Releases" target="_blank" rel="external">https://software.ecmwf.int/wiki/display/SUP/Releases</a><br>boost：    <a href="http://www.boost.org/users/download/" target="_blank" rel="external">http://www.boost.org/users/download/</a><br>Motif：    <a href="http://www.ist.co.uk/motif/download/index.html" target="_blank" rel="external">http://www.ist.co.uk/motif/download/index.html</a><br>Qt：    <a href="http://mirrors.ustc.edu.cn/qtproject/archive/qt/" target="_blank" rel="external">http://mirrors.ustc.edu.cn/qtproject/archive/qt/</a></p><h2 id="安装cmake、g"><a href="#安装cmake、g" class="headerlink" title="安装cmake、g++"></a>安装cmake、g++</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vm01 ~]# yum -y install cmake g++ glibc  gcc gcc-c++ python-devel openssl-devel zlib-devel ncurses-devel</div></pre></td></tr></table></figure><h2 id="安装python3"><a href="#安装python3" class="headerlink" title="安装python3"></a>安装python3</h2><blockquote><p>Centos 7默认的python版本是2.7.5，满足要求；不需要安装python3</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@vm01 ~]# wget https://www.python.org/ftp/python/3.5.0/Python-3.5.0.tar.xz</div><div class="line">[root@vm01 ~]# tar xvf Python-3.5.0.tar.xz</div><div class="line">[root@vm01 ~]# cd Python-3.5.0</div><div class="line">[root@vm01 ~]# ./configure --prefix=/usr/local/python3</div><div class="line">[root@vm01 ~]# make &amp;&amp; make install</div><div class="line">[root@vm01 ~]# mv /usr/bin/python /usr/bin/python_old</div><div class="line">[root@vm01 ~]# ln -s /usr/local/python3/bin/python3 /usr/bin/python</div><div class="line">[root@vm01 ~]# cp -R /usr/local/python3/lib/* /usr/lib64/</div></pre></td></tr></table></figure><p>修改yum中的python版本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@vm01 ~]# vim /usr/bin/yum</div><div class="line">#!/usr/bin/python </div><div class="line">更改为 </div><div class="line">#!/usr/bin/python_old</div></pre></td></tr></table></figure></p><h2 id="安装Xlib-X11-XMotif"><a href="#安装Xlib-X11-XMotif" class="headerlink" title="安装Xlib, X11, XMotif"></a>安装Xlib, X11, XMotif</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vm01 ecFlow]# yum localinstall openmotif-2.1.32-2_IST.x86_64.rpm</div></pre></td></tr></table></figure><h2 id="ecFlowUI-需要图形界面QT支持"><a href="#ecFlowUI-需要图形界面QT支持" class="headerlink" title="ecFlowUI 需要图形界面QT支持"></a>ecFlowUI 需要图形界面QT支持</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@vm01 ecFlow]# yum -y install mesa-libGL-devel mesa-libGLU-devel freeglut-devel git gflags gflags-devel</div><div class="line">[root@vm01 ecFlow]# yum groupinstall &quot;GNOME Desktop&quot;</div><div class="line">[root@vm01 ecFlow]# chmod +x qt-opensource-linux-x64-5.8.0.run</div><div class="line">[root@vm01 ecFlow]# ./qt-opensource-linux-x64-5.8.0.run</div></pre></td></tr></table></figure><h1 id="安装ecFlow环境"><a href="#安装ecFlow环境" class="headerlink" title="安装ecFlow环境"></a>安装ecFlow环境</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@vm01 ~]# cd /usr/local/src/ecFlow/</div><div class="line">[root@vm01 ecFlow]# tar xf boost_1_64_0.tar.gz</div><div class="line">[root@vm01 ecFlow]# tar xf ecFlow-4.5.0-Source.tar.gz</div><div class="line">[root@vm01 ecFlow]# export WK=/usr/local/src/ecFlow/ecFlow-4.5.0-Source</div><div class="line">[root@vm01 ecFlow]# export BOOST_ROOT=/usr/local/src/ecFlow/boost_1_64_0</div></pre></td></tr></table></figure><h2 id="安装boost"><a href="#安装boost" class="headerlink" title="安装boost"></a>安装boost</h2><h3 id="基于bjam安装boost"><a href="#基于bjam安装boost" class="headerlink" title="基于bjam安装boost"></a>基于bjam安装boost</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@vm01 boost_1_64_0]# cd $BOOST_ROOT</div><div class="line">[root@vm01 boost_1_64_0]# ./bootstrap.sh</div><div class="line">[root@vm01 boost_1_64_0]# ./b2</div><div class="line">[root@vm01 boost_1_64_0]# ./b2 install --prefix=/usr/local</div></pre></td></tr></table></figure><h3 id="基于python安装boost"><a href="#基于python安装boost" class="headerlink" title="基于python安装boost"></a>基于python安装boost</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@vm01 boost_1_64_0]# ./bootstrap.sh --with-python=/usr/bin/python3</div><div class="line">[root@vm01 boost_1_64_0]# ./b2</div><div class="line">[root@vm01 boost_1_64_0]# ./b2 install --prefix=/usr/local</div></pre></td></tr></table></figure><blockquote><p>如果不需要ecflow的python接口，可以通过下面的设置避免编译boost的python库，在调用$WK/build_scripts/boost_build.sh前设置<br>export ECF_NO_PYTHON=1</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@vm01 boost_1_64_0]# cd $BOOST_ROOT</div><div class="line">[root@vm01 boost_1_64_0]# $WK/build_scripts/boost_1_53_fix.sh</div><div class="line">[root@vm01 boost_1_64_0]# $WK/build_scripts/boost_build.sh</div></pre></td></tr></table></figure><h2 id="编译安装ecflow"><a href="#编译安装ecflow" class="headerlink" title="编译安装ecflow"></a>编译安装ecflow</h2><p>推荐使用cmake 编译ecflow<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@vm01 boost_1_64_0]# cd $WK</div><div class="line">[root@vm01 build]# mkdir build; cd build;</div></pre></td></tr></table></figure></p><p><img src="/images/2017/0505/01.png" alt="ecFlow"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vm01 build]# export CMAKE_PREFIX_PATH=/opt/Qt5.8.0/5.8/gcc_64/lib/cmake/Qt5Network</div></pre></td></tr></table></figure></p><p><img src="/images/2017/0505/02.png" alt="ecFlow"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@vm01 build]# vim ../CMakeLists.txt   #在最底下添加这行代码</div><div class="line">set(CMAKE_CXX_FLAGS &quot;$&#123;CMAKE_CXX_FLAGS&#125; -fPIC&quot;) </div><div class="line">[root@vm01 build]# cmake ..  -DCMAKE_INSTALL_PREFIX=/usr/local/ecflow -DCMAKE_BUILD_TYPE=Release -DENABLE_GUI=OFF</div><div class="line">[root@vm01 build]# CPUS=$(lscpu -p | grep -v &apos;#&apos; | wc -l)</div><div class="line">[root@vm01 build]# make -j$&#123;CPUS&#125;</div><div class="line">[root@vm01 build]# make check</div><div class="line">[root@vm01 build]# make install</div></pre></td></tr></table></figure></p><p>参考链接：<br><a href="https://software.ecmwf.int/wiki/display/ECFLOW/Installation" target="_blank" rel="external">https://software.ecmwf.int/wiki/display/ECFLOW/Installation</a><br><a href="http://windrocblog.sinaapp.com/?p=1602" target="_blank" rel="external">http://windrocblog.sinaapp.com/?p=1602</a><br><a href="https://wenku.baidu.com/view/fda9af29bfd5b9f3f90f76c66137ee06eff94e8d.html?re=view" target="_blank" rel="external">https://wenku.baidu.com/view/fda9af29bfd5b9f3f90f76c66137ee06eff94e8d.html?re=view</a><br><a href="http://blog.csdn.net/u013121305/article/details/49853713" target="_blank" rel="external">http://blog.csdn.net/u013121305/article/details/49853713</a></p><hr>]]></content>
      
      
      <categories>
          
          <category> 大气模型 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ecFlow </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Centos 7下KVM 虚拟机搭建</title>
      <link href="/arlo/8ae03ce9/"/>
      <url>/arlo/8ae03ce9/</url>
      
        <content type="html"><![CDATA[<p>KVM（Kernel-based Virtual Machine）是支持虚拟化扩展（Intel VT 或 AMD-V技术）x86硬件的Linux完全虚拟化解决方案。它包括了一个可加载的内核模块kvm.ko，提供了核心的虚拟化架构以及一个处理器特定模块（kvm-intel.ko或kvm-amd.ko）。<br>使用KVM，用户可以运行多个无需修改的Linux或Windows虚拟机。每个虚拟机有自己私有的虚拟硬件：网卡、磁盘、显卡等等。<br><a id="more"></a></p><p><strong>系统化境</strong><br>iptables off<br>selinux disabled</p><h1 id="安装kvm虚拟化"><a href="#安装kvm虚拟化" class="headerlink" title="安装kvm虚拟化"></a>安装kvm虚拟化</h1><p>查看cpu是否支持全虚拟化<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">grep -E &apos;(vmx|svm)&apos; /proc/cpuinfo</div></pre></td></tr></table></figure></p><p>安装虚拟化组件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install qemu-kvm qemu-img virt-manager libvirt libvirt-python libvirt-client virt-install virt-viewer bridge-utils</div></pre></td></tr></table></figure></p><p>启动并设置开机自启动虚拟化服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">systemctl start libvirtd</div><div class="line">systemctl enable libvirtd</div></pre></td></tr></table></figure></p><p>检查虚拟化模块是否加载<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">lsmod | grep kvm</div></pre></td></tr></table></figure></p><p>安装图形界面<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y groupinstall &quot;GNOME Desktop&quot;</div></pre></td></tr></table></figure></p><p>图形化管理工具<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">virt-manager</div></pre></td></tr></table></figure></p><h1 id="配置桥接网络"><a href="#配置桥接网络" class="headerlink" title="配置桥接网络"></a>配置桥接网络</h1><p>拷贝一个br0网络配置文件<br>cd /etc/sysconfig/network-scripts/<br>cp ifcfg-em1 ifcfg-br0<br>配置ifcfg-em1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">TYPE=Ethernet</div><div class="line">BOOTPROTO=static</div><div class="line">DEVICE=em1</div><div class="line">ONBOOT=yes</div><div class="line">BRIDGE=br0</div></pre></td></tr></table></figure></p><p>配置ifcfg-br0<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">TYPE=Bridge</div><div class="line">BOOTPROTO=static</div><div class="line">DEVICE=br0</div><div class="line">ONBOOT=yes</div><div class="line">IPADDR=192.168.6.122</div><div class="line">NETMASK=255.255.255.0</div><div class="line">GATEWAY=192.168.6.1</div><div class="line">DNS1=223.5.5.5</div></pre></td></tr></table></figure></p><p>重启网络<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">systemctl restart network</div></pre></td></tr></table></figure></p><p>查看br0状态<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ip addr show br0</div><div class="line">brctl show</div></pre></td></tr></table></figure></p><h1 id="创建一个存储池"><a href="#创建一个存储池" class="headerlink" title="创建一个存储池"></a>创建一个存储池</h1><p>centos7操作系统安装的时候，自动分区时，大部分空间划分给/home分区了，默认的存储在/var/lib/libvirt/images目录下，在创建虚拟机之前我需要创建一个存储池；规划在/home/kvm/images 目录下<br>新建目录并设置权限<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mkdir -p /home/kvm/images;chown root:root /home/kvm/images;chmod 755 /home/kvm/images;</div></pre></td></tr></table></figure></p><p>创建存储池<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">#定义一个存储池绑定目录</div><div class="line"></div><div class="line">virsh pool-define-as StoragePool --type dir --target /home/kvm/images;</div><div class="line">#建立基于文件夹的存储池</div><div class="line">virsh pool-build StoragePool;</div><div class="line">#激活StoragePool</div><div class="line">virsh pool-start StoragePool;</div><div class="line">#存储池开机自动运行,使用virsh pool-autostart</div><div class="line">virsh pool-autostart StoragePool;</div><div class="line">#查看存储池的信息</div><div class="line">virsh pool-info StoragePool</div><div class="line">#查看创建的所有存储池</div><div class="line">virsh pool-list</div></pre></td></tr></table></figure></p><p>创建一个数据卷<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">virsh vol-create-as --pool StoragePool --name sql_server_2012.qcow2 100G --format qcow2</div></pre></td></tr></table></figure></p><p>查看存储卷信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">virsh vol-info --pool StoragePool sql_server_2012.qcow2 </div><div class="line">virsh vol-info /home/kvm/images/sql_server_2012.qcow2</div></pre></td></tr></table></figure></p><p>删除一个数据卷<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">virsh vol-delete --pool StoragePool sql_server_2012.qcow2</div></pre></td></tr></table></figure></p><h1 id="创建虚拟机"><a href="#创建虚拟机" class="headerlink" title="创建虚拟机"></a>创建虚拟机</h1><p>命令行创建虚拟机<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">virt-install --name sql_server_2012 --memory 4096 --vcpus sockets=1,cores=2,threads=2 --disk device=cdrom,path=/home/cn_windows_server_2012_r2_x64_dvd_2707961.iso --disk path=/home/kvm/images/sql_server_2012.qcow2 --network bridge=br0,model=e1000  --noautoconsole --accelerate --hvm --graphics vnc,listen=0.0.0.0,password=123456,port=20007 --cpu host-passthrough --autostart</div></pre></td></tr></table></figure></p><p>图形界面创建安虚拟机<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">virt-manager</div></pre></td></tr></table></figure></p><p>（过程略）</p><h1 id="virtsh-常用指令"><a href="#virtsh-常用指令" class="headerlink" title="virtsh 常用指令"></a>virtsh 常用指令</h1><p>1）virsh list 列出当前虚拟机列表，不包括未启动的<br>2）virsh list –all 列出所有虚拟机，包括所有已经定义的虚拟机<br>3）virsh destroy vm-name 关闭虚拟机<br>4）virsh start vm-name 启动虚拟机<br>5）virsh edit vm-name 编辑虚拟机xml文件<br>6）virsh undefine vm-name 删除虚拟机<br>7）virsh shutdown vm-name 停止虚拟机<br>8）virsh reboot vm-name 重启虚拟机<br>9）virsh autostart vm-name 虚拟机随宿主机启动</p><h1 id="virsh-pool与vol命令帮助"><a href="#virsh-pool与vol命令帮助" class="headerlink" title="virsh pool与vol命令帮助"></a>virsh pool与vol命令帮助</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">Storage Pool (help keyword &apos;pool&apos;)</div><div class="line">    find-storage-pool-sources-as   找到潜在存储池源</div><div class="line">    find-storage-pool-sources      发现潜在存储池源</div><div class="line">    pool-autostart                 自动启动某个池</div><div class="line">    pool-build                     建立池</div><div class="line">    pool-create-as                 从一组变量中创建一个池</div><div class="line">    pool-create                    从一个 XML 文件中创建一个池</div><div class="line">    pool-define-as                 在一组变量中定义池</div><div class="line">    pool-define                    define an inactive persistent storage pool or modify an existing persistent one from an XML file</div><div class="line">    pool-delete                    删除池</div><div class="line">    pool-destroy                   销毁（删除）池</div><div class="line">    pool-dumpxml                   XML 中的池信息</div><div class="line">    pool-edit                      为存储池编辑 XML 配置</div><div class="line">    pool-info                      存储池信息</div><div class="line">    pool-list                      列出池</div><div class="line">    pool-name                      将池 UUID 转换为池名称</div><div class="line">    pool-refresh                   刷新池</div><div class="line">    pool-start                     启动一个（以前定义的）非活跃的池</div><div class="line">    pool-undefine                  取消定义一个不活跃的池</div><div class="line">    pool-uuid                      把一个池名称转换为池 UUID</div><div class="line"></div><div class="line"> Storage Volume (help keyword &apos;volume&apos;)</div><div class="line">    vol-clone                      克隆卷。</div><div class="line">    vol-create-as                  从一组变量中创建卷</div><div class="line">    vol-create                     从一个 XML 文件创建一个卷</div><div class="line">    vol-create-from                生成卷，使用另一个卷作为输入。</div><div class="line">    vol-delete                     删除卷</div><div class="line">    vol-download                   将卷内容下载到文件中</div><div class="line">    vol-dumpxml                    XML 中的卷信息</div><div class="line">    vol-info                       存储卷信息</div><div class="line">    vol-key                        为给定密钥或者路径返回卷密钥</div><div class="line">    vol-list                       列出卷</div><div class="line">    vol-name                       为给定密钥或者路径返回卷名</div><div class="line">    vol-path                       为给定密钥或者路径返回卷路径</div><div class="line">    vol-pool                       为给定密钥或者路径返回存储池</div><div class="line">    vol-resize                     创新定义卷大小</div><div class="line">    vol-upload                     将文件内容上传到卷中</div><div class="line">    vol-wipe                       擦除卷</div></pre></td></tr></table></figure><p>参考：<br><a href="http://www.linuxtechi.com/install-kvm-hypervisor-on-centos-7-and-rhel-7/" target="_blank" rel="external">http://www.linuxtechi.com/install-kvm-hypervisor-on-centos-7-and-rhel-7/</a><br><a href="http://wangying.sinaapp.com/archives/1893" target="_blank" rel="external">http://wangying.sinaapp.com/archives/1893</a><br><a href="http://wangying.sinaapp.com/archives/1914" target="_blank" rel="external">http://wangying.sinaapp.com/archives/1914</a></p>]]></content>
      
      
      <categories>
          
          <category> 虚拟化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 虚拟化 </tag>
            
            <tag> kvm </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Tomcat多实例部署</title>
      <link href="/arlo/42b916ee/"/>
      <url>/arlo/42b916ee/</url>
      
        <content type="html"><![CDATA[<p>同一个tomcat下部署多个项目，重启会影响到其他项目的正常运行，为了使各项目独立，一般会使用安装多个tomcat，这样很耗费系统资源；创建tomcat多实例，有效的解决这一问题；<br><a id="more"></a></p><h1 id="常见部署方式"><a href="#常见部署方式" class="headerlink" title="常见部署方式"></a>常见部署方式</h1><p><strong>单实例单应用：</strong>比较常用的一种方式，只需要把你打好的 war 包丢在 webapps目录下，执行启动 Tomcat 的脚本就行了。<br><strong>单实例多应用：</strong>有两个不同的 Web 项目 war 包，还是只需要丢在webapps目录下，执行启动 Tomcat 的脚本，访问不同项目加上不同的虚拟目录。这种方式要慎用在生产环境，因为重启或挂掉 Tomcat 后会影响另外一个应用的访问。<br><strong>多实例单应用：</strong>多个 Tomcat 部署同一个项目，端口号不同，可以利用 Nginx 这么做负载均衡，当然意义不大。<br><strong>多实例多应用：</strong>多个 Tomcat 部署多个不同的项目。这种模式在服务器资源有限，或者对服务器要求并不是很高的情况下，可以实现多个不同项目部署在同一台服务器上的需求，来实现资源使用的最大化。</p><h1 id="目录作用"><a href="#目录作用" class="headerlink" title="目录作用"></a>目录作用</h1><p><strong>bin</strong>        主要存放脚本文件，例如比较常用的windows和linux系统中启动和关闭脚本<br><strong>conf</strong>    主要存放配置文件，其中最重要的两个配置文件是server.xml和web.xml<br><strong>lib</strong>        主要存放tomcat运行所依赖的包<br><strong>logs</strong>    主要存放运行时产生的日志文件，例如catalina.{date}.log等<br><strong>temp</strong>    存放tomcat运行时产生的临时文件，例如开启了hibernate缓存的应用程序，会在该目录下生成一些文件<br><strong>webapps</strong>    部署web应用程序的默认目录<br><strong>work</strong>    主要存放由JSP文件生成的servlet（java文件以及最终编译生成的class文件）</p><p>CATALINA_HOME：即指向Tomcat安装路径的系统变量<br>CATALINA_BASE：即指向活跃配置路径的系统变量<br>通过设置这两个变量，就可以将tomcat的安装目录和工作目录分离，从而实现tomcat多实例的部署。</p><p><img src="/images/2017/0502/01.png" alt="tomcat"><br>将tomcat复制为以下目录结构<br><img src="/images/2017/0502/00.png" alt="tomcat"></p><h1 id="修改-CATALINA-HOME-conf-server-xml"><a href="#修改-CATALINA-HOME-conf-server-xml" class="headerlink" title="修改$CATALINA_HOME/conf/server.xml"></a>修改$CATALINA_HOME/conf/server.xml</h1><p>在server.xml中配置了四个监听端口，分别是：<br><strong>Server Port：</strong>    该端口用于监听关闭tomcat的shutdown命令，默认为8005<br><strong>Connector Port：</strong>    该端口用于监听HTTP的请求，默认为8080<br><strong>AJP Port：</strong>        该端口用于监听AJP（ Apache JServ Protocol ）协议上的请求，通常用于整合Apache Server等其他HTTP服务器，默认为8009<br><strong>Redirect Port：</strong>    重定向端口，出现在Connector配置中，如果该Connector仅支持非SSL的普通http请求，那么该端口会把https的请求转发到这个Redirect Port指定的端口，默认为8443</p><p>修改第22行Server Port （三个tomcat依次修改为8005,8006,8007）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;Server port=&quot;8007&quot; shutdown=&quot;SHUTDOWN&quot;&gt;</div></pre></td></tr></table></figure></p><p>修改第71行Connector Port(三个tomcat依次修改为8080,8081,8082)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;Connector port=&quot;8082&quot; protocol=&quot;HTTP/1.1&quot;</div></pre></td></tr></table></figure></p><p>修改第93行AJP Port (三个tomcat依次修改为8009,8019,8029)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;Connector port=&quot;8029&quot; protocol=&quot;AJP/1.3&quot; redirectPort=&quot;8443&quot; /&gt;</div></pre></td></tr></table></figure></p><p>虚拟主机配置<br><strong>name：</strong>        虚拟主机的名称，一台主机表示了完全限定的域名或IP地址，默认为localhost，同时也是唯一的host，进入tomcat的所有http请求都会映射到该主机上<br><strong>appBase：</strong>        web应用程序目录的路径，可以是CATALINA_HOME的相对路径，也可以写成绝对路径，默认情况下为$CATALINA_HOME/webapps<br><strong>unpackWARs：</strong>    表示是否自动解压war包<br><strong>autoDeploy：</strong>    所谓的热部署，即在tomcat正在运行的情况下，如果有新的war加入，则会立即执行部署操作<br><strong>deployOnStartup：</strong>    表示tomcat启动时是否自动部署appBase目录下所有的Web应用程序，默认为true。这个属性和autoDeploy会产生两次部署的“副作用”：一次是tomcat启动时就开始部署，第二次就是autoDeploy引起的热部署。因此最好将autoDeploy置为false</p><p>修改第125-127行虚拟主机配置 (三个tomcat参考以下内容依次修改)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;Host name=&quot;c.com&quot;  appBase=&quot;/data/tomcat/c.com/&quot;</div><div class="line">            unpackWARs=&quot;true&quot; autoDeploy=&quot;false&quot;&gt;</div><div class="line">&lt;Context path=&quot;/hello&quot; docBase=&quot;/data/tomcat/c.com/hello.war&quot; /&gt;</div></pre></td></tr></table></figure></p><h1 id="启动-amp-关闭脚本"><a href="#启动-amp-关闭脚本" class="headerlink" title="启动&amp;关闭脚本"></a>启动&amp;关闭脚本</h1><p>脚本放在CATALINA_BASE(如：/opt/tomcat1/)下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">#!/bin/sh</div><div class="line"># description: 启动tomcat多实例.</div><div class="line">. /etc/init.d/functions</div><div class="line">RETVAL=$?</div><div class="line"># tomcat实例目录</div><div class="line">export CATALINA_BASE=&quot;$PWD&quot;</div><div class="line"># tomcat安装目录</div><div class="line">export CATALINA_HOME=&quot;/opt/&quot;</div><div class="line">case &quot;$1&quot; in</div><div class="line">start)</div><div class="line">if [ -f $CATALINA_HOME/bin/startup.sh ];then</div><div class="line">echo $&quot;Start Tomcat&quot;</div><div class="line">$CATALINA_HOME/bin/startup.sh</div><div class="line">fi</div><div class="line">;;</div><div class="line">stop)</div><div class="line">if [ -f $CATALINA_HOME/bin/shutdown.sh ];then</div><div class="line">echo $&quot;Stop Tomcat&quot;</div><div class="line">$CATALINA_HOME/bin/shutdown.sh</div><div class="line">fi</div><div class="line">;;</div><div class="line">*)</div><div class="line">echo $&quot;Usage: $0 &#123;start|stop&#125;&quot;</div><div class="line">exit 1</div><div class="line">;;</div><div class="line">esac</div><div class="line">exit $RETVAL</div></pre></td></tr></table></figure></p><blockquote><p><strong>因为启动脚本中有获取当前路径的操作，一定需要cd到tomcat.sh的当前目录下执行才可以</strong></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">cd /opt/tomcat1</div><div class="line">./tomcat.sh start|stop</div><div class="line">cd /opt/tomcat2</div><div class="line">./tomcat.sh start|stop</div><div class="line">cd /opt/tomcat3</div><div class="line">./tomcat.sh start|stop</div></pre></td></tr></table></figure><p>访问8080,8081,8082端口验证</p><p>参考地址：<br><a href="http://www.jianshu.com/p/0b549d00ecc2" target="_blank" rel="external">http://www.jianshu.com/p/0b549d00ecc2</a><br><a href="http://www.ttlsa.com/tomcat/config-multi-tomcat-instance/" target="_blank" rel="external">http://www.ttlsa.com/tomcat/config-multi-tomcat-instance/</a></p>]]></content>
      
      
      <categories>
          
          <category> 服务器搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tomcat </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>jenkins 持续集成环境搭建</title>
      <link href="/arlo/c0b31722/"/>
      <url>/arlo/c0b31722/</url>
      
        <content type="html"><![CDATA[<h1 id="持续集成"><a href="#持续集成" class="headerlink" title="持续集成"></a>持续集成</h1><blockquote><p> 持续集成（CI）是一种软件工程流程，将所有工程师对于软件的工作复本，每天集成数次到共用主线（mainline）上。</p></blockquote><h2 id="依赖以下原则达到目标"><a href="#依赖以下原则达到目标" class="headerlink" title="依赖以下原则达到目标"></a>依赖以下原则达到目标</h2><ul><li>维护一个代码库</li><li>自动建置</li><li>让建置时会自我测试</li><li>所有人每天至少提交一次</li><li>应该要建置每一个提交</li><li>让建置维持快速</li><li>用在线环境的复本测试</li><li>让获取最新发布版本更容易</li><li>任何人都可以查看最后建置的结果</li><li>自动部署</li></ul><h2 id="产生的效益"><a href="#产生的效益" class="headerlink" title="产生的效益"></a>产生的效益</h2><ul><li>及早发现集成错误且由于修订的内容较小所以易于追踪，这可以节省项目的时间与成本。</li><li>避免发布日期的前一分钟发生混乱，当每个人都会尝试为他们所造成的那一点点不兼容的版本做检查。</li><li>当单元测试失败或发生错误，若开发人员需要在不除错的情况下还原代码库到一个没有问题的状态，只需要放弃一小部分的更改 (因为集成的次数频繁)。</li><li>让 “最新” 的程序可保持可用的状态供测试、展示或发布用。</li><li>频繁的提交代码会促使开发人员创建模块化，低复杂性的代码。<a id="more"></a>Jenkins是一个用Java编写的开源的持续集成工具，前身是Hudson (软件)项目，有丰富的插件支持；</li></ul><h1 id="Jenkins安装"><a href="#Jenkins安装" class="headerlink" title="Jenkins安装"></a>Jenkins安装</h1><h2 id="安装jdk"><a href="#安装jdk" class="headerlink" title="安装jdk"></a>安装jdk</h2><p>jdk下载地址： <a href="http://www.oracle.com/technetwork/java/archive-139210.html" target="_blank" rel="external">http://www.oracle.com/technetwork/java/archive-139210.html</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tar xf jdk-8u112-linux-x64.tar.gz -C /usr/local/</div></pre></td></tr></table></figure></p><p>配置jdk环境变量<br>vim /etc/profile<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">export JAVA_HOME=/usr/local/jdk1.8.0_112</div><div class="line">export CLASSPATH=.:$JAVA_HOME/lib/:$JAVA_HOME/jre/lib/</div><div class="line">export PATH=$JAVA_HOME/bin:$PATH</div></pre></td></tr></table></figure></p><h2 id="安装jenkins"><a href="#安装jenkins" class="headerlink" title="安装jenkins"></a>安装jenkins</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo</div><div class="line">rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key</div><div class="line">yum install jenkins</div></pre></td></tr></table></figure><p>添加java路径到jenkins启动脚本中<br>vim /etc/init.d/jenkins<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/jdk1.8.0_112/bin/java</div></pre></td></tr></table></figure></p><p><img src="/images/2017/0427/00.png" alt="jenkins"><br>修改jenkins默认时区<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">vim /etc/sysconfig/jenkins</div><div class="line">JENKINS_JAVA_OPTIONS=&quot;-Djava.awt.headless=true -Dorg.apache.commons.jelly.tags.fmt.timeZone=Asia/Shanghai&quot;</div></pre></td></tr></table></figure></p><h2 id="启动jenkins"><a href="#启动jenkins" class="headerlink" title="启动jenkins"></a>启动jenkins</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">/etc/init.d/jenkins start</div><div class="line">chkconfig --level 35 jenkins on</div></pre></td></tr></table></figure><p>访问路径 <a href="http://192.168.6.102:8080" target="_blank" rel="external">http://192.168.6.102:8080</a><br>默认密码存在这个文件中 /var/lib/jenkins/secrets/initialAdminPassword<br><img src="/images/2017/0427/01.png" alt="jenkins"><br>创建一个管理用户<br><img src="/images/2017/0427/02.png" alt="jenkins"><br><img src="/images/2017/0427/03.png" alt="jenkins"></p><h2 id="Jenkins-配置"><a href="#Jenkins-配置" class="headerlink" title="Jenkins 配置"></a>Jenkins 配置</h2><h2 id="安装maven"><a href="#安装maven" class="headerlink" title="安装maven"></a>安装maven</h2><p>jdk下载地址： <a href="http://apache.mirrors.lucidnetworks.net/maven/maven-3/" target="_blank" rel="external">http://apache.mirrors.lucidnetworks.net/maven/maven-3/</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tar xf apache-maven-3.3.9-bin.tar.gz -C /usr/local/</div></pre></td></tr></table></figure></p><p>配置maven环境变量<br>vim /etc/profile<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">export JAVA_HOME=/usr/local/jdk1.8.0_112</div><div class="line">export CLASSPATH=.:$JAVA_HOME/lib/:$JAVA_HOME/jre/lib/</div><div class="line">export M3_HOME=/usr/local/apache-maven-3.3.9</div><div class="line">export PATH=$JAVA_HOME/bin:$PATH:$M3_HOME/bin</div></pre></td></tr></table></figure></p><h2 id="全局工具配置"><a href="#全局工具配置" class="headerlink" title="全局工具配置"></a>全局工具配置</h2><p>点击系统配置-Global Tool Configuration<br><img src="/images/2017/0427/04.png" alt="jenkins"><br>针对项目中使用的jdk和maven情况添加对应的版本<br><img src="/images/2017/0427/05.png" alt="jenkins"></p><h2 id="插件安装配置"><a href="#插件安装配置" class="headerlink" title="插件安装配置"></a>插件安装配置</h2><p>点击系统配置-插件管理<br><img src="/images/2017/0427/06.png" alt="jenkins"></p><ul><li>可选插件直接安装<br>右上角的过滤功能很好用，可以直接搜索安装<br>安装以下插件<br>Hudson SCP publisher plugin<br>Deploy to container Plugin<br>Maven Integration plugin<br>Publish Over SSH<br>Publish Over CIFS<br>Backup plugin / ThinBackup<br>Email Ext Recipients Column Plugin<br>Localization: Chinese (Simplified)</li><li>高级选项中上传插件安装<br><a href="http://mirrors.jenkins-ci.org/plugins/" target="_blank" rel="external">http://mirrors.jenkins-ci.org/plugins/</a><br>安装完插件之后，建议重启一下jenkins，防止插件未加载上，不生效；</li></ul><h1 id="发布一个静态网站"><a href="#发布一个静态网站" class="headerlink" title="发布一个静态网站"></a>发布一个静态网站</h1><h2 id="配置Hudson-SCP-publisher-plugin插件"><a href="#配置Hudson-SCP-publisher-plugin插件" class="headerlink" title="配置Hudson SCP publisher plugin插件"></a>配置Hudson SCP publisher plugin插件</h2><p>此插件用于发布静态网站，拷贝文件很方便<br><img src="/images/2017/0427/07.png" alt="jenkins"><br>配置需要发布的服务器hostname，端口，路径，用户名，密码（如果是正式环境，不建议使用root用户）</p><blockquote><p>ps:这里有个小技巧，如果这台机器上有多个静态网站目录的话，可以在服务器设置多个hosts记录，这里使用主机名来分区不同的路径</p></blockquote><h2 id="新建一个软件项目test"><a href="#新建一个软件项目test" class="headerlink" title="新建一个软件项目test"></a>新建一个软件项目test</h2><p><img src="/images/2017/0427/08.png" alt="jenkins"><br>源码管理：<br>填写svn路径<br>有获取代码权限的用户名密码<br><img src="/images/2017/0427/09.png" alt="jenkins"><br>构建后操作：<br>选择需要scp的路径<br>Source ** 表示所有<br>Keep Hierarchy  保持目录结构（否则不能拷贝文件夹）<br><img src="/images/2017/0427/10.png" alt="jenkins"><br>点击立即构建<br><img src="/images/2017/0427/11.png" alt="jenkins"><br>通过 Console Output可以看到详细日志<br><img src="/images/2017/0427/12.png" alt="jenkins"><br>至此，一个静态网站就发布完成了！</p><h1 id="发布一个java后台工程"><a href="#发布一个java后台工程" class="headerlink" title="发布一个java后台工程"></a>发布一个java后台工程</h1><h2 id="安装Deploy-to-container-Plugin插件"><a href="#安装Deploy-to-container-Plugin插件" class="headerlink" title="安装Deploy to container Plugin插件"></a>安装Deploy to container Plugin插件</h2><p>此插件可以将war/ear 包发布到tomcat，glassfish，jetty，weblogic等中间件上</p><h2 id="配置tomcat-web管理"><a href="#配置tomcat-web管理" class="headerlink" title="配置tomcat web管理"></a>配置tomcat web管理</h2><p>vim /usr/local/apache-tomcat-7.0.77/conf/tomcat-users.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;role rolename=&quot;tomcat&quot;/&gt;</div><div class="line">&lt;role rolename=&quot;role1&quot;/&gt;</div><div class="line">&lt;role rolename=&quot;manager-gui&quot;/&gt;</div><div class="line">&lt;role rolename=&quot;manager-gui,manager-script,manager-jmx,manager-status&quot;/&gt;</div><div class="line">&lt;user username=&quot;tomcat&quot; password=&quot;tomcat&quot; roles=&quot;manager-gui&quot;/&gt;</div><div class="line">&lt;user username=&quot;admin&quot; password=&quot;admin&quot; roles=&quot;manager-gui,manager-script,manager-jmx,manager-status&quot;/&gt;</div></pre></td></tr></table></figure></p><p>由于jenkins把8080端口占用，我这里修改tomcat端口为8081<br>vim /usr/local/apache-tomcat-7.0.77/conf/server.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;Connector port=&quot;8081&quot; protocol=&quot;HTTP/1.1&quot;</div></pre></td></tr></table></figure></p><p>tomcat8之后的版本，为了安全，默认只有本机可以访问管理控制台，因此需要修改$TOMCAT/webapp/manager/META-INF和$TOMCAT/webapp/host-manager/META-INF目录下的content.xml<br>修改<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;Valve className=&quot;org.apache.catalina.valves.RemoteAddrValve&quot;</div><div class="line">         allow=&quot;127\.\d+\.\d+\.\d+|::1|0:0:0:0:0:0:0:1&quot; /&gt;</div></pre></td></tr></table></figure></p><p>为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;Valve className=&quot;org.apache.catalina.valves.RemoteAddrValve&quot;</div><div class="line">         allow=&quot;\d+\.\d+\.\d+\.\d+|::1|0:0:0:0:0:0:0:1&quot; /&gt;</div></pre></td></tr></table></figure></p><h2 id="一个简单的maven工程代码"><a href="#一个简单的maven工程代码" class="headerlink" title="一个简单的maven工程代码"></a>一个简单的maven工程代码</h2><p><a href="https://github.com/nsxq/hello-world-war" target="_blank" rel="external">https://github.com/nsxq/hello-world-war</a></p><h2 id="maven-的简单使用"><a href="#maven-的简单使用" class="headerlink" title="maven 的简单使用"></a>maven 的简单使用</h2><p>查看版本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn -version</div></pre></td></tr></table></figure></p><p>查看详细信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn X</div></pre></td></tr></table></figure></p><p>测试<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn test</div></pre></td></tr></table></figure></p><p>清理（target目录下的编译内容）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn clean</div></pre></td></tr></table></figure></p><p>编译项目<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn compile</div></pre></td></tr></table></figure></p><p>打包发布<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn package</div></pre></td></tr></table></figure></p><p>生成eclipse项目文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn eclipse:eclipse</div></pre></td></tr></table></figure></p><p>产生site<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn site</div></pre></td></tr></table></figure></p><p>安装当前工程的jar安装到本地仓库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn install</div></pre></td></tr></table></figure></p><p>安装jar包到本地仓库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn install:install-file -DgroupId=com.oracle -DartifactId=ojdbc14 -Dversion=10.2.0.4.0 -Dpackaging=jar -Dfile=/usr/local/src/ojdbc14-10.2.0.4.0.jar</div></pre></td></tr></table></figure></p><p>分析项目的依赖信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn dependency:analyze / mvn dependency:tree</div></pre></td></tr></table></figure></p><h2 id="新建一个maven工程"><a href="#新建一个maven工程" class="headerlink" title="新建一个maven工程"></a>新建一个maven工程</h2><p>获取代码<br><img src="/images/2017/0427/14.png" alt="jenkins"><br>编译参数<br><img src="/images/2017/0427/15.png" alt="jenkins"><br>构建后发布<br><img src="/images/2017/0427/16.png" alt="jenkins"><br>点击立即构建<br>查看日志，已经发布完成了<br><img src="/images/2017/0427/17.png" alt="jenkins"><br>访问项目<br><a href="http://192.168.6.102:8081/hello" target="_blank" rel="external">http://192.168.6.102:8081/hello</a><br><img src="/images/2017/0427/18.png" alt="jenkins"><br>至此，一个maven工程已经实现自动化编译、打包、发布！</p><h1 id="版本回退"><a href="#版本回退" class="headerlink" title="版本回退"></a>版本回退</h1><p>有时候发布一个新版本失败或发布有问题，我们需要回滚到指定版本的构建，这样才能更灵活的进行项目的构建部署。我们可以选择“参数化的构建过程”进行传递不同的参数来选择是进行新的构建还是退</p><h2 id="对文件进行存档"><a href="#对文件进行存档" class="headerlink" title="对文件进行存档"></a>对文件进行存档</h2><p>为了能够进行版本回退，构建完成的需要对文件进行存档<br><img src="/images/2017/0427/19.png" alt="jenkins"></p><h2 id="使用参数化构建过程"><a href="#使用参数化构建过程" class="headerlink" title="使用参数化构建过程"></a>使用参数化构建过程</h2><p>让后面的脚步可以根据不同的变量执行不同的操作。添加“Choice”参数配置不同的选项，让选择发布还是回滚，添加“String Parameter”参数来传递要回退的版本号。<br><img src="/images/2017/0427/20.png" alt="jenkins"></p><h2 id="构建选择“Execute-Shell”的方式"><a href="#构建选择“Execute-Shell”的方式" class="headerlink" title="构建选择“Execute Shell”的方式"></a>构建选择“Execute Shell”的方式</h2><p>自己根据变量，自定义构建的脚本，此时如果是发布安装maven的构建过程进行新的构建，如果是回滚，知道历史构建后的文件，复制到当前构建结果目录。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">case $deploy_env in</div><div class="line">deploy)</div><div class="line">    echo &quot;deploy:$deploy_env&quot;</div><div class="line">        mvn clean test compile install package</div><div class="line">        ;;</div><div class="line">    rollback)</div><div class="line">    echo &quot;rollback:$deploy_env&quot;</div><div class="line">        echo &quot;version: $version&quot;</div><div class="line">        rm -fr target/hello-1.war</div><div class="line">        cp -R $&#123;JENKINS_HOME&#125;/jobs/myapp/builds/$&#123;version&#125;/com.efsavage\$hello/archive/com.efsavage/hello/1/hello-1.war .</div><div class="line">        pwd &amp;&amp; ls</div><div class="line">        ;;</div><div class="line">*)</div><div class="line">    exit</div><div class="line">    ;;</div><div class="line">esac</div></pre></td></tr></table></figure></p><h2 id="执行回退操作"><a href="#执行回退操作" class="headerlink" title="执行回退操作"></a>执行回退操作</h2><p>点击构建，根据不同的参数选择发布还是版本回退，回退的时候填写要回退到的历史版本号<br><img src="/images/2017/0427/21.png" alt="jenkins"><br><img src="/images/2017/0427/22.png" alt="jenkins"></p><p>PS: Tomcat8配置web管理后，Tomcat访问 manager页面 报403的解决办法：<a href="https://blog.52itstyle.com/archives/274/" target="_blank" rel="external">https://blog.52itstyle.com/archives/274/</a></p>]]></content>
      
      
      <categories>
          
          <category> 自动化运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 运维 </tag>
            
            <tag> 自动化 </tag>
            
            <tag> Jenkins </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>使用 Cobbler 自动化和管理系统安装</title>
      <link href="/arlo/bb0f7c70/"/>
      <url>/arlo/bb0f7c70/</url>
      
        <content type="html"><![CDATA[<p>Cobbler是一套快速搭建网络自动化安装操作系统的软件，个人感觉是PXE的升级版;提供cli和web两种管理方式，还提供API接口<br><a id="more"></a><br>系统环境：<br>Centos7_x64<br>Iptables off<br>Selinux  disabled</p><h1 id="Cobbler对象类型"><a href="#Cobbler对象类型" class="headerlink" title="Cobbler对象类型"></a>Cobbler对象类型</h1><p><strong>发行版（distro）</strong>：表示一个操作系统。它承载了内核和 initrd 的信息，以及内核参数等其他数据。<br><strong>配置文件（profile）</strong>：包含一个发行版、一个 kickstart 文件以及可能的存储库，还包含更多特定的内核参数等其他数据。<br><strong>系统（system）</strong>：表示要配给的机器。它包含一个配置文件或一个镜像，还包含 IP 和 MAC 地址、电源管理（地址、凭据、类型）以及更为专业的数据等信息。<br><strong>存储库（repository）</strong>：保存一个 yum 或 rsync 存储库的镜像信息。<br><strong>镜像（image）</strong>：可替换一个包含不属于此类别的文件的发行版对象（例如，无法分为内核和 initrd 的对象）。<br>基于注册的对象以及各个对象之间的关联，Cobbler 知道如何更改文件系统以反映具体配置。因为系统配置的内部是抽象的，所以您可以仅关注想要执行的操作。<br><img src="/images/2017/0420/00.png" alt="cobbler"></p><h1 id="Cobbler安装"><a href="#Cobbler安装" class="headerlink" title="Cobbler安装"></a>Cobbler安装</h1><h2 id="安装系统扩展包"><a href="#安装系统扩展包" class="headerlink" title="安装系统扩展包"></a>安装系统扩展包</h2><p>安装后报错可以参考<br><a href="http://islocal.cc/2017/04/06/yum-安装epel扩展后报错/">http://islocal.cc/2017/04/06/yum-安装epel扩展后报错/</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install epel-release</div></pre></td></tr></table></figure></p><h2 id="安装需要的其他组件"><a href="#安装需要的其他组件" class="headerlink" title="安装需要的其他组件"></a>安装需要的其他组件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install rsync tftp httpd pykickstart xinetd</div></pre></td></tr></table></figure><h2 id="安装cobbler程序包和fence代理包"><a href="#安装cobbler程序包和fence代理包" class="headerlink" title="安装cobbler程序包和fence代理包"></a>安装cobbler程序包和fence代理包</h2><p>fence代理包是执行电源管理活动的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install cobbler fence-agents</div></pre></td></tr></table></figure></p><h2 id="启动cobbler-服务"><a href="#启动cobbler-服务" class="headerlink" title="启动cobbler 服务"></a>启动cobbler 服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">systemctl start cobblerd httpd</div></pre></td></tr></table></figure><h2 id="检查配置文件"><a href="#检查配置文件" class="headerlink" title="检查配置文件"></a>检查配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cobbler check</div></pre></td></tr></table></figure><p><img src="/images/2017/0420/01.png" alt="cobbler"></p><h3 id="Q1：修改cobbler服务器地址"><a href="#Q1：修改cobbler服务器地址" class="headerlink" title="Q1：修改cobbler服务器地址"></a>Q1：修改cobbler服务器地址</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">server: 192.168.6.103</div></pre></td></tr></table></figure><h3 id="Q2：修改dhcp服务器地址"><a href="#Q2：修改dhcp服务器地址" class="headerlink" title="Q2：修改dhcp服务器地址"></a>Q2：修改dhcp服务器地址</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">next_server: 192.168.6.103</div></pre></td></tr></table></figure><h3 id="Q3：修改-etc-selinux-config配置"><a href="#Q3：修改-etc-selinux-config配置" class="headerlink" title="Q3：修改/etc/selinux/config配置"></a>Q3：修改/etc/selinux/config配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SELINUX=disabled</div></pre></td></tr></table></figure><h3 id="Q4：修改-etc-xinetd-d-tftp-配置"><a href="#Q4：修改-etc-xinetd-d-tftp-配置" class="headerlink" title="Q4：修改/etc/xinetd.d/tftp 配置"></a>Q4：修改/etc/xinetd.d/tftp 配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">disable= no</div></pre></td></tr></table></figure><h3 id="Q5：下载需要的网络引导文件"><a href="#Q5：下载需要的网络引导文件" class="headerlink" title="Q5：下载需要的网络引导文件"></a>Q5：下载需要的网络引导文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cobbler get-loaders</div></pre></td></tr></table></figure><h3 id="Q6：启动并设置开机启动rsyncd服务"><a href="#Q6：启动并设置开机启动rsyncd服务" class="headerlink" title="Q6：启动并设置开机启动rsyncd服务"></a>Q6：启动并设置开机启动rsyncd服务</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">systemctl start rsyncd.service</div><div class="line">systemctl enable rsyncd.service</div></pre></td></tr></table></figure><h3 id="Q7：这个是基于debian操作系统的错误"><a href="#Q7：这个是基于debian操作系统的错误" class="headerlink" title="Q7：这个是基于debian操作系统的错误"></a>Q7：这个是基于debian操作系统的错误</h3><p>centos系统下忽略，不予处理</p><h3 id="Q8：修改安装系统后默认的root密码为’ffffff’"><a href="#Q8：修改安装系统后默认的root密码为’ffffff’" class="headerlink" title="Q8：修改安装系统后默认的root密码为’ffffff’"></a>Q8：修改安装系统后默认的root密码为’ffffff’</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">openssl passwd -1 -salt &apos;random123&apos; &apos;ffffff&apos;</div><div class="line">vim /etc/cobbler/settings</div><div class="line">default_password_crypted: &quot;$1$random12$KuDtGsOHnRfzasr7D4qI40&quot;</div></pre></td></tr></table></figure><h1 id="配置Cobbler"><a href="#配置Cobbler" class="headerlink" title="配置Cobbler"></a>配置Cobbler</h1><h2 id="编辑主配置文件"><a href="#编辑主配置文件" class="headerlink" title="编辑主配置文件"></a>编辑主配置文件</h2><p>vim /etc/cobbler/settings<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">manage_dhcp: 1   </div><div class="line">manage_dns: 1</div><div class="line">manage_tftpd: 1</div><div class="line">restart_dns: 1</div><div class="line">restart_dhcp: 1</div><div class="line">pxe_just_once: 1</div><div class="line">next_server: &lt;dhcp服务器地址，即本机&gt;</div><div class="line">server:&lt;cobbler 服务器地址&gt;</div></pre></td></tr></table></figure></p><p>以上部分选项之前已经配置或者默认选项已符合要求<br><strong>manage cobbler</strong>可以管理服务<br><strong>restart cobbler</strong> 可以重启服务<br><strong>pxe_just_once</strong> 预防将机器中的安装循环配置为始终从网络引导。激活此选项时，机器告诉 Cobbler 安装已完成</p><h2 id="指定cobbler管理服务使用的程序"><a href="#指定cobbler管理服务使用的程序" class="headerlink" title="指定cobbler管理服务使用的程序"></a>指定cobbler管理服务使用的程序</h2><p>vim /etc/cobbler/modules.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[dns]</div><div class="line">module = manage_dnsmasq</div><div class="line">[dhcp]</div><div class="line">module = manage_dnsmasq</div><div class="line">[tftpd]</div><div class="line">module = manage_in_tftpd</div></pre></td></tr></table></figure></p><h2 id="配置dhcp服务"><a href="#配置dhcp服务" class="headerlink" title="配置dhcp服务"></a>配置dhcp服务</h2><p>使用dnsmasq提供dns和dhcp服务<br>这里要保证dhcp设置的ip网段要和本机在同一网段，否则client找不到dhcp服务器</p><blockquote><p>通常，您希望阻止未注册的客户端从服务器引导。为此，添加参数 dhcp-ignore=tag:!known。（在以前的版本中，语法可能有所不同：dhcp-ignore=#known。如果有疑问，您可以同时插入两个版本。）</p></blockquote><p>vim /etc/cobbler/dnsmasq.template<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dhcp-range=192.168.6.200,192.168.6.210,255.255.255.0</div></pre></td></tr></table></figure></p><h2 id="同步cobbler数据"><a href="#同步cobbler数据" class="headerlink" title="同步cobbler数据"></a>同步cobbler数据</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cobbler sync</div></pre></td></tr></table></figure><h2 id="重启服务"><a href="#重启服务" class="headerlink" title="重启服务"></a>重启服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">systemctl restart httpd cobblerd xinetd rsyncd dnsmasq</div></pre></td></tr></table></figure><p>客户机从网络启动，可以看到已经可以获取到ip地址了<br><img src="/images/2017/0420/02.png" alt="cobbler"></p><h1 id="创建操作系统"><a href="#创建操作系统" class="headerlink" title="创建操作系统"></a>创建操作系统</h1><h2 id="创建一个发行版本"><a href="#创建一个发行版本" class="headerlink" title="创建一个发行版本"></a>创建一个发行版本</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mkdir /opt/centos6.9/</div><div class="line">mount -o loop /opt/CentOS-6.9-x86_64-bin-DVD1.iso /opt/centos6.9/</div><div class="line">cobbler import --path=/opt/centos6.9/ --name=&quot;Centos6.9&quot;</div></pre></td></tr></table></figure><p><img src="/images/2017/0420/03.png" alt="cobbler"></p><h2 id="查看发行版本"><a href="#查看发行版本" class="headerlink" title="查看发行版本"></a>查看发行版本</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cobbler distro list</div><div class="line">cobbler distro report</div></pre></td></tr></table></figure><p><img src="/images/2017/0420/04.png" alt="cobbler"></p><h2 id="查看配置文件"><a href="#查看配置文件" class="headerlink" title="查看配置文件"></a>查看配置文件</h2><p>可以看到这里默认的ks文件是sample_end.ks<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cobbler profile list</div><div class="line">cobbler profile report</div></pre></td></tr></table></figure></p><p><img src="/images/2017/0420/05.png" alt="cobbler"></p><h2 id="使用自定义ks文件"><a href="#使用自定义ks文件" class="headerlink" title="使用自定义ks文件"></a>使用自定义ks文件</h2><ul><li>使用图形化system-config-kickstart工具创建ks文件</li><li>使用系统生成的ks文件模板修改<br>kiskstart 文件内容<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div></pre></td><td class="code"><pre><div class="line"># kickstart template for Fedora 8 and later.</div><div class="line"># (includes %end blocks)</div><div class="line"># do not use with earlier distros</div><div class="line"></div><div class="line">#platform=x86, AMD64, or Intel EM64T</div><div class="line"># System authorization information</div><div class="line">auth  --useshadow  --enablemd5</div><div class="line"># System bootloader configuration</div><div class="line">bootloader --location=mbr</div><div class="line"># Partition clearing information</div><div class="line">clearpart --all --initlabel</div><div class="line"># Use text mode install</div><div class="line">text</div><div class="line"># Firewall configuration</div><div class="line">firewall --disable</div><div class="line"># Run the Setup Agent on first boot</div><div class="line">firstboot --disable</div><div class="line"># System keyboard</div><div class="line">keyboard us</div><div class="line"># System language</div><div class="line">lang en_US</div><div class="line"># Use network installation</div><div class="line">url --url=$tree</div><div class="line"># If any cobbler repo definitions were referenced in the kickstart profile, include them here.</div><div class="line">$yum_repo_stanza</div><div class="line"># Network information</div><div class="line">$SNIPPET(&apos;network_config&apos;)</div><div class="line"># Reboot after installation</div><div class="line">reboot</div><div class="line"></div><div class="line">#Root password</div><div class="line">rootpw --iscrypted $default_password_crypted</div><div class="line"># SELinux configuration</div><div class="line">selinux --disabled</div><div class="line"># Do not configure the X Window System</div><div class="line">skipx</div><div class="line"># System timezone</div><div class="line">timezone  Asia/Shanghai</div><div class="line"># Install OS instead of upgrade</div><div class="line">install</div><div class="line"># Clear the Master Boot Record</div><div class="line">zerombr</div><div class="line"># Allow anaconda to partition the system as needed</div><div class="line">autopart</div><div class="line"></div><div class="line">%pre</div><div class="line">$SNIPPET(&apos;log_ks_pre&apos;)</div><div class="line">$SNIPPET(&apos;kickstart_start&apos;)</div><div class="line">$SNIPPET(&apos;pre_install_network_config&apos;)</div><div class="line"># Enable installation monitoring</div><div class="line">$SNIPPET(&apos;pre_anamon&apos;)</div><div class="line">%end</div><div class="line"></div><div class="line">%packages</div><div class="line">$SNIPPET(&apos;func_install_if_enabled&apos;)</div><div class="line">@base</div><div class="line">@development</div><div class="line">%end</div><div class="line"></div><div class="line">%post --nochroot</div><div class="line">$SNIPPET(&apos;log_ks_post_nochroot&apos;)</div><div class="line">%end</div><div class="line"></div><div class="line">%post</div><div class="line">$SNIPPET(&apos;log_ks_post&apos;)</div><div class="line"># Start yum configuration</div><div class="line">$yum_config_stanza</div><div class="line"># End yum configuration</div><div class="line">$SNIPPET(&apos;post_install_kernel_options&apos;)</div><div class="line">$SNIPPET(&apos;post_install_network_config&apos;)</div><div class="line">$SNIPPET(&apos;func_register_if_enabled&apos;)</div><div class="line">$SNIPPET(&apos;download_config_files&apos;)</div><div class="line">$SNIPPET(&apos;koan_environment&apos;)</div><div class="line">$SNIPPET(&apos;redhat_register&apos;)</div><div class="line">$SNIPPET(&apos;cobbler_register&apos;)</div><div class="line"># Enable post-install boot notification</div><div class="line">$SNIPPET(&apos;post_anamon&apos;)</div><div class="line"># Start final steps</div><div class="line">$SNIPPET(&apos;kickstart_done&apos;)</div><div class="line"># End final steps</div><div class="line">%end</div></pre></td></tr></table></figure></li></ul><h3 id="添加一个profile"><a href="#添加一个profile" class="headerlink" title="添加一个profile"></a>添加一个profile</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cobbler profile add --distro=&quot;Centos6.9-x86_64&quot; --name=centos6.9_customized \</div><div class="line">--kickstart=/var/lib/cobbler/kickstarts/CentOS6.9_cust.cfg</div></pre></td></tr></table></figure><p>###　修改已有的profile<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cobbler profile edit --name=centos6.9_customized --kickstart=/var/lib/cobbler/kickstarts/CentOS6.9_cust.cfg</div></pre></td></tr></table></figure></p><h2 id="添加第三方yum仓库"><a href="#添加第三方yum仓库" class="headerlink" title="添加第三方yum仓库"></a>添加第三方yum仓库</h2><p>这一步好像有点问题会报错，网上资料说这是一个bug<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cobbler repo add --name=163mirrors --mirror=http://mirrors.163.com/centos/6.9/os/x86_64/</div><div class="line">cobbler reposync</div><div class="line">cobbler repo report</div></pre></td></tr></table></figure></p><p>将仓库文件与配置文件（profile）关联起来<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cobbler profile edit --name=Centos6.9-x86_64 --repos=163mirros</div></pre></td></tr></table></figure></p><h1 id="安装web管理界面"><a href="#安装web管理界面" class="headerlink" title="安装web管理界面"></a>安装web管理界面</h1><h2 id="安装cobbler-web包"><a href="#安装cobbler-web包" class="headerlink" title="安装cobbler-web包"></a>安装cobbler-web包</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install cobbler-web</div></pre></td></tr></table></figure><h2 id="Cobbler-Web-界面的身份验证和授权配置"><a href="#Cobbler-Web-界面的身份验证和授权配置" class="headerlink" title="Cobbler Web 界面的身份验证和授权配置"></a>Cobbler Web 界面的身份验证和授权配置</h2><p>/etc/cobbler/modules.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[authentication]</div><div class="line">module = authn_pam</div><div class="line">[authorization] = authz_ownership</div></pre></td></tr></table></figure></p><h2 id="新建系统账号并设置密码"><a href="#新建系统账号并设置密码" class="headerlink" title="新建系统账号并设置密码"></a>新建系统账号并设置密码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">useradd cobbler </div><div class="line">echo &quot;cobbler&quot; | passwd --stdin cobbler</div></pre></td></tr></table></figure><h2 id="添加用户到管理组"><a href="#添加用户到管理组" class="headerlink" title="添加用户到管理组"></a>添加用户到管理组</h2><p>vim /etc/cobbler/users.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[admins]</div><div class="line">admin = &quot;cobbler&quot;</div></pre></td></tr></table></figure></p><h2 id="重启服务-1"><a href="#重启服务-1" class="headerlink" title="重启服务"></a>重启服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">systemctl restart cobblerd httpd</div></pre></td></tr></table></figure><h2 id="使用https-url访问"><a href="#使用https-url访问" class="headerlink" title="使用https url访问"></a>使用https url访问</h2><p><a href="https://192.168.6.103/cobbler_web" target="_blank" rel="external">https://192.168.6.103/cobbler_web</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">user：cobbler</div><div class="line">passwd：cobbler</div></pre></td></tr></table></figure></p><p><img src="/images/2017/0420/06.png" alt="cobbler"></p><h1 id="安装操作系统"><a href="#安装操作系统" class="headerlink" title="安装操作系统"></a>安装操作系统</h1><ol><li>开机</li><li>选择从网络引导，dhcp获取ip地址</li><li>选择profile，通过tftp获取引导内核文件</li><li>调用ks文件进行无人值守安装操作系统<br><img src="/images/2017/0420/07.png" alt="cobbler"></li></ol><h1 id="重装操作系统"><a href="#重装操作系统" class="headerlink" title="重装操作系统"></a>重装操作系统</h1><p>这个是针对已经安装操作系统的服务器进行重新安装，个人感觉这种方式除了不用调整从网络启动之外，没看出来比较实用的特性</p><h2 id="在客户端机器安装koan软件"><a href="#在客户端机器安装koan软件" class="headerlink" title="在客户端机器安装koan软件"></a>在客户端机器安装koan软件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">yum -y install epel</div><div class="line">yum -y install koan</div></pre></td></tr></table></figure><h2 id="Koan-用法"><a href="#Koan-用法" class="headerlink" title="Koan 用法"></a>Koan 用法</h2><p>查看cobbler server 上的profile文件列表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">koan --server=192.168.6.250 --list=profiles</div></pre></td></tr></table></figure></p><p>查看profile详细信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">koan --server=192.168.6.250 --display --profile=Centos6.9-x86_64</div></pre></td></tr></table></figure></p><p>下次重启时重装操作系统<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">koan --server=192.168.6.250 -replace-self --profile=Centos6.9-x86_64</div><div class="line">reboot</div></pre></td></tr></table></figure></p><h1 id="安装windows操作系统"><a href="#安装windows操作系统" class="headerlink" title="安装windows操作系统"></a>安装windows操作系统</h1><h2 id="制作PE-iso镜像"><a href="#制作PE-iso镜像" class="headerlink" title="制作PE iso镜像"></a>制作PE iso镜像</h2><p>下载一个<strong><a href="http://www.wepe.com.cn/" target="_blank" rel="external">PE系统</a></strong><br>上传至cobbler服务器/data目录</p><h2 id="创建一个distro"><a href="#创建一个distro" class="headerlink" title="创建一个distro"></a>创建一个distro</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cobbler distro add --name=&quot;WePe_x64&quot; --kernel=/var/lib/tftpboot/memdisk --initrd=/data/WePE_64_V2.0.iso --kopts=&quot;raw iso&quot;</div></pre></td></tr></table></figure><h2 id="创建空白kickstart文件，并对winPE发行版添加profile"><a href="#创建空白kickstart文件，并对winPE发行版添加profile" class="headerlink" title="创建空白kickstart文件，并对winPE发行版添加profile"></a>创建空白kickstart文件，并对winPE发行版添加profile</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">touch /var/lib/cobbler/kickstarts/WePe_x64.xml</div><div class="line">cobbler profile add --name=WePe_x64 --distro=WePe_x64 --kickstart=/var/lib/cobbler/kickstarts/WePe_x64.xml</div></pre></td></tr></table></figure><h2 id="同步cobbler"><a href="#同步cobbler" class="headerlink" title="同步cobbler"></a>同步cobbler</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cobbler sync</div></pre></td></tr></table></figure><p>windows 操作系统安装这个，目前只是做了一个网络版的PE，网上有教程说使用samba共享镜像，我这里没有成功，可以参考<strong><a href="http://www.zhouweiping.cn/index.php/archives/30/#windows系统安装" target="_blank" rel="external">这篇文章</a></strong>;到这里一个最基本的cobbler自动化安装操作系统的环境就搭建完成了，只是完成了distro和profile部分，后期在学习system部分。</p><p>参考资料：<br><a href="https://www.ibm.com/developerworks/cn/linux/l-cobbler/" target="_blank" rel="external">https://www.ibm.com/developerworks/cn/linux/l-cobbler/</a><br><a href="http://blog.codecp.org/2016/11/02/Centos7部署cobbler/" target="_blank" rel="external">http://blog.codecp.org/2016/11/02/Centos7部署cobbler/</a></p><hr>]]></content>
      
      
      <categories>
          
          <category> 自动化运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 运维 </tag>
            
            <tag> 自动化 </tag>
            
            <tag> Cobbler </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>WRF模型学习（1）--安装篇</title>
      <link href="/arlo/7943f5da/"/>
      <url>/arlo/7943f5da/</url>
      
        <content type="html"><![CDATA[<h1 id="WRF简介"><a href="#WRF简介" class="headerlink" title="WRF简介"></a>WRF简介</h1><p>WRF全称Weather Research and Forecasting Model, 是一个先进的大气建模系统，专为气象研究和数值天气预报而设计。它为大气过程提供了许多选项，可以在各种计算平台上运行。WRF在数千米到数千公里范围内的应用范围广泛，包括以下内容。</p><ul><li>气象研究</li><li>实时NWP </li><li>理想模拟</li><li>数据同化</li><li>地球系统模型耦合</li><li>示范训练和教育支持</li></ul><p>官方网站：<br><a href="http://www.wrf-model.org/index.php" target="_blank" rel="external">http://www.wrf-model.org/index.php</a><br><a href="https://www2.ucar.edu/" target="_blank" rel="external">https://www2.ucar.edu/</a><br><a href="https://zh.wikipedia.org/wiki/NetCDF" target="_blank" rel="external">https://zh.wikipedia.org/wiki/NetCDF</a><br><a id="more"></a></p><h1 id="系统环境"><a href="#系统环境" class="headerlink" title="系统环境"></a>系统环境</h1><p>VMware Wrokstation 12 pro<br>CentOS 6.4 x64</p><h1 id="软件环境"><a href="#软件环境" class="headerlink" title="软件环境"></a>软件环境</h1><p>zlib-1.2.11.tar.gz<br>hdf5-1.8.18.tar<br>netcdf-4.4.1.1.tar.gz<br>netcdf-fortran-4.4.4.tar.gz<br>pgilinux-2016-1610-x86_64.tar.gz<br>WRFV3.8.1.TAR.gz<br>WPSV3.8.1.TAR.gz</p><h1 id="WRF-模型安装"><a href="#WRF-模型安装" class="headerlink" title="WRF 模型安装"></a>WRF 模型安装</h1><p>安装WRF模型的的顺序为：WRF–&gt;WPS–&gt;WRF-chem等<br>WRF模拟系统主要包含WPS和WRF两部分模块： WPS模块全称为WRF Pre-processing System，即WRF预处理系统，用来为WRF模型准备输入数据；如果只是做理想实验(idealized modeling)，就不需要用WPS处理真实数据。<br>WRF模块就是数值求解的模块，它有两个版本：ARW(Advanced Research WRF) 和 NMM(Nonhydrostatic Mesoscale Model)。大多数研究者主要用的都是ARW版本。 除了WPS与WRF两大核心模块外，WRF系统还有很多附加模块：比如用于数据同化的WRF-DA，用于化学传输的WRF-chem，用于林火模拟的WRF-fire。</p><h1 id="安装依赖zlib"><a href="#安装依赖zlib" class="headerlink" title="安装依赖zlib"></a>安装依赖zlib</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># tar xf zlib-1.2.11.tar.gz</div><div class="line"># cd zlib-1.2.11</div><div class="line"># ./configure --prefix=/usr/local/zlib/</div><div class="line"># make &amp;&amp; make install</div></pre></td></tr></table></figure><h1 id="安装依赖hdf5"><a href="#安装依赖hdf5" class="headerlink" title="安装依赖hdf5"></a>安装依赖hdf5</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># tar xf hdf5-1.8.18.tar</div><div class="line"># cd hdf5-1.8.18</div><div class="line">#./configure --prefix=/usr/local/hdf5/ --with-zlib=/usr/local/zlib/</div><div class="line"># make &amp;&amp; make install</div></pre></td></tr></table></figure><h1 id="安装依赖netcdf"><a href="#安装依赖netcdf" class="headerlink" title="安装依赖netcdf"></a>安装依赖netcdf</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># tar xf netcdf-4.4.1.1.tar.gz</div><div class="line"># cd netcdf-4.4.1.1</div><div class="line"># ./configure --prefix=/usr/local/netcdf/ --enable-netcdf-4 LDFLAGS=&quot;-L/usr/local/hdf5/lib/&quot; CPPFLAGS=&quot;-I/usr/local/hdf5/include/&quot;</div><div class="line"># make &amp;&amp; make install</div></pre></td></tr></table></figure><h1 id="安装依赖netcdf-fortran"><a href="#安装依赖netcdf-fortran" class="headerlink" title="安装依赖netcdf-fortran"></a>安装依赖netcdf-fortran</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># tar xf netcdf-fortran-4.4.4.tar.gz </div><div class="line"># cd netcdf-fortran-4.4.4</div><div class="line"># ./configure --prefix=/usr/local/netcdf/ LDFLAGS=&quot;-L/usr/local/netcdf/lib&quot; CPPFLAGS=&quot;-I/usr/local/netcdf/include&quot; FC=gfortran</div><div class="line"># make &amp;&amp; make install</div></pre></td></tr></table></figure><p>此步骤中报错可以查看日志文件config.log 进行解决<br>我遇到的问题configure: error: cannot compute sizeof (off_t)，最终是设置了环境变量解决的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">export LDFLAGS=&quot;-L/usr/local/netcdf/lib/&quot;</div><div class="line">export CPPFLAGS=&quot;-I/usr/local/netcdf/include/&quot;</div><div class="line">export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/netcdf/lib/</div></pre></td></tr></table></figure></p><h1 id="安装WRF模型"><a href="#安装WRF模型" class="headerlink" title="安装WRF模型"></a>安装WRF模型</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># tar xf WRFV3.8.1.TAR.gz </div><div class="line"># cd WRFV3</div><div class="line"># export NETCDF=/usr/local/netcdf/</div><div class="line"># ./configure</div></pre></td></tr></table></figure><p>这里我选择的32，使用gfortran/gcc编译。<br><img src="/images/2017/0406/01.png" alt="插入图片01"><br><strong>serial</strong> 表示串行计算；<br><strong>smpar</strong> 表示内存共享并行计算(shared memory option)，即使用openMP，大部分多核电脑都支持这项功能；<br><strong>dmpar</strong> 表示分布式并行计算(distributed memory option)，即使用MPI 进行并行计算，主要用在计算集群，单个电脑就没必要用了；<br><strong>dm+sm</strong> 表示同时使用openMP与MPI两种并行方式.</p><p>如果使用pgi（选择1）编译的话，需要自行安装pgilinux包，否则会报错”pgf90: Command not found.”<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># ./compile em_real &gt;&amp; compile.log</div></pre></td></tr></table></figure></p><p>编译类型有以下几种<br>WRF-Chem（WRF大气化学模型）<br>em_real （3D真实情况）<br>em_quarter_ss （3D理想的情况下）<br>em_b_wave （3D理想的情况下）<br>em_les （3D理想的情况下）<br>em_heldsuarez （3D理想的情况下）<br>em_tropical_cyclone （3D理想的情况下）<br>em_hill2d_x （2D理想的情况下）<br>em_squall2d_x （2D理想的情况下）<br>em_squall2d_y （ 2d理想情况）<br>em_grav2d_x （2d理想情况）<br>em_seabreeze2d_x （2d理想情况）<br>em_scm_xy （1d理想情况）</p><p>真实情况编译完成后，在main目录下会出现ndown.exe,real.exe, tc.exe, wrf.exe这4个可执行程序；理想情况编译后会生成wrf.exe，ideal.exe 这2个可执行程序。</p><h1 id="安装WPS模型"><a href="#安装WPS模型" class="headerlink" title="安装WPS模型"></a>安装WPS模型</h1><p>要保证WPS和WRFV3在同级目录，configure.wps文件中有相对路径<br>安装依赖包<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># yum -y install libpng libpng-devel jasper jasper-devel libjpeg libjpeg-devel</div><div class="line"># export COMPRESSION_LIBS=-L/usr/lib64/</div><div class="line"># export COMPRESSION_INC=-I/usr/lib64/</div><div class="line"># tar xf WPSV3.8.1.TAR.gz</div><div class="line"># cd WPS</div><div class="line"># ./configure</div></pre></td></tr></table></figure></p><p><img src="/images/2017/0406/02.png" alt="插入图片02"><br>这里选择1即可<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># ./compile</div></pre></td></tr></table></figure></p><p>编译完成后再当前目录下会出现geogrid.exe、metgrid.exe、ungrib.exe 三个可执行程序<br><img src="/images/2017/0406/03.png" alt="插入图片03"><br>到这里WRF模型的安装工作就已经完成了，第一次安装，记录一下!</p><p>参考链接：<br><a href="https://xg1990.com/blog/archives/190" target="_blank" rel="external">https://xg1990.com/blog/archives/190</a><br><a href="http://www2.mmm.ucar.edu/wrf/OnLineTutorial/compilation_tutorial.php" target="_blank" rel="external">http://www2.mmm.ucar.edu/wrf/OnLineTutorial/compilation_tutorial.php</a></p>]]></content>
      
      
      <categories>
          
          <category> 大气模型 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WRF </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>yum 安装epel扩展后报错</title>
      <link href="/arlo/ef6f2f28/"/>
      <url>/arlo/ef6f2f28/</url>
      
        <content type="html"><![CDATA[<p>安装epel扩展后出现的几个问题<br><a id="more"></a></p><h1 id="A1："><a href="#A1：" class="headerlink" title="A1："></a>A1：</h1><p>Error: Cannot retrieve metalink for repository: epel. Please verify its path and try again<br>编辑/etc/yum.repo/epel.repo文件,<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#baseurl</div><div class="line">mirrorlist</div><div class="line">改成</div><div class="line">baseurl</div><div class="line">#mirrorlist</div></pre></td></tr></table></figure></p><h1 id="A2"><a href="#A2" class="headerlink" title="A2:"></a>A2:</h1><p>PYCURL ERROR 7 - “Failed to connect to 2001:4178:5:200::10: Network is unreachable”<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">vim /etc/yum.conf</div><div class="line">[main]</div><div class="line">ip_resolve=4</div></pre></td></tr></table></figure></p><h1 id="A3"><a href="#A3" class="headerlink" title="A3:"></a>A3:</h1><p>[Errno 14] problem making ssl connection<br>[Errno 14] PYCURL ERROR 7 - Failed to connect to 2605:bc80:3010:600:dead:beef:cafe:fed9: Network is unreachable<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">yum install ca-certificates -y</div><div class="line">yum clean all</div><div class="line">yum list</div></pre></td></tr></table></figure></p><p>A4：<br>There are unfinished transactions remaining. You might consider running yum-complete-transaction, or “yum-complete-transaction –cleanup-only” and “yum history redo last”, first to finish them. If those don’t work you’ll have to try removing/installing packages by hand (maybe package-cleanup can help).<br>The program yum-complete-transaction is found in the yum-utils package.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">yum install yum-utils</div><div class="line">yum-complete-transaction --cleanup-only</div><div class="line">package-cleanup --dupes</div><div class="line">package-cleanup --problems</div></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> Troubleshooting </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 常识 </tag>
            
            <tag> epel </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>MPICHI3 并行计算环境搭建</title>
      <link href="/arlo/undefined/"/>
      <url>/arlo/undefined/</url>
      
        <content type="html"><![CDATA[<p>新工作接触到HPC高性能计算项目，最近看了一些HPC高性能计算的理论资料，今天搭建MPICHI 并行计算环境，算是开始HPC的学习之路吧！<br><a id="more"></a></p><h1 id="系统环境"><a href="#系统环境" class="headerlink" title="系统环境"></a>系统环境</h1><p>CentOS 6_x64</p><h2 id="设置hosts"><a href="#设置hosts" class="headerlink" title="设置hosts"></a>设置hosts</h2><p>vim /etc/hosts<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">192.168.6.100 vm00</div><div class="line">192.168.6.101 vm01</div><div class="line">192.168.6.102 vm02</div></pre></td></tr></table></figure></p><h2 id="新建用户"><a href="#新建用户" class="headerlink" title="新建用户"></a>新建用户</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># useradd -u 600 pxb</div><div class="line"># echo ffffff|passwd --stdin pxb</div></pre></td></tr></table></figure><h2 id="配置机器ssh无密码连接"><a href="#配置机器ssh无密码连接" class="headerlink" title="配置机器ssh无密码连接"></a>配置机器ssh无密码连接</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># su - pxb</div><div class="line">$ ssh-keygen 默认一直回车</div><div class="line">$ ssh-copy-id vm00</div><div class="line">$ ssh-copy-id vm01</div><div class="line">$ ssh-copy-id vm02</div><div class="line">$ ssh vm00</div><div class="line">$ ssh vm01</div><div class="line">$ ssh vm03</div></pre></td></tr></table></figure><h1 id="安装MPICHI（三台服务器上执行以下相同操作）"><a href="#安装MPICHI（三台服务器上执行以下相同操作）" class="headerlink" title="安装MPICHI（三台服务器上执行以下相同操作）"></a>安装MPICHI（三台服务器上执行以下相同操作）</h1><h2 id="获取mpichi"><a href="#获取mpichi" class="headerlink" title="获取mpichi"></a>获取mpichi</h2><p><a href="https://www.mpich.org/downloads/" target="_blank" rel="external">https://www.mpich.org/downloads/</a></p><h2 id="安装配置MPICHI"><a href="#安装配置MPICHI" class="headerlink" title="安装配置MPICHI"></a>安装配置MPICHI</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># tar -xf mpich-3.2.tar.gz</div><div class="line"># cd mpich-3.2</div><div class="line"># ./configure --prefix=/usr/local/mpich/</div><div class="line"># make &amp;&amp; make install</div></pre></td></tr></table></figure><p>$ vim ~/.bash_profile<br>$ export PATH=$PATH:/usr/local/mpich/bin/<br>$ source ~/.bash_profile<br>$ echo $PATH</p><h2 id="新建machinefile"><a href="#新建machinefile" class="headerlink" title="新建machinefile"></a>新建machinefile</h2><p>$ vim ~/machinefile<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">vm00</div><div class="line">vm01</div><div class="line">vm02</div></pre></td></tr></table></figure></p><h1 id="测试MPICHI，跑圆周率程序"><a href="#测试MPICHI，跑圆周率程序" class="headerlink" title="测试MPICHI，跑圆周率程序"></a>测试MPICHI，跑圆周率程序</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ /usr/local/mpich/bin/mpiexec -n 3 -machinefile machinefile ~/mpich-3.2/examples/cpi</div></pre></td></tr></table></figure><p>-n 是使用多少节点<br>-machinefile 集群节点文件<br><img src="/images/2017/0329/0.png" alt="计算圆周率"> </p>]]></content>
      
      
      <categories>
          
          <category> HPC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HPC </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>mailx 发送邮件小计</title>
      <link href="/arlo/670d97dc/"/>
      <url>/arlo/670d97dc/</url>
      
        <content type="html"><![CDATA[<h1 id="安装postfix服务"><a href="#安装postfix服务" class="headerlink" title="安装postfix服务"></a>安装postfix服务</h1><p>yum install postfix<br>/etc/init.d/postfix start<br>chkconfig postfix on</p><h1 id="发送格式"><a href="#发送格式" class="headerlink" title="发送格式"></a>发送格式</h1><p>mailx -s subject user@xxx.com &lt; message_file<br>echo “内容” | mailx -s “邮件标题” user@xxx.com</p><h1 id="其他选项"><a href="#其他选项" class="headerlink" title="其他选项"></a>其他选项</h1><p>-r 指定发件人<br>-c 指定抄送人<br>-b 指定密送人<br>多个收件人使用逗号分隔<br>有些邮箱（如qq邮箱）会当成垃圾邮件拦截，日志中可以看到500错误<br><a id="more"></a></p><h1 id="监控服务脚本是否运行正常"><a href="#监控服务脚本是否运行正常" class="headerlink" title="监控服务脚本是否运行正常"></a>监控服务脚本是否运行正常</h1><h2 id="监控脚本内容"><a href="#监控脚本内容" class="headerlink" title="监控脚本内容"></a>监控脚本内容</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line">count=`ssh m1 ps -ef|grep real_wrf.csh |grep -v &quot;grep&quot; |wc -l`</div><div class="line">#echo $count</div><div class="line">if [ 0 == $count ];then</div><div class="line">        mailx -s &quot;the real_wrf.csh is not running &quot; a1@xxx.com.cn,a2@xxx.com.cn &lt; t.txt     </div><div class="line">fi</div></pre></td></tr></table></figure><h2 id="监测目录下是否有文件"><a href="#监测目录下是否有文件" class="headerlink" title="监测目录下是否有文件"></a>监测目录下是否有文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line">#每天6:00~7:00检查前一天00时的数据，每天16:00~18:00检查前一天12时的数据</div><div class="line"></div><div class="line">Date1=`date -d &quot;1 day ago&quot; +&quot;%Y%m%d00&quot;`</div><div class="line">Date2=`date -d &quot;1 day ago&quot; +&quot;%Y%m%d_06&quot;`</div><div class="line">file=&quot;\</div><div class="line">/data/Model3/WRF/data/output/wrf/$Date1/wrfout_d03 \</div><div class="line">/data/Model3/CMAQ4.7/data/cctm-wrf/$Date1/CCTM_CONC.cn03.*.ncf \</div><div class="line">/data/Model3/CAMx6/data/post_save/$Date1/camxsave_d03* \</div><div class="line">/data/em/result/predictions/SHAANXI/$Date2/POST/naqpms_d03.* \</div><div class="line">/data/Model3/WRF/data/output/wrfchem/$Date1/wrfout_d03* \</div><div class="line">&quot;</div><div class="line">for i in $file</div><div class="line">do</div><div class="line">    if [ ! -f &quot;$i&quot; ]; then</div><div class="line">        echo &quot;$i 文件不存在&quot; &gt;&gt;  check_00mx_$Date1.txt</div><div class="line">        mailx -s &quot;00时文件数据模型数据不存在&quot; b@xx.com.cn &lt; check_00mx_$Date1.txt                           </div><div class="line">    fi</div><div class="line">done</div></pre></td></tr></table></figure><h2 id="监测目录是否存在，目录是否为空"><a href="#监测目录是否存在，目录是否为空" class="headerlink" title="监测目录是否存在，目录是否为空"></a>监测目录是否存在，目录是否为空</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line">#每天6:00~7:00检查前一天00时的数据，每天16:00~18:00检查前一天12时的数据</div><div class="line"></div><div class="line">Date1=`date +&quot;%Y&quot;`</div><div class="line">Date2=`date +&quot;%m&quot;`</div><div class="line">Date3=`date -d &apos;-1 day&apos;  +&quot;%d&quot;`</div><div class="line">Date4=`date +&quot;%Y%m%d00&quot;`</div><div class="line">Dir=/data/Model3/WeatherForecast</div><div class="line">WRF_Dir=&quot;$Dir/WRF/$Date1/$Date2/$Date3/d3/500/ \</div><div class="line">$Dir/WRF/$Date1/$Date2/$Date3/d3/700/ \</div><div class="line">$Dir/WRF/$Date1/$Date2/$Date3/d3/850/ \</div><div class="line">$Dir/WRF/$Date1/$Date2/$Date3/d3/srf/&quot;</div><div class="line"></div><div class="line">WRFCHEM_Dir=&quot;$Dir/WRFCHEM/$Date1/$Date2/$Date3/00/d3/aqi \</div><div class="line">$Dir/WRFCHEM/$Date1/$Date2/$Date3/00/d3/co \</div><div class="line">$Dir/WRFCHEM/$Date1/$Date2/$Date3/00/d3/no2 \</div><div class="line">$Dir/WRFCHEM/$Date1/$Date2/$Date3/00/d3/o3 \</div><div class="line">$Dir/WRFCHEM/$Date1/$Date2/$Date3/00/d3/pm10 \</div><div class="line">$Dir/WRFCHEM/$Date1/$Date2/$Date3/00/d3/pm25 \</div><div class="line">$Dir/WRFCHEM/$Date1/$Date2/$Date3/00/d3/so2&quot;</div><div class="line"></div><div class="line">WRFCHEMDAY_Dir=&quot;$Dir/WRFCHEMDAY/$Date1/$Date2/$Date3/00/d3/aqi \</div><div class="line">$Dir/WRFCHEMDAY/$Date1/$Date2/$Date3/00/d3/co \</div><div class="line">$Dir/WRFCHEMDAY/$Date1/$Date2/$Date3/00/d3/no2 \</div><div class="line">$Dir/WRFCHEMDAY/$Date1/$Date2/$Date3/00/d3/o3 \</div><div class="line">$Dir/WRFCHEMDAY/$Date1/$Date2/$Date3/00/d3/pm10 \</div><div class="line">$Dir/WRFCHEMDAY/$Date1/$Date2/$Date3/00/d3/pm25 \</div><div class="line">$Dir/WRFCHEMDAY/$Date1/$Date2/$Date3/00/d3/so2&quot;</div><div class="line"></div><div class="line">CAMX_Dir=&quot;$Dir/CAMX/$Date1/$Date2/$Date3/00/d3/aqi \</div><div class="line">$Dir/CAMX/$Date1/$Date2/$Date3/00/d3/co \</div><div class="line">$Dir/CAMX/$Date1/$Date2/$Date3/00/d3/no2 \</div><div class="line">$Dir/CAMX/$Date1/$Date2/$Date3/00/d3/o3 \</div><div class="line">$Dir/CAMX/$Date1/$Date2/$Date3/00/d3/pm10 \</div><div class="line">$Dir/CAMX/$Date1/$Date2/$Date3/00/d3/pm25 \</div><div class="line">$Dir/CAMX/$Date1/$Date2/$Date3/00/d3/so2 &quot;</div><div class="line"></div><div class="line">CAMxDAY_Dir=&quot;$Dir/CAMxDAY/$Date1/$Date2/$Date3/00/d3/aqi \</div><div class="line">$Dir/CAMxDAY/$Date1/$Date2/$Date3/00/d3/co \</div><div class="line">$Dir/CAMxDAY/$Date1/$Date2/$Date3/00/d3/no2 \</div><div class="line">$Dir/CAMxDAY/$Date1/$Date2/$Date3/00/d3/o3 \</div><div class="line">$Dir/CAMxDAY/$Date1/$Date2/$Date3/00/d3/pm10 \</div><div class="line">$Dir/CAMxDAY/$Date1/$Date2/$Date3/00/d3/pm25 \</div><div class="line">$Dir/CAMxDAY/$Date1/$Date2/$Date3/00/d3/so2 &quot;</div><div class="line"></div><div class="line">CMAQ_WRF_Dir=&quot;$Dir/CMAQ.WRF/$Date1/$Date2/$Date3/00/d3/aqi \</div><div class="line">$Dir/CMAQ.WRF/$Date1/$Date2/$Date3/00/d3/co \</div><div class="line">$Dir/CMAQ.WRF/$Date1/$Date2/$Date3/00/d3/no2 \</div><div class="line">$Dir/CMAQ.WRF/$Date1/$Date2/$Date3/00/d3/o3 \</div><div class="line">$Dir/CMAQ.WRF/$Date1/$Date2/$Date3/00/d3/pm10 \</div><div class="line">$Dir/CMAQ.WRF/$Date1/$Date2/$Date3/00/d3/pm25 \</div><div class="line">$Dir/CMAQ.WRF/$Date1/$Date2/$Date3/00/d3/so2 &quot;</div><div class="line"></div><div class="line">CMAQDAY_Dir=&quot;$Dir/CMAQDAY/$Date1/$Date2/$Date3/00/d3/aqi \</div><div class="line">$Dir/CMAQDAY/$Date1/$Date2/$Date3/00/d3/co \</div><div class="line">$Dir/CMAQDAY/$Date1/$Date2/$Date3/00/d3/no2 \</div><div class="line">$Dir/CMAQDAY/$Date1/$Date2/$Date3/00/d3/o3 \</div><div class="line">$Dir/CMAQDAY/$Date1/$Date2/$Date3/00/d3/pm10 \</div><div class="line">$Dir/CMAQDAY/$Date1/$Date2/$Date3/00/d3/pm25 \</div><div class="line">$Dir/CMAQDAY/$Date1/$Date2/$Date3/00/d3/so2 &quot;</div><div class="line"></div><div class="line">NAQMPS_Dir=&quot;$Dir/NAQMPS/$Date1/$Date2/$Date3/00/d3/aqi \</div><div class="line">$Dir/NAQMPS/$Date1/$Date2/$Date3/00/d3/co \</div><div class="line">$Dir/NAQMPS/$Date1/$Date2/$Date3/00/d3/no2 \</div><div class="line">$Dir/NAQMPS/$Date1/$Date2/$Date3/00/d3/o3 \</div><div class="line">$Dir/NAQMPS/$Date1/$Date2/$Date3/00/d3/pm10 \</div><div class="line">$Dir/NAQMPS/$Date1/$Date2/$Date3/00/d3/pm25 \</div><div class="line">$Dir/NAQMPS/$Date1/$Date2/$Date3/00/d3/so2 &quot;</div><div class="line"></div><div class="line">NAQMPSDAY_Dir=&quot;$Dir/NAQMPSDAY/$Date1/$Date2/$Date3/00/d3/aqi \</div><div class="line">$Dir/NAQMPSDAY/$Date1/$Date2/$Date3/00/d3/co \</div><div class="line">$Dir/NAQMPSDAY/$Date1/$Date2/$Date3/00/d3/no2 \</div><div class="line">$Dir/NAQMPSDAY/$Date1/$Date2/$Date3/00/d3/o3 \</div><div class="line">$Dir/NAQMPSDAY/$Date1/$Date2/$Date3/00/d3/pm10 \</div><div class="line">$Dir/NAQMPSDAY/$Date1/$Date2/$Date3/00/d3/pm25 \</div><div class="line">$Dir/NAQMPSDAY/$Date1/$Date2/$Date3/00/d3/so2 &quot;</div><div class="line"></div><div class="line">Dir2=&quot;$WRF_Dir $WRFCHEM_Dir $WRFCHEMDAY_Dir $CAMX_Dir $CAMxDAY_Dir $CMAQ_WRF_Dir $CMAQDAY_Dir $NAQMPS_Dir $NAQMPSDAY_Dir&quot;</div><div class="line">for d in $Dir2</div><div class="line">do</div><div class="line">    if [ ! -d $d ]; then</div><div class="line">        echo &quot;$d 目录不存在&quot; &gt;&gt; /tmp/check_00tp_$Date4.txt</div><div class="line">    elif [ `ls $d |wc -l` -eq 0  ]; then</div><div class="line">        echo &quot;$d 目录下文件不存在&quot; &gt;&gt; /tmp/check_00tp_$Date4.txt</div><div class="line">    fi</div><div class="line">done</div><div class="line">mailx -s &quot;$Date4 00时 模型出图情况&quot; c@xx.com.cn &lt; /tmp/check_00tp_$Date4.txt</div></pre></td></tr></table></figure><h2 id="设置crontab"><a href="#设置crontab" class="headerlink" title="设置crontab"></a>设置crontab</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">01 13,17,01,04 * * * /data/tool/DRAW/shell/check_status/check_wrf.sh</div><div class="line">01 07 * * * /data/tool/DRAW/shell/check_status/check_00mx.sh</div><div class="line">01 08 * * * /data/tool/DRAW/shell/check_status/check_00tp.sh</div></pre></td></tr></table></figure><h1 id="另附短信发送脚本"><a href="#另附短信发送脚本" class="headerlink" title="另附短信发送脚本"></a>另附短信发送脚本</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line">datedir1=`date +%Y%d`</div><div class="line">datedir2=`date +%Y%d%y`</div><div class="line">un=&quot;xxxxxxxx&quot;</div><div class="line">pw=&quot;xxxxxxxxxx&quot;</div><div class="line">phone=&quot;xxxxxxxxxxx&quot;</div><div class="line">msg=&quot;this is a test mes,please ignore&quot;</div><div class="line"></div><div class="line">if [ ! -d &quot;/data/em/data/GFS/$datedir1/$datedir2&quot; ];then</div><div class="line">    curl --data &quot;un=$un&amp;pw=$pw&amp;phone=$phone&amp;msg=$msg&amp;rd=1&quot; &quot;http://sms.253.com/msg/send&quot;</div><div class="line">    echo  -e &quot;\n query balance:&quot;</div><div class="line">    curl --data &quot;un=$un&amp;pw=$pw&quot; &quot;http://sms.253.com/msg/balance&quot;</div><div class="line">fi</div><div class="line">echo &quot;send sms:&quot;</div></pre></td></tr></table></figure><p>短信参考：<a href="https://www.253.com/api-docs-13.html" target="_blank" rel="external">https://www.253.com/api-docs-13.html</a></p>]]></content>
      
      
      <categories>
          
          <category> 监控 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 监控 </tag>
            
            <tag> mail </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>SSH 奇淫技巧之隧道模式</title>
      <link href="/arlo/da9b9fcb/"/>
      <url>/arlo/da9b9fcb/</url>
      
        <content type="html"><![CDATA[<p>用了ssh这么久，今天才知道ssh还有这么强大的功能，穿透内外网，来去自如；其实最重要的还是方便平时工作中的调试，在此简单的记录一下。</p><h1 id="使用条件"><a href="#使用条件" class="headerlink" title="使用条件"></a>使用条件</h1><p>一台拥有ssh端口连接的外网linux服务器</p><h1 id="本地转发"><a href="#本地转发" class="headerlink" title="本地转发"></a>本地转发</h1><p>场景：公网有一台服务器的公网ip，ssh端口(已修改为2012)没有对外开放，本地想直接连接此端口，可以通过公网一台开放ssh端口的服务器跳转过去<br><code>ssh -p 2012 -CNg -L 2222:namenode:2012 nsxq@1.2.3.4</code><br>将namenode服务器的2012端口通过1.2.3.4服务器映射到本地2222端口 ssh -p 2222 localhost 即可连接<br>-p 指定跳转机端口<br>-L 本地转发</p><h1 id="远程转发"><a href="#远程转发" class="headerlink" title="远程转发"></a>远程转发</h1><p>场景：本地开发环境需要被外网访问，之前一直使用花生壳，ngrok之类的程序；现在只需要本地执行一条ssh命令，将本地的端口映射到一台外网的服务器上去<br>将本地内网192.168.1.5:80 映射到1.2.3.4服务器的8888端口，访问1.2.3.4:8888 即可访问192.168.1.5:80 内容<br><code>ssh -p 2012 -CNfg -R 0.0.0.0:8888:192.168.1.5:80 nsxq@1.2.3.4</code></p><p><font color="#FF0000"> <strong>打开1.2.3.4服务器需要sshd_config 配置中的GatewayPorts yes</strong></font><br>记得顺手打开防火墙端口<br>-p 指定跳转机端口<br>-R 远程转发<br><code>ssh -CNfg -R 0.0.0.0:3306:10.71.36.123:3306 dczf@10.71.36.121</code><br>在10.71.36.123上执行此命令，将10.71.36.123的3306映射到10.71.36.121的3306端口</p><h1 id="动态转发"><a href="#动态转发" class="headerlink" title="动态转发"></a>动态转发</h1><p>场景：相对于上边两种单一端口转发，此功能就是在本地启动一个端口，其他机器可以设置代理，通过此端口进行流量转发（俗称翻墙）。<br><code>ssh -D 5000 nsxq@1.2.3.4</code><br>我这里没有能上google的服务器，没法测试，按道理来说，其他机器就可以将代理设置为1.2.3.4:5000 进行商上网了</p><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p>[实战ssh端口转发]<a href="http://www.ibm.com/developerworks/cn/linux/l-cn-sshforward/" target="_blank" rel="external">http://www.ibm.com/developerworks/cn/linux/l-cn-sshforward/</a><br>[SSH的三种端口转发（Port forwarding）/ 隧道协议概要]<a href="https://blog.twofei.com/528/" target="_blank" rel="external">https://blog.twofei.com/528/</a></p>]]></content>
      
      
      <categories>
          
          <category> 常识 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> SSH </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>给下拉菜单和鼠标右键截图</title>
      <link href="/arlo/8fb14fc6/"/>
      <url>/arlo/8fb14fc6/</url>
      
        <content type="html"><![CDATA[<h1 id="调用常用的QQ软件截图"><a href="#调用常用的QQ软件截图" class="headerlink" title="调用常用的QQ软件截图"></a>调用常用的QQ软件截图</h1><p><strong>1. 登陆qq</strong><br><strong>2. 同时按住Crtl+Alt+Shift</strong><br><strong>3. 松开Shift，其他两个手指不用松开</strong><br><strong>4. 按住A</strong><br><strong>5. 截图</strong></p>]]></content>
      
      
      
        <tags>
            
            <tag> windows </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>使用阿里云Docker镜像库加速</title>
      <link href="/arlo/42c94ca5/"/>
      <url>/arlo/42c94ca5/</url>
      
        <content type="html"><![CDATA[<h1 id="开发者账号"><a href="#开发者账号" class="headerlink" title="开发者账号"></a>开发者账号</h1><p>由于docker官方的镜像下载太慢了，于是开通了阿里云的开发者账号；<br><strong>申请开发者账号</strong><br><a href="http://console.d.aliyun.com/join.htm?spm=0.0.0.0.Xx1dX0#/docker/booster" target="_blank" rel="external">http://console.d.aliyun.com/join.htm?spm=0.0.0.0.Xx1dX0#/docker/booster</a><br><strong>本人的专属加速器地址</strong><br><a href="https://4c2kkvb9.mirror.aliyuncs.com" target="_blank" rel="external">https://4c2kkvb9.mirror.aliyuncs.com</a><br><strong>阿里云docker镜像搜索地址：</strong><br><a href="https://cr.console.aliyun.com/#/imageSearch" target="_blank" rel="external">https://cr.console.aliyun.com/#/imageSearch</a><br><strong>阿里云docker加速器</strong><br>使用加速器将会提升您在国内获取Docker官方镜像的速度！<br><a href="https://cr.console.aliyun.com/#/accelerator" target="_blank" rel="external">https://cr.console.aliyun.com/#/accelerator</a></p><h1 id="加速器操作文档"><a href="#加速器操作文档" class="headerlink" title="加速器操作文档"></a>加速器操作文档</h1><p>安装或升级Docker<br>您可以通过阿里云的镜像仓库下载：<strong><a href="http://mirrors.aliyun.com/help/docker-engine" target="_blank" rel="external">mirrors.aliyun.com/help/docker-engine</a></strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet | sh -</div></pre></td></tr></table></figure></p><p>配置Docker加速器</p><p>您可以使用如下的脚本将mirror的配置添加到docker daemon的启动参数中。<br>系统要求 CentOS 7 以上，Docker 1.9 以上。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cp -n /lib/systemd/system/docker.service /etc/systemd/system/docker.service   </div><div class="line">sed -i &quot;s|ExecStart=/usr/bin/dockerd|ExecStart=/usr/bin/docker daemon --registry-mirror=https://4c2kkvb9.mirror.aliyuncs.com|g&quot; /etc/systemd/system/docker.service    </div><div class="line">systemctl daemon-reload </div><div class="line">systemctl restart docker</div></pre></td></tr></table></figure></p><h1 id="QA"><a href="#QA" class="headerlink" title="QA"></a>QA</h1><p>Q: docker pull 时候报错“ x509: certificate has expired or is not yet valid”<br>A: 此问题是由于主机的时间不同步造成的，使用ntpdate cn.ntp.org.cn 同步网络时间即可。</p><hr>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>使用kubernetes 1.4 新特性kubeadm创建集群</title>
      <link href="/arlo/f9f5730/"/>
      <url>/arlo/f9f5730/</url>
      
        <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>kubernetes 发布的最新版本1.4，增加了很多新特性，据说只用两条命令就可以创建一个k8s集群，比起之前的搭建起来简单很多。<br>[官方文档][<strong> <a href="http://kubernetes.io/docs/getting-started-guides/kubeadm/" target="_blank" rel="external">http://kubernetes.io/docs/getting-started-guides/kubeadm/</a> </strong>]<br><a id="more"></a></p><h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><h2 id="主机资源"><a href="#主机资源" class="headerlink" title="主机资源"></a>主机资源</h2><p>192.168.234.139    dc01<br>192.168.234.140    dc02<br>192.168.234.141    dc03</p><h2 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h2><p>推荐使用ubuntu 16 和centos 7 以上版本（我个人使用的是centos 7.2 x64）</p><h2 id="软件安装"><a href="#软件安装" class="headerlink" title="软件安装"></a>软件安装</h2><p>在三台机器上上分别安装docker 和 kubelet、kubectl和kubeadm </p><h3 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -sS https://get.docker.io/ |sh</div></pre></td></tr></table></figure><h3 id="安装kubelet、kubectl和kubeadm"><a href="#安装kubelet、kubectl和kubeadm" class="headerlink" title="安装kubelet、kubectl和kubeadm"></a>安装kubelet、kubectl和kubeadm</h3><p>需要安装的kubelet、kubeadm、kubectl、 kubernetes-cni这四个rpm包是google的源，正常情况下国内是连接不上的，qq群(319807078)里已经有热心网友下载下来了，安装的时候会依赖一个socat的软件包,使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum localinstall *.rpm</div></pre></td></tr></table></figure></p><h2 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h2><p>三台机器都需要启动docker和kubelet</p><h3 id="启动docker"><a href="#启动docker" class="headerlink" title="启动docker"></a>启动docker</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">systemctl enable docker &amp;&amp; systemctl start docker</div></pre></td></tr></table></figure><h3 id="启动kubelet"><a href="#启动kubelet" class="headerlink" title="启动kubelet"></a>启动kubelet</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">systemctl enable kubelet &amp;&amp; systemctl start kubelet  # **此时启动kubelet是失败的，因为在/etc/kubernetes下还没有生成配置文件**</div></pre></td></tr></table></figure><h3 id="下载images"><a href="#下载images" class="headerlink" title="下载images"></a>下载images</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">images=(kube-proxy-amd64:v1.4.0 kube-discovery-amd64:1.0 kubedns-amd64:1.7 kube-scheduler-amd64:v1.4.0 kube-controller-manager-amd64:v1.4.0 kube-apiserver-amd64:v1.4.0 etcd-amd64:2.2.5 kube-dnsmasq-amd64:1.3 exechealthz-amd64:1.1 pause-amd64:3.0 kubernetes-dashboard-amd64:v1.4.0)</div><div class="line">for imageName in $&#123;images[@]&#125; ; do</div><div class="line">  docker pull mritd/$imageName</div><div class="line">  docker tag mritd/$imageName gcr.io/google_containers/$imageName</div><div class="line">  docker rmi mritd/$imageName</div><div class="line">done</div></pre></td></tr></table></figure><h1 id="搭建集群"><a href="#搭建集群" class="headerlink" title="搭建集群"></a>搭建集群</h1><h2 id="初始化集群"><a href="#初始化集群" class="headerlink" title="初始化集群"></a>初始化集群</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubeadm init --api-advertise-addresses=192.168.234.139</div></pre></td></tr></table></figure><p><img src="/images/2016/1021/01.png" alt="k8s"><br>查看日志<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">journalctl -fu kubelet</div></pre></td></tr></table></figure></p><p>漠然大神给出的此错误排错步骤<br>NO.1、保证 hostname 中主机名为 xxxx.com 等这种域名格式<br>NO.2、保证 hosts 文件中 有 127.0.0.1 与之对应<br>NO.3、保证 gcr 相关镜像 已经 load 到本地<br>NO.4、保证 iptables规则没问题，必要时候 -F<br>NO.5、保证 selinux 已经关闭<br>NO.6、init 之前保证 启动 kubelet，虽然启动后显示启动失败<br>NO.7、重新 init 保证用 官方 clean 步骤做下清理<br>官方清理脚本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">systemctl stop kubelet;</div><div class="line">docker rm -f -v $(docker ps -q);</div><div class="line">find /var/lib/kubelet | xargs -n 1 findmnt -n -t tmpfs -o TARGET -T | uniq | xargs -r umount -v;</div><div class="line">rm -r -f /etc/kubernetes /var/lib/kubelet /var/lib/etcd;</div></pre></td></tr></table></figure></p><h2 id="加入集群节点"><a href="#加入集群节点" class="headerlink" title="加入集群节点"></a>加入集群节点</h2><p>保证节点上启动了docker 和kubectl<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubeadm join --token 0ab76c.b59aaa1d1ab3cf93 192.168.234.139</div></pre></td></tr></table></figure></p><h2 id="查看加入的节点"><a href="#查看加入的节点" class="headerlink" title="查看加入的节点"></a>查看加入的节点</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubectl get nodes</div></pre></td></tr></table></figure><p><a href="https://mritd.me/2016/10/09/kubernetes-1.4-create-cluster/" target="_blank" rel="external">本文参考漠然大神链接</a><br><a href="https://mritd.me" target="_blank" rel="external">漠然大神博客地址</a><br><a href="https://github.com/kubernetes/release/tree/master/rpm" target="_blank" rel="external">github build k8s rpm</a></p><hr>]]></content>
      
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kubernetes </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>CentOs 7 firewalld 防火墙无法启动</title>
      <link href="/arlo/5a65cdf4/"/>
      <url>/arlo/5a65cdf4/</url>
      
        <content type="html"><![CDATA[<p>CentOs 7 无法启动，提示“Job for firewalld.service failed because a timeout was exceeded. See “systemctl status firewalld.service” and “journalctl -xe” for details.”<br><a id="more"></a></p><h1 id="排错"><a href="#排错" class="headerlink" title="排错"></a>排错</h1><p>启动报错提示如下图<br><img src="/images/2016/0922/1.jpg" alt="firewalld"><br>排错很久，发现服务没有启动，但是有一个firewall的进程<br><img src="/images/2016/0922/2.jpg" alt="firewalld"><br>kill掉这个进程，顺利启动<br><img src="/images/2016/0922/3.jpg" alt="firewalld"></p><h1 id="常用firewall命令"><a href="#常用firewall命令" class="headerlink" title="常用firewall命令"></a>常用firewall命令</h1><p>firewall-cmd –list-services<br>firewall-cmd –list-ports<br>firewall-cmd –add-port 80/tcp    添加端口<br>firewall-cmd –add-service http    添加服务<br>firewall-cmd –zone=external –add-masquerade    开启端口转发<br>firewall-cmd –zone=external –add-forward-port=port=80:proto=tcp:toport=8080    本机80转发到本机8080<br>firewall-cmd –zone=external –add-forward=port=9090:proto=tcp:toaddr=192.168.234.130    9090转发到另外一台机器的9090<br>firewall-cmd –zone=external –add-forward=port=23:proto=tcp:toport=2003:toaddr=192.168.234.130    23转发到另外一台机器的2003<br>firewall-cmd –zone=public –add-port=5060-5059/udp –permanent    范围端口，永久生效<br>firewall-cmd –permanent –add-icmp-block=echo-reply    允许ICMP响应应答报文</p><h1 id="顺便推荐一篇firewalld写的很好，很全的文章"><a href="#顺便推荐一篇firewalld写的很好，很全的文章" class="headerlink" title="顺便推荐一篇firewalld写的很好，很全的文章"></a>顺便推荐一篇firewalld写的很好，很全的文章</h1><p><a href="http://www.hi-linux.com/2016/05/26/CentOS%207%E4%B8%8B%E4%BD%BF%E7%94%A8FirewallD%E6%9E%84%E5%BB%BA%E5%8A%A8%E6%80%81%E9%98%B2%E7%81%AB%E5%A2%99/" target="_blank" rel="external"><strong>CentOS 7下使用FirewallD构建动态防火墙</strong></a></p><p><a href="https://lists.centos.org/pipermail/centos/2014-September/145809.html" target="_blank" rel="external">参考链接</a></p><hr>]]></content>
      
      
      <categories>
          
          <category> Troubleshooting </category>
          
      </categories>
      
      
        <tags>
            
            <tag> firewalld </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Jumpserver跳转机搭建过程中的疑问</title>
      <link href="/arlo/ef870e7c/"/>
      <url>/arlo/ef870e7c/</url>
      
        <content type="html"><![CDATA[<h1 id="跳转机"><a href="#跳转机" class="headerlink" title="跳转机"></a>跳转机</h1><p>跳转机又名堡垒机，主要作用是在终端连接服务器之间加一层防护保障，保障连接到服务器的方式更加安全，更加透明，更加可控。<br><img src="/images/2016/0830/1.png" alt="Jumpserver 架构图"><br><a id="more"></a><br>Jumpserver官网的wiki、图解、视频教程做的已经很详细了，参考地址如下：<br>[Jumpserver 官网地址:]<a href="http://www.jumpserver.org/" target="_blank" rel="external">http://www.jumpserver.org/</a><br>[Jumpserver WiKi]<a href="https://github.com/jumpserver/jumpserver/wiki" target="_blank" rel="external">https://github.com/jumpserver/jumpserver/wiki</a><br>[Jumpserver v3 视频教程]<a href="http://bbs.jumpserver.org/read/639.html" target="_blank" rel="external">http://bbs.jumpserver.org/read/639.html</a></p><h1 id="记录问题"><a href="#记录问题" class="headerlink" title="记录问题"></a>记录问题</h1><p>以下是我在安装搭建过程中遇到的几个问题，在此记录一下。</p><h2 id="用户"><a href="#用户" class="headerlink" title="用户"></a>用户</h2><p><strong>用户管理中的用户:</strong> 用于登陆jumpserver跳转机和jumpserver web平台的用户；表示该类用户拥有登陆跳转机权限。<br><strong>设置中的默认管理员用户:</strong> 只适用于设置资产管理的时候，管理账号，使用默认选项；其实是一个缺省的管理员用户，只有大规模客户端使用相同的管理员用户名和密码是作用最大。<br><strong>添加资产时候的管理用户:</strong> 必须是真实存在于被添加的资产上，拥有管理权限（或sudo权限）的用户；被连接的资产设备上真是存在的管理员用户，如root。<br><strong>授权管理中的系统用户:</strong> 此用户是在添加jumpserver平台，通过推送在服务器上真是创建的用户；</p><h2 id="服务器，客户端"><a href="#服务器，客户端" class="headerlink" title="服务器，客户端"></a>服务器，客户端</h2><p>服务器：jms，安装jumpserver的这台服务器<br>客户端：通过跳转机链接的资产，如被连接的服务器，网络设备等</p><h2 id="推送"><a href="#推送" class="headerlink" title="推送"></a>推送</h2><p>推送是通过资产管理里的管理用户在服务器上建立系统用户和赋予sudo权限（如果管理sudo别名的话）</p>]]></content>
      
      
      
        <tags>
            
            <tag> 跳转机 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Xshell 使用技巧</title>
      <link href="/arlo/d1d8517a/"/>
      <url>/arlo/d1d8517a/</url>
      
        <content type="html"><![CDATA[<p>Xshell 是一个强大的安全终端模拟软件，它支持SSH1, SSH2, 以及Microsoft Windows 平台的TELNET 协议。Xshell 通过互联网到远程主机的安全连接以及它创新性的设计和特色帮助用户在复杂的网络环境中享受他们的工作。Xshell可以在Windows界面下用来访问远端不同系统下的服务器，从而比较好的达到远程控制终端的目的。<br><a id="more"></a></p><ol><li>主界面<br><img src="/images/2016/0819/1.png" alt="xshell配图"> </li><li>添加链接。<br><img src="/images/2016/0819/2.png" alt="xshell配图"> </li><li>可以保存的，以后不用输入用户名，密码，这个是putty没有的（有利有弊，从安全方面说，有风险哇。。。）<br><img src="/images/2016/0819/3.png" alt="xshell配图"> </li><li>中文乱码，修改编码为 UTF-8<br><img src="/images/2016/0819/4.png" alt="xshell配图"> </li><li>小键盘不能输入数字。<br><img src="/images/2016/0819/5.png" alt="xshell配图"> </li><li>界面及字体颜色<br><img src="/images/2016/0819/6.png" alt="xshell配图"> </li><li>看到这个真有点相见恨晚的感觉，右键粘贴功能，这个是用putty养成的习惯（虽然之前看到网上有说,选中后，使用ctrl+insert 复制，鼠标中键粘贴），在此感谢@ 吴天！<br><img src="/images/2016/0819/7.png" alt="xshell配图"><br>最大的好处就是，你设置的这些，只需要设置一次就可以了，不用像putty里那种针对每个连接都设置一遍。<br>xftp在这里就不说了，此处省去几十字。。。。。。。</li><li>xshell 5 每次exit退出时候，停留在本地shell界面，需要再次关闭，取消以下选项即可(ps：有强迫症的人可以顺手打上最后那个选项勾)<br><img src="/images/2016/0819/8.jpg" alt="xshell配图"> </li><li>Xshell选中文字复制时中断<strong>【<a href="http://nkcoder.github.io/2014/05/05/xshell-select-interrupt-dict/" target="_blank" rel="external">转</a>】</strong><br>在Xshell中设置了“自动将选中的文字复制到粘贴板”，之前一直没有问题，最近发现，只要选中屏幕上的文字，复制上了，但shell终端立即被中断了，即向终端发送了CTRL-C；</li></ol><p><em>很可能是“选中文字复制”与词典软件的“划词翻译”相冲突。我的原因是，最近安装了必应词典，且开启了“划词翻译”功能。<br>我在网上求助时，发现也有一些朋友遇到和我一样的问题，都是由于与词典的冲突导致的，如有道词典，关掉划译功能即可。</em></p><ol><li>顺手分享一个xshell的配色方案<br>将一些配置文件保存为x_shell.xcs格式<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">[x_shell]</div><div class="line">text(bold)=ffffff</div><div class="line">magenta(bold)=ff00ff</div><div class="line">text=839496</div><div class="line">white(bold)=ffffff</div><div class="line">green=00c000</div><div class="line">red(bold)=ff0000</div><div class="line">green(bold)=00ff00</div><div class="line">black(bold)=808080</div><div class="line">red=808000</div><div class="line">blue=ff8040</div><div class="line">black=000000</div><div class="line">blue(bold)=8080ff</div><div class="line">yellow(bold)=ffff00</div><div class="line">cyan(bold)=00ffff</div><div class="line">yellow=c0c000</div><div class="line">magenta=c000c0</div><div class="line">background=002b35</div><div class="line">white=c0c0c0</div><div class="line">cyan=00c0c0</div><div class="line">[Names]</div><div class="line">count=1</div><div class="line">name0=x_shell</div></pre></td></tr></table></figure></li></ol><p>点击工具-配色方案-导入<br><img src="/images/2016/0819/9.jpg" alt="xshell配图"><br><img src="/images/2016/0819/10.jpg" alt="xshell配图"><br>点击文件-属性-外观<br><img src="/images/2016/0819/11.jpg" alt="xshell配图"><br><img src="/images/2016/0819/12.jpg" alt="xshell配图"> </p><hr>]]></content>
      
      
      <categories>
          
          <category> 常识 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> xshell </tag>
            
            <tag> Linux </tag>
            
            <tag> 常识 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>常用命令集合</title>
      <link href="/arlo/ddba52eb/"/>
      <url>/arlo/ddba52eb/</url>
      
        <content type="html"><![CDATA[<h1 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h1><h2 id="进程查看"><a href="#进程查看" class="headerlink" title="进程查看"></a>进程查看</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">netstat -ano |findstr “8080” 查看端口</div><div class="line">netstat -ano |findstr “127.0.0.1”</div><div class="line">#tasklist 查看进程</div><div class="line">tasklist |findstr “nginx”</div><div class="line">tasklist /fi &quot;imagename eq nginx.exe&quot;</div><div class="line">#tskill 结束进程</div><div class="line">tskill nginx</div><div class="line">tskill 1130</div><div class="line">taskkill /im nginx.exe /f</div></pre></td></tr></table></figure><p>##查看文件被哪个进程占用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">打开资源管理器-CPU-关联的句柄-输入文件名称</div></pre></td></tr></table></figure></p><h2 id="映射网络驱动器"><a href="#映射网络驱动器" class="headerlink" title="映射网络驱动器"></a>映射网络驱动器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">net use Z: \\192.168.0.x\share /user:username password</div><div class="line">#断开网络驱动器</div><div class="line">net use Z: /del /y</div><div class="line">net use * /del /y</div></pre></td></tr></table></figure><h2 id="桌面图标设置"><a href="#桌面图标设置" class="headerlink" title="桌面图标设置"></a>桌面图标设置</h2><p>添加计算机图标到桌面<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rundll32.exe shell32.dll,Control_RunDLL desk.cpl,,0</div></pre></td></tr></table></figure></p><h2 id="查看系统启动时间"><a href="#查看系统启动时间" class="headerlink" title="查看系统启动时间"></a>查看系统启动时间</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">systeminfo|find &quot;系统启动时间&quot;</div></pre></td></tr></table></figure><h2 id="常用快捷命令"><a href="#常用快捷命令" class="headerlink" title="常用快捷命令"></a>常用快捷命令</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">winver# 查看系统信息</div><div class="line">control.exe# 控制面板</div><div class="line">sysdm.cpl# 系统属性</div><div class="line">devmgmt.msc# 设备管理器</div><div class="line">compmgmt.msc# 计算机管理</div><div class="line">wf.msc# 防火墙管理</div></pre></td></tr></table></figure><h2 id="网络与共享中心"><a href="#网络与共享中心" class="headerlink" title="网络与共享中心"></a>网络与共享中心</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">control.exe /name Microsoft.NetworkAndSharingCenter</div></pre></td></tr></table></figure><h2 id="修复网络连接错误"><a href="#修复网络连接错误" class="headerlink" title="修复网络连接错误"></a>修复网络连接错误</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cmd</div><div class="line">netsh winsock reset</div></pre></td></tr></table></figure><h1 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h1><h2 id="free"><a href="#free" class="headerlink" title="free"></a>free</h2><p>查看内存使用情况</p><p>可用内存=free+buffers+cached<br>以用内存=used-buffers-cached<br>所以看内存的使用不要看used 和free ，看 -/+ buffers/cache 就可以了<br>查看内存插槽数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dmidecode|grep -P -A5 &quot;Memory\s+Device&quot;|grep Size|grep -v Range</div></pre></td></tr></table></figure></p><p>查看内存最大容量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dmidecode | grep -P &apos;Maximum\s+Capacity&apos;</div></pre></td></tr></table></figure></p><p>查看内存频率<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dmidecode|grep -A16 &quot;Memory Device&quot;|grep &apos;Speed&apos;</div></pre></td></tr></table></figure></p><h2 id="iostat"><a href="#iostat" class="headerlink" title="iostat"></a>iostat</h2><p>查看磁盘性能</p><p>iostat -x 1 5<br>%util 接近100%的时候，产生 的I/O 请求太多，I/O 系统已经满负荷，该磁盘可能存在瓶颈<br>%idle 小于70%的时候，I/O 的 压力比较大，说明读取中有很多的wait</p><h2 id="du"><a href="#du" class="headerlink" title="du"></a>du</h2><p>查看系统目录占用空间大小</p><p>在根目录下执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">du -hsx * |sort -rh |head -10</div><div class="line">du -ah --max-depth=1</div></pre></td></tr></table></figure></p><p>推荐一款速度更快的工具ncdu</p><h2 id="uptime"><a href="#uptime" class="headerlink" title="uptime"></a>uptime</h2><h3 id="查看cpu的负载"><a href="#查看cpu的负载" class="headerlink" title="查看cpu的负载"></a>查看cpu的负载</h3><p>每cpu的核心当前活动进程数不大于3，表示性能良好，大于五表示严重。</p><h3 id="物理CPU数"><a href="#物理CPU数" class="headerlink" title="物理CPU数"></a>物理CPU数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat /proc/cpuinfo | grep &quot;physical id&quot; | sort | uniq</div></pre></td></tr></table></figure><h3 id="单个CPU的逻辑核心数量"><a href="#单个CPU的逻辑核心数量" class="headerlink" title="单个CPU的逻辑核心数量"></a>单个CPU的逻辑核心数量</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat /proc/cpuinfo | fgrep &quot;cores&quot; | uniq</div></pre></td></tr></table></figure><h3 id="系统CPU线程数"><a href="#系统CPU线程数" class="headerlink" title="系统CPU线程数"></a>系统CPU线程数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat /proc/cpuinfo | grep &quot;processor&quot; | wc -l</div></pre></td></tr></table></figure><p>线程数=物理cpu数x单个逻辑cpu核心数，表示没有开启多线程</p><h2 id="dd"><a href="#dd" class="headerlink" title="dd"></a>dd</h2><p>瞬间创建（1T）大文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dd if=/dev/zero of=file bs=1G seek=1024 count=0</div></pre></td></tr></table></figure></p><p>这个文件用ll -h 看着是1TB的，用du -sh 看着是空文件，随着写入的数据而增长</p><p>dd制作ISO镜像<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dd if=/dev/cdrom of=/mnt/cd1.iso</div></pre></td></tr></table></figure></p><h2 id="shopt"><a href="#shopt" class="headerlink" title="shopt"></a>shopt</h2><p>选择性删除文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">shopt -s extglob 打开</div><div class="line">rm -fr !(file1|file2)</div><div class="line">shopt -u extglob #关闭</div></pre></td></tr></table></figure></p><h2 id="dstat"><a href="#dstat" class="headerlink" title="dstat"></a>dstat</h2><p>监控系统状态<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alias dstat=&apos;dstat -cdlmnpsy&apos;</div></pre></td></tr></table></figure></p><h2 id="iftop"><a href="#iftop" class="headerlink" title="iftop"></a>iftop</h2><p>n 显示ip/主机名<br>p 显示端口<br>l 输入过滤内容<br><a href="http://www.vpser.net/manage/iftop.html" target="_blank" rel="external">http://www.vpser.net/manage/iftop.html</a></p><h2 id="网卡灯闪烁"><a href="#网卡灯闪烁" class="headerlink" title="网卡灯闪烁"></a>网卡灯闪烁</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ethtool -p eth0</div></pre></td></tr></table></figure><h2 id="查找局域网ip地址冲突"><a href="#查找局域网ip地址冲突" class="headerlink" title="查找局域网ip地址冲突"></a>查找局域网ip地址冲突</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">#在局域网其他机器检测目标主机，不能在本机arping检验自己的ip</div><div class="line">arping 192.168.1.120 </div><div class="line">#命令表示查看与本机在同一局域网内的所有机器的ip使用情况</div><div class="line">arp-scan -l</div><div class="line">#命令表示查看与本机在同一局域网内的所有主机的eth0网卡的ip使用情况</div><div class="line">arp-scan –I eth0 -l</div><div class="line"># windows下可以使用</div><div class="line">arp -a# 打印arp表</div><div class="line">arp -d# 清除arp对应关系</div><div class="line">arp -s 192.168.0.1  80-8f-1d-9f-5e-b7#绑定arp</div></pre></td></tr></table></figure><h1 id="终端快捷键"><a href="#终端快捷键" class="headerlink" title="终端快捷键"></a>终端快捷键</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">ctrl + a移动光标到行首</div><div class="line">ctrl + e移动光标到行尾（好像不生效）</div><div class="line">ctrl + r查找历史命令</div><div class="line">ctrl + u删除从光标到行首</div><div class="line">ctrl + k删除从光标到行尾</div><div class="line">ctrl + l清屏</div></pre></td></tr></table></figure><p>更多参考：<a href="http://harttle.com/2015/11/09/bash-shortcuts.html" target="_blank" rel="external">http://harttle.com/2015/11/09/bash-shortcuts.html</a></p>]]></content>
      
      
      <categories>
          
          <category> 常识 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 常识 </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>升级mysql数据库字符集为utf8mb4</title>
      <link href="/arlo/3b439eff/"/>
      <url>/arlo/3b439eff/</url>
      
        <content type="html"><![CDATA[<p>之前公司的项目中一直使用的mysql版本(5.1.73)，使用utf8字符集，基本上没有什么问题的;<br><img src="/images/2016/0812/1.jpg" alt="之前的mysql版本"><br>现在开始做一些手机客户端之类的项目，发送表情(emoji)的时候会报错“ ‘\xF0\x9F\x98\xB1’ for column ‘body’ at row 1”；<br><img src="/images/2016/0812/2.jpg" alt="发送表情报错"><br><a id="more"></a><br>Google了一把，原因是因为表情存储需要4个字节，但是mysql的utf8字符集编码只支持1-3个字节，存储空间不够就报错了，因此需要升级一下字符集。<br>MYSQL 5.5.3之后的版本支持UTF8MB4字符集，一个字符最多能有4字节，此字符集也是完全兼容utf8的，不存在兼容性问题。<br>升级完mysql-server之后<br><img src="/images/2016/0812/3.jpg" alt="升级后的mysql版本"></p><p>修改配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[client]</div><div class="line">default-character-set = utf8mb4</div><div class="line">[mysql]</div><div class="line">default-character-set = utf8mb4</div><div class="line">[mysqld]</div><div class="line">character-set-client-handshake = FALSE</div><div class="line">character-set-server = utf8mb4</div><div class="line">collation-server = utf8mb4_unicode_ci</div><div class="line">init_connect=&apos;SET NAMES utf8mb4&apos;</div></pre></td></tr></table></figure></p><p>修改完这些配置文件后，之后创建的库、表就是utf8mb4格式了，但是之前的收据就需要手动修改一下了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ALTER DATABASE database_name CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci;</div><div class="line">ALTER TABLE table_name CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;</div><div class="line">ALTER TABLE table_name CHANGE column_name VARCHAR(191) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;</div></pre></td></tr></table></figure></p><p>重启mysql，查看字符集<br><code>/etc/init.d/mysqld restart</code></p><p><strong>使用utf8mb4，需注意</strong>：<br>1.mysql-server 版本需要高于5.5.3<br>2.mysql-connector 版本需要高于5.1.3版本(建议升级到最新版，目前是5.1.39)</p><p><img src="/images/2016/0812/4.jpg" alt="查看字符集"><br>参考：<br><a href="http://www.wangyuxiong.com/blog/mysql-dbzi-fu-ji-sheng-ji-zhi-utf8mb4,24/" target="_blank" rel="external">http://www.wangyuxiong.com/blog/mysql-dbzi-fu-ji-sheng-ji-zhi-utf8mb4,24/</a><br><a href="https://segmentfault.com/a/1190000000616820" target="_blank" rel="external">https://segmentfault.com/a/1190000000616820</a></p>]]></content>
      
      
      <categories>
          
          <category> Troubleshooting </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>正在启动windows卡住故障的填坑之路</title>
      <link href="/arlo/4c7121ca/"/>
      <url>/arlo/4c7121ca/</url>
      
        <content type="html"><![CDATA[<h1 id="事件起因"><a href="#事件起因" class="headerlink" title="事件起因"></a>事件起因</h1><p>同事新买了一个ThinkPad E460，出厂系统为Windows8.1，希望修改为win7，于是开始了我的填坑之路，此故障之前在联想的S405上也遇到了一次。</p><h1 id="故障现象"><a href="#故障现象" class="headerlink" title="故障现象"></a>故障现象</h1><p>安装完操作系统后，出现“正在启动windows卡住”，如图:</p><p><img src="/images/2016/0809/1.jpg" alt="Alttext"></p><a id="more"></a><ul><li>更换安装版镜像</li><li>BIOS中硬盘模式调整</li><li>PE中重新分区</li><li>使用mhdd工具扫描硬盘</li></ul><p>做了以上步骤，实在是黔驴技穷啊，于是联系了ThinkPad的客服人员！</p><h2 id="使用安装版镜像，不能发现硬盘问题"><a href="#使用安装版镜像，不能发现硬盘问题" class="headerlink" title="使用安装版镜像，不能发现硬盘问题"></a>使用安装版镜像，不能发现硬盘问题</h2><p>官方客服给出的故障原因是，“原生Win7系统不包含USB3.0的驱动，所以无法使用USB3.0的U盘在USB3.0的设备上引导，且安装完系统后还需要重新安装USB3.0驱动”</p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><blockquote><p><strong><em>注：此方案仅适用于Intel芯片组的机型，AMD芯片组的机型将无法使用,文档中写明支持win7 32位系统，但是实测部分32位系统会存在问题，建议使用win7 64位系统安装</em></strong></p></blockquote><ul><li>从Intel官网下载<a href="https://downloadcenter.intel.com/zh-cn/download/25476/Windows7-USB3-0Creator" target="_blank" rel="external">Windows7 USB3.0 Creator 实用程序</a></li><li>解压缩之前下载的软件，在解压缩路径下右键以管理员方式运行Installer_Creator.exe<br><img src="/images/2016/0809/2.png" alt="Alt text"></li><li>在弹出界面中点击右侧的选择按钮，选中U盘所在分区<br><img src="/images/2016/0809/3.png" alt="Alt text"></li><li>点击Create Image开始往U盘中添加程序，过程会比较长，Intel官方数据是15分钟，实测超过20分钟<br><img src="/images/2016/0809/4.png" alt="Alt text"></li><li>在出现Upadte finished！后创建结束，现在就可以使用这个U盘在USB 3.0接口上安装系统了<br><img src="/images/2016/0809/8.jpg" alt="Alt text"><br>使用安装完补丁的U盘安装完系统USB3.0驱动会自动安装上。<h1 id="坑"><a href="#坑" class="headerlink" title="坑"></a>坑</h1><h2 id="坑一："><a href="#坑一：" class="headerlink" title="坑一："></a>坑一：</h2>win7，win8.1，win10 均不能讲此驱动安装到U盘上，报错如下图<br><img src="/images/2016/0809/15.png" alt="Alt text"><h2 id="坑二"><a href="#坑二" class="headerlink" title="坑二"></a>坑二</h2>更换Ghost版本的镜像，安装完操作系统后依然是启动到“正在启动windows”卡主，进入安全模式卡在“\Windows\System32\drivers\ahcix64s.sys 界面”<h2 id="坑三"><a href="#坑三" class="headerlink" title="坑三"></a>坑三</h2></li><li>使用DG格式化整个硬盘</li><li>重建分区表</li><li>更换分区类型（MBR/GPT）</li><li>激活主分区<h2 id="其他坑"><a href="#其他坑" class="headerlink" title="其他坑"></a>其他坑</h2><a href="http://iknow.lenovo.com/detail/dc_093720.html" target="_blank" rel="external">预装Win8/8.1系统的电脑改装为Win7系统的操作步骤及常见问题</a></li></ul><h1 id="填坑"><a href="#填坑" class="headerlink" title="填坑"></a>填坑</h1><p>使用<a href="https://www.microsoft.com/en-us/download/windows-usb-dvd-download-tool" target="_blank" rel="external">Windows 7 USB DVD Download Tool</a>或者软碟通（UltraISO）制作Win7原版安装盘（不要使用Ghost镜像制作，否则后续会有报错）</p><ul><li>使用Win7光盘或者U盘（建议usb2.0的U盘）引导，进入系统安装界面<br><img src="/images/2016/0809/21.jpg" alt="Alt text"></li><li>按Shift + F10打开命令提示符。(Edge系列机器需要按Fn+Shift+F10)<br><img src="/images/2016/0809/22.jpg" alt="Alt text"></li><li>输入”Diskpart”(不用输入引号，下同)，并按回车，进入操作界面<br><img src="/images/2016/0809/23.jpg" alt="Alt text"></li><li>输入：”list空格disk”，查看磁盘信息。注意看磁盘容量来选择。图中465G的Disk 0是硬盘，3852M的Disk 1是用于Win7安装的U盘<br><img src="/images/2016/0809/24.jpg" alt="Alt text"></li><li>输入：”select 空格disk空格 0”，选择disk 0为当前操作的磁盘<br><img src="/images/2016/0809/25.jpg" alt="Alt text"></li><li>输入：”Clean”，清空当前磁盘分区。<br><img src="/images/2016/0809/26.jpg" alt="Alt text"></li><li>输入：”convert 空格 mbr”，转换为MBR分区。<br><img src="/images/2016/0809/27.jpg" alt="Alt text"></li><li>操作完成，关闭此命令提示符窗口，继续按照正常的方法安装Win7系统即可（由于我坑一中的usb3.0 的驱动没有填好，就使用PE安装ghost版本的镜像安装了）。</li></ul><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>这个故障是我在安装操作系统的时候遇到的最棘手的问题，最主要的步骤就是在dos模式下清空一下磁盘分区；这里只是记录了其中最主要的几个坑，希望给遇到的朋友一些参考。</p><hr>]]></content>
      
      
      <categories>
          
          <category> Troubleshooting </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Hexo博客搭建简记</title>
      <link href="/arlo/e5e5519a/"/>
      <url>/arlo/e5e5519a/</url>
      
        <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>博客是我记录学习过程最好的方式；我的第一个博客是百度空间，后来百度关闭了；第二个博客是ChinaUnix，最近ChinaUnix升级了安全，牛盾老是阻止我访问，再者ChinaUnix风格太老了，写出来的东西也不漂亮，于是就想自己搭建一个博客，现在的blog有很多，比如wordpress，ghost，等等，<a href="http://kaimingwan.com/post/gong-ju/farbox-jekyll-octopress-ghost-hexodeng-zhu-liu-bo-ke-sheng-cheng-qi-te-dian-gai-xuan-ze-na-ge" target="_blank" rel="external">比较之下</a>觉得hexo有逼格，高大上，就你了！<br><a id="more"></a></p><h1 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h1><h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul><li>Node.js</li><li>Git</li><li>Github</li><li>MarkDown 编辑器</li></ul><h2 id="软件获取"><a href="#软件获取" class="headerlink" title="软件获取"></a>软件获取</h2><p><a href="https://nodejs.org/en/download/" target="_blank" rel="external">下载nodejs</a><br><a href="https://git-scm.com/download/" target="_blank" rel="external">下载git</a>  </p><h2 id="安装过程"><a href="#安装过程" class="headerlink" title="安装过程"></a>安装过程</h2><h3 id="安装git"><a href="#安装git" class="headerlink" title="安装git"></a>安装git</h3><p>start–&gt;next–&gt;end(详细过程略)</p><h3 id="安装nodejs"><a href="#安装nodejs" class="headerlink" title="安装nodejs"></a>安装nodejs</h3><p>start–&gt;next–&gt;end(详细过程略)</p><h3 id="安装hexo"><a href="#安装hexo" class="headerlink" title="安装hexo"></a>安装hexo</h3><ul><li><strong>开始安装Hexo</strong><br><code>npm install -g hexo</code>  </li><li><strong>初始化博客</strong><br><code>hexo init</code>  #默认路径为当前目录，可以在init后手动指定一个目录为博客根目录</li><li><strong>生成静态页面</strong><br><code>hexo g</code>  #完整命令hexo generate</li><li><strong>启动本地服务</strong><br><code>hexo s</code>  #完整命令hexo server，默认启动范围地址 <a href="http://localhost:4000" target="_blank" rel="external">http://localhost:4000</a> 可以使用-p指定端口<br>至此hexo 博客安装完毕</li></ul><h2 id="github"><a href="#github" class="headerlink" title="github"></a>github</h2><p>注册并登陆github<br>创建一个与自己用户名对应的项目(如：nsxq.github.io)</p><h2 id="配置hexo"><a href="#配置hexo" class="headerlink" title="配置hexo"></a>配置hexo</h2><p>hexo的主配置文件就是blog主目录下的_config.yml文件咯<br>打开文件，在配置文件最末尾，修改配置为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">type: git</div><div class="line">repo: git@github.com:nsxq/nsxq.github.io.git</div><div class="line">branch: master</div></pre></td></tr></table></figure></p><ul><li><p>安装插件，支持hexo提交到github<br><code>npm install hexo-deployer-git --save</code>  </p></li><li><p>提交blog数据到github<br><code>hexo d**  #完整命令 hexo deploy</code></p></li></ul><h2 id="更换皮肤next"><a href="#更换皮肤next" class="headerlink" title="更换皮肤next"></a>更换皮肤next</h2><p>目前我看到的最漂亮的皮肤就是next<br><code>git clone https://github.com/iissnan/hexo-theme-next</code><br>复制hexo-theme-next目录到hexo\themes\为next<br>修改_config.yml中配置项theme: next<br>next主题默认的Next.Muse,可以在主题配置文件hexo\themes\next_config.yml中修改Schemes<br><a href="http://prozhuchen.com/2015/10/05/Hexo%E5%8D%9A%E5%AE%A2%E4%B9%8B%E6%94%B9%E5%AD%97%E4%BD%93/" target="_blank" rel="external">更换字体</a></p><h2 id="图片居左"><a href="#图片居左" class="headerlink" title="图片居左"></a>图片居左</h2><p>修改E:\Hexo\themes\next\source\css_custom\custom.styl<br><code>.post-body .fancybox img {    margin-left: 0 !important;}</code></p><h1 id="将blog发布到公网"><a href="#将blog发布到公网" class="headerlink" title="将blog发布到公网"></a>将blog发布到公网</h1><ul><li>我的在阿里云（原万网）上买的域名，设置一条CNAME即可<br>CNAME    @    默认    nsxq.github.io    </li><li>在hexo\source 目录下新建一个文件CNAME，内容为<br>islocal.cc</li><li>修改_config.yml中url为<br>url: <a href="http://islocal.cc">http://islocal.cc</a>  </li><li>hexo g</li><li>hexo d<br>浏览器就可以使用<a href="http://islocal.cc">http://islocal.cc</a> 访问blog了</li></ul><h1 id="文章链接唯一化"><a href="#文章链接唯一化" class="headerlink" title="文章链接唯一化"></a>文章链接唯一化</h1><p>修改站点配置文件E:\Hexo_config.yml<br>permalink: arlo/:abbrlink/<br>abbrlink:<br>  alg: crc32  # 算法：crc16(default) and crc32<br>  rep: hex    # 进制：dec(default) and hex</p><h1 id="编写第一篇博文"><a href="#编写第一篇博文" class="headerlink" title="编写第一篇博文"></a>编写第一篇博文</h1><ul><li>是不是终于搭建完成了，懵逼了，完全不知道干吗了？</li><li>是不是搭建完发现blog上不能直接编写很惊讶？</li><li>是不是终于google到可以使用markdown语法编写，从来没用过？</li><li>这都不是事儿！<br><strong>教程奉上</strong><br><a href="http://www.hais2.com/2016/03/07/Hexo%20Getting%20Started%206/" target="_blank" rel="external">markdown快速入门</a><br><a href="http://wowubuntu.com/markdown/basic.html" target="_blank" rel="external">Hexo博客的写作</a><br><strong>工具奉上</strong><br><a href="https://maxiang.io/" target="_blank" rel="external">马克飞象</a><br><a href="http://mahua.jser.me/" target="_blank" rel="external">在线markdown编辑器</a><br><a href="http://www.franktly.com/2016/07/06/%E8%AE%A9Baidu%E5%92%8CGoogle%E6%94%B6%E5%BD%95Hexo%E5%8D%9A%E5%AE%A2/" target="_blank" rel="external">让Baidu和Google收录Hexo博客</a></li></ul><h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><p><a href="https://hexo.io/zh-cn/docs/" target="_blank" rel="external">Hexo官方中文文档</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
  
  
</search>
