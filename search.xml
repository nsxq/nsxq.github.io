<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>Oracle 11g静默安装官方提供的examples</title>
      <link href="/arlo/56125275/"/>
      <content type="html"><![CDATA[<p>之前安装oracle的时候，没有安装默认的示例，练习过程中，教程常用的hr等用户都没有，可以从官网下载示例来安装。</p><h1 id="下载官方example包"><a href="#下载官方example包" class="headerlink" title="下载官方example包"></a>下载官方example包</h1><p>登录<a href="http://www.oracle.com" target="_blank" rel="external">http://www.oracle.com</a> 到下载页浏览就可以找到名为 linux.x64_11gR2_examples.zip<br><code>unzip linux.x64_11gR2_examples.zip</code><br><a id="more"></a></p><h1 id="编辑rsp静默安装文件"><a href="#编辑rsp静默安装文件" class="headerlink" title="编辑rsp静默安装文件"></a>编辑rsp静默安装文件</h1><p><code>cp examples/response/demos_install.rsp .</code><br><code>egrep -v &quot;^$|^#&quot; /home/oracle/demos_install.rsp</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">ORACLE_HOSTNAME=siluxa_oracle</div><div class="line">UNIX_GROUP_NAME=oinstall</div><div class="line">INVENTORY_LOCATION=/u01/app/oraInventory/</div><div class="line">SELECTED_LANGUAGES=en,zh_CN</div><div class="line">ORACLE_HOME=/u01/app/oracle/product/11.1.0/db_1</div><div class="line">ORACLE_BASE=/u01/app/oracle</div></pre></td></tr></table></figure></p><h1 id="静默安装example"><a href="#静默安装example" class="headerlink" title="静默安装example"></a>静默安装example</h1><p><code>./runInstaller -silent -responseFile /home/oracle/demos_install.rsp -ignorePrereq</code></p><h1 id="执行sql脚本文件，安装特定模式"><a href="#执行sql脚本文件，安装特定模式" class="headerlink" title="执行sql脚本文件，安装特定模式"></a>执行sql脚本文件，安装特定模式</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">[oracle@siluxa_oracle human_resources]$ sqlplus sys/solution as sysdba</div><div class="line"></div><div class="line">SQL*Plus: Release 11.2.0.1.0 Production on Fri May 4 18:01:11 2018</div><div class="line"></div><div class="line">Copyright (c) 1982, 2009, Oracle.  All rights reserved.</div><div class="line"></div><div class="line"></div><div class="line">Connected to:</div><div class="line">Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production</div><div class="line">With the Partitioning, OLAP, Data Mining and Real Application Testing options</div><div class="line"></div><div class="line">SYS@orcl&gt;  @?/demo/schema/human_resources/hr_main.sql</div><div class="line"></div><div class="line">specify password for HR as parameter 1:</div><div class="line">Enter value for 1: 123</div><div class="line"></div><div class="line">specify default tablespeace for HR as parameter 2:</div><div class="line">Enter value for 2: users</div><div class="line"></div><div class="line">specify temporary tablespace for HR as parameter 3:</div><div class="line">Enter value for 3: temp</div><div class="line"></div><div class="line">specify password for SYS as parameter 4:</div><div class="line">Enter value for 4: solution</div><div class="line"></div><div class="line">specify log path as parameter 5:</div><div class="line">Enter value for 5: $ORACLE_HOME/demo/schema/log/</div></pre></td></tr></table></figure><p><img src="/images/2018/0504/01.png" alt="z"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">HR@orcl&gt; select table_name from user_tables;</div><div class="line"></div><div class="line">TABLE_NAME</div><div class="line">------------------------------</div><div class="line">REGIONS</div><div class="line">LOCATIONS</div><div class="line">JOB_HISTORY</div><div class="line">JOBS</div><div class="line">EMPLOYEES</div><div class="line">DEPARTMENTS</div><div class="line">COUNTRIES</div><div class="line"></div><div class="line">7 rows selected.</div></pre></td></tr></table></figure></p><p>这样就算安装完成了，可以使用hr进行学习了。</p><p>参考地址：<a href="https://blog.csdn.net/smstong/article/details/45891187" target="_blank" rel="external">https://blog.csdn.net/smstong/article/details/45891187</a></p>]]></content>
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>将绿色版Tomcat/Nginx注册成服务，实现开机自启动</title>
      <link href="/arlo/956f976/"/>
      <content type="html"><![CDATA[<p>我们常用的Tomcat，不管是在windows下还是linux下基本上都是绿色版本，解压、启动后直接使用。<br>这就产生了一个问题，不能开机自自动，很不方便，linux下可以添加到/etc/rc.local实现开机自启，windows下也可以添加到开机启动项里；不过注册为系统服务更加方便一些，这里记录一下方法。<br><a id="more"></a></p><h1 id="注册Tomcat服务"><a href="#注册Tomcat服务" class="headerlink" title="注册Tomcat服务"></a>注册Tomcat服务</h1><h2 id="检查系统环境"><a href="#检查系统环境" class="headerlink" title="检查系统环境"></a>检查系统环境</h2><p>确保64位的操作系统下是64位的Jdk<br><img src="/images/2018/0426/01.png" alt="tomcat"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">F:\&gt;java -d64 -version</div><div class="line">java version &quot;1.7.0_80&quot;</div><div class="line">Java(TM) SE Runtime Environment (build 1.7.0_80-b15)</div><div class="line">Java HotSpot(TM) 64-Bit Server VM (build 24.80-b11, mixed mode)</div></pre></td></tr></table></figure></p><h2 id="使用tomcat自身工具注册服务"><a href="#使用tomcat自身工具注册服务" class="headerlink" title="使用tomcat自身工具注册服务"></a>使用tomcat自身工具注册服务</h2><p>进入到tomcat bin目录下，执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">#注册服务</div><div class="line">service.bat install &apos;服务名&apos; </div><div class="line">#服务名中不能有&quot;-&quot;,&quot;_&quot;，否则在服务中看不到</div><div class="line">F:\apache-tomcat-7.0.70(zabbix)\bin&gt;service.bat install tomcat7070 </div><div class="line">Installing the service &apos;tomcat7070&apos; ...</div><div class="line">Using CATALINA_HOME:    &quot;F:\apache-tomcat-7.0.70(zabbix)&quot;</div><div class="line">Using CATALINA_BASE:    &quot;F:\apache-tomcat-7.0.70(zabbix)&quot;</div><div class="line">Using JAVA_HOME:        &quot;C:\Program Files\Java\jdk1.7.0_80&quot;</div><div class="line">Using JRE_HOME:         &quot;C:\Program Files\Java\jdk1.7.0_80\jre&quot;</div><div class="line">Using JVM:              &quot;C:\Program Files\Java\jdk1.7.0_80\jre\bin\server\jvm.dll&quot;</div><div class="line">The service &apos;tomcat7070&apos; has been installed.</div><div class="line"></div><div class="line">#卸载服务</div><div class="line">service.bat remove &apos;服务名&apos; </div><div class="line"></div><div class="line">F:\apache-tomcat-7.0.70(zabbix)\bin&gt;service.bat remove tomcat7070</div><div class="line">Removing the service &apos;tomcat7070&apos; ...</div><div class="line">Using CATALINA_BASE:    &quot;F:\apache-tomcat-7.0.70(zabbix)&quot;</div><div class="line">The service &apos;tomcat7070&apos; has been removed</div></pre></td></tr></table></figure></p><p><img src="/images/2018/0426/02.png" alt="tomcat"></p><h1 id="注册Nginx服务"><a href="#注册Nginx服务" class="headerlink" title="注册Nginx服务"></a>注册Nginx服务</h1><h2 id="下载Windows-Server-2003-Resource-Kit-Tools"><a href="#下载Windows-Server-2003-Resource-Kit-Tools" class="headerlink" title="下载Windows Server 2003 Resource Kit Tools"></a>下载Windows Server 2003 Resource Kit Tools</h2><p>其实我们只需要里边instsrv.exe、srvany.exe这两个工具<br><a href="https://www.microsoft.com/en-IE/download/details.aspx?id=17657" target="_blank" rel="external">https://www.microsoft.com/en-IE/download/details.aspx?id=17657</a></p><h2 id="注册Nginx服务-1"><a href="#注册Nginx服务-1" class="headerlink" title="注册Nginx服务"></a>注册Nginx服务</h2><p>安装完上述工具，打开C:\Program Files (x86)\Windows Resource Kits\Tools， 复制srvany.exe到nginx.exe同级目录下。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sc create &quot;Nginx&quot; binPath=&quot;D:\deploy\nginx-1.12.1\srvany.exe&quot; start=auto</div></pre></td></tr></table></figure></p><h2 id="导入注册表"><a href="#导入注册表" class="headerlink" title="导入注册表"></a>导入注册表</h2><p>复制一下内容，保存为.reg格式文件，双击导入到注册表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Windows Registry Editor Version 5.00 </div><div class="line">[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Nginx\Parameters]  </div><div class="line">&quot;Application&quot;=&quot;D:\\deploy\\nginx-1.12.1\\nginx.exe&quot;  </div><div class="line">&quot;AppParameters&quot;=&quot;&quot;  </div><div class="line">&quot;AppDirectory&quot;=&quot;D:\\deploy\\nginx-1.12.1&quot;</div></pre></td></tr></table></figure></p><h2 id="启动关闭服务"><a href="#启动关闭服务" class="headerlink" title="启动关闭服务"></a>启动关闭服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># 启动</div><div class="line">C:\&gt;net start Nginx</div><div class="line">Nginx 服务正在启动 .</div><div class="line">Nginx 服务已经启动成功。</div><div class="line"># 关闭</div><div class="line">windows下nginx默认会启动两个进程，如果使用net stop Nginx的话只能关闭一个nginx进程，不能完全关闭</div><div class="line">taskkill /F /IM nginx.exe</div></pre></td></tr></table></figure><p>参考资料：<br><a href="http://www.cnblogs.com/xwdreamer/p/3411986.html" target="_blank" rel="external">http://www.cnblogs.com/xwdreamer/p/3411986.html</a><br><a href="http://wlbbswl.iteye.com/blog/840538" target="_blank" rel="external">http://wlbbswl.iteye.com/blog/840538</a><br><a href="https://blog.csdn.net/qq_16022261/article/details/53836004" target="_blank" rel="external">https://blog.csdn.net/qq_16022261/article/details/53836004</a><br><a href="http://koda.iteye.com/blog/600725" target="_blank" rel="external">http://koda.iteye.com/blog/600725</a></p>]]></content>
      
      <categories>
          
          <category> 常识 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tomcat </tag>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Zabbix(9)结合sensor监控cpu温度</title>
      <link href="/arlo/ce74a028/"/>
      <content type="html"><![CDATA[<p>zabbix 可以通过sensors-detect检测内核模块，使用zabbix监控系统自定义监控项，采集监控数据并设置告警。可以监控物理机器(虚拟机获取不到)的温度。<br><a id="more"></a></p><h1 id="安装sensors"><a href="#安装sensors" class="headerlink" title="安装sensors"></a>安装sensors</h1><p>安装、运行sensors，可以看到每颗cpu的温度<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">[root@siluxa2 src]# yum install lm_sensors</div><div class="line">[root@siluxa2 src]# sensors</div><div class="line">i350bb-pci-0100</div><div class="line">Adapter: PCI adapter</div><div class="line">loc1:         +50.0°C  (high = +120.0°C, crit = +110.0°C)</div><div class="line"></div><div class="line">coretemp-isa-0000</div><div class="line">Adapter: ISA adapter</div><div class="line">Physical id 0:  +55.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 0:         +45.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 1:         +46.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 2:         +45.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 3:         +46.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 4:         +46.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 8:         +46.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 9:         +46.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 10:        +46.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 11:        +44.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 12:        +45.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line"></div><div class="line">coretemp-isa-0001</div><div class="line">Adapter: ISA adapter</div><div class="line">Physical id 1:  +49.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 0:         +42.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 1:         +41.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 2:         +41.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 3:         +41.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 4:         +42.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 8:         +41.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 9:         +42.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 10:        +41.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 11:        +41.0°C  (high = +80.0°C, crit = +90.0°C)</div><div class="line">Core 12:        +41.0°C  (high = +80.0°C, crit = +90.0°C)</div></pre></td></tr></table></figure></p><h1 id="配置zabbix-agent客户端文件"><a href="#配置zabbix-agent客户端文件" class="headerlink" title="配置zabbix agent客户端文件"></a>配置zabbix agent客户端文件</h1><p>修改客户端配置文件zabbix_agentd.conf<br>第一次自定义监控时要设置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">UnsafeUserParameters=1</div></pre></td></tr></table></figure></p><p>在配置文件中添加一行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">UserParameter=get_temp_cpu[*],sensors|grep &quot;Physical id $1&quot;|cut -c 17-20</div></pre></td></tr></table></figure></p><h1 id="添加监控项"><a href="#添加监控项" class="headerlink" title="添加监控项"></a>添加监控项</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">sensor[device,sensor,&lt;mode&gt;]</div><div class="line">读取硬件传感器</div><div class="line">device - 设备名称  </div><div class="line">sensor - 传感器名称  </div><div class="line">mode - 可选值:avg, max, min</div><div class="line">示例key: sensor[w83781d-i2c-0-2d,temp1] Prior to Zabbix 1.8.4, the sensor[temp1] format was used. On Linux 2.6+, 读取/sys/class/hwmon. On OpenBSD, 读取hw.sensors MIB.示例keys: sensor[cpu0,temp0] – CPU0的温度 sensor[cpu[0-2]$,temp,avg] – cpu平均温度Zabbix 1.8.4开始支持OpenBSD</div></pre></td></tr></table></figure><p>我这里添加两颗cpu为例！<br><img src="/images/2018/0419/01.png" alt="z"><br><img src="/images/2018/0419/02.png" alt="z"></p><h1 id="添加触发器"><a href="#添加触发器" class="headerlink" title="添加触发器"></a>添加触发器</h1><p><img src="/images/2018/0419/03.png" alt="z"><br><img src="/images/2018/0419/04.png" alt="z"></p><h1 id="添加图形"><a href="#添加图形" class="headerlink" title="添加图形"></a>添加图形</h1><p><img src="/images/2018/0419/05.png" alt="z"></p><h1 id="查看图形"><a href="#查看图形" class="headerlink" title="查看图形"></a>查看图形</h1><p><img src="/images/2018/0419/06.png" alt="z"></p><p>参考链接：<a href="http://xy.uyun.cn/post/1865.html" target="_blank" rel="external">http://xy.uyun.cn/post/1865.html</a></p>]]></content>
      
      <categories>
          
          <category> 监控 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 自动化 </tag>
            
            <tag> 运维 </tag>
            
            <tag> zabbix </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Zabbix(8)使用ansible批量部署zabbix agent</title>
      <link href="/arlo/7c94dafb/"/>
      <content type="html"><![CDATA[<p>相同系统环境部署zabbix agent，可以使用ansible playbook来实现，大概分为以下几步。<br><a id="more"></a></p><h1 id="ansible-目录结构"><a href="#ansible-目录结构" class="headerlink" title="ansible 目录结构"></a>ansible 目录结构</h1><p>[root@sl_confluence ansible]# pwd<br>/etc/ansible<br>[root@sl_confluence ansible]# tree<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">.</div><div class="line">├── ansible.cfg</div><div class="line">├── hosts</div><div class="line">├── roles</div><div class="line">│   └── zabbix_agent</div><div class="line">│       ├── files</div><div class="line">│       │   └── zabbix-agent-3.4.8-1.el6.x86_64.rpm</div><div class="line">│       ├── tasks</div><div class="line">│       │   └── main.yml</div><div class="line">│       └── templates</div><div class="line">│           └── zabbix_agentd.conf.j2</div><div class="line">└── zabbix_agent.yml</div><div class="line"></div><div class="line">5 directories, 6 files</div></pre></td></tr></table></figure></p><h1 id="查看-hosts文件"><a href="#查看-hosts文件" class="headerlink" title="查看 hosts文件"></a>查看 hosts文件</h1><p>[root@sl_confluence ansible]#  cat hosts<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[zabbix_agent]</div><div class="line">dbserver</div></pre></td></tr></table></figure></p><p>[root@sl_confluence ansible]# cat zabbix_agent.yml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">- hosts: zabbix_agent</div><div class="line">  user: root</div><div class="line">  vars:</div><div class="line">     zabbix_serverip: 192.168.6.186 # zabbix 服务器IP</div><div class="line">     zabbix_activeip: 192.168.6.186 # zabbix 服务器IP</div><div class="line">     agent_hostname: &apos;&#123;&#123; ansible_hostname &#125;&#125;&apos; # 客户端hostname</div><div class="line">     agent_ip: &apos;&#123;&#123; ansible_eth0.ipv4.address &#125;&#125;&apos; # 客户端IP 根据实际情况修改自己的网卡名字eth0 改成自己服务器</div><div class="line">  roles:</div><div class="line">    - zabbix_agent</div></pre></td></tr></table></figure></p><p>[root@sl_confluence tasks]# cat main.yml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- name: copy zabbix_agentd </div><div class="line">  copy: src=/etc/ansible/roles/zabbix_agent/files/zabbix-agent-3.4.8-1.el6.x86_64.rpm dest=/usr/local/src/zabbix-agent-3.4.8-1.el6.x86_64.rpm</div><div class="line">- name: install zabbix-agend</div><div class="line">  shell: rpm -ivh /usr/local/src/zabbix-agent-3.4.8-1.el6.x86_64.rpm # 安装zabbix agentd</div><div class="line">- name: up zabbix-agent file client  # 上传配置文件</div><div class="line">  template: src=zabbix_agentd.conf.j2 dest=/etc/zabbix/zabbix_agentd.conf</div><div class="line">- name: enabled service zabbix-agent # 打开zabbix-agent 开机启动</div><div class="line">  service: name=zabbix-agent enabled=yes</div><div class="line">- name: start  service zabbix-agent # 启动zabbix-agent</div><div class="line">  service: name=zabbix-agent  state=started</div></pre></td></tr></table></figure></p><h1 id="定义zabbix-agent-conf模板文件"><a href="#定义zabbix-agent-conf模板文件" class="headerlink" title="定义zabbix_agent.conf模板文件"></a>定义zabbix_agent.conf模板文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@sl_confluence templates]# cat zabbix_agentd.conf.j2 </div><div class="line">PidFile=/var/run/zabbix/zabbix_agentd.pid</div><div class="line">LogFile=/var/log/zabbix/zabbix_agentd.log</div><div class="line">EnableRemoteCommands=1</div><div class="line">Server=&#123;&#123;zabbix_serverip&#125;&#125;</div><div class="line">ListenPort=10050</div><div class="line">ServerActive=&#123;&#123;zabbix_activeip&#125;&#125;</div><div class="line">Hostname=&#123;&#123;ansible_hostname&#125;&#125;</div><div class="line">AllowRoot=1</div><div class="line">Include=/etc/zabbix/zabbix_agentd.d/*.conf</div></pre></td></tr></table></figure><h1 id="执行安装"><a href="#执行安装" class="headerlink" title="执行安装"></a>执行安装</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible-playbook zabbix_agent.yml</div></pre></td></tr></table></figure><p><img src="/images/2018/0417/04.png" alt="z"></p>]]></content>
      
      <categories>
          
          <category> 监控 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 自动化 </tag>
            
            <tag> 运维 </tag>
            
            <tag> Ansible </tag>
            
            <tag> zabbix </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Zabbix(7)监控端口、服务存活</title>
      <link href="/arlo/429ab963/"/>
      <content type="html"><![CDATA[<p>之前添加的tomcat监控，只能监控到jvm，类，线程之类的参数，不能监控tomcat本身的存活状态，总感觉有点美中不足；网上找了下，监控端口、服务还是挺简单的，这里记录一下。<br><a id="more"></a></p><h1 id="zabbix有三种监控端口的监控项方法"><a href="#zabbix有三种监控端口的监控项方法" class="headerlink" title="zabbix有三种监控端口的监控项方法"></a>zabbix有三种监控端口的监控项方法</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line">1.net.tcp.listen[port] </div><div class="line">用于监听端口是否开启 </div><div class="line">1表示开启 0表示未开启 </div><div class="line">2.net.tcp.port[,port] </div><div class="line">是否 可 以 </div><div class="line">连 接 到 指 </div><div class="line">定的 TCP </div><div class="line">端口 </div><div class="line">0 – 无法连接 </div><div class="line">1 – 可以连接 </div><div class="line">ip – IP 地址(默认是 127.0. </div><div class="line">0.1) </div><div class="line">port – 端口 </div><div class="line">范例: </div><div class="line">net.tcp.port[,80] </div><div class="line">检测 web 服务器端口是否运行中</div><div class="line">3.net.tcp.service[service,,] </div><div class="line">检 测 服 务 </div><div class="line">是否开启， </div><div class="line">并 且 端 口 </div><div class="line">可用 </div><div class="line">0 – 服务挂了 </div><div class="line">1 – 服务运行中 </div><div class="line">service – 如下: ssh, ntp, </div><div class="line">ldap, smtp, ftp, http, p </div><div class="line">op, nntp,imap, tcp, https, telnet </div><div class="line">ip – IP地址 (默认127.0.0. </div><div class="line">1) </div><div class="line">port – 端口 (默认情况为标 </div><div class="line">准端口号) </div><div class="line">示例 key: </div><div class="line">net.tcp.service[ftp,,45] – 检测 45 端口 </div><div class="line">上得 FTP 是否运行中 </div><div class="line">Zabbix 1.8.3 支持的版本请使用 service.n </div><div class="line">tp 代替 ntp. </div><div class="line">https 和 telnet 服务从 2.0 和 2.2 开始支持</div><div class="line"></div><div class="line">4.net.tcp.service.perf[service,,] </div><div class="line">检 测 服 务 </div><div class="line">器性能 </div><div class="line">0 – 服务挂了; </div><div class="line">seconds – 链接到 </div><div class="line">服务器端口消耗的时 </div><div class="line">间 </div><div class="line">service – 如下:ssh, ntp, </div><div class="line">ldap, smtp, ftp, http, po </div><div class="line">p, nntp,imap, tcp, https, </div><div class="line">telnet </div><div class="line">ip – IP地址 (默认127.0.0. </div><div class="line">1) </div><div class="line">port – 端口 (默认情况为标 </div><div class="line">准端口号)</div><div class="line">5.net.udp.listen[port] </div><div class="line">检测 UDP </div><div class="line">端 口 是 否 </div><div class="line">在监听 </div><div class="line">0 – 未监听 </div><div class="line">1 – 监听中 </div><div class="line">port – udp 端口 范例: </div><div class="line">net.udp.listen[68]</div></pre></td></tr></table></figure><h1 id="监控tomcat-8080端口"><a href="#监控tomcat-8080端口" class="headerlink" title="监控tomcat 8080端口"></a>监控tomcat 8080端口</h1><h2 id="添加监控项"><a href="#添加监控项" class="headerlink" title="添加监控项"></a>添加监控项</h2><p><img src="/images/2018/0417/01.png" alt="z"></p><h2 id="添加触发器"><a href="#添加触发器" class="headerlink" title="添加触发器"></a>添加触发器</h2><p><img src="/images/2018/0417/02.png" alt="z"></p><h2 id="添加图形"><a href="#添加图形" class="headerlink" title="添加图形"></a>添加图形</h2><p><img src="/images/2018/0417/03.png" alt="z"></p><p>参考链接：<a href="http://www.cnblogs.com/saneri/p/6126786.html" target="_blank" rel="external">http://www.cnblogs.com/saneri/p/6126786.html</a></p>]]></content>
      
      <categories>
          
          <category> 监控 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> zabbix </tag>
            
            <tag> 监控 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Centos6环境下搭建及破解confluence</title>
      <link href="/arlo/58cb2af9/"/>
      <content type="html"><![CDATA[<blockquote><p>Confluence是一个专业的企业知识管理与协同软件，也可以用于构建企业wiki。使用简单，但它强大的编辑和站点管理特征能够帮助团队成员之间共享信息、文档协作、集体讨论，信息推送。【来自百度百科】</p></blockquote><a id="more"></a><p>我们只是需要一个知识库……<br>公司没有专门的知识库，企业wiki，团队的人资料文档都放在自己手里，你懂的？工作的文档一直都是svn提交，查看起来很不方便；长时间下来，没有技术共享、交流，积累；多方询问，别人推荐使用confluence，先搭建起来用用看。</p><h1 id="系统环境"><a href="#系统环境" class="headerlink" title="系统环境"></a>系统环境</h1><p>Centos 6.9<br>Jdk 1.8.112<br>Mysql 5.7.20<br>Atlassian-confluence-6.3.1</p><h1 id="安装jdk"><a href="#安装jdk" class="headerlink" title="安装jdk"></a>安装jdk</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">tar xf jdk-8u112-linux-x64.tar.gz -C /usr/local/</div><div class="line">-- 配置环境变量</div><div class="line">vim /etc/profile</div><div class="line">export JAVA_HOME=/usr/local/jdk1.8.0_112/</div><div class="line">export CLASSPATH=.:$JAVA_HOME/lib/:$JAVA_HOME/jre/lib/</div><div class="line">export PATH=$JAVA_HOME/bin:$PATH</div><div class="line">-- 使环境变量生效</div><div class="line">source /etc/profile</div></pre></td></tr></table></figure><h1 id="安装mysql"><a href="#安装mysql" class="headerlink" title="安装mysql"></a>安装mysql</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">wget https://mirrors.huaweicloud.com/repository/toolkit/mysql/Downloads/MySQL-5.7/mysql-5.7.20-1.el6.x86_64.rpm-bundle.tar</div><div class="line">tar xf mysql-5.7.20-1.el6.x86_64.rpm-bundle.tar </div><div class="line">yum localinstall mysql-community-common-5.7.20-1.el6.x86_64.rpm mysql-community-client-5.7.20-1.el6.x86_64.rpm mysql-community-server-5.7.20-1.el6.x86_64.rpm mysql-community-libs-compat-5.7.20-1.el6.x86_64.rpm mysql-community-libs-5.7.20-1.el6.x86_64.rpm mysql-community-devel-5.7.20-1.el6.x86_64.rpm</div><div class="line">-- 修改mysql参数</div><div class="line">vim /etc/my.cnf</div><div class="line">max_allowed_packet = 256M</div><div class="line">innodb_log_file_size=512M</div><div class="line">--启动mysqld服务</div><div class="line">/etc/init.d/mysqld start</div><div class="line">--查看初始密码</div><div class="line">grep &apos;temporary password&apos; /var/log/mysqld.log </div><div class="line">2018-04-03T02:44:31.357861Z 1 [Note] A temporary password is generated for root@localhost: OUGiG=n-l8lY</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">[root@3g3MplC6 ~]# mysql -uroot -pOUGiG=n-l8lY</div><div class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</div><div class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</div><div class="line">Your MySQL connection id is 12</div><div class="line">Server version: 5.7.20</div><div class="line"></div><div class="line">Copyright (c) 2000, 2017, Oracle and/or its affiliates. All rights reserved.</div><div class="line"></div><div class="line">Oracle is a registered trademark of Oracle Corporation and/or its</div><div class="line">affiliates. Other names may be trademarks of their respective</div><div class="line">owners.</div><div class="line"></div><div class="line">Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.</div><div class="line">--mysql5.7密码策略比较高，设置一下复杂度和长度</div><div class="line">mysql&gt; set global validate_password_policy=0;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; set global validate_password_length=1;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line">--修改一下root用户的密码为&apos;ffffff&apos;(生产环境不建议这么操作)</div><div class="line">mysql&gt; alter user root@localhost identified by &apos;ffffff&apos;;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line">--创建一个mysql数据库confluence，创建用户confluence，密码为confluencepwd</div><div class="line">mysql -uroot -p&apos;ffffff&apos; -e &quot;create database confluence default character set utf8 collate utf8_bin;grant  all on confluence.* to &apos;confluence&apos;@&apos;%&apos; identified by &apos;confluencepwd&apos;;&quot;</div></pre></td></tr></table></figure><h1 id="安装confluence"><a href="#安装confluence" class="headerlink" title="安装confluence"></a>安装confluence</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">wget https://www.atlassian.com/software/confluence/downloads/binary/atlassian-confluence-6.3.1-x64.bin</div><div class="line">数据库驱动包和破解补丁包: 链接: https://pan.baidu.com/s/1YfwGC2NDBVs3udsVb-i6fA 密码: ix7u</div><div class="line">chmod +x atlassian-confluence-6.3.1-x64.bin</div><div class="line">./atlassian-confluence-6.3.1-x64.bin</div><div class="line">/etc/init.d/confluence stop</div><div class="line">上传以下两个包到此目录下/opt/atlassian/confluence/confluence/WEB-INF/lib</div><div class="line">atlassian-extras-3.2.jar</div><div class="line">mysql-connector-java-5.1.42-bin.jar</div><div class="line">/etc/init.d/confluence start</div></pre></td></tr></table></figure><p>可以看到安装目录为<br>Installation Directory: /opt/atlassian/confluence<br>Home Directory: /var/atlassian/application-data/confluence<br>默认端口为8090<br><img src="/images/2018/0403/01.png" alt="confluence"></p><h1 id="配置confluence"><a href="#配置confluence" class="headerlink" title="配置confluence"></a>配置confluence</h1><p><a href="http://192.168.6.186:8090" target="_blank" rel="external">http://192.168.6.186:8090</a></p><h2 id="设置为中文语言"><a href="#设置为中文语言" class="headerlink" title="设置为中文语言"></a>设置为中文语言</h2><p><img src="/images/2018/0403/02.png" alt="confluence"></p><h2 id="产品安装"><a href="#产品安装" class="headerlink" title="产品安装"></a>产品安装</h2><p><img src="/images/2018/0403/03.png" alt="confluence"></p><h2 id="直接下一步"><a href="#直接下一步" class="headerlink" title="直接下一步"></a>直接下一步</h2><p><img src="/images/2018/0403/04.png" alt="confluence"></p><h2 id="复制服务器ID，点击获得授权码"><a href="#复制服务器ID，点击获得授权码" class="headerlink" title="复制服务器ID，点击获得授权码"></a>复制服务器ID，点击获得授权码</h2><p><img src="/images/2018/0403/05.png" alt="confluence"></p><h2 id="参考图片设置"><a href="#参考图片设置" class="headerlink" title="参考图片设置"></a>参考图片设置</h2><p><img src="/images/2018/0403/06.png" alt="confluence"><br><img src="/images/2018/0403/07.png" alt="confluence"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">服务器ID：</div><div class="line">BZ0A-OLZE-ZYYB-3PFX</div><div class="line">授权码：</div><div class="line">AAABLA0ODAoPeNptkF9rwjAUxd/zKQJ72PYQSaOiCIFp24FQragbU/aShesWqLHepKLffqmdzP15C</div><div class="line">ISce8753dwsK6DDEilvU84HXT4QEY2TJRU86pMEnEZTerOzMt7ZTVGB1UDvFoAHwPvXAU0PqqhUP</div><div class="line">UBihPMlUR5kbWe8w3ibBKNX2k/VFmTE+/2e6ImH/b6ld1uiQ2griOYA0mMFzcPCK/SAcqMKBxd/O</div><div class="line">lGm+BPw3X/lz4wG62B5KuHcGueTSTqPx8OMFI30DOhqjyAh1XqwKuyVHkuDpyv8bo2f47uyxjUdR</div><div class="line">3OrLGnWHydytOZDlmfrlK1XqxFrzx5fyCKdynBYFkWdnhC8S75wwnw2Tn5KZ9xptX0DzDdPLlBJF</div><div class="line">l0M//PMKtQfysHvb/4EqFmR3DAtAhUAjJ5DzWcXkYufaw72NYIZs/rFeJgCFEocDK77ZwHKpPhhI</div><div class="line">vo1bD3HDmJIX02f3</div></pre></td></tr></table></figure></p><p><img src="/images/2018/0403/08.png" alt="confluence"></p><h2 id="选择MySQL"><a href="#选择MySQL" class="headerlink" title="选择MySQL"></a>选择MySQL</h2><p><img src="/images/2018/0403/09.png" alt="confluence"></p><h2 id="选择JDBC"><a href="#选择JDBC" class="headerlink" title="选择JDBC"></a>选择JDBC</h2><p><img src="/images/2018/0403/10.png" alt="confluence"><br>根据下图显示，在数据库URL添加<code>?useSSL=false&amp;amp;useUnicode=true&amp;amp;characterEncoding=utf8</code><br><code>&amp;amp;是代替&amp;</code>，否则启动会报错，这里没有改的话，可以在/var/atlassian/application-data/confluence/confluence.cfg.xml文件中修改<br><img src="/images/2018/0403/11.png" alt="confluence"></p><h2 id="选择空白站点"><a href="#选择空白站点" class="headerlink" title="选择空白站点"></a>选择空白站点</h2><p><img src="/images/2018/0403/12.png" alt="confluence"></p><h2 id="在Confluence中管理用户与组"><a href="#在Confluence中管理用户与组" class="headerlink" title="在Confluence中管理用户与组"></a>在Confluence中管理用户与组</h2><p><img src="/images/2018/0403/13.png" alt="confluence"></p><h2 id="配置系统管理员账户"><a href="#配置系统管理员账户" class="headerlink" title="配置系统管理员账户"></a>配置系统管理员账户</h2><p><img src="/images/2018/0403/14.png" alt="confluence"></p><h2 id="配置完成"><a href="#配置完成" class="headerlink" title="配置完成"></a>配置完成</h2><p><img src="/images/2018/0403/15.png" alt="confluence"></p><h1 id="破解confluence"><a href="#破解confluence" class="headerlink" title="破解confluence"></a>破解confluence</h1><p>替换<code>/opt/atlassian/confluence/confluence/WEB-INF/lib/atlassian-extras-decoder-v2-3.2.jar</code>包，进行破解</p><p>参考链接:<br><a href="https://blog.csdn.net/wh211212/article/details/76131569" target="_blank" rel="external">https://blog.csdn.net/wh211212/article/details/76131569</a><br><a href="http://www.confluence.cn" target="_blank" rel="external">http://www.confluence.cn</a></p>]]></content>
      
      <categories>
          
          <category> 服务器搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> confluence </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Oracle RAC手动启动与关闭及常用命令</title>
      <link href="/arlo/d56aba68/"/>
      <content type="html"><![CDATA[<p>在经历了几次服务器意外断电，启动rac报错；觉得之前直接“shutdown -h now”这种方式还是太“粗暴”，需要一种“温柔”的方式来操作她。</p><h1 id="查看一下RAC节点的服务状态"><a href="#查看一下RAC节点的服务状态" class="headerlink" title="查看一下RAC节点的服务状态"></a>查看一下RAC节点的服务状态</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">[grid@rac1 ~]$ crs_stat -t -v</div><div class="line">Name           Type           R/RA   F/FT   Target    State     Host        </div><div class="line">----------------------------------------------------------------------</div><div class="line">ora.DATA.dg    ora....up.type 0/5    0/     ONLINE    ONLINE    rac1        </div><div class="line">ora....ER.lsnr ora....er.type 0/5    0/     ONLINE    ONLINE    rac1        </div><div class="line">ora....N1.lsnr ora....er.type 0/5    0/0    ONLINE    ONLINE    rac1        </div><div class="line">ora.OCR.dg     ora....up.type 0/5    0/     ONLINE    ONLINE    rac1        </div><div class="line">ora....DISK.dg ora....up.type 0/5    0/     ONLINE    ONLINE    rac1        </div><div class="line">ora.asm        ora.asm.type   0/5    0/     ONLINE    ONLINE    rac1        </div><div class="line">ora.cvu        ora.cvu.type   0/5    0/0    ONLINE    ONLINE    rac1        </div><div class="line">ora.gsd        ora.gsd.type   0/5    0/     OFFLINE   OFFLINE               </div><div class="line">ora....network ora....rk.type 0/5    0/     ONLINE    ONLINE    rac1        </div><div class="line">ora.oc4j       ora.oc4j.type  0/1    0/2    ONLINE    ONLINE    rac2        </div><div class="line">ora.ons        ora.ons.type   0/3    0/     ONLINE    ONLINE    rac1        </div><div class="line">ora.orcl.db    ora....se.type 0/2    0/1    ONLINE    ONLINE    rac1        </div><div class="line">ora....SM1.asm application    0/5    0/0    ONLINE    ONLINE    rac1        </div><div class="line">ora....C1.lsnr application    0/5    0/0    ONLINE    ONLINE    rac1        </div><div class="line">ora.rac1.gsd   application    0/5    0/0    OFFLINE   OFFLINE               </div><div class="line">ora.rac1.ons   application    0/3    0/0    ONLINE    ONLINE    rac1        </div><div class="line">ora.rac1.vip   ora....t1.type 0/0    0/0    ONLINE    ONLINE    rac1        </div><div class="line">ora....SM2.asm application    0/5    0/0    ONLINE    ONLINE    rac2        </div><div class="line">ora....C2.lsnr application    0/5    0/0    OFFLINE   OFFLINE               </div><div class="line">ora.rac2.gsd   application    0/5    0/0    OFFLINE   OFFLINE               </div><div class="line">ora.rac2.ons   application    0/3    0/0    ONLINE    ONLINE    rac2        </div><div class="line">ora.rac2.vip   ora....t1.type 0/0    0/0    ONLINE    ONLINE    rac2        </div><div class="line">ora.scan1.vip  ora....ip.type 0/0    0/0    ONLINE    ONLINE    rac1        </div><div class="line">ora.sx21.db    ora....se.type 0/2    0/1    ONLINE    ONLINE    rac1</div></pre></td></tr></table></figure><a id="more"></a><h1 id="关闭RAC"><a href="#关闭RAC" class="headerlink" title="关闭RAC"></a>关闭RAC</h1><p>关闭顺序：关闭数据库(实例)–&gt;关闭ASM实例–&gt;关闭节点服务</p><h2 id="关闭数据库"><a href="#关闭数据库" class="headerlink" title="关闭数据库"></a>关闭数据库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">--关闭数据库</div><div class="line">srvctl stop database -d sx21</div><div class="line">srvctl stop database -d orcl</div></pre></td></tr></table></figure><h2 id="关闭ASM实例"><a href="#关闭ASM实例" class="headerlink" title="关闭ASM实例"></a>关闭ASM实例</h2><p>从11.2 Grid Infrastructure开始， ASM diskgroups也注册为CRS资源。而diskgroup资源是依赖于ASM的，所以不能首先要停止’ora.ASM.dg’这个服务，或者直接使用-f选项强制停止ASM。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">-- 查看asm磁盘相关信息</div><div class="line">sqlplus / as sysasm</div><div class="line">SQL&gt; select instance_name,status from v$instance;</div><div class="line">SQL&gt; col name format a10</div><div class="line">SQL&gt; set line 9999</div><div class="line">SQL&gt; col path format a15</div><div class="line">SQL&gt; select group_number,path,name,disk_number,total_mb,free_mb,create_date,mount_status,mount_date from v$asm_disk order by group_number desc,disk_number;</div><div class="line">SQL&gt; select name,state,free_mb,required_mirror_free_mb,usable_file_mb from v$asm_diskgroup;</div></pre></td></tr></table></figure></p><p><img src="/images/2018/0402/01.png" alt="rac"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">--关闭磁盘组， 状态从ONLINE变成OFFLINE</div><div class="line">srvctl stop diskgroup -g data</div><div class="line">srvctl stop diskgroup -g ocr</div><div class="line">srvctl stop diskgroup -g votingdisk</div></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">--关闭asm</div><div class="line">srvctl stop asm -n rac1</div><div class="line">srvctl stop asm -n rac2</div></pre></td></tr></table></figure><h2 id="关闭各节点的服务包括：listener、gsd、ons、vip"><a href="#关闭各节点的服务包括：listener、gsd、ons、vip" class="headerlink" title="关闭各节点的服务包括：listener、gsd、ons、vip"></a>关闭各节点的服务包括：listener、gsd、ons、vip</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">srvctl stop nodeapps -n rac1</div><div class="line">srvctl stop nodeapps -n rac2</div></pre></td></tr></table></figure><h1 id="启动RAC"><a href="#启动RAC" class="headerlink" title="启动RAC"></a>启动RAC</h1><p>启动顺序：启动节点服务–&gt;启动ASM实例–&gt;启动数据库实例</p><h2 id="启动各节点的服务包括：listener、gsd、ons、vip"><a href="#启动各节点的服务包括：listener、gsd、ons、vip" class="headerlink" title="启动各节点的服务包括：listener、gsd、ons、vip"></a>启动各节点的服务包括：listener、gsd、ons、vip</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">srvctl start nodeapps -n rac1</div><div class="line">srvctl start nodeapps -n rac2</div></pre></td></tr></table></figure><h2 id="启动asm"><a href="#启动asm" class="headerlink" title="启动asm"></a>启动asm</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">srvctl start asm -n rac1</div><div class="line">srvctl start asm -n rac2</div></pre></td></tr></table></figure><h2 id="启动数据库"><a href="#启动数据库" class="headerlink" title="启动数据库"></a>启动数据库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">srvctl start database -d sx21</div><div class="line">srvctl start database -d orcl</div></pre></td></tr></table></figure><h1 id="RAC常用操作命令"><a href="#RAC常用操作命令" class="headerlink" title="RAC常用操作命令"></a>RAC常用操作命令</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">--查看集群状态</div><div class="line">crsctl stat res -t</div><div class="line">crsctl check cluster -all</div><div class="line">crs_stat -t -v</div><div class="line">--查看数据库配置</div><div class="line">srvctl config database -d sx21</div><div class="line">--查看数据库状态</div><div class="line">srvctl status database -d sx21</div><div class="line">--启动数据库</div><div class="line">srvctl start database -d sx21</div><div class="line">--关闭数据库</div><div class="line">srvctl stop database -d sx21</div><div class="line"></div><div class="line">--查看asm状态</div><div class="line">srvctl status asm -n rac1</div><div class="line">srvctl status asm -n rac2</div><div class="line">--关闭asm 状态从ONLINE变成OFFLINE</div><div class="line">srvctl stop diskgroup -g data</div><div class="line">srvctl stop diskgroup -g ocr</div><div class="line">srvctl stop diskgroup -g votingdisk</div><div class="line">--开启asm </div><div class="line">srvctl start diskgroup -g data</div><div class="line">srvctl start diskgroup -g ocr</div><div class="line">srvctl start diskgroup -g votingdisk</div><div class="line"></div><div class="line">--查看vip状态</div><div class="line">srvctl status vip -n rac1 -v</div><div class="line">--启动vip</div><div class="line">srvctl start vip -n rac1 -v</div><div class="line">--停止vip</div><div class="line">srvctl stop vip -n rac2 -f -v</div><div class="line">srvctl stop vip -n rac1 -f -v</div><div class="line">-- 查看asm磁盘相关信息</div><div class="line">sqlplus / as sysasm</div><div class="line">SQL&gt; select instance_name,status from v$instance;</div><div class="line">SQL&gt; col name format a10</div><div class="line">SQL&gt; set line 9999</div><div class="line">SQL&gt; col path format a15</div><div class="line">SQL&gt; select group_number,path,name,disk_number,total_mb,free_mb,create_date,mount_status,mount_date from v$asm_disk order by group_number desc,disk_number;</div><div class="line">SQL&gt; select name,state,free_mb,required_mirror_free_mb,usable_file_mb from v$asm_diskgroup;</div><div class="line">---------------------------------------------------------</div><div class="line">以下操作需要使用root用户</div><div class="line">-- 单一节点启动</div><div class="line">crsctl start has</div><div class="line">crsctl start crs</div><div class="line">crsctl check crs</div><div class="line">-- 所有节点启动</div><div class="line">crsctl status cluster -n rac1 rac2</div><div class="line">crsctl start cluster -all</div><div class="line">crsctl check cluster -all</div></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>记录一次oracle rac数据库启动故障修复过程</title>
      <link href="/arlo/1b263496/"/>
      <content type="html"><![CDATA[<p>周末测试服务器意外断电关机了，早上启动起来机器，发现数据库起不来了，以下记录一下排查过程。<br>经过查看sx21和orcl两个数据库都是“Instance Shutdown”状态。<br><a id="more"></a></p><h1 id="查看rac启动状态"><a href="#查看rac启动状态" class="headerlink" title="查看rac启动状态"></a>查看rac启动状态</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">[grid@rac1 ~]$ crsctl stat res -t</div><div class="line">--------------------------------------------------------------------------------</div><div class="line">NAME           TARGET  STATE        SERVER                   STATE_DETAILS       </div><div class="line">--------------------------------------------------------------------------------</div><div class="line">Local Resources</div><div class="line">--------------------------------------------------------------------------------</div><div class="line">ora.DATA.dg</div><div class="line">               ONLINE  ONLINE       rac1                                         </div><div class="line">               ONLINE  ONLINE       rac2                                         </div><div class="line">ora.LISTENER.lsnr</div><div class="line">               ONLINE  ONLINE       rac1                                         </div><div class="line">               ONLINE  ONLINE       rac2                                         </div><div class="line">ora.OCR.dg</div><div class="line">               ONLINE  ONLINE       rac1                                         </div><div class="line">               ONLINE  ONLINE       rac2                                         </div><div class="line">ora.VOTINGDISK.dg</div><div class="line">               ONLINE  ONLINE       rac1                                         </div><div class="line">               ONLINE  ONLINE       rac2                                         </div><div class="line">ora.asm</div><div class="line">               ONLINE  ONLINE       rac1                     Started             </div><div class="line">               ONLINE  ONLINE       rac2                     Started             </div><div class="line">ora.gsd</div><div class="line">               OFFLINE OFFLINE      rac1                                         </div><div class="line">               OFFLINE OFFLINE      rac2                                         </div><div class="line">ora.net1.network</div><div class="line">               ONLINE  ONLINE       rac1                                         </div><div class="line">               ONLINE  ONLINE       rac2                                         </div><div class="line">ora.ons</div><div class="line">               ONLINE  ONLINE       rac1                                         </div><div class="line">               ONLINE  ONLINE       rac2                                         </div><div class="line">--------------------------------------------------------------------------------</div><div class="line">Cluster Resources</div><div class="line">--------------------------------------------------------------------------------</div><div class="line">ora.LISTENER_SCAN1.lsnr</div><div class="line">      1        ONLINE  ONLINE       rac1                                         </div><div class="line">ora.cvu</div><div class="line">      1        ONLINE  ONLINE       rac1                                         </div><div class="line">ora.oc4j</div><div class="line">      1        ONLINE  ONLINE       rac2                                         </div><div class="line">ora.orcl.db</div><div class="line">      1        ONLINE  OFFLINE                               Instance Shutdown   </div><div class="line">      2        ONLINE  OFFLINE                               Instance Shutdown   </div><div class="line">ora.rac1.vip</div><div class="line">      1        ONLINE  ONLINE       rac1                                         </div><div class="line">ora.rac2.vip</div><div class="line">      1        ONLINE  ONLINE       rac2                                         </div><div class="line">ora.scan1.vip</div><div class="line">      1        ONLINE  ONLINE       rac1                                         </div><div class="line">ora.sx21.db</div><div class="line">      1        ONLINE  OFFLINE                               Instance Shutdown   </div><div class="line">      2        ONLINE  OFFLINE                               Instance Shutdown</div></pre></td></tr></table></figure><h1 id="手动启动数据库"><a href="#手动启动数据库" class="headerlink" title="手动启动数据库"></a>手动启动数据库</h1><h2 id="手动启动sx21数据库报错"><a href="#手动启动sx21数据库报错" class="headerlink" title="手动启动sx21数据库报错"></a>手动启动sx21数据库报错</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[grid@rac1 ~]$ srvctl start database -d sx21</div><div class="line">PRCR-1079 : Failed to start resource ora.sx21.db</div><div class="line">CRS-5017: The resource action &quot;ora.sx21.db start&quot; encountered the following error: </div><div class="line">ORA-00600: internal error code, arguments: [kcratr_scan_lastbwr], [], [], [], [], [], [], [], [], [], [], []</div><div class="line">. For details refer to &quot;(:CLSN00107:)&quot; in &quot;/u01/app/11.2.0/grid/log/rac1/agent/crsd/oraagent_oracle/oraagent_oracle.log&quot;.</div><div class="line"></div><div class="line">CRS-5017: The resource action &quot;ora.sx21.db start&quot; encountered the following error: </div><div class="line">ORA-01157: cannot identify/lock data file 6 - see DBWR trace file</div><div class="line">ORA-01110: data file 6: &apos;/u01/app/oracle/11g/dbs/E:APPADMINISTRATORORADATASX21ALK.DBF&apos;</div><div class="line">. For details refer to &quot;(:CLSN00107:)&quot; in &quot;/u01/app/11.2.0/grid/log/rac2/agent/crsd/oraagent_oracle/oraagent_oracle.log&quot;.</div><div class="line"></div><div class="line">CRS-2674: Start of &apos;ora.sx21.db&apos; on &apos;rac1&apos; failed</div><div class="line">CRS-2674: Start of &apos;ora.sx21.db&apos; on &apos;rac2&apos; failed</div><div class="line">CRS-2632: There are no more servers to try to place resource &apos;ora.sx21.db&apos; on that would satisfy its placement policy</div></pre></td></tr></table></figure><h2 id="手动启动orcl数据库报错"><a href="#手动启动orcl数据库报错" class="headerlink" title="手动启动orcl数据库报错"></a>手动启动orcl数据库报错</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[grid@rac1 ~]$ srvctl start database -d orcl</div><div class="line">PRCC-1014 : orcl was already running</div><div class="line">PRCR-1004 : Resource ora.orcl.db is already running</div><div class="line">PRCR-1079 : Failed to start resource ora.orcl.db</div><div class="line">CRS-5017: The resource action &quot;ora.orcl.db start&quot; encountered the following error: </div><div class="line">ORA-01589: must use RESETLOGS or NORESETLOGS option for database open</div><div class="line">. For details refer to &quot;(:CLSN00107:)&quot; in &quot;/u01/app/11.2.0/grid/log/rac2/agent/crsd/oraagent_oracle/oraagent_oracle.log&quot;.</div><div class="line"></div><div class="line">CRS-2674: Start of &apos;ora.orcl.db&apos; on &apos;rac2&apos; failed</div><div class="line">CRS-2528: Unable to place an instance of &apos;ora.orcl.db&apos; as all possible servers are occupied by the resource</div></pre></td></tr></table></figure><h1 id="恢复数据库sx21"><a href="#恢复数据库sx21" class="headerlink" title="恢复数据库sx21"></a>恢复数据库sx21</h1><p>另外开一个窗口，连接sx21数据库；恢复数据库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">[root@rac1 ~]# su - oracle</div><div class="line">[oracle@rac1 ~]$ export ORACLE_SID=sx211</div><div class="line">[oracle@rac1 ~]$ sqlplus / as sysdba</div><div class="line"></div><div class="line">SQL*Plus: Release 11.2.0.4.0 Production on Mon Apr 2 09:43:52 2018</div><div class="line"></div><div class="line">Copyright (c) 1982, 2013, Oracle.  All rights reserved.</div><div class="line"></div><div class="line">Connected to an idle instance.</div><div class="line"></div><div class="line">SQL&gt; startup</div><div class="line">ORACLE instance started.</div><div class="line"></div><div class="line">Total System Global Area 2471931904 bytes</div><div class="line">Fixed Size    2255752 bytes</div><div class="line">Variable Size  687867000 bytes</div><div class="line">Database Buffers 1761607680 bytes</div><div class="line">Redo Buffers   20201472 bytes</div><div class="line">Database mounted.</div><div class="line">ORA-00600: internal error code, arguments: [kcratr_scan_lastbwr], [], [], [],</div><div class="line">[], [], [], [], [], [], [], []</div><div class="line"></div><div class="line"></div><div class="line">SQL&gt; select open_mode from v$database;</div><div class="line"></div><div class="line">OPEN_MODE</div><div class="line">--------------------</div><div class="line">MOUNTED</div><div class="line"></div><div class="line">SQL&gt; alter database open resetlogs;</div><div class="line">alter database open resetlogs</div><div class="line">*</div><div class="line">ERROR at line 1:</div><div class="line">ORA-01139: RESETLOGS option only valid after an incomplete database recovery</div><div class="line"></div><div class="line"></div><div class="line">SQL&gt; recover database;</div><div class="line">Media recovery complete.</div><div class="line">SQL&gt; alter database open;</div><div class="line"></div><div class="line">Database altered.</div></pre></td></tr></table></figure></p><h1 id="恢复数据库orcl"><a href="#恢复数据库orcl" class="headerlink" title="恢复数据库orcl"></a>恢复数据库orcl</h1><p>另外orcl实例，情况不太一样；直接恢复的话，会报错；需要我们手动指定恢复文件。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div></pre></td><td class="code"><pre><div class="line">[oracle@rac1 ~]$ export ORACLE_SID=orcl11</div><div class="line">[oracle@rac1 ~]$ sqlplus / as sysdba</div><div class="line"></div><div class="line">SQL*Plus: Release 11.2.0.4.0 Production on Mon Apr 2 09:51:24 2018</div><div class="line"></div><div class="line">Copyright (c) 1982, 2013, Oracle.  All rights reserved.</div><div class="line"></div><div class="line">Connected to an idle instance.</div><div class="line"></div><div class="line">SQL&gt; startup</div><div class="line">ORACLE instance started.</div><div class="line"></div><div class="line">Total System Global Area 2471931904 bytes</div><div class="line">Fixed Size    2255752 bytes</div><div class="line">Variable Size  687867000 bytes</div><div class="line">Database Buffers 1761607680 bytes</div><div class="line">Redo Buffers   20201472 bytes</div><div class="line">Database mounted.</div><div class="line">ORA-00600: internal error code, arguments: [kcratr_nab_less_than_odr], [1],</div><div class="line">[115], [49383], [49388], [], [], [], [], [], [], []</div><div class="line"></div><div class="line">-- 查看数据库模式</div><div class="line">SQL&gt; select open_mode from v$database;</div><div class="line"></div><div class="line">OPEN_MODE</div><div class="line">--------------------</div><div class="line">MOUNTED</div><div class="line">--此时数据库启动到mount状态，尝试以resetlogs方式open数据库，也无法打开</div><div class="line">SQL&gt;  alter database open resetlogs;        </div><div class="line"> alter database open resetlogs</div><div class="line">*</div><div class="line">ERROR at line 1:</div><div class="line">ORA-01139: RESETLOGS option only valid after an incomplete database recovery</div><div class="line"></div><div class="line"></div><div class="line">SQL&gt; recover database;</div><div class="line">ORA-00283: recovery session canceled due to errors</div><div class="line">ORA-00600: internal error code, arguments: [krr_read_5], [115], [49383], [],</div><div class="line">[], [], [], [], [], [], [], []</div><div class="line">--查看当前日志文件情况</div><div class="line">SQL&gt; select v1.group#, member, sequence#, first_change#  from v$log v1, v$logfile v2 where v1.group# = v2.group#;</div><div class="line"></div><div class="line">    GROUP#</div><div class="line">----------</div><div class="line">MEMBER</div><div class="line">--------------------------------------------------------------------------------</div><div class="line"> SEQUENCE# FIRST_CHANGE#</div><div class="line">---------- -------------</div><div class="line"> 1</div><div class="line">+DATA/orcl/onlinelog/group_1.261.970078827</div><div class="line">       115 4674751</div><div class="line"></div><div class="line"> 2</div><div class="line">+DATA/orcl/onlinelog/group_2.262.970078829</div><div class="line">       114 4622551</div><div class="line"></div><div class="line">    GROUP#</div><div class="line">----------</div><div class="line">MEMBER</div><div class="line">--------------------------------------------------------------------------------</div><div class="line"> SEQUENCE# FIRST_CHANGE#</div><div class="line">---------- -------------</div><div class="line"></div><div class="line"> 3</div><div class="line">+DATA/orcl/onlinelog/group_3.266.970078993</div><div class="line">65 4646182</div><div class="line"></div><div class="line"> 4</div><div class="line">+DATA/orcl/onlinelog/group_4.267.970078995</div><div class="line"></div><div class="line">    GROUP#</div><div class="line">----------</div><div class="line">MEMBER</div><div class="line">--------------------------------------------------------------------------------</div><div class="line"> SEQUENCE# FIRST_CHANGE#</div><div class="line">---------- -------------</div><div class="line">66 4688519</div><div class="line"></div><div class="line">SQL&gt; recover database using backup controlfile until cancel;</div><div class="line">ORA-00279: change 4674751 generated at 04/01/2018 15:33:57 needed for thread 1</div><div class="line">ORA-00289: suggestion : /u01/app/oracle/11g/dbs/arch1_115_970078828.dbf</div><div class="line">ORA-00280: change 4674751 for thread 1 is in sequence #115</div><div class="line">-- 记录住这里提示的change号和sqeuence号，去上边记录中查找文件名</div><div class="line"></div><div class="line">Specify log: &#123;&lt;RET&gt;=suggested | filename | AUTO | CANCEL&#125;</div><div class="line">+DATA/orcl/onlinelog/group_1.261.970078827</div><div class="line">-- 输入文件路径名称，进行恢复</div><div class="line">ORA-00279: change 4674751 generated at 04/01/2018 10:23:59 needed for thread 2</div><div class="line">ORA-00289: suggestion : /u01/app/oracle/11g/dbs/arch2_65_970078828.dbf</div><div class="line">ORA-00280: change 4674751 for thread 2 is in sequence #65</div><div class="line"></div><div class="line">Specify log: &#123;&lt;RET&gt;=suggested | filename | AUTO | CANCEL&#125;</div><div class="line">+DATA/orcl/onlinelog/group_3.266.970078993</div><div class="line">ORA-00279: change 4688519 generated at 04/01/2018 18:01:42 needed for thread 2</div><div class="line">ORA-00289: suggestion : /u01/app/oracle/11g/dbs/arch2_66_970078828.dbf</div><div class="line">ORA-00280: change 4688519 for thread 2 is in sequence #66</div><div class="line">ORA-00278: log file &apos;+DATA/orcl/onlinelog/group_3.266.970078993&apos; no longer</div><div class="line">needed for this recovery</div><div class="line"></div><div class="line"></div><div class="line">Specify log: &#123;&lt;RET&gt;=suggested | filename | AUTO | CANCEL&#125;</div><div class="line">+DATA/orcl/onlinelog/group_4.267.970078995</div><div class="line">Log applied.</div><div class="line">Media recovery complete.</div><div class="line">--恢复完成后，再次可以正常打开数据库，重启数据库正常。</div><div class="line">SQL&gt; alter database open resetlogs;</div><div class="line"></div><div class="line">Database altered.</div><div class="line"></div><div class="line">SQL&gt; select open_mode from v$database;</div><div class="line"></div><div class="line">OPEN_MODE</div><div class="line">--------------------</div><div class="line">READ WRITE</div></pre></td></tr></table></figure></p><p>参考链接：<br><a href="https://www.cnblogs.com/jionjionyou/p/5602019.html" target="_blank" rel="external">https://www.cnblogs.com/jionjionyou/p/5602019.html</a><br><a href="https://blog.csdn.net/linucle/article/details/8778046" target="_blank" rel="external">https://blog.csdn.net/linucle/article/details/8778046</a></p>]]></content>
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>使用wgrib2将GFS数据导入到mysql</title>
      <link href="/arlo/551cdbc9/"/>
      <content type="html"><![CDATA[<h1 id="GFS数据来源"><a href="#GFS数据来源" class="headerlink" title="GFS数据来源"></a>GFS数据来源</h1><blockquote><p>数据来源采自美国国家环境预报中心的GFS(全球预报系统)，该系统每天发布4次全球范围的气象数据，分辨率最高可达到0.25° x 0.25°，精度还是比较可观的。<br>GFS数据提供FTP下载方式：<a href="http://www.ftp.ncep.noaa.gov/data/nccf/com/gfs/prod/" target="_blank" rel="external">http://www.ftp.ncep.noaa.gov/data/nccf/com/gfs/prod/</a><br>每次发布的数据保存在命名为gfs.YYYYMMDDHH的文件夹中。本次需要的数据精度为0.25°（0p25），所以数据的文件名为：gfs.t{HH}z.pgrb2.0p25.f{XXX}<br>其中HH表示发布的时间，XXX表示未来几小时的预报数据。例如gfs.t00z.pgrb2.0p25.f001 表示0时发布的未来1小时气象数据信息。<br>那么问题来了，这个文件太大了，因为分辨率比较高，每个文件高达200多MB，不仅下载速度慢，处理慢，对存储空间也是一个考验。<br>于是找到了一个可以在线过滤要下载数据的地址：<br><a href="http://nomads.ncep.noaa.gov/cgi-bin/filter_gfs_0p25.pl" target="_blank" rel="external">http://nomads.ncep.noaa.gov/cgi-bin/filter_gfs_0p25.pl</a><br>这个网站允许用户仅下载过滤后的文件，并提供下载网址，这样文件就会小很多。<br>例如，在本项目中，仅需要下载降雨数据（PWAT），并且经纬度范围为特定区域，每次发布的数据全部下载下来也才8M多点。<br>那么要想获得GRIB文件中的数据，则需要用到一个软件wgrib2,，该软件在ncep网站上提供源码下载。</p></blockquote><a id="more"></a><h1 id="Mysql安装配置"><a href="#Mysql安装配置" class="headerlink" title="Mysql安装配置"></a>Mysql安装配置</h1><h2 id="查看mysql安装"><a href="#查看mysql安装" class="headerlink" title="查看mysql安装"></a>查看mysql安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@siluxa_oracle grib2]# rpm -qa |grep -i mysql</div><div class="line">mysql-community-common-5.6.36-2.el6.x86_64</div><div class="line">mysql-community-client-5.6.36-2.el6.x86_64</div><div class="line">mysql-community-server-5.6.36-2.el6.x86_64</div><div class="line">mysql-community-libs-compat-5.6.37-2.el6.x86_64</div><div class="line">mysql-community-libs-5.6.36-2.el6.x86_64</div><div class="line">mysql-community-devel-5.6.39-2.el6.x86_64</div></pre></td></tr></table></figure><h1 id="创建数据库和表"><a href="#创建数据库和表" class="headerlink" title="创建数据库和表"></a>创建数据库和表</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># 创建数据库</div><div class="line">CREATE DATABASE weatherDB DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;</div><div class="line"># 创建表</div><div class="line">create table wgrib2 (rt datetime, vt datetime, lat double, lon double, param varchar(80), level varchar(30), value double); </div><div class="line"># 创建用户和表，并赋予权限(实验环境可以直接用root，生产环境强烈建议使用普通用户)</div><div class="line">-- CREATE USER wgrib2 IDENTIFIED BY &apos;ffffff&apos;;</div><div class="line">-- GRANT ALL on weatherDB.* to wgrib2@&quot;%&quot; Identified by &quot;ffffff&quot;</div></pre></td></tr></table></figure><h1 id="编译安装wgrib2软件包"><a href="#编译安装wgrib2软件包" class="headerlink" title="编译安装wgrib2软件包"></a>编译安装wgrib2软件包</h1><h2 id="编译安装wgrib2"><a href="#编译安装wgrib2" class="headerlink" title="编译安装wgrib2"></a>编译安装wgrib2</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">#安装gcc和gfortran编译器</div><div class="line">yum install gcc gcc-gfortran -y</div><div class="line">#下载wgrib2软件包</div><div class="line">wget http://www.ftp.cpc.ncep.noaa.gov/wd51we/wgrib2/wgrib2.tgz -O  /usr/local/src/wgrib2.tgz</div><div class="line">cd /usr/local/src</div><div class="line">tar wgrib2.tgz</div><div class="line">cd grib2/</div><div class="line">#设置编译环境</div><div class="line">export CC=gcc</div><div class="line">export FC=gfortran</div><div class="line"># 启用mysql支持，修改第114行</div><div class="line">vim makefile  </div><div class="line">USE_MYSQL=1</div><div class="line"># 编译</div><div class="line">make</div></pre></td></tr></table></figure><h2 id="查看wgrib2配置"><a href="#查看wgrib2配置" class="headerlink" title="查看wgrib2配置"></a>查看wgrib2配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">[root@siluxa_oracle grib2]#cd wgrib2</div><div class="line">[root@siluxa_oracle grib2]# ./wgrib2 -config</div><div class="line">wgrib2 v0.2.0.7 12/2017  Wesley Ebisuzaki, Reinoud Bokhorst, John Howard, Jaakko Hyvätti, Dusan Jovic, Daniel Lee, Kristian Nilssen, Karl Pfeiffer, Pablo Romero, Manfred Schwarb, Gregor Schee, Arlindo da Silva, Niklas Sondell, Sam Trahan, Sergey Varlamov</div><div class="line">    stock build</div><div class="line"></div><div class="line">Compiled on 11:02:41 Mar 15 2018</div><div class="line"></div><div class="line">Netcdf package: &quot;3.6.3&quot; of Mar 15 2018 11:02:16 $ is installed</div><div class="line">libaec-1.0.2.tar.gz is installed</div><div class="line">Jasper 1.900.1 is installed</div><div class="line">mysql package is installed</div><div class="line">regex package is installed</div><div class="line">tigge package is installed</div><div class="line">IPOLATES iplib.v3.0.0 is installed, default vectors:</div><div class="line">    UGRD/VGRD VUCSH/VVCSH UFLX/VFLX UGUST/VGUST USTM/VSTM VDFUA/VDFVA MAXUW/MAXVW </div><div class="line">    UOGRD/VOGRD UICE/VICE U-GWD/V-GWD USSD/VSSD </div><div class="line">Geolocation library status (by search order)</div><div class="line">  gctpc geolocation is enabled</div><div class="line">  spherical geolocation is enabled</div><div class="line">UDF package is not installed</div><div class="line">version ftime=2</div><div class="line">maximum number of arguments on command line: 10000</div><div class="line">maximum number of -match,-not,-if, and -not_if options: 2000</div><div class="line">maximum number of -match_fs,-not_fs,-if_fs, and -not_if_fs options: 2000</div><div class="line">maximum number of -fgrep, -egrep, -fgrep_v, -egrep_v options: 200</div><div class="line">RPN registers: 0..19</div><div class="line">memory files: @mem:0, @mem:1 .. @mem:19</div><div class="line">stdout buffer length: 30000</div><div class="line">default decoding: g2clib emulation</div><div class="line">g2clib decoders are not installed</div><div class="line">Supported decoding: simple, complex, rle, ieee, png, jpeg2000, CCSDS AEC</div><div class="line">user gribtable: (none)</div><div class="line">C compiler: gcc (GCC) 4.4.7 20120313 (Red Hat 4.4.7-18)</div><div class="line">Fortran compiler: gfortran</div><div class="line">OpenMP: control number of threads with environment variable OMP_NUM_THREADS</div><div class="line">INT_MAX:   2147483647</div><div class="line">ULONG_MAX: 18446744073709551615</div></pre></td></tr></table></figure><h1 id="将gfs数据导入到mysql中"><a href="#将gfs数据导入到mysql中" class="headerlink" title="将gfs数据导入到mysql中"></a>将gfs数据导入到mysql中</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./wgrib2 /mnt/wgrib2/gfs_20180313_0000_0p25_240.240 -mysql 192.168.6.123 root ffffff weatherDB wgrib2</div></pre></td></tr></table></figure><p><img src="/images/2018/0315/01.png" alt="wgrib2"></p><h2 id="可以过滤性导入数据，格式为-if-“：”-后跟参数"><a href="#可以过滤性导入数据，格式为-if-“：”-后跟参数" class="headerlink" title="可以过滤性导入数据，格式为 -if “：” 后跟参数"></a>可以过滤性导入数据，格式为 -if “：” 后跟参数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#下边这条命令是将“10 m above ground”的数据导入到wind表中</div><div class="line">./wgrib2  /mnt/wgrib2/gfs.t00z.pgrb2.0p25.f000 -if &quot;:10 m above ground&quot; -mysql 192.168.6.123 root ffffff weatherDB wind</div></pre></td></tr></table></figure><h2 id="查看导入结果"><a href="#查看导入结果" class="headerlink" title="查看导入结果"></a>查看导入结果</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mysql -uroot -pffffff</div><div class="line">mysql&gt; use weatherDB;</div><div class="line">mysql&gt; select * from `weatherDB`.`wgrib2` limit 0, 20;</div></pre></td></tr></table></figure><p><img src="/images/2018/0315/02.png" alt="wgrib2"></p><p>参考链接：<br><a href="http://blog.csdn.net/pch1982cn/article/details/74292772" target="_blank" rel="external">http://blog.csdn.net/pch1982cn/article/details/74292772</a><br><a href="http://www.cpc.ncep.noaa.gov/products/wesley/wgrib2/index.html" target="_blank" rel="external">http://www.cpc.ncep.noaa.gov/products/wesley/wgrib2/index.html</a><br><a href="http://www.nco.ncep.noaa.gov/pmb/products/gfs/gfs.t00z.pgrb2f00.npoess.shtml" target="_blank" rel="external">http://www.nco.ncep.noaa.gov/pmb/products/gfs/gfs.t00z.pgrb2f00.npoess.shtml</a><br>数据下载地址:<br>ftp://ftpprd.ncep.noaa.gov/pub/data/nccf/com/gfs/prod/<br>在线过滤要下载数据的地址:<br><a href="http://nomads.ncep.noaa.gov" target="_blank" rel="external">http://nomads.ncep.noaa.gov</a></p>]]></content>
      
      <categories>
          
          <category> 大气模型 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
            <tag> wgrib2 </tag>
            
            <tag> GFS </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>安装rlwrap，使SqlPlus工具支持上下左右键</title>
      <link href="/arlo/d9547628/"/>
      <content type="html"><![CDATA[<p>SqlPlus 工具中默认不支持上下左右键调出历史命令，很不方便；需安装rlwrap。<br><a id="more"></a></p><h1 id="安装依赖包"><a href="#安装依赖包" class="headerlink" title="安装依赖包"></a>安装依赖包</h1><p><code>yum -y install gcc libtermcap-devel readline readline-devel</code></p><h1 id="获取安装文件"><a href="#获取安装文件" class="headerlink" title="获取安装文件"></a>获取安装文件</h1><p><code>wget https://fossies.org/linux/privat/rlwrap-0.43.tar.gz</code></p><h1 id="安装rlwrap"><a href="#安装rlwrap" class="headerlink" title="安装rlwrap"></a>安装rlwrap</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">tar xf rlwrap-0.43.tar.gz</div><div class="line">cd rlwrap-0.43/</div><div class="line">./configure &amp;&amp; make install</div></pre></td></tr></table></figure><h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">su - oracle</div><div class="line">vim .bash_profile</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">alias sqlplus=&apos;rlwrap sqlplus&apos;</div><div class="line">alias rman=&apos;rlwrap rman&apos;</div><div class="line">alias asmcmd=&apos;rlwrap asmcmd&apos;</div></pre></td></tr></table></figure><p><code>source .bash_profile</code></p>]]></content>
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 常识 </tag>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Sonar代码质量管理工具安装</title>
      <link href="/arlo/96c3f480/"/>
      <content type="html"><![CDATA[<p>Sonar(SonarQube)是一款静态代码检查工具，采用B/S架构，帮助检查代码缺陷，改善代码质量，提高开发速度，通过插件形式，可以支持Java、C、C++、JavaScripe等等二十几种编程语言的代码质量管理与检测；通过客户端插件分析源代码，sonar客户端可以采用IDE插件、Sonar-Scanner插件、Ant插件和Maven插件方式，并通过各种不同的分析机制对项目源代码进行分析和扫描，并把分析扫描后的结果上传到sonar的数据库，通过sonar web界面对分析结果进行管理。<br><a id="more"></a><br>可以从七个维度检测代码质量:</p><ul><li>复杂度分布(complexity):代码复杂度过高将难以理解</li><li>重复代码(duplications):程序中包含大量复制、粘贴的代码而导致代码臃肿，sonar可以展示源码中重复严重的地方</li><li>单元测试统计(unit tests):统计并展示单元测试覆盖率，开发或测试可以清楚测试代码的覆盖情况</li><li>代码规则检查(coding rules):通过Findbugs,PMD,CheckStyle等检查代码是否符合规范</li><li>注释率(comments):若代码注释过少，特别是人员变动后，其他人接手比较难接手；若过多，又不利于阅读</li><li>潜在的Bug(potential bugs):通过Findbugs,PMD,CheckStyle等检测潜在的bug</li><li>结构与设计(architecture &amp; design):找出循环，展示包与包、类与类之间的依赖、检查程序之间耦合度<!--more--></li></ul><h1 id="系统环境"><a href="#系统环境" class="headerlink" title="系统环境"></a>系统环境</h1><p>操作系统： CentOS 7.x<br>Msql Server:   5.7.17<br>Java    ： JDK1.8<br>Sonar    ： sonarqube-6.7.1.zip<br>Sonar-scanner：sonar-scanner-cli-3.0.3.778-linux.zip</p><h1 id="服务器安装"><a href="#服务器安装" class="headerlink" title="服务器安装"></a>服务器安装</h1><h2 id="安装MySQL服务器"><a href="#安装MySQL服务器" class="headerlink" title="安装MySQL服务器"></a>安装MySQL服务器</h2><p><em>MariaDB 10.2在安装过程中检测为Mysql 5.5，不能满足需求</em><br><code>wget http://download.softagency.net/MySQL/Downloads/MySQL-5.7/mysql-5.7.17-1.el7.x86_64.rpm-bundle.tar</code><br><code>tar xf mysql-5.7.17-1.el7.x86_64.rpm-bundle.tar</code><br><code>yum localinstall mysql-community-server-5.7.17-1.el7.x86_64.rpm mysql-community-client-5.7.17-1.el7.x86_64.rpm  mysql-community-common-5.7.17-1.el7.x86_64.rpm mysql-community-client-5.7.17-1.el7.x86_64.rpm mysql-community-libs-5.7.17-1.el7.x86_64.rpm</code><br><code>vim /etc/my.cnf</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#[mysqld]下添加一行 </div><div class="line">innodb_buffer_pool_size = 128M</div><div class="line">max_allowed_packet = 128M</div></pre></td></tr></table></figure></p><p>启动mysql服务<br><code>systemctl start mysqld</code><br>初始化mysql服务<br><code>mysql_secure_installation</code><br>默认密码在日志中可以看到<br><img src="/images/2018/0202/01.png" alt="sonar"><br>创建sonar数据库和用户，并赋予权限<br><code>mysql -uroot -p&#39;mysql_root_password&#39;</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">mysql&gt; select version();</div><div class="line">mysql5.7密码强度比较高，我们做实验调整一下；设置一下复杂度和长度</div><div class="line">mysql&gt; set global validate_password_policy=0;</div><div class="line">mysql&gt; set global validate_password_length=1;</div><div class="line">mysql&gt; CREATE DATABASE `sonar` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;</div><div class="line">mysql&gt; CREATE USER &apos;sonar&apos;@&apos;%&apos; IDENTIFIED BY &apos;sonar&apos;;</div><div class="line">mysql&gt; GRANT ALL ON sonar.* TO &apos;sonar&apos;@&apos;%&apos;;</div><div class="line">mysql&gt; flush privileges;</div><div class="line">mysql -usonar -psonar -hlocalhost</div></pre></td></tr></table></figure></p><h2 id="安装JDK"><a href="#安装JDK" class="headerlink" title="安装JDK"></a>安装JDK</h2><p>下载地址：<a href="http://www.oracle.com/technetwork/java/archive-139210.html" target="_blank" rel="external">http://www.oracle.com/technetwork/java/archive-139210.html</a><br><code>tar xf jdk-8u112-linux-x64.tar.gz -C /usr/local/</code><br><code>vim /etc/profile</code><br>添加以下三行环境变量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">export JAVA_HOME=/usr/local/jdk1.8.0_112/</div><div class="line">export CLASSPATH=.:$JAVA_HOME/lib/:$JAVA_HOME/jre/lib/</div><div class="line">export PATH=$JAVA_HOME/bin:$PATH</div></pre></td></tr></table></figure></p><h2 id="安装sonar"><a href="#安装sonar" class="headerlink" title="安装sonar"></a>安装sonar</h2><h3 id="系统参数配置"><a href="#系统参数配置" class="headerlink" title="系统参数配置"></a>系统参数配置</h3><p>新建用户<br>sonar 不允许以root用户启动<br><code>useradd sonar</code><br><code>echo sonar|passwd --stdin sonar</code><br>修改内核参数<br><code>sysctl -w vm.max_map_count=262144</code><br><code>sysctl -w fs.file-max=65536</code><br>修改用户文件打开最大数<br><code>vim /etc/security/limits.conf</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sonar       hard    nofile           65536</div><div class="line">sonar       soft    nofile           65536</div></pre></td></tr></table></figure></p><h3 id="下载地址：https-www-sonarqube-org-downloads"><a href="#下载地址：https-www-sonarqube-org-downloads" class="headerlink" title="下载地址：https://www.sonarqube.org/downloads/"></a>下载地址：<a href="https://www.sonarqube.org/downloads/" target="_blank" rel="external">https://www.sonarqube.org/downloads/</a></h3><p><code>unzip sonarqube-6.7.1.zip -d /usr/local</code></p><h3 id="配置sonar"><a href="#配置sonar" class="headerlink" title="配置sonar"></a>配置sonar</h3><p><code>vim /usr/local/sonarqube-6.7.1/conf/sonar.properties</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">sonar.jdbc.username=sonar</div><div class="line">sonar.jdbc.password=sonar</div><div class="line">sonar.jdbc.url=jdbc:mysql://localhost:3306/sonar?useUnicode=true&amp;characterEncoding=utf8&amp;rewriteBatchedStatements=true&amp;useConfigs=maxPerformance&amp;useSSL=false</div><div class="line">sonar.web.host=0.0.0.0</div><div class="line">sonar.web.context=/sonar</div><div class="line">sonar.web.port=9000</div></pre></td></tr></table></figure></p><p><code>vim /usr/local/sonarqube-6.7.1/conf/wrapper.conf</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wrapper.java.command=/usr/local/jdk1.8.0_112/bin/java</div></pre></td></tr></table></figure></p><p><code>chown sonar.sonar /usr/local/sonarqube-6.7.1 -R</code><br>切换至sonar用户下<br><code>su - sonar</code><br>可以将此路径加入到环境变量中<br><code>cd /usr/local/sonarqube-6.7.1/bin/linux-x86-64</code><br><code>./sonar.sh start</code><br>可以监控/usr/local/sonarqube-6.7.1/logs目录下的log,第一次启动时间会长一些，因为要给数据库建表<br><code>访问地址http://192.168.6.178:9000/sonar/</code><br>默认用户名/密码:   admin/admin<br><img src="/images/2018/0202/02.png" alt="jenkins"><br>安装一个中文插件，安装完成后重启<br><img src="/images/2018/0202/03.png" alt="jenkins"><br><img src="/images/2018/0202/04.png" alt="jenkins"></p><h3 id="开启SCM"><a href="#开启SCM" class="headerlink" title="开启SCM"></a>开启SCM</h3><p><img src="/images/2018/0202/13.png" alt="jenkins"></p><h1 id="客户端SonarQube-Scanner安装"><a href="#客户端SonarQube-Scanner安装" class="headerlink" title="客户端SonarQube Scanner安装"></a>客户端SonarQube Scanner安装</h1><p>下载地址<a href="https://docs.sonarqube.org/display/SCAN/Analyzing+with+SonarQube+Scanner" target="_blank" rel="external">https://docs.sonarqube.org/display/SCAN/Analyzing+with+SonarQube+Scanner</a><br>SonarQube Scanner作为客户端，放在一个可以读取代码的位置即可，可以和SonarQube 服务端放在一台机器上，也可以分开部署；</p><h2 id="配置sonarqube-scanner"><a href="#配置sonarqube-scanner" class="headerlink" title="配置sonarqube scanner"></a>配置sonarqube scanner</h2><p>我这里部署在本地windows系统上，将D:\Program Files (x86)\sonar-scanner-3.0.3.778-windows\bin加入到环境变量PATH中<br>编辑D:\Program Files (x86)\sonar-scanner-3.0.3.778-windows\conf\sonar-scanner.properties配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">#Configure here general information about the environment, such as SonarQube DB details for example</div><div class="line">#No information about specific project should appear here</div><div class="line">#----- Default SonarQube server</div><div class="line">sonar.host.url=http://192.168.6.178:9000/sonar</div><div class="line">sonar.jdbc.username=sonar</div><div class="line">sonar.jdbc.password=sonar</div><div class="line">sonar.jdbc.url=jdbc:mysql://192.168.6.178:3306/sonar?useUnicode=true&amp;characterEncoding=utf8&amp;rewriteBatchedStatements=true&amp;useConfigs=maxPerformance&amp;useSSL=false</div><div class="line">#----- Default source code encoding</div><div class="line">sonar.sourceEncoding=UTF-8</div></pre></td></tr></table></figure></p><h2 id="配置项目"><a href="#配置项目" class="headerlink" title="配置项目"></a>配置项目</h2><p>在项目代码根目录下新建一个sonar-project.properties文件,内容如下<br><code>sonar.projectKey和sonar.projectName自己定义即可。</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"># must be unique in a given SonarQube instance</div><div class="line">sonar.projectKey=silu</div><div class="line"># this is the name and version displayed in the SonarQube UI. Was mandatory prior to SonarQube 6.1.</div><div class="line">sonar.projectName=sxapp</div><div class="line">sonar.projectVersion=1.0</div><div class="line"> </div><div class="line"># Path is relative to the sonar-project.properties file. Replace &quot;\&quot; by &quot;/&quot; on Windows.</div><div class="line"># This property is optional if sonar.modules is set. </div><div class="line">sonar.sources=.</div><div class="line">sonar.language=java</div><div class="line"># Encoding of the source code. Default is default system encoding</div><div class="line">sonar.sourceEncoding=UTF-8</div></pre></td></tr></table></figure></p><h1 id="客户端SonarQube-Scanner使用"><a href="#客户端SonarQube-Scanner使用" class="headerlink" title="客户端SonarQube Scanner使用"></a>客户端SonarQube Scanner使用</h1><h2 id="用SonarQube-Scanner分析"><a href="#用SonarQube-Scanner分析" class="headerlink" title="用SonarQube Scanner分析"></a>用SonarQube Scanner分析</h2><p>在项目根目录下执行sonar-scanner即可开始代码监测<br><img src="/images/2018/0202/06.png" alt="jenkins"><br>在web页面上刷新一下就看到看到结果了<br><img src="/images/2018/0202/07.png" alt="jenkins"><br><strong>Q:</strong>Please provide compiled classes of your project with sonar.java.binaries property<br><img src="/images/2018/0202/05.png" alt="jenkins"><br><strong>A:</strong>这是因为sonar-java插件太新了，可以下载一个旧版本的插件进行替换<br><a href="https://sonarsource.bintray.com/Distribution/sonar-java-plugin/sonar-java-plugin-4.10.0.10260.jar" target="_blank" rel="external">https://sonarsource.bintray.com/Distribution/sonar-java-plugin/sonar-java-plugin-4.10.0.10260.jar</a><br>下载完成后拷贝到C:\Users\nsxq.sonar\cache\2936e4ebd1e34b1646a3b66a51d30af7\ （类似这个）目录下，<br>并修改名称为sonar-java-plugin-4.15.0.12310.jar(不要问我为什么要改成这个版本号，因为运行sonar-scanner提示是这个版本号)</p><h2 id="用Maven调用SonarQube-Scanner分析"><a href="#用Maven调用SonarQube-Scanner分析" class="headerlink" title="用Maven调用SonarQube Scanner分析"></a>用Maven调用SonarQube Scanner分析</h2><h3 id="安装maven3"><a href="#安装maven3" class="headerlink" title="安装maven3"></a>安装maven3</h3><p>下载地址<a href="http://apache.mirrors.lucidnetworks.net/maven/maven-3/" target="_blank" rel="external">http://apache.mirrors.lucidnetworks.net/maven/maven-3/</a><br>下载完成解压后，配置环境变量，验证<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mvn --version</div><div class="line">Apache Maven 3.3.9 (bb52d8502b132ec0a5a3f4c09453c07478323dc5; 2015-11-11T00:41:47+08:00)</div><div class="line">Maven home: D:\Program Files (x86)\apache-maven-3.3.9-bin\apache-maven-3.3.9\bin\..</div><div class="line">Java version: 1.8.0_141, vendor: Oracle Corporation</div><div class="line">Java home: C:\Program Files\Java\jdk1.8.0_141\jre</div><div class="line">Default locale: zh_CN, platform encoding: GBK</div><div class="line">OS name: &quot;windows 10&quot;, version: &quot;10.0&quot;, arch: &quot;amd64&quot;, family: &quot;dos&quot;</div></pre></td></tr></table></figure></p><h3 id="配置maven全局设置settings-xml"><a href="#配置maven全局设置settings-xml" class="headerlink" title="配置maven全局设置settings.xml"></a>配置maven全局设置settings.xml</h3><p>添加以下配置到本来的settings.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&lt;settings&gt;</div><div class="line">    &lt;pluginGroups&gt;</div><div class="line">        &lt;pluginGroup&gt;org.sonarsource.scanner.maven&lt;/pluginGroup&gt;</div><div class="line">    &lt;/pluginGroups&gt;</div><div class="line">    &lt;profiles&gt;</div><div class="line">        &lt;profile&gt;</div><div class="line">            &lt;id&gt;sonar&lt;/id&gt;</div><div class="line">            &lt;activation&gt;</div><div class="line">                &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;</div><div class="line">            &lt;/activation&gt;</div><div class="line">            &lt;properties&gt;</div><div class="line">                &lt;!-- Optional URL to server. Default value is http://localhost:9000 --&gt;</div><div class="line">                &lt;sonar.host.url&gt;</div><div class="line">                  http://myserver:9000</div><div class="line">                &lt;/sonar.host.url&gt;</div><div class="line">            &lt;/properties&gt;</div><div class="line">        &lt;/profile&gt;</div><div class="line">     &lt;/profiles&gt;</div><div class="line">&lt;/settings&gt;</div></pre></td></tr></table></figure></p><p>添加完成后，我的配置文件如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line">&lt;settings</div><div class="line">xsi:schemaLocation=&quot;http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd&quot;</div><div class="line">xmlns=&quot;http://maven.apache.org/SETTINGS/1.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt;</div><div class="line">&lt;localRepository&gt;C:\Users\nsxq\.m2\repository\&lt;/localRepository&gt;</div><div class="line">&lt;pluginGroups&gt;</div><div class="line">        &lt;pluginGroup&gt;org.sonarsource.scanner.maven&lt;/pluginGroup&gt;</div><div class="line">    &lt;/pluginGroups&gt;</div><div class="line">&lt;servers&gt;</div><div class="line">&lt;server&gt;</div><div class="line">&lt;username&gt;test&lt;/username&gt;</div><div class="line">&lt;password&gt;test&lt;/password&gt;</div><div class="line">&lt;id&gt;THSArtifactory&lt;/id&gt;</div><div class="line">&lt;/server&gt;</div><div class="line">&lt;/servers&gt;</div><div class="line">&lt;mirrors&gt;</div><div class="line">&lt;mirror&gt;</div><div class="line">&lt;mirrorOf&gt;*&lt;/mirrorOf&gt;</div><div class="line">&lt;name&gt;ths-repos&lt;/name&gt;</div><div class="line">&lt;url&gt;http://192.168.0.45/artifactory/ths-repos&lt;/url&gt;</div><div class="line">&lt;id&gt;THSArtifactory&lt;/id&gt;</div><div class="line">&lt;/mirror&gt;</div><div class="line">&lt;mirror&gt;</div><div class="line">       &lt;id&gt;alimaven&lt;/id&gt;</div><div class="line">      &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;</div><div class="line">      &lt;name&gt;aliyun maven&lt;/name&gt;</div><div class="line">       &lt;url&gt;http://maven.aliyun.com/nexus/content/repositories/central/&lt;/url&gt;</div><div class="line">   &lt;/mirror&gt;</div><div class="line">&lt;/mirrors&gt;</div><div class="line">&lt;profiles&gt;</div><div class="line">&lt;profile&gt;</div><div class="line">&lt;repositories&gt;</div><div class="line">&lt;repository&gt;</div><div class="line">&lt;snapshots&gt;</div><div class="line">&lt;enabled&gt;false&lt;/enabled&gt;</div><div class="line">&lt;/snapshots&gt;</div><div class="line">&lt;id&gt;central&lt;/id&gt;</div><div class="line">&lt;name&gt;ths-repos&lt;/name&gt;</div><div class="line">&lt;url&gt;http://192.168.0.45/artifactory/ths-repos&lt;/url&gt;</div><div class="line">&lt;/repository&gt;</div><div class="line">&lt;repository&gt;</div><div class="line">&lt;snapshots /&gt;</div><div class="line">&lt;id&gt;snapshots&lt;/id&gt;</div><div class="line">&lt;name&gt;ths-repos&lt;/name&gt;</div><div class="line">&lt;url&gt;http://192.168.0.45/artifactory/ths-repos&lt;/url&gt;</div><div class="line">&lt;/repository&gt;</div><div class="line">&lt;/repositories&gt;</div><div class="line">&lt;pluginRepositories&gt;</div><div class="line">&lt;pluginRepository&gt;</div><div class="line">&lt;snapshots&gt;</div><div class="line">&lt;enabled&gt;false&lt;/enabled&gt;</div><div class="line">&lt;/snapshots&gt;</div><div class="line">&lt;id&gt;central&lt;/id&gt;</div><div class="line">&lt;name&gt;ths-repos&lt;/name&gt;</div><div class="line">&lt;url&gt;http://192.168.0.45/artifactory/ths-repos&lt;/url&gt;</div><div class="line">&lt;/pluginRepository&gt;</div><div class="line">&lt;pluginRepository&gt;</div><div class="line">&lt;snapshots /&gt;</div><div class="line">&lt;id&gt;snapshots&lt;/id&gt;</div><div class="line">&lt;name&gt;ths-repos&lt;/name&gt;</div><div class="line">&lt;url&gt;http://192.168.0.45/artifactory/ths-repos&lt;/url&gt;</div><div class="line">&lt;/pluginRepository&gt;</div><div class="line">&lt;/pluginRepositories&gt;</div><div class="line">&lt;id&gt;artifactory&lt;/id&gt;</div><div class="line">&lt;/profile&gt;</div><div class="line">        &lt;profile&gt;</div><div class="line">            &lt;id&gt;sonar&lt;/id&gt;</div><div class="line">            &lt;activation&gt;</div><div class="line">                &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;</div><div class="line">            &lt;/activation&gt;</div><div class="line">            &lt;properties&gt;</div><div class="line">                &lt;!-- Optional URL to server. Default value is http://localhost:9000 --&gt;</div><div class="line">                &lt;sonar.host.url&gt;</div><div class="line">                  http://192.168.6.178:9000/sonar</div><div class="line">                &lt;/sonar.host.url&gt;</div><div class="line">            &lt;/properties&gt;</div><div class="line">        &lt;/profile&gt;</div><div class="line">&lt;/profiles&gt;</div><div class="line">&lt;activeProfiles&gt;</div><div class="line">&lt;activeProfile&gt;artifactory&lt;/activeProfile&gt;</div><div class="line">&lt;/activeProfiles&gt;</div><div class="line">&lt;/settings&gt;</div></pre></td></tr></table></figure></p><h3 id="测试maven项目"><a href="#测试maven项目" class="headerlink" title="测试maven项目"></a>测试maven项目</h3><p>下载一个maven测试项目代码<br><code>git clone https://github.com/SonarSource/sonar-scanning-examples.git</code><br><code>cd D:\sonar-scanning-examples\sonarqube-scanner-maven</code><br><code>mvn clean install sonar:sonar</code><br><img src="/images/2018/0202/08.png" alt="jenkins"><br>web页面查看<br><img src="/images/2018/0202/09.png" alt="jenkins"></p><h2 id="用Jenkins调用SonarQube-Scanner分析"><a href="#用Jenkins调用SonarQube-Scanner分析" class="headerlink" title="用Jenkins调用SonarQube Scanner分析"></a>用Jenkins调用SonarQube Scanner分析</h2><h3 id="安装sonarqube插件"><a href="#安装sonarqube插件" class="headerlink" title="安装sonarqube插件"></a>安装sonarqube插件</h3><p>系统管理–&gt;管理插件–&gt;可选插件<br>SonarQube Scanner for Jenkins<br>Mashup Portlets</p><h3 id="配置SonarQube-servers"><a href="#配置SonarQube-servers" class="headerlink" title="配置SonarQube servers"></a>配置SonarQube servers</h3><p>系统管理–&gt;系统配置–&gt;SonarQube servers<br><img src="/images/2018/0202/10.png" alt="jenkins"><br>系统管理–&gt;全局工具配置–&gt;SonarQube Scanner<br><img src="/images/2018/0202/11.png" alt="jenkins"><br>JOB配置<br><img src="/images/2018/0202/14.png" alt="jenkins"><br><img src="/images/2018/0202/15.png" alt="jenkins"><br>key,name,version三个字段是自定义的，sources路径是当前路径的话，用.表示就可以了；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">sonar.projectKey=ths.project</div><div class="line">sonar.projectName=AirForcast</div><div class="line">sonar.projectVersion=1.0</div><div class="line">sonar.language=java</div><div class="line">sonar.java.binaries=./target/test-classes/ </div><div class="line">sonar.sources=.</div></pre></td></tr></table></figure></p><p><img src="/images/2018/0202/16.png" alt="jenkins"><br><img src="/images/2018/0202/17.png" alt="jenkins"><br>点击查看监测结果！</p><h1 id="其他问题"><a href="#其他问题" class="headerlink" title="其他问题"></a>其他问题</h1><p><strong>Q1：</strong><br>ERROR web[][o.s.s.p.Platform] Web server startup failed: Unsupported mysql version: 5.5. Minimal supported version is 5.6.<br><strong>A1:</strong><br>不要使用mariadb，mariadb10.2检测到是mysql5.5<br><strong>Q2:</strong><br>Native memory allocation (mmap) failed to map 42467328 bytes for committing reserved memory.<br><strong>A2:</strong><br>1.将虚拟机内存调整大，调整到4Gb；<br>2.保证swap空间正常（我安装操作系统的时候没有设置swap分区，折腾了好一会儿）；<br>3.修改此文件中的/usr/local/sonarqube-6.7.1/elasticsearch/config/jvm.options     -Xms512m -Xmx512m<br><strong>Q3:</strong><br>mvn clean install sonar:sonar 上传分析数据时候报错。可以查看sonar日志web.log相关报错“Failed to upload report - 500: An error has occurred. Please contact your administrator”<br><img src="/images/2018/0202/12.png" alt="jenkins"><br><strong>A3:</strong><br>1.修改mysqld参数max_allowed_packet = 128M<br>2.重启mysqld服务<br>3.重启sonarqube服务（一定要重启）</p><p>参考链接：<br><a href="https://docs.sonarqube.org/display/SONAR/Installing+the+Server" target="_blank" rel="external">https://docs.sonarqube.org/display/SONAR/Installing+the+Server</a><br><a href="https://docs.sonarqube.org/display/SCAN/Analyzing+with+SonarQube+Scanner" target="_blank" rel="external">https://docs.sonarqube.org/display/SCAN/Analyzing+with+SonarQube+Scanner</a><br><a href="https://my.oschina.net/zxcholmes/blog/1529732" target="_blank" rel="external">https://my.oschina.net/zxcholmes/blog/1529732</a><br><a href="https://www.ibm.com/developerworks/cn/devops/1612_qusm_jenkins/index.html" target="_blank" rel="external">https://www.ibm.com/developerworks/cn/devops/1612_qusm_jenkins/index.html</a></p>]]></content>
      
      <categories>
          
          <category> 自动化运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 自动化 </tag>
            
            <tag> 运维 </tag>
            
            <tag> Sonar </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Bginfo--Windows系统信息显示工具</title>
      <link href="/arlo/ea6f862b/"/>
      <content type="html"><![CDATA[<p>经常维护多台Windows服务器，在服务器之间来回切换，经常容易搞混，为大家推荐一个维护利器BGinfo。<br><a id="more"></a></p><h1 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h1><p>下载地址：<a href="https://download.sysinternals.com/files/BGInfo.zip" target="_blank" rel="external">https://download.sysinternals.com/files/BGInfo.zip</a><br>下载、解压完成后，双击Bginfo64,同意即可价值默认信息；这里是我觉得平时会用到的参数信息。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">主机名称:&lt;Host Name&gt;</div><div class="line">系统版本:&lt;OS Version&gt;</div><div class="line">服务补丁包:&lt;Service Pack&gt;</div><div class="line">系统启动时间:&lt;Boot Time&gt;</div><div class="line">当前用户名:&lt;User Name&gt;</div><div class="line">------------------------------</div><div class="line">CPU:&lt;CPU&gt;</div><div class="line">内存:&lt;Memory&gt;</div><div class="line">磁盘可用空间:&lt;Free Space&gt;</div><div class="line">------------------------------</div><div class="line">IP Address:&lt;IP Address&gt;</div><div class="line">MAC Address:&lt;MAC Address&gt;</div><div class="line">Subnet Mask:&lt;Subnet Mask&gt;</div><div class="line">Default Gateway:&lt;Default Gateway&gt;</div><div class="line">DNS Server:&lt;DNS Server&gt;</div></pre></td></tr></table></figure></p><p>点击file-save as 保存D:\BGInfo为名为systeminfo.cgi<br><img src="/images/2018/0122/01.png" alt="bginfo"><br>Background：可以定义直接在当前壁纸上显示、指定一个壁纸路径或纯色显示。<br>Position：可配置信息输出位置（9个选项）以及多显示器输出支持<em>(偏爱右上)</em><br>Desktops：用于配置用户远程登录、控制台登录时的显示方式<br>Preview：预览配置效果<br><img src="/images/2018/0122/02.png" alt="bginfo"></p><h1 id="配置开机启动"><a href="#配置开机启动" class="headerlink" title="配置开机启动"></a>配置开机启动</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">1. </div><div class="line">在windows资源管理器输入shell:startup 快速打开当前用户的「启动」文件夹</div><div class="line">2. </div><div class="line">新建一个.bat文件，内容为D:\BGInfo\Bginfo64.exe systeminfo.bgi /timer:0 /nolicprompt /silent</div></pre></td></tr></table></figure><p>PS:</p><ol><li>此工具很方便，但是不能根据系统信息，自行刷新，可以添加计划任务进行刷新。</li><li>此工具大规模部署建议使用域环境操作。</li></ol><p>参考链接：<br><a href="https://docs.microsoft.com/en-us/sysinternals/downloads/bginfo" target="_blank" rel="external">https://docs.microsoft.com/en-us/sysinternals/downloads/bginfo</a><br><a href="https://www.sysgeek.cn/bginfo/" target="_blank" rel="external">https://www.sysgeek.cn/bginfo/</a></p>]]></content>
      
      <categories>
          
          <category> 常识 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> bginfo </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>部署office在线预览服务器(Office Web Apps Server)</title>
      <link href="/arlo/5b552504/"/>
      <content type="html"><![CDATA[<p>Office Web Apps Server 是一种 Office 服务器产品，可提供在浏览器中查看和编辑 Office 文件的服务。可提供浏览器版 Word、PowerPoint、Excel 和 OneNote。<br><a id="more"></a></p><h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><p>网络环境<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">服务器名ip地址</div><div class="line">dc.islocal.cc192.168.6.111</div><div class="line">apps.islocal.cc192.168.6.112</div></pre></td></tr></table></figure></p><p>软件环境<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">操作系统Windows Server 2012 R2 Standard</div><div class="line">.NET Framework 4.5.2</div><div class="line">Office Web Apps Servercn_office_web_apps_server_2013_with_sp1_x64_dvd_3832995.iso</div><div class="line">Office Web Apps Server SP1wacserversp2013-kb2880558-fullfile-x64-glb.exe</div><div class="line">语言包wacserverlanguagepack.exe</div></pre></td></tr></table></figure></p><h1 id="规划-Office-Web-Apps-Server"><a href="#规划-Office-Web-Apps-Server" class="headerlink" title="规划 Office Web Apps Server"></a>规划 Office Web Apps Server</h1><h2 id="Office-Web-Apps-Server-支持的操作系统"><a href="#Office-Web-Apps-Server-支持的操作系统" class="headerlink" title="Office Web Apps Server 支持的操作系统"></a>Office Web Apps Server 支持的操作系统</h2><p>您可以在以下操作系统上运行 Office Web Apps Server：</p><blockquote><p>安装了 Windows Server 2008 R2 x64 版本更新的 64 位版本 Windows Server 2008 R2 Service Pack 1 (SP1) Standard、Enterprise 或 Datacenter<br>Windows Server 2012 Standard 或 Datacenter 的 64 位版本<br>64 位版本的 Windows Server 2012 R2。若要使用此操作系统，则必须使用 Office Web Apps Server Service Pack 1 (SP1)。</p></blockquote><h2 id="Office-Web-Apps-Server-的域要求"><a href="#Office-Web-Apps-Server-的域要求" class="headerlink" title="Office Web Apps Server 的域要求"></a>Office Web Apps Server 的域要求</h2><p>Office Web Apps Server 场中的服务器都必须是域的一部分。它们可以在同一个域 （推荐） 中或位于同一个林中的不同域中。但是，如果您尝试在域控制器上安装它，Office Web Apps Server 将不起作用。</p><h2 id="Office-Web-Apps-Server-需要的服务器角色、服务及其他软件"><a href="#Office-Web-Apps-Server-需要的服务器角色、服务及其他软件" class="headerlink" title="Office Web Apps Server 需要的服务器角色、服务及其他软件"></a>Office Web Apps Server 需要的服务器角色、服务及其他软件</h2><p>首先，以下是部署 Office Web Apps Server 时不应执行的一些操作。</p><blockquote><p>请勿在运行 Office Web Apps Server 的服务器上安装任何其他服务器应用程序。包括 Exchange Server、SharePoint Server、Lync Server 和 SQL Server。如果您的服务器不足，则可以在这些服务器的其中一台上的虚拟机实例中运行 Office Web Apps Server。<br>不要在端口 80、443 或 809 上安装依赖 Web 服务器 (IIS) 角色的任何服务或角色，因为 Office Web Apps Server 会定期删除这些端口上的 Web 应用程序。<br>不要安装任何版本的 Office。如果已经安装，在安装 Office Web Apps Server 之前必须将其卸载。<br>不要在域控制器上安装 Office Web Apps Server。它不会在包含 Active Directory 域服务 (AD DS) 的服务器上运行。</p></blockquote><p><img src="/images/2018/0119/00.png" alt="owa"></p><h1 id="搭建域控服务器-DC"><a href="#搭建域控服务器-DC" class="headerlink" title="搭建域控服务器(DC)"></a>搭建域控服务器(DC)</h1><p>打开服务器管理，添加角色和功能<br><img src="/images/2018/0119/01.png" alt="owa"><br>默认下一步<br><img src="/images/2018/0119/02.png" alt="owa"><br>基于角色或基于功能的安装<br><img src="/images/2018/0119/03.png" alt="owa"><br>从服务器池中选择服务器，可以看到本机名称和ip地址<br><img src="/images/2018/0119/04.png" alt="owa"><br>勾选“DNS服务器”和“Active Directory域服务”<br><img src="/images/2018/0119/05.png" alt="owa"><br>默认下一步<br><img src="/images/2018/0119/06.png" alt="owa"><br><img src="/images/2018/0119/07.png" alt="owa"><br><img src="/images/2018/0119/08.png" alt="owa"><br>最后确认一下所有选择，开始安装<br><img src="/images/2018/0119/09.png" alt="owa"><br><img src="/images/2018/0119/10.png" alt="owa"><br>安装完成<br><img src="/images/2018/0119/11.png" alt="owa"><br>服务器管理器-AD DS- 将此服务器升级为域控制器<br><img src="/images/2018/0119/12.png" alt="owa"><br>添加新林，输入根域名islocal.cc<br><img src="/images/2018/0119/14.png" alt="owa"><br>设置一个目录服务还原模式密码<br><img src="/images/2018/0119/15.png" alt="owa"><br><img src="/images/2018/0119/16.png" alt="owa"><br><img src="/images/2018/0119/17.png" alt="owa"><br><img src="/images/2018/0119/18.png" alt="owa"><br><img src="/images/2018/0119/19.png" alt="owa"><br><img src="/images/2018/0119/20.png" alt="owa"><br>至此，与控制搭建工作已经完成！</p><h1 id="owa服务器加入域控"><a href="#owa服务器加入域控" class="headerlink" title="owa服务器加入域控"></a>owa服务器加入域控</h1><h2 id="apps服务器上操作"><a href="#apps服务器上操作" class="headerlink" title="apps服务器上操作"></a>apps服务器上操作</h2><p>设置apps服务器ip地址，将dns地址设置为域控地址192.168.6.111<br><img src="/images/2018/0119/21.png" alt="owa"><br>点击系统属性-计算机名-更改-域-输入域名；输入域控服务器的用户名密码，成功加入，重启服务器<br><img src="/images/2018/0119/22.png" alt="owa"></p><h2 id="域控上操作"><a href="#域控上操作" class="headerlink" title="域控上操作"></a>域控上操作</h2><p>服务器管理器-管理-添加服务器<br><img src="/images/2018/0119/23.png" alt="owa"><br>输入服务器名称，添加到计算机<br><img src="/images/2018/0119/24.png" alt="owa"><br>在所有服务器可以看到已经添加完成<br><img src="/images/2018/0119/25.png" alt="owa"><br><em>使用域管理员登录apps服务器，登录格式为：用户名：islocal\administrator，密码：域管理员密码</em><br><em>加入域后，ping不通服务器，服务器本地关闭域防火墙</em></p><h1 id="owa软件安装"><a href="#owa软件安装" class="headerlink" title="owa软件安装"></a>owa软件安装</h1><h2 id="安装-NET-Framework-4-5-2"><a href="#安装-NET-Framework-4-5-2" class="headerlink" title="安装.NET Framework 4.5.2"></a>安装.NET Framework 4.5.2</h2><p>下载地址 <a href="https://www.microsoft.com/zh-cn/download/details.aspx?id=42643" target="_blank" rel="external">https://www.microsoft.com/zh-cn/download/details.aspx?id=42643</a></p><h2 id="安装IIS"><a href="#安装IIS" class="headerlink" title="安装IIS"></a>安装IIS</h2><p><strong><font color="red">参考本文贴的第一张图，一定要安装全iis组件。</font></strong></p><h2 id="以管理员身份打开-Windows-PowerShell-提示符，然后运行此命令示例来安装必需的角色和服务"><a href="#以管理员身份打开-Windows-PowerShell-提示符，然后运行此命令示例来安装必需的角色和服务" class="headerlink" title="以管理员身份打开 Windows PowerShell 提示符，然后运行此命令示例来安装必需的角色和服务"></a>以管理员身份打开 Windows PowerShell 提示符，然后运行此命令示例来安装必需的角色和服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Add-WindowsFeature Web-Server,Web-Mgmt-Tools,Web-Mgmt-Console,Web-WebServer,Web-Common-Http,Web-Default-Doc,Web-Static-Content,Web-Performance,Web-Stat-Compression,Web-Dyn-Compression,Web-Security,Web-Filtering,Web-Windows-Auth,Web-App-Dev,Web-Net-Ext45,Web-Asp-Net45,Web-ISAPI-Ext,Web-ISAPI-Filter,Web-Includes,InkandHandwritingServices,NET-Framework-Features,NET-Framework-Core,NET-HTTP-Activation,NET-Non-HTTP-Activ,NET-WCF-HTTP-Activation45</div></pre></td></tr></table></figure><p><img src="/images/2018/0119/26.png" alt="owa"></p><h2 id="安装Office-Web-Apps-Server"><a href="#安装Office-Web-Apps-Server" class="headerlink" title="安装Office Web Apps Server"></a>安装Office Web Apps Server</h2><p>下载地址Office Web Apps Server<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ed2k://|file|cn_office_web_apps_server_2013_with_sp1_x64_dvd_3832995.iso|530315264|C33F5E985FB1B7CC74A28FAA4857458C|/</div></pre></td></tr></table></figure></p><p>加载到本地光驱，双击setup.exe开始安装<br><img src="/images/2018/0119/28.png" alt="owa"><br>选择文件安装位置<br><img src="/images/2018/0119/29.png" alt="owa"><br><img src="/images/2018/0119/30.png" alt="owa"><br><img src="/images/2018/0119/31.png" alt="owa"></p><h2 id="安装Office-Web-Apps-Server-SP1补丁包（2012R2必须项）"><a href="#安装Office-Web-Apps-Server-SP1补丁包（2012R2必须项）" class="headerlink" title="安装Office Web Apps Server SP1补丁包（2012R2必须项）"></a>安装Office Web Apps Server SP1补丁包（2012R2必须项）</h2><p>下载地址：<a href="https://support.microsoft.com/zh-cn/help/2880558/description-of-microsoft-office-web-apps-server-service-pack-1-sp1" target="_blank" rel="external">https://support.microsoft.com/zh-cn/help/2880558/description-of-microsoft-office-web-apps-server-service-pack-1-sp1</a><br><img src="/images/2018/0119/32.png" alt="owa"><br><img src="/images/2018/0119/33.png" alt="owa"></p><h2 id="安装语言包"><a href="#安装语言包" class="headerlink" title="安装语言包"></a>安装语言包</h2><p>下载地址：<a href="https://www.microsoft.com/zh-cn/download/details.aspx?id=35490" target="_blank" rel="external">https://www.microsoft.com/zh-cn/download/details.aspx?id=35490</a><br><img src="/images/2018/0119/34.png" alt="owa"></p><h1 id="owa服务器配置"><a href="#owa服务器配置" class="headerlink" title="owa服务器配置"></a>owa服务器配置</h1><h2 id="导入OfficeWebApps模块"><a href="#导入OfficeWebApps模块" class="headerlink" title="导入OfficeWebApps模块"></a>导入OfficeWebApps模块</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Import-Module -Name OfficeWebApps</div></pre></td></tr></table></figure><h2 id="创建一个Office-Web-Apps-Server"><a href="#创建一个Office-Web-Apps-Server" class="headerlink" title="创建一个Office Web Apps Server"></a>创建一个Office Web Apps Server</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">New-OfficeWebAppsFarm -InternalURL http://192.168.6.112 -AllowHttp -EditingEnabled</div><div class="line">Set-OfficeWebAppsFarm -OpenFromUrlEnabled:$true</div></pre></td></tr></table></figure><p><img src="/images/2018/0119/35.png" alt="owa"></p><h1 id="验证安装结果"><a href="#验证安装结果" class="headerlink" title="验证安装结果"></a>验证安装结果</h1><p><a href="http://192.168.6.112/hosting/discovery" target="_blank" rel="external">http://192.168.6.112/hosting/discovery</a><br><img src="/images/2018/0119/36.png" alt="owa"><br><a href="http://192.168.6.112/op/generate.aspx" target="_blank" rel="external">http://192.168.6.112/op/generate.aspx</a><br><img src="/images/2018/0119/37.png" alt="owa"><br>这里的测试文档URL必须使用域名，IP地址会报错“<span>很抱歉，由于某种原因不能为您打开。如果是本地定义的域名，只需要在预览服务器上添加一条hosts即可。<br><img src="/images/2018/0119/38.png" alt="owa"><br><img src="/images/2018/0119/39.png" alt="owa"></span></p><p>参考链接：<br><a href="https://technet.microsoft.com/zh-cn/library/jj219455.aspx" target="_blank" rel="external">https://technet.microsoft.com/zh-cn/library/jj219455.aspx</a><br><a href="http://www.cnblogs.com/timelyxyz/p/3645134.html" target="_blank" rel="external">http://www.cnblogs.com/timelyxyz/p/3645134.html</a><br><a href="http://blog.csdn.net/duanchuanttao/article/details/53467060" target="_blank" rel="external">http://blog.csdn.net/duanchuanttao/article/details/53467060</a><br><a href="http://blog.csdn.net/ituff/article/details/23880431" target="_blank" rel="external">http://blog.csdn.net/ituff/article/details/23880431</a></p>]]></content>
      
      <categories>
          
          <category> 服务器搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> 域控 </tag>
            
            <tag> office </tag>
            
            <tag> 在线预览 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Scp拷贝大文件出现stalled故障解决方法</title>
      <link href="/arlo/8954c4ab/"/>
      <content type="html"><![CDATA[<p>最近倒腾oracle数据库异地备份，由于端口限制不能使用rsync（首选），只能使用scp脚本自动拷贝到本地服务器，数据库按用户备份的，最大一个文件53G，发现每次都拷贝不完就中断了；之前以为是网络的问题导致shell退出，今天开了screen，手动执行脚本，特地跟踪了一下，发现出现stalled的故障；网上有找到的方法有以下几种，个人认为第三种更治根。<br><a id="more"></a></p><h1 id="限速"><a href="#限速" class="headerlink" title="限速"></a>限速</h1><p><code>scp -l 1000 /from/path  /to/path  #单位为Kbit，1000Kbit/8=125Kb</code></p><h1 id="修改内核参数"><a href="#修改内核参数" class="headerlink" title="修改内核参数"></a>修改内核参数</h1><p><code>echo 0 &gt; /proc/sys/net/ipv4/tcp_sack</code></p><h1 id="调整mtu值"><a href="#调整mtu值" class="headerlink" title="调整mtu值"></a>调整mtu值</h1><p>由于我的网络是PPPoE拨号的，最佳mtu值应为1492<br><code>ifconfig eth0 mtu 1492</code><br>or<br><code>ip link set dev eth0 mtu 1492</code></p><p>参考资料<br><a href="https://www.gpforums.co.nz/threads/399001-MTU-Value-1492-vs-1500" target="_blank" rel="external">https://www.gpforums.co.nz/threads/399001-MTU-Value-1492-vs-1500</a><br><a href="https://stackoverflow.com/questions/11985008/sending-a-large-file-with-scp-to-a-certain-server-stalls-at-exactly-2112-kb" target="_blank" rel="external">https://stackoverflow.com/questions/11985008/sending-a-large-file-with-scp-to-a-certain-server-stalls-at-exactly-2112-kb</a><br><a href="http://www.tp-link.com/tw/article/?faqid=190" target="_blank" rel="external">http://www.tp-link.com/tw/article/?faqid=190</a><br><a href="http://www.cnblogs.com/wjoyxt/p/6873714.html" target="_blank" rel="external">http://www.cnblogs.com/wjoyxt/p/6873714.html</a></p>]]></content>
      
      <categories>
          
          <category> Troubleshooting </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 常识 </tag>
            
            <tag> Scp </tag>
            
            <tag> MTU </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Oracle表空间扩容</title>
      <link href="/arlo/989e9822/"/>
      <content type="html"><![CDATA[<p>在新装完的oracle数据库中导入数据，由于数据量比较大，报以下错误；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ORA-39171: Job is experiencing a resumable wait.</div><div class="line">ORA-01653: unable to extend table AIR_FORECAST.T_WRF_DATA by 8192 in tablespace USERS</div></pre></td></tr></table></figure></p><a id="more"></a><p>此故障是由于数据库的表空间满了，造成的数据无法正常导入，我们需要手动来扩容表空间</p><h1 id="查询默认表空间"><a href="#查询默认表空间" class="headerlink" title="查询默认表空间"></a>查询默认表空间</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">select a.property_name, a.property_value from database_properties a where a.property_name like &apos;%DEFAULT%&apos;;</div><div class="line">……</div><div class="line">DEFAULT_PERMANENT_TABLESPACE</div><div class="line">USERS</div><div class="line">……</div></pre></td></tr></table></figure><h1 id="查看表空间使用情况"><a href="#查看表空间使用情况" class="headerlink" title="查看表空间使用情况"></a>查看表空间使用情况</h1><h2 id="在PL-SQL-Developer-中执行一下SQL语句"><a href="#在PL-SQL-Developer-中执行一下SQL语句" class="headerlink" title="在PL SQL Developer 中执行一下SQL语句"></a>在PL SQL Developer 中执行一下SQL语句</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SELECT a.tablespace_name &quot;表空间名&quot;,a.bytes / 1024 / 1024 &quot;表空间大小(M)&quot;,(a.bytes - b.bytes) / 1024 / 1024 &quot;已使用空间(M)&quot;,b.bytes / 1024 / 1024 &quot;空闲空间(M)&quot;,round(((a.bytes - b.bytes) / a.bytes) * 100, 2) &quot;使用比&quot;FROM (SELECT tablespace_name, sum(bytes) bytes FROM dba_data_files GROUP BY tablespace_name) a,(SELECT tablespace_name, sum(bytes) bytes, max(bytes) largest FROM dba_free_space GROUP BY tablespace_name) b WHERE a.tablespace_name = b.tablespace_name ORDER BY ((a.bytes - b.bytes) / a.bytes) DESC</div></pre></td></tr></table></figure><h2 id="查看USERS表空间文件及使用量"><a href="#查看USERS表空间文件及使用量" class="headerlink" title="查看USERS表空间文件及使用量"></a>查看USERS表空间文件及使用量</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SELECT file_name,tablespace_name,bytes / 1024 / 1024 &quot;bytes MB&quot;,maxbytes / 1024 / 1024 &quot;maxbytes MB&quot; FROM dba_data_files WHERE tablespace_name = &apos;USERS&apos;;</div></pre></td></tr></table></figure><h2 id="查看USERS表空间文件是否自动扩展"><a href="#查看USERS表空间文件是否自动扩展" class="headerlink" title="查看USERS表空间文件是否自动扩展"></a>查看USERS表空间文件是否自动扩展</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SELECT file_id, file_name, tablespace_name, autoextensible, increment_by FROM dba_data_files WHERE tablespace_name = &apos;USERS&apos; ORDER BY file_id desc;</div></pre></td></tr></table></figure><p>查看”autoextensible”对应的值是YES还是NO，若是NO，说明MSMS表空间的自动扩展功能没有开，改成YES就可以了。</p><h1 id="增加表空间文件"><a href="#增加表空间文件" class="headerlink" title="增加表空间文件"></a>增加表空间文件</h1><h2 id="查看表空间文件"><a href="#查看表空间文件" class="headerlink" title="查看表空间文件"></a>查看表空间文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SELECT * FROM dba_data_files t WHERE t.tablespace_name=&apos;USERS&apos;;</div></pre></td></tr></table></figure><p>查看得知我们的表空间文件在/u01/app/oracle/oradata/sx21/目录下，新建的文件也放在此目录下,方便后期管理</p><h2 id="查看表空间文件自增长文件最大值"><a href="#查看表空间文件自增长文件最大值" class="headerlink" title="查看表空间文件自增长文件最大值"></a>查看表空间文件自增长文件最大值</h2><p>因为Oracle的物理文件最大只允许4194303个数据块(datablock).需要查看一下本地block块大小<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">数据块的大小        物理文件的最大值 M</div><div class="line">===============================================               </div><div class="line">2048                  8191 M</div><div class="line">4096                  16383 M</div><div class="line">8192                  32767 M</div><div class="line">16384                 65535 M</div></pre></td></tr></table></figure></p><h2 id="linux下查看block大小"><a href="#linux下查看block大小" class="headerlink" title="linux下查看block大小"></a>linux下查看block大小</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">getconf PAGE_SIZE</div><div class="line">4096</div></pre></td></tr></table></figure><h2 id="添加表空间文件"><a href="#添加表空间文件" class="headerlink" title="添加表空间文件"></a>添加表空间文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter tablespace USERS add datafile &apos;/u01/app/oracle/oradata/sx21/users02.dbf&apos; size 5M autoextend on maxsize 16G;</div></pre></td></tr></table></figure><h2 id="ASM添加表空间文件"><a href="#ASM添加表空间文件" class="headerlink" title="ASM添加表空间文件"></a>ASM添加表空间文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter tablespace USERS add datafile &apos;+DATA&apos; size 5M autoextend on maxsize 16G;</div><div class="line">SQL&gt; select name from v$datafile;</div></pre></td></tr></table></figure><p><em>注意：ASM增加数据文件或者创建表空间不需要指定数据文件名，只要指定 diskgroup即可,ASM会自动命名。</em></p><h1 id="验证添加的表空间文件"><a href="#验证添加的表空间文件" class="headerlink" title="验证添加的表空间文件"></a>验证添加的表空间文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select file_name,file_id,tablespace_name FROM dba_data_files WHERE tablespace_name=&apos;USERS&apos;;</div><div class="line"></div><div class="line">FILE_NAME</div><div class="line">--------------------------------------------------------------------------------</div><div class="line">   FILE_ID TABLESPACE_NAME</div><div class="line">---------- ------------------------------</div><div class="line">/u01/app/oracle/oradata/sx21/users01.dbf</div><div class="line"> 4 USERS</div><div class="line"></div><div class="line">/u01/app/oracle/oradata/sx21/users02.dbf</div><div class="line"> 5 USERS</div></pre></td></tr></table></figure><h1 id="扩展阅读"><a href="#扩展阅读" class="headerlink" title="扩展阅读"></a>扩展阅读</h1><p><a href="http://www.dba-oracle.com/t_bigfile_tablespace_tips.htm" target="_blank" rel="external">http://www.dba-oracle.com/t_bigfile_tablespace_tips.htm</a></p><p>参考资料：<br><a href="http://blog.csdn.net/u013806814/article/details/48400861" target="_blank" rel="external">http://blog.csdn.net/u013806814/article/details/48400861</a><br><a href="http://blog.itpub.net/27042095/viewspace-1100993/" target="_blank" rel="external">http://blog.itpub.net/27042095/viewspace-1100993/</a><br><a href="http://blog.sina.com.cn/s/blog_9d4799c701017pw1.html" target="_blank" rel="external">http://blog.sina.com.cn/s/blog_9d4799c701017pw1.html</a></p>]]></content>
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>CentOS6.9环境静默安装Oracle11g</title>
      <link href="/arlo/6dacbf16/"/>
      <content type="html"><![CDATA[<h1 id="系统基础环境"><a href="#系统基础环境" class="headerlink" title="系统基础环境"></a>系统基础环境</h1><p>操作系统：CentOS 6.9 x64<br>Iptables：off<br>Selinux：disabled<br><a id="more"></a></p><h2 id="修改主机名"><a href="#修改主机名" class="headerlink" title="修改主机名"></a>修改主机名</h2><p>安装oracle后不要修改主机名，会引起故障<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">vim /etc/sysconfig/network</div><div class="line">NETWORKING=yes</div><div class="line">HOSTNAME=&quot;dbserver&quot;</div></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hostname dbserver</div></pre></td></tr></table></figure><h2 id="基础软件安装"><a href="#基础软件安装" class="headerlink" title="基础软件安装"></a>基础软件安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">#默认是不安装32位软件包的，添加此选项</div><div class="line">echo &apos;multilib_policy=all&apos; &gt;&gt; /etc/yum.conf</div><div class="line">yum -y install  binutils-* compat-libstdc++-* elfutils-libelf-*  elfutils-libelf-devel-* gcc-* gcc-c++-* glibc-* glibc-common-* glibc-devel-*  glibc-headers-* ksh-* libaio-*  libaio-devel-* libgcc-*  libstdc++* libstdc++-devel* make-*  sysstat-* unixODBC-* unixODBC-devel-* mksh</div><div class="line">#监测一下软件是否安装全</div><div class="line">rpm -q \</div><div class="line">binutils \</div><div class="line">compat-libstdc++-33 \</div><div class="line">elfutils-libelf \</div><div class="line">elfutils-libelf-devel \</div><div class="line">expat \</div><div class="line">gcc \</div><div class="line">gcc-c++ \</div><div class="line">glibc \</div><div class="line">glibc-common \</div><div class="line">glibc-devel \</div><div class="line">glibc-headers \</div><div class="line">libaio \</div><div class="line">libaio-devel \</div><div class="line">libgcc \</div><div class="line">libstdc++ \</div><div class="line">libstdc++-devel \</div><div class="line">make \</div><div class="line">pdksh \</div><div class="line">sysstat \</div><div class="line">unixODBC \</div><div class="line">unixODBC-devel | grep &quot;not installed&quot;</div></pre></td></tr></table></figure><h2 id="修改PAM配置文件"><a href="#修改PAM配置文件" class="headerlink" title="修改PAM配置文件"></a>修改PAM配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">vi /etc/pam.d/login</div><div class="line">session    required     /lib64/security/pam_limits.so</div><div class="line">session    required     pam_limits.so</div></pre></td></tr></table></figure><h2 id="修改内核参数"><a href="#修改内核参数" class="headerlink" title="修改内核参数"></a>修改内核参数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">fs.aio-max-nr = 1048576 </div><div class="line">fs.file-max = 6815744 </div><div class="line">kernel.shmmni = 4096 </div><div class="line">kernel.sem = 250 32000 100 128 </div><div class="line">net.ipv4.ip_local_port_range = 9000 65500 </div><div class="line">net.core.rmem_default = 262144 </div><div class="line">net.core.rmem_max = 4194304 </div><div class="line">net.core.wmem_default = 262144 </div><div class="line">net.core.wmem_max = 1048586</div><div class="line"></div><div class="line"></div><div class="line">#重新加载生效</div><div class="line">sysctl –p</div></pre></td></tr></table></figure><h2 id="修改系统资源限制"><a href="#修改系统资源限制" class="headerlink" title="修改系统资源限制"></a>修改系统资源限制</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">vi /etc/security/limits.conf  </div><div class="line">oracle  soft  nproc   2047 </div><div class="line">oracle  hard  nproc   16384 </div><div class="line">oracle  soft  nofile  1024 </div><div class="line">oracle  hard  nofile  65536</div><div class="line">oraclesoft  stack   10240</div></pre></td></tr></table></figure><h1 id="Oracle相关环境配置"><a href="#Oracle相关环境配置" class="headerlink" title="Oracle相关环境配置"></a>Oracle相关环境配置</h1><h2 id="新建用户"><a href="#新建用户" class="headerlink" title="新建用户"></a>新建用户</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">groupadd -g 500 oinstall</div><div class="line">groupadd -g 501 dba</div><div class="line">useradd -u 500 -g oinstall -G dba oracle</div><div class="line">#设置oracle用户密码为oracle</div><div class="line">echo &quot;oracle:oracle&quot; | chpasswd</div></pre></td></tr></table></figure><h2 id="修改用户配置文件"><a href="#修改用户配置文件" class="headerlink" title="修改用户配置文件"></a>修改用户配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">vi/ etc/profile</div><div class="line">if [ $USER = &quot;oracle&quot; ]; then</div><div class="line">   if [ $SHELL = &quot;/bin/ksh&quot; ]; then</div><div class="line">       ulimit -p 16384</div><div class="line">       ulimit -n 65536</div><div class="line">   else</div><div class="line">       ulimit -u 16384 -n 65536</div><div class="line">   fi</div><div class="line">fi</div></pre></td></tr></table></figure><h2 id="新建目录并设置权限"><a href="#新建目录并设置权限" class="headerlink" title="新建目录并设置权限"></a>新建目录并设置权限</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mkdir -p /u01/app/oracle/product/11.2.0/db_1</div><div class="line">mkdir -p /u01/app/oraInventory</div><div class="line">chown -R oracle.oinstall /u01/app/oracle</div><div class="line">chown -R oracle.oinstall /u01/app/oraInventory</div><div class="line">chmod -R 775 /u01/app</div></pre></td></tr></table></figure><h2 id="设置oracle用户环境变量"><a href="#设置oracle用户环境变量" class="headerlink" title="设置oracle用户环境变量"></a>设置oracle用户环境变量</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">su - oracle</div><div class="line">$ vim ~/.bash_profile </div><div class="line">export ORACLE_BASE=/u01/app/oracle</div><div class="line">export ORACLE_HOME=$ORACLE_BASE/product/11.2.0/db_1</div><div class="line">export ORACLE_SID=sx21</div><div class="line">export PATH=$PATH:$ORACLE_HOME/bin</div><div class="line">export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib</div><div class="line">export NLS_LANG=American_America.ZHS16GBK</div></pre></td></tr></table></figure><h2 id="检查环境变量是否生效"><a href="#检查环境变量是否生效" class="headerlink" title="检查环境变量是否生效"></a>检查环境变量是否生效</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">source ~/.bash_profile</div><div class="line">env |grep ORA</div><div class="line">ORACLE_SID=sx21</div><div class="line">ORACLE_BASE=/u01/app/oracle</div><div class="line">ORACLE_HOME=/u01/app/oracle/product/11.2.0/db_1</div></pre></td></tr></table></figure><h2 id="准备软件安装包"><a href="#准备软件安装包" class="headerlink" title="准备软件安装包"></a>准备软件安装包</h2><p>下载地址: <a href="http://www.oracle.com/technetwork/database/enterprise-edition/downloads/112010-linx8664soft-100572.html" target="_blank" rel="external">http://www.oracle.com/technetwork/database/enterprise-edition/downloads/112010-linx8664soft-100572.html</a><br>可以使用cksum校验文件完整性<br>linux.x64_11gR2_database_1of2.zip (1,239,269,270 bytes) (cksum - 3152418844)<br>linux.x64_11gR2_database_2of2.zip (1,111,416,131 bytes) (cksum - 3669256139)</p><h2 id="解压软件包"><a href="#解压软件包" class="headerlink" title="解压软件包"></a>解压软件包</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">unzip linux.x64_11gR2_database_1of2.zip</div><div class="line">unzip linux.x64_11gR2_database_2of2.zip</div></pre></td></tr></table></figure><p>解压后得到/home/oracle/database/response目录，该目录中有三个rsp文件，用来作为静默安装时的应答文件的模板。<br>备份三个文件并修改其内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">db_install.rsp安装应答</div><div class="line">netca.rsp建立监听、本地服务名等网络设置的应答</div><div class="line">dbca.rsp创建数据库应答</div></pre></td></tr></table></figure></p><h1 id="静默安装数据库软件"><a href="#静默安装数据库软件" class="headerlink" title="静默安装数据库软件"></a>静默安装数据库软件</h1><h2 id="修改db-install-rsp-文件"><a href="#修改db-install-rsp-文件" class="headerlink" title="修改db_install.rsp 文件"></a>修改db_install.rsp 文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">egrep -v &quot;^#|^$&quot; db_install.rsp</div><div class="line">oracle.install.responseFileVersion=/oracle/install/rspfmt_dbinstall_response_schema_v11_2_0</div><div class="line">oracle.install.option=INSTALL_DB_SWONLY</div><div class="line">ORACLE_HOSTNAME=dbserver</div><div class="line">UNIX_GROUP_NAME=oinstall</div><div class="line">INVENTORY_LOCATION=/u01/app/oraInventory</div><div class="line">SELECTED_LANGUAGES=en,zh_CN</div><div class="line">ORACLE_HOME=/u01/app/oracle/product/11.2.0/db_1</div><div class="line">ORACLE_BASE=/u01/app/oracle</div><div class="line">oracle.install.db.InstallEdition=EE</div><div class="line">oracle.install.db.isCustomInstall=false</div><div class="line">oracle.install.db.customComponents=oracle.server:11.2.0.1.0,oracle.sysman.ccr:10.2.7.0.0,oracle.xdk:11.2.0.1.0,oracle.rdbms.oci:11.2.0.1.0,oracle.network:11.2.0.1.0,oracle.network.listener:11.2.0.1.0,oracle.rdbms:11.2.0.1.0,oracle.options:11.2.0.1.0,oracle.rdbms.partitioning:11.2.0.1.0,oracle.oraolap:11.2.0.1.0,oracle.rdbms.dm:11.2.0.1.0,oracle.rdbms.dv:11.2.0.1.0,orcle.rdbms.lbac:11.2.0.1.0,oracle.rdbms.rat:11.2.0.1.0</div><div class="line">oracle.install.db.DBA_GROUP=dba</div><div class="line">oracle.install.db.OPER_GROUP=dba</div><div class="line">oracle.install.db.CLUSTER_NODES=</div><div class="line">oracle.install.db.config.starterdb.type=</div><div class="line">oracle.install.db.config.starterdb.globalDBName=sx21</div><div class="line">oracle.install.db.config.starterdb.SID=sx21</div><div class="line">oracle.install.db.config.starterdb.characterSet=ZHS16GBK</div><div class="line">oracle.install.db.config.starterdb.memoryOption=true</div><div class="line">oracle.install.db.config.starterdb.memoryLimit=81920</div><div class="line">oracle.install.db.config.starterdb.installExampleSchemas=false</div><div class="line">oracle.install.db.config.starterdb.enableSecuritySettings=true</div><div class="line">oracle.install.db.config.starterdb.password.ALL=solution#123</div><div class="line">oracle.install.db.config.starterdb.password.SYS=</div><div class="line">oracle.install.db.config.starterdb.password.SYSTEM=</div><div class="line">oracle.install.db.config.starterdb.password.SYSMAN=</div><div class="line">oracle.install.db.config.starterdb.password.DBSNMP=</div><div class="line">oracle.install.db.config.starterdb.control=DB_CONTROL</div><div class="line">oracle.install.db.config.starterdb.gridcontrol.gridControlServiceURL=</div><div class="line">oracle.install.db.config.starterdb.dbcontrol.enableEmailNotification=false</div><div class="line">oracle.install.db.config.starterdb.dbcontrol.emailAddress=</div><div class="line">oracle.install.db.config.starterdb.dbcontrol.SMTPServer=</div><div class="line">oracle.install.db.config.starterdb.automatedBackup.enable=false</div><div class="line">oracle.install.db.config.starterdb.automatedBackup.osuid=</div><div class="line">oracle.install.db.config.starterdb.automatedBackup.ospwd=</div><div class="line">oracle.install.db.config.starterdb.storageType=</div><div class="line">oracle.install.db.config.starterdb.fileSystemStorage.dataLocation=</div><div class="line">oracle.install.db.config.starterdb.fileSystemStorage.recoveryLocation=</div><div class="line">oracle.install.db.config.asm.diskGroup=</div><div class="line">oracle.install.db.config.asm.ASMSNMPPassword=</div><div class="line">MYORACLESUPPORT_USERNAME=</div><div class="line">MYORACLESUPPORT_PASSWORD=</div><div class="line">SECURITY_UPDATES_VIA_MYORACLESUPPORT=</div><div class="line">DECLINE_SECURITY_UPDATES=true</div><div class="line">PROXY_HOST=</div><div class="line">PROXY_PORT=</div><div class="line">PROXY_USER=</div><div class="line">PROXY_PWD=</div></pre></td></tr></table></figure><h2 id="执行静默安装"><a href="#执行静默安装" class="headerlink" title="执行静默安装"></a>执行静默安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$ pwd</div><div class="line">/home/oracle/database</div><div class="line">./runInstaller -silent -ignorePrereq -ignoreSysPrereqs -responseFile /home/oracle/database/response/db_install.rsp</div><div class="line"></div><div class="line">Starting Oracle Universal Installer...</div><div class="line"></div><div class="line">Checking Temp space: must be greater than 120 MB.   Actual 26363 MB    Passed</div><div class="line">Checking swap space: must be greater than 150 MB.   Actual 4095 MB    Passed</div><div class="line">Preparing to launch Oracle Universal Installer from /tmp/OraInstall2017-12-27_02-06-55PM. Please wait ...[oracle@dbserver database]$ You can find the log of this install session at:</div><div class="line"> /u01/app/oraInventory/logs/installActions2017-12-27_02-06-55PM.log</div></pre></td></tr></table></figure><p>安装过程中可以另开一个窗口跟踪查看日志<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">tailf /u01/app/oraInventory/logs/installActions2017-12-27_02-06-55PM.log</div><div class="line"></div><div class="line">……</div><div class="line"></div><div class="line">INFO: Completed validating state &lt;finish&gt;</div><div class="line">INFO: Terminating all background operations</div><div class="line">INFO: Terminated all background operations</div><div class="line">INFO: Successfully executed the flow in SILENT mode</div><div class="line">INFO: Finding the most appropriate exit status for the current application</div><div class="line">INFO: Exit Status is 0</div><div class="line">INFO: Shutdown Oracle Database 11g Release 2 Installer</div><div class="line">INFO: Unloading Setup Driver</div></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"> #!/bin/sh </div><div class="line"> #Root scripts to run</div><div class="line"></div><div class="line">/u01/app/oraInventory/orainstRoot.sh</div><div class="line">/u01/app/oracle/product/11.2.0/db_1/root.sh</div><div class="line">To execute the configuration scripts:</div><div class="line"> 1. Open a terminal window </div><div class="line"> 2. Log in as &quot;root&quot; </div><div class="line"> 3. Run the scripts </div><div class="line"> 4. Return to this window and hit &quot;Enter&quot; key to continue </div><div class="line"></div><div class="line">Successfully Setup Software.</div></pre></td></tr></table></figure><p>一直到主窗口出现以上提示，以root用户打开一个窗口，一次执行下面操作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@dbserver ~]# /u01/app/oraInventory/orainstRoot.sh</div><div class="line">Changing permissions of /u01/app/oraInventory.</div><div class="line">Adding read,write permissions for group.</div><div class="line">Removing read,write,execute permissions for world.</div><div class="line"></div><div class="line">Changing groupname of /u01/app/oraInventory to oinstall.</div><div class="line">The execution of the script is complete.</div><div class="line">[root@dbserver ~]# /u01/app/oracle/product/11.2.0/db_1/root.sh</div><div class="line">Check /u01/app/oracle/product/11.2.0/db_1/install/root_dbserver_2017-12-27_14-23-43.log for the output of root script</div></pre></td></tr></table></figure></p><h1 id="静默安装监听"><a href="#静默安装监听" class="headerlink" title="静默安装监听"></a>静默安装监听</h1><p>使用默认配置文件，不用修改<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">$ORACLE_HOME/bin/netca /silent /responseFile /home/oracle/database/response/netca.rsp</div><div class="line"></div><div class="line"></div><div class="line">Parsing command line arguments:</div><div class="line">    Parameter &quot;silent&quot; = true</div><div class="line">    Parameter &quot;responsefile&quot; = /home/oracle/database/response/netca.rsp</div><div class="line">Done parsing command line arguments.</div><div class="line">Oracle Net Services Configuration:</div><div class="line">Profile configuration complete.</div><div class="line">Oracle Net Listener Startup:</div><div class="line">    Running Listener Control: </div><div class="line">      /u01/app/oracle/product/11.2.0/db_1/bin/lsnrctl start LISTENER</div><div class="line">    Listener Control complete.</div><div class="line">    Listener started successfully.</div><div class="line">Listener configuration complete.</div><div class="line">Oracle Net Services configuration successful. The exit code is 0</div></pre></td></tr></table></figure></p><p>默认监听是开启状态<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">[oracle@dbserver database]$ lsnrctl status</div><div class="line"></div><div class="line">LSNRCTL for Linux: Version 11.2.0.1.0 - Production on 27-DEC-2017 14:26:34</div><div class="line"></div><div class="line">Copyright (c) 1991, 2009, Oracle.  All rights reserved.</div><div class="line"></div><div class="line">Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=EXTPROC1521)))</div><div class="line">STATUS of the LISTENER</div><div class="line">------------------------</div><div class="line">Alias                     LISTENER</div><div class="line">Version                   TNSLSNR for Linux: Version 11.2.0.1.0 - Production</div><div class="line">Start Date                27-DEC-2017 14:25:48</div><div class="line">Uptime                    0 days 0 hr. 0 min. 50 sec</div><div class="line">Trace Level               off</div><div class="line">Security                  ON: Local OS Authentication</div><div class="line">SNMP                      OFF</div><div class="line">Listener Parameter File   /u01/app/oracle/product/11.2.0/db_1/network/admin/listener.ora</div><div class="line">Listener Log File         /u01/app/oracle/diag/tnslsnr/dbserver/listener/alert/log.xml</div><div class="line">Listening Endpoints Summary...</div><div class="line">  (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1521)))</div><div class="line">  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=dbserver)(PORT=1521)))</div><div class="line">The listener supports no services</div><div class="line">The command completed successfully</div></pre></td></tr></table></figure></p><h1 id="静默新建实例"><a href="#静默新建实例" class="headerlink" title="静默新建实例"></a>静默新建实例</h1><h2 id="修改dbca-rsp配置"><a href="#修改dbca-rsp配置" class="headerlink" title="修改dbca.rsp配置"></a>修改dbca.rsp配置</h2><p>这里只需要修改[CREATEDATABASE]部分即可，其他的保持默认<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">$ egrep -v &quot;^#|^$&quot; dbca.rsp </div><div class="line">[GENERAL]</div><div class="line">RESPONSEFILE_VERSION = &quot;11.2.0&quot;</div><div class="line">OPERATION_TYPE = &quot;createDatabase&quot;</div><div class="line">[CREATEDATABASE]</div><div class="line">GDBNAME = &quot;sx21&quot;</div><div class="line">SID = &quot;sx21&quot;</div><div class="line">TEMPLATENAME = &quot;General_Purpose.dbc&quot;</div><div class="line">SYSPASSWORD = &quot;solution#123&quot;</div><div class="line">SYSTEMPASSWORD = &quot;solution#123&quot;</div><div class="line">CHARACTERSET = &quot;ZHS16GBK&quot;</div><div class="line">NATIONALCHARACTERSET= &quot;AL16UTF16&quot;</div><div class="line">[createTemplateFromDB]</div><div class="line">SOURCEDB = &quot;myhost:1521:orcl&quot;</div><div class="line">SYSDBAUSERNAME = &quot;system&quot;</div><div class="line">TEMPLATENAME = &quot;My Copy TEMPLATE&quot;</div><div class="line">[createCloneTemplate]</div><div class="line">SOURCEDB = &quot;orcl&quot;</div><div class="line">TEMPLATENAME = &quot;My Clone TEMPLATE&quot;</div><div class="line">[DELETEDATABASE]</div><div class="line">SOURCEDB = &quot;orcl&quot;</div><div class="line">[generateScripts]</div><div class="line">TEMPLATENAME = &quot;New Database&quot;</div><div class="line">GDBNAME = &quot;orcl11.us.oracle.com&quot;</div><div class="line">[CONFIGUREDATABASE]</div><div class="line">[ADDINSTANCE]</div><div class="line">DB_UNIQUE_NAME = &quot;orcl11g.us.oracle.com&quot;</div><div class="line">NODELIST=</div><div class="line">SYSDBAUSERNAME = &quot;sys&quot;</div><div class="line">[DELETEINSTANCE]</div><div class="line">DB_UNIQUE_NAME = &quot;orcl11g.us.oracle.com&quot;</div><div class="line">INSTANCENAME = &quot;orcl11g&quot;</div><div class="line">SYSDBAUSERNAME = &quot;sys&quot;</div></pre></td></tr></table></figure></p><h2 id="执行静默安装-1"><a href="#执行静默安装-1" class="headerlink" title="执行静默安装"></a>执行静默安装</h2><p>不清楚是什么原因，我执行静默安装命令，屏幕就一直闪烁，不能输入密码，所以我将密码写到dbca.rsp文件中了，可以避免此问题！<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">$ORACLE_HOME/bin/dbca -silent -responseFile /home/oracle/database/response/dbca.rsp</div><div class="line"></div><div class="line"></div><div class="line">Copying database files</div><div class="line">1% complete</div><div class="line">2% complete</div><div class="line">4% complete</div><div class="line">37% complete</div><div class="line">Creating and starting Oracle instance</div><div class="line">38% complete</div><div class="line">40% complete</div><div class="line">45% complete</div><div class="line">50% complete</div><div class="line">51% complete</div><div class="line">56% complete</div><div class="line">57% complete</div><div class="line">61% complete</div><div class="line">62% complete</div><div class="line">Completing Database Creation</div><div class="line">66% complete</div><div class="line">70% complete</div><div class="line">73% complete</div><div class="line">74% complete</div><div class="line">85% complete</div><div class="line">86% complete</div><div class="line">98% complete</div><div class="line">100% complete</div><div class="line">Look at the log file &quot;/u01/app/oracle/cfgtoollogs/dbca/sx21/sx21.log&quot; for further details.</div></pre></td></tr></table></figure></p><h1 id="验证安装结果"><a href="#验证安装结果" class="headerlink" title="验证安装结果"></a>验证安装结果</h1><h2 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">[oracle@dbserver app]$ ps -ef |grep ora_</div><div class="line">oracle    5432     1  0 17:02 ?        00:00:00 ora_pmon_sx21</div><div class="line">oracle    5434     1  0 17:02 ?        00:00:00 ora_vktm_sx21</div><div class="line">oracle    5438     1  0 17:02 ?        00:00:00 ora_gen0_sx21</div><div class="line">oracle    5440     1  0 17:02 ?        00:00:00 ora_diag_sx21</div><div class="line">oracle    5442     1  0 17:02 ?        00:00:00 ora_dbrm_sx21</div><div class="line">oracle    5444     1  0 17:02 ?        00:00:00 ora_psp0_sx21</div><div class="line">oracle    5446     1  0 17:02 ?        00:00:00 ora_dia0_sx21</div><div class="line">oracle    5448     1  0 17:02 ?        00:00:01 ora_mman_sx21</div><div class="line">oracle    5450     1  0 17:02 ?        00:00:00 ora_dbw0_sx21</div><div class="line">oracle    5452     1  0 17:02 ?        00:00:00 ora_lgwr_sx21</div><div class="line">oracle    5454     1  0 17:02 ?        00:00:00 ora_ckpt_sx21</div><div class="line">oracle    5456     1  0 17:02 ?        00:00:00 ora_smon_sx21</div><div class="line">oracle    5458     1  0 17:02 ?        00:00:00 ora_reco_sx21</div><div class="line">oracle    5460     1  0 17:02 ?        00:00:00 ora_mmon_sx21</div><div class="line">oracle    5462     1  0 17:02 ?        00:00:00 ora_mmnl_sx21</div><div class="line">oracle    5464     1  0 17:02 ?        00:00:00 ora_d000_sx21</div><div class="line">oracle    5466     1  0 17:02 ?        00:00:00 ora_s000_sx21</div><div class="line">oracle    5558     1  0 17:02 ?        00:00:00 ora_qmnc_sx21</div><div class="line">oracle    5575     1  0 17:02 ?        00:00:00 ora_cjq0_sx21</div><div class="line">oracle    5579     1  0 17:02 ?        00:00:00 ora_q000_sx21</div><div class="line">oracle    5581     1  0 17:02 ?        00:00:00 ora_q001_sx21</div><div class="line">oracle    5585  1550  0 17:04 pts/0    00:00:00 grep ora_</div></pre></td></tr></table></figure><h2 id="监听"><a href="#监听" class="headerlink" title="监听"></a>监听</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">[oracle@dbserver app]$ lsnrctl status</div><div class="line"></div><div class="line">LSNRCTL for Linux: Version 11.2.0.1.0 - Production on 27-DEC-2017 17:04:44</div><div class="line"></div><div class="line">Copyright (c) 1991, 2009, Oracle.  All rights reserved.</div><div class="line"></div><div class="line">Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=EXTPROC1521)))</div><div class="line">STATUS of the LISTENER</div><div class="line">------------------------</div><div class="line">Alias                     LISTENER</div><div class="line">Version                   TNSLSNR for Linux: Version 11.2.0.1.0 - Production</div><div class="line">Start Date                27-DEC-2017 16:49:14</div><div class="line">Uptime                    0 days 0 hr. 15 min. 32 sec</div><div class="line">Trace Level               off</div><div class="line">Security                  ON: Local OS Authentication</div><div class="line">SNMP                      OFF</div><div class="line">Listener Parameter File   /u01/app/oracle/product/11.2.0/db_1/network/admin/listener.ora</div><div class="line">Listener Log File         /u01/app/oracle/diag/tnslsnr/dbserver/listener/alert/log.xml</div><div class="line">Listening Endpoints Summary...</div><div class="line">  (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1521)))</div><div class="line">  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=dbserver)(PORT=1521)))</div><div class="line">Services Summary...</div><div class="line">Service &quot;sx21&quot; has 1 instance(s).</div><div class="line">  Instance &quot;sx21&quot;, status READY, has 1 handler(s) for this service...</div><div class="line">Service &quot;sx21XDB&quot; has 1 instance(s).</div><div class="line">  Instance &quot;sx21&quot;, status READY, has 1 handler(s) for this service...</div><div class="line">The command completed successfully</div></pre></td></tr></table></figure><h2 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">[oracle@dbserver app]$ sqlplus /nolog</div><div class="line"></div><div class="line">SQL*Plus: Release 11.2.0.1.0 Production on Wed Dec 27 17:05:57 2017</div><div class="line"></div><div class="line">Copyright (c) 1982, 2009, Oracle.  All rights reserved.</div><div class="line"></div><div class="line">SQL&gt; conn /as sysdba</div><div class="line">Connected.</div><div class="line">SQL&gt; shutdown immediate</div><div class="line">Database closed.</div><div class="line">Database dismounted.</div><div class="line">ORACLE instance shut down.</div><div class="line">SQL&gt; startup</div><div class="line">ORACLE instance started.</div><div class="line"></div><div class="line">Total System Global Area 3340451840 bytes</div><div class="line">Fixed Size    2217952 bytes</div><div class="line">Variable Size 1811941408 bytes</div><div class="line">Database Buffers 1509949440 bytes</div><div class="line">Redo Buffers   16343040 bytes</div><div class="line">Database mounted.</div><div class="line">Database opened.</div></pre></td></tr></table></figure><p>参考文档：<br><a href="https://www.jianshu.com/p/b4200e721bfd" target="_blank" rel="external">https://www.jianshu.com/p/b4200e721bfd</a><br><a href="http://blog.51cto.com/wzlinux/1710941" target="_blank" rel="external">http://blog.51cto.com/wzlinux/1710941</a></p>]]></content>
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>枚举卷期间出错: 客户端无法连接到请求中指定的目标……</title>
      <link href="/arlo/143cd09f/"/>
      <content type="html"><![CDATA[<p>存储：华为/OceanStor 2600 V3<br>网络：FC<br>服务器：Windows Server 2012 R2<br>更新系统补丁重启后连接存储提示以下错误：</p><blockquote><p>枚举存储期间出错。枚举卷期间出错: 客户端无法连接到请求中指定的目标。 请验证该目标上的服务是否正在运行以及是否正在接受请求。 有关目标(通常是 IIS 或 WinRM)上运行的 WS 管理服务，请查阅日志和文档。 如果目标是 WinRM 服务，则在目标上运行以下命令来分析和配置 WinRM 服务: “winrm quickconfig”。</p></blockquote><a id="more"></a><p><img src="/images/2017/1206/02.png" alt="stor"><br>这个错误应该跟 WinRM 服务有关，找到服务启用“ Windows Remote Management（WinRM）”服务后恢复正常;顺便设置服务为开机自启动。<br><img src="/images/2017/1206/03.png" alt="stor"></p>]]></content>
      
      <categories>
          
          <category> Troubleshooting </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> 华为 </tag>
            
            <tag> 存储 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>搭建ftp服务器并配置虚拟用户登录</title>
      <link href="/arlo/5cd2f164/"/>
      <content type="html"><![CDATA[<p>vsftpd 是“very secure FTP daemon”的缩写，安全性是它的一个最大的特点。<br>本次搭建ftp服务器，采用虚拟用户登录；所谓虚拟用户就是没有使用真实的系统用户，只是通过映射到真实的账户和设置权限的目的。虚拟用户不能登录操作系统。<br><a id="more"></a></p><h1 id="系统环境"><a href="#系统环境" class="headerlink" title="系统环境"></a>系统环境</h1><p>CentOS 6.9<br>SELinux disabled</p><h1 id="软件安装"><a href="#软件安装" class="headerlink" title="软件安装"></a>软件安装</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install db4 db4-utils vsftpd</div></pre></td></tr></table></figure><h1 id="创建虚拟用户的宿主用户"><a href="#创建虚拟用户的宿主用户" class="headerlink" title="创建虚拟用户的宿主用户"></a>创建虚拟用户的宿主用户</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">useradd -u 600 -d /data/ftproot -s /sbin/nologin slvftp</div></pre></td></tr></table></figure><h1 id="创建用户名密码文件"><a href="#创建用户名密码文件" class="headerlink" title="创建用户名密码文件"></a>创建用户名密码文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">vim account.txt</div><div class="line">slftp1</div><div class="line">xxxxxx</div><div class="line">slftp2</div><div class="line">yyyyyy</div></pre></td></tr></table></figure><h1 id="生成虚拟用户认证文件"><a href="#生成虚拟用户认证文件" class="headerlink" title="生成虚拟用户认证文件"></a>生成虚拟用户认证文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">db_load -T -t hash -f ./account.txt /etc/vsftpd/account.db</div><div class="line">#安全原因，修改认证文件权限</div><div class="line">chmod 600 /etc/vsftpd/account.db</div><div class="line">#执行完此操作，建议删除account.txt</div></pre></td></tr></table></figure><h1 id="配置认证文件"><a href="#配置认证文件" class="headerlink" title="配置认证文件"></a>配置认证文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">vim /etc/pam.d/vsftpd.sl</div><div class="line">auth required /lib64/security/pam_userdb.so db=/etc/vsftpd/account</div><div class="line">account required /lib64/security/pam_userdb.so db=/etc/vsftpd/account</div><div class="line">#我这里是64位的操作系统，写的是/lib64,如果是32位的操作系统，写成/lib即可</div></pre></td></tr></table></figure><h1 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">vim /etc/vsftpd/vsftpd.conf</div><div class="line">#虚拟用户权限与匿名用户权限相同，虚拟用户权限单独设定</div><div class="line">virtual_use_local_privs=NO</div><div class="line">#服务器独立运行</div><div class="line">listen=YES</div><div class="line">#设定不允许匿名访问</div><div class="line">anonymous_enable=NO</div><div class="line">#设定本地用户可以访问。注：如使用虚拟宿主用户，在该项目设定为NO的情况下所有虚拟用户将无法访问</div><div class="line">local_enable=YES</div><div class="line">#使用户不能离开主目录</div><div class="line">chroot_list_enable=YES</div><div class="line">chroot_list_enable=YES</div><div class="line">chroot_list_file=/etc/vsftpd/chroot_list</div><div class="line">#设定支持ASCII模式的上传和下载功能</div><div class="line">ascii_upload_enable=YES</div><div class="line">ascii_download_enable=YES</div><div class="line">#PAM认证文件名。PAM将根据/etc/pam.d/vsftpd.sl进行认证</div><div class="line">pam_service_name=vsftpd.sl</div><div class="line">#设定启用虚拟用户功能</div><div class="line">guest_enable=YES</div><div class="line">#指定虚拟用户的宿主用户，CentOS中已经有内置的ftp用户了</div><div class="line">guest_username=slvftp</div><div class="line">#设定虚拟用户个人vsftp的CentOS FTP服务文件存放路径。存放虚拟用户个性的CentOS FTP服务文件(配置文件名=虚拟用户名)</div><div class="line">user_config_dir=/etc/vsftpd/user_config/</div><div class="line">#配置vsftpd日志（可选）</div><div class="line">xferlog_enable=YES</div><div class="line">xferlog_std_format=YES</div><div class="line">xferlog_file=/var/log/xferlog</div><div class="line">dual_log_enable=YES</div><div class="line">vsftpd_log_file=/var/log/vsftpd.log</div></pre></td></tr></table></figure><h1 id="新建chroot-list空文件"><a href="#新建chroot-list空文件" class="headerlink" title="新建chroot_list空文件"></a>新建chroot_list空文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">touch /etc/vsftpd/chroot_list</div></pre></td></tr></table></figure><h1 id="创建虚拟用户的配置目录文件"><a href="#创建虚拟用户的配置目录文件" class="headerlink" title="创建虚拟用户的配置目录文件"></a>创建虚拟用户的配置目录文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">mkdir /etc/vsftpd/user_config/</div><div class="line">#虚拟用户配置文件名必须与用户名一致</div><div class="line">vim /etc/vsftpd/user_config/slftp1</div><div class="line">guest_username=slvftp #虚拟用户的宿主用户</div><div class="line">local_root=/data/ftproot/slftp1  #虚拟用户根目录</div><div class="line">local_enable=YES</div><div class="line">write_enable=YES  #写权限</div><div class="line">anon_umask=022</div><div class="line">anon_world_readable_only=NO</div><div class="line">anon_upload_enable=YES #上传权限</div><div class="line">anon_mkdir_write_enable=YES  #创建文件夹权限</div><div class="line">anon_other_write_enable=YES  #其他权限</div><div class="line">##############</div><div class="line">vim /etc/vsftpd/user_config/slftp2</div><div class="line">guest_username=slvftp</div><div class="line">local_root=/data/ftproot/slftp2</div><div class="line">local_enable=YES</div><div class="line">write_enable=YES</div><div class="line">anon_umask=022</div><div class="line">anon_world_readable_only=NO</div><div class="line">anon_upload_enable=YES</div><div class="line">anon_mkdir_write_enable=YES</div><div class="line">anon_other_write_enable=YES</div></pre></td></tr></table></figure><h1 id="创建ftp根目录"><a href="#创建ftp根目录" class="headerlink" title="创建ftp根目录"></a>创建ftp根目录</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mkdir -pv /data/ftproot/slftp&#123;1,2&#125;</div><div class="line">chmod 700 -R /data/ftproot</div><div class="line">chown slvftp.slvftp -R /data/ftproot</div></pre></td></tr></table></figure><h1 id="重启vsftp服务"><a href="#重启vsftp服务" class="headerlink" title="重启vsftp服务"></a>重启vsftp服务</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/etc/init.d/vsftpd restart</div></pre></td></tr></table></figure><h1 id="防火墙开放端口"><a href="#防火墙开放端口" class="headerlink" title="防火墙开放端口"></a>防火墙开放端口</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">iptables -A INPUT -m state --state NEW -m tcp -p tcp --dport 21 -j ACCEPT</div><div class="line">iptables -A INPUT -m state --state NEW -m tcp -p tcp --dport 20 -j ACCEPT</div></pre></td></tr></table></figure><h1 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">yum -y install lftp</div><div class="line">lftp user:passwd@127.0.0.1</div></pre></td></tr></table></figure><p><img src="/images/2017/1206/01.png" alt="ftp"><br>参考文档：<a href="https://dumplings.cc/bu-shu-vsftpyu-pei-zhi-xu-ni-yong-hu-deng-lu/" target="_blank" rel="external">https://dumplings.cc/bu-shu-vsftpyu-pei-zhi-xu-ni-yong-hu-deng-lu/</a></p>]]></content>
      
      <categories>
          
          <category> 服务器搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ftp </tag>
            
            <tag> vsftp </tag>
            
            <tag> 服务器 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Oracle RAC环境搭建(Oracle Linux 6.9+Oracle 11g R2+FreeNas)</title>
      <link href="/arlo/e07eb088/"/>
      <content type="html"><![CDATA[<p>捣腾Oracle RAC环境已经半月有余，从对RAC一无所知到环境搭建成功，期间遇到很多坑，填了很多坑；特写此篇，记录一下搭建的过程，以备忘！话不多说，开干！<br><img src="/images/2017/1123/00.png" alt="rac"><br>网络环境：<br>网络分为三个部分，Public网络用于访问业务应用，Priv网络用于检测心跳，Storge网络用于连接存储；VIP，rac-scan网络应与Public网络在同一网段<br><a id="more"></a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">主机名Public网络Priv网络Storge网络VIP</div><div class="line">rac1192.168.100.11172.16.10.11172.16.20.1192.168.100.21</div><div class="line">rac2192.168.100.12172.16.10.12172.16.20.12192.168.100.22</div><div class="line">rac-scan192.168.100.23</div><div class="line">freenas172.16.20.13</div></pre></td></tr></table></figure></p><p>软件环境：<br><a href="https://mirrors.dotsrc.org/oracle-linux/OL6/U9/x86_64/" target="_blank" rel="external">Oracle Linux6.9</a><br><a href="http://www.oracle.com/technetwork/database/enterprise-edition/downloads/112010-linx8664soft-100572.html" target="_blank" rel="external">Grid</a><br><a href="http://www.oracle.com/technetwork/database/enterprise-edition/downloads/112010-linx8664soft-100572.html" target="_blank" rel="external">Oracle Database 11g</a><br><a href="http://www.oracle.com/technetwork/server-storage/linux/asmlib/ol6-1709075.html" target="_blank" rel="external">ASMlib</a><br><a href="http://www.freenas.com.cn" target="_blank" rel="external">FreeNas</a></p><p>RAC搭建分为五个部分：</p><ul><li>基础环境准备</li><li>共享存储搭建</li><li>网络搭建</li><li>Grid 安装</li><li>Database 安装</li></ul><h1 id="基础环境准备"><a href="#基础环境准备" class="headerlink" title="基础环境准备"></a>基础环境准备</h1><p>基础环境如无特别指明，都是需要在两台机器上操作的。</p><h2 id="虚拟机环境搭建"><a href="#虚拟机环境搭建" class="headerlink" title="虚拟机环境搭建"></a>虚拟机环境搭建</h2><h3 id="虚拟机资源配置"><a href="#虚拟机资源配置" class="headerlink" title="虚拟机资源配置"></a>虚拟机资源配置</h3><p>rac1:4核/8G/200G<br>rac2:4核/8G/200G<br>freenas:2核/2G/100G+(200G+200G+20G+20G)</p><h3 id="网络环境配置"><a href="#网络环境配置" class="headerlink" title="网络环境配置"></a>网络环境配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">虚拟机名称网卡1网卡2网卡3</div><div class="line">rac1VMnet1(NAT模式)VMnet2(仅主机模式)VMnet3(仅主机模式)</div><div class="line">rac2VMnet1(NAT模式)VMnet2(仅主机模式)VMnet3(仅主机模式)</div><div class="line">freenasVMnet1(NAT模式)</div><div class="line">VMnet1:192.168.100.0/24</div><div class="line">VMnet2:172.16.10.0/24</div><div class="line">VMnet3:172.16.20.0/24</div></pre></td></tr></table></figure><h3 id="操作系统安装"><a href="#操作系统安装" class="headerlink" title="操作系统安装"></a>操作系统安装</h3><p>安装图形界面环境<br>(过程略……)</p><h2 id="操作系统配置"><a href="#操作系统配置" class="headerlink" title="操作系统配置"></a>操作系统配置</h2><h3 id="修改主机名"><a href="#修改主机名" class="headerlink" title="修改主机名"></a>修改主机名</h3><p>rac1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">vim /etc/sysconfig/network</div><div class="line">HOSTNAME=rac1</div></pre></td></tr></table></figure></p><p>rac2<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">vim /etc/sysconfig/network</div><div class="line">HOSTNAME=rac2</div></pre></td></tr></table></figure></p><h3 id="配置hosts"><a href="#配置hosts" class="headerlink" title="配置hosts"></a>配置hosts</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</div><div class="line">########public#######</div><div class="line">192.168.100.11rac1</div><div class="line">192.168.100.12  rac2</div><div class="line"></div><div class="line">#######priv#########</div><div class="line">172.16.10.11rac1-priv</div><div class="line">172.16.10.12rac2-priv</div><div class="line"></div><div class="line">######vip###########</div><div class="line">192.168.100.21rac1-vip</div><div class="line">192.168.100.22rac2-vip</div><div class="line">192.168.100.23rac-scan</div><div class="line"></div><div class="line">172.16.20.13freenas</div></pre></td></tr></table></figure><h3 id="配置时间同步"><a href="#配置时间同步" class="headerlink" title="配置时间同步"></a>配置时间同步</h3><p>关闭ntpd服务，使用oracle自身的集群时间同步<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</div><div class="line">ntpdate cn.ntp.org.cn</div><div class="line">vim /etc/sysconfig/ntpd</div><div class="line">SYNC_HWCLOCK=yes</div><div class="line">OPTIONS=&quot;-x -u ntp:ntp -p /var/run/ntpd.pid&quot;</div><div class="line">/etc/init.d/ntpd stop</div><div class="line">chkconfig ntpd off</div><div class="line">mv /etc/ntp.conf /etc/ntp.conf.bak</div></pre></td></tr></table></figure></p><h3 id="基础软件安装"><a href="#基础软件安装" class="headerlink" title="基础软件安装"></a>基础软件安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">#默认是不安装32位软件包的，添加此选项</div><div class="line">echo &apos;multilib_policy=all&apos; &gt;&gt; /etc/yum.conf</div><div class="line">yum -y install  binutils-* compat-libstdc++-* elfutils-libelf-*  elfutils-libelf-devel-* gcc-* gcc-c++-* glibc-* glibc-common-* glibc-devel-*  glibc-headers-* libaio-*  libaio-devel-* libgcc-*  libstdc++* libstdc++-devel* make-*  sysstat-* unixODBC-* unixODBC-devel-* ksh-* mksh pdksh</div><div class="line">#监测一下软件是否安装全</div><div class="line">rpm -q \</div><div class="line">binutils \</div><div class="line">compat-libstdc++-33 \</div><div class="line">elfutils-libelf \</div><div class="line">elfutils-libelf-devel \</div><div class="line">expat \</div><div class="line">gcc \</div><div class="line">gcc-c++ \</div><div class="line">glibc \</div><div class="line">glibc-common \</div><div class="line">glibc-devel \</div><div class="line">glibc-headers \</div><div class="line">libaio \</div><div class="line">libaio-devel \</div><div class="line">libgcc \</div><div class="line">libstdc++ \</div><div class="line">libstdc++-devel \</div><div class="line">make \</div><div class="line">pdksh \</div><div class="line">sysstat \</div><div class="line">unixODBC \</div><div class="line">unixODBC-devel | grep &quot;not installed&quot;</div></pre></td></tr></table></figure><h3 id="修改PAM配置文件"><a href="#修改PAM配置文件" class="headerlink" title="修改PAM配置文件"></a>修改PAM配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">vi /etc/pam.d/login</div><div class="line">session    required     /lib64/security/pam_limits.so</div></pre></td></tr></table></figure><h3 id="设置内核参数"><a href="#设置内核参数" class="headerlink" title="设置内核参数"></a>设置内核参数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">vi /etc/sysctl.conf</div><div class="line"></div><div class="line">fs.aio-max-nr = 1048576 </div><div class="line">fs.file-max = 6815744 </div><div class="line">kernel.shmmni = 4096 </div><div class="line">kernel.sem = 250 32000 100 128 </div><div class="line">net.ipv4.ip_local_port_range = 9000 65500 </div><div class="line">net.core.rmem_default = 262144 </div><div class="line">net.core.rmem_max = 4194304 </div><div class="line">net.core.wmem_default = 262144 </div><div class="line">net.core.wmem_max = 1048586</div><div class="line"></div><div class="line">重新加载生效</div><div class="line">sysctl –p</div></pre></td></tr></table></figure><h3 id="创建用户grid"><a href="#创建用户grid" class="headerlink" title="创建用户grid"></a>创建用户grid</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">groupadd -g 1000 oinstall </div><div class="line">groupadd -g 1001 asmadmin </div><div class="line">groupadd -g 1002 asmdba </div><div class="line">groupadd -g 1003 asmoper</div><div class="line">useradd -u 1100 -g oinstall -G asmadmin,asmdba,asmoper -d /home/grid -s /bin/bash grid</div><div class="line">#设置密码grid用户密码为oracle</div><div class="line">echo oracle|passwd --stdin grid</div></pre></td></tr></table></figure><h4 id="配置grid用户环境变量"><a href="#配置grid用户环境变量" class="headerlink" title="配置grid用户环境变量"></a>配置grid用户环境变量</h4><p><strong>RAC1：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">su - grid</div><div class="line">#vi .bash_profile</div><div class="line"></div><div class="line">#export PS1=&quot;`/bin/hostname -s`-&gt;&quot;</div><div class="line">export TMP=/tmp</div><div class="line">export TMPDIR=$TMP</div><div class="line">export ORACLE_SID=+ASM1</div><div class="line">export ORACLE_BASE=/u01/app/grid</div><div class="line">export ORACLE_HOME=/u01/app/11.2.0/grid</div><div class="line">export TNS_ADMIN=$ORACLE_HOME/network/admin</div><div class="line">export PATH=/usr/sbin:$PATH</div><div class="line">export PATH=$PATH:$ORACLE_HOME/bin</div><div class="line">export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib</div><div class="line">export LANG=en_US.UTF-8</div><div class="line">export NLS_LANG=AMERICAN_AMERICA.ZHS16GBK</div><div class="line"></div><div class="line">#使配置文件生效</div><div class="line">source .bash_profile</div></pre></td></tr></table></figure></p><p><strong>RAC2：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">su - grid</div><div class="line">#vi .bash_profile</div><div class="line"></div><div class="line">#export PS1=&quot;`/bin/hostname -s`-&gt;&quot;</div><div class="line">export TMP=/tmp</div><div class="line">export TMPDIR=$TMP</div><div class="line">export ORACLE_SID=+ASM2</div><div class="line">export ORACLE_BASE=/u01/app/grid</div><div class="line">export ORACLE_HOME=/u01/app/11.2.0/grid</div><div class="line">export TNS_ADMIN=$ORACLE_HOME/network/admin</div><div class="line">export PATH=/usr/sbin:$PATH</div><div class="line">export PATH=$PATH:$ORACLE_HOME/bin</div><div class="line">export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib</div><div class="line">export LANG=en_US.UTF-8</div><div class="line">export NLS_LANG=AMERICAN_AMERICA.ZHS16GBK</div><div class="line"></div><div class="line">#使配置文件生效</div><div class="line">source .bash_profile</div></pre></td></tr></table></figure></p><h3 id="创建用户oracle"><a href="#创建用户oracle" class="headerlink" title="创建用户oracle"></a>创建用户oracle</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">su - root</div><div class="line">groupadd -g 1200 dba</div><div class="line">groupadd -g 1201 oper</div><div class="line">useradd -u 1101 -g oinstall -G dba,oper,asmdba -d /home/oracle -s /bin/bash oracle</div><div class="line">#设置密码grid用户密码为oracle</div><div class="line">echo oracle|passwd --stdin oracle</div></pre></td></tr></table></figure><h4 id="配置oracle用户环境变量"><a href="#配置oracle用户环境变量" class="headerlink" title="配置oracle用户环境变量"></a>配置oracle用户环境变量</h4><p><strong>RAC1：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">su - oracle</div><div class="line">#vi .bash_profile</div><div class="line"></div><div class="line">#export PS1=&quot;`/bin/hostname -s`-&gt;&quot;</div><div class="line">export TMP=/tmp</div><div class="line">export TMPDIR=$TMP</div><div class="line">export ORACLE_HOSTNAME=rac1</div><div class="line">export ORACLE_SID=orcl1</div><div class="line">export ORACLE_UNQNAME=orcl</div><div class="line">export ORACLE_BASE=/u01/app/oracle</div><div class="line">export ORACLE_HOME=$ORACLE_BASE/11g</div><div class="line">export TNS_ADMIN=$ORACLE_HOME/network/admin</div><div class="line">export PATH=/usr/sbin:$PATH</div><div class="line">export PATH=$PATH:$ORACLE_HOME/bin</div><div class="line">export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib</div><div class="line">export LANG=en_US.UTF-8</div><div class="line">export NLS_LANG=AMERICAN_AMERICA.ZHS16GBK</div><div class="line"></div><div class="line">#使配置文件生效</div><div class="line">source .bash_profile</div></pre></td></tr></table></figure></p><p><strong>RAC2：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">su - oracle</div><div class="line">#vi .bash_profile</div><div class="line"></div><div class="line">#export PS1=&quot;`/bin/hostname -s`-&gt;&quot;</div><div class="line">export TMP=/tmp</div><div class="line">export TMPDIR=$TMP</div><div class="line">export ORACLE_HOSTNAME=rac2</div><div class="line">export ORACLE_SID=orcl2</div><div class="line">export ORACLE_UNQNAME=orcl</div><div class="line">export ORACLE_BASE=/u01/app/oracle</div><div class="line">export ORACLE_HOME=$ORACLE_BASE/11g</div><div class="line">export TNS_ADMIN=$ORACLE_HOME/network/admin</div><div class="line">export PATH=/usr/sbin:$PATH</div><div class="line">export PATH=$PATH:$ORACLE_HOME/bin</div><div class="line">export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib</div><div class="line">export LANG=en_US.UTF-8</div><div class="line">export NLS_LANG=AMERICAN_AMERICA.ZHS16GBK</div><div class="line"></div><div class="line">#使配置文件生效</div><div class="line">source .bash_profile</div></pre></td></tr></table></figure></p><h3 id="创建目录，修改权限"><a href="#创建目录，修改权限" class="headerlink" title="创建目录，修改权限"></a>创建目录，修改权限</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">su - root</div><div class="line">mkdir -p /u01/app/grid </div><div class="line">mkdir -p /u01/app/11.2.0/grid</div><div class="line">chown -R grid:oinstall /u01</div><div class="line">chown -R grid:oinstall /u01/app/11.2.0/grid</div><div class="line">mkdir -p /u01/app/oracle</div><div class="line">chown -R oracle:oinstall /u01/app/oracle</div><div class="line">chmod -R 775 /u01</div><div class="line">export LANG=en_US.UTF-8</div><div class="line">export NLS_LANG=AMERICAN_AMERICA.ZHS16GBK</div></pre></td></tr></table></figure><h3 id="配置profile"><a href="#配置profile" class="headerlink" title="配置profile"></a>配置profile</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">vim /etc/profile</div><div class="line">if [ \$USER = &quot;oracle&quot; ] || [ \$USER = &quot;grid&quot; ];then </div><div class="line">    if [ \$SHELL = &quot;/bin/ksh&quot; ];then </div><div class="line">               ulimit -p 16384 </div><div class="line">               ulimit -n 65536 </div><div class="line">    else </div><div class="line">               ulimit -u 16384 -n 65536 </div><div class="line">    fi </div><div class="line">    umask 022 </div><div class="line">fi</div></pre></td></tr></table></figure><h3 id="修改Oracle用户限制"><a href="#修改Oracle用户限制" class="headerlink" title="修改Oracle用户限制"></a>修改Oracle用户限制</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">vi /etc/security/limits.conf</div><div class="line">oracle soft nproc 2047</div><div class="line">oracle hard nproc 16384</div><div class="line">oracle soft nofile 1024</div><div class="line">oracle hard nofile 65536</div><div class="line">oracle soft stack 10240</div><div class="line">oracle hard stack 32768</div><div class="line"></div><div class="line">grid soft nproc 2047</div><div class="line">grid hard nproc 16384</div><div class="line">grid soft nofile 1024</div><div class="line">grid hard nofile 65536</div><div class="line">grid soft stack 10240</div><div class="line">grid hard stack 32768</div></pre></td></tr></table></figure><h3 id="ssh-互信"><a href="#ssh-互信" class="headerlink" title="ssh 互信"></a>ssh 互信</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">su - grid</div><div class="line">ssh-keygen (一路回车)</div><div class="line">ssh-copy-id -i rac2</div><div class="line">ssh-copy-id -i rac1</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">su - oracle</div><div class="line">ssh-keygen (一路回车)</div><div class="line">ssh-copy-id -i rac2</div><div class="line">ssh-copy-id -i rac1</div></pre></td></tr></table></figure><p>测试一下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ssh rac1 date</div><div class="line">Thu Nov 23 14:00:03 CST 2017</div><div class="line">ssh rac2 date</div><div class="line">Thu Nov 23 14:00:24 CST 2017</div></pre></td></tr></table></figure></p><h1 id="使用FreeNas搭建iscsi存储"><a href="#使用FreeNas搭建iscsi存储" class="headerlink" title="使用FreeNas搭建iscsi存储"></a>使用FreeNas搭建iscsi存储</h1><h2 id="安装操作系统"><a href="#安装操作系统" class="headerlink" title="安装操作系统"></a>安装操作系统</h2><p>使用FreeNAS-9.2.1.7-RELEASE-x64.iso镜像搭建NAS存储，一块系统磁盘，四块存储盘<br><img src="/images/2017/1123/01.png" alt="rac"><br>选择1 Install/Upgrade 安装FreeNAS<br><img src="/images/2017/1123/02.png" alt="rac"><br>选择第一块系统磁盘<br><img src="/images/2017/1123/03.png" alt="rac"><br>全新安装(虚拟机环境之前安装过，新环境应该没有这一步)<br><img src="/images/2017/1123/04.png" alt="rac"><br>安装警告，例行问候，选择Yes<br><img src="/images/2017/1123/05.png" alt="rac"><br>安装完成<br><img src="/images/2017/1123/06.png" alt="rac"><br>重启系统<br><img src="/images/2017/1123/07.png" alt="rac"></p><h2 id="配置网络"><a href="#配置网络" class="headerlink" title="配置网络"></a>配置网络</h2><p>提示是否删除现有的配置，输入n<br><img src="/images/2017/1123/08.png" alt="rac"><br>是否配置DHCP，输入n；是否配置IPv4,输入y；输入ip地址、子网掩码；是否配置IPv6,输入n<br><img src="/images/2017/1123/09.png" alt="rac"><br>配置完成后，即可通过url来管理freenas，访问地址为<a href="http://172.16.20.13" target="_blank" rel="external">http://172.16.20.13</a><br><img src="/images/2017/1123/10.png" alt="rac"><br>新版本第一次登录会让修改密码<br>ps:如果密码忘记，可以在刚才的步骤里选择7）Reset WebGUI login credentials，在此步骤可以输入新密码<br><img src="/images/2017/1123/11.png" alt="rac"></p><h2 id="配置iscsi"><a href="#配置iscsi" class="headerlink" title="配置iscsi"></a>配置iscsi</h2><p>设置中文语言，上海时区<br><img src="/images/2017/1123/12.png" alt="rac"><br>开启iSCSI服务<br><img src="/images/2017/1123/13.png" alt="rac"><br>配置全局目标，设置iSCSI名称iqn.2017-11.cc.islocal.istgt<br><img src="/images/2017/1123/14.png" alt="rac"><br>配置Portals<br><img src="/images/2017/1123/15.png" alt="rac"><br>配置初始的授权<br><img src="/images/2017/1123/16.png" alt="rac"><br>配置授权用户grid<br><img src="/images/2017/1123/17.png" alt="rac"><br>添加iscsi目标设备<br><img src="/images/2017/1123/18.png" alt="rac"><br>依次添加4块存储磁盘<br><img src="/images/2017/1123/19.png" alt="rac"><br><img src="/images/2017/1123/20.png" alt="rac"><br>关联添加的存储设备为LUN<br><img src="/images/2017/1123/21.png" alt="rac"><br><img src="/images/2017/1123/22.png" alt="rac"></p><h1 id="安装Grid-Infrastructure"><a href="#安装Grid-Infrastructure" class="headerlink" title="安装Grid Infrastructure"></a>安装Grid Infrastructure</h1><blockquote><p>如果使用Centos6.x操作系统安装rac，建议使用UEK内核;uek内核是Oracle Linux、Oracle Database、中间件和硬件工程师团队合作的结果，是一个快速、现代、可靠的内核，专门针对Oracle软件和硬件进行了优化。随着硬件的快速发展，为了更好的兼容并支持快速发展的硬件，Linux系统版本及内核也在不断的更新，uek正是在这样的环境下应运而生的产物。<br>安装uek内核可以参考以下文档<br><a href="https://docs.oracle.com/cd/E37670_01/E37355/html/ol_obtain_uek.html" target="_blank" rel="external">https://docs.oracle.com/cd/E37670_01/E37355/html/ol_obtain_uek.html</a><br><a href="https://docs.oracle.com/cd/E52668_01/E39381/html/ol_import_gpg.html" target="_blank" rel="external">https://docs.oracle.com/cd/E52668_01/E39381/html/ol_import_gpg.html</a><br><a href="http://www.oracle.com/technetwork/server-storage/linux/asmlib/index-101839.html" target="_blank" rel="external">http://www.oracle.com/technetwork/server-storage/linux/asmlib/index-101839.html</a></p></blockquote><h2 id="ASM-分区创建"><a href="#ASM-分区创建" class="headerlink" title="ASM 分区创建"></a>ASM 分区创建</h2><h3 id="方法一：使用ASMlib创建ASM分区"><a href="#方法一：使用ASMlib创建ASM分区" class="headerlink" title="方法一：使用ASMlib创建ASM分区"></a>方法一：使用ASMlib创建ASM分区</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">yum -y install oracleasm-support oracle-rdbms-server-11gR2-preinstall</div><div class="line">rpm -ivh http://download.oracle.com/otn_software/asmlib/oracleasmlib-2.0.12-1.el6.x86_64.rpm</div></pre></td></tr></table></figure><p>上传linux.x64_11gR2_grid.zip到/usr/local/src目录下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cd /usr/local/src/</div><div class="line">unzip linux.x64_11gR2_grid.zip</div><div class="line">/usr/local/src/grid/rpm</div><div class="line">rpm -ivh cvuqdisk-1.0.7-1.rpm</div></pre></td></tr></table></figure></p><h4 id="初始化asm"><a href="#初始化asm" class="headerlink" title="初始化asm"></a>初始化asm</h4><p><strong>RAC1</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@rac1 rpm]# /etc/init.d/oracleasm configure -i</div><div class="line">Configuring the Oracle ASM library driver.</div><div class="line"></div><div class="line">This will configure the on-boot properties of the Oracle ASM library</div><div class="line">driver.  The following questions will determine whether the driver is</div><div class="line">loaded on boot and what permissions it will have.  The current values</div><div class="line">will be shown in brackets (&apos;[]&apos;).  Hitting &lt;ENTER&gt; without typing an</div><div class="line">answer will keep that current value.  Ctrl-C will abort.</div><div class="line"></div><div class="line">Default user to own the driver interface [grid]: grid</div><div class="line">Default group to own the driver interface [oinstall]: oinstall</div><div class="line">Start Oracle ASM library driver on boot (y/n) [y]: y</div><div class="line">Scan for Oracle ASM disks on boot (y/n) [y]: y</div><div class="line">Writing Oracle ASM library driver configuration: done</div><div class="line">Initializing the Oracle ASMLib driver:                     [  OK  ]</div><div class="line">Scanning the system for Oracle ASMLib disks:               [  OK  ]</div></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/sbin/oracleasm init</div></pre></td></tr></table></figure><p><strong>RAC2</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@rac2 src]# /etc/init.d/oracleasm configure -i</div><div class="line">Configuring the Oracle ASM library driver.</div><div class="line"></div><div class="line">This will configure the on-boot properties of the Oracle ASM library</div><div class="line">driver.  The following questions will determine whether the driver is</div><div class="line">loaded on boot and what permissions it will have.  The current values</div><div class="line">will be shown in brackets (&apos;[]&apos;).  Hitting &lt;ENTER&gt; without typing an</div><div class="line">answer will keep that current value.  Ctrl-C will abort.</div><div class="line"></div><div class="line">Default user to own the driver interface [grid]: grid</div><div class="line">Default group to own the driver interface [oinstall]: oinstall</div><div class="line">Start Oracle ASM library driver on boot (y/n) [y]: y</div><div class="line">Scan for Oracle ASM disks on boot (y/n) [y]: y</div><div class="line">Writing Oracle ASM library driver configuration: done</div><div class="line">Initializing the Oracle ASMLib driver:                     [  OK  ]</div><div class="line">Scanning the system for Oracle ASMLib disks:               [  OK  ]</div></pre></td></tr></table></figure></p><h4 id="配置iscsi客户端"><a href="#配置iscsi客户端" class="headerlink" title="配置iscsi客户端"></a>配置iscsi客户端</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install iscsi-initiator-utils</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@rac1 rpm]# iscsiadm -m discovery -t sendtargets -p 172.16.20.13</div><div class="line">172.16.20.13:3260,1 iqn.2017-11.cc.islocal.istgt:iscsi</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@rac1 rpm]# /etc/init.d/iscsi restart</div><div class="line">Stopping iscsi:                                            [  OK  ]</div><div class="line">Starting iscsi:                                            [  OK  ]</div></pre></td></tr></table></figure><blockquote><p>iscsi命令拓展<br>查看iscsi target信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">iscsiadm -m node -p ip_addr</div><div class="line">iscsiadm -m node session -p ip_addr</div><div class="line">iscsiadm -m node discovery -P ip_addr</div></pre></td></tr></table></figure></p><p>登录target连接<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iscsiadm -m node -T iqn.2017-11.cc.islocal.istgt:iscsi -p ip_addr -l</div></pre></td></tr></table></figure></p><p>登出target连接<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iscsiadm -m node -T iqn.2017-11.cc.islocal.istgt:iscsi -p ip_addr -u</div></pre></td></tr></table></figure></p><p>删除target条目记录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iscsiadm -m node -o delete -T iqn.2017-11.cc.islocal.istgt:iscsi -p ip_addr</div></pre></td></tr></table></figure></p></blockquote><h4 id="磁盘分区"><a href="#磁盘分区" class="headerlink" title="磁盘分区"></a>磁盘分区</h4><p>fdisk -l  可以发现已经识别到4个磁盘sdb,sdc,sdd,sde,对磁盘进行分区<br><strong>“n/p/1/回车/回车/w”</strong><br><img src="/images/2017/1123/23.png" alt="rac"><br><img src="/images/2017/1123/24.png" alt="rac"></p><h4 id="创建ASM分区"><a href="#创建ASM分区" class="headerlink" title="创建ASM分区"></a>创建ASM分区</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">/etc/init.d/oracleasm createdisk ASMDATA /dev/sdb1</div><div class="line">/etc/init.d/oracleasm createdisk BACKUP /dev/sdc1</div><div class="line">/etc/init.d/oracleasm createdisk OCR /dev/sdd1</div><div class="line">/etc/init.d/oracleasm createdisk VOTINGDISK /dev/sde1</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@rac1 rpm]# /etc/init.d/oracleasm scandisks</div><div class="line">Scanning the system for Oracle ASMLib disks:               [  OK  ]</div><div class="line">[root@rac1 rpm]# /etc/init.d/oracleasm listdisks</div><div class="line">ASMDATA</div><div class="line">BACKUP</div><div class="line">OCR</div><div class="line">VOTINGDISK</div></pre></td></tr></table></figure><h4 id="在rac2上发现asm磁盘"><a href="#在rac2上发现asm磁盘" class="headerlink" title="在rac2上发现asm磁盘"></a>在rac2上发现asm磁盘</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install iscsi-initiator-utils</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@rac2 rpm]# iscsiadm -m discovery -t sendtargets -p 172.16.20.13</div><div class="line">172.16.20.13:3260,1 iqn.2017-11.cc.islocal.istgt:iscsi</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@rac2 rpm]# /etc/init.d/iscsi restart</div><div class="line">Stopping iscsi:                                            [  OK  ]</div><div class="line">Starting iscsi:                                            [  OK  ]</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@rac2 ~]# start_udev </div><div class="line">Starting udev:                                             [  OK  ]</div><div class="line">[root@rac2 src]# /etc/init.d/oracleasm scandisks</div><div class="line">Scanning the system for Oracle ASMLib disks:               [  OK  ]</div><div class="line">[root@rac2 src]# /etc/init.d/oracleasm listdisks</div><div class="line">ASMDATA</div><div class="line">BACKUP</div><div class="line">OCR</div><div class="line">VOTINGDISK</div></pre></td></tr></table></figure><h3 id="方法二：使用udev方式创建ASM分区"><a href="#方法二：使用udev方式创建ASM分区" class="headerlink" title="方法二：使用udev方式创建ASM分区"></a>方法二：使用udev方式创建ASM分区</h3><h4 id="配置iscsi客户端-1"><a href="#配置iscsi客户端-1" class="headerlink" title="配置iscsi客户端"></a>配置iscsi客户端</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install iscsi-initiator-utils</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@rac1 rpm]# iscsiadm -m discovery -t sendtargets -p 172.16.20.13</div><div class="line">172.16.20.13:3260,1 iqn.2017-11.cc.islocal.istgt:iscsi</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@rac1 rpm]# /etc/init.d/iscsi restart</div><div class="line">Stopping iscsi:                                            [  OK  ]</div><div class="line">Starting iscsi:                                            [  OK  ]</div></pre></td></tr></table></figure><p>将ASM磁盘添加到udev，防止开始发现磁盘顺序不一致导致的异常问题<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@rac1 ~]# /sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/sdb1</div><div class="line">3300000007a38757b</div><div class="line">[root@rac1 ~]# /sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/sdc1</div><div class="line">3300000008853f678</div><div class="line">[root@rac1 ~]# /sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/sdd1</div><div class="line">3300000009b03058c</div><div class="line">[root@rac1 ~]# /sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/sde1</div><div class="line">3300000006968868f</div></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@rac1 rules.d]# vim 99-iscsi-asm.rules</div><div class="line">KERNEL==&quot;sd*&quot;, BUS==&quot;scsi&quot;, PROGRAM==&quot;/sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/$name&quot;, RESULT==&quot;3300000007a38757b&quot;, NAME=&quot;asm-data&quot;, OWNER=&quot;grid&quot;, GROUP=&quot;oinstall&quot;, MODE=&quot;660&quot;</div><div class="line">KERNEL==&quot;sd*&quot;, BUS==&quot;scsi&quot;, PROGRAM==&quot;/sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/$name&quot;, RESULT==&quot;3300000008853f678&quot;, NAME=&quot;asm-backup&quot;, OWNER=&quot;grid&quot;, GROUP=&quot;oinstall&quot;, MODE=&quot;660&quot;</div><div class="line">KERNEL==&quot;sd*&quot;, BUS==&quot;scsi&quot;, PROGRAM==&quot;/sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/$name&quot;, RESULT==&quot;3300000009b03058c&quot;, NAME=&quot;asm-ocr&quot;, OWNER=&quot;grid&quot;, GROUP=&quot;oinstall&quot;, MODE=&quot;660&quot;</div><div class="line">KERNEL==&quot;sd*&quot;, BUS==&quot;scsi&quot;, PROGRAM==&quot;/sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/$name&quot;, RESULT==&quot;3300000006968868f&quot;, NAME=&quot;asm-vdisk&quot;, OWNER=&quot;grid&quot;, GROUP=&quot;oinstall&quot;, MODE=&quot;660&quot;</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@rac1 rules.d]# scp 99-iscsi-asm.rules rac2:/etc/udev/rules.d/99-iscsi-asm.rules</div><div class="line">[root@rac1 rules.d]# start_udev </div><div class="line">Starting udev:                                             [  OK  ]</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@rac1 rules.d]# ll /dev/asm-*</div><div class="line">brw-rw---- 1 grid asmadmin 8, 33 Nov 23 17:48 /dev/asm-backup</div><div class="line">brw-rw---- 1 grid asmadmin 8, 17 Nov 23 17:48 /dev/asm-data</div><div class="line">brw-rw---- 1 grid asmadmin 8, 49 Nov 23 17:48 /dev/asm-ocr</div><div class="line">brw-rw---- 1 grid asmadmin 8, 65 Nov 23 17:48 /dev/asm-vdisk</div></pre></td></tr></table></figure><p>在rac2上发现asm磁盘<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install iscsi-initiator-utils</div></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@rac2 rpm]# iscsiadm -m discovery -t sendtargets -p 172.16.20.13</div><div class="line">172.16.20.13:3260,1 iqn.2017-11.cc.islocal.istgt:iscsi</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@rac2 rpm]# /etc/init.d/iscsi restart</div><div class="line">Stopping iscsi:                                            [  OK  ]</div><div class="line">Starting iscsi:                                            [  OK  ]</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@rac2 ~]# start_udev </div><div class="line">Starting udev:                                             [  OK  ]</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@rac2 ~]# ll /dev/asm-*</div><div class="line">brw-rw---- 1 grid asmadmin 8, 33 Nov 23 17:54 /dev/asm-backup</div><div class="line">brw-rw---- 1 grid asmadmin 8, 17 Nov 23 17:54 /dev/asm-data</div><div class="line">brw-rw---- 1 grid asmadmin 8, 49 Nov 23 17:54 /dev/asm-ocr</div><div class="line">brw-rw---- 1 grid asmadmin 8, 65 Nov 23 17:54 /dev/asm-vdisk</div></pre></td></tr></table></figure><h2 id="安装Grid"><a href="#安装Grid" class="headerlink" title="安装Grid"></a>安装Grid</h2><p>建议直接用grid用户登录图形桌面，而不是root登录su - grid切换过去。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rac1-&gt;cd /usr/local/src/grid</div><div class="line">rac1-&gt;./runcluvfy.sh stage -pre crsinst -n rac1,rac2 -fixup -verbose</div></pre></td></tr></table></figure></p><p>安装前监测一下环境，如果有failed，按照要求去修复，我这里有几个软件包太新，不是太影响，我们就开始安装吧。<br>执行./runInstaller，开始安装<br><img src="/images/2017/1123/25.png" alt="rac"><br>安装和配置一个GI集群<br><img src="/images/2017/1123/26.png" alt="rac"><br>高级安装<br><img src="/images/2017/1123/27.png" alt="rac"><br>添加中文支持<br><img src="/images/2017/1123/28.png" alt="rac"><br>取消GNS选项，保持SCAN Name和hosts里配置的一样<br><img src="/images/2017/1123/29.png" alt="rac"><br>添加rac2<br><img src="/images/2017/1123/30.png" alt="rac"><br>根据之前配置的网络，配置网络类型<br><img src="/images/2017/1123/31.png" alt="rac"><br>选择ASM存储<br><img src="/images/2017/1123/32.png" alt="rac"><br><em>这里遇到几个几个坑，详细说一下吧；1.如果默认没有在候选磁盘(Candidate Disks)里,选择所有磁盘(All disks),看看是否可以显示出来；2.如果还是没有发现，点一下改变其他路径(Change Discovery Path),rhel系列系统默认路径是/dev/raw/\</em>, 我这里是/dev/asm-*;3.如果磁盘显示出来是灰色，不能选择，可能是练习的时候，之前已经使用过磁盘做过asm了，可以执行“dd if=/dev/zero of=/dev/rhdisk2 bs=1024 count=100”，然后重新开始安装试试，如果还不行，请从存储方面开始排查；4.我这里配置的udev方式发现保证磁盘的唯一性，现在发现一个问题，start_udev后可以发现磁盘，/dev/asm-*都生成了；执行oraclescandisk后发现不了ASM磁盘，/dev/oracleasm/disks/目录下是空的，但是安装时候找到了，是可用状态，有点小疑惑。*<br>ASM提供三种冗余模式，我们使用External；ASM三种模式后期学习了，在单独写一篇吧。<br><img src="/images/2017/1123/33.png" alt="rac"><br>选择Yes<br><img src="/images/2017/1123/34.png" alt="rac"><br>默认<br><img src="/images/2017/1123/35.png" alt="rac"><br>默认的三个组<br><img src="/images/2017/1123/36.png" alt="rac"><br>默认安装路径<br><img src="/images/2017/1123/37.png" alt="rac"><br><img src="/images/2017/1123/38.png" alt="rac"><br><img src="/images/2017/1123/39.png" alt="rac"><br>忽略ALL<br><img src="/images/2017/1123/40.png" alt="rac"><br>所有的配置信息<br><img src="/images/2017/1123/41.png" alt="rac"><br>安装完成，使用root账号依次在rac1，rac2上执行脚本;<br><img src="/images/2017/1123/42.png" alt="rac"><br>如果你执行root.sh出现以下错误，恭喜你！这个问题折磨了我太久，后来在网上看到这是一个bug！<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">CRS-4124: Oracle High Availability Services startup failed.</div><div class="line">CRS-4000: Command Start failed, or completed with errors.</div><div class="line">ohasd failed to start: Inappropriate ioctl for device</div><div class="line">ohasd failed to start at /opt/app/11.2.0/grid/crs/install/rootcrs.pl line 443.</div></pre></td></tr></table></figure></p><p>此错误<a href="http://blog.sina.com.cn/s/blog_563c17780102ux53.html" target="_blank" rel="external">解决方法</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">删除之前的配置：/u01/app/11.2.0/grid/crs/install/roothas.pl -deconfig -force -verbose</div><div class="line">窗口1：/u01/app/11.2.0/grid/root.sh</div><div class="line">窗口2：/bin/dd if=/var/tmp/.oracle/npohasd of=/dev/null bs=1024 count=1  （刚开始执行root.sh时候，还没生成npohash文件，等日志出现“Adding daemon to inittab”的时候，在窗口2中使用root用户执行此命令，等root.sh执行成功后，ctrl+c结束此命令即可）</div></pre></td></tr></table></figure></p><p><img src="/images/2017/1123/43.png" alt="rac"><br>出现以下提示，方为脚本执行成功。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Configure Oracle Grid Infrastructure for a Cluster ... succeeded</div><div class="line">Updating inventory properties for clusterware</div><div class="line">Starting Oracle Universal Installer...</div><div class="line"></div><div class="line">Checking swap space: must be greater than 500 MB.   Actual 7999 MB    Passed</div><div class="line">The inventory pointer is located at /etc/oraInst.loc</div><div class="line">The inventory is located at /u01/app/oraInventory</div></pre></td></tr></table></figure></p><p>这个错误没事，直接点击Next<br><img src="/images/2017/1123/44.png" alt="rac"><br>完成安装<br><img src="/images/2017/1123/45.png" alt="rac"></p><h2 id="验证安装状态"><a href="#验证安装状态" class="headerlink" title="验证安装状态"></a>验证安装状态</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">su - grid</div><div class="line">crs_stat -t</div><div class="line">crsctl check cluster -all</div><div class="line">olsnodes -s -n -t</div><div class="line">crsctl check crs</div><div class="line">srvctl status asm</div><div class="line">srvctl status scan</div><div class="line">srvctl status vip -n rac1</div><div class="line">srvctl status scan_listener</div></pre></td></tr></table></figure><p><img src="/images/2017/1123/46.png" alt="rac"><br><img src="/images/2017/1123/47.png" alt="rac"></p><h2 id="创建ASM磁盘组"><a href="#创建ASM磁盘组" class="headerlink" title="创建ASM磁盘组"></a>创建ASM磁盘组</h2><p>在grid 用户下，执行 asmca，启动 asm 磁盘组创建向导<br>DATA组，存放数据文件，包括/dev/asm-data,/dev/asm-backup;VOTINGDISK组，存放闪回文件，包含/dev/asm-vdisk<br>Disk Groups，点击create 按钮，在弹出的创建界面中填写磁盘组名称，选择external(none)，并勾选成员，选择完毕后点击 ok；<br><img src="/images/2017/1123/48.png" alt="rac"><br><img src="/images/2017/1123/49.png" alt="rac"><br><img src="/images/2017/1123/50.png" alt="rac"><br>确认stat为2 of 2时,退出asmca<br><img src="/images/2017/1123/51.png" alt="rac"></p><h1 id="安装oracle11gr2-database-软件"><a href="#安装oracle11gr2-database-软件" class="headerlink" title="安装oracle11gr2 database 软件"></a>安装oracle11gr2 database 软件</h1><p>建议直接用oracle用户登录图形桌面，而不是root登录su - oracle切换过去。这个安装过程也很简单，基本上和单机版的一样；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rac1-&gt;cd /usr/local/src/database</div><div class="line">rac1-&gt;./runInstaller</div></pre></td></tr></table></figure></p><p><img src="/images/2017/1123/52.png" alt="rac"><br>创建和配置一个数据库<br><img src="/images/2017/1123/53.png" alt="rac"><br>服务器模式<br><img src="/images/2017/1123/54.png" alt="rac"><br>选择rac集群中的节点<br><img src="/images/2017/1123/55.png" alt="rac"><br>高级安装<br><img src="/images/2017/1123/56.png" alt="rac"><br>添加中文支持<br><img src="/images/2017/1123/57.png" alt="rac"><br>服务器版本<br><img src="/images/2017/1123/58.png" alt="rac"><br>默认安装路径<br><img src="/images/2017/1123/59.png" alt="rac"><br>一般用途<br><img src="/images/2017/1123/60.png" alt="rac"><br>实例名称，SID名称<br><img src="/images/2017/1123/61.png" alt="rac"><br><code>(ps:这里的截图稍微有点问题，sid应该是orcl，不是orcl1)</code><br>自动分配内存<br><img src="/images/2017/1123/62.png" alt="rac"><br>选择中文字符集<br><img src="/images/2017/1123/63.png" alt="rac"><br><img src="/images/2017/1123/64.png" alt="rac"><br>连接asm存储的密码<br><img src="/images/2017/1123/65.png" alt="rac"><br>不备份<br><img src="/images/2017/1123/66.png" alt="rac"><br>选择DATA磁盘组<br><img src="/images/2017/1123/67.png" alt="rac"><br>设置sys/system密码<br><img src="/images/2017/1123/68.png" alt="rac"><br>默认管理组<br><img src="/images/2017/1123/69.png" alt="rac"><br>监测依赖<br><img src="/images/2017/1123/70.png" alt="rac"><br>配置信息<br><img src="/images/2017/1123/71.png" alt="rac"><br><img src="/images/2017/1123/72.png" alt="rac"><br>安装完成<br><img src="/images/2017/1123/73.png" alt="rac"><br><img src="/images/2017/1123/74.png" alt="rac"><br>依次执行脚本<br><img src="/images/2017/1123/75.png" alt="rac"><br><img src="/images/2017/1123/76.png" alt="rac"><br><img src="/images/2017/1123/77.png" alt="rac"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Entries will be added to the /etc/oratab file as needed by</div><div class="line">Database Configuration Assistant when a database is created</div><div class="line">Finished running generic part of root.sh script.</div><div class="line">Now product-specific root actions will be performed.</div><div class="line">Finished product-specific root actions.</div></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sqlplus system/oracle@orcl</div><div class="line">select inst_id,instance_number,instance_name from gv$instance;</div></pre></td></tr></table></figure><p><img src="/images/2017/1123/78.png" alt="rac"></p><p>参考资料：<br><a href="http://v.qq.com/vplus/91c845f5c21fd8a6a25e9827b38c171e" target="_blank" rel="external">http://v.qq.com/vplus/91c845f5c21fd8a6a25e9827b38c171e</a><br><a href="http://www.dba-oracle.com/t_reset_an_asm_diskgroup.htm" target="_blank" rel="external">http://www.dba-oracle.com/t_reset_an_asm_diskgroup.htm</a><br><a href="http://www.oracle.com/technetwork/cn/articles/hunter-rac11gr2-iscsi-083834-zhs.html" target="_blank" rel="external">http://www.oracle.com/technetwork/cn/articles/hunter-rac11gr2-iscsi-083834-zhs.html</a><br><a href="http://blog.csdn.net/u010098331/article/details/50767353" target="_blank" rel="external">http://blog.csdn.net/u010098331/article/details/50767353</a><br><a href="https://docs.oracle.com/cd/E11882_01/doc.112/e28441/require.htm#CDMIG110" target="_blank" rel="external">https://docs.oracle.com/cd/E11882_01/doc.112/e28441/require.htm#CDMIG110</a><br><a href="http://blog.sina.com.cn/s/blog_563c17780102ux53.html" target="_blank" rel="external">http://blog.sina.com.cn/s/blog_563c17780102ux53.html</a><br><a href="https://blogs.oracle.com/database4cn/11gr2-crsgrid-scansingle-client-access-name" target="_blank" rel="external">https://blogs.oracle.com/database4cn/11gr2-crsgrid-scansingle-client-access-name</a></p><hr>]]></content>
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 集群 </tag>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
            <tag> RAC </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Windows组策略几个问题小计</title>
      <link href="/arlo/9bdfcc8c/"/>
      <content type="html"><![CDATA[<h1 id="注册表编辑被管理员禁用"><a href="#注册表编辑被管理员禁用" class="headerlink" title="注册表编辑被管理员禁用"></a>注册表编辑被管理员禁用</h1><p><img src="/images/2017/1031/01.png" alt="windows"><br>第一步：打开组策略窗口，开始-运行-gptdit.msc<br>第二步：选择用户配置-管理模板-系统，双击系统选项找到【阻止访问注册表编辑工具】<br>第三步：双击【阻止访问注册表编辑工具】选择已禁用，点击确定。<br>第四步：在开始-运行输入regedit，打开注册表。 说明注册表已经可以访问了。<br><a id="more"></a></p><h1 id="服务灰色，无法正常使用"><a href="#服务灰色，无法正常使用" class="headerlink" title="服务灰色，无法正常使用"></a>服务灰色，无法正常使用</h1><p>MMC 在该文档中引用的管理单元受到策略限制<br><img src="/images/2017/1031/02.png" alt="windows"><br><img src="/images/2017/1031/03.png" alt="windows"><br>第一步：开始-运行-regedit，启动注册表编辑器<br>第二步：HKEY_CURRENT_USER\Software\Policies\Microsoft\MMC{58221C66-EA27-11CF-ADCF-00AA00A80033}\Restrict_Run，将值设为0<br><img src="/images/2017/1031/04.png" alt="windows"></p><h1 id="任务管理器无法正常使用"><a href="#任务管理器无法正常使用" class="headerlink" title="任务管理器无法正常使用"></a>任务管理器无法正常使用</h1><p><img src="/images/2017/1031/05.png" alt="windows"><br>第一步：打开组策略窗口，开始-运行-gptdit.msc<br>第二步：选择用户配置-管理模板-系统-Ctrl+Alt+Del选项<br>第三步：在该列表中打开 删除“任务管理器” 的属性，在 删除“任务管理器” 属性中的“设置”选项卡中点选“已禁用”，确定。<br><img src="/images/2017/1031/06.png" alt="windows"></p><h1 id="要远程登录，你需要具有通过远程桌面服务进行的登录权限"><a href="#要远程登录，你需要具有通过远程桌面服务进行的登录权限" class="headerlink" title="要远程登录，你需要具有通过远程桌面服务进行的登录权限"></a>要远程登录，你需要具有通过远程桌面服务进行的登录权限</h1><p><img src="/images/2017/1031/07.png" alt="windows"><br>要远程登录，你需要具有通过远程桌面服务进行的登录权限。默认情况下，远程桌面用户组的成员有这项权限。如果你所属的组没有这项权限，或者远程桌面用户组已经删除了这项权限，那么需要手动为你授予这一权限<br>第一步：gpedit进入策略组:计算机配置-&gt;Windows设置-&gt;安全设置-&gt;本地策略-&gt;用户权限分配<br>第二步：找到拒绝通过远程桌面服务登录,把里面的账号去了即可</p><h1 id="修改远程登录3389端口"><a href="#修改远程登录3389端口" class="headerlink" title="修改远程登录3389端口"></a>修改远程登录3389端口</h1><p>第一步: 打开“开始→运行”，输入“regedit”，打开注册表，<br>第二步: 进入[HKEY_LOCAL_MACHINE/SYSTEM/CurrentControlSet/Control/Terminal Server/Wds/rdpwd/Tds/tcp]，将PortNamber值(默认值是3389)，修改为新的端口，例如12389，注意使用十进制。<br>第三部：进入[HKEY_LOCAL_MACHINE/SYSTEM/CurrentControlSet/Control/Terminal Server/WinStations/RDP-Tcp]，将PortNumber值(默认是3389)修改为新的端口，如12389，注意使用十进制。</p><h1 id="Win10家庭版找不到gpedit-msc组策略"><a href="#Win10家庭版找不到gpedit-msc组策略" class="headerlink" title="Win10家庭版找不到gpedit.msc组策略"></a>Win10家庭版找不到gpedit.msc组策略</h1><p>复制一下内容，新建一个.bat文件，然后使用管理员身份运行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">@echo off</div><div class="line"></div><div class="line">pushd &quot;%~dp0&quot;</div><div class="line"></div><div class="line">dir /b C:\Windows\servicing\Packages\Microsoft-Windows-GroupPolicy-ClientExtensions-Package~3*.mum &gt;List.txt</div><div class="line"></div><div class="line">dir /b C:\Windows\servicing\Packages\Microsoft-Windows-GroupPolicy-ClientTools-Package~3*.mum &gt;&gt;List.txt</div><div class="line"></div><div class="line">for /f %%i in (&apos;findstr /i . List.txt 2^&gt;nul&apos;) do dism /online /norestart /add-package:&quot;C:\Windows\servicing\Packages\%%i&quot;</div><div class="line"></div><div class="line">pause</div></pre></td></tr></table></figure></p><h1 id="出现身份验证错误，要求的函数不受支持"><a href="#出现身份验证错误，要求的函数不受支持" class="headerlink" title="出现身份验证错误，要求的函数不受支持"></a>出现身份验证错误，要求的函数不受支持</h1><p><img src="/images/2017/1031/08.png" alt="windows"><br>此错误原因是检查更新了KB4103718的补丁造成的。</p><p>使用微软官方建议修改本地组策略：</p><ol><li>开始运行输入gpedit.msc</li><li>计算机配置&gt;管理模板&gt;系统&gt;凭据分配&gt;加密Oracle修正 选择启用并选择易受攻击。</li><li>易受攻击– 使用 CredSSP 的客户端应用程序将通过支持回退到不安全的版本使远程服务器遭受攻击，但使用 CredSSP 的服务将接受未修补的客户端。</li></ol><p><img src="/images/2017/1031/09.png" alt="windows"><br>PS:该操作仅用于专业版，如果是家庭版请考虑升级(本人是家庭版，在X宝上买的key升级为专业版了);<br>或者卸载KB4103718补丁重启。</p><p>参考地址：<br><a href="http://ytweb.blog.51cto.com/5865824/1177266" target="_blank" rel="external">http://ytweb.blog.51cto.com/5865824/1177266</a><br><a href="https://jingyan.baidu.com/article/3a2f7c2e6ab84626afd61114.html" target="_blank" rel="external">https://jingyan.baidu.com/article/3a2f7c2e6ab84626afd61114.html</a><br><a href="http://blog.sina.com.cn/s/blog_4298a2c80102vii4.html" target="_blank" rel="external">http://blog.sina.com.cn/s/blog_4298a2c80102vii4.html</a><br><a href="http://www.cnblogs.com/q149072205/p/6097433.html" target="_blank" rel="external">http://www.cnblogs.com/q149072205/p/6097433.html</a><br><a href="http://blog.csdn.net/flyingdream123/article/details/50724107" target="_blank" rel="external">http://blog.csdn.net/flyingdream123/article/details/50724107</a><br><a href="http://www.soncs.com/NewsShow/144.html" target="_blank" rel="external">http://www.soncs.com/NewsShow/144.html</a></p>]]></content>
      
      <categories>
          
          <category> Troubleshooting </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> 组策略 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Win10无法正常连接sslvpn</title>
      <link href="/arlo/e72ff5d/"/>
      <content type="html"><![CDATA[<h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><p>Dell燃7000<br>Win 10 64bit<br>Hangzhou DPtech Co.,Ltd. SSL VPN</p><h1 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h1><p>1、无法创建虚拟网卡<br>2、使用vpn自带的修复工具后驱动不对，“Windows 无法验证此设备所需的驱动程序的数字签名。该值受安全引导策略保护，无法进行修改或删除”</p><h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><p>1、重新笔记本<br>2、进入BIOS-Secure Boot，取消Windows UEFI模式<br>3、删除Secure Key(可以备份一下，我没备份，删除后暂时未发现异常)<br>4、重启后秒拨<br>参考：<a href="http://www.cnblogs.com/easyc/p/6132581.html" target="_blank" rel="external">http://www.cnblogs.com/easyc/p/6132581.html</a></p>]]></content>
      
      <categories>
          
          <category> Troubleshooting </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> vpn </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Jenkins使用Publish Over CIFS插件实现静态页面部署到Windows服务器</title>
      <link href="/arlo/9a888771/"/>
      <content type="html"><![CDATA[<p>发布静态内容操作很简单，一般分两步；一、获取svn内容。二、拷贝到服务器发布目录；<br>以前静态内容都是在Linux环境下使用Nginx发布，持续集成发布的时候<a href="http://wiki.hudson-ci.org/display/HUDSON/SCP+plugin" target="_blank" rel="external">Hudson SCP publisher plugin</a>,调用linux下Scp命令，通过SSH协议拷贝到发布目录就可以了；<br>最近遇到一个问题，需要发布静态页面到Windows服务器下。不论是IIS，还是Nginx，也都存在一个拷贝内容到发布目录的问题，Windows下采取目录共享方式，通过CIFS协议拷贝。<br><a id="more"></a></p><h1 id="共享发布目录"><a href="#共享发布目录" class="headerlink" title="共享发布目录"></a>共享发布目录</h1><p>共享nginx发布目录jzhome<br><img src="/images/2017/1024/01.png" alt="jenkins"></p><h1 id="Nginx-配置文件修改"><a href="#Nginx-配置文件修改" class="headerlink" title="Nginx 配置文件修改"></a>Nginx 配置文件修改</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">……</div><div class="line"> server &#123;</div><div class="line">        listen       80;</div><div class="line">        server_name  localhost;</div><div class="line">        location / &#123;</div><div class="line">    root   html;</div><div class="line">            index  index.html index.htm;</div><div class="line">        &#125;</div><div class="line">location /mypic &#123;</div><div class="line">    proxy_pass   http://127.0.0.1:8888/mypic;</div><div class="line">&#125;</div><div class="line">location /JzAir &#123;</div><div class="line">    proxy_pass   http://127.0.0.1:9999/JzAir;</div><div class="line">&#125;</div><div class="line">        location /Jzapp &#123;</div><div class="line">    proxy_pass   http://127.0.0.1:8080/Jzapp;</div><div class="line">&#125;</div><div class="line">location /jzhome &#123;</div><div class="line">    root   F:\\deploy\\nginx-1.12.1\\;</div><div class="line">    index  index.html index.htm;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">……</div></pre></td></tr></table></figure><h1 id="安装Jenkins插件"><a href="#安装Jenkins插件" class="headerlink" title="安装Jenkins插件"></a>安装Jenkins插件</h1><p>安装<a href="https://plugins.jenkins.io/publish-over-cifs" target="_blank" rel="external">Publish Over CIFS</a>插件，安装完成后重启Jenkins</p><h1 id="配置CIFS"><a href="#配置CIFS" class="headerlink" title="配置CIFS"></a>配置CIFS</h1><p>Jenkins-系统管理-系统配置-Publish over CIFS<br><img src="/images/2017/1024/02.png" alt="jenkins"></p><h1 id="配置Job"><a href="#配置Job" class="headerlink" title="配置Job"></a>配置Job</h1><p>Job-构建后步骤<br><img src="/images/2017/1024/03.png" alt="jenkins"><br><em>PS:这里有点比较难懂一点，Source files要一个能包含所有发布内容的父级目录，所以当发布内容为abc/html/xxx,我们在获取svn代码的时候，获取到abc这一层，这里Source files填写html/**,Remove prefix填写html,Remote directory为空，就可以将html目录下的所有内容发布到共享服务器上</em><br><img src="/images/2017/1024/04.png" alt="jenkins"></p><h2 id=""><a href="#" class="headerlink" title=""></a><img src="/images/2017/1024/05.png" alt="jenkins"></h2>]]></content>
      
      <categories>
          
          <category> 自动化运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 自动化 </tag>
            
            <tag> 运维 </tag>
            
            <tag> Jenkins </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Zabbix(6)监控SQL Server数据库</title>
      <link href="/arlo/35d80780/"/>
      <content type="html"><![CDATA[<p>监控SQL Server相对来说比较简单，首先我们下载一个MS SQL的模板文件<br>下载地址：<a href="https://share.zabbix.com/databases/microsoft-sql-server/template-ms-sql-2012" target="_blank" rel="external">https://share.zabbix.com/databases/microsoft-sql-server/template-ms-sql-2012</a><br><a id="more"></a></p><h1 id="修改zabbix-agent-conf文件"><a href="#修改zabbix-agent-conf文件" class="headerlink" title="修改zabbix_agent.conf文件"></a>修改zabbix_agent.conf文件</h1><p>添加下边这行到配置文件最后<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">UserParameter=sqldatabasename.discovery,powershell -NoProfile -ExecutionPolicy Bypass -File C:\zabbix\scripts\SQLBaseName_To_Zabbix.ps1</div></pre></td></tr></table></figure></p><h1 id="将powershell脚本放在目录下"><a href="#将powershell脚本放在目录下" class="headerlink" title="将powershell脚本放在目录下"></a>将powershell脚本放在目录下</h1><p>将SQLBaseName_To_Zabbix.ps1脚本放在C:\zabbix\scripts\目录下</p><h1 id="重启zabbix-agent"><a href="#重启zabbix-agent" class="headerlink" title="重启zabbix agent"></a>重启zabbix agent</h1><p>重启客户端zabbix agent服务</p><h1 id="导入模板文件"><a href="#导入模板文件" class="headerlink" title="导入模板文件"></a>导入模板文件</h1><p>导入模板MS SQL 2012.xml</p><h1 id="关联模板"><a href="#关联模板" class="headerlink" title="关联模板"></a>关联模板</h1><p><img src="/images/2017/1019/00.png" alt="zabbix_mssql"></p><h1 id="查看最新数据"><a href="#查看最新数据" class="headerlink" title="查看最新数据"></a>查看最新数据</h1><p><img src="/images/2017/1019/01.png" alt="zabbix_mssql"></p>]]></content>
      
      <categories>
          
          <category> 监控 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> zabbix </tag>
            
            <tag> 监控 </tag>
            
            <tag> MSSQL </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Zabbix(5)通过JMX监控Tomcat</title>
      <link href="/arlo/e35d6a2a/"/>
      <content type="html"><![CDATA[<p>Zabbix监控tomcat主要使用的是zabbix的zabbix-java-gateway。从Zabbix 2.0开始，内置了监控JMX的功能，叫做“Zabbix Java Gateway”，在Zabbix Server和Zabbix Proxy上启动名为“Zabbix Java Gateway”的进程，当需要获取JMX数据时，Zabbix Server会“问”JMX Gateway，然后JMX Gateway根据JMX管理API去查询需要的数据。在使用时，Java程序不需要在代码中新增任何东西，只需要在启动的时候加上一些JVM参数，使得它可以支持使用端口监控JMX。JMX的全称是Java Management Extensions，即Java管理扩展。Java程序会开放一些端口，用来获取运行状况。<br><a id="more"></a></p><h1 id="安装jmx服务器"><a href="#安装jmx服务器" class="headerlink" title="安装jmx服务器"></a>安装jmx服务器</h1><h2 id="安装jdk"><a href="#安装jdk" class="headerlink" title="安装jdk"></a>安装jdk</h2><p><a href="http://www.oracle.com/technetwork/java/archive-139210.html" target="_blank" rel="external">下载JDK</a><br><a href="http://islocal.cc/2017/09/27/JDK环境变量配置/">配置环境变量</a></p><h2 id="安装jmx服务"><a href="#安装jmx服务" class="headerlink" title="安装jmx服务"></a>安装jmx服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install zabbix-java-gateway</div></pre></td></tr></table></figure><h2 id="配置jmx服务"><a href="#配置jmx服务" class="headerlink" title="配置jmx服务"></a>配置jmx服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">egrep -v &apos;#|^$&apos; /etc/zabbix/zabbix_java_gateway.conf</div><div class="line">LISTEN_IP=&quot;0.0.0.0&quot;</div><div class="line">LISTEN_PORT=10052</div><div class="line">PID_FILE=&quot;/var/run/zabbix/zabbix_java.pid&quot;</div><div class="line">START_POLLERS=5</div><div class="line">TIMEOUT=3</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">systemctl start zabbix-java-gateway</div><div class="line">systemctl enable zabbix-java-gateway</div></pre></td></tr></table></figure><h2 id="修改zabbix-server配置"><a href="#修改zabbix-server配置" class="headerlink" title="修改zabbix server配置"></a>修改zabbix server配置</h2><p><em>添加以下三行，这里配置的StartJavaPollers值要小于之前java_gateway中的START_POLLERS</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">tail -n 3 /etc/zabbix/zabbix_server.conf </div><div class="line">JavaGateway=127.0.0.1</div><div class="line">JavaGatewayPort=10052     </div><div class="line">StartJavaPollers=3</div></pre></td></tr></table></figure></p><p>修改zabbix_server.conf后重启服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">systemctl restart zabbix-server</div></pre></td></tr></table></figure></p><h1 id="Tomcat配置修改"><a href="#Tomcat配置修改" class="headerlink" title="Tomcat配置修改"></a>Tomcat配置修改</h1><h2 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h2><p>Windows下tomcat在F:\apache-tomcat-7.0.70(zabbix)\bin\catalina.bat中set “CURRENT_DIR=%cd%”下添加以下内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">set CATALINA_OPTS=-Dcom.sun.management.jmxremote.port=12345 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false</div><div class="line"># 如果zabbix添加JMX后报错“java.net.SocketTimeoutException: connection timed out: service:jmx:rmi:///jndi/rmi:/”  添加此参数 -Djava.rmi.server.hostname=192.168.6.124</div></pre></td></tr></table></figure></p><h2 id="测试JMX"><a href="#测试JMX" class="headerlink" title="测试JMX"></a>测试JMX</h2><p>下载以下两个jar包放在tomcat lib目录下。<br>下载<a href="http://crawler.archive.org/cmdline-jmxclient/cmdline-jmxclient-0.10.3.jar" target="_blank" rel="external">cmdline-jmxclient-0.10.3.jar</a><br>下载<a href="https://archive.apache.org/dist/tomcat/tomcat-7/v7.0.77/bin/extras/catalina-jmx-remote.jar" target="_blank" rel="external">catalina-jmx-remote.jar</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">F:\apache-tomcat-7.0.70(zabbix)\lib&gt;java -jar cmdline-jmxclient-0.10.3.jar - 192.168.6.124:12345 java.lang:type=Memory NonHeapMemoryUsage</div><div class="line">10/10/2017 16:31:57 +0800 org.archive.jmx.Client NonHeapMemoryUsage:</div><div class="line">committed: 24838144</div><div class="line">init: 12746752</div><div class="line">max: 100663296</div><div class="line">used: 24806392</div></pre></td></tr></table></figure></p><h1 id="在zabbix-web页面中添加JMX端口"><a href="#在zabbix-web页面中添加JMX端口" class="headerlink" title="在zabbix web页面中添加JMX端口"></a>在zabbix web页面中添加JMX端口</h1><h2 id="导入模板"><a href="#导入模板" class="headerlink" title="导入模板"></a>导入模板</h2><p>zabbix自带的”Template App Generic Java JMX”和”Template App Apache Tomcat JMX”模板很多都获取不到数据，从网上找了个模板，监控项不多，但是都是很实用的。<br><img src="/images/2017/1010/06.png" alt="zabbix"><br><img src="/images/2017/1010/07.png" alt="zabbix"></p><h2 id="添加JMX端口"><a href="#添加JMX端口" class="headerlink" title="添加JMX端口"></a>添加JMX端口</h2><p>jmx的端口一定要与在catalina.bat下配置的jmxremote.port一样<br><img src="/images/2017/1010/04.png" alt="zabbix"></p><h2 id="关联模板"><a href="#关联模板" class="headerlink" title="关联模板"></a>关联模板</h2><p><img src="/images/2017/1010/05.png" alt="zabbix"></p><h2 id="查看图形"><a href="#查看图形" class="headerlink" title="查看图形"></a>查看图形</h2><p><img src="/images/2017/1010/08.png" alt="zabbix"></p><p>参考链接：<br><a href="http://wzlinux.blog.51cto.com/8021085/1692444" target="_blank" rel="external">http://wzlinux.blog.51cto.com/8021085/1692444</a><br><a href="http://blog.csdn.net/jhfsdfs/article/details/65629174" target="_blank" rel="external">http://blog.csdn.net/jhfsdfs/article/details/65629174</a><br><a href="http://www.fblinux.com/?p=616" target="_blank" rel="external">http://www.fblinux.com/?p=616</a></p><hr>]]></content>
      
      <categories>
          
          <category> 监控 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tomcat </tag>
            
            <tag> zabbix </tag>
            
            <tag> 监控 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Oracle删除用户报错ORA-01940: cannot drop a user that is currently connected</title>
      <link href="/arlo/dd79d161/"/>
      <content type="html"><![CDATA[<p>oracle导入数据之前，删除用户时候报错“ORA-01940: cannot drop a user that is currently connected”，原因是因为用户正在连接使用。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">SQL&gt; drop user air_forecast cascade;</div><div class="line">drop user air_forecast cascade</div><div class="line">*</div><div class="line">ERROR at line 1:</div><div class="line">ORA-01940: cannot drop a user that is currently connected</div></pre></td></tr></table></figure></p><a id="more"></a><h1 id="查询一下当前用户连接"><a href="#查询一下当前用户连接" class="headerlink" title="查询一下当前用户连接"></a>查询一下当前用户连接</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select sid,serial# from v$session where username=&apos;AIR_FORECAST&apos;;</div><div class="line">       SID    SERIAL#</div><div class="line">---------- ----------</div><div class="line">       237 2083</div><div class="line">       252 3564</div></pre></td></tr></table></figure><p><img src="/images/2017/1010/01.png" alt="oracle"></p><h1 id="杀掉占用进程"><a href="#杀掉占用进程" class="headerlink" title="杀掉占用进程"></a>杀掉占用进程</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">SQL&gt; alter system kill session &apos;237,2083&apos;;</div><div class="line"></div><div class="line">System altered.</div><div class="line"></div><div class="line">SQL&gt; alter system kill session &apos;252,3564&apos;;</div><div class="line"></div><div class="line">System altered.</div></pre></td></tr></table></figure><h1 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">SQL&gt; drop user air_forecast cascade;</div><div class="line"></div><div class="line"></div><div class="line">User dropped.</div></pre></td></tr></table></figure><p><img src="/images/2017/1010/02.png" alt="oracle"></p><p>PS：上述语句中没有状态列，所以看到删除的进程还在，其实是已经标记为KILLED状态了(status 为要删除用户的session状态，如果还为inactive，说明没有被kill掉，如果状态为killed，说明已kill)，删除进程后使用如下语句查询.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select saddr,sid,serial#,paddr,username,status from v$session where username is not null;</div></pre></td></tr></table></figure></p><h1 id="导入用户数据"><a href="#导入用户数据" class="headerlink" title="导入用户数据"></a>导入用户数据</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select * from dba_directories;#查询存储文件目录，将备份文件拷贝到此目录下</div><div class="line">shell&gt; impdp userid=&quot;&apos;sys/password@sx21 as sysdba&apos;&quot; schemas=air_forecast directory=DATA_PUMP_DIR dumpfile=AIR_FORECAST.DMP</div></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
            <tag> Troubleshooting </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Oracle数据库错误表SYS.AUD$无法通过8192(在表空间SYSTEM中)扩展</title>
      <link href="/arlo/1998d04e/"/>
      <content type="html"><![CDATA[<p>数据库报错信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[Content]</div><div class="line">ORA-00604: 递归 SQL 级别 1 出现错误</div><div class="line">ORA-01653: 表 SYS.AUD$ 无法通过 8192 (在表空间 SYSTEM 中) 扩展</div><div class="line">ORA-02002: 写入审计线索时出错</div><div class="line">ORA-00604: 递归 SQL 级别 1 出现错误</div><div class="line">ORA-01653: 表 SYS.AUD$ 无法通过 8192 (在表空间 SYSTEM 中) 扩展</div></pre></td></tr></table></figure></p><a id="more"></a><p>该错误原因为表空间无法扩展故障，查找后得知单个表空间文件最大32G，有两个方法扩大表空间<br>（1）创建多个数据文件，都不能超过32g<br>（2）创建大表空间。create bigfile tablespace  他的上限是8EB，不过，oracle10及以后版本才能用。<br>这里我们使用第一种方法处理一下此故障。</p><h1 id="Windows下切换SID"><a href="#Windows下切换SID" class="headerlink" title="Windows下切换SID"></a>Windows下切换SID</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">C:\Users\Administrator&gt;SET ORACLE_SID=sx21</div><div class="line">C:\Users\Administrator&gt;sqlplus /nolog</div><div class="line">SQL&gt; conn /as sysdba</div><div class="line"># 查询当前实例</div><div class="line">SQL&gt; select instance_name from v$instance；</div><div class="line">INSTANCE_NAME</div><div class="line">----------------</div><div class="line">sx21</div></pre></td></tr></table></figure><h1 id="增加一个表空间文件"><a href="#增加一个表空间文件" class="headerlink" title="增加一个表空间文件"></a>增加一个表空间文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># 查询表空间路径</div><div class="line">SQL&gt; SELECT FILE_NAME,TABLESPACE_NAME,AUTOEXTENSIBLE FROM dba_data_files WHERE TABLESPACE_NAME=&apos;SYSTEM&apos;;</div><div class="line"># 在同路径目录下添加一个表空间文件</div><div class="line">SQL&gt; ALTER TABLESPACE &quot;SYSTEM&quot; ADD DATAFILE &apos;E:\APP\ADMINISTRATOR\ORADATA\SX21\SYSTEM02.DBF&apos; SIZE 1000M AUTOEXTEND ON NEXT 50M MAXSIZE UNLIMITED;</div></pre></td></tr></table></figure><h1 id="执行完成后重新查看表空间使用情况"><a href="#执行完成后重新查看表空间使用情况" class="headerlink" title="执行完成后重新查看表空间使用情况"></a>执行完成后重新查看表空间使用情况</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SQL&gt; SELECT UPPER(F.TABLESPACE_NAME) &quot;表空间名&quot;, D.TOT_GROOTTE_MB &quot;表空间大小(M)&quot;, D.TOT_GROOTTE_MB - F.TOTAL_BYTES &quot;已使用空间(M)&quot;, TO_CHAR(ROUND((D.TOT_GROOTTE_MB - F.TOTAL_BYTES) / D.TOT_GROOTTE_MB * 100,2),&apos;990.99&apos;) &quot;使用比&quot;, F.TOTAL_BYTES &quot;空闲空间(M)&quot;, F.MAX_BYTES &quot;最大块(M)&quot; FROM (SELECT TABLESPACE_NAME, ROUND(SUM(BYTES) / (1024 * 1024), 2) TOTAL_BYTES, ROUND(MAX(BYTES) / (1024 * 1024), 2) MAX_BYTES FROM SYS.DBA_FREE_SPACE GROUP BY TABLESPACE_NAME) F, (SELECT DD.TABLESPACE_NAME, ROUND(SUM(DD.BYTES) / (1024 * 1024), 2) TOT_GROOTTE_MB FROM SYS.DBA_DATA_FILES DD GROUP BY DD.TABLESPACE_NAME) D WHERE D.TABLESPACE_NAME = F.TABLESPACE_NAME ORDER BY 4 DESC;</div></pre></td></tr></table></figure><p><img src="/images/2017/1009/01.png" alt="oracle"></p><p>参考链接：<a href="http://www.jydba.net/oracle数据文件大小的限制/" target="_blank" rel="external">http://www.jydba.net/oracle数据文件大小的限制/</a></p>]]></content>
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
            <tag> Troubleshooting </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Zabbix(4)通过orabbix插件监控Oracle数据库</title>
      <link href="/arlo/780360a7/"/>
      <content type="html"><![CDATA[<p>DBforBIX可以支持市面上主流的数据库监控，包括Oracle，Mysql，PostgreSQL，MSSQL，DB2，这篇文章简单的记录一下我监控oracle的过程；<br>软件环境：<br>Jdk 1.8.0_112<br>zabbix 3.4.2<br>orabbix 1.2.3<br><a id="more"></a></p><h1 id="安装jdk"><a href="#安装jdk" class="headerlink" title="安装jdk"></a>安装jdk</h1><p>下载jdk：<a href="http://www.oracle.com/technetwork/java/archive-139210.html" target="_blank" rel="external">http://www.oracle.com/technetwork/java/archive-139210.html</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">tar xf jdk-8u112-linux-x64.tar.gz -C /usr/local/</div><div class="line">vim /etc/profile</div><div class="line">export JAVA_HOME=/usr/local/jdk1.8.0_112/</div><div class="line">export CLASSPATH=.:$JAVA_HOME/lib/:$JAVA_HOME/jre/lib/</div><div class="line">export PATH=$JAVA_HOME/bin:$PATH</div></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">source /etc/profile</div></pre></td></tr></table></figure><h1 id="oracle中增加监控用户权限"><a href="#oracle中增加监控用户权限" class="headerlink" title="oracle中增加监控用户权限"></a>oracle中增加监控用户权限</h1><h2 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">su - oracle</div><div class="line">$ sqlplus /nolog</div><div class="line">SQL&gt; conn /as sysdba</div><div class="line">SQL&gt; CREATE USER ZABBIX  IDENTIFIED BY &apos;&lt;PASSWORD&gt;&apos; DEFAULT TABLESPACE SYSTEM TEMPORARY TABLESPACE TEMP PROFILE DEFAULT ACCOUNT UNLOCK;</div><div class="line">SQL&gt; CREATE USER ZABBIX  IDENTIFIED BY zabbix DEFAULT TABLESPACE SYSTEM TEMPORARY TABLESPACE TEMP PROFILE DEFAULT ACCOUNT UNLOCK;</div></pre></td></tr></table></figure><h2 id="赋予权限"><a href="#赋予权限" class="headerlink" title="赋予权限"></a>赋予权限</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">GRANT CONNECT TO ZABBIX;</div><div class="line">GRANT RESOURCE TO ZABBIX;</div><div class="line">GRANT CREATE SESSION TO ZABBIX;</div><div class="line">GRANT SELECT ANY DICTIONARY TO ZABBIX;</div><div class="line">GRANT UNLIMITED TABLESPACE TO ZABBIX;</div><div class="line">GRANT SELECT ANY DICTIONARY TO ZABBIX;</div></pre></td></tr></table></figure><p>如果是oracle11g的话，需执行以下语句<br><em>执行以下语句的时候，注意一下全角半角标点符号</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">SQL&gt; exec dbms_network_acl_admin.create_acl(acl =&gt;&apos;resolve.xml&apos;,description =&gt; &apos;resolve acl&apos;, principal =&gt;&apos;ZABBIX&apos;,is_grant =&gt; true, privilege =&gt; &apos;resolve&apos;);</div><div class="line">SQL&gt; exec dbms_network_acl_admin.assign_acl(acl =&gt;&apos;resolve.xml&apos;, host =&gt;&apos;*&apos;);</div></pre></td></tr></table></figure></p><p>验证语句<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SQL&gt; select utl_inaddr.get_host_name(&apos;127.0.0.1&apos;) from dual;</div></pre></td></tr></table></figure></p><h1 id="安装orabbix"><a href="#安装orabbix" class="headerlink" title="安装orabbix"></a>安装orabbix</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">wget https://nchc.dl.sourceforge.net/project/orabbix/orabbix-1.2.3.zip</div><div class="line">mkdir /usr/local/orabbix</div><div class="line">mv orabbix-1.2.3.zip /usr/local/orabbix/</div><div class="line">unzip orabbix-1.2.3.zip</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cp config.props.sample config.props</div><div class="line">vim config.props</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">ZabbixServerList=ZabbixServer</div><div class="line">ZabbixServer.Address=192.168.6.103</div><div class="line">ZabbixServer.Port=10051</div><div class="line">OrabbixDaemon.Sleep=300</div><div class="line">OrabbixDaemon.MaxThreadNumber=100</div><div class="line">#DatabaseList这里配置的主机名一定要和Zabbix里添加的主机名称一致，否则获取不到数据</div><div class="line">DatabaseList=vm00</div><div class="line">DatabaseList.MaxActive=10</div><div class="line">DatabaseList.MaxWait=100</div><div class="line">DatabaseList.MaxIdle=1</div><div class="line">vm00.Url=jdbc:oracle:thin:@192.168.6.100:1521:ORCL</div><div class="line">vm00.User=ZABBIX</div><div class="line">vm00.Password=zabbix</div><div class="line">vm00.MaxActive=10</div><div class="line">vm00.MaxWait=100</div><div class="line">vm00.MaxIdle=1</div><div class="line">vm00.QueryListFile=./conf/query.props</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">cd /usr/local/orabbix</div><div class="line">vim run.sh</div><div class="line">修改java为/usr/local/jdk1.8.0_112/bin/java</div><div class="line">chmod +x run.sh</div><div class="line">cp init.d/orabbix /etc/init.d/</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">vim /etc/init.d/orabbix</div><div class="line">修改orabbix=/opt/orabbix为orabbix=/usr/local/orabbix</div><div class="line">chmod +x /etc/init.d/orabbix</div><div class="line">chkconfig --level 35 --add orabbix </div><div class="line">/etc/init.d/orabbix start</div></pre></td></tr></table></figure><p>如果出现异常，可以查看日志排查 /usr/local/orabbix/logs/orabbix.log</p><h1 id="导入模板"><a href="#导入模板" class="headerlink" title="导入模板"></a>导入模板</h1><p>将/usr/local/orabbix/template/Orabbix_export_full.xml模板导入<br><img src="/images/2017/0930/01.png" alt="zabbix_install"><br><img src="/images/2017/0930/02.png" alt="zabbix_install"><br>添加主机，关联oracle数据库监控模板<br><img src="/images/2017/0930/03.png" alt="zabbix_install"><br>默认的配置文件无法正常获取到dbfilesize和dbsize，需要手动修改一下配置文件<br>/usr/local/orabbix/conf/query.props<br>在配置文件最后添加<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">dbfilesize.Query=select to_char(sum(bytes/1024/1024/10), &apos;FM99999999999999990&apos;) retvalue from dba_data_files</div><div class="line"> </div><div class="line">dbsize.Query=SELECT to_char(sum(  NVL(a.bytes/1024/1024/10 - NVL(f.bytes/1024/1024/10, 0), 0)), &apos;FM99999999999999990&apos;) retvalue \</div><div class="line">FROM sys.dba_tablespaces d, \</div><div class="line">(select tablespace_name, sum(bytes) bytes from dba_data_files group by tablespace_name) a, \</div><div class="line">(select tablespace_name, sum(bytes) bytes from dba_free_space group by tablespace_name) f \ </div><div class="line">WHERE d.tablespace_name = a.tablespace_name(+) AND d.tablespace_name = f.tablespace_name(+) \</div><div class="line">AND NOT (d.extent_management like &apos;LOCAL&apos; AND d.contents like &apos;TEMPORARY&apos;)</div></pre></td></tr></table></figure></p><p>在QueryList最后添加,dbfilesize,dbsize<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">QueryList=archive,audit,dbblockgets,dbconsistentgets,dbhitratio,dbphysicalread,dbversion,hitratio_body,hitratio_sqlarea,hitratio_table_proc, \</div><div class="line">lio_current_read,locks,maxprocs,maxsession,miss_latch,pga_aggregate_target, pga,phio_datafile_reads,phio_datafile_writes,phio_redo_writes,pinhitratio_body,pinhitratio_sqlarea,pinhitratio_table-proc,pinhitratio_</div><div class="line">trigger, \</div><div class="line">pool_dict_cache,pool_free_mem,pool_lib_cache,pool_misc,pool_sql_area,procnum,session_active,session_inactive,session,session_system,sga_buffer_cache, \</div><div class="line">sga_fixed,sga_java_pool,sga_large_pool,sga_log_buffer,sga_shared_pool,tbl_space,userconn,waits_controfileio,waits_directpath_read, \</div><div class="line">waits_file_io,waits_latch,waits_logwrite,waits_multiblock_read,waits_singleblock_read,hitratio_trigger,lio_block_changes,lio_consistent_read,waits_other,waits_sqlnet,users_locked,uptime,dbfilesize,dbsize</div></pre></td></tr></table></figure></p><p><img src="/images/2017/0930/04.png" alt="zabbix_install"><br>可以在最新数据里看到已经监控到的数据<br><img src="/images/2017/0930/05.png" alt="zabbix_install"></p><p>参考链接：<br><a href="https://www.kancloud.cn/devops-centos/centos-linux-devops/361200" target="_blank" rel="external">https://www.kancloud.cn/devops-centos/centos-linux-devops/361200</a><br><a href="http://fengwan.blog.51cto.com/508652/1722118" target="_blank" rel="external">http://fengwan.blog.51cto.com/508652/1722118</a><br><a href="http://www.smartmarmot.com/wiki/index.php?title=DBforBIX#Install_steps_for_Oracle" target="_blank" rel="external">http://www.smartmarmot.com/wiki/index.php?title=DBforBIX#Install_steps_for_Oracle</a></p>]]></content>
      
      <categories>
          
          <category> 监控 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
            <tag> zabbix </tag>
            
            <tag> 监控 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Zabbix(3)邮件报警配置</title>
      <link href="/arlo/3efe0c83/"/>
      <content type="html"><![CDATA[<p>报警的方式有很多，邮件，短信，微信，钉钉，最简单的方式这种脚本去发邮件，在此记录一下配置过程。</p><h1 id="配置邮件发送"><a href="#配置邮件发送" class="headerlink" title="配置邮件发送"></a>配置邮件发送</h1><h2 id="安装mailx"><a href="#安装mailx" class="headerlink" title="安装mailx"></a>安装mailx</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install mailx</div></pre></td></tr></table></figure><p>安装好，自己就有软链接了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@vm03 ~]# ls -l /usr/bin/mail</div><div class="line">lrwxrwxrwx 1 root root 5 May  6 02:07 /usr/bin/mail -&gt; mailx</div></pre></td></tr></table></figure></p><a id="more"></a><h2 id="配置mailx"><a href="#配置mailx" class="headerlink" title="配置mailx"></a>配置mailx</h2><p>vim /etc/mail.rc<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">set from=user@aliyun.com</div><div class="line">set smtp=smtp.aliyun.com</div><div class="line">set smtp-auth-user=user@aliyun.com</div><div class="line">set smtp-auth-password=&apos;&lt;password&gt;&apos;</div><div class="line">set smtp-auth=login</div></pre></td></tr></table></figure></p><h2 id="发送一封测试邮件"><a href="#发送一封测试邮件" class="headerlink" title="发送一封测试邮件"></a>发送一封测试邮件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">echo &apos;test&apos; |mailx -s &apos;abc&apos; abc@qq.com</div></pre></td></tr></table></figure><h2 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">vim /etc/zabbix/zabbix_server.conf</div><div class="line">AlertScriptsPath=/usr/lib/zabbix/alertscripts</div></pre></td></tr></table></figure><h2 id="发送邮件脚本"><a href="#发送邮件脚本" class="headerlink" title="发送邮件脚本"></a>发送邮件脚本</h2><p>vim z_sendmail.sh<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line">messages=`echo $3 | tr &apos;\r\n&apos; &apos;\n&apos;`</div><div class="line">subject=`echo $2 | tr &apos;\r\n&apos; &apos;\n&apos;`</div><div class="line">echo &quot;$&#123;messages&#125;&quot; | mail -s &quot;$&#123;subject&#125;&quot; $1 &gt;&gt;/tmp/sendmail.log 2&gt;&amp;1</div></pre></td></tr></table></figure></p><h2 id="使用脚本发送一封测试邮件"><a href="#使用脚本发送一封测试邮件" class="headerlink" title="使用脚本发送一封测试邮件"></a>使用脚本发送一封测试邮件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">chmod +x z_sendmail.sh</div><div class="line">touch /tmp/sendmail.log</div><div class="line">chown zabbix.zabbix /tmp/sendmail.log</div><div class="line">./z_sendmail.sh user@qq.com &quot;hello&quot; &quot;abc&quot;</div></pre></td></tr></table></figure><h1 id="添加报警类型"><a href="#添加报警类型" class="headerlink" title="添加报警类型"></a>添加报警类型</h1><h2 id="创建报警类型z-sendmail"><a href="#创建报警类型z-sendmail" class="headerlink" title="创建报警类型z_sendmail"></a>创建报警类型z_sendmail</h2><p>管理-报警媒介类型-创建媒体类型<br><img src="/images/2017/0929/15.png" alt="zabbix_install"><br><img src="/images/2017/0929/16.png" alt="zabbix_install"><br>脚本参数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">名称：z_sendmail</div><div class="line">类型：脚本</div><div class="line">脚本名称：z_sendmail.sh</div><div class="line">添加以下3个参数，分别对应z_sendmail.sh脚本需要的3个参数</div><div class="line">收件人地址:&#123;ALERT.SENDTO&#125;</div><div class="line">主题:&#123;ALERT.SUBJECT&#125;</div><div class="line">详细内容:&#123;ALERT.MESSAGE&#125;</div></pre></td></tr></table></figure></p><h2 id="设置用户报警媒介"><a href="#设置用户报警媒介" class="headerlink" title="设置用户报警媒介"></a>设置用户报警媒介</h2><p><img src="/images/2017/0929/17.png" alt="zabbix_install"><br><img src="/images/2017/0929/18.png" alt="zabbix_install"></p><h1 id="配置触发器告警"><a href="#配置触发器告警" class="headerlink" title="配置触发器告警"></a>配置触发器告警</h1><h2 id="修改默认的告警模板"><a href="#修改默认的告警模板" class="headerlink" title="修改默认的告警模板"></a>修改默认的告警模板</h2><p>设置为“‘非维护状态’且‘报警值&gt;=警告’”时触发动作<br><img src="/images/2017/0929/20.png" alt="zabbix_install"></p><h2 id="故障操作"><a href="#故障操作" class="headerlink" title="故障操作"></a>故障操作</h2><p><em>ps:这个模板标题不会乱码，其他的标题需要做utf8转码gb2312</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">默认接收人：故障&#123;TRIGGER.STATUS&#125;:服务器 &#123;HOSTNAME1&#125;:&#123;TRIGGER.NAME&#125;</div><div class="line">默认信息:</div><div class="line">告警主机:&#123;HOSTNAME1&#125;</div><div class="line">告警时间:&#123;EVENT.DATE&#125; &#123;EVENT.TIME&#125;</div><div class="line">告警等级:&#123;TRIGGER.SEVERITY&#125;</div><div class="line">告警信息: &#123;TRIGGER.NAME&#125;</div><div class="line">告警项目:&#123;TRIGGER.KEY1&#125;</div><div class="line">问题详情:&#123;ITEM.NAME&#125;:&#123;ITEM.VALUE&#125;</div><div class="line">当前状态:&#123;TRIGGER.STATUS&#125;:&#123;ITEM.VALUE1&#125;</div><div class="line">事件ID:&#123;EVENT.ID&#125;</div><div class="line">请至Montoring-Events中查看详细情况。</div></pre></td></tr></table></figure></p><p><img src="/images/2017/0929/21.png" alt="zabbix_install"></p><h2 id="恢复操作"><a href="#恢复操作" class="headerlink" title="恢复操作"></a>恢复操作</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">默认接收人：恢复&#123;TRIGGER.STATUS&#125;:服务器&#123;HOSTNAME1&#125;:&#123;TRIGGER.NAME&#125;</div><div class="line">默认信息：告警主机:&#123;HOSTNAME1&#125;</div><div class="line">告警时间:&#123;EVENT.DATE&#125; &#123;EVENT.TIME&#125;</div><div class="line">告警等级:&#123;TRIGGER.SEVERITY&#125;</div><div class="line">告警信息: &#123;TRIGGER.NAME&#125;</div><div class="line">告警项目:&#123;TRIGGER.KEY1&#125;</div><div class="line">问题详情:&#123;ITEM.NAME&#125;:&#123;ITEM.VALUE&#125;</div><div class="line">当前状态:&#123;TRIGGER.STATUS&#125;:&#123;ITEM.VALUE1&#125;</div><div class="line">事件ID:&#123;EVENT.ID&#125;</div><div class="line">报警已恢复，请放松心情。</div></pre></td></tr></table></figure><p><img src="/images/2017/0929/22.png" alt="zabbix_install"></p><h1 id="测试告警"><a href="#测试告警" class="headerlink" title="测试告警"></a>测试告警</h1><p>关闭zabbix agent，测试邮件<br><img src="/images/2017/0929/23.png" alt="zabbix_install"></p><p><em>ps:我用qq邮箱+授权码方式测试邮件，手动发送可以，系统提示发送成功，就是收不到，浪费了一天时间，坑好深！使用阿里云邮箱测试顺利！</em></p>]]></content>
      
      <categories>
          
          <category> 监控 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> zabbix </tag>
            
            <tag> 监控 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Zabbix(2)监控客户端安装</title>
      <link href="/arlo/b6f2d4bf/"/>
      <content type="html"><![CDATA[<h1 id="linux-客户端安装"><a href="#linux-客户端安装" class="headerlink" title="linux 客户端安装"></a>linux 客户端安装</h1><h2 id="安装客户端软件"><a href="#安装客户端软件" class="headerlink" title="安装客户端软件"></a>安装客户端软件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rpm -ivh http://repo.zabbix.com/zabbix/3.4/rhel/7/x86_64/zabbix-release-3.4-2.el7.noarch.rpm</div><div class="line">yum install zabbix-agent</div></pre></td></tr></table></figure><a id="more"></a><h2 id="配置连接服务器信息"><a href="#配置连接服务器信息" class="headerlink" title="配置连接服务器信息"></a>配置连接服务器信息</h2><p>vim /etc/zabbix/zabbix_agentd.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Server=192.168.6.103</div><div class="line">ServerActive=192.168.6.103</div><div class="line">Hostname=silu1</div></pre></td></tr></table></figure></p><h2 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">systemctl start zabbix-agent</div><div class="line">systemctl enable zabbix-agent</div></pre></td></tr></table></figure><h2 id="添加主机"><a href="#添加主机" class="headerlink" title="添加主机"></a>添加主机</h2><p><em>主机名称一定要和配置文件中的Hostname一致</em><br><img src="/images/2017/0929/11.png" alt="zabbix_install"><br><em>如果使用主动模式，这里的ip地址填写0.0.0.0</em><br><img src="/images/2017/0929/12.png" alt="zabbix_install"><br><img src="/images/2017/0929/13.png" alt="zabbix_install"></p><h1 id="Windows-客户端安装"><a href="#Windows-客户端安装" class="headerlink" title="Windows 客户端安装"></a>Windows 客户端安装</h1><h2 id="安装windows-客户端"><a href="#安装windows-客户端" class="headerlink" title="安装windows 客户端"></a>安装windows 客户端</h2><p>下载客户端软件 <a href="https://www.zabbix.com/downloads/3.4.0/zabbix_agents_3.4.0.win.zip" target="_blank" rel="external">https://www.zabbix.com/downloads/3.4.0/zabbix_agents_3.4.0.win.zip</a><br>解压到C盘根目录</p><h2 id="配置连接服务器信息-1"><a href="#配置连接服务器信息-1" class="headerlink" title="配置连接服务器信息"></a>配置连接服务器信息</h2><p>C:\zabbix_agents_3.4.0.win\conf\zabbix_agentd.win.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Server=192.168.6.103</div><div class="line">ServerActive=192.168.6.103</div><div class="line">Hostname=silu2</div></pre></td></tr></table></figure></p><h2 id="注册服务"><a href="#注册服务" class="headerlink" title="注册服务"></a>注册服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">C:\&gt;c:\zabbix_agents_3.4.0.win\bin\win64\zabbix_agentd.exe -i -c c:\zabbix_agents_3.4.0.win\conf\zabbix_agentd.win.conf</div></pre></td></tr></table></figure><h2 id="启动服务-1"><a href="#启动服务-1" class="headerlink" title="启动服务"></a>启动服务</h2><p>使用以下命令启动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">net start &quot;Zabbix Agent&quot;</div></pre></td></tr></table></figure></p><p>或者在本地服务中启动<br><img src="/images/2017/0929/14.png" alt="zabbix_install"></p><h2 id="添加主机-1"><a href="#添加主机-1" class="headerlink" title="添加主机"></a>添加主机</h2><p>和linux方法以下，选择Windows模板即可</p>]]></content>
      
      <categories>
          
          <category> 监控 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> zabbix </tag>
            
            <tag> 监控 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Zabbix(1)监控搭建</title>
      <link href="/arlo/3b5e53af/"/>
      <content type="html"><![CDATA[<p>Zabbix是一款能够监控各种网络参数以及服务器健康性、完整性的分布式监控软件；<br><a id="more"></a><br><strong>系统环境</strong><br>Centos    7.3.1611<br>Selinux    off<br>Iptables    off<br>Firewalld    off<br><strong>软件环境</strong><br>Zabbix    3.4.2<br>Httpd    2.4.6<br>Php    5.4.16<br>MariaDB    10.2.7</p><h1 id="使用部署包安装zabbix"><a href="#使用部署包安装zabbix" class="headerlink" title="使用部署包安装zabbix"></a>使用部署包安装zabbix</h1><h2 id="安装zabbix-server"><a href="#安装zabbix-server" class="headerlink" title="安装zabbix server"></a>安装zabbix server</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rpm -ivh http://repo.zabbix.com/zabbix/3.4/rhel/7/x86_64/zabbix-release-3.4-2.el7.noarch.rpm</div><div class="line">yum install zabbix-server-mysql zabbix-web-mysql</div></pre></td></tr></table></figure><h2 id="配置数据库"><a href="#配置数据库" class="headerlink" title="配置数据库"></a>配置数据库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">yum -y install mariadb-server mariadb</div><div class="line">cp /usr/share/mysql/my-medium.cnf /etc/my.cnf</div><div class="line">systemctl start mariadb.service</div><div class="line">systemctl enable mariadb.service</div><div class="line">mysql_secure_installation</div><div class="line">#初始化数据库，设置root密码</div><div class="line">mysql -uroot -p&lt;password&gt;</div><div class="line">mysql&gt; create database zabbix character set utf8 collate utf8_bin;</div><div class="line">mysql&gt; grant all privileges on zabbix.* to zabbix@localhost identified by &apos;&lt;password&gt;&apos;;</div><div class="line">mysql&gt; quit;</div><div class="line">cd /usr/share/doc/zabbix-server-mysql-3.4.2</div><div class="line">zcat create.sql.gz | mysql -uroot zabbix -p</div></pre></td></tr></table></figure><h2 id="配置zabbix-server-conf参数"><a href="#配置zabbix-server-conf参数" class="headerlink" title="配置zabbix_server.conf参数"></a>配置zabbix_server.conf参数</h2><p>vim /etc/zabbix/zabbix_server.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">DBHost=localhost</div><div class="line">DBName=zabbix</div><div class="line">DBUser=zabbix</div><div class="line">DBPassword=zabbix</div></pre></td></tr></table></figure></p><h2 id="启动Zabbix-Server"><a href="#启动Zabbix-Server" class="headerlink" title="启动Zabbix Server"></a>启动Zabbix Server</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">systemctl start zabbix-server</div><div class="line">systemctl enable zabbix-server</div></pre></td></tr></table></figure><h2 id="编辑Zabbix前端的PHP配置"><a href="#编辑Zabbix前端的PHP配置" class="headerlink" title="编辑Zabbix前端的PHP配置"></a>编辑Zabbix前端的PHP配置</h2><p>Zabbix前端的Apache配置文件位于 /etc/httpd/conf.d/zabbix.conf 。一些PHP设置已经完成了配置。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">php_value max_execution_time 300</div><div class="line">php_value memory_limit 128M</div><div class="line">php_value post_max_size 16M</div><div class="line">php_value upload_max_filesize 2M</div><div class="line">php_value max_input_time 300</div><div class="line">php_value always_populate_raw_post_data -1</div><div class="line">php_value date.timezone Asia/Shanghai</div></pre></td></tr></table></figure></p><h2 id="启动httpd"><a href="#启动httpd" class="headerlink" title="启动httpd"></a>启动httpd</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">systemctl start httpd</div><div class="line">systemctl enable httpd</div></pre></td></tr></table></figure><h1 id="配置zabbix前端"><a href="#配置zabbix前端" class="headerlink" title="配置zabbix前端"></a>配置zabbix前端</h1><h2 id="在浏览器中配置zabbix"><a href="#在浏览器中配置zabbix" class="headerlink" title="在浏览器中配置zabbix"></a>在浏览器中配置zabbix</h2><p>Zabbix前端可以在浏览器中通过 <a href="http://zabbixserver/zabbix" target="_blank" rel="external">http://zabbixserver/zabbix</a> 进行访问。<br><img src="/images/2017/0929/01.png" alt="zabbix_install"></p><h3 id="确认所有php参数都设置ok"><a href="#确认所有php参数都设置ok" class="headerlink" title="确认所有php参数都设置ok"></a>确认所有php参数都设置ok</h3><p><img src="/images/2017/0929/02.png" alt="zabbix_install"></p><h3 id="填写mysql数据库信息，用户名密码"><a href="#填写mysql数据库信息，用户名密码" class="headerlink" title="填写mysql数据库信息，用户名密码"></a>填写mysql数据库信息，用户名密码</h3><p><img src="/images/2017/0929/03.png" alt="zabbix_install"><br><img src="/images/2017/0929/04.png" alt="zabbix_install"></p><h3 id="确认所有配置信息正确"><a href="#确认所有配置信息正确" class="headerlink" title="确认所有配置信息正确"></a>确认所有配置信息正确</h3><p><img src="/images/2017/0929/05.png" alt="zabbix_install"><br><img src="/images/2017/0929/06.png" alt="zabbix_install"></p><h3 id="默认的用户名／密码为-Admin-zabbix"><a href="#默认的用户名／密码为-Admin-zabbix" class="headerlink" title="默认的用户名／密码为 Admin/zabbix"></a>默认的用户名／密码为 Admin/zabbix</h3><p><img src="/images/2017/0929/07.png" alt="zabbix_install"><br><img src="/images/2017/0929/08.png" alt="zabbix_install"></p><h1 id="系统配置"><a href="#系统配置" class="headerlink" title="系统配置"></a>系统配置</h1><h2 id="配置中文界面"><a href="#配置中文界面" class="headerlink" title="配置中文界面"></a>配置中文界面</h2><h3 id="替换中文字体"><a href="#替换中文字体" class="headerlink" title="替换中文字体"></a>替换中文字体</h3><p>在Windows系统里找一个中文字体（华文楷体）C:\Windows\Fonts\STKAITI.TTF上传到zabbix服务器替换掉默认的字体/usr/share/fonts/dejavu/DejaVuSans.ttf</p><h3 id="开启中文支持"><a href="#开启中文支持" class="headerlink" title="开启中文支持"></a>开启中文支持</h3><p>如果默认中文(zh_CN)支持被关闭，可以将zh_CN后边的false选项修改为true；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">vim /usr/share/zabbix/include/locales.inc.php</div><div class="line">function getLocales() &#123;</div><div class="line">        return [</div><div class="line">                &apos;en_GB&apos; =&gt; [&apos;name&apos; =&gt; _(&apos;English (en_GB)&apos;),     &apos;display&apos; =&gt; true],</div><div class="line">                &apos;en_US&apos; =&gt; [&apos;name&apos; =&gt; _(&apos;English (en_US)&apos;),     &apos;display&apos; =&gt; true],</div><div class="line">                &apos;bg_BG&apos; =&gt; [&apos;name&apos; =&gt; _(&apos;Bulgarian (bg_BG)&apos;),   &apos;display&apos; =&gt; false],</div><div class="line">                &apos;zh_CN&apos; =&gt; [&apos;name&apos; =&gt; _(&apos;Chinese (zh_CN)&apos;),     &apos;display&apos; =&gt; true],</div><div class="line">……</div></pre></td></tr></table></figure></p><h3 id="在web界面修改用户资料、语言"><a href="#在web界面修改用户资料、语言" class="headerlink" title="在web界面修改用户资料、语言"></a>在web界面修改用户资料、语言</h3><p><img src="/images/2017/0929/09.png" alt="zabbix_install"></p><h2 id="启用zabbix-server监控"><a href="#启用zabbix-server监控" class="headerlink" title="启用zabbix server监控"></a>启用zabbix server监控</h2><h3 id="安装zabbix-agent"><a href="#安装zabbix-agent" class="headerlink" title="安装zabbix agent"></a>安装zabbix agent</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">yum install zabbix-agent</div><div class="line">systemctl start zabbix-agent</div></pre></td></tr></table></figure><h3 id="在配置-主机中启用zabbix-server"><a href="#在配置-主机中启用zabbix-server" class="headerlink" title="在配置-主机中启用zabbix server"></a>在配置-主机中启用zabbix server</h3><p><img src="/images/2017/0929/10.png" alt="zabbix_install"></p><h1 id="CentOS-6-x-安装Zabbix"><a href="#CentOS-6-x-安装Zabbix" class="headerlink" title="CentOS 6.x 安装Zabbix"></a>CentOS 6.x 安装Zabbix</h1><p>CentOS 6.x 默认的php版本太低，需借助第三方源升级php;<br>建议PHP≥5.4 MySql≥5.6<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">rpm -Uvh http://rpms.famillecollet.com/enterprise/remi-release-6.rpm</div><div class="line">yum -y install --enablerepo=remi --enablerepo=remi-php56 php php-opcache php-devel php-mbstring php-mcrypt php-mysqlnd php-phpunit-PHPUnit php-pecl-xdebug php-pecl-xhprof  php-gd php-mysql php-bcmath php-ldap</div><div class="line">rpm -ql zabbix-web | grep example.conf</div><div class="line">cp /usr/share/doc/zabbix-web-3.4.8/httpd22-example.conf /etc/httpd/conf.d/zabbix.conf</div></pre></td></tr></table></figure></p><p><img src="/images/2017/0929/24.png" alt="zabbix_install"><br>参考资料:<br><a href="https://www.zabbix.com/documentation/3.4/zh/manual" target="_blank" rel="external">https://www.zabbix.com/documentation/3.4/zh/manual</a><br><a href="http://www.rfyy.net/archives/1742.html" target="_blank" rel="external">http://www.rfyy.net/archives/1742.html</a><br><a href="https://www.zabbix.com/documentation/3.4/manual/installation/install_from_packages/rhel_centos" target="_blank" rel="external">https://www.zabbix.com/documentation/3.4/manual/installation/install_from_packages/rhel_centos</a></p>]]></content>
      
      <categories>
          
          <category> 监控 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> zabbix </tag>
            
            <tag> 监控 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>JDK环境变量配置</title>
      <link href="/arlo/3f60947a/"/>
      <content type="html"><![CDATA[<h1 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h1><p>我的jdk安装在 C:\Program Files\Java\jdk1.8.0_141 目录下，以下为配置过程：<br>1.我的电脑-（右键）属性-高级系统设置-高级-环境变量<br>2.系统变量-新建<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">变量名：JAVA_HOME</div><div class="line">变量值：C:\Program Files\Java\jdk1.8.0_141</div></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">变量名：CLASSPATH</div><div class="line">变量值：%JAVA_HOME%\lib\tools.jar;%JAVA_HOME%\lib\dt.jar</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">变量名：Path</div><div class="line">变量值：C:\Program Files (x86)\Intel\iCLS Client\;C:\Program Files\Intel\iCLS Client\;%SystemRoot%\system32;%SystemRoot%;%SystemRoot%\System32\Wbem;%SYSTEMROOT%\System32\WindowsPowerShell\v1.0\;C:\Program Files (x86)\Intel\OpenCL SDK\2.0\bin\x86;C:\Program Files (x86)\Intel\OpenCL SDK\2.0\bin\x64;C:\Program Files\Intel\Intel(R) Management Engine Components\DAL;C:\Program Files\Intel\Intel(R) Management Engine Components\IPT;C:\Program Files (x86)\Intel\Intel(R) Management Engine Components\DAL;C:\Program Files (x86)\Intel\Intel(R) Management Engine Components\IPT;E:\Program Files\TortoiseSVN\bin;%JAVA_HOME%\bin;%JAVA_HOME%\jre\bin</div></pre></td></tr></table></figure><h1 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h1><p>编辑/etc/profile 文件，在文件最后添加以下内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">export JAVA_HOME=/usr/local/jdk1.8.0_112/</div><div class="line">export CLASSPATH=.:$JAVA_HOME/lib/:$JAVA_HOME/jre/lib/</div><div class="line">export PATH=$JAVA_HOME/bin:$PATH</div></pre></td></tr></table></figure></p><p><code>source /etc/profile</code></p><font color="red"><strong>保留系统以前自己配置的项，不要动！</strong></font>  ]]></content>
      
      <categories>
          
          <category> 常识 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 常识 </tag>
            
            <tag> Windows </tag>
            
            <tag> jdk </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>WindowsUpdate不能更新，错误提示8024402F解决方法</title>
      <link href="/arlo/e0a98909/"/>
      <content type="html"><![CDATA[<p>Windows系统下WindowsUpdate不能更新了，显示的是8024402F错误。<br>微软上看到了解决方法：使用以下DNS服务：<br>首选DNS服务器：4.2.2.1<br>备用DNS服务器：4.2.2.2<br>使用以后马上见效果。</p>]]></content>
      
      <categories>
          
          <category> Troubleshooting </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows </tag>
            
            <tag> 更新 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Jenkins持续集成发布时tomcat不能删除目录下文件</title>
      <link href="/arlo/fd00fe8d/"/>
      <content type="html"><![CDATA[<p>使用jenkins自动发布到tomcat时遇到一个问题，发布的时候不能自动删除tomcat下的工程目录，必须关闭tomcat之后，才能删除；提示如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&quot;org.codehaus.cargo.container.tomcat.internal.TomcatManagerException: The Tomcat Manager responded &quot;FAIL - Unable to delete [C:\ths\Tomcat8082-alk\webapps\SuperStation]. The continued presence of this file may cause problems.&quot;</div></pre></td></tr></table></figure></p><a id="more"></a><p><img src="/images/2017/0829/00.png" alt="jenkins"></p><h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><p>在<context>元素中增加一个属性antiResourceLocking=”true” antiJARLocking=”true”，默认是”false”。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;Context reloadable=&quot;true&quot; antiJARLocking=&quot;true&quot; antiResourceLocking=&quot;true&quot;&gt;</div></pre></td></tr></table></figure></context></p><p>实际上，这两个参数就是配置Tomcat的资源锁定和Jar包锁定策略。</p><h2 id="antiJARLocking"><a href="#antiJARLocking" class="headerlink" title="antiJARLocking"></a>antiJARLocking</h2><p>先来看看应用的antiJARLocking属性设置为true时，Tomcat是怎么处理的。<br>针对antiJARLocking属性的处理集中在WebappClassLoader的getResource和findResourceInternal方法里，主要原理是将包含在Jar包里的资源抽取放到应用的工作目录（work里应用对应的目录）下去。<br>把这个属性设置为true之后，部署应用就可以在work\Catalina\localhost\struts2-blank\loader目录下看到被解压的Jar包内容。<br>antiJARLocking属性在有的时候并不会生效，从WebappClassLoader的getResource和findResource方法逻辑里可以看出一些端倪，在一些情况下（通过对Loader的delegate、searchExternalFirst等相关属性进行配置），资源的获取并不是WebappClassLoader去做的，而是其父加载器的getResource方法或父类的findResource方法去做的，WebappClassLoader的父类是URLClassLoader、父加载器是URLClassLoader实例。</p><h2 id="antiResourceLocking"><a href="#antiResourceLocking" class="headerlink" title="antiResourceLocking"></a>antiResourceLocking</h2><p>当antiResourceLocking设置为true的时候，Tomcat不会锁定应用下的任何文件。那Tomcat是怎么做到这一点的呢？<br>在Tomcat的架构里，应用也是一个级别的容器，对应的接口是Context；各级容器本身都具备生命周期，而且配置了多个生命周期监听器来监听容器不同的生命周期过程。Tomcat在初始化的时候，给Context增加了一个生命周期监听器org.apache.catalina.startup.ContextConfig；然后在Context真正开始启动之前，会有一个BEFORE_START_EVENT状态，ContextConfig监听到这个状态的事件后，就会针对antiResourceLocking进行处理。<br>总结一下，就是如果应用的antiResourceLocking属性设置为true，就将应用的doc base移到临时目录下，让Tomca不会占用webapps下的文件。Tomcat里java.io.tmpdir默认指向Tomcat的temp目录。</p><h1 id="副作用"><a href="#副作用" class="headerlink" title="副作用"></a>副作用</h1><p>从上面的分析来看，antiResourceLocking为true有几个副作用：<br>1) 会延长应用的启动时间，因为多了临时目录的清理和往临时目录拷贝应用内容的操作；<br>2) 如果不知道这个属性的原理，修改webapps下应用的JSP，那就不会动态重加载到新的页面内容了，因为应用的doc base已经不再在webapps下了；<br>3) 停止Tomcat的时候，临时目录下实际的doc base会被删掉，<br>结合第二条和第三条，如果要修改应用的JSP，那必须将改动同时拷贝到两个目录下（原始doc base和临时目录下的doc base）。<br>所以Tomcat里这个属性缺省为false。在使用Tomcat 6.0.24之前的版本时，如果要用这个属性解决文件被锁的问题，三思而行。</p><p>参考链接：<a href="http://blog.csdn.net/yanjun008/article/details/41249753" target="_blank" rel="external">http://blog.csdn.net/yanjun008/article/details/41249753</a></p>]]></content>
      
      <categories>
          
          <category> Troubleshooting </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 自动化 </tag>
            
            <tag> 运维 </tag>
            
            <tag> Jenkins </tag>
            
            <tag> tomcat </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Linux下如何拨VPN</title>
      <link href="/arlo/350a96fc/"/>
      <content type="html"><![CDATA[<p>由于公司的svn和maven仓库地址都在内网，使用Centos系统搭建持续集成的时候，没有办法访问服务器，又不想换Windows环境；于是想办法在linux下拨通vpn！<br><a id="more"></a></p><h1 id="安装vpn客户端"><a href="#安装vpn客户端" class="headerlink" title="安装vpn客户端"></a>安装vpn客户端</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install pptp pptp-setup</div></pre></td></tr></table></figure><h1 id="创建一个vpn连接"><a href="#创建一个vpn连接" class="headerlink" title="创建一个vpn连接"></a>创建一个vpn连接</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pptpsetup --create pptpd --server SERVER_IP --username USERNAME --password PASSWORD --encrypt --start</div></pre></td></tr></table></figure><p><em><br>–create是创建的连接名称<br>–server是vpn的ip地址;<br>–username是用户名<br>–password是密码，也可以没这个参数，命令稍后会自动询问。这样可以保证账号安全<br>–encrypt 是表示需要加密，不必指定加密方式，命令会读取配置文件中的加密方式<br>–start是表示创建连接完后马上连接</em></p><h1 id="编辑配置文件"><a href="#编辑配置文件" class="headerlink" title="编辑配置文件"></a>编辑配置文件</h1><p>创建vpn连接完成后，会有两个配置文件(ps:<strong>有域的情况下，配置文件中\需要写成\\</strong>)<br>vim /etc/ppp/peers/pptpd<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"># written by pptpsetup</div><div class="line">pty &quot;pptp 1.2.3.4 --nolaunchpppd&quot;</div><div class="line">lock</div><div class="line">noauth</div><div class="line">nobsdcomp</div><div class="line">nodeflate</div><div class="line">name domain\\username                                                                                                                                                                       </div><div class="line">remotename pptpd</div><div class="line">ipparam pptpd</div><div class="line">require-mppe-128</div></pre></td></tr></table></figure></p><p>vim /etc/ppp/chap-secrets<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># Secrets for authentication using CHAP</div><div class="line"># client    server  secret          IP addresses</div><div class="line"></div><div class="line"># added by pptpsetup for pptpd</div><div class="line">domain\\username pptpd &quot;password&quot; *</div></pre></td></tr></table></figure></p><h1 id="复制开启-断开脚本"><a href="#复制开启-断开脚本" class="headerlink" title="复制开启\断开脚本"></a>复制开启\断开脚本</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cp /usr/share/doc/ppp-2.4.5/scripts/pon /usr/sbin/</div><div class="line">cp /usr/share/doc/ppp-2.4.5/scripts/poff /usr/sbin/</div><div class="line">chmod +x /usr/sbin/pon /usr/sbin/poff</div></pre></td></tr></table></figure><p><em><br>pon vpnname 开启vpn<br>poff vpnname 断开vpn</em></p><h1 id="尝试拨vpn"><a href="#尝试拨vpn" class="headerlink" title="尝试拨vpn"></a>尝试拨vpn</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pon pptpd</div></pre></td></tr></table></figure><h1 id="查看连接情况"><a href="#查看连接情况" class="headerlink" title="查看连接情况"></a>查看连接情况</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ip a</div></pre></td></tr></table></figure><p><img src="/images/2017/0823/00.png" alt="vpn"><br>如果有异常的话，可以跟踪系统日志排查<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tailf /var/log/messages</div></pre></td></tr></table></figure></p><h1 id="设置路由"><a href="#设置路由" class="headerlink" title="设置路由"></a>设置路由</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">route add -net 192.168.0.0/24 dev ppp0</div></pre></td></tr></table></figure><p><img src="/images/2017/0823/01.png" alt="vpn"></p>]]></content>
      
      <categories>
          
          <category> 常识 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 常识 </tag>
            
            <tag> vpn </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Jenkins邮件通知配置</title>
      <link href="/arlo/c26ec4ea/"/>
      <content type="html"><![CDATA[<p>Jenkins<a href="http://islocal.cc/2017/04/27/jenkins-%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">环境搭建</a>完成了,项目自动化编译打包也调通了，但是我们不能保证每次都是正常的，根据自己的情况(构建失败，构建状态不稳定)配置邮件通知是有必要的；这篇文章我采用腾讯qq邮箱来发送，使用公司邮箱来接收；</p><h1 id="常用的几种方式"><a href="#常用的几种方式" class="headerlink" title="常用的几种方式"></a>常用的几种方式</h1><ul><li>使用内置的邮件插进（使用全局的配置，只能有一个接收方）</li><li>使用邮件扩展插件【Email Extension Plugin】（使用全局的配置，能有多个接收方，但是只能有一个发送方）</li><li>使用邮件扩展插件【Email Extension Plugin】+Groovy脚本（实现每个Job对应不同的发送邮件，多个发送方）</li><li>开发邮件转发中间件或者使用Foxmail这些工具来转发（每个Job发送到对应的邮箱，然后中间件负责转发到成员列表的邮箱。对发送插件没什么要求，只要能发送即可）<br><em>(这篇文章只说一下前两种方式)</em><a id="more"></a><h1 id="使用QQ邮箱发送"><a href="#使用QQ邮箱发送" class="headerlink" title="使用QQ邮箱发送"></a>使用QQ邮箱发送</h1>qq授权码设置参考：<a href="http://service.mail.qq.com/cgi-bin/help?subtype=1&amp;&amp;id=28&amp;&amp;no=1001256" target="_blank" rel="external">http://service.mail.qq.com/cgi-bin/help?subtype=1&amp;&amp;id=28&amp;&amp;no=1001256</a><h1 id="使用内置的邮件插件"><a href="#使用内置的邮件插件" class="headerlink" title="使用内置的邮件插件"></a>使用内置的邮件插件</h1><h2 id="配置管理员邮件地址"><a href="#配置管理员邮件地址" class="headerlink" title="配置管理员邮件地址"></a>配置管理员邮件地址</h2>系统管理–&gt;系统设置–&gt;Jenkins Location<br><img src="/images/2017/0822/03.png" alt="jenkins"><h2 id="配置邮件通知"><a href="#配置邮件通知" class="headerlink" title="配置邮件通知"></a>配置邮件通知</h2>系统管理–&gt;系统设置–&gt;邮件通知–&gt;高级，配置如下：<br><strong>这里密码填写我们神的“qq授权码”</strong><br><img src="/images/2017/0822/00.png" alt="jenkins"><h2 id="测试邮件提醒"><a href="#测试邮件提醒" class="headerlink" title="测试邮件提醒"></a>测试邮件提醒</h2>勾选“通过发送测试邮件测试配置”<br><img src="/images/2017/0822/01.png" alt="jenkins"><br>看到“Email was successfully sent”即为成功，去邮箱里看一下<br><img src="/images/2017/0822/02.png" alt="jenkins"><h1 id="使用邮件拓展插件"><a href="#使用邮件拓展插件" class="headerlink" title="使用邮件拓展插件"></a>使用邮件拓展插件</h1>系统管理–&gt;系统设置–&gt;Extended E-mail Notification<br><img src="/images/2017/0822/04.png" alt="jenkins"><br><img src="/images/2017/0822/05.png" alt="jenkins"><h2 id="邮件内容配置"><a href="#邮件内容配置" class="headerlink" title="邮件内容配置"></a>邮件内容配置</h2>以下是参考<a href="http://blog.csdn.net/wangmuming/article/details/22925357" target="_blank" rel="external">网上的配置</a>：<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">Default Subject: 构建通知:$PROJECT_NAME - Build # $BUILD_NUMBER - $BUILD_STATUS!  Default Content!</div><div class="line">Default Content:</div><div class="line">(本邮件是程序自动下发的，请勿回复！)&lt;br/&gt;&lt;hr/&gt;</div><div class="line"></div><div class="line">项目名称：$PROJECT_NAME&lt;br/&gt;&lt;hr/&gt;</div><div class="line"></div><div class="line">构建编号：$BUILD_NUMBER&lt;br/&gt;&lt;hr/&gt;</div><div class="line"></div><div class="line">svn版本号：$&#123;SVN_REVISION&#125;&lt;br/&gt;&lt;hr/&gt;</div><div class="line"></div><div class="line">构建状态：$BUILD_STATUS&lt;br/&gt;&lt;hr/&gt;</div><div class="line"></div><div class="line">触发原因：$&#123;CAUSE&#125;&lt;br/&gt;&lt;hr/&gt;</div><div class="line"></div><div class="line">构建日志地址：&lt;a href=&quot;$&#123;BUILD_URL&#125;console&quot;&gt;$&#123;BUILD_URL&#125;console&lt;/a&gt;&lt;br/&gt;&lt;hr/&gt;</div><div class="line"></div><div class="line">构建地址：&lt;a href=&quot;$BUILD_URL&quot;&gt;$BUILD_URL&lt;/a&gt;&lt;br/&gt;&lt;hr/&gt;</div><div class="line"></div><div class="line">变更集:$&#123;JELLY_SCRIPT,template=&quot;html&quot;&#125;&lt;br/&gt;&lt;hr/&gt;</div></pre></td></tr></table></figure></li></ul><h2 id="全局属性详解"><a href="#全局属性详解" class="headerlink" title="全局属性详解"></a>全局属性详解</h2><p><em><br>Default Content Type：指定构建后发送邮件内容的类型，有Text和HTML两种。<br>Use List-ID Email Header：为所有的邮件设置一个List-ID的邮件信头，这样你就可以在邮件客户端使用过滤。<br>Add ‘Precedence: bulk’ Email Header：设置优先级。<br>Default Recipients：自定义默认电子邮件收件人列表。如果没有被项目配置覆盖,该插件会使用这个列表。<br>Reply To List：回复列表<br>Emergency reroute：如果这个字段不为空，所有的电子邮件将被单独发送到该地址（或地址列表）。<br>Excluded Committers：防止邮件被邮件系统认为是垃圾邮件,邮件列表应该没有扩展的账户名(如:@domain.com),并且使用逗号分隔。<br>Default Subject：自定义邮件通知的默认主题名称。该选项能在邮件的主题字段中替换一些参数，这样你就可以在构建中包含指定的输出信息。<br>Maximum Attachment Size：邮件最大附件大小。<br>Default Pre-send Script：默认发送前执行的脚本。<br>Enable Debug Mode：启用插件的调试模式。这将增加额外的日志输出，构建日志以及Jenkins的日志。在调试时是有用的，但不能用于生产。<br>Enable Security：启用时，会禁用发送脚本的能力，直接进入Jenkins实例。如果用户试图访问Jenkins管理对象实例，将抛出一个安全异常。<br>Content Token Reference：邮件中可以使用的变量，所有的变量都是可选的。具体介绍请查看全局邮件变量章节。</em></p><h2 id="Job中邮件配置"><a href="#Job中邮件配置" class="headerlink" title="Job中邮件配置"></a>Job中邮件配置</h2><p>在构建后操作——”Add Post-build Actions”选项中勾选”Editable Email Notification”标签<br><img src="/images/2017/0822/06.png" alt="jenkins"><br><em><br>Project Recipient List：这是一个以逗号(或者空格)分隔的收件人邮件的邮箱地址列表。允许您为每封邮件指定单独的列表。Ps：如果你想在默认收件人的基础上添加收件人：$DEFAULT_RECIPIENTS,&lt;新的收件人&gt;<br>Default Subject：允许你配置此项目邮件的主题。<br>Default Content：跟Default Subject的作用一样，但是是替换邮件内容。<br>Attach Build Log：附件构建日志。<br>Compress Build Log before sending：发送前压缩生成日志（zip格式）。</em></p><h3 id="添加触发器"><a href="#添加触发器" class="headerlink" title="添加触发器"></a>添加触发器</h3><p><img src="/images/2017/0822/07.png" alt="jenkins"></p><h3 id="查看构建失败日志"><a href="#查看构建失败日志" class="headerlink" title="查看构建失败日志"></a>查看构建失败日志</h3><p><img src="/images/2017/0822/08.png" alt="jenkins"></p><h3 id="查看收件箱"><a href="#查看收件箱" class="headerlink" title="查看收件箱"></a>查看收件箱</h3><p><img src="/images/2017/0822/09.png" alt="jenkins"></p><p>参考链接：<a href="http://www.cnblogs.com/yangxia-test/p/4366172.html" target="_blank" rel="external">http://www.cnblogs.com/yangxia-test/p/4366172.html</a></p><hr>]]></content>
      
      <categories>
          
          <category> 自动化运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 自动化 </tag>
            
            <tag> 运维 </tag>
            
            <tag> Jenkins </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Jenkins打包不能发现本地仓库包</title>
      <link href="/arlo/d4636f97/"/>
      <content type="html"><![CDATA[<p>jenkins里新建了一个maven风格的项目，打包过程中找不到ojdbc的包，然后手动下载，加载到本地仓库中了，jenkins依然提示找不到这个包。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[ERROR] Failed to execute goal on project atmosphere: Could not resolve dependencies for project com.ths:atmosphere:war:0.0.1-SNAPSHOT: Failure to find com.oracle:ojdbc14:jar:10.2.0.4.0 in https://repo.maven.apache.org/maven2 was cached in the local repository, resolution will not be reattempted until the update interval of central has elapsed or updates are forced -&gt; [Help 1]</div><div class="line">org.apache.maven.lifecycle.LifecycleExecutionException: Failed to execute goal on project atmosphere: Could not resolve dependencies for project com.ths:atmosphere:war:0.0.1-SNAPSHOT: Failure to find com.oracle:ojdbc14:jar:10.2.0.4.0 in https://repo.maven.apache.org/maven2 was cached in the local repository, resolution will not be reattempted until the update interval of central has elapsed or updates are forced</div><div class="line">at org.apache.maven.lifecycle.internal.LifecycleDependencyResolver.getDependencies(LifecycleDependencyResolver.java:221)</div></pre></td></tr></table></figure></p><a id="more"></a><h1 id="手动加载jar包到本地仓库"><a href="#手动加载jar包到本地仓库" class="headerlink" title="手动加载jar包到本地仓库"></a>手动加载jar包到本地仓库</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/apache-maven-3.3.9/bin/mvn install:install-file -DgroupId=com.oracle -DartifactId=ojdbc14 -Dversion=10.2.0.4.0 -Dpackaging=jar -Dfile=/usr/local/src/ojdbc14-10.2.0.4.0.jar</div></pre></td></tr></table></figure><h1 id="手动maven编译打包"><a href="#手动maven编译打包" class="headerlink" title="手动maven编译打包"></a>手动maven编译打包</h1><p>在工作目录下尝试手动编译打包，可以成功<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/apache-maven-3.3.9/bin/mvn compile install package</div></pre></td></tr></table></figure></p><p>然后我茫然了，同一台机器，同一个版本的jdk，同一个版本的mvn，同一份代码；本地maven编译打包可以成功，通过jenkins调用maven打包就找不到ojdbc的包，失败了；容我喝杯白开水压压惊！<br>我仔细排查了jenkins里边的配置，maven的全局配置使用的是默认的；maven版本和本地是一样的3.3.9；maven的仓库是默认地址~/.m2/repository;终于发现问题的所在了，<br><strong><em>原因就是maven的仓库是不一样的；本地执行maven编译打包使用的是root用户，仓库地址为/root/.m2/repository; jenkins程序是以jenkins用户启动起来的，默认的仓库地址为/var/lib/jenkins/.m2/repository/;</em></strong><br>我之前手动导入jar只导入到root用户下的仓库中了；</p><h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><h2 id="直接拷贝jar包到"><a href="#直接拷贝jar包到" class="headerlink" title="直接拷贝jar包到"></a>直接拷贝jar包到</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cp /root/.m2/repository/com/oracle/ojdbc14/10.2.0.4.0/ojdbc14-10.2.0.4.0.jar /var/lib/jenkins/.m2/repository/com/oracle/ojdbc14/10.2.0.4.0/ojdbc14-10.2.0.4.0.jar</div></pre></td></tr></table></figure><h2 id="修改本地maven仓库的地址"><a href="#修改本地maven仓库的地址" class="headerlink" title="修改本地maven仓库的地址"></a>修改本地maven仓库的地址</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">vim $MAVEN_HOME/conf/settings.xml</div><div class="line"></div><div class="line">&lt;localRepository&gt;/path/.m2/repository&lt;/localRepository&gt;</div></pre></td></tr></table></figure><h1 id="扩展阅读"><a href="#扩展阅读" class="headerlink" title="扩展阅读"></a>扩展阅读</h1><p>maven仓库的优先级别：<em>本地仓库 &gt;profile &gt; pom中的repository &gt; mirror</em><br><a href="http://toozhao.com/2012/07/13/compare-priority-of-maven-repository/" target="_blank" rel="external">http://toozhao.com/2012/07/13/compare-priority-of-maven-repository/</a>    </p>]]></content>
      
      <categories>
          
          <category> 自动化运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 自动化 </tag>
            
            <tag> 运维 </tag>
            
            <tag> Jenkins </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Tomcat启动慢原因排查</title>
      <link href="/arlo/d8e5626d/"/>
      <content type="html"><![CDATA[<h1 id="故障现象1"><a href="#故障现象1" class="headerlink" title="故障现象1"></a>故障现象1</h1><h2 id="Tomcat启动异常，卡在以下提示处"><a href="#Tomcat启动异常，卡在以下提示处" class="headerlink" title="Tomcat启动异常，卡在以下提示处"></a>Tomcat启动异常，卡在以下提示处</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">INFO: validateJarFile(/usr/local/apache-tomcat-7.0.79/webapps/thsbox/WEB-INF/lib/tomcat-servlet-api-8.5.15.jar) - jar not loaded. See Servlet Spec 3.0, section 10.7.2. Offending class: javax/servlet/Servlet.class</div><div class="line">Aug 17, 2017 2:36:19 PM org.apache.catalina.startup.TldConfig execute</div><div class="line">INFO: At least one JAR was scanned for TLDs yet contained no TLDs. Enable debug logging for this logger for a complete list of JARs that were scanned but no TLDs were found in them. Skipping unneeded JARs during scanning can improve startup time and JSP compilation time.</div></pre></td></tr></table></figure><a id="more"></a><h2 id="关闭TLDs"><a href="#关闭TLDs" class="headerlink" title="关闭TLDs"></a>关闭TLDs</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">vim  /usr/local/apache-tomcat-7.0.79/conf/context.xml</div><div class="line"></div><div class="line">&lt;Context processTlds=&quot;false&quot;&gt;</div><div class="line">    &lt;!-- Default set of monitored resources --&gt;</div><div class="line">    &lt;WatchedResource&gt;WEB-INF/web.xml&lt;/WatchedResource&gt;</div><div class="line">    ……</div><div class="line">&lt;/Context&gt;</div></pre></td></tr></table></figure><h2 id="屏蔽jar包"><a href="#屏蔽jar包" class="headerlink" title="屏蔽jar包"></a>屏蔽jar包</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">vim /usr/local/apache-tomcat-7.0.79/conf/catalina.properties</div><div class="line"></div><div class="line">tomcat.util.scan.StandardJarScanFilter.jarsToSkip=\</div><div class="line">tomcat-servlet-api-8.5.15.jar</div></pre></td></tr></table></figure><p>更改以上两个地方，日志还是会打印出来，启动还是卡主</p><h1 id="故障现象2"><a href="#故障现象2" class="headerlink" title="故障现象2"></a>故障现象2</h1><p>起初以为是启动不起来了，后来一直等着，发现只是很慢，可以启动起来的,在7分钟左右<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">INFO: Server startup in 432720 ms</div></pre></td></tr></table></figure></p><p>跟踪日志有重大发现<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">WARNING: Creation of SecureRandom instance for session ID generation using [SHA1PRNG] took [422,085] milliseconds</div></pre></td></tr></table></figure></p><h2 id="第一种修改方法"><a href="#第一种修改方法" class="headerlink" title="第一种修改方法"></a>第一种修改方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">vim /usr/local/jdk1.8.0_112/jre/lib/security/java.security</div><div class="line"></div><div class="line">#securerandom.source=file:/dev/random</div><div class="line">securerandom.source=file:/dev/./random</div></pre></td></tr></table></figure><p>修改完成后<em>INFO: Server startup in 118722 ms</em>(还是慢)</p><h2 id="第二种修改方法"><a href="#第二种修改方法" class="headerlink" title="第二种修改方法"></a>第二种修改方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">vim /usr/local/apache-tomcat-7.0.79/bin/catalina.sh</div><div class="line">修改第232行</div><div class="line">JAVA_OPTS=&quot;$JAVA_OPTS $JSSE_OPTS -Djava.security.egd=file:/dev/./urandom&quot;</div></pre></td></tr></table></figure><p>修改完成后<em>INFO: Server startup in 8985 ms</em></p><p>参考：<a href="http://www.cnblogs.com/raphael5200/p/6844510.html" target="_blank" rel="external">http://www.cnblogs.com/raphael5200/p/6844510.html</a></p>]]></content>
      
      
        <tags>
            
            <tag> tomcat </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Lustre文件系统部署</title>
      <link href="/arlo/c6d9ba0c/"/>
      <content type="html"><![CDATA[<p>软件下载<br><a href="https://downloads.hpdd.intel.com/public/lustre/" target="_blank" rel="external">https://downloads.hpdd.intel.com/public/lustre/</a><br><a href="https://downloads.hpdd.intel.com/public/e2fsprogs/1.42.7.wc1/" target="_blank" rel="external">https://downloads.hpdd.intel.com/public/e2fsprogs/1.42.7.wc1/</a><br><a href="http://mirror.symnds.com/software/zfsonlinux/repo/epel-testing/6/x86_64/ldiskfsprogs-1.42.7.wc1.3chaos-7.ch5.1.1.x86_64.rpm" target="_blank" rel="external">http://mirror.symnds.com/software/zfsonlinux/repo/epel-testing/6/x86_64/ldiskfsprogs-1.42.7.wc1.3chaos-7.ch5.1.1.x86_64.rpm</a></p><p>查看lustre版本和操作系统对应关系参考：<a href="https://wiki.hpdd.intel.com/display/PUB/Lustre+Support+Matrix" target="_blank" rel="external">https://wiki.hpdd.intel.com/display/PUB/Lustre+Support+Matrix</a></p><p>2.4以后的版本支持多个mds<br>查看lustre版本<br>lctl get_param version</p><p>&lt;未完待续&gt;</p><p>参考文档：<br><a href="http://www.google.com.pg/patents/CN102169448A?cl=zh" target="_blank" rel="external">http://www.google.com.pg/patents/CN102169448A?cl=zh</a><br><a href="http://cdn.opensfs.org/wp-content/uploads/2014/10/6-LUG-Inspur-WWWrevised.pdf" target="_blank" rel="external">http://cdn.opensfs.org/wp-content/uploads/2014/10/6-LUG-Inspur-WWWrevised.pdf</a></p>]]></content>
      
      <categories>
          
          <category> HPC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Lustre </tag>
            
            <tag> 文件系统 </tag>
            
            <tag> 分布式 </tag>
            
            <tag> 集群 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Lustre文件系统简介</title>
      <link href="/arlo/ab1d26cf/"/>
      <content type="html"><![CDATA[<p>Lustre是一款开源的，基于对象存储的集群并行分布式文件系统，具有很高的扩展性、可用性、易用性、性能等，在高性能计算中应用很广泛，世界十大超级计算中心当中的七个以及超过50%的全球top50超级计算机都在使用Lustre。可以支持上万个节点，数以PB的数量存储系统。从1999年lustre项目起，他的版权所有者就在不断的变换，从lustre项目组到Sun公司到Oracle再到Whamclound，最终被因特尔收购。<br><a id="more"></a><br>基于对象的文件系统将文件的元数据和文件数据分离开来，存储在不同的服务器上。文件系统的客户用利用元数据服务器和对象存储服务器来为用户提供一个完整的文件系统抽象。基于对象的文件系统具有性能优势，文件系统客户通过对象存储服务器来访问文件内容，而元数据服务器只有在文件打开时才需要连接。</p><h1 id="Lustre文件系统包括三种主要的功能单元"><a href="#Lustre文件系统包括三种主要的功能单元" class="headerlink" title="Lustre文件系统包括三种主要的功能单元"></a>Lustre文件系统包括三种主要的功能单元</h1><h2 id="元数据服务器MDS-Metadata-Server"><a href="#元数据服务器MDS-Metadata-Server" class="headerlink" title="元数据服务器MDS(Metadata Server)"></a>元数据服务器MDS(Metadata Server)</h2><p>元数据服务器（metadata servers，MDSes）。一个Lustre文件系统通常拥有两个元数据服务器（active和standby），一个元数据服务器则拥有若干元数据目标（metadata targets，MDTs）。元数据目标存储名字空间元数据：文件名、目录、访问权限、文件结构等信息。不同于诸如GPFS和PanFS等基于块并由元数据服务器控制所有块分配的分布式文件系统，Lustre元数据服务器仅仅关心路径搜索和权限检查而不会牵涉任何的文件I/O操作。该特性避免元数据服务器成为集群扩展的瓶颈。单个文件系统拥有多个元数据目标是从2.4开始引入的新特性。</p><h2 id="对象存储服务器OSS-Object-Storage-Server"><a href="#对象存储服务器OSS-Object-Storage-Server" class="headerlink" title="对象存储服务器OSS(Object Storage Server)"></a>对象存储服务器OSS(Object Storage Server)</h2><p>对象存储服务器（object storage servers，OSSes）将文件数据存储于一个或多个对象存储目标（object storage targets，OSTs）中。取决于服务器硬件，一个对象存储服务器通常有二到八个对象存储目标，每个对象存储目标管理一个本地文件系统。Lustre文件系统的空间等于所有对象存储目标的容量总和。</p><h2 id="客户端Client"><a href="#客户端Client" class="headerlink" title="客户端Client"></a>客户端Client</h2><p>客户机（Clients）能访问并使用数据。Lustre为所有客户机提供统一的命名空间。<br>Lustre支持多种网络类型，包括Infiniband，Omni-Path，以太网等。如果远程直接内存访问（RDMA）传输可用，Lustre将利用它提高吞吐量降低CPU使用率。</p><p>参考链接：<br><a href="https://zh.wikipedia.org/wiki/Lustre" target="_blank" rel="external">https://zh.wikipedia.org/wiki/Lustre</a><br><a href="https://www.ibm.com/developerworks/cn/linux/l-ofs/index.html" target="_blank" rel="external">https://www.ibm.com/developerworks/cn/linux/l-ofs/index.html</a><br><a href="http://blog.csdn.net/fsdev/article/details/7310975" target="_blank" rel="external">http://blog.csdn.net/fsdev/article/details/7310975</a><br><a href="http://mp.weixin.qq.com/s/QvBEU6yebkChMPNmcCZrWQ" target="_blank" rel="external">http://mp.weixin.qq.com/s/QvBEU6yebkChMPNmcCZrWQ</a></p>]]></content>
      
      <categories>
          
          <category> HPC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Lustre </tag>
            
            <tag> 文件系统 </tag>
            
            <tag> 分布式 </tag>
            
            <tag> 集群 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Mariadb(MHA)高可用集群搭建</title>
      <link href="/arlo/49c257f9/"/>
      <content type="html"><![CDATA[<p>MHA（Master High Availability）目前在MySQL高可用方面是一个相对成熟的解决方案，它由日本DeNA公司youshimaton（现就职于Facebook公司）开发，是一套优秀的作为MySQL高可用性环境下故障切换和主从提升的高可用软件。在MySQL故障切换过程中，MHA能做到在0~30秒之内自动完成数据库的故障切换操作，并且在进行故障切换的过程中，MHA能在最大程度上保证数据的一致性，以达到真正意义上的高可用。<br><a id="more"></a><br>该软件由两部分组成：MHA Manager（管理节点）和MHA Node（数据节点）。MHA Manager可以单独部署在一台独立的机器上管理多个master-slave集群，也可以部署在一台slave节点上。MHA Node运行在每台MySQL服务器上，MHA Manager会定时探测集群中的master节点，当master出现故障时，它可以自动将最新数据的slave提升为新的master，然后将所有其他的slave重新指向新的master。整个故障转移过程对应用程序完全透明。</p><p>在MHA自动故障切换过程中，MHA试图从宕机的主服务器上保存二进制日志，最大程度的保证数据的不丢失，但这并不总是可行的。例如，如果主服务器硬件故障或无法通过ssh访问，MHA没法保存二进制日志，只进行故障转移而丢失了最新的数据。使用MySQL 5.5的半同步复制，可以大大降低数据丢失的风险。MHA可以与半同步复制结合起来。如果只有一个slave已经收到了最新的二进制日志，MHA可以将最新的二进制日志应用于其他所有的slave服务器上，因此可以保证所有节点的数据一致性。<br>目前MHA主要支持一主多从的架构，要搭建MHA,要求一个复制集群中必须最少有三台数据库服务器，一主二从，即一台充当master，一台充当备用master，另外一台充当从库，因为至少需要三台服务器，出于机器成本的考虑，淘宝也在该基础上进行了改造，目前淘宝TMHA已经支持一主一从。</p><p>MHA工作原理总结为以下几条：</p><ul><li>从宕机崩溃的master保存二进制日志事件（binlog events）;</li><li>识别含有最新更新的slave;</li><li>应用差异的中继日志(relay log) 到其他slave;</li><li>应用从master保存的二进制日志事件(binlog events);</li><li>提升一个slave为新master;</li><li>使用其他的slave连接新的master进行复制。</li></ul><h1 id="配置基础环境"><a href="#配置基础环境" class="headerlink" title="配置基础环境"></a>配置基础环境</h1><h2 id="mysql主充复制集群搭建"><a href="#mysql主充复制集群搭建" class="headerlink" title="mysql主充复制集群搭建"></a>mysql主充复制集群搭建</h2><p>mha的环境是基于mysql主从复制环境上搭建的，主从复制请参考<strong><a href="http://islocal.cc/2017/07/26/Mariadb主从复制集群/">http://islocal.cc/2017/07/26/Mariadb主从复制集群/</a></strong> ，本文搭建的为一主三从环境</p><h1 id="配置互相无密码验证"><a href="#配置互相无密码验证" class="headerlink" title="配置互相无密码验证"></a>配置互相无密码验证</h1><h2 id="配置hosts"><a href="#配置hosts" class="headerlink" title="配置hosts"></a>配置hosts</h2><p>复制到到其他几台机器<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">cat /etc/hosts</div><div class="line">192.168.6.126mysql_a#从库#node</div><div class="line">192.168.6.127mysql_b#主库#node</div><div class="line">192.168.6.128mysql_c#备用主库#node</div><div class="line">192.168.6.102vm02#从库#manager</div></pre></td></tr></table></figure></p><h2 id="mysql-a"><a href="#mysql-a" class="headerlink" title="mysql_a"></a>mysql_a</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ssh-keygen </div><div class="line">ssh-copy-id mysql_b</div><div class="line">ssh-copy-id mysql_c</div><div class="line">sssh-copy-id vm02</div></pre></td></tr></table></figure><h2 id="mysql-b"><a href="#mysql-b" class="headerlink" title="mysql_b"></a>mysql_b</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ssh-keygen </div><div class="line">ssh-copy-id mysql_a</div><div class="line">ssh-copy-id mysql_c</div><div class="line">sssh-copy-id vm02</div></pre></td></tr></table></figure><h2 id="mysql-c"><a href="#mysql-c" class="headerlink" title="mysql_c"></a>mysql_c</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ssh-keygen </div><div class="line">ssh-copy-id mysql_a</div><div class="line">ssh-copy-id mysql_b</div><div class="line">ssh-copy-id vm02</div></pre></td></tr></table></figure><h2 id="vm02"><a href="#vm02" class="headerlink" title="vm02"></a>vm02</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ssh-keygen </div><div class="line">ssh-copy-id mysql_a</div><div class="line">ssh-copy-id mysql_b</div><div class="line">ssh-copy-id mysql_c</div></pre></td></tr></table></figure><h1 id="mysql-配置"><a href="#mysql-配置" class="headerlink" title="mysql 配置"></a>mysql 配置</h1><h2 id="建立mysql用户，赋予权限"><a href="#建立mysql用户，赋予权限" class="headerlink" title="建立mysql用户，赋予权限"></a>建立mysql用户，赋予权限</h2><p>在3台mysql服务器上分别新建mha用户，并授权<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">MariaDB [test_repl]&gt; grant all privileges on *.* to &apos;mha&apos;@&apos;mysql_a&apos; identified by &apos;222222&apos;;</div><div class="line">MariaDB [test_repl]&gt; grant all privileges on *.* to &apos;mha&apos;@&apos;mysql_b&apos; identified by &apos;222222&apos;;</div><div class="line">MariaDB [test_repl]&gt; grant all privileges on *.* to &apos;mha&apos;@&apos;mysql_c&apos; identified by &apos;222222&apos;;</div><div class="line">MariaDB [test_repl]&gt; grant all privileges on *.* to &apos;mha&apos;@&apos;vm02&apos; identified by &apos;222222&apos;;</div></pre></td></tr></table></figure></p><h2 id="修改mysql参数"><a href="#修改mysql参数" class="headerlink" title="修改mysql参数"></a>修改mysql参数</h2><p>在2台slave上修改<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql -e &apos;set global read_only=1&apos;</div><div class="line">mysql -uroot -pffffff -e &apos;show slave status\G&apos;|egrep &apos;Slave_IO|Slave_SQL&apos;</div></pre></td></tr></table></figure></p><h1 id="安装mha-manager"><a href="#安装mha-manager" class="headerlink" title="安装mha manager"></a>安装mha manager</h1><h2 id="安装mha-manager-1"><a href="#安装mha-manager-1" class="headerlink" title="安装mha manager"></a>安装mha manager</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@vm02 src]# yum install perl-DBD-MySQL perl-Config-Tiny perl-Log-Dispatch perl-Parallel-ForkManager perl-Time-HiRes -y</div><div class="line">[root@vm02 src]# cd mha4mysql-manager-0.56/</div><div class="line">[root@vm02 mha4mysql-manager-0.56]# perl Makefile.PL </div><div class="line">[root@vm02 mha4mysql-manager-0.56]# make &amp;&amp; make install</div><div class="line">[root@vm02 ~]# cp /usr/local/src/mha4mysql-manager-0.56/samples/scripts/master_ip_failover /usr/local/bin/</div><div class="line">[root@vm02 ~]# cp /usr/local/src/mha4mysql-manager-0.56/samples/scripts/master_ip_online_change /usr/local/bin/</div></pre></td></tr></table></figure><h2 id="主配置文件"><a href="#主配置文件" class="headerlink" title="主配置文件"></a>主配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">[server default]</div><div class="line">user=mha</div><div class="line">password=222222</div><div class="line">ping_interval=1</div><div class="line">remote_workdir=/tmp</div><div class="line">repl_user=repl</div><div class="line">repl_password=111111</div><div class="line">ssh_user=root</div><div class="line"></div><div class="line">manager_workdir=/var/log/masterha/app1</div><div class="line">manager_log=/var/log/masterha/app1/manager.log</div><div class="line">master_binlog_dir= /var/lib/mysql/</div><div class="line">master_ip_failover_script= /usr/local/bin/master_ip_failover</div><div class="line">master_ip_online_change_script= /usr/local/bin/master_ip_online_change</div><div class="line">report_script=/usr/local/send_report</div><div class="line">secondary_check_script= /usr/local/bin/masterha_secondary_check -s mysql_b -s mysql_c --master_host=mysql_b --master_ip=192.168.6.127 --master_port=3306</div><div class="line">shutdown_script=&quot;&quot;</div><div class="line"></div><div class="line"></div><div class="line">[server1]</div><div class="line">hostname=mysql_b</div><div class="line">port=3306</div><div class="line"></div><div class="line">[server2]</div><div class="line">master_binlog_dir=/var/lib/mysql</div><div class="line">hostname=mysql_c</div><div class="line">port=3306</div><div class="line">candidate_master=1</div><div class="line">check_repl_delay=0</div><div class="line"></div><div class="line">[server3]</div><div class="line">master_binlog_dir=/var/lib/mysql</div><div class="line">hostname=mysql_a</div><div class="line">port=3306</div><div class="line"></div><div class="line">[server4]</div><div class="line">master_binlog_dir=/var/lib/mysql</div><div class="line">hostname=vm02</div><div class="line">port=3306</div></pre></td></tr></table></figure><h1 id="安装mha-node"><a href="#安装mha-node" class="headerlink" title="安装mha node"></a>安装mha node</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># yum install perl-ExtUtils-CBuilder perl-ExtUtils-MakeMaker  perl-DBD-MySQL </div><div class="line">[root@mysql_a mha4mysql-node-0.56]# ansible mysql -a &apos;perl Makefile.PL chdir=/usr/local/src/mha4mysql-node-0.56/&apos;</div><div class="line">[root@mysql_a mha4mysql-node-0.56]# ansible mysql -a &apos;make chdir=/usr/local/src/mha4mysql-node-0.56/&apos;</div><div class="line">[root@mysql_a mha4mysql-node-0.56]# ansible mysql -a &apos;make install chdir=/usr/local/src/mha4mysql-node-0.56/&apos;</div></pre></td></tr></table></figure><h2 id="测试ssh连通性"><a href="#测试ssh连通性" class="headerlink" title="测试ssh连通性"></a>测试ssh连通性</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">[root@vm02 ~]# masterha_check_ssh --conf=/etc/mastermha/app1.cnf</div><div class="line">Wed Aug  2 17:12:59 2017 - [warning] Global configuration file /etc/masterha_default.cnf not found. Skipping.</div><div class="line">Wed Aug  2 17:12:59 2017 - [info] Reading application default configurations from /etc/mastermha/app1.cnf..</div><div class="line">Wed Aug  2 17:12:59 2017 - [info] Reading server configurations from /etc/mastermha/app1.cnf..</div><div class="line">Wed Aug  2 17:12:59 2017 - [info] Starting SSH connection tests..</div><div class="line">Wed Aug  2 17:13:00 2017 - [debug] </div><div class="line">Wed Aug  2 17:13:00 2017 - [debug]  Connecting via SSH from root@mysql_a(192.168.6.126:22) to root@mysql_b(192.168.6.127:22)..</div><div class="line">Wed Aug  2 17:13:00 2017 - [debug]   ok.</div><div class="line">Wed Aug  2 17:13:00 2017 - [debug]  Connecting via SSH from root@mysql_a(192.168.6.126:22) to root@mysql_c(192.168.6.128:22)..</div><div class="line">Wed Aug  2 17:13:00 2017 - [debug]   ok.</div><div class="line">Wed Aug  2 17:13:01 2017 - [debug] </div><div class="line">Wed Aug  2 17:13:00 2017 - [debug]  Connecting via SSH from root@mysql_b(192.168.6.127:22) to root@mysql_a(192.168.6.126:22)..</div><div class="line">Wed Aug  2 17:13:00 2017 - [debug]   ok.</div><div class="line">Wed Aug  2 17:13:00 2017 - [debug]  Connecting via SSH from root@mysql_b(192.168.6.127:22) to root@mysql_c(192.168.6.128:22)..</div><div class="line">Wed Aug  2 17:13:00 2017 - [debug]   ok.</div><div class="line">Wed Aug  2 17:13:01 2017 - [debug] </div><div class="line">Wed Aug  2 17:13:01 2017 - [debug]  Connecting via SSH from root@mysql_c(192.168.6.128:22) to root@mysql_a(192.168.6.126:22)..</div><div class="line">Wed Aug  2 17:13:01 2017 - [debug]   ok.</div><div class="line">Wed Aug  2 17:13:01 2017 - [debug]  Connecting via SSH from root@mysql_c(192.168.6.128:22) to root@mysql_b(192.168.6.127:22)..</div><div class="line">Wed Aug  2 17:13:01 2017 - [debug]   ok.</div><div class="line">Wed Aug  2 17:13:01 2017 - [info] All SSH connection tests passed successfully.</div></pre></td></tr></table></figure><p><img src="/images/2017/0807/01.png" alt="mariadb"></p><h2 id="测试主从复制"><a href="#测试主从复制" class="headerlink" title="测试主从复制"></a>测试主从复制</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vm02 ~]# masterha_check_repl --conf=/etc/mastermha/app1.cnf</div></pre></td></tr></table></figure><h1 id="报错"><a href="#报错" class="headerlink" title="报错"></a>报错</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Thu Aug  3 17:10:16 2017 - [info] MHA::MasterMonitor version 0.56.</div><div class="line">Thu Aug  3 17:10:18 2017 - [error][/usr/local/share/perl5/MHA/MasterMonitor.pm, ln401] Error happend on checking configurations. Use of uninitialized value in string eq at /usr/local/share/perl5/MHA/Server.pm line 236.</div><div class="line">Thu Aug  3 17:10:18 2017 - [error][/usr/local/share/perl5/MHA/MasterMonitor.pm, ln500] Error happened on monitoring servers.</div><div class="line">Thu Aug  3 17:10:18 2017 - [info] Got exit code 1 (Not master dead).</div></pre></td></tr></table></figure><p><em>解决方法还没找到，所以就卡在这里了，网上也没找到有效的解决方法；好悲催，有知道的可以知道我一下，联系方式关于里边有；我怀疑是不是因为我mha0.56和Mariadb10.2.7版本不匹配，或者Mariadb太新导致的；先放一放，后期找到解决方法了再处理吧。</em></p><p>参考：<a href="http://www.cnblogs.com/gomysql/p/3675429.html" target="_blank" rel="external">http://www.cnblogs.com/gomysql/p/3675429.html</a></p>]]></content>
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 集群 </tag>
            
            <tag> 数据库 </tag>
            
            <tag> Mariadb </tag>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Mariadb 读写分离集群搭建</title>
      <link href="/arlo/b48c6366/"/>
      <content type="html"><![CDATA[<h1 id="基础环境配置"><a href="#基础环境配置" class="headerlink" title="基础环境配置"></a>基础环境配置</h1><p>iptables: disabled<br>selinux:  disabled<br>|系统        |主机名        |IP地址            |角色          |<br>|CentOS 7.2 x64    |mysql_a    |192.168.6.126    |Atlas代理服务 |<br>|CentOS 7.2 x64    |mysql_b    |192.168.6.127    |Mysql主服务器 |<br>|CentOS 7.2 x64    |mysql_c    |192.168.6.128    |Mysql 从服务器|<br><a id="more"></a></p><h2 id="在mysql-a上安装ansible"><a href="#在mysql-a上安装ansible" class="headerlink" title="在mysql_a上安装ansible"></a>在mysql_a上安装ansible</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@mysql_a ~]# yum -y install epel-release</div><div class="line">[root@mysql_a ~]# yum -y install ansible</div><div class="line">[root@mysql_a ~]# vim /etc/ansible/hosts</div><div class="line">[mysql]</div><div class="line">mysql_b</div><div class="line">mysql_c</div></pre></td></tr></table></figure><h2 id="建立无密码通信"><a href="#建立无密码通信" class="headerlink" title="建立无密码通信"></a>建立无密码通信</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@mysql_a ~]# ssh-keygen -t rsa</div><div class="line">[root@mysql_a ~]# ssh-copy-id -i ~/.ssh/id_rsa.pub mysql_b</div><div class="line">[root@mysql_a ~]# ssh-copy-id -i ~/.ssh/id_rsa.pub mysql_c</div></pre></td></tr></table></figure><h2 id="保持服务器时间同步"><a href="#保持服务器时间同步" class="headerlink" title="保持服务器时间同步"></a>保持服务器时间同步</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@mysql_a ~]# ansible mysql -a &apos;timedatectl set-timezone Asia/Shanghai&apos;</div><div class="line">[root@mysql_a ~]# ansible mysql -a &apos;timedatectl set-ntp true&apos;</div><div class="line">[root@mysql_a ~]# ansible mysql -a &apos;ntpdate cn.ntp.org.cn&apos;</div></pre></td></tr></table></figure><h2 id="配置三台服务器的hosts"><a href="#配置三台服务器的hosts" class="headerlink" title="配置三台服务器的hosts"></a>配置三台服务器的hosts</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">cat /etc/hosts</div><div class="line">192.168.6.126   mysql_a</div><div class="line">192.168.6.127   mysql_b</div><div class="line">192.168.6.128   mysql_c</div><div class="line">[root@mysql_a ~]# ansible mysql -m copy -a &apos;src=/etc/hosts dest=/etc/hosts&apos;</div></pre></td></tr></table></figure><h1 id="搭建Mariadb-mysql-主从复制"><a href="#搭建Mariadb-mysql-主从复制" class="headerlink" title="搭建Mariadb(mysql)主从复制"></a>搭建Mariadb(mysql)主从复制</h1><h2 id="配置Mariadb-yum源"><a href="#配置Mariadb-yum源" class="headerlink" title="配置Mariadb yum源"></a>配置Mariadb yum源</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@mysql_a ~]# vim /etc/yum.repos.d/MariaDB.repo</div><div class="line"># MariaDB 10.2 CentOS repository list - created 2017-07-27 03:36 UTC</div><div class="line"># http://downloads.mariadb.org/mariadb/repositories/</div><div class="line">[mariadb]</div><div class="line">name = MariaDB</div><div class="line">baseurl = http://yum.mariadb.org/10.2/centos7-amd64</div><div class="line">gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB</div><div class="line">gpgcheck=1</div></pre></td></tr></table></figure><h2 id="安装Mariadb-mysql"><a href="#安装Mariadb-mysql" class="headerlink" title="安装Mariadb(mysql)"></a>安装Mariadb(mysql)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@mysql_a ~]# ansible mysql -m copy -a &apos;src=/etc/yum.repos.d/MariaDB.repo dest=/etc/yum.repos.d/MariaDB.repo&apos;</div><div class="line">[root@mysql_a ~]# ansible mysql -m yum -a &apos;name=MariaDB-server state=installed&apos;</div><div class="line">[root@mysql_a ~]# ansible mysql -m yum -a &apos;name=MariaDB-client state=installed&apos;</div></pre></td></tr></table></figure><p><strong>Ps：也可以下载以下几个rpm包，使用yum localinstall *.rpm 进行安装（速度会快一些）</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@mysql_b mariadb]# ll</div><div class="line">total 171204</div><div class="line">-rw-r--r-- 1 root root   8353220 Aug  1 13:56 galera-25.3.20-1.rhel7.el7.centos.x86_64.rpm</div><div class="line">-rw-r--r-- 1 root root  50251656 Aug  1 09:46 MariaDB-10.2.7-centos7-x86_64-client.rpm</div><div class="line">-rw-r--r-- 1 root root    158012 Aug  1 09:46 MariaDB-10.2.7-centos7-x86_64-common.rpm</div><div class="line">-rw-r--r-- 1 root root   2975776 Aug  1 09:46 MariaDB-10.2.7-centos7-x86_64-compat.rpm</div><div class="line">-rw-r--r-- 1 root root 113565340 Aug  1 09:46 MariaDB-10.2.7-centos7-x86_64-server.rpm</div></pre></td></tr></table></figure></p><h2 id="拷贝模板配置文件"><a href="#拷贝模板配置文件" class="headerlink" title="拷贝模板配置文件"></a>拷贝模板配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@mysql_a ~]# ansible mysql -a &apos;cp /usr/share/mysql/my-medium.cnf /etc/my.cnf&apos;</div></pre></td></tr></table></figure><h2 id="各服务器上执行初始化操作"><a href="#各服务器上执行初始化操作" class="headerlink" title="各服务器上执行初始化操作"></a>各服务器上执行初始化操作</h2><p>mysql_secure_installation</p><h2 id="修改mysql-b配置文件"><a href="#修改mysql-b配置文件" class="headerlink" title="修改mysql_b配置文件"></a>修改mysql_b配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">vim /etc/my.cnf</div><div class="line">log-bin=/var/lib/mysql/mysql-bin</div><div class="line">binlog_format=row</div><div class="line">server-id = 127</div><div class="line">sync_binlog = 1</div><div class="line">innodb_support_xa = 1</div><div class="line">innodb-flush-log-at-trx-commit=1</div></pre></td></tr></table></figure><h2 id="建立授权账号"><a href="#建立授权账号" class="headerlink" title="建立授权账号"></a>建立授权账号</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@mysql_b mariadb]# mysql -uroot -pffffff</div><div class="line">MariaDB [mysql]&gt; grant replication slave on *.* to &apos;repl&apos;@&apos;192.168.6.%&apos; identified by &apos;111111&apos;;</div><div class="line">MariaDB [(none)]&gt; show master status;</div><div class="line">+------------------+----------+--------------+------------------+</div><div class="line">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB |</div><div class="line">+------------------+----------+--------------+------------------+</div><div class="line">| mysql-bin.000002 |      342 |              |                  |</div><div class="line">+------------------+----------+--------------+------------------+</div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure><h2 id="修改mysql-c配置文件"><a href="#修改mysql-c配置文件" class="headerlink" title="修改mysql_c配置文件"></a>修改mysql_c配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">vim /etc/my.cnf</div><div class="line">binlog_format=row</div><div class="line">server-id  = 128</div><div class="line">replicate-ignore-db=mysql</div><div class="line">relay_log=relay-bin</div></pre></td></tr></table></figure><h2 id="重启两台Mariadb-mysql-服务"><a href="#重启两台Mariadb-mysql-服务" class="headerlink" title="重启两台Mariadb(mysql)服务"></a>重启两台Mariadb(mysql)服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@mysql_a ~]# ansible mysql -a &apos;systemctl restart mariadb.service&apos;</div></pre></td></tr></table></figure><h2 id="开启主从同步"><a href="#开启主从同步" class="headerlink" title="开启主从同步"></a>开启主从同步</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@mysql_c mysql]# mysql -uroot –pffffff</div><div class="line">MariaDB [(none)]&gt; stop slave;</div><div class="line">MariaDB [(none)]&gt; change master to master_host=&apos;mysql_b&apos;, master_user=&apos;repl&apos;, master_password=&apos;111111&apos;,master_log_file=&apos;mysql-bin.000002&apos;,master_log_pos=342;</div><div class="line">MariaDB [(none)]&gt; start slave;</div><div class="line">MariaDB [(none)]&gt; show slave status\G</div></pre></td></tr></table></figure><p><img src="/images/2017/0801/01.png" alt="mariadb"></p><h1 id="Atlas安装配置"><a href="#Atlas安装配置" class="headerlink" title="Atlas安装配置"></a>Atlas安装配置</h1><h2 id="安装Mariadb-Mysql-客户端"><a href="#安装Mariadb-Mysql-客户端" class="headerlink" title="安装Mariadb(Mysql)客户端"></a>安装Mariadb(Mysql)客户端</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@mysql_a mariadb]# yum install MariaDB-client</div><div class="line">[root@mysql_a mariadb]# systemctl status mariadb.service //确保Atlas本机没有mysql服务被启动</div><div class="line">Unit mariadb.service could not be found.</div></pre></td></tr></table></figure><h2 id="安装atlas"><a href="#安装atlas" class="headerlink" title="安装atlas"></a>安装atlas</h2><p>下载的时候有两个软件包带分片功能的Atlas-sharding 和Atlas，我们下后边这个（el6的包centos7可以安装）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@mysql_a src]# axel https://github.com/Qihoo360/Atlas/releases/download/2.2.1/Atlas-2.2.1.el6.x86_64.rpm</div><div class="line">[root@mysql_a src]# rpm -ivh Atlas-2.2.1.el6.x86_64.rpm</div></pre></td></tr></table></figure></p><p>安装目录为/usr/local/mysql-proxy/，会在此目录下生成bin,conf,lib,log四个目录</p><h2 id="生成一个加密字符串，配置文件中会用到"><a href="#生成一个加密字符串，配置文件中会用到" class="headerlink" title="生成一个加密字符串，配置文件中会用到"></a>生成一个加密字符串，配置文件中会用到</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@mysql_a bin]# ./encrypt 111111</div><div class="line">kOVJsquUepY=</div></pre></td></tr></table></figure><h2 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h2><p><em>360团队很良心，中文注释很详细</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line">[root@mysql_a bin]# vim /usr/local/mysql-proxy/conf/test.cnf</div><div class="line">[mysql-proxy]</div><div class="line"></div><div class="line">#带#号的为非必需的配置项目</div><div class="line"></div><div class="line">#管理接口的用户名</div><div class="line">admin-username = nsxq</div><div class="line"></div><div class="line">#管理接口的密码</div><div class="line">admin-password = ffffff</div><div class="line"></div><div class="line">#Atlas后端连接的MySQL主库的IP和端口，可设置多项，用逗号分隔</div><div class="line">proxy-backend-addresses = 192.168.6.127:3306</div><div class="line"></div><div class="line">#Atlas后端连接的MySQL从库的IP和端口，@后面的数字代表权重，用来作负载均衡，若省略则默认为1，可设置多项，用逗号分隔</div><div class="line">proxy-read-only-backend-addresses = 192.168.6.128:3306@1</div><div class="line"></div><div class="line">#用户名与其对应的加密过的MySQL密码，密码使用PREFIX/bin目录下的加密程序encrypt加密，下行的user1和user2为示例，将其替换为你的MySQL的用户名和加密密码！</div><div class="line">pwds = atlas:kOVJsquUepY=</div><div class="line"></div><div class="line">#设置Atlas的运行方式，设为true时为守护进程方式，设为false时为前台方式，一般开发调试时设为false，线上运行时设为true,true后面不能有空格。</div><div class="line">daemon = true</div><div class="line"></div><div class="line">#设置Atlas的运行方式，设为true时Atlas会启动两个进程，一个为monitor，一个为worker，monitor在worker意外退出后会自动将其重启，设为false时只有worker，没有monitor，一般开发调试时设为false，线上&gt;</div><div class="line">运行时设为true,true后面不能有空格。</div><div class="line">keepalive = true</div><div class="line"></div><div class="line">#工作线程数，对Atlas的性能有很大影响，可根据情况适当设置</div><div class="line">event-threads = 8</div><div class="line"></div><div class="line">#日志级别，分为message、warning、critical、error、debug五个级别</div><div class="line">log-level = message</div><div class="line"></div><div class="line">#日志存放的路径</div><div class="line">log-path = /usr/local/mysql-proxy/log</div><div class="line"></div><div class="line">#SQL日志的开关，可设置为OFF、ON、REALTIME，OFF代表不记录SQL日志，ON代表记录SQL日志，REALTIME代表记录SQL日志且实时写入磁盘，默认为OFF</div><div class="line">#sql-log = OFF</div><div class="line"></div><div class="line">#慢日志输出设置。当设置了该参数时，则日志只输出执行时间超过sql-log-slow（单位：ms)的日志记录。不设置该参数则输出全部日志。</div><div class="line">#sql-log-slow = 10</div><div class="line"></div><div class="line">#实例名称，用于同一台机器上多个Atlas实例间的区分</div><div class="line">#instance = test</div><div class="line"></div><div class="line">#Atlas监听的工作接口IP和端口</div><div class="line">proxy-address = 0.0.0.0:1234 </div><div class="line">#分表设置，此例中person为库名，mt为表名，id为分表字段，3为子表数量，可设置多项，以逗号分隔，若不分表则不需要设置该项</div><div class="line">#tables = person.mt.id.3</div><div class="line"></div><div class="line">#默认字符集，设置该项后客户端不再需要执行SET NAMES语句</div><div class="line">#charset = utf8</div><div class="line"></div><div class="line">#允许连接Atlas的客户端的IP，可以是精确IP，也可以是IP段，以逗号分隔，若不设置该项则允许所有IP连接，否则只允许列表中的IP连接</div><div class="line">#client-ips = 127.0.0.1, 192.168.1</div><div class="line"></div><div class="line">#Atlas前面挂接的LVS的物理网卡的IP(注意不是虚IP)，若有LVS且设置了client-ips则此项必须设置，否则可以不设置</div><div class="line">#lvs-ips = 192.168.1.1</div></pre></td></tr></table></figure></p><h2 id="启动Atlas服务"><a href="#启动Atlas服务" class="headerlink" title="启动Atlas服务"></a>启动Atlas服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@mysql_a bin]# ./mysql-proxyd test start</div><div class="line">[root@mysql_a mariadb]# ps -ef |grep mysql</div><div class="line">root     21456     1  0 15:24 ?        00:00:00 /usr/local/mysql-proxy/bin/mysql-proxy --defaults-file=/usr/local/mysql-proxy/conf/test.cnf</div><div class="line">root     21457 21456  0 15:24 ?        00:00:00 /usr/local/mysql-proxy/bin/mysql-proxy --defaults-file=/usr/local/mysql-proxy/conf/test.cnf</div><div class="line">root     21607 20025  0 15:35 pts/0    00:00:00 grep --color=auto mysql</div></pre></td></tr></table></figure><h2 id="通过Atlas访问"><a href="#通过Atlas访问" class="headerlink" title="通过Atlas访问"></a>通过Atlas访问</h2><h3 id="通过管理接口访问"><a href="#通过管理接口访问" class="headerlink" title="通过管理接口访问"></a>通过管理接口访问</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@mysql_a mariadb]# mysql -h127.0.0.1 -P2345 -unsxq –pffffff</div></pre></td></tr></table></figure><h3 id="通过工作接口访问"><a href="#通过工作接口访问" class="headerlink" title="通过工作接口访问"></a>通过工作接口访问</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">要保证这个用户在主从节点上都有权限，在主从节点上都添加一个用户</div><div class="line">MariaDB [mysql]&gt; grant all on *.* to atlas@&apos;192.168.6.%&apos; identified by &apos;111111&apos;;</div><div class="line">[root@mysql_a mariadb]# mysql -h127.0.0.1 -P1234 -uatlas -p111111</div></pre></td></tr></table></figure><p>参考连接：<br><a href="https://github.com/Qihoo360/Atlas/wiki" target="_blank" rel="external">https://github.com/Qihoo360/Atlas/wiki</a><br><a href="http://www.cnblogs.com/yyhh/p/5084844.html" target="_blank" rel="external">http://www.cnblogs.com/yyhh/p/5084844.html</a></p>]]></content>
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Mariadb </tag>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Mariadb主从复制集群</title>
      <link href="/arlo/fe63d61c/"/>
      <content type="html"><![CDATA[<p>Centos7系统中将Mysql置换为Mariadb了；Mariadb是Mysql数据库被Oracle公司收购之后Mysql之前的开发者基于mysql开发的开源数据库，完全兼容mysql；更详细的纠葛请自行google。<br>Mysql的主从复制是指从服务器向主服务器索取二进制binlog文件，在从服务器上把日志文件重新执行，从而获取主服务器数据，保证从服务器和主服务器的数据保持同步。但由于是异步的复制，从服务器在一定程度上落后于主服务器，刚写入到主服务器上的数据可能服务在从服务器上查询得到。<br><a id="more"></a></p><h1 id="复制原理过程"><a href="#复制原理过程" class="headerlink" title="复制原理过程"></a>复制原理过程</h1><ul><li>从服务器创建I/O线程连接主数据库，向主数据请库服务器求二进制日志文件（binlog）</li><li>主服务器上启动Binlog Dump,将二进制日志文件发送给I/O线程，I/O线程获取数据后将数据卸载从库的中继日志中（relay log）</li><li>SQL线程读取中继日志并执行</li></ul><h1 id="日志方式"><a href="#日志方式" class="headerlink" title="日志方式"></a>日志方式</h1><ul><li><strong>statement</strong>：基于语句级别的binlog，记录修改数据的sql语句。</li><li><strong>row</strong>： 基于行级别的binlog逐行记录数据的变更。</li><li><strong>mixed</strong>：由Mysql数据库自动选择哪种方式记录binlog。<br>raw格式下日志文件会很大，会影响磁盘的I/O,在传输过程中也会影响带宽，根据情况自行选择。</li></ul><h1 id="集群环境搭建"><a href="#集群环境搭建" class="headerlink" title="集群环境搭建"></a>集群环境搭建</h1><p>系统：Centos7 x64<br>软件：Mariadb 10.2 stable</p><h2 id="保持服务器时间同步"><a href="#保持服务器时间同步" class="headerlink" title="保持服务器时间同步"></a>保持服务器时间同步</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">timedatectl set-timezone Asia/Shanghai</div><div class="line">timedatectl set-ntp true</div><div class="line">ntpdate cn.ntp.org.cn</div></pre></td></tr></table></figure><h2 id="安装Mariadb软件"><a href="#安装Mariadb软件" class="headerlink" title="安装Mariadb软件"></a>安装Mariadb软件</h2><h3 id="配置yum源"><a href="#配置yum源" class="headerlink" title="配置yum源"></a>配置yum源</h3><p>参考<a href="https://downloads.mariadb.org/mariadb/repositories/" target="_blank" rel="external">https://downloads.mariadb.org/mariadb/repositories/</a><br>vim /etc/yum.repos.d/MariaDB.repo<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># MariaDB 10.2 CentOS repository list - created 2017-07-27 03:36 UTC</div><div class="line"># http://downloads.mariadb.org/mariadb/repositories/</div><div class="line">[mariadb]</div><div class="line">name = MariaDB</div><div class="line">baseurl = http://yum.mariadb.org/10.2/centos7-amd64</div><div class="line">gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB</div><div class="line">gpgcheck=1</div></pre></td></tr></table></figure></p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install MariaDB-server MariaDB-client</div></pre></td></tr></table></figure><h2 id="启动服务，并设置开机启动"><a href="#启动服务，并设置开机启动" class="headerlink" title="启动服务，并设置开机启动"></a>启动服务，并设置开机启动</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">systemctl start mariadb.service</div><div class="line">systemctl enable mariadb.service</div></pre></td></tr></table></figure><h2 id="初始化服务器"><a href="#初始化服务器" class="headerlink" title="初始化服务器"></a>初始化服务器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">可以初始化过程中设置密码</div><div class="line">mysql_secure_installation</div><div class="line">也可以进入数据库后设置密码</div><div class="line">update user set password=PASSWORD(&quot;SOME_ROOT_PASSWORD&quot;) where User=&apos;root&apos;;</div></pre></td></tr></table></figure><h2 id="配置主服务器"><a href="#配置主服务器" class="headerlink" title="配置主服务器"></a>配置主服务器</h2><p>将以下配置添加到my.cnf中[mysqld]下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">server-id=102#服务器ID号(取值范围为1到2的32次方-1的整数，建议使用ip地址最后一位，保持唯一性),写成server_id 不生效</div><div class="line">log-bin=/var/lib/mysql/mariadb-bin #二进制文件存放位置</div><div class="line">binlog_format=row#日志类型为raw</div><div class="line">sync_binlog = 1#事务一提交，就将二进制日志同步至磁盘上</div><div class="line">innodb_support_xa = 1#支持分布式事务</div><div class="line">innodb-flush-log-at-trx-commit=1#针对innodb的设置</div></pre></td></tr></table></figure></p><p>给slave开相应的权限<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">GRANT REPLICATION SLAVE ON *.* TO ‘repl’@‘192.168.6.103’ IDENTIFIED BY ‘123456’;</div></pre></td></tr></table></figure></p><h2 id="配置从服务器"><a href="#配置从服务器" class="headerlink" title="配置从服务器"></a>配置从服务器</h2><p>将以下配置添加到my.cnf中[mysqld]下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">server-id=103#服务器ID号(取值范围为1到2的32次方-1的整数，建议使用ip地址最后一位，保持唯一性)</div><div class="line">read_only = 1#从服务器为只读状态（确保数据的一致性）</div><div class="line">log-bin=/var/lib/mysql/mariadb-bin #中继日志存放目录   </div><div class="line">replicate-ignore-db=mysql#不需要同步的数据库（忽略的库最好配置在slave上，让master有最全的binlog）</div></pre></td></tr></table></figure></p><p><font color="red">Mysql版本从5.1.7以后开始就不支持“master-host”类似的参数；</font><br>在从库上执行如下命令；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">change master to master_host=&apos;192.168.6.102&apos;, master_user=&apos;repl&apos;, master_password=&apos;123456&apos;;    #好像不需要master_log_file和master_log_pos也可以;</div><div class="line">slave start;</div><div class="line">show slave status\G  #查看同步状态</div></pre></td></tr></table></figure></p><p><img src="/images/2017/0726/00.png" alt="mariadb"></p><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>在主服务器上新建数据库，建表，插入数据;在从库上查询；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">mysql -uroot -pffffff</div><div class="line">MariaDB [(none)]&gt; create database test_repl;</div><div class="line">MariaDB [(none)]&gt; use test_repl;</div><div class="line">MariaDB [test_repl]&gt; CREATE TABLE Persons (</div><div class="line">PersonID int,</div><div class="line">LastName varchar(255),</div><div class="line">FirstName varchar(255),</div><div class="line">Address varchar(255),</div><div class="line">City varchar(255)</div><div class="line">);</div><div class="line">MariaDB [test_repl]&gt; INSERT INTO Persons VALUES (1, &quot;LastName1&quot;, &quot;FirstName1&quot;, &quot;Address1&quot;, &quot;City1&quot;);</div></pre></td></tr></table></figure></p><p>在从库上查询；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mysql -uroot -pffffff</div><div class="line">MariaDB [(none)]&gt; use test_repl;</div><div class="line">MariaDB [test_repl]&gt; select * from Persons;</div></pre></td></tr></table></figure></p><p>可以在主库上看到连接的从库信息（一主多从很有用）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">MariaDB [test_repl]&gt; show slave hosts;</div><div class="line">+-----------+------+------+-----------+</div><div class="line">| Server_id | Host | Port | Master_id |</div><div class="line">+-----------+------+------+-----------+</div><div class="line">|         3 |      | 3306 |         1 |</div><div class="line">+-----------+------+------+-----------+</div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure></p><h1 id="问题记录"><a href="#问题记录" class="headerlink" title="问题记录"></a>问题记录</h1><h2 id="Q1："><a href="#Q1：" class="headerlink" title="Q1："></a>Q1：</h2><p>Q：Got fatal error 1236 from master when reading data from binary log: ‘Could not find first log file name in binary log index file’<br>A：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">MariaDB [test_repl]&gt; stop slave;</div><div class="line">MariaDB [test_repl]&gt; reset slave;</div><div class="line">MariaDB [test_repl]&gt; start slave;</div></pre></td></tr></table></figure></p><h2 id="Q2"><a href="#Q2" class="headerlink" title="Q2:"></a>Q2:</h2><p>Q:Could not execute Update_rows event on table mysql.user; Can’t find record in ‘user’, Error_code: 1032; handler error HA_ERR_KEY_NOT_FOUND; the event’s master log mariadb-bin.000003, end_log_pos 1749<br>A:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">MariaDB [test_repl]&gt; stop slave;  </div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line">MariaDB [test_repl]&gt; set global sql_slave_skip_counter=1;  </div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line">MariaDB [test_repl]&gt; start slave;</div><div class="line">Query OK, 0 rows affected (0.01 sec)</div></pre></td></tr></table></figure></p><h2 id="Q3："><a href="#Q3：" class="headerlink" title="Q3："></a>Q3：</h2><p>Q：<br>Last_SQL_Errno: 1146<br>Last_SQL_Error: Unable to load replication GTID slave state from mysql.gtid_slave_pos: Table ‘mysql.gtid_slave_pos’ doesn’t exist<br>A:<br>主从的版本是一样是，不清楚为什么会出现这样的问题，使用mysql_upgrade升级修复了一下好了；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql_upgrade -uroot -pffffff</div></pre></td></tr></table></figure></p><h1 id="扩展阅读"><a href="#扩展阅读" class="headerlink" title="扩展阅读"></a>扩展阅读</h1><p>Mysql默认的复制是异步的，Mysql(5.5以后版本)<strong><a href="http://www.cnblogs.com/ivictor/p/5735580.html" target="_blank" rel="external">半同步复制</a></strong></p><p>参考链接：<br><a href="https://linux.cn/article-5491-1.html" target="_blank" rel="external">https://linux.cn/article-5491-1.html</a><br><a href="http://joelhy.github.io/2015/02/06/mariadb-master-slave-replication/" target="_blank" rel="external">http://joelhy.github.io/2015/02/06/mariadb-master-slave-replication/</a><br><a href="http://www.cnblogs.com/gomysql/p/3662492.html" target="_blank" rel="external">http://www.cnblogs.com/gomysql/p/3662492.html</a></p><hr>]]></content>
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Mariadb </tag>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Linux下多线程下载工具Axel</title>
      <link href="/arlo/1a27e5da/"/>
      <content type="html"><![CDATA[<p>Linux 平台下默认的下载工具是wget，可在慢速或不稳定的网络连接下保持健壮性，如果由于网络问题下载失败，它将继续重试，直到整个文件下载完成；但是wget不支持多线程下载，这里推荐一个axel，可实现对同一个文件建立多个连接，每个连接下载单独的文件片段以更快地完成下载，支持HTTP,HTTPS,FTP,FTPS协议；<br><a id="more"></a></p><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="源码安装"><a href="#源码安装" class="headerlink" title="源码安装"></a>源码安装</h2><p>下载地址<a href="https://sourceforge.net/projects/axel2/files/" target="_blank" rel="external">https://sourceforge.net/projects/axel2/files/</a></p><h2 id="包管理器安装"><a href="#包管理器安装" class="headerlink" title="包管理器安装"></a>包管理器安装</h2><p>看教程说epel源中带有这个工具，但是我Centos 6.8 没发现；于是自已下载一个rpm包安装，推荐下载地址 <a href="http://pkgs.org/" target="_blank" rel="external">http://pkgs.org/</a></p><h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><h2 id="基本用法如下："><a href="#基本用法如下：" class="headerlink" title="基本用法如下："></a>基本用法如下：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alex [选项][下载目录][下载地址]</div></pre></td></tr></table></figure><h2 id="参数如下："><a href="#参数如下：" class="headerlink" title="参数如下："></a>参数如下：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">-s 指定每秒下载最大的比特数（如限速为512KB/s，设置为 -s 512000）</div><div class="line">-n 指定同时打开的下载线程数 (如指定10个线程，设置为 -n 10)</div><div class="line">-o 指定下载路径（如下载到/tmp目录，设置为 -o /tmp；也可以指定下载后的文件名，如下载后文件名为test.tgz,设置为 -o /tmp/test.tgz）</div><div class="line">-S 搜索镜像，并下载</div><div class="line">-v 打印更多状态信息</div><div class="line">-a 打印简洁的进度信息</div><div class="line">-q 不显示下载进度</div></pre></td></tr></table></figure><h1 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">axel -n 10 -a -o /tmp ftp://ftpprd.ncep.noaa.gov/pub/data/nccf/com/gfs/prod/enkf.20170724/12/gdas.t12z.atmf009s.mem011.nemsio</div></pre></td></tr></table></figure><h1 id="断点续传"><a href="#断点续传" class="headerlink" title="断点续传"></a>断点续传</h1><p><strong>如果下载过程中下载中断可以再执行下载命令即可恢复上次的下载进度</strong>。axel 默认具有恢复未完成的下载的行为。Axel 在下载文件时定期更新状态文件（扩展名为 .st）。由于某些原因，下载中途停止了？不用担心，只要使用相同的 axel 命令，它将会检查 file 和 file.st，如果找到，它会从停止处恢复下载。</p><p>参考：<a href="http://man.linuxde.net/axel" target="_blank" rel="external">http://man.linuxde.net/axel</a></p>]]></content>
      
      <categories>
          
          <category> 常识 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 常识 </tag>
            
            <tag> 下载 </tag>
            
            <tag> axel </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Intel编译器(parallel_studio_xe)安装</title>
      <link href="/arlo/e5fb788a/"/>
      <content type="html"><![CDATA[<h1 id="软件环境"><a href="#软件环境" class="headerlink" title="软件环境"></a>软件环境</h1><p>CentOS 7.2 x64<br>parallel_studio_xe_2013_update2_intel64.tgz<br>intel_eval.lic</p><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="安装依赖环境"><a href="#安装依赖环境" class="headerlink" title="安装依赖环境"></a>安装依赖环境</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# yum -y install libstdc++.so.5 gcc-c++</div></pre></td></tr></table></figure><h2 id="开始安装"><a href="#开始安装" class="headerlink" title="开始安装"></a>开始安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@vm00 src]# tar xf parallel_studio_xe_2013_update2_intel64</div><div class="line">[root@vm00 src]# cd parallel_studio_xe_2013_update2_intel64</div><div class="line">[root@vm00 parallel_studio_xe_2013_update2_intel64]# ./install.sh</div></pre></td></tr></table></figure><a id="more"></a><h2 id="初始化，欢迎界面"><a href="#初始化，欢迎界面" class="headerlink" title="初始化，欢迎界面"></a>初始化，欢迎界面</h2><p>-——————————————————————————-<br>Initializing, please wait…<br>-——————————————————————————-</p><p>Step no: 1 of 7 | Welcome<br>-——————————————————————————-<br>Welcome to the Intel(R) Parallel Studio XE 2013 Update 2 for Linux* installation<br>program.</p><p>-——————————————————————————-<br>You will complete the steps below during this installation:<br>Step 1 : Welcome<br>Step 2 : License<br>Step 3 : Activation<br>Step 4 : Intel(R) Software Improvement Program<br>Step 5 : Options<br>Step 6 : Installation<br>Step 7 : Complete<br>-——————————————————————————-<br>Press “Enter” key to continue or “q” to quit: <font color="red"><strong>回车</strong></font><br>-——————————————————————————-<br>Checking the prerequisites. It can take several minutes. Please wait…<br>-——————————————————————————-</p><h2 id="提示不支持的操作系统，跳过即可"><a href="#提示不支持的操作系统，跳过即可" class="headerlink" title="提示不支持的操作系统，跳过即可"></a>提示不支持的操作系统，跳过即可</h2><p>Step no: 1 of 7 | Options &gt; Missing Optional Pre-requisite(s)<br>-——————————————————————————-<br>There are one or more optional unresolved issues. It is highly recommended to<br>resolve them all before you continue the installation. You can fix them without<br>exiting from the installation and re-check. Or you can quit from the<br>installation, fix them and run the installation again.<br>-——————————————————————————-<br>Missing optional pre-requisites<br>– Intel(R) Composer XE 2013 Update 2 for Linux*: unsupported OS<br>-——————————————————————————-</p><ol><li>Skip missing optional pre-requisites [default]</li><li>Show the detailed info about issue(s)</li><li>Re-check the pre-requisites</li></ol><p>h. Help<br>b. Back to the previous menu<br>q. Quit<br>-——————————————————————————-<br>Please type a selection or press “Enter” to accept default choice [1]: <font color="red">回车</font> </p><h2 id="接受条约，输入accept"><a href="#接受条约，输入accept" class="headerlink" title="接受条约，输入accept"></a>接受条约，输入accept</h2><p>Step no: 2 of 7 | License<br>-——————————————————————————-<br>As noted in the Intel(R) Software Development Product End User License<br>Agreement, the Intel(R) Software Development Product you install will send Intel<br>the products serial number and other system information to help Intel improve<br>the product and validate license compliance. No personal information will be<br>transmitted.<br>-——————————————————————————-<br>To continue with the installation of this product you are required to accept<br>the terms and conditions of the End User License Agreement (EULA). The EULA<br>is displayed using the “more” utility. Press the spacebar to advance to the<br>next page or enter “q” to skip to the end. After reading the EULA, you must<br>enter “accept” to continue the installation or “decline” to return to the<br>previous menu.<br>-——————————————————————————-<br>IMPORTANT - READ BEFORE COPYING, INSTALLING OR USING.<br>Do not copy, install, distribute, public display, or use the Materials provided<br>under this license agreement (“Agreement”), until you have carefully read the<br>following terms and conditions.</p><p>By copying, installing, distributing, publicly displaying, or otherwise using<br>the Materials, you agree to be bound by the terms of this Agreement.<br>If you do not agree to the terms of this Agreement, do not copy,<br>install, distribute, publicly display, or use the Materials.</p><p>End User License Agreement for the Intel(R) Software Development Products<br>(Version May 2012)</p><ol><li>LICENSE DEFINITIONS: </li></ol><p>A.    “Materials” are defined as the software, documentation, license key<br>codes (if applicable) and other materials, including any updates and upgrade<br>thereto, that are provided to you under this Agreement.  Materials also<br>include the Redistributables, Cluster OpenMP Library, and Sample Source<br>as defined below.</p><p>B.    “Redistributables” are the files listed in the following text files that<br>may be included in the Materials for the applicable Intel Software Development<br>Product: clredist.txt, credist.txt, fredist.txt, redist.txt, redist-rt.txt.</p><p>C.    “Cluster OpenMP Library”, is comprised of the files listed in the<br>“clredist.txt” file specified above, is the Intel(R) Cluster OpenMP<em> Library<br>add-on option to the Intel(R) C++ Compiler for Linux</em> and<br>Intel(R) Fortran Compiler for Linux* products (“Intel Compiler for Linux”).<br>The use of the Cluster OpenMP Library is conditioned on having a valid license<br>from Intel for the Cluster OpenMP Library and for either Intel(R) C++ Compiler<br>for Linux or Intel(R) Fortran Compiler for Linux, and further is governed by the<br>terms and conditions of the license agreement for applicable the Intel Compiler<br>for Linux.</p><p>D.    “Source Code” is defined as the Materials provided in human readable<br>format, and includes modification that you make or are made on your behalf.  </p><p>E.    “Sample Source” is the Source Code file(s) that: (i) demonstrate certain<br>limited functions included in the binary libraries of the Intel(R) Integrated<br>Performance Primitives (“Intel(R) IPPs”); (ii) are identified as Intel IPP<br>sample source code; (iii) are obtained separately from Intel after you register<br>your copy of the Intel(R) IPPs product with Intel; and (iv) are subject to all<br>of the terms and conditions of this Agreement.</p><p>F.    “Microsoft Platforms” means any current and future Microsoft operating<br>system products, Microsoft run-time technologies (such as the .NET Framework),<br>and Microsoft application platforms<br>(such as Microsoft Office or Microsoft Dynamics) that Microsoft offers.</p><ol><li>LICENSE GRANT:</li></ol><p>A.    Subject to all of the terms and conditions of this Agreement,<br>Intel Corporation (“Intel”) grants to you a non-exclusive, non-assignable,<br>copyright license to use the Materials. </p><p>B.    Subject to all of the terms and conditions of this Agreement, Intel<br>grants to you a non-exclusive, non-assignable copyright license to modify the<br>Materials, or any portions thereof, that are (i) provided in Source Code form<br>or, (ii) are defined as Redistributables and are provided in text form.</p><p>C.    Subject to all of the terms and conditions of this Agreement and any<br>specific restrictions which may appear in the Redistributables text files, Intel<br>grants to you a non-exclusive, non-assignable, fully-paid copyright license to<br>distribute (except if you received the Materials under an Evaluation License<br>as specified below) the Redistributables, including any modifications pursuant<br>to Section 2.B, or any portions thereof, as part of the product or application<br>you developed using the Materials.  If such application is a software<br>development library, then attribution, as specified in the product release notes<br>of the corresponding Materials shall be displayed prominently in that product’s<br>or application’s associated documentation and on the product or application’s<br>web site (if any). </p><ol><li>LICENSE RESTRICTIONS:</li></ol><p>A.    If you receive your first copy of the Materials electronically, and a<br>second copy on media, then you may use the second copy only in accordance with<br>your applicable license stated in this Agreement, or for backup or archival<br>purposes.  You may not provide the second copy to another user.</p><p>B.    You may NOT:  (i) use, copy, distribute, or publicly display the<br>Materials except as provided in this Agreement; (ii) rent or lease the Materials<br>to any third party; (iii) assign this Agreement or transfer the Materials<br>without the express written consent of Intel; (iv) modify, adapt, or translate<br>the Materials in whole or in part except as provided in this Agreement;<br>(v) reverse engineer, decompile, or disassemble the Materials; (vi) attempt to<br>modify or tamper with the normal function of a license manager that regulates<br>usage of the Materials; (vii) distribute, sublicense or transfer the Source<br>Code form of any components of the Materials or derivatives thereof to any third<br>party except as provided in this Agreement; (viii) distribute Redistributables<br>except as part of a larger program that adds significant primary functionality<br>different from that of the Redistributables; (ix) distribute the<br>Redistributables to run on a platform other than a Microsoft Platform if per the<br>accompanying user documentation the Materials are meant to execute only on a<br>Microsoft Platform; (x) include the Redistributables in malicious, deceptive,<br>or unlawful programs; or (xi) modify or distribute the Source Code of any<br>Redistributable so that any part of it becomes subject to an Excluded License.<br>An “Excluded License” is one that requires, as a condition of use, modification,<br>or distribution, that the licensed software or other software incorporated into,<br>derived from or distributed with such software (a) be disclosed or distributed<br>in Source Code form; (b) be licensed by the user to third parties for the<br>purpose of making and/or distributing derivative works;<br>or (c) be redistributable at no charge.  Open source software includes, without<br>limitation, software licensed or distributed under any of the<br>following licenses or distribution models, or licenses or distribution models<br>substantially similar to any of the following: (a) GNU’s General Public License<br>(GPL) or Lesser/Library GPL (LGPL), (b) the Artistic License (e.g., PERL),<br>(c) the Mozilla Public License, (d) the Netscape Public License, (e) the Sun<br>Community Source License (SCSL), (f) the Sun Industry Source License (SISL),<br>and (g) the Common Public License (CPL).</p><p>C.    The scope and term of your license depends on the type of license you<br>are provided by Intel.  The variety of license types are set forth below, which<br>may not be available for all “Intel(R) Software Development Products” and<br>therefore may not apply to the Materials.  For more information on the types of<br>licenses, please contact Intel or your sales representative.</p><p>i.    PRE-RELEASE LICENSE:  If you are using the Materials under the control<br>of a pre-release license, (a) the Materials are deemed to be pre-release code<br>(e.g., alpha or beta release, etc), which may not be fully functional and which<br>Intel may substantially modify in development of a  commercial version, and for<br>which Intel makes no assurances that it will ever develop or make generally<br>available a commercial version, and (b) if you are an individual, you have the<br>right to use the Materials only for the duration of the pre-release term, which<br>is specified in the Materials, or until the commercial release, if any, of the<br>Materials, whichever is shorter.  You may install copies of the Materials on an<br>unlimited number of computers provided that you are the only individual using<br>the Materials and only one copy of the Materials is in use at any one time.<br>A separate license is required for each additional use and/or individual user<br>in all other cases, including without limitation, use by persons, computer<br>systems, and other use methods known now and in the future.  If you are an<br>entity, Intel grants you the right to designate one individual within your<br>organization to have the sole right to use the Materials in the manner<br>specified provided above.</p><p>ii.    EVALUATION LICENSE: If you are using the Materials under the control<br>of an evaluation license, you as an individual may use the Materials only for<br>internal evaluation purposes and only for the term of the evaluation, which<br>may be controlled by the license key code for the Materials.<br>NOTWITHSTANDING ANYTHING TO THE CONTRARY ELSEWHERE IN THIS<br>AGREEMENT, YOU MAY NOT DISTRIBUTE ANY PORTION OF THE MATERIALS, AND THE<br>APPLICATION AND/OR PRODUCT DEVELOPED BY YOU MAY ONLY BE USED FOR<br>EVALUATION PURPOSES AND ONLY FOR THE TERM OF THE EVALUATION.  You may<br>install copies of the Materials on a reasonable number of computers to conduct<br>your evaluation provided that you are the only individual using the Materials<br>and only one copy of the Materials is in use at any one time.  A separate<br>license is required for each additional use and/or individual user in all other<br>cases, including without limitation, use by persons, computer systems, and other<br>use methods known now and in the future.  Intel may provide you with a license<br>code key that enables the Materials for an evaluation license.  If you are an<br>entity, Intel grants you the right to designate one individual within your<br>organization to have the sole right to use the Materials in the manner<br>provided above.</p><p>iii.    NONCOMMERCIAL-USE LICENSE:  If you are using the Materials under the<br>control of a noncommercial-use license, if you are an individual, you as an<br>individual may use the Materials only for non-commercial use where you receive<br>no fee, salary or any other form of compensation.  The Materials may not be used<br>for any other purpose, whether “for profit” or “not for profit.”  Any work<br>performed or produced as a result of use of the Materials cannot be performed<br>or produced for the benefit of other parties for a fee, compensation or any<br>other<br>reimbursement or remuneration.  You may install copies of the Materials on an<br>unlimited number of computers provided that you are the only individual using<br>the Materials and only one copy of the Materials is in use at any one time.<br>A separate license is required for each additional use and/or individual user<br>in all other cases, including without limitation, use by persons, computer<br>systems, and other methods of use known now and in the future.  Intel will<br>provide you with a license code key that enables the Materials for a<br>noncommercial-use license.  If you obtained a time-limited noncommercial-use<br>license, the duration (time period) of your license and your ability to use the<br>Materials is limited to the time period of the obtained license, which is<br>controlled by the license key code for the Materials.  If you are an entity,<br>Intel grants you the right to designate one individual within your organization<br>to have the sole right to use the Materials in the manner provided above.</p><p>iv.    SINGLE-USER LICENSE: If you are using the Materials under the control<br>of a single-user license, you as an individual may install and use the Materials<br>on an unlimited number of computers provided that you are the only individual<br>using the Materials and only one copy of the Materials is in use at any one<br>time.  A separate license is required for each additional use and/or individual<br>user in all other cases, including without limitation, use by persons, computer<br>systems, and other methods of use known now and in the future.  Intel will<br>provide you with a license code key that enables the Materials for a single-user<br>license.  If you obtained a time-limited single-user license, the term of your<br>license and your ability to use the Materials is limited to the specified time<br>period, which is controlled by the license key code for the Materials.  If you<br>are an entity, Intel grants you the right to designate one individual within<br>your organization to have the sole right to use the Materials in the manner<br>provided above.</p><p>v.    NODE-LOCKED LICENSE: If you are using the Materials under the control of<br> a node-locked license, you may use the Materials only on a single designated<br>computer by no more than the authorized number of concurrent users.  A separate<br>license is required for each additional concurrent user and use, and/or computer<br>systems in all other cases, including without limitation, use by persons,<br>computer systems, and other methods of use known now and in the future.  Intel<br>will provide you with a license code key that enables the Materials for a Node-<br>Locked license up to the authorized number of concurrent users.  If you obtained<br>a time-limited node-locked license, the term of your license and your ability to<br>use the Materials is limited to the specified time, which is controlled by the<br>license key code for the Materials.</p><p>vi.    FLOATING LICENSE: If you are using the Materials under the control of a<br>floating license, you may (a) install the Materials on an unlimited number of<br>computers that are connected to the designated network and (b) use the Material<br>by no more than the authorized number of concurrent individual users.<br>A separate license is required for each additional concurrent individual user<br>and each additional use by a computer system and/or network on which the<br>Materials are used. You understand that you must obtain a  separate license for<br>every and any use of the Materials under a floating license, regardless of<br>whether such use is, without limitation, by persons, computer systems, and other<br>methods of use known now and in the future.  Intel will provide you with a<br>license code key that enables the Materials for a floating license up to the<br>authorized number of concurrent users.  If you obtained a time-limited Floating<br>license, the duration (time period) of your license and your ability to use the<br>Materials is limited to the time period of the obtained license, which is<br>controlled by the license key code for the Materials.  Intel Library Floating<br>License: If the Materials are the Intel(R) Math Kernel Library or the Intel(R)<br>Integrated Performance Primitives Library or the Intel(R) Threading Building<br>Blocks (either “Intel Library”), then the Intel Library is provided to you as an<br>add-on option to either the Intel(R) C++ Compiler product or the Intel(R)<br>Fortran Compiler product (either, an “Intel Compiler”) for which you have a<br>Floating license, and as such, in addition to the terms and conditions above,<br>the Intel Library may only be used by the authorized concurrent users (as noted<br>above) of that Intel Compiler Floating license.</p><p>D.    DISTRIBUTION:  Distribution of the Redistributables is also subject to<br>the following limitations:  You (i) shall be solely responsible to your<br>customers for any update or support obligation or other liability which may<br>arise from the distribution, (ii) shall not make any statement that your product<br>is “certified”, or that its performance is guaranteed, by Intel, (iii) shall not<br>use Intel’s name or trademarks to market your product without written<br>permission, (iv) shall use a license agreement that prohibits disassembly and<br>reverse engineering of the Redistributables, (v) shall indemnify, hold harmless,<br>and defend Intel and its suppliers from and against any claims or lawsuits,<br>including attorney’s fees, that arise or result from your distribution of<br>any product.</p><p>E.    Intel(R) Integrated Performance Primitives (Intel IPP). The following<br>terms and conditions apply only to the Intel IPP.</p><p>i.    Notwithstanding anything in this Agreement to the contrary, if you<br>implement the Sample Sources in your application or if you use Intel IPP to<br>implement algorithms that are protected by others’ licenses then you may need<br>additional licenses from various entities. Should any such additional licenses<br>be required, you are solely responsible for obtaining any such licenses and<br>agree to obtain any such licenses at your own expense.</p><p>ii.    Notwithstanding anything herein to the contrary, a valid license to<br>Intel IPP is a prerequisite to any license for Sample Source, and possession of<br>Sample Source does not grant any license to Intel IPP (or any portion thereof).<br>To access Sample Source, you must first register your licensed copy of the Intel<br>IPP with Intel.  By downloading, installing or copying any Sample Source file,<br>you agree to be bound by terms of this Agreement.</p><p>F.    SOFTWARE TRANSFER:  Except for Pre-Release Licenses or Evaluation<br>Licenses or Non-Commercial Licenses, as specified above, you may permanently<br>transfer the Materials you received pursuant to a license type listed in<br>Section 3(C) above, and all of your rights under this Agreement, to another<br>party (“Recipient”) solely in conjunction with a change of ownership, merger,<br>acquisition, sale or transfer of all, substantially all or any part of your<br>business or assets or otherwise, either voluntarily, by operation of law of<br>otherwise subject to the following: You must notify Intel of the transfer by<br>sending a letter to Intel (i) identifying the legal entities of Recipient and<br>you, (ii) identifying the Materials (i.e., the specific Intel software products)<br>and the associated serial numbers to be transferred, (iii) certifying that you<br>retain no copies of the Materials, (iv) certifying that the Recipient has agreed<br>in writing to be bound by all of the terms and conditions of this Agreement, (v)<br>certifying that the Recipient has been notified that in order to receive support<br>from Intel for the Materials they must notify Intel in writing of the transfer<br>and provide Intel with the information specified in subsection (ii) above along<br>with the name and email address of the individual assigned to use the Materials,<br>and (vi) providing your email address so that we may confirm receipt of your<br>letter.  Please send such letter to:</p><p>Intel Corporation<br>2111 NE 25th Avenue<br>Hillsboro, OR 97124<br>Attn: DPD Contracts Management, JF1-15</p><ol><li><p>COPYRIGHT: Title to the Materials, modifications thereto provided by<br>Intel and all copies thereof remain with Intel or its suppliers.  The Materials<br>are protected by intellectual property rights, including without limitation,<br>United States copyright laws and international treaty provisions.  You will not<br>remove any copyright or other proprietary notice from the Materials.  You agree<br>to prevent any unauthorized copying of the Materials.  Except as expressly<br>provided herein, no license or right is granted to you directly or by<br>implication, inducement, estoppel or otherwise; specifically Intel does not<br>grant any express or implied right to you under Intel patents, copyrights,<br>trademarks, or trade secrets.</p></li><li><p>NO WARRANTY, NO SUPPORT AND LIMITED REPLACEMENT:  THE MATERIALS AND<br>INFORMATION ARE PROVIDED “AS IS” WITH NO WARRANTIES, EXPRESS OR IMPLIED. INTEL<br>SPECIFICALLY DISCLAIMS ANY AND ALL WARRANTIES, INCLUDING WITHOUT LIMITATION,<br>ANY IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE,<br>NON-INFRINGEMENT OF INTELLECTUAL PROPERTY RIGHTS, OR ANY WARRANTY OTHERWISE<br>ARISING OUT OF ANY PROPOSAL, SPECIFICATION, OR SAMPLE.  If the media on which<br>the Materials are furnished are found to be defective in material or workmanship<br>under normal use for a period of ninety (90) days from the date of receipt,<br>Intel’s entire liability and your exclusive remedy shall be the replacement of<br>the media.  This offer is void if the media defect results from accident, abuse,<br>or misapplication.</p></li></ol><p>Intel may make changes to the Materials, or to items referenced therein, at any<br>time without notice, but is not obligated to support, update or provide training<br>for the Materials. Intel may in its sole discretion offer such support, update<br>or training services under separate terms at Intel’s then-current rates. You may<br>request additional information on Intel’s service offerings from an Intel sales<br>representative.</p><ol><li><p>LIMITATION OF LIABILITY:  NEITHER INTEL NOR ITS SUPPLIERS SHALL BE<br>LIABLE FOR ANY DAMAGES WHATSOEVER (INCLUDING, WITHOUT LIMITATION, DAMAGES FOR<br>LOSS OF BUSINESS PROFITS, BUSINESS INTERRUPTION, LOSS OF BUSINESS INFORMATION,<br>OR OTHER LOSS) ARISING OUT OF THE USE OF OR INABILITY TO USE THE SOFTWARE, EVEN<br>IF INTEL HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.  BECAUSE SOME<br>JURISDICTIONS PROHIBIT THE EXCLUSION OR LIMITATION OF LIABILITY FOR<br>CONSEQUENTIAL OR INCIDENTAL DAMAGES, THE ABOVE LIMITATION MAY NOT APPLY TO<br>YOU.</p></li><li><p>UNAUTHORIZED USE:  THE MATERIALS ARE NOT DESIGNED, INTENDED, OR<br>AUTHORIZED FOR USE IN ANY TYPE OF SYSTEM OR APPLICATION IN WHICH THE FAILURE OF<br>THE MATERIALS COULD CREATE A SITUATION WHERE PERSONAL INJURY OR DEATH MAY OCCUR<br>(e.g.,  MEDICAL SYSTEMS, LIFE SUSTAINING OR LIFE SAVING SYSTEMS).  Should you<br>use the Materials for any such unintended or unauthorized use, you hereby<br>indemnify, defend, and hold Intel and its officers, subsidiaries and affiliates<br>harmless against all claims, costs, damages, and expenses, and reasonable<br>attorney fees arising out of, directly or indirectly, such use and any claim of<br>product liability, personal injury or death associated with such unintended or<br>unauthorized use, even if such claim alleges that Intel was negligent regarding<br>the design or manufacture of the Materials.</p></li><li><p>USER SUBMISSIONS:  This Agreement does not obligate you to provide Intel<br>with materials, information, comments, suggestions or other communication<br>regarding the Materials.  However, you agree that any material, information,<br>comments, suggestions or other communication you transmit or post to an Intel<br>website (including but not limited to, submissions to the Intel Premier Support<br>and/or other customer support websites or online portals) or provide to Intel<br>under this Agreement related to the features, functions, performance or use<br>of the Materials are deemed non-confidential and non-proprietary<br>(“Communications”).  Intel will have no obligations with respect to the<br>Communications.  You hereby grant to Intel a non-exclusive, perpetual,<br>irrevocable, royalty-free, copyright license to copy, modify, create derivative<br>works, publicly display, disclose, distribute, license and sublicense through<br>multiple tiers of distribution and licensees, incorporate and otherwise use the<br>Communications and all data, images, sounds, text, and other things embodied<br>therein, including derivative works thereto, for any and all commercial or<br>non-commercial purposes. You are prohibited from posting or transmitting to or<br>from an Intel website or provide to Intel any unlawful, threatening, libelous,<br>defamatory, obscene, pornographic, or other material that would violate any law.<br>If you wish to provide Intel with information that you intend to be treated as<br>confidential information, Intel requires that such confidential information be<br>provided pursuant to a non-disclosure agreement (“NDA”), so please contact your<br>Intel representative to ensure the proper NDA is in place.</p></li></ol><p>Nothing in this Agreement will be construed as preventing Intel from reviewing<br>your Communications and errors or defects in Intel products discovered while<br>reviewing your Communications. Furthermore, nothing in this Agreement will be<br>construed as preventing Intel from implementing independently-developed<br>enhancements to Intel’s own error diagnosis methodology to detect errors or<br>defects in Intel products discovered while reviewing your Communications or to<br>implement bug fixes or enhancements in Intel products. The foregoing may include<br>the right to include your Communications in regression test suites. </p><ol><li><p>CONSENT.  You agree that Intel, its subsidiaries or suppliers may<br>collect and use technical and related information, including but not limited to<br>technical information about your computer, system and application software, and<br>peripherals, that is gathered periodically to facilitate the provision of<br>software updates, product support and other services to you (if any) related to<br>the Materials, and to verify compliance with the terms of this Agreement.  Intel<br>may use this information, as long as it is in a form that does not personally<br>identify you, to improve our products or to develop and provide services or<br>technologies to you.</p></li><li><p>TERMINATION OF THIS LICENSE: This Agreement becomes effective on the<br>date you accept this Agreement and will continue until terminated as provided<br>for in this Agreement.  If you are using the Materials under the control of a<br>time-limited license, for example an Evaluation License, this Agreement<br>terminates without notice on the last day of the time period, which is specified<br>in the Materials, and/or controlled by the license key code for the Materials.<br>Intel may terminate this license immediately if you are in breach of any of its<br>terms and conditions and such breach is not cured within thirty (30) days of<br>written notice from Intel.  Upon termination, you will immediately return to<br>Intel or destroy the Materials and all copies thereof.  In the event of<br>termination of this Agreement, the license grant to any Redistributables<br>distributed by you in accordance with the terms and conditions of this<br>Agreement, prior to the effective date of such termination, shall survive any<br>such termination of this Agreement</p></li><li><p>U.S. GOVERNMENT RESTRICTED RIGHTS: The technical data and computer<br>software covered by this license is a “Commercial Item,” as such term is defined<br>by the FAR 2.101 (48 C.F.R. 2.101) and is “commercial computer software” and<br>“commercial computer software documentation” as specified under FAR 12.212<br>(48 C.F.R. 12.212) or DFARS 227.7202 (48 C.F.R. 227.7202), as applicable. This<br>commercial computer software and related documentation is provided to end users<br>for use by and on behalf of the U.S. Government, with only those rights as are<br>granted to all other end users pursuant to the terms and conditions herein. Use<br>for or on behalf of the U.S. Government is permitted only if the party acquiring<br>or using this software is properly authorized by an appropriate U.S. Government<br>official. This use by or for the U.S. Government clause is in lieu of, and<br>supersedes, any other FAR, DFARS, or other provision that addresses Government<br>rights in the computer software or documentation covered by this license.  All<br>copyright licenses granted to the U.S. Government are coextensive with the<br>technical data and computer software licenses granted herein. The U.S.<br>Government shall only have the right to reproduce, distribute, perform, display,<br>and prepare derivative works as needed to implement those rights.</p></li><li><p>GENERAL PROVISIONS</p></li></ol><p>A.    ENTIRE AGREEMENT: This Agreement is intended to be the entire agreement<br>between you and Intel with respect to matters contained herein, and supersedes<br>all prior or contemporaneous agreements and negotiations with respect to those<br>matters.  No waiver of any breach or default shall constitute a waiver of any<br>subsequent breach or default.  If any provision of this Agreement is determined<br>by a court to be unenforceable, you and Intel will deem the provision to be<br>modified to the extent necessary to allow it to be enforced to the extent<br>permitted by law, or if it cannot be modified, the provision will be severed and<br>deleted from this Agreement, and the remainder of the Agreement will continue in<br>effect.  Any change, modification or waiver to this Agreement must be in writing<br>and signed by an authorized representative of you and an officer (or delegate)<br>of Intel, and must specifically identify this Agreement by its title (e.g.,<br>“End User License Agreement for the Intel(R) Software Development Products”) and<br>version, i.e., May 2012).</p><p>B.    APPLICABLE LAWS: Any claim arising under or relating to this Agreement<br>shall be governed by the internal substantive laws of the State of Delaware,<br>without regard to principles of conflict of laws.  You agree that the terms of<br>the United Nations Convention on Contracts for the Sale of Goods do not apply<br>to this Agreement. You agree that your distribution and export/re-export of the<br>Software and permitted modifications shall be in compliance with the laws,<br>regulations, orders or other restrictions of applicable export laws.</p><ol><li>THIRD PARTY PROGRAMS.  The Materials may include third party programs<br>or materials that are governed by the third party’s license terms, including<br>without limitation, open source software.  The license terms associated with<br>such third party programs or materials govern your use of same, and Intel is<br>not liable for such third party programs or materials.</li></ol><ul><li>Other names and brands may be claimed as the property of others</li></ul><p>-——————————————————————————-<br>Do you agree to be bound by the terms and conditions of this license agreement?<br>Type “accept” to continue or “decline” to back to the previous menu:  <font color="red"><strong>accept</strong></font> </p><h2 id="选择激活方式，选择4使用激活文件"><a href="#选择激活方式，选择4使用激活文件" class="headerlink" title="选择激活方式，选择4使用激活文件"></a>选择激活方式，选择4使用激活文件</h2><p>Step no: 3 of 7 | Activation<br>-——————————————————————————-<br>If you have purchased this product and have the serial number and a connection<br>to the internet you can choose to activate the product at this time. Activation<br>is a secure and anonymous one-time process that verifies your software licensing<br>rights to use the product. Alternatively, you can choose to evaluate the<br>product or defer activation by choosing the evaluate option. Evaluation software<br>will time out in about one month. Also you can use license file, license<br>manager, or remote activation if the system you are installing on does not<br>have internet access activation options.<br>-——————————————————————————-</p><ol><li>Use existing license [default]</li><li>I want to activate my product using a serial number</li><li>I want to evaluate my product or activate later </li><li>I want to activate either remotely, or by using a license file, or by using a<br>license manager</li></ol><p>h. Help<br>b. Back to the previous menu<br>q. Quit<br>-——————————————————————————-<br>Please type a selection or press “Enter” to accept default choice [1]: <font color="red">4</font> </p><h2 id="指定license文件"><a href="#指定license文件" class="headerlink" title="指定license文件"></a>指定license文件</h2><p>Step no: 3 of 7 | Activation &gt; Advanced activation<br>-——————————————————————————-<br>You can use license file, license manager, or the system you are installing on<br>does not have internet access activation options.<br>-——————————————————————————-</p><ol><li>Use a different computer with internet access [default]</li><li>Use a license file</li><li>Use a license server</li></ol><p>h. Help<br>b. Back to the previous menu<br>q. Quit<br>-——————————————————————————-<br>Please type a selection or press “Enter” to accept default choice [1]:  <font color="red"><strong>2</strong></font><br>Note: Press “Enter” key to back to the previous menu.<br>Please type the full path to your license file(s):<font color="red"><strong>/root/intel_eval.lic</strong></font><br>-——————————————————————————-<br>Activation completed successfully.<br>-——————————————————————————-<br>Press “Enter” key to continue:  <font color="red"><strong>回车</strong></font></p><h2 id="是否加入改进，2为不加入"><a href="#是否加入改进，2为不加入" class="headerlink" title="是否加入改进，2为不加入"></a>是否加入改进，2为不加入</h2><p>Step no: 4 of 7 | Intel(R) Software Improvement Program<br>-——————————————————————————-<br>Help improve your experience with Intel(R) software</p><p>Participate in the design of future Intel software. Select ‘Yes’ to give us<br>permission to learn about how you use your Intel software and we will do the<br>rest.</p><pre><code>- No Personal contact information is collected- There are no surveys or additional follow-up emails by opting in- You can stop participating at any timeLearn more about Intel(R) Software Improvement Programhttp://software.intel.com/en-us/articles/software-improvement-program</code></pre><p>With your permission, Intel may automatically receive anonymous information<br>about how you use your current and future Intel software.<br>-——————————————————————————-</p><ol><li>Yes, I am willing to participate and improve Intel software. (Recommended)</li><li>No, I don’t want to participate in the Intel(R) Software Improvement Program<br>at this time.</li></ol><p>b. Back to the previous menu<br>q. Quit<br>-——————————————————————————-<br>Please type a selection: <font color="red">2</font></p><h2 id="最后一次确认安装路径，可修改"><a href="#最后一次确认安装路径，可修改" class="headerlink" title="最后一次确认安装路径，可修改"></a>最后一次确认安装路径，可修改</h2><p>Step no: 5 of 7 | Options<br>-——————————————————————————-<br>You are now ready to begin installation. You can use all default installation<br>settings by simply choosing the “Start installation Now” option or you can<br>customize these settings by selecting any of the change options given below<br>first. You can view a summary of the settings by selecting<br>“Show pre-install summary”.<br>-——————————————————————————-</p><ol><li><p>Start installation Now</p></li><li><p>Change install directory      [ /opt/intel ]</p></li><li>Change components to install  [ Custom ]</li><li>Change advanced options</li><li>Show pre-install summary</li></ol><p>h. Help<br>b. Back to the previous menu<br>q. Quit<br>-——————————————————————————-<br>Please type a selection or press “Enter” to accept default choice [1]: <font color="red">回车</font></p><h2 id="检测安装环境，跳过即可"><a href="#检测安装环境，跳过即可" class="headerlink" title="检测安装环境，跳过即可"></a>检测安装环境，跳过即可</h2><p>Step no: 5 of 7 | Options &gt; Missing Optional Pre-requisite(s)<br>-——————————————————————————-<br>There are one or more optional unresolved issues. It is highly recommended to<br>resolve them all before you continue the installation. You can fix them without<br>exiting from the installation and re-check. Or you can quit from the<br>installation, fix them and run the installation again.<br>-——————————————————————————-<br>Missing optional pre-requisites<br>– Intel(R) Composer XE 2013 Update 2 for Linux<em>: No compatible Java</em> Runtime<br>Environment (JRE) found<br>-——————————————————————————-</p><ol><li>Skip missing optional pre-requisites [default]</li><li>Show the detailed info about issue(s)</li><li>Re-check the pre-requisites</li></ol><p>h. Help<br>b. Back to the previous menu<br>q. Quit<br>-——————————————————————————-<br>Please type a selection or press “Enter” to accept default choice [1]: <font color="red">回车</font></p><h2 id="开始安装-1"><a href="#开始安装-1" class="headerlink" title="开始安装"></a>开始安装</h2><p>Step no: 6 of 7 | Installation<br>-——————————————————————————-<br>Each component will be installed individually. If you cancel the installation,<br>components that have been completely installed will remain on your system. This<br>installation may take several minutes, depending on your system and the options<br>you selected.<br>-——————————————————————————-<br>Installing Intel Debugger 13.0 on Intel(R) 64 component… done<br>-——————————————————————————-<br>Finalizing installation… done<br>-——————————————————————————-</p><h2 id="安装完成"><a href="#安装完成" class="headerlink" title="安装完成"></a>安装完成</h2><p>Step no: 7 of 7 | Complete<br>-——————————————————————————-<br>Thank you for installing and using the<br>Intel(R) Parallel Studio XE 2013 Update 2 for Linux*</p><p>Reminder: Intel(R) VTune(TM) Amplifier XE users must be members of the “vtune”<br>permissions group in order to use Event-based Sampling.</p><p>To register your product purchase, visit<br><a href="https://registrationcenter.intel.com/RegCenter/registerexpress.aspx?media=5G9" target="_blank" rel="external">https://registrationcenter.intel.com/RegCenter/registerexpress.aspx?media=5G9</a></p><p>To get started using Intel(R) VTune(TM) Amplifier XE 2013 Update 4:</p><pre><code>- To set your environment variables: source</code></pre><p>/opt/intel/vtune_amplifier_xe_2013/amplxe-vars.sh</p><pre><code>- To start the graphical user interface: amplxe-gui- To use the command-line interface: amplxe-cl- For more getting started resources: /opt/intel/vtune_amplifier_xe_2013/  documentation/en/welcomepage/get_started.html.</code></pre><p>To get started using Intel(R) Inspector XE 2013 Update 4:</p><pre><code>- To set your environment variables: source</code></pre><p>/opt/intel/inspector_xe_2013/inspxe-vars.sh</p><pre><code>- To start the graphical user interface: inspxe-gui- To use the command-line interface: inspxe-cl- For more getting started resources: /opt/intel/inspector_xe_2013/  documentation/en/welcomepage/get_started.html.</code></pre><p>To get started using Intel(R) Advisor XE 2013 Update 2:</p><pre><code>- To set your environment variables: source</code></pre><p>/opt/intel/advisor_xe_2013/advixe-vars.sh</p><pre><code>- To start the graphical user interface: advixe-gui- To use the command-line interface: advixe-cl- For more getting started resources: /opt/intel/advisor_xe_2013/  documentation/en/welcomepage/get_started.html.</code></pre><p>To get started using Intel(R) Composer XE 2013 Update 2 for Linux*:</p><pre><code>- Set the environment variables for a terminal window using one of the  following (replace &quot;intel64&quot; with &quot;ia32&quot; if you are using a 32-bit  platform).  For csh/tcsh:       $ source /opt/intel/bin/compilervars.csh intel64  For bash:       $ source /opt/intel/bin/compilervars.sh intel64  To invoke the installed compilers:       For C++: icpc       For C: icc       For Fortran: ifort  To get help, append the -help option or precede with the man command.- For more getting started resources:       /opt/intel/composer_xe_2013/Documentation/en_US/get_started_lc.htm.       /opt/intel/composer_xe_2013/Documentation/en_US/get_started_lf.htm.</code></pre><p>To view movies and additional training, visit<br><a href="http://www.intel.com/software/products" target="_blank" rel="external">http://www.intel.com/software/products</a>.</p><p>-——————————————————————————-<br>q. Quit [default]<br>-——————————————————————————-<br>Please type a selection or press “Enter” to accept default choice [q]: <font color="red">回车</font></p><h2 id="设置环境变量"><a href="#设置环境变量" class="headerlink" title="设置环境变量"></a>设置环境变量</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@vm00 parallel_studio_xe_2013_update2_intel64]# source /opt/intel/bin/compilervars.sh intel64</div><div class="line">将此行内容加入到/etc/profile中，否则重启后失效</div></pre></td></tr></table></figure><h2 id="验证安装的正确性"><a href="#验证安装的正确性" class="headerlink" title="验证安装的正确性"></a>验证安装的正确性</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@vm00 parallel_studio_xe_2013_update2_intel64]# icc -v</div><div class="line">icc version 13.1.0 (gcc version 4.4.7 compatibility)</div></pre></td></tr></table></figure><p>参考链接：<a href="http://www.cnblogs.com/iDove/p/4103231.html" target="_blank" rel="external">http://www.cnblogs.com/iDove/p/4103231.html</a></p>]]></content>
      
      <categories>
          
          <category> HPC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Intel </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Centos7下Rsync服务器搭建配置</title>
      <link href="/arlo/98679d8a/"/>
      <content type="html"><![CDATA[<p>之前写了个<a href="http://islocal.cc/2017/06/16/windows-下使用expdp自动备份多用户oracle脚本">Windows下oracle多用户自动备份的脚本</a>，这个备份完数据还是存在服务器本地的，如果系统宕机的话，数据还是没有了，这样的备份是没有意义滴；所以我们需要把数据转移到其他的存储上，常用的方式是使用Rsync工具来保持同步数据，接下来我们搭建一个简单的Rsync服务器。<br><a id="more"></a></p><h1 id="安装部署rsync服务器"><a href="#安装部署rsync服务器" class="headerlink" title="安装部署rsync服务器"></a>安装部署rsync服务器</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@sftp_server ~]# yum -y install rsync</div><div class="line">[root@sftp_server ~]# mkdir -p /etc/rsyncd/</div><div class="line">[root@sftp_server ~]# touch /etc/rsyncd/rsyncd.conf</div><div class="line">[root@sftp_server ~]# ln -s /etc/rsyncd/rsyncd.conf /etc/rsyncd.conf</div></pre></td></tr></table></figure><h1 id="配置rsync服务器"><a href="#配置rsync服务器" class="headerlink" title="配置rsync服务器"></a>配置rsync服务器</h1><h2 id="主配置文件-etc-rsyncd-conf"><a href="#主配置文件-etc-rsyncd-conf" class="headerlink" title="主配置文件/etc/rsyncd.conf"></a>主配置文件/etc/rsyncd.conf</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">[root@sftp_server ~]# cat /etc/rsyncd.conf </div><div class="line">uid = root                         </div><div class="line">gid = root                                  </div><div class="line">use chroot = yes                             </div><div class="line">hosts allow=192.168.10.33/24</div><div class="line">hosts deny=*</div><div class="line">max connections=5</div><div class="line">pid file = /var/run/rsyncd.pid </div><div class="line">secrets file = /etc/rsyncd/rsyncd.secrets </div><div class="line">motd file = /etc/rsyncd/rsyncd.motd  </div><div class="line">log file = /var/log/rsync.log</div><div class="line">transfer logging = yes  </div><div class="line">log format = %t %a %m %f %b</div><div class="line">syslog facility = local3</div><div class="line">timeout = 300</div><div class="line"></div><div class="line"></div><div class="line">[db_backup]                               </div><div class="line">path = /data/backup/                       </div><div class="line">list=yes                                   </div><div class="line">read only = no    </div><div class="line">ignore errors                              </div><div class="line">auth users = rdatabase                          </div><div class="line">comment = Oracle Database Backup</div></pre></td></tr></table></figure><h2 id="密码验证文件-etc-rsyncd-rsyncd-secrets"><a href="#密码验证文件-etc-rsyncd-rsyncd-secrets" class="headerlink" title="密码验证文件/etc/rsyncd/rsyncd.secrets"></a>密码验证文件/etc/rsyncd/rsyncd.secrets</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@sftp_server ~]# cat /etc/rsyncd/rsyncd.secrets </div><div class="line">rdatabase:sss</div><div class="line">[root@sftp_server ~]# chown root.root /etc/rsyncd/rsyncd.secrets</div><div class="line">[root@sftp_server ~]# chmod 600 /etc/rsyncd/rsyncd.secrets</div></pre></td></tr></table></figure><h2 id="欢迎提示信息文件-etc-rsyncd-rsyncd-motd"><a href="#欢迎提示信息文件-etc-rsyncd-rsyncd-motd" class="headerlink" title="欢迎提示信息文件/etc/rsyncd/rsyncd.motd"></a>欢迎提示信息文件/etc/rsyncd/rsyncd.motd</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@sftp_server ~]# cat /etc/rsyncd/rsyncd.motd</div><div class="line">+++++++++++++++++++++++++++</div><div class="line">+ Oracle Database Backup! +</div><div class="line">+++++++++++++++++++++++++++</div></pre></td></tr></table></figure><h2 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@sftp_server ~]# systemctl start rsyncd.service</div><div class="line">[root@sftp_server ~]# systemctl enable rsyncd.service</div></pre></td></tr></table></figure><h2 id="防火墙配置"><a href="#防火墙配置" class="headerlink" title="防火墙配置"></a>防火墙配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">firewall-cmd --zone=public --add-port=873/tcp --permanent</div><div class="line">firewall-cmd --zone=public --add-service=rsyncd --permanent</div><div class="line">firewall-cmd --reload</div></pre></td></tr></table></figure><h1 id="客户端配置"><a href="#客户端配置" class="headerlink" title="客户端配置"></a>客户端配置</h1><p>有几个细节地方需要主机</p><ol><li>rsync命令执行的时候，前边的是src(源)，后边的是dest(目标)</li><li>路径后有/只会同步目录下的内容，路径后没有/，会把当前目录（路径的最后一层）同步过去 </li></ol><h2 id="linux客户端配置"><a href="#linux客户端配置" class="headerlink" title="linux客户端配置"></a>linux客户端配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># yum install -y rsync</div><div class="line">[airmodel@silu ~]$ rsync -avzP /tmp/data/ rdatabase@192.168.6.23::db_backup  #把本机/tmp/data/目录下的内容同步到rsync服务器db_backup模块配置的目录中去，如果要将rsync服务器上内容同步至本机，路径位置换一下即可</div></pre></td></tr></table></figure><h2 id="windows-客户端配置"><a href="#windows-客户端配置" class="headerlink" title="windows 客户端配置"></a>windows 客户端配置</h2><ol><li>下载free版本的cwrsync软件 <a href="https://itefix.net/cwrsync" target="_blank" rel="external">https://itefix.net/cwrsync</a> </li><li>在c盘根目录新建一个密码文件password.rsync，内容为sss（这里写的密码和rsync服务器上的要对应，只写密码，不需要用户名）</li><li>cwrsync不识别Windows路径，C盘需要写为/cygdrive/c，E盘需要写为/cygdrive/e</li><li>新建一个计划任务，实现自动化备份，操作可以参考以下示例<br>以下实例内容为：将本地E:\database_backup\目录下的内容同步至rsync服务的db_backup模块中定义的路径中去，密码文件为C:\password.rsync </li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">C:\cwRsync_5.5.0_x86_Free\bin\rsync.exe -azvP --password-file=/cygdrive/c/password.rsync /cygdrive/e/database_backup/ rdatabase@192.168.6.23::db_backup</div></pre></td></tr></table></figure><h1 id="更优方式"><a href="#更优方式" class="headerlink" title="更优方式"></a>更优方式</h1><p>linux下可以部署inotify+rsync，实现实时同步数据</p><hr>]]></content>
      
      <categories>
          
          <category> 常识 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rsync </tag>
            
            <tag> 同步 </tag>
            
            <tag> 备份 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Aansible palybook 创建lvm并自动挂载</title>
      <link href="/arlo/1e1aab57/"/>
      <content type="html"><![CDATA[<p>由于工作中经常会遇到添加磁盘，分区，挂载这种操作，使用ansible后再也不用一台台的搞了；主要使用到lvg，lvol，filesystem，mount模块；<br><a id="more"></a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">- hosts: test</div><div class="line">  vars:</div><div class="line">    vg_name: &quot;vgtest&quot;</div><div class="line">    lv_name: &quot;lvtest&quot;</div><div class="line">    pvs_name: &quot;/dev/sdb&quot;</div><div class="line">    dir_path: &quot;/data&quot;</div><div class="line">  tasks:</div><div class="line">    - name: 创建一个vg</div><div class="line">      lvg: </div><div class="line">        vg: &quot;&#123;&#123;vg_name&#125;&#125;&quot; </div><div class="line">        pvs: &quot;&#123;&#123;pvs_name&#125;&#125;&quot;</div><div class="line">        pesize: 4</div><div class="line">    - name: 创建一个lv </div><div class="line">      lvol:</div><div class="line">        vg: &quot;&#123;&#123;vg_name&#125;&#125;&quot;</div><div class="line">        lv: &quot;&#123;&#123;lv_name&#125;&#125;&quot;</div><div class="line">        size: 100%PVS</div><div class="line">    - name: 格式化lv</div><div class="line">      filesystem: </div><div class="line">        fstype: ext4 </div><div class="line">        dev: &quot;/dev/&#123;&#123;vg_name&#125;&#125;/&#123;&#123;lv_name&#125;&#125;&quot;</div><div class="line">    - name: 获取UUID</div><div class="line">      shell: blkid /dev/&quot;&#123;&#123;vg_name&#125;&#125;&quot;/&quot;&#123;&#123;lv_name&#125;&#125;&quot; |awk &apos;&#123;print $2&#125;&apos;</div><div class="line">      register: result</div><div class="line">      ignore_errors: True</div><div class="line">    - name: 创建挂载目录 </div><div class="line">      file: </div><div class="line">        path: &quot;&#123;&#123;dir_path&#125;&#125;&quot;</div><div class="line">        state: directory</div><div class="line">        mode: 0755</div><div class="line">    - name: 使用UUID挂载lvm分区 </div><div class="line">      mount: </div><div class="line">         path: /data</div><div class="line">         src:  &quot;&#123;&#123;result.stdout&#125;&#125;&quot;</div><div class="line">         fstype: ext4</div><div class="line">         state: mounted</div></pre></td></tr></table></figure></p><p>由于我一直习惯使用UUID挂载分区（UUID是每个分区的唯一标识），所以我加了一步获取UUID的操作，这步也可以略去，挂载的时候使用分区名称进行挂载；还有一点就是使用lvm分区的时候，将整个磁盘做成pv是不需要进行分区操作的，这点比较方便；如果要做分区操作的话，可以使用以下playbook：<br><figure class="highlight plain"><figcaption><span>hosts: test</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">vars:</div><div class="line">  dev_name1: &quot;/dev/sdb&quot;</div><div class="line">  dev_name2: &quot;/dev/sdb1&quot;</div><div class="line">tasks:</div><div class="line">  - name: Disk Partition    </div><div class="line">    shell : fdisk &quot;&#123;&#123;dev_name1&#125;&#125;&quot; &lt; /tmp/fdisk_temp.conf  </div><div class="line">  - name: Disk Mkfs ext4    </div><div class="line">    filesystem: </div><div class="line">      fstype: ext4 </div><div class="line">      dev: &quot;&#123;&#123;dev_name2&#125;&#125;&quot;</div><div class="line">  - name: Disk Mount    </div><div class="line">    shell: blkid /dev/sdb1 |awk &apos;&#123;print $2&#125;&apos;| sed -n &apos;s/$/     \/data     ext4     defaults     0 0/p&apos; &gt;&gt; /etc/fstab &amp;&amp; mount -a</div></pre></td></tr></table></figure></p><p>受控机/tmp/fdisk_temp.conf内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">n</div><div class="line">p</div><div class="line">1</div><div class="line">1</div><div class="line"></div><div class="line">w</div><div class="line">q</div></pre></td></tr></table></figure></p>]]></content>
      
      <categories>
          
          <category> 自动化运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 自动化 </tag>
            
            <tag> 运维 </tag>
            
            <tag> Ansible </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Ansible Playbook入门篇</title>
      <link href="/arlo/45b10f7e/"/>
      <content type="html"><![CDATA[<p>playbook 是由一组ansible调用module命令的集合，使用yaml语言编写，执行顺序自上而下；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">命令格式：ansible-playbook test.yml</div></pre></td></tr></table></figure></p><a id="more"></a><h1 id="Playbook-组成"><a href="#Playbook-组成" class="headerlink" title="Playbook 组成"></a>Playbook 组成</h1><p><strong>Target section: 定义将要执行playbook的远程主机组</strong>  </p><ul><li>name：执行过程中会打印出来变量的值</li><li>hosts：定义远程的主机组</li><li>user：执行该任务组的用户</li><li>remote_user: 与user一样，任选其一</li><li>sudo：如果设置为yes，执行该任务组的用户在执行任务的时候获取root权限</li><li>sudo_user：如果sudo设置为yes，user设置为user1，sudo_user设置为user2，那么user1会获取user2权限</li><li>connection：通过什么方式连接到远程主机，默认是ssh</li><li>gather_facts：除非明确定义不需要在远程主机上执行setup模块，否则会默认自动执行；不需要执行setup模块，需False该选项。  </li></ul><p><strong>Variable section：定义playbook运行时需要使用的变量</strong>  </p><ul><li>vars：格式为“变量名称:变量值”</li><li>vars_files：将变量名称和变量值定义在一个文件中，调用该文件，文件格式为每行一个“变量名称:变量值”</li><li>vars_prompt：定义一个变量，通过交互方式让用户输入变量值  </li></ul><p><strong>Task section：定义将要在远程主机上执行的任务列表</strong>  </p><ul><li>tasks： #三种写法如下  </li></ul><ol><li>调用模块<br>name: 定义名称<br>action：模块名称 模块参数调用</li><li>直接使用模块<br>name: 定义名称<br>模块名称：调用方法</li><li>模块使用<br>name：定义名称<br>模块名称：<br>模块参数调用  </li></ol><p><strong>Handler section：定义task执行完成以后需要调用的任务</strong><br>满足一下两点才能达到触发的效果，否则会不生效。</p><ol><li>必须在tasks中使用notify调用</li><li>在notify中定义内容一定要和tasks中定义的 - name 内容一样  </li></ol><h1 id="新建用户的示例"><a href="#新建用户的示例" class="headerlink" title="新建用户的示例"></a>新建用户的示例</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# cat test.yaml </div><div class="line">- name: &quot;新建用户&quot;</div><div class="line">  hosts: test</div><div class="line">  user: root</div><div class="line">  vars:</div><div class="line">    user: &quot;user3&quot;</div><div class="line">    password: &quot;$1$01a9gEpb$nlv.OmSa1c4jDaGgeoDKi0&quot;   #加密后的密码，可以参考上篇文章中user模块使用</div><div class="line">    uid: &quot;700&quot;</div><div class="line">  tasks:</div><div class="line">    - name: &quot;新建用户&quot;</div><div class="line">      user: name=&quot;&#123;&#123;user&#125;&#125;&quot; password=&quot;&#123;&#123;password&#125;&#125;&quot; uid=&quot;&#123;&#123;uid&#125;&#125;&quot;</div><div class="line">#      user: name=&quot;&#123;&#123;user&#125;&#125;&quot; state=absent remove=yes    #删除用户的话就使用这行</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible-playbook test.yaml</div></pre></td></tr></table></figure><p><img src="/images/2017/0622/00.png" alt="playbook"></p><h1 id="修改selinux，安装epel扩展包"><a href="#修改selinux，安装epel扩展包" class="headerlink" title="修改selinux，安装epel扩展包"></a>修改selinux，安装epel扩展包</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# cat test2.yml</div><div class="line">- hosts: test</div><div class="line">  vars:</div><div class="line">    packages: &quot;epel-release&quot;</div><div class="line">  tasks:</div><div class="line">    - name: &quot;永久关闭selinux&quot;</div><div class="line">      command: sed -i s/SELINUX=enforcing/SELINUX=disabled/g /etc/selinux/config</div><div class="line">    - name: &quot;安装epel扩展包&quot;</div><div class="line">      yum: name=&#123;&#123;packages&#125;&#125; state=present</div><div class="line">      notify:</div><div class="line">      - reboot system</div><div class="line">  handlers:</div><div class="line">    - name: reboot system</div><div class="line">      command: reboot</div></pre></td></tr></table></figure><p>参考链接：<a href="http://breezey.blog.51cto.com/2400275/1757624" target="_blank" rel="external">http://breezey.blog.51cto.com/2400275/1757624</a></p>]]></content>
      
      <categories>
          
          <category> 自动化运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 自动化 </tag>
            
            <tag> 运维 </tag>
            
            <tag> Ansible </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Ansible 模块篇</title>
      <link href="/arlo/7a718f23/"/>
      <content type="html"><![CDATA[<p>Ansible 之所以能自动化完成这么多操作，都是依赖于丰富的模块；类似Jenkins软件的强大的插件支持</p><p>查看模块<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible-doc -l</div></pre></td></tr></table></figure></p><p>查看模块参数用法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible-doc -s module</div><div class="line">[root@vm00 ~]# ansible-doc help module</div></pre></td></tr></table></figure></p><p>ansible 命令格式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible 主机或组-m 模块名-a &apos;模块参数&apos;</div></pre></td></tr></table></figure></p><a id="more"></a><h1 id="command-模块"><a href="#command-模块" class="headerlink" title="command 模块"></a>command 模块</h1><p><strong>默认缺省模块</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible all -m command -a &quot;/bin/echo &apos;hello,sir.&apos;&quot;</div><div class="line">[root@vm00 ~]# ansible all -a &apos;chdir=/usr/local/src/ tar -cvzf test.tgz file&apos;</div></pre></td></tr></table></figure></p><h1 id="shell-模块"><a href="#shell-模块" class="headerlink" title="shell 模块"></a>shell 模块</h1><p>和command一样；支持管道<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible test -m shell -a &apos;ps -ef |grep java&apos;</div></pre></td></tr></table></figure></p><h1 id="raw-模块"><a href="#raw-模块" class="headerlink" title="raw 模块"></a>raw 模块</h1><p>和command一样；支持管道</p><h1 id="ping-模块"><a href="#ping-模块" class="headerlink" title="ping 模块"></a>ping 模块</h1><p>测试主机连通性，没有参数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible all -m ping</div></pre></td></tr></table></figure></p><h1 id="setup-模块"><a href="#setup-模块" class="headerlink" title="setup 模块"></a>setup 模块</h1><p>查看主机参数配置<br>filter 过滤参数，相当于grep功能<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible vm02 -m setup</div></pre></td></tr></table></figure></p><p>将所有主机的信息输入到/tmp/facts目录下，每台主机的信息输入到主机名文件中（/etc/ansible/hosts里的主机名）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible all -m setup --tree /tmp/facts</div></pre></td></tr></table></figure></p><p>获取主机ip地址<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible vm02 -m setup -a &apos;filter=ansible_default_ipv4&apos;</div></pre></td></tr></table></figure></p><p>获取主机内存使用情况<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible vm02 -m setup -a &apos;filter=ansible_memory_mb&apos;</div></pre></td></tr></table></figure></p><p>获取主机名<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible vm02 -m setup -a &apos;filter=ansible_nodename&apos;</div></pre></td></tr></table></figure></p><h1 id="file-模块"><a href="#file-模块" class="headerlink" title="file 模块"></a>file 模块</h1><p>file模块主要用于远程主机上的文件操作，file模块包含如下选项：<br>force：需要在两种情况下强制创建软链接，一种是源文件不存在但之后会建立的情况下；另一种是目标软链接已存在,需要先取消之前的软链，然后创建新的软链，有两个选项：yes|no<br>group：定义文件/目录的属组<br>mode：定义文件/目录的权限<br>owner：定义文件/目录的属主<br>path：必选项，定义文件/目录的路径<br>recurse：递归的设置文件的属性，只对目录有效<br>src：要被链接的源文件的路径，只应用于state=link的情况<br>dest：被链接到的路径，只应用于state=link的情况<br>state：  </p><ul><li>directory：如果目录不存在，创建目录</li><li>file：即使文件不存在，也不会被创建</li><li>link：创建软链接</li><li>hard：创建硬链接</li><li>touch：如果文件不存在，则会创建一个新的文件，如果文件或目录已存在，则更新其最后修改时间</li><li>absent：删除目录、文件或者取消链接文件</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible nsxq -m file -a &apos;src=/etc/hosts dest=/tmp/hosts&apos;</div><div class="line">[root@vm00 ~]# ansible nsxq -a &apos;ls -lh /tmp/hosts&apos;</div><div class="line">[root@vm00 ~]# ansible nsxq -m file -a &quot;path=/tmp/file1 state=touch&quot;</div><div class="line">[root@vm00 ~]# ansible nsxq -m file -a &quot;dest=/tmp/hosts mode=600 owner=airmodel group=airmodel&quot;</div><div class="line">[root@vm00 ~]# ansible nsxq -m file -a &quot;dest=/opt/test mode=755 owner=airmodel group=airmodel state=directory&quot;</div></pre></td></tr></table></figure><h1 id="copy模块"><a href="#copy模块" class="headerlink" title="copy模块"></a>copy模块</h1><p>复制文件到远程主机，copy模块包含如下选项：<br>backup：在覆盖之前将原文件备份，备份文件包含时间信息。有两个选项：yes|no<br>content：用于替代”src”,可以直接设定指定文件的值<br>dest：必选项。要将源文件复制到的远程主机的绝对路径，如果源文件是一个目录，那么该路径也必须是个目录<br>directory_mode：递归的设定目录的权限，默认为系统默认权限<br>force：如果目标主机包含该文件，但内容不同，如果设置为yes，则强制覆盖，如果为no，则只有当目标主机的目标位置不存在该文件时，才复制。默认为yes<br>others：所有的file模块里的选项都可以在这里使用<br>src：要复制到远程主机的文件在本地的地址，可以是绝对路径，也可以是相对路径。如果路径是一个目录，它将递归复制。在这种情况下，如果路径使用”/“来结尾，则只复制目录里的内容，如果没有使用”/“来结尾，则包含目录在内的整个内容全部复制，类似于rsync。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible nsxq -m copy -a &quot;src=/etc/hosts dest=/tmp/hosts&quot;</div><div class="line">[root@vm00 ~]# ansible test -m copy -a &apos;src=/etc/fstab dest=/tmp/fstab owner=airmodel group=airmodel mode=644 backup=yes&apos;</div></pre></td></tr></table></figure></p><h1 id="service-模块"><a href="#service-模块" class="headerlink" title="service 模块"></a>service 模块</h1><p>管理服务，该模块包含如下选项：<br>arguments：给命令行提供一些选项<br>enabled：是否开机启动 yes|no<br>name：必选项，服务名称<br>pattern：定义一个模式，如果通过status指令来查看服务的状态时，没有响应，就会通过ps指令在进程中根据该模式进行查找，如果匹配到，则认为该服务依然在运行<br>runlevel：运行级别<br>sleep：如果执行了restarted，在则stop和start之间沉睡几秒钟<br>state：对当前服务执行启动，停止、重启、重新加载等操作（started,stopped,restarted,reloaded）<br>ansible nsxq -m service -a ‘name=nginx state=started enabled=yes’<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible test -m service -a &apos;name=httpd state=started enabled=yes&apos;</div></pre></td></tr></table></figure></p><h1 id="cron-模块"><a href="#cron-模块" class="headerlink" title="cron 模块"></a>cron 模块</h1><p>用于管理计划任务包含如下选项：<br>backup：对远程主机上的原任务计划内容修改之前做备份<br>cron_file：如果指定该选项，则用该文件替换远程主机上的cron.d目录下的用户的任务计划<br>day：日（1-31，<em>，</em>/2,……）<br>hour：小时（0-23，<em>，</em>/2，……）<br>minute：分钟（0-59，<em>，</em>/2，……）<br>month：月（1-12，<em>，</em>/2，……）<br>weekday：周（0-7，<em>，……）<br>job：要执行的任务，依赖于state=present<br>name：该任务的描述<br>special_time：指定什么时候执行，参数：reboot,yearly,annually,monthly,weekly,daily,hourly<br>state：确认该任务计划是创建还是删除<br>user：以哪个用户的身份执行<br>时间不特意指定的话，默认是 </em> <em> </em> <em> </em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible nsxq -m cron -a &apos;name=&quot;update ntp time&quot; hour=2 user=root job=&quot;/usr/sbin/ntpdate cn.ntp.org.cn&quot;&apos;</div><div class="line">[root@vm00 ~]# ansible nsxq -m cron -a &apos;name=&quot;update ntp time&quot; state=absent&apos;</div><div class="line">[root@vm00 ~]# ansible test -m cron -a &quot;name=&apos;show date&apos; job=&apos;/root/test.sh&apos; backup=&apos;True&apos; hour=2 minute=*/5&quot;</div></pre></td></tr></table></figure></p><h1 id="yum-模块"><a href="#yum-模块" class="headerlink" title="yum 模块"></a>yum 模块</h1><p>使用yum包管理器来管理软件包，其选项有：<br>config_file：yum的配置文件<br>disable_gpg_check：关闭gpg_check<br>disablerepo：不启用某个源<br>enablerepo：启用某个源<br>name：要进行操作的软件包的名字，也可以传递一个url或者一个本地的rpm包的路径<br>state：状态（present，absent，latest，installed）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible nsxq -m yum a &apos;name=httpd state=latest&apos;</div><div class="line">[root@vm00 ~]# ansible nsxq -m yum a &apos;name=&quot;@Development Tools&quot; state=present&apos;</div><div class="line">卸载操作</div><div class="line">[root@vm00 ~]# ansible test -m yum -a &quot;name=httpd state=absent&quot;</div></pre></td></tr></table></figure></p><h1 id="user模块"><a href="#user模块" class="headerlink" title="user模块"></a>user模块</h1><p>user模块是请求的是useradd, userdel, usermod三个指令。</p><p>home：指定用户的家目录，需要与createhome配合使用<br>groups：指定用户的属组<br>uid：指定用的uid<br>password：指定用户的密码<br>name：指定用户名<br>createhome：是否创建家目录 yes|no<br>system：是否为系统用户<br>remove：当state=absent时，remove=yes则表示连同家目录一起删除，等价于userdel -r<br>state：是创建还是删除<br>shell：指定用户的shell环境<br>指定password的时候，需要指定加密后的密码，明文会直接写到/etc/shadow文件中，用户无法登陆<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# echo &quot;ffffff&quot; | openssl passwd -1 -salt $(&lt; /dev/urandom tr -dc &apos;[:alnum:]&apos; | head -c 32) -stdin</div><div class="line">[root@vm00 ~]# ansible test -m user -a &apos;createhome=yes home=/home/user1 password=&quot;$1$01a9gEpb$nlv.OmSa1c4jDaGgeoDKi0&quot; name=user1 state=present shell=/bin/bash&apos;</div><div class="line">[root@vm00 ~]# ansible test -m user -a &apos;name=user1 state=absent remove=yes&apos;</div></pre></td></tr></table></figure></p><h1 id="group-模块"><a href="#group-模块" class="headerlink" title="group 模块"></a>group 模块</h1><p>goup模块请求的是groupadd, groupdel, groupmod 三个指令。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible test -m group -a &apos;name=group1 gid=700 state=present&apos;</div></pre></td></tr></table></figure></p><h1 id="synchronize-模块"><a href="#synchronize-模块" class="headerlink" title="synchronize 模块"></a>synchronize 模块</h1><p>使用rsync同步文件，其参数如下：<br>archive: 归档，相当于同时开启recursive(递归)、links、perms、times、owner、group、-D选项都为yes ，默认该项为开启<br>checksum: 跳过检测sum值，默认关闭<br>compress:是否开启压缩<br>copy_links：复制链接文件，默认为no ，注意后面还有一个links参数<br>delete: 删除不存在的文件，默认no<br>dest：目录路径<br>dest_port：默认目录主机上的端口 ，默认是22，走的ssh协议<br>dirs：传速目录不进行递归，默认为no，即进行目录递归<br>rsync_opts：rsync参数部分<br>set_remote_user：主要用于/etc/ansible/hosts中定义或默认使用的用户与rsync使用的用户不同的情况<br>mode: push或pull 模块，缺省模式是push；push模的话，一般用于从本机向远程主机上传文件，push的时候src是本机上的文件或目录; pull 模式用于从远程主机上取文件；pull的时候src是目标主机上的文件或目录<br>目录后边跟/表示同步目录下内容，不加/把目录同步过去<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible test -m synchronize -a &apos;src=/etc/hosts dest=/tmp mode=push&apos;</div><div class="line">[root@vm00 ~]# ansible test -m synchronize -a &apos;src=/etc/fstab dest=/tmp mode=pull&apos;</div></pre></td></tr></table></figure></p><h1 id="filesystem-模块"><a href="#filesystem-模块" class="headerlink" title="filesystem 模块"></a>filesystem 模块</h1><p>在块设备上创建文件系统<br>选项：<br>dev：目标块设备<br>force：在一个已有文件系统 的设备上强制创建<br>fstype：文件系统的类型<br>opts：传递给mkfs命令的选项<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible test -a &apos;dd if=/dev/zero of=/abc.img bs=4k count=10000&apos;</div><div class="line">[root@vm00 ~]# ansible test -a &apos;losetup /dev/loop0 /abc.img&apos;</div><div class="line">[root@vm00 ~]# ansible test -m filesystem -a &apos;fstype=ext4 dev=/dev/loop0 force=yes opts=-F&apos;</div></pre></td></tr></table></figure></p><h1 id="mount-模块"><a href="#mount-模块" class="headerlink" title="mount 模块"></a>mount 模块</h1><p>配置挂载点<br>选项：<br>dump<br>fstype：必选项，挂载文件的类型<br>name：必选项，挂载点<br>opts：传递给mount命令的参数<br>src：必选项，要挂载的文件<br>state：必选项 </p><ul><li>present：只处理fstab中的配置 </li><li>absent：删除挂载点 </li><li>mounted：自动创建挂载点并挂载之 </li><li>umounted：卸载</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# ansible test -m mount -a &apos;name=/opt/abc src=/abc.img fstype=ext4 opts=loop state=mounted&apos;</div></pre></td></tr></table></figure><p>模块的参数太多了，这篇文章基本上是copy过来的，这里贴一下出处：<a href="http://breezey.blog.51cto.com/2400275/1555530" target="_blank" rel="external">http://breezey.blog.51cto.com/2400275/1555530</a></p>]]></content>
      
      <categories>
          
          <category> 自动化运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 自动化 </tag>
            
            <tag> 运维 </tag>
            
            <tag> Ansible </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Ansible 入门篇</title>
      <link href="/arlo/40fad05f/"/>
      <content type="html"><![CDATA[<p>Ansible (is Simple IT Automation) ,是一款自动化运维工具，基于强大的模块功能通过SSH协议推送到被管理端，可以实现的批量系统部署，批量程序部署，批量执行命令等</p><p><strong>特性</strong></p><ul><li>不需要安装客户端，基于ssh连接管理</li><li>不需要配置服务，安装Ansible工具，可以执行命令就可以</li><li>拥有大量的模块</li><li>支持YAML语法</li><li>安装配置简单(门槛低)</li><li>被管理机器支持Windows</li></ul><p><strong>组成部分</strong></p><ul><li>Ansible 核心</li><li>Inventory Ansible管理主机的清单</li><li>Modules 包括Ansible自带的核心模块和自定义模块</li><li>Plugins 完成模块功能的补充，包括连接插件、邮件插件等</li><li>Playbooks 编排文件，定义Ansible多任务配置文件，实现Ansible自动执行<a id="more"></a></li></ul><h1 id="安装ansible软件"><a href="#安装ansible软件" class="headerlink" title="安装ansible软件"></a>安装ansible软件</h1><p>需要主机有python环境，这个安装没啥说的，一键搞定，so easy！<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install ansible</div></pre></td></tr></table></figure></p><h1 id="配置管理主机清单"><a href="#配置管理主机清单" class="headerlink" title="配置管理主机清单"></a>配置管理主机清单</h1><p>默认的主机清单文件是/etc/ansible/hosts </p><ol><li>可以修改/etc/ansible/ansible.cfg文件中[defaults]下的#inventory参数来修改，</li><li>可以在执行命令时候使用-i参数来指定hosts文件</li></ol><h2 id="最简单的配置主机和组"><a href="#最简单的配置主机和组" class="headerlink" title="最简单的配置主机和组"></a>最简单的配置主机和组</h2><p>配置成主机名的时候，要确保主机名可以被解析(hosts或dns)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[web]</div><div class="line">vm01</div><div class="line">vm02</div><div class="line">[db]</div><div class="line">192.168.6.100</div><div class="line">192.168.6.101</div></pre></td></tr></table></figure></p><h2 id="自定义参数"><a href="#自定义参数" class="headerlink" title="自定义参数"></a>自定义参数</h2><p>ansible_ssh_user 用于指定管理远程主机的账号<br>ansible_ssh_pass 用于指定管理远程主机的密码<br>ansible_ssh_host 用于指定被管理的主机<br>ansible_ssh_port 用于指定ssh的端口<br>ansible_sudo_pass 用于sudo连接用户时的密码<br>ansible_sudo_exec 如果sudo命令不在默认路径，需要指定sudo命令路径<br>ansible_shell_type 目标系统的shell的类型，默认sh<br>ansible_ssh_private_key_file 指定key文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[webservers]</div><div class="line">192.168.10.12  ansible_ssh_pass=123456 ansible_ssh_user=root</div><div class="line">192.168.10.13  ansible_ssh_pass=123456 ansible_ssh_user=root ansible_ssh_port=3055</div><div class="line">vm03 ansible_ssh_pass=123567 ansible_ssh_user=root</div></pre></td></tr></table></figure></p><h2 id="指定主机范围"><a href="#指定主机范围" class="headerlink" title="指定主机范围"></a>指定主机范围</h2><p>01:20 表示192.168.6.1到192.168.6.20共20台主机<br>a:f   表示dba.islocal.cc 到dbf.islocal.cc共6台主机<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[db]</div><div class="line">192.168.6.[01:20]</div><div class="line">db[a:f].islocal.cc</div></pre></td></tr></table></figure></p><h2 id="主机组嵌套，"><a href="#主机组嵌套，" class="headerlink" title="主机组嵌套，"></a>主机组嵌套，</h2><p>使用children关键字<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[mfs:children]</div><div class="line">mfs_a</div><div class="line">mfs_b</div><div class="line">mfs_c</div><div class="line">[mfs_a]</div><div class="line">vm01</div><div class="line">[mfs_b]</div><div class="line">vm02</div><div class="line">[mfs_c]</div><div class="line">vm03</div></pre></td></tr></table></figure></p><p>测试一下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ansible mfs -m ping</div><div class="line">ansible mfs_c -m ping</div></pre></td></tr></table></figure></p><h2 id="调用匹配主机或主机组"><a href="#调用匹配主机或主机组" class="headerlink" title="调用匹配主机或主机组"></a>调用匹配主机或主机组</h2><h3 id="匹配所有"><a href="#匹配所有" class="headerlink" title="匹配所有"></a>匹配所有</h3><p>all 或者 *<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible all -m ping</div></pre></td></tr></table></figure></p><h3 id="匹配组"><a href="#匹配组" class="headerlink" title="匹配组"></a>匹配组</h3><p>直接写组名就ok<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible test -m ping</div></pre></td></tr></table></figure></p><h3 id="逻辑非"><a href="#逻辑非" class="headerlink" title="逻辑非"></a>逻辑非</h3><p>目标主机在nsxq组不在test组中，逻辑非使用！<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible nsxq:!test -m ping</div></pre></td></tr></table></figure></p><h3 id="逻辑与"><a href="#逻辑与" class="headerlink" title="逻辑与"></a>逻辑与</h3><p>目标主机在nsxq组并在test中，逻辑与使用&amp;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible nsxq:&amp;test -m ping</div></pre></td></tr></table></figure></p><h3 id="支持正则匹配"><a href="#支持正则匹配" class="headerlink" title="支持正则匹配"></a>支持正则匹配</h3><p>匹配一web或者db开头.islocal.cc 的主机<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ansible ~(web|db).*\.islocal\.cc -m ping</div></pre></td></tr></table></figure></p><h1 id="设置主机互信，配置SSH免密码登录"><a href="#设置主机互信，配置SSH免密码登录" class="headerlink" title="设置主机互信，配置SSH免密码登录"></a>设置主机互信，配置SSH免密码登录</h1><p>由于ansible是基于ssh来远程管理，执行操作命令的，每次输入密码的话会很繁琐，配置ssh免密码就显得很方便</p><ol><li>-k 命令会提示输入密码</li><li>修改配置文件/etc/ansible/ansible.cfg<br>host_key_checking=False   #当第一次连接远程主机时，会提示输入yes/no,跳过此环节</li></ol><p>配置ssh免密码登录，可以参考我之前的另一篇文章<strong><a href="http://islocal.cc/2017/06/18/批量修改主机密码-批量ssh免密码验证/">SSH免密码验证</a></strong></p><h1 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h1><p>查看模块<br>ansible-doc -l<br>查看模块参数用法<br>ansible-doc -s module<br>ansible-doc help module</p><h2 id="setup-模块"><a href="#setup-模块" class="headerlink" title="setup 模块"></a>setup 模块</h2><p>查看主机参数配置<br>ansible all -m setup</p><h2 id="ping-模块"><a href="#ping-模块" class="headerlink" title="ping 模块"></a>ping 模块</h2><p>测试主机连通性<br>ansible all -m ping</p><h2 id="file-模块"><a href="#file-模块" class="headerlink" title="file 模块"></a>file 模块</h2><p>[root@vm00 ~]# ansible nsxq -m file -a ‘src=/etc/hosts dest=/tmp/hosts’<br>[root@vm00 ~]# ansible nsxq -a ‘ls -lh /tmp/hosts’<br>[root@vm00 ~]# ansible nsxq -m file -“path=/tmp/file1 state=touch”<br>[root@vm00 ~]# ansible nsxq -m file -a “dest=/tmp/hosts mode=600 owner=airmodel group=airmodel”<br>[root@vm00 ~]# ansible nsxq -m file -a “dest=/opt/test mode=755 owner=airmodel group=airmodel state=directory”</p><h2 id="copy模块"><a href="#copy模块" class="headerlink" title="copy模块"></a>copy模块</h2><p>ansible nsxq -m copy -a “src=/etc/hosts dest=/tmp/hosts” </p><h2 id="command-模块【默认模块】"><a href="#command-模块【默认模块】" class="headerlink" title="command 模块【默认模块】"></a>command 模块【默认模块】</h2><p>ansible all -m command -a “/bin/echo ‘hello,sir.’”<br>ansible all -a ‘chdir=/usr/local/src/ tar -cvzf test.tgz file’</p><h2 id="shell-模块"><a href="#shell-模块" class="headerlink" title="shell 模块"></a>shell 模块</h2><p>和command一样；支持管道</p><h2 id="raw-模块"><a href="#raw-模块" class="headerlink" title="raw 模块"></a>raw 模块</h2><p>和command一样</p><h2 id="service-模块"><a href="#service-模块" class="headerlink" title="service 模块"></a>service 模块</h2><p>ansible nsxq -m service -a ‘name=nginx state=started enabled=yes’</p><h2 id="cron-模块"><a href="#cron-模块" class="headerlink" title="cron 模块"></a>cron 模块</h2><p>ansible nsxq -m cron -a ‘name=”update ntp time” hour=2 user=root job=”/usr/sbin/ntpdate cn.ntp.org.cn”‘<br>ansible nsxq -m cron -a ‘name=”update ntp time” state=absent’</p><h2 id="filesystem-模块"><a href="#filesystem-模块" class="headerlink" title="filesystem 模块"></a>filesystem 模块</h2><h2 id="yum-模块"><a href="#yum-模块" class="headerlink" title="yum 模块"></a>yum 模块</h2><p>ansible nsxq -m yum a ‘name=httpd state=installed’<br>ansible nsxq -m yum a ‘name=”@Development Tools” state=present’</p><h2 id="user-模块"><a href="#user-模块" class="headerlink" title="user 模块"></a>user 模块</h2><p>ansible nsxq -m user -a ‘createhome=yes home=/home/user1 password=”ffffff” name=user1 state=present shell=/bin/bash’</p><h2 id="synchronize-模块"><a href="#synchronize-模块" class="headerlink" title="synchronize 模块"></a>synchronize 模块</h2><p>目录后边跟/表示同步目录下内容，不加/把目录同步过去<br>ansible nsxq -m synchronize -a ‘src=/etc/hosts dest=/opt/‘</p><h2 id="filesystem-模块-1"><a href="#filesystem-模块-1" class="headerlink" title="filesystem 模块"></a>filesystem 模块</h2><p>ansible test -m filesystem -a ‘dev=/disk.img fstype=ext4 opts=-F’</p><h2 id="mount-模块"><a href="#mount-模块" class="headerlink" title="mount 模块"></a>mount 模块</h2><p>ansible test -m mount -a ‘fstype=ext4 name=/aaa src=/dev/loop0 state=mounted’</p><hr>]]></content>
      
      <categories>
          
          <category> 自动化运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 自动化 </tag>
            
            <tag> 运维 </tag>
            
            <tag> Ansible </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Except实践之 修改主机密码&amp;添加用户&amp;ssh免密码验证</title>
      <link href="/arlo/45fa6416/"/>
      <content type="html"><![CDATA[<p>最近运维工作中遇到大批量的主机需要添加账户，修改密码，实现无密码验证等工作，由于这种工作完全是重复性的，可以借助脚本（更好的方式是自动化运维工具）来解决，主要是使用到expect工具，该工具主要用来处理自动交互式任务进行通信，不需要人为干预；今天就把用到的脚本在此记录一下，以备后用。<br><a id="more"></a></p><h1 id="批量修改主机密码"><a href="#批量修改主机密码" class="headerlink" title="批量修改主机密码"></a>批量修改主机密码</h1><p>脚本内容如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# cat chpasswd.sh </div><div class="line">#!/bin/bash</div><div class="line">file=&quot;iplist.txt&quot;</div><div class="line">for ip in `awk &apos;/^[^#]/&#123;print $1&#125;&apos; $file`; do</div><div class="line">    port=`awk -v I=$ip &apos;&#123;if(I==$1)print $3&#125;&apos; $file`</div><div class="line">    user=`awk -v I=$ip &apos;&#123;if(I==$1)print $2&#125;&apos; $file`</div><div class="line">    pass=`awk -v I=$ip &apos;&#123;if(I==$1)print $4&#125;&apos; $file`</div><div class="line">    newpass=`awk -v I=$ip &apos;&#123;if(I==$1)print $5&#125;&apos; $file`</div><div class="line"></div><div class="line">expect -c &quot;</div><div class="line">    spawn ssh -p$port $user@$ip</div><div class="line">    set timeout 2</div><div class="line">    expect &#123;</div><div class="line">        \&quot;(yes/no)\&quot; &#123;send \&quot;yes\r\&quot;;exp_continue&#125;</div><div class="line">        \&quot;password:\&quot; &#123;send \&quot;$pass\r\&quot;;exp_continue&#125;</div><div class="line">        \&quot;$user@*\&quot; &#123;send \&quot;echo \&apos;$newpass\&apos; |passwd --stdin $user\r exit\r\&quot;;exp_continue&#125;</div><div class="line"></div><div class="line">#\&quot;$user@*\&quot;  &#123;send \&quot;df -h\r exit\r\&quot;;exp_continue&#125;</div><div class="line">    &#125;&quot;</div><div class="line">done</div></pre></td></tr></table></figure></p><p>iplist.txt 格式如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# cat iplist.txt </div><div class="line">#     ip     user    port    passwd    newpasswd</div><div class="line">#------------------------------------------------</div><div class="line">192.168.6.101  root    22    ffffff    gggggg</div><div class="line">192.168.6.102  root    22    ffffff    gggggg</div></pre></td></tr></table></figure></p><h1 id="批量主机ssh免密码验证"><a href="#批量主机ssh免密码验证" class="headerlink" title="批量主机ssh免密码验证"></a>批量主机ssh免密码验证</h1><h2 id="手动操作ssh无密码验证"><a href="#手动操作ssh无密码验证" class="headerlink" title="手动操作ssh无密码验证"></a>手动操作ssh无密码验证</h2><h3 id="设置hosts记录"><a href="#设置hosts记录" class="headerlink" title="设置hosts记录"></a>设置hosts记录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# cat /etc/hosts</div><div class="line">\#127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4 oracle11g</div><div class="line">\#::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</div><div class="line">192.168.6.100 vm00</div><div class="line">192.168.6.101 vm01</div><div class="line">192.168.6.102 vm02</div></pre></td></tr></table></figure><h3 id="新建用户并设置密码（每台机器都执行）"><a href="#新建用户并设置密码（每台机器都执行）" class="headerlink" title="新建用户并设置密码（每台机器都执行）"></a>新建用户并设置密码（每台机器都执行）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# useradd -u 600 airmodel</div><div class="line">[root@vm00 ~]# echo &quot;ffffff&quot; |passwd --stdin airmodel</div><div class="line">Changing password for user airmodel.</div><div class="line">passwd: all authentication tokens updated successfully.</div></pre></td></tr></table></figure><h3 id="配置无密码访问key"><a href="#配置无密码访问key" class="headerlink" title="配置无密码访问key"></a>配置无密码访问key</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# su - airmodel</div><div class="line">[airmodel@vm00 ~]$ ssh-keygen </div><div class="line">Generating public/private rsa key pair.</div><div class="line">Enter file in which to save the key (/home/airmodel/.ssh/id_rsa): </div><div class="line">Created directory &apos;/home/airmodel/.ssh&apos;.</div><div class="line">Enter passphrase (empty for no passphrase): </div><div class="line">Enter same passphrase again: </div><div class="line">Your identification has been saved in /home/airmodel/.ssh/id_rsa.</div><div class="line">Your public key has been saved in /home/airmodel/.ssh/id_rsa.pub.</div><div class="line">The key fingerprint is:</div><div class="line">3a:d9:04:80:20:6a:90:8a:cd:c7:ee:fb:2d:d9:03:cd airmodel@vm00</div><div class="line">The key&apos;s randomart image is:</div><div class="line">+--[ RSA 2048]----+</div><div class="line">|+o ..            |</div><div class="line">|= .  .           |</div><div class="line">|++ .  .          |</div><div class="line">|+ o o  .         |</div><div class="line">|   o   oS        |</div><div class="line">|    . .=E        |</div><div class="line">|   .  ++.        |</div><div class="line">|    . ooo        |</div><div class="line">|    .o....       |</div><div class="line">+-----------------+</div></pre></td></tr></table></figure><p><img src="/images/2017/0618/01.png" alt="图片"></p><h3 id="将生成的公钥拷贝到其他主机"><a href="#将生成的公钥拷贝到其他主机" class="headerlink" title="将生成的公钥拷贝到其他主机"></a>将生成的公钥拷贝到其他主机</h3><p>标准命令格式：ssh-copy-id -i ~/.ssh/id_rsa.pub user@server<br>偷懒可以写成下边这种：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[airmodel@vm00 ~]$ ssh-copy-id -i vm02</div><div class="line">airmodel@vm02&apos;s password: </div><div class="line">Now try logging into the machine, with &quot;ssh &apos;vm02&apos;&quot;, and check in:</div><div class="line"></div><div class="line">  .ssh/authorized_keys</div><div class="line"></div><div class="line">to make sure we haven&apos;t added extra keys that you weren&apos;t expecting.</div></pre></td></tr></table></figure></p><h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><p>1.公钥会被拷贝到目标主机的 /home/user/.ssh/authorized_keys 文件中<br>2.[airmodel@vm00 ~]$ ssh vm02 无密码访问</p><h2 id="多主机自动化配置ssh免密脚本"><a href="#多主机自动化配置ssh免密脚本" class="headerlink" title="多主机自动化配置ssh免密脚本"></a>多主机自动化配置ssh免密脚本</h2><h3 id="添加用户脚本"><a href="#添加用户脚本" class="headerlink" title="添加用户脚本"></a>添加用户脚本</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">[root@vm00 ~]# cat padduser.sh </div><div class="line">#!/bin/bash</div><div class="line">file=&quot;iplist2.txt&quot;</div><div class="line">newuser=&quot;airmodel&quot;</div><div class="line">newpass=&quot;ffffff&quot;</div><div class="line">for ip in `awk &apos;/^[^#]/&#123;print $1&#125;&apos; $file`; do</div><div class="line">    port=`awk -v I=$ip &apos;&#123;if(I==$1)print $3&#125;&apos; $file`</div><div class="line">    loginuser=`awk -v I=$ip &apos;&#123;if(I==$1)print $2&#125;&apos; $file`</div><div class="line">    pass=`awk -v I=$ip &apos;&#123;if(I==$1)print $4&#125;&apos; $file`</div><div class="line">expect -c &quot;</div><div class="line">    spawn ssh -p$port $loginuser@$ip</div><div class="line">    set timeout 2</div><div class="line">    expect &#123;</div><div class="line">        \&quot;(yes/no)\&quot; &#123;send \&quot;yes\r\&quot;;exp_continue&#125;</div><div class="line">        \&quot;password:\&quot; &#123;send \&quot;$pass\r\&quot;;exp_continue&#125;</div><div class="line">        \&quot;$user@*\&quot; &#123;send \&quot;useradd -u 600 $newuser &amp;&amp; echo \&apos;$newpass\&apos; |passwd --stdin $newuser\r exit\r\&quot;;exp_continue&#125;</div><div class="line">#\&quot;$user@*\&quot;  &#123;send \&quot;df -h\r exit\r\&quot;;exp_continue&#125;</div><div class="line">    &#125;&quot;</div><div class="line">done</div></pre></td></tr></table></figure><p>iplist2.txt内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#     ip     user    port    passwd    </div><div class="line">#--------------------------------------</div><div class="line">192.168.6.102  root    22    ffffff</div></pre></td></tr></table></figure></p><h3 id="多主机拷贝ssh公钥"><a href="#多主机拷贝ssh公钥" class="headerlink" title="多主机拷贝ssh公钥"></a>多主机拷贝ssh公钥</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line">#批量ssh无密码验证</div><div class="line">for p in $(cat /opt/iplist3.txt)</div><div class="line">do</div><div class="line">ip=$(echo &quot;$p&quot;|cut -f1 -d &quot;:&quot;)</div><div class="line">password=$(echo &quot;$p&quot;|cut -f2 -d &quot;:&quot;)</div><div class="line"></div><div class="line">expect -c &quot;   </div><div class="line">spawn ssh-copy-id -i /home/airmodel/.ssh/id_rsa.pub airmodel@$ip  </div><div class="line">        expect &#123;   </div><div class="line">                \&quot;*yes/no*\&quot; &#123;send \&quot;yes\r\&quot;; exp_continue&#125;   </div><div class="line">                \&quot;*password*\&quot; &#123;send \&quot;$password\r\&quot;; exp_continue&#125;   </div><div class="line">                \&quot;*Password*\&quot; &#123;send \&quot;$password\r\&quot;;&#125;   </div><div class="line">        &#125;   </div><div class="line">&quot;   </div><div class="line">done</div></pre></td></tr></table></figure><p>iplist3.txt 格式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">#user:passwd</div><div class="line">#-----------</div><div class="line">vm01:ffffff</div><div class="line">vm02:ffffff</div><div class="line">vm03:ffffff</div><div class="line">vm04:ffffff</div><div class="line">vm05:ffffff</div></pre></td></tr></table></figure></p><p>参考连接：<br><a href="http://zqscm.qiniucdn.com/data/20110709133541/index.html" target="_blank" rel="external">http://zqscm.qiniucdn.com/data/20110709133541/index.html</a><br><a href="https://blog.slogra.com/post-674.html" target="_blank" rel="external">https://blog.slogra.com/post-674.html</a><br><a href="http://blog.csdn.net/fanren224/article/details/63250184" target="_blank" rel="external">http://blog.csdn.net/fanren224/article/details/63250184</a></p>]]></content>
      
      <categories>
          
          <category> 自动化运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 自动化 </tag>
            
            <tag> 运维 </tag>
            
            <tag> expect </tag>
            
            <tag> 脚本 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>windows 下使用expdp自动备份多用户oracle脚本</title>
      <link href="/arlo/85974653/"/>
      <content type="html"><![CDATA[<p>Windows下多Oracle实例，根据用户自动备份<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">@echo off   </div><div class="line">echo ================================================   </div><div class="line">echo  Windows环境下Oracle数据库的自动备份脚本  </div><div class="line">echo  1. 使用当前日期命名备份文件。  </div><div class="line">echo  2. 自动删除30天前的备份。  </div><div class="line">echo ================================================  </div><div class="line">::以“YYYYMMDD”格式取出当前时间。  </div><div class="line">set BACKUPDATE=%date:~0,4%%date:~5,2%%date:~8,2%  </div><div class="line">set DATADIR=E:\database_backup\%BACKUPDATE%</div><div class="line">echo 本次备份目录是%DATADIR%</div><div class="line">echo ================================================ </div><div class="line">echo 开始备份数据库</div><div class="line">for %%u in (AIR_FORECAST,ALK,AIR_FZ,TSUBJECT,TMAIN,TCODE,AIR_YBYJ,AIR_FXPT,INVENTORY,TENV,NEWMBGL) do expdp userid=&apos;sys/密码@实例 as sysdba&apos; schemas=%%u directory=DATA_PUMP_DIR dumpfile=%%u.dmp</div><div class="line">echo 移动文件到数据库备份目录</div><div class="line">if not exist &quot;E:\database_backup\%BACKUPDATE%&quot; mkdir E:\database_backup\%BACKUPDATE%  </div><div class="line">MOVE /Y E:\app\Administrator\admin\SX21\dpdump\* E:\database_backup\%BACKUPDATE%</div><div class="line">::删除30天前的备份</div><div class="line">forfiles /p E:\database_backup\  /m 201* /d -30 /c &quot;cmd /c if @isdir==TRUE (rmdir /q /s @path) else (del /f @path)&quot;  </div><div class="line">exit</div></pre></td></tr></table></figure></p><p>参考：<br><a href="http://www.cnblogs.com/peterpanzsy/p/3442784.html" target="_blank" rel="external">http://www.cnblogs.com/peterpanzsy/p/3442784.html</a><br><a href="http://blog.csdn.net/smasegain/article/details/46759267" target="_blank" rel="external">http://blog.csdn.net/smasegain/article/details/46759267</a></p>]]></content>
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>NIS 服务器搭建记录</title>
      <link href="/arlo/3e02ce74/"/>
      <content type="html"><![CDATA[<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>NIS是Network Information Services (NIS server)的缩写，是为了管理一个网络中的用户账号 ，以方便用户在不同的主机上登录时只需要一个账号即可，它将用户的账号保存在一个主机上，用户登录时只需向其发送请求确认账号是否正确。<br><a id="more"></a></p><h2 id="NIS-的主要功能：管理帐户信息"><a href="#NIS-的主要功能：管理帐户信息" class="headerlink" title="NIS 的主要功能：管理帐户信息"></a>NIS 的主要功能：管理帐户信息</h2><p><strong>服务器端文件名    档案内容</strong><br>/etc/passwd        提供用户账号、UID、GID、家目录所在、Shell 等等<br>/etc/group        提供群组数据以及 GID 的对应，还有该群组的加入人员<br>/etc/hosts        主机名与 IP 的对应，常用于 private IP 的主机名对应<br>/etc/services        每一种服务 (daemons) 所对应的埠口 (port number)<br>/etc/protocols        基础的 TCP/IP 封包协定，如 TCP, UDP, ICMP 等<br>/etc/rpc        每种 RPC 服务器所对应的程序号码<br>/var/yp/ypservers    NIS 服务器所提供的数据库</p><h1 id="NIS-Server端配置"><a href="#NIS-Server端配置" class="headerlink" title="NIS Server端配置"></a>NIS Server端配置</h1><p>yp-tools ：提供 NIS 相关的查寻指令功能。<br>ypbind ：提供 NIS Client 端的设定软件。<br>ypserv ：提供 NIS Server 端的设定软件。<br>rpcbind ：就是 RPC ，系统一般会安装上。</p><h2 id="安装NIS-Server-端软件"><a href="#安装NIS-Server-端软件" class="headerlink" title="安装NIS Server 端软件"></a>安装NIS Server 端软件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@sg010 ~]# yum -y install yp-tools ypbind ypserv rpcbind</div><div class="line">[root@sg010 ~]#  rpm -qa | grep &apos;^yp&apos;</div></pre></td></tr></table></figure><p>ypbind-1.20.4-33.el6.x86_64<br>yp-tools-2.9-12.el6.x86_64<br>ypserv-2.19-31.el6.x86_64<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg010 ~]#  rpm -qa | grep rpcbind</div></pre></td></tr></table></figure></p><p>rpcbind-0.2.0-13.el6_9.x86_64</p><h2 id="配置hosts文件"><a href="#配置hosts文件" class="headerlink" title="配置hosts文件"></a>配置hosts文件</h2><p>Hosts文件中之前的记录不要动，新增包含nis server 和 nis client 的主机与ip对应记录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[[root@sg010 ~]# vim /etc/sysconfig/network</div><div class="line">\#增加以下两行</div><div class="line">NISDOMAIN=hpcnis</div><div class="line">YPSERV_ARGS=&quot;-p 1011&quot;</div></pre></td></tr></table></figure></p><h2 id="配置nis服务"><a href="#配置nis服务" class="headerlink" title="配置nis服务"></a>配置nis服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@sg010 ~]# egrep -v &apos;^$|#&apos; /etc/ypserv.conf </div><div class="line">dns: no</div><div class="line">files: 30</div><div class="line">xfr_check_port: yes</div><div class="line">\*   : *       : shadow.byname    : port</div><div class="line">\*   : *       : passwd.adjunct.byname : port</div><div class="line">127.0.0.0/255.0.0.0:*:*:none</div><div class="line">218.193.126.128/255.255.255.128:*:*:none</div><div class="line">59.77.252.0/255.255.255.192:*:*:none</div><div class="line">\*:*:*:deny</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@sg010 ~]# vim /etc/sysconfig/yppasswdd</div><div class="line">YPPASSWDD_ARGS=&quot;--port 1012&quot;</div></pre></td></tr></table></figure><h2 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h2><p>启动后查看一下三个服务状态<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg010 ~]# /etc/init.d/rpcbind status</div></pre></td></tr></table></figure></p><p>rpcbind (pid  18813) is running…<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg010 ~]# /etc/init.d/ypserv status</div></pre></td></tr></table></figure></p><p>ypserv (pid  21054) is running…<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg010 ~]# /etc/init.d/yppasswdd status</div></pre></td></tr></table></figure></p><p>rpc.yppasswdd (pid  23087) is running…<br>并设置开机自启动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@sg010 ~]# chkconfig --level 35 ypserv on</div><div class="line">[root@sg010 ~]# chkconfig --level 35 yppasswdd on</div><div class="line">[root@sg010 ~]# chkconfig --level 35 rpcbind on</div></pre></td></tr></table></figure></p><h2 id="添加用户，设置密码"><a href="#添加用户，设置密码" class="headerlink" title="添加用户，设置密码"></a>添加用户，设置密码</h2><p>[root@sg010 ~]# useradd -u 1001 nisuser1<br>[root@sg010 ~]# echo ffffff|passwd –stdin nisuser1<br>[root@sg010 ~]# /usr/lib64/yp/ypinit -m<br><img src="/images/2017/0614/00.png" alt="图片"></p><h1 id="Client-端配置"><a href="#Client-端配置" class="headerlink" title="Client 端配置"></a>Client 端配置</h1><p>[root@sg011 ~]# yum -y install ypbind yp-tools<br>[root@sg011 ~]# rpm -qa |grep ‘^yp’<br>yp-tools-2.9-12.el6.x86_64<br>ypbind-1.20.4-30.el6.x86_64</p><h2 id="配置NIS"><a href="#配置NIS" class="headerlink" title="配置NIS"></a>配置NIS</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg011 ~]# setup</div></pre></td></tr></table></figure><p>xshell 的配色方案修改过，所以这里看到的图片颜色也不是那种蓝底色的<br>勾选NIS，启用NIS验证<br><img src="/images/2017/0614/01.png" alt="图片"><br>填写NIS的服务器域名和服务器地址<br><img src="/images/2017/0614/02.png" alt="图片"><br>Starting rpcbind:                                          [  OK  ]<br>Starting NIS service:                                      [  OK  ]<br>Binding NIS service: .                                     [  OK  ]<br><strong>刚才的步骤其实就是做了以下操作</strong></p><ul><li>/etc/sysconfig/network (加入 NISDOMAIN 项目)</li><li>/etc/yp.conf (亦即是 ypbind 的配置文件)</li><li>/etc/nsswitch.conf (修改许多主机验证功能的顺序)</li><li>/etc/sysconfig/authconfig (CentOS 的认证机制)</li><li>/etc/pam.d/system-auth (许多登入所需要的 PAM 认证过程)</li><li>启动了rpcbind 和 ypbind服务</li></ul><h3 id="etc-sysconfig-network"><a href="#etc-sysconfig-network" class="headerlink" title="/etc/sysconfig/network"></a>/etc/sysconfig/network</h3><p><img src="/images/2017/0614/03.png" alt="图片"></p><h3 id="etc-yp-conf"><a href="#etc-yp-conf" class="headerlink" title="/etc/yp.conf"></a>/etc/yp.conf</h3><p><img src="/images/2017/0614/04.png" alt="图片"> </p><h3 id="etc-nsswitch-conf"><a href="#etc-nsswitch-conf" class="headerlink" title="/etc/nsswitch.conf"></a>/etc/nsswitch.conf</h3><p>主机验证顺序<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">passwd:     files nis</div><div class="line">shadow:     files nis</div><div class="line">group:      files nis</div><div class="line">\#hosts:     db files nisplus nis dns</div><div class="line">hosts:      files nis dns</div></pre></td></tr></table></figure></p><h3 id="etc-sysconfig-authconfig"><a href="#etc-sysconfig-authconfig" class="headerlink" title="/etc/sysconfig/authconfig"></a>/etc/sysconfig/authconfig</h3><p>启用NIS<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">USENIS=yes</div></pre></td></tr></table></figure></p><h3 id="etc-pam-d-system-auth"><a href="#etc-pam-d-system-auth" class="headerlink" title="/etc/pam.d/system-auth"></a>/etc/pam.d/system-auth</h3><p>在pam验证过程中增加了nis<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">password    sufficient    pam_unix.so sha512 shadow nis nullok try_first_pass use_authtok</div></pre></td></tr></table></figure></p><h2 id="客户端简单粗暴的验证方法"><a href="#客户端简单粗暴的验证方法" class="headerlink" title="客户端简单粗暴的验证方法"></a>客户端简单粗暴的验证方法</h2><h3 id="切换用户验证"><a href="#切换用户验证" class="headerlink" title="切换用户验证"></a>切换用户验证</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@sg011 ~]# grep nisuser1 /etc/passwd</div><div class="line">[root@sg011 ~]# su - nisuser1</div></pre></td></tr></table></figure><p>su: warning: cannot change directory to /home/nisuser1: No such file or directory<br>-bash-4.1$<br><img src="/images/2017/0614/05.png" alt="图片"></p><h3 id="没有用户主目录"><a href="#没有用户主目录" class="headerlink" title="没有用户主目录"></a>没有用户主目录</h3><p>两种解决方式</p><ol><li>新建一个/home/nisuser1目录,cp /etc/skel/* /home/niuser1</li><li>使用nfs，挂载nis server的home目录，客户端和服务器使用的是同一个用户目录，保持一致性（推荐）<h2 id="修改用户的默认shell"><a href="#修改用户的默认shell" class="headerlink" title="修改用户的默认shell"></a>修改用户的默认shell</h2>在客户端执行 ypchsh<br><img src="/images/2017/0614/06.png" alt="图片"> </li></ol><p>参考：<a href="http://cn.linux.vbird.org/linux_server/0430nis.php" target="_blank" rel="external">http://cn.linux.vbird.org/linux_server/0430nis.php</a></p>]]></content>
      
      
        <tags>
            
            <tag> NIS </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>NFS 服务器搭建记录</title>
      <link href="/arlo/dd17c5bd/"/>
      <content type="html"><![CDATA[<h1 id="系统环境"><a href="#系统环境" class="headerlink" title="系统环境"></a>系统环境</h1><p>Centos 6.5<br>Iptables：off<br>Selinux：disabled</p><p>由于MBR分区表只支持2T的硬盘，/dev/sdb是一块10T的硬盘，使用GPT分区表，需要使用parted工具分区<br><a id="more"></a></p><h1 id="使用fdisk查看磁盘"><a href="#使用fdisk查看磁盘" class="headerlink" title="使用fdisk查看磁盘"></a>使用fdisk查看磁盘</h1><p>ps：这个之后又增加了一块10T的硬盘，这个截图早一点，没提现出来<br><img src="/images/2017/0613/00.png" alt="插入图片01"></p><h1 id="使用parted工具分区"><a href="#使用parted工具分区" class="headerlink" title="使用parted工具分区"></a>使用parted工具分区</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# parted /dev/sdb</div></pre></td></tr></table></figure><p>GNU Parted 2.1<br>Using /dev/sdb<br>Welcome to GNU Parted! Type ‘help’ to view a list of commands.<br>(parted) <font color="red">print</font><br>Model: VMware Virtual disk (scsi)<br>Disk /dev/sdb: 9896GB<br>Sector size (logical/physical): 512B/512B<br>Partition Table:  <font color="red">gpt</font>  </p><p>Number  Start  End  Size  File system  Name  Flags</p><p>(parted)<font color="red"> mkpart primary 0 10T</font><br>Warning: The resulting partition is not properly aligned for best performance.<br>Ignore/Cancel?<font color="red"> Ignore </font><br>(parted)<font color="red"> print </font><br>Model: VMware Virtual disk (scsi)<br>Disk /dev/sdb: 9896GB<br>Sector size (logical/physical): 512B/512B<br>Partition Table: gpt</p><p>Number  Start   End     Size    File system  Name     Flags<br> 1      17.4kB  9896GB  9896GB               primary</p><p>(parted) <font color="red"> quit </font><br>Information: You may need to update /etc/fstab.<br><img src="/images/2017/0613/01.png" alt="插入图片01"><br>(parted) <font color="red"> set 1 lvm on </font><br>(parted) <font color="red"> print  </font><br>Model: VMware Virtual disk (scsi)<br>Disk /dev/sdb: 9896GB<br>Sector size (logical/physical): 512B/512B<br>Partition Table: gpt</p><p>Number  Start   End     Size    File system  Name     Flags<br> 1      17.4kB  9896GB  9896GB  ext4         primary  lvm<br>(parted) <font color="red"> quit </font><br>Information: You may need to update /etc/fstab.<br><img src="/images/2017/0613/05.png" alt="插入图片01"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# parted /dev/sdc</div></pre></td></tr></table></figure></p><p>GNU Parted 2.1<br>Using /dev/sdc<br>Welcome to GNU Parted! Type ‘help’ to view a list of commands.<br>(parted)<font color="red"> print   </font><br>Error: /dev/sdc: unrecognised disk label<br>(parted) <font color="red"> mklabel gpt </font><br>(parted) <font color="red"> print </font><br>Model: VMware Virtual disk (scsi)<br>Disk /dev/sdc: 11.0TB<br>Sector size (logical/physical): 512B/512B<br>Partition Table: gpt</p><p>Number  Start  End  Size  File system  Name  Flags</p><p>(parted)<font color="red"> mkpart primary 0 10995G </font><br>Warning: The resulting partition is not properly aligned for best performance.<br>Ignore/Cancel?<font color="red"> Ignore   </font><br>(parted)<font color="red"> print </font><br>Model: VMware Virtual disk (scsi)<br>Disk /dev/sdc: 11.0TB<br>Sector size (logical/physical): 512B/512B<br>Partition Table: gpt</p><p>Number  Start   End     Size    File system  Name     Flags<br> 1      17.4kB  11.0TB  11.0TB               primary</p><p>(parted) <font color="red"> set 1 lvm on   </font><br>(parted) <font color="red"> print  </font><br>Model: VMware Virtual disk (scsi)<br>Disk /dev/sdc: 11.0TB<br>Sector size (logical/physical): 512B/512B<br>Partition Table: gpt</p><p>Number  Start   End     Size    File system  Name     Flags<br> 1      17.4kB  11.0TB  11.0TB               primary  lvm</p><p>(parted) <font color="red"> quit </font><br>Information: You may need to update /etc/fstab.<br><img src="/images/2017/0613/06.png" alt="插入图片01"></p><h1 id="lvm-划分"><a href="#lvm-划分" class="headerlink" title="lvm 划分"></a>lvm 划分</h1><h2 id="创建pv"><a href="#创建pv" class="headerlink" title="创建pv"></a>创建pv</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# pvcreate /dev/sdb1 /dev/sdc1</div></pre></td></tr></table></figure><p>  dev_is_mpath: failed to get device for 8:17<br>  Physical volume “/dev/sdb1” successfully created<br>  dev_is_mpath: failed to get device for 8:33<br>  Physical volume “/dev/sdc1” successfully created<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# pvdisplay</div></pre></td></tr></table></figure></p><p>— Physical volume —<br>  PV Name               /dev/sda2<br>  VG Name               vg_sg020<br>  PV Size               193.51 GiB / not usable 3.00 MiB<br>  Allocatable           yes (but full)<br>  PE Size               4.00 MiB<br>  Total PE              49538<br>  Free PE               0<br>  Allocated PE          49538<br>  PV UUID               BF6Ikw-eYtl-HfNM-Nnmt-WLK4-xb8O-KAnZtB</p><p>  “/dev/sdb1” is a new physical volume of “9.00 TiB”<br>  — NEW Physical volume —<br>  PV Name               /dev/sdb1<br>  VG Name<br>  PV Size               9.00 TiB<br>  Allocatable           NO<br>  PE Size               0<br>  Total PE              0<br>  Free PE               0<br>  Allocated PE          0<br>  PV UUID               aPPVxz-oeWE-lP9l-AeZU-p699-pffd-O7T3dW</p><p>  “/dev/sdc1” is a new physical volume of “10.00 TiB”<br>  — NEW Physical volume —<br>  PV Name               /dev/sdc1<br>  VG Name<br>  PV Size               10.00 TiB<br>  Allocatable           NO<br>  PE Size               0<br>  Total PE              0<br>  Free PE               0<br>  Allocated PE          0<br>  PV UUID               MWbqIl-WI66-JCsc-x0Re-UqjL-HgXB-Vw1jge<br><img src="/images/2017/0613/07.png" alt="插入图片01"></p><h2 id="创建vg"><a href="#创建vg" class="headerlink" title="创建vg"></a>创建vg</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# vgcreate vg_fuz /dev/sdb1 /dev/sdc1</div></pre></td></tr></table></figure><p>  Volume group “vg_fuz” successfully created<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# vgdisplay</div></pre></td></tr></table></figure></p><p>— Volume group —<br>  VG Name               vg_fuz<br>  System ID<br>  Format                lvm2<br>  Metadata Areas        2<br>  Metadata Sequence No  1<br>  VG Access             read/write<br>  VG Status             resizable<br>  MAX LV                0<br>  Cur LV                0<br>  Open LV               0<br>  Max PV                0<br>  Cur PV                2<br>  Act PV                2<br>  VG Size               19.00 TiB<br>  PE Size               4.00 MiB<br>  Total PE              4980734<br>  Alloc PE / Size       0 / 0<br>  Free  PE / Size       4980734 / 19.00 TiB<br>  VG UUID               ruDcio-mmt5-z6YD-7HS0-fbst-GIlT-SwmvcF</p><p>  — Volume group —<br>  VG Name               vg_sg020<br>  System ID<br>  Format                lvm2<br>  Metadata Areas        1<br>  Metadata Sequence No  4<br>  VG Access             read/write<br>  VG Status             resizable<br>  MAX LV                0<br>  Cur LV                3<br>  Open LV               3<br>  Max PV                0<br>  Cur PV                1<br>  Act PV                1<br>  VG Size               193.51 GiB<br>  PE Size               4.00 MiB<br>  Total PE              49538<br>  Alloc PE / Size       49538 / 193.51 GiB<br>  Free  PE / Size       0 / 0<br>  VG UUID               2E6Hdt-xWhi-DyLX-pDva-3WTw-fDNx-Qytoqg<br><img src="/images/2017/0613/08.png" alt="插入图片01"></p><h2 id="创建lv"><a href="#创建lv" class="headerlink" title="创建lv"></a>创建lv</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# lvcreate -n lv_fuz -l 4980734 vg_fuz</div></pre></td></tr></table></figure><p>Logical volume “lv_fuz” created<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# lvdisplay</div></pre></td></tr></table></figure></p><p>— Logical volume —<br>  LV Path                /dev/vg_fuz/lv_fuz<br>  LV Name                lv_fuz<br>  VG Name                vg_fuz<br>  LV UUID                JTUEVa-9JPb-0VaD-5JH8-fwov-MuUS-gp1Gdr<br>  LV Write Access        read/write<br>  LV Creation host, time sg020, 2017-06-14 09:27:14 +0800<br>  LV Status              available<br>  # open                 0<br>  LV Size                19.00 TiB<br>  Current LE             4980734<br>  Segments               2<br>  Allocation             inherit<br>  Read ahead sectors     auto<br>  - currently set to     256<br>  Block device           253:3</p><p>  — Logical volume —<br>  LV Path                /dev/vg_sg020/lv_root<br>  LV Name                lv_root<br>  VG Name                vg_sg020<br>  LV UUID                5yHVBf-Qt3u-fzb2-gwNL-opy3-0ewQ-0ypYsc<br>  LV Write Access        read/write<br>  LV Creation host, time livedvd.centos, 2017-06-09 15:49:11 +0800<br>  LV Status              available<br>  # open                 1<br>  LV Size                50.00 GiB<br>  Current LE             12800<br>  Segments               1<br>  Allocation             inherit<br>  Read ahead sectors     auto<br>  - currently set to     256<br>  Block device           253:0</p><p>  — Logical volume —<br>  LV Path                /dev/vg_sg020/lv_home<br>  LV Name                lv_home<br>  VG Name                vg_sg020<br>  LV UUID                d1bsIq-ZeVr-mxk1-Mu2U-7H1R-wXMX-rWZ9hj<br>  LV Write Access        read/write<br>  LV Creation host, time livedvd.centos, 2017-06-09 15:49:19 +0800<br>  LV Status              available<br>  # open                 1<br>  LV Size                124.11 GiB<br>  Current LE             31772<br>  Segments               1<br>  Allocation             inherit<br>  Read ahead sectors     auto<br>  - currently set to     256<br>  Block device           253:2</p><p>  — Logical volume —<br>  LV Path                /dev/vg_sg020/lv_swap<br>  LV Name                lv_swap<br>  VG Name                vg_sg020<br>  LV UUID                wGW4BB-KB5g-UUZ8-FwLQ-pTYy-Eoc2-ji102r<br>  LV Write Access        read/write<br>  LV Creation host, time livedvd.centos, 2017-06-09 15:49:37 +0800<br>  LV Status              available<br>  # open                 1<br>  LV Size                19.40 GiB<br>  Current LE             4966<br>  Segments               1<br>  Allocation             inherit<br>  Read ahead sectors     auto<br>  - currently set to     256<br>  Block device           253:1<br><img src="/images/2017/0613/09.png" alt="插入图片01"></p><h1 id="格式化分区"><a href="#格式化分区" class="headerlink" title="格式化分区"></a>格式化分区</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# mkfs.ext4 /dev/vg_fuz/lv_fuz</div></pre></td></tr></table></figure><p><em><br>mke2fs 1.41.12 (17-May-2010)<br>mkfs.ext4: Size of device /dev/vg_fuz/lv_fuz too big to be expressed in 32 bits<br>    using a blocksize of 4096.</em><br><strong><font color="red"> ext4格式的分区，不支持大于16TB的硬盘分区，我们使用xfs格式</font></strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# yum install xfsprogs</div><div class="line">[root@sg020 ~]# mkfs.xfs /dev/vg_fuz/lv_fuz</div></pre></td></tr></table></figure></p><p><img src="/images/2017/0613/02.png" alt="插入图片01"></p><h1 id="查找分区UUID"><a href="#查找分区UUID" class="headerlink" title="查找分区UUID"></a>查找分区UUID</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# blkid /dev/vg_fuz/lv_fuz</div></pre></td></tr></table></figure><p>/dev/vg_fuz/lv_fuz: UUID=”3c2731e9-eac4-4e05-b103-be061e4c009c” TYPE=”xfs”</p><h1 id="添加到fstab"><a href="#添加到fstab" class="headerlink" title="添加到fstab"></a>添加到fstab</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# mkdir /data</div><div class="line">[root@sg020 ~]# echo &apos;UUID=3c2731e9-eac4-4e05-b103-be061e4c009c /data xfs    defaults        0 0&apos;  &gt;&gt; /etc/fstab</div></pre></td></tr></table></figure><h1 id="挂载分区"><a href="#挂载分区" class="headerlink" title="挂载分区"></a>挂载分区</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# mount –a</div><div class="line">[root@sg020 ~]# mount |column –t</div></pre></td></tr></table></figure><p><img src="/images/2017/0613/03.png" alt="插入图片01"> </p><h1 id="查看安装nfs软件"><a href="#查看安装nfs软件" class="headerlink" title="查看安装nfs软件"></a>查看安装nfs软件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# yum -y install nfs-utils rpcbind</div><div class="line">[root@sg020 ~]# rpm -qa |grep nfs</div></pre></td></tr></table></figure><p>nfs-utils-1.2.3-39.el6.x86_64<br>nfs-utils-lib-1.1.5-6.el6.x86_64<br>nfs4-acl-tools-0.3.3-6.el6.x86_6<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# rpm -qa |grep rpcbind</div></pre></td></tr></table></figure></p><p>rpcbind-0.2.0-11.el6.x86_64<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">/etc/exports文件内容格式：</div><div class="line">&lt;输出目录&gt; [客户端1 选项（访问权限,用户映射,其他）] [客户端2 选项（访问权限,用户映射,其他）]</div></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# cat /etc/exports </div><div class="line">/data218.193.126.128/25(insecure,rw,async,no_root_squash)  59.77.252.0/26(insecure,rw,async,no_root_squash)</div></pre></td></tr></table></figure><p><em><br><strong><br>NFS的常用目录<br>/etc/exports                           NFS服务的主要配置文件<br>/usr/sbin/exportfs                   NFS服务的管理命令<br>/usr/sbin/showmount              客户端的查看命令<br>/var/lib/nfs/etab                      记录NFS分享出来的目录的完整权限设定值<br>/var/lib/nfs/xtab                      记录曾经登录过的客户端信息</strong></em></p><h1 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# /etc/init.d/rpcbind start</div></pre></td></tr></table></figure><p>Starting rpcbind:                                          [  OK  ]<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# /etc/init.d/nfs start</div></pre></td></tr></table></figure></p><p>Starting NFS services:                                     [  OK  ]<br>Starting NFS quotas:                                       [  OK  ]<br>Starting NFS mountd:                                       [  OK  ]<br>Starting NFS daemon:                                       [  OK  ]<br>Starting RPC idmapd:                                       [  OK  ]<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# chkconfig --level 35 rpcbind on</div><div class="line">[root@sg020 ~]# chkconfig --level 35 nfs on</div></pre></td></tr></table></figure></p><h2 id="重新共享所有目录并输出详细信息"><a href="#重新共享所有目录并输出详细信息" class="headerlink" title="重新共享所有目录并输出详细信息"></a>重新共享所有目录并输出详细信息</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# exportfs -rv</div></pre></td></tr></table></figure><p>exporting 218.193.126.128/25:/data<br>exporting 59.77.252.0/26:/data</p><h2 id="卸载所有共享目"><a href="#卸载所有共享目" class="headerlink" title="卸载所有共享目"></a>卸载所有共享目</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@sg020 ~]# exportfs -au</div></pre></td></tr></table></figure><h1 id="客户端挂载"><a href="#客户端挂载" class="headerlink" title="客户端挂载"></a>客户端挂载</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@sg011 ~]#  mount -t nfs sg020:/data/ /data</div><div class="line">[root@sg011 ~]#  echo “sg020:/data             /data   nfs nolock 0 0” &gt;&gt; /etc/fstab</div><div class="line">[root@sg011~]# mount –a</div><div class="line">[root@sg011 ~]# mount |column –t</div></pre></td></tr></table></figure><p><img src="/images/2017/0613/04.png" alt="插入图片01"> </p><h2 id="user-amp-group-是nobody的问题"><a href="#user-amp-group-是nobody的问题" class="headerlink" title="user &amp; group 是nobody的问题"></a>user &amp; group 是nobody的问题</h2><p>由于centos6以后采用的是nfs v4，所以在挂载后，服务端和客户端看到的信息不一致，客户端看到文件的user和group都是nobody 或nfsnobody，以下是解决办法</p><h3 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h3><p>修改配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># vi /etc/idmapd.conf</div><div class="line">Domain = hpcnfs</div></pre></td></tr></table></figure></p><p>重启服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">/etc/init.d/rpcidmapd restart </div><div class="line">chkconfig --level 35  rpcidmapd on</div></pre></td></tr></table></figure></p><h3 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h3><p>修改配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># vi /etc/idmapd.conf</div><div class="line">Domain = hpcnfs</div></pre></td></tr></table></figure></p><p>清除缓存<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nfsidmap -c</div></pre></td></tr></table></figure></p><p>重启服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">/etc/init.d/rpcidmapd restart </div><div class="line">chkconfig --level 35  rpcidmapd on</div></pre></td></tr></table></figure></p><h1 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h1><h2 id="重启之后，如果客户端提示“Stale-file-handle”，三种解决方法："><a href="#重启之后，如果客户端提示“Stale-file-handle”，三种解决方法：" class="headerlink" title="重启之后，如果客户端提示“Stale file handle”，三种解决方法："></a>重启之后，如果客户端提示“Stale file handle”，三种解决方法：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">1. umount /data;mount -a</div><div class="line">2. fuser -km /data; mount -a</div><div class="line">3. umount -lv /data; mount -a</div></pre></td></tr></table></figure><h2 id="lvm扩容，“resize2fs-Device-or-resource-busy-while-trying-to-open”，解决方法如下："><a href="#lvm扩容，“resize2fs-Device-or-resource-busy-while-trying-to-open”，解决方法如下：" class="headerlink" title="lvm扩容，“resize2fs: Device or resource busy while trying to open”，解决方法如下："></a>lvm扩容，“resize2fs: Device or resource busy while trying to open”，解决方法如下：</h2><p>其实做lvm不需要分区，直接将整个盘做成pv；扩容的vg时候，可以更懒一点，pv都不用做，直接vgextend；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vgextend vg_fuz /dev/sdc</div></pre></td></tr></table></figure></p><p>在扩容lv的时候，更加方便的做法是使用pe扩容，而不是容量（-L是容量，-l是PE，可以通过vgdisplay查看剩余）；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">lvextend -l +3000 /dev/vg_fuz/lv_fuz</div></pre></td></tr></table></figure></p><p>fdisk可以看到到容量已经变化了，但是df还看不出来，我们可以使用resize2fs命令重设；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">resize2fs /dev/vg_fuz/lv_fuz</div></pre></td></tr></table></figure></p><p>xfs 文件系统 resize2fs已经不适用了，需要用到一个新的命令xfs_growfs；</p><pre><code>xfs_growfs /dev/vg_fuz/lv_fuz</code></pre><p><img src="/images/2017/0613/10.png" alt="插入图片01"><br>因为整个环境是内网环境，需要拨vpn才能访问，我没有配置iptables，nfs的iptables配置也比较麻烦，回头研究一下；<br>另，今天遇到一个很有意思的情况（其实就是自己学艺不精），由于Nfs给两个网段提供服务，牵扯到一个跨网段的问题；我看了下服务器上的配置的网络情况，根据ip地址所在的网段（218.193.126.x和59.77.252.x）和子网掩码（25和26），配置了/data 218.193.126.0/25(insecure,rw,async,no_all_squash) 59.77.252.0/26(insecure,rw,async,no_all_squash)，之后的情况就很诡异，59这个网络是可以正常访问的，218这个网络提示没有权限（mount.nfs: access denied by server while mounting sg020:/data/），搞得我很纳闷，配置到精确的ip地址就没有问题；后来经群里高手点播，网络和掩码的计算（218.193.126.0/25意思应该是218.193.126.1~218.193.126.127），我的服务器ip是不在范围内的，回头需要补习一下网络基础。</p>]]></content>
      
      
        <tags>
            
            <tag> Nfs </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Oracle TNS-12541、TNS-00511 无监听程序</title>
      <link href="/arlo/6e04db84/"/>
      <content type="html"><![CDATA[<p>一台Windows服务器上安装的oralce服务器很卡，于是同事就重启了一下，然后……，你想到了，起不来了。折腾了好久，服务器终于起来了，oracle起不来，记录一下故障原因</p><h1 id="提示错误信息"><a href="#提示错误信息" class="headerlink" title="提示错误信息"></a>提示错误信息</h1><p>如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">Fatal NI connect error 12541, connecting to:</div><div class="line"> (DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=WIN-EPRQ7FK9EK2)(PORT=1521))(CONNECT_DATA=(SID=orcl)(CID=(PROGRAM=E:\app\Administrator\product\11.2.0\dbhome_4\bin\emagent.exe)(HOST=WIN-EPRQ7FK9EK2)(USER=SYSTEM))))</div><div class="line"></div><div class="line">  VERSION INFORMATION:</div><div class="line">TNS for 64-bit Windows: Version 11.2.0.1.0 - Production</div><div class="line">Windows NT TCP/IP NT Protocol Adapter for 64-bit Windows: Version 11.2.0.1.0 - Production</div><div class="line">  Time: 13-6月 -2017 10:58:58</div><div class="line">  Tracing not turned on.</div><div class="line">  Tns error struct:</div><div class="line">    ns main err code: 12541</div><div class="line">    TNS-12541: TNS: 无监听程序</div><div class="line">    ns secondary err code: 12560</div><div class="line">    nt main err code: 511</div><div class="line">    TNS-00511: 无监听程序</div><div class="line">    nt secondary err code: 61</div><div class="line">    nt OS err code: 0</div></pre></td></tr></table></figure></p><a id="more"></a><h1 id="故障原因"><a href="#故障原因" class="headerlink" title="故障原因"></a>故障原因</h1><p>oracle运行时间过长，<strong>listener.log日志超过4G</strong>导致，此为oracle bug；BUG号为9879101 : THE CONNECT THROUGH LISTENER WAS SLOW WHEN LISTNER LOG GROWED 4GB</p><h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><ol><li>找到日志文件 E:\app\Administrator\diag\tnslsnr*<em>WIN-EPRQ7FK9EK2*</em>\listener\trace\listener.log</li><li>经查看，该日志大小为4.00 GB (4,294,967,340 字节)</li><li>删除该文件，启动监听、服务，恢复正常</li></ol><h1 id="顺手写个脚本放计划任务里"><a href="#顺手写个脚本放计划任务里" class="headerlink" title="顺手写个脚本放计划任务里"></a>顺手写个脚本放计划任务里</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">@echo off   </div><div class="line">echo ================================================   </div><div class="line">echo  E:\app\Administrator\diag\tnslsnr\WIN-EPRQ7FK9EK2\listener\trace\listener.log 备份文件，用来解决日志问超过4G，数据库监听死掉问题   </div><div class="line">echo ================================================  </div><div class="line">::以“YYYYMMDD”格式取出当前时间。  </div><div class="line">set BACKUPDATE=%date:~0,4%%date:~5,2%%date:~8,2%  </div><div class="line">set DATADIR=E:\app\Administrator\diag\tnslsnr\WIN-EPRQ7FK9EK2\listener\trace\</div><div class="line"></div><div class="line">echo 备份日志文件</div><div class="line">e:</div><div class="line">cd %DATADIR%</div><div class="line">lsnrctl set log_status off</div><div class="line">rename listener.log listener.log_%BACKUPDATE%</div><div class="line">lsnrctl set log_status on</div><div class="line">echo 删除30天以前的日志文件</div><div class="line">forfiles -p %DATADIR% -s -m listener.log_* -d -30 -c &quot;cmd /c del @path&quot;</div></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>在已存在的目录中增加一层路径</title>
      <link href="/arlo/ffa6a879/"/>
      <content type="html"><![CDATA[<p>由于之前项目上考虑不周，路径配置的有问题，现在需要在已有的目录中某一级增加一层目录，需要解决几个问题；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">/data/Model3/WeatherForecast/CAMX/2017/05/01/&#123;d1,d2,d3&#125;</div><div class="line">/data/Model3/WeatherForecast/CAMX/2017/05/01/00/&#123;d1,d2,d3&#125;</div></pre></td></tr></table></figure></p><ol><li>多级目录，多个参数，CAMX/2017/05/01 这四个参数是变化的</li><li>判断父级目录是否存在，存在后增加一层目录</li><li>移动之前的数据到当前目录<a id="more"></a>以下是我写的脚本，能满足使用，稍显繁琐，求优化！<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line">dir=&apos;/data/Model3/WeatherForecast&apos;</div><div class="line">#dir1=&quot;NAQMPSDAY&quot;</div><div class="line">dir1=&quot;CAMX CAMxDAY CMAQDAY CMAQ.WRF NAQMPS NAQMPSDAY WRF WRFCHEM WRFCHEMDAY&quot;</div><div class="line">dir2=&quot;2016 2017&quot;</div><div class="line">for i1 in $dir1;</div><div class="line">do</div><div class="line">    for i2 in $dir2;</div><div class="line">    do</div><div class="line">        for i3 in &#123;01..12&#125;;</div><div class="line">        do</div><div class="line">            for i4 in &#123;01..31&#125;;</div><div class="line">            do</div><div class="line">                dir4=&quot;$dir/$i1/$i2/$i3/$i4&quot;</div><div class="line">#                echo $dir4</div><div class="line">                if [ -d $dir4 ];then</div><div class="line">                    cd $dir4</div><div class="line">                    mkdir $dir4/00</div><div class="line">                    mv d* $dir4/00</div><div class="line">                fi</div><div class="line">            done</div><div class="line">        done</div><div class="line">    done</div><div class="line">done</div></pre></td></tr></table></figure></li></ol><p>以下是执行前后的效果对比图（使用tree -L 5 &gt; 2.txt生成）<br><img src="/images/2017/0525/01.png" alt="s"></p>]]></content>
      
      <categories>
          
          <category> 常识 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 脚本 </tag>
            
            <tag> shell </tag>
            
            <tag> linux常识 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Oracle 多实例启动</title>
      <link href="/arlo/6b9bbb19/"/>
      <content type="html"><![CDATA[<p>oracle 服务器上配置了两个实例，orcl和sx21，启动服务的时候需要手动修改一下环境变量ORACLE_SID,在此记录一下。<br><a id="more"></a></p><h1 id="手动启动"><a href="#手动启动" class="headerlink" title="手动启动"></a>手动启动</h1><h2 id="oracle-用户的环境变量-bash-profile"><a href="#oracle-用户的环境变量-bash-profile" class="headerlink" title="oracle 用户的环境变量.bash_profile"></a>oracle 用户的环境变量.bash_profile</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">ORACLE_BASE=/u01/app/oracle</div><div class="line">ORACLE_HOME=$ORACLE_BASE/product/11.1.0/db_1</div><div class="line">ORACLE_SID=orcl</div><div class="line">PATH=$PATH:$ORACLE_HOME/bin:$HOME/bin</div><div class="line">LD_LIBRARY_PATH=$ORACLE_HOME/lib</div><div class="line">export PATH ORACLE_BASE ORACLE_HOME ORACLE_SID PATH LD_LIBRARY_PATH</div><div class="line">export LANG=zh_CN.UTF-8</div><div class="line">export NLS_LANG=AMERICAN_AMERICA.ZHS16GBK</div></pre></td></tr></table></figure><h2 id="查看环境变量"><a href="#查看环境变量" class="headerlink" title="查看环境变量"></a>查看环境变量</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[oracle@localhost ~]$ echo $ORACLE_HOME</div><div class="line">/u01/app/oracle/product/11.1.0/db_1</div><div class="line">[oracle@localhost ~]$ echo $ORACLE_SID</div><div class="line">orcl</div></pre></td></tr></table></figure><h2 id="启动oracle服务"><a href="#启动oracle服务" class="headerlink" title="启动oracle服务"></a>启动oracle服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">su - oracle</div><div class="line">sqlplus /nolog</div><div class="line">sql&gt; conn /as sysdba</div><div class="line">sql&gt; startup</div><div class="line">sql&gt; exit</div></pre></td></tr></table></figure><h2 id="修改ORACLE-SID环境变量，再次执行第3步的启动操作"><a href="#修改ORACLE-SID环境变量，再次执行第3步的启动操作" class="headerlink" title="修改ORACLE_SID环境变量，再次执行第3步的启动操作"></a>修改ORACLE_SID环境变量，再次执行第3步的启动操作</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">export ORACLE_SID=SX21</div></pre></td></tr></table></figure><h2 id="启动监听服务"><a href="#启动监听服务" class="headerlink" title="启动监听服务"></a>启动监听服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">lsnrctl start</div></pre></td></tr></table></figure><h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[oracle@localhost ~]$ sqlplus sys/password@SX21 as sysdba</div></pre></td></tr></table></figure><p><img src="/images/2017/0518/01.png" alt="oracle"></p><h1 id="自动启动"><a href="#自动启动" class="headerlink" title="自动启动"></a>自动启动</h1><h2 id="修改控制文件"><a href="#修改控制文件" class="headerlink" title="修改控制文件"></a>修改控制文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">vim /etc/oratab</div><div class="line">orcl:/u01/app/oracle/product/11.1.0/db_1:Y</div><div class="line">sx21:/u01/app/oracle/product/11.1.0/db_1:Y</div><div class="line">CQ:/u01/app/oracle/product/11.1.0/db_1:Y</div></pre></td></tr></table></figure><h2 id="修改dbstart文件"><a href="#修改dbstart文件" class="headerlink" title="修改dbstart文件"></a>修改dbstart文件</h2><p><em>修改第80行: ORACLE_HOME_LISTNER=$1为ORACLE_HOME_LISTNER=$ORACLE_HOME</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">vim /u01/app/oracle/product/11.1.0/db_1/bin/dbstart</div><div class="line">……</div><div class="line">ORACLE_HOME_LISTNER=$ORACLE_HOME</div><div class="line">……</div></pre></td></tr></table></figure></p><h2 id="修改dbshut文件"><a href="#修改dbshut文件" class="headerlink" title="修改dbshut文件"></a>修改dbshut文件</h2><p><em>修改第50行: ORACLE_HOME_LISTNER=$1为ORACLE_HOME_LISTNER=$ORACLE_HOME</em><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">vim /u01/app/oracle/product/11.1.0/db_1/bin/dbshut</div><div class="line">……</div><div class="line">ORACLE_HOME_LISTNER=$ORACLE_HOME</div><div class="line">……</div></pre></td></tr></table></figure></p><h2 id="修改开机启动文件"><a href="#修改开机启动文件" class="headerlink" title="修改开机启动文件"></a>修改开机启动文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">vim /etc/rc.local</div><div class="line">su - oracle -lc &quot;$ORACLE_HOME/bin/dbstart&quot;</div></pre></td></tr></table></figure><h1 id="常用的三个图形控制如下"><a href="#常用的三个图形控制如下" class="headerlink" title="常用的三个图形控制如下"></a>常用的三个图形控制如下</h1><h2 id="启动em控制台"><a href="#启动em控制台" class="headerlink" title="启动em控制台"></a>启动em控制台</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">emctl start dbconsole</div><div class="line">#添加到开机启动文件中</div><div class="line">su - oracle -lc &quot;$ORACLE_HOME/bin/emctl start dbconsole&quot;</div></pre></td></tr></table></figure><h2 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dbca</div></pre></td></tr></table></figure><h2 id="配置监听"><a href="#配置监听" class="headerlink" title="配置监听"></a>配置监听</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">netca</div><div class="line">netmgr</div></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Oracle入门</title>
      <link href="/arlo/9f698189/"/>
      <content type="html"><![CDATA[<p>服务、监听<br>启动oracle服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">su - oracle</div><div class="line">sqlplus /nolog</div><div class="line">sql&gt; conn /as sysdba</div><div class="line">sql&gt; startup</div><div class="line">sql&gt; exit</div></pre></td></tr></table></figure></p><p>启动监听服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">lsnrctl start</div></pre></td></tr></table></figure></p><a id="more"></a><p>配置监听<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">netca</div></pre></td></tr></table></figure></p><p>启动em控制台<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">emctl start dbconsole</div></pre></td></tr></table></figure></p><p>创建数据库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dbca</div></pre></td></tr></table></figure></p><p>连接数据库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sqlplus /nolog</div><div class="line">conn / as sysdba;</div></pre></td></tr></table></figure></p><p>连接数据库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">conn system/password;</div></pre></td></tr></table></figure></p><p>断开数据库连接<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">disc[onnect]</div></pre></td></tr></table></figure></p><p>将屏幕上的内容输入到文件中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">spool d:\a.txt</div><div class="line">……</div><div class="line">spool off;</div></pre></td></tr></table></figure></p><p>创建用户</p><p>密码必须以字母开头<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">create user xiaoming identified by m123;</div></pre></td></tr></table></figure></p><p>sys用户：超级管理员，权限最高，dba角色，默认密码：change_on_install<br>system用户：系统管理员，没有create database权限，默认密码：manager<br>普通用户：新建的用户无登录数据库权限<br>查看当前用户<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">show user；</div></pre></td></tr></table></figure></p><p>修改密码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">1. passw[ord]</div><div class="line">2. alter user 用户名 identified by 新密码;</div></pre></td></tr></table></figure></p><p>删除用户<br>如果用户已经创建表，删除的时候加一个cascade参数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">drop user 用户名 cascade</div></pre></td></tr></table></figure></p><p>授予权限<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">grant select on emp to xiaoming;</div><div class="line">grant all on emp to xiaoming;</div></pre></td></tr></table></figure></p><p>收回权限<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">revoke all on emp to xiaoming;</div></pre></td></tr></table></figure></p><p>收回上级权限，下级权限也相应取消<br>对象权限授权<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">grant select on emp to xiaoming with grant option;</div><div class="line">conn xiaoming/m1234;</div><div class="line">grant select on scott.emp to xiaohong;</div></pre></td></tr></table></figure></p><p>系统权限授权<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">grant connect to xiaoming with admin option;</div><div class="line">conn xiaoming/1234;</div><div class="line">grant connect to xiaohong;</div></pre></td></tr></table></figure></p><p>用户口令管理<br>建立数据库时候，oracle会建立默认的default的profile，当没有给用户指定profile的时候，oracle会将default的profile分配给用户<br>创建profile文件<br>用户输入3次错误密码后被锁定2天<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">create profile lock_account limit failed_login_attempts 3 password_lock_time 2;</div><div class="line">alter user xiaoming profile lock_account;</div></pre></td></tr></table></figure></p><p>用户解锁<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alter user xiaoming account unlock;</div></pre></td></tr></table></figure></p><p>定期修改密码<br>要求用每隔30天修改登录密码，宽限期为2天，32天后没有修改将不能登录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">create profile myprofile limit password_life_time 30 password_grace_time 2;</div><div class="line">alter user xiaoming profile myprofile;</div></pre></td></tr></table></figure></p><p>口令历史<br>希望用户修改密码的时候，不能使用之前的密码；使用口令历史，oracle会将之前的密码存在数据字典中，当用户修改密码时，oracle会将新输入的密码和旧密码进行比对，如果一样，会提示重新输入。<br>不能使用10内使用过的密码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">create profile password_history limit password_life_time 10 password_grace_time 2 password_reuse_time 10</div><div class="line">alter user xiaoming profile password_history;</div></pre></td></tr></table></figure></p><p>删除profile文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">drop profile password_history [cascade]</div></pre></td></tr></table></figure></p><p>###############Day2############<br>创建表<br>必须以字母开头<br>长度不能超过30个字符<br>不能使用oracle保留字<br>只能使用a-zA-Z0-9$#</p><p>字符型<br>char 2000<br>varchar2 4000<br>clob 4000+<br>数字型<br>number 整数，小数 -(10^38) ~ 10^38<br>日期类型<br>date  包含年月日和时分秒<br>timestamp 时间戳，精度更高<br>图片<br>blob</p><p>创建student表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">create table student(</div><div class="line">xh number(4),</div><div class="line">xm varchar2(20),</div><div class="line">sex char(2),</div><div class="line">birthday date,</div><div class="line">sal num(7,2)</div><div class="line">);</div></pre></td></tr></table></figure></p><p>添加一个字段<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alter table student add(classID number(2));</div></pre></td></tr></table></figure></p><p>修改字段长度<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alter table student modify(xm varchar2(30));</div></pre></td></tr></table></figure></p><p>修改字段的类型/或者名字（不能有数据）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alter table student modify (xm char(30));</div></pre></td></tr></table></figure></p><p>删除一个字段<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alter table student drop column sal;</div></pre></td></tr></table></figure></p><p>修改表名字<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rename student to stu;</div></pre></td></tr></table></figure></p><p>删除表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">drop table student;</div></pre></td></tr></table></figure></p><p>修改日期默认格式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alter session set nls_date_format=&apos;mm-dd-yyyy&apos;</div></pre></td></tr></table></figure></p><p>插入数据<br>插入所有字段<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">insert into student values(1,&apos;小明&apos;,&apos;男&apos;,&apos;03-14-2017&apos;,3200.00)</div></pre></td></tr></table></figure></p><p>插入部分字段<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">insert into student(xh,xm,sex) values(&apos;23&apos;,小张&apos;,&apos;男&apos;)</div></pre></td></tr></table></figure></p><p>插入空值<br>修改数据<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">update student set sex=&apos;女&apos; where xm=&apos;小明&apos;;</div></pre></td></tr></table></figure></p><p>修改多个字段，用逗号隔开</p><p>将一行数据复制多条<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">insert into users (userid,username,userpass) select * from users;</div></pre></td></tr></table></figure></p><p>查询字段为[非]空<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select * from student where brithday is [not] null;</div></pre></td></tr></table></figure></p><p>删除数据,不删除表结构，记录在日志中，删除之前建立一个回滚点savepoint aa;可恢复<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">delete from student;</div></pre></td></tr></table></figure></p><p>删除数据后回滚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rollback to aa;</div></pre></td></tr></table></figure></p><p>删除表的结构和数据<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">drop table student;</div></pre></td></tr></table></figure></p><p>删除表数据，不删除表结构，不记录在日志中，不可恢复，速度快；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">truncate table student;</div></pre></td></tr></table></figure></p><p>查看表结构<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">desc table_name;</div></pre></td></tr></table></figure></p><p>查询所有列<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select * from dept;</div></pre></td></tr></table></figure></p><p>查询指定列<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select ename,sal,job,deption from dept;</div></pre></td></tr></table></figure></p><p>取消重复行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select distinct deptno,job from emp;</div></pre></td></tr></table></figure></p><p>打开显示操作时间<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">set timing on;</div></pre></td></tr></table></figure></p><p>nvl处理null值，当字段为null，当0处理<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select sal*13+nvl(comm,0)*13 &quot;年工资&quot;,ename,comm from emp;</div></pre></td></tr></table></figure></p><p>like<br>%表示0到多个字符<br>_表示任意单个字符</p><p>多个值匹配<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select * from emp where empno in(123,234,500);</div></pre></td></tr></table></figure></p><p>or &amp; and<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select * from emp where (sal&gt;500 or job=&apos;Manager&apos;) and ename like &apos;J%&apos;;</div></pre></td></tr></table></figure></p><p>默认排序低到高<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">order by [asc/desc]</div><div class="line">select * from emp order by sal;</div><div class="line">`</div></pre></td></tr></table></figure></p><p>按部门编号升序，薪水降序列；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select * from emp order by depto, sal desc;</div></pre></td></tr></table></figure></p><p>列别名排序<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select ename,(sal+nvl(comm,0))*12 [as] &quot;年薪&quot; from emp order by &quot;年薪&quot;;</div></pre></td></tr></table></figure></p><p>复杂查询<br>max，min，avg，sum，count<br>查询一个最高工资，最低工资<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select max(sal),min(sal) from emp;</div></pre></td></tr></table></figure></p><p>查出最高工资员工<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select ename,sal from emp where sal=(select max(sal) from emp);</div></pre></td></tr></table></figure></p><p>显示工资高于平均工资的员工<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select * from emp where sal&gt;(select avg(sal) from emp);</div></pre></td></tr></table></figure></p><p>group by<br>按部门分组，查出部门平均工资和最高工资<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select avg(sal),max(sal),deptno from emp group by deptno;</div></pre></td></tr></table></figure></p><p>显示每个部门的每种岗位的平均工资，最高工资<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select avg(sal),max(sal),deptno,job from emp group by deptno,job;</div></pre></td></tr></table></figure></p><p>having</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select avg(sal),max(sal),deptno  from emp group by deptno having avg(sal)&gt;2000;</div></pre></td></tr></table></figure><p>同一条语句出现顺序，优先级group by &gt; having &gt; order by<br>在选择列中，如果有列，表达式和分组函数，那么这些列和表达式中必须有一个出现在group by字句中，否则会报错</p><p>多表查询<br>多表查询的条件是至少不能少于表的个数-1<br>笛卡尔集<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select a1.ename,a1.sal,a2.dname from emp a1, dept a2 where a1.deptno=a2.deptno;</div></pre></td></tr></table></figure></p><p>between 在两者之间<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select a1.ename,a1.sal,a2.grade from emp a1,salgrade a2 where a1.sal between  a2.losal and a2.hisal;</div></pre></td></tr></table></figure></p><p>多表排序<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select a1.ename,a2.dname,a1.sal from emp a1,dept a2 where a1.deptno=a2.deptno order by a1.deptno;</div></pre></td></tr></table></figure></p><p>自连接</p><p>子查询<br>数据库执行sql语句从左到右<br>单行子查询<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select * from emp where deptno=(select deptno from emp where ename=&apos;SMITH&apos;);</div></pre></td></tr></table></figure></p><p>多行子查询<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select * from emp where job in(select distinct job from emp where deptno=10);</div></pre></td></tr></table></figure></p><p>all<br>查出工资比部门30的所有员工的工资都高的员工的姓名，工资和部门号<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">select ename,sal,deptno from emp where sal&gt;all(select all from emp where deptno=30);</div><div class="line">select * from emp where sal&gt;(select max(sal) from emp where deptno=30)</div></pre></td></tr></table></figure></p><p>any<br>查出工资比部门30的任意一个员工的工资高的员工的姓名，工资和部门号<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">select ename,sal,dept from emp where sal&gt;any(select all from emp where deptno=30);</div><div class="line">select * from emp where sal&gt;(select min(sal) from emp where deptno=30)</div></pre></td></tr></table></figure></p><p>多列子查询<br>查出与SMITH部门和岗位完全相同的所有职员<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select * from emp where (deptno,job)=(select deptno,job from emp where ename=&apos;SMITH&apos;);</div></pre></td></tr></table></figure></p><p>查询高于自己部门平均工资的员工的信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select a2.ename,a2.sal,a2.deptno,a1.mysal from emp a2,(select deptno,avg(sal) mysql from emp group by deptno) a1 where a2.deptno=a1.deptno and a2.sal &gt; a1.mysal;</div></pre></td></tr></table></figure></p><p>内嵌视图就是子查询当一个表使用，当在from子句中使用子查询时，必须给子查询指定别名；<br>列加别名可以加as，表加别名不能加as</p><p>分页查询<br>一共有三种方式</p><ol><li><p>rownum 分页</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select * from (select a1.*,rownum rn from (select * from emp) a1 where rownum&lt;=10) where rn&gt;6;</div></pre></td></tr></table></figure></li><li><p>ROWID 分页<br>速度最快</p></li><li><p>按分析函数分页<br>速度最慢</p></li></ol><p>查询结果创建新表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">create table mytable (id,name,sal,job,deptno) as select empno,ename,sal from emp;</div></pre></td></tr></table></figure></p><p>合并查询<br>为了合并多个select语句的结果，可以使用集合操作符号union，union all，intersect，minus.<br>union<br>去多个select查询结果的并集，取消重复行<br>union all<br>和union 类似，不取消重复行，or关系<br>intersect<br>取交集结果<br>minus<br>取差集（一个集合完全包含另一个集合，取没有的部分）</p><p>数据库管理员职责：</p><ol><li>安装和升级oracle数据库</li><li>建库，表空间，表，视图，索引……</li><li>指定并实施备份和恢复计划</li><li>数据库权限管理，调优，故障排除，</li><li>对于高级dba，要求能参与项目开发，会编写sql语句，存储过程，触发器，规则，约束，包</li></ol><p>sys用户：<br>所有oracle的数据字典的基表和动态视图都存在sys用户中；<br>sys拥有dba（数据库管理员角色），sysdba（系统管理员），sysoper（系统操作员） 角色和权限；<br>是oracle最高权限用户，必须以as sysdba或as sysoper形式登录，不能以normal方式登录数据库</p><p>system 用户：<br>存放次级用户内部数据;<br>拥有dba，sysdba角色及权限；</p><p>显示oracle 初始化参数<br>show parameter;</p><p>数据库的逻辑备份和恢复</p><p>导出表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">exp userid=username/passwd@sid tables=(table1,table2,table3) file=/path/x.dmp</div></pre></td></tr></table></figure></p><p>导入表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">imp userid=username/passwd@sid tables=(table1,table2,table3) file=/path/x.dmp</div></pre></td></tr></table></figure></p><p>使用直接导出方式<br>这种方式比默认常规的方式速度要快，当数据量大时，可以考虑这种方法，这时需要数据库的字符集要与客户端的字符集完全一致，否则报错<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">exp userid=username/passwd@sid tables=(table1,table2,table3) file=/path/x.dmp direct=y</div></pre></td></tr></table></figure></p><p>导出表结构<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">exp userid=username/passwd@sid tables=(table1,table2,table3) file=/path/x.dmp rows=n</div></pre></td></tr></table></figure></p><p>导出方案<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">exp username/passwd@sid owner=username file=/path/x.dmp</div></pre></td></tr></table></figure></p><p>导出数据库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">exp userid=system/passwd@sid full=y inctype=complete file=/path/xx.dmp</div><div class="line">imp userid=system/manager full=y file=/path/xx.dmp</div></pre></td></tr></table></figure></p><p>数据字典记录了数据库的系统信息，它是只读表和视图的集合，数据字典的所有者为sys用户，用户只能在数据字典上执行查询操作，而其维护和修改是由系统自动完成的<br>数据字典包括字典基表和数据字典动态视图，其中基表存储数据库的基本信息，普通用户不能直接访问数据字典的基表，数据字典视图是基于数据字典基表所建立的视图，普通用户可以通过查询数据字典的视图取得系统信息<br>数据字典视图主要包括user_xxx,all_xxx,dba_xxx三种类型</p><p>user_tables;<br>用于显示当前用户拥有的所有表，只返回用户所对应方案的所有表；<br>select table_name from user_tables;<br>all_tables;<br>用于显示当前用户可以访问的所有表;<br>select table_name from all_tables;<br>dba_tables;<br>用户显示所有方案拥有的数据库表。但是查询这种数据库字典视图，要求用户必须是dba角色或是有select any table系统权限。<br>select table_name from dba_tables;</p><p>用户名，权限，角色<br>dba_users  可以显示所有数据库用户的详细信息；<br>dba_sys_privs 可以显示用户所具有的系统权限；<br>dba_tab_privs 可以显示用户具有的对象权限;<br>dba_col_privs 可以显示用户具有的列权限；<br>dba_role_privs 可以显示用户所具有的角色。</p><p>查询oracle中所有的系统权限，一般是dba<br>select <em> from system_privilege_map order by name;<br>查询oracle中所有的角色，一般是dba<br>select </em> from dba_roles;<br>查询oracle中所有的对象权限，一般是dba<br>select distinct privilege from dba_tab_privs;<br>查询数据表的表空间<br>select tablespace_name from dba_tablespaces;</p><p>oracle 有多少种角色？<br>select <em> from dba_roles;<br>查询一种角色有多少种权限？<br>a. 一个角色包含的系统权限<br>select </em> from dba_sys_privs where grantee=’CONNECT’;<br>select <em> from role_sys_privs where role=’CONNECT’;<br>b. 一个角色包含的对象权限<br>select </em> from dba_tab_privs where grantee=’CONNECT’;<br>如何查看某个用户具有什么样的角色？<br>select * from dba_role_privs where grantee=’SCOTT’;</p><p>显示当前用户可以访问的所有数据字典视图<br>select <em> from dict where comments like ‘%grant%’<br>显示当前数据库的全称<br>select </em> from global_name;</p>]]></content>
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Oracle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ecFlow安装小记</title>
      <link href="/arlo/8af01e65/"/>
      <content type="html"><![CDATA[<p>在数值天气预报系统中有大量的计算机任务，这些任务之间又存在错综复杂的关系，如何管理和维护大量的复杂的任务成为一个难题，ecFlow正是为解决这一问题而诞生的。ecFlow是为欧洲中期天气预报中心（ECMWF）制作的产品，作为气象应用软件项目的一部分，用于工作流的管理和监控。<br>它具有如下功能：</p><ul><li>提供基于文本的任务定义语言以及python接口对计算机任务进行定义 </li><li>可以设定任务间的依赖关系，并在依赖关系满足时触发任务 </li><li>提供任务出错时的容错机制  </li><li>提供图形化的界面实时查看任务运行状况以及报错信息，用不同颜色来表示任务的运行状态，还可以根据需要自定义显示任务运行的进度。  </li></ul><p>ecFlow是基于客户端/服务端的模式工作的，即先启动一个ecFlow的服务端，计算机任务作为客户端，客户端任务在运行过程中将自己的状态发送到服务端，服务端根据收到的信息更新作业状态。<br><a id="more"></a></p><blockquote><p>本来是就Centos 6.9来安装ecflow的，由于ecflow要求Python版本必须大于2.7，而默认的是2.6.6，自行升级了python，编译后是各种报错，qt也装不上，实在是折腾累了，于是更换为centos7.2操作系统，默认python版本2.7.5，编译一切正常；</p></blockquote><h1 id="依赖关系"><a href="#依赖关系" class="headerlink" title="依赖关系"></a>依赖关系</h1><ul><li>cmake</li><li>g++</li><li>Python 2.7 or Python3</li><li>Xlib, X11, XMotif for <a href="https://software.ecmwf.int/wiki/display/ECFLOW/Glossary#term-ecflowview" target="_blank" rel="external">ecflowview</a> </li><li>Qt for <a href="https://software.ecmwf.int/wiki/display/ECFLOW/ecFlowUI+Documentation" target="_blank" rel="external">ecFlowUI</a></li></ul><h2 id="下载地址"><a href="#下载地址" class="headerlink" title="下载地址"></a>下载地址</h2><p>ecFlow：<a href="https://software.ecmwf.int/wiki/display/SUP/Releases" target="_blank" rel="external">https://software.ecmwf.int/wiki/display/SUP/Releases</a><br>boost：    <a href="http://www.boost.org/users/download/" target="_blank" rel="external">http://www.boost.org/users/download/</a><br>Motif：    <a href="http://www.ist.co.uk/motif/download/index.html" target="_blank" rel="external">http://www.ist.co.uk/motif/download/index.html</a><br>Qt：    <a href="http://mirrors.ustc.edu.cn/qtproject/archive/qt/" target="_blank" rel="external">http://mirrors.ustc.edu.cn/qtproject/archive/qt/</a></p><h2 id="安装cmake、g"><a href="#安装cmake、g" class="headerlink" title="安装cmake、g++"></a>安装cmake、g++</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vm01 ~]# yum -y install cmake g++ glibc  gcc gcc-c++ python-devel openssl-devel zlib-devel ncurses-devel</div></pre></td></tr></table></figure><h2 id="安装python3"><a href="#安装python3" class="headerlink" title="安装python3"></a>安装python3</h2><blockquote><p>Centos 7默认的python版本是2.7.5，满足要求；不需要安装python3</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@vm01 ~]# wget https://www.python.org/ftp/python/3.5.0/Python-3.5.0.tar.xz</div><div class="line">[root@vm01 ~]# tar xvf Python-3.5.0.tar.xz</div><div class="line">[root@vm01 ~]# cd Python-3.5.0</div><div class="line">[root@vm01 ~]# ./configure --prefix=/usr/local/python3</div><div class="line">[root@vm01 ~]# make &amp;&amp; make install</div><div class="line">[root@vm01 ~]# mv /usr/bin/python /usr/bin/python_old</div><div class="line">[root@vm01 ~]# ln -s /usr/local/python3/bin/python3 /usr/bin/python</div><div class="line">[root@vm01 ~]# cp -R /usr/local/python3/lib/* /usr/lib64/</div></pre></td></tr></table></figure><p>修改yum中的python版本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@vm01 ~]# vim /usr/bin/yum</div><div class="line">#!/usr/bin/python </div><div class="line">更改为 </div><div class="line">#!/usr/bin/python_old</div></pre></td></tr></table></figure></p><h2 id="安装Xlib-X11-XMotif"><a href="#安装Xlib-X11-XMotif" class="headerlink" title="安装Xlib, X11, XMotif"></a>安装Xlib, X11, XMotif</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vm01 ecFlow]# yum localinstall openmotif-2.1.32-2_IST.x86_64.rpm</div></pre></td></tr></table></figure><h2 id="ecFlowUI-需要图形界面QT支持"><a href="#ecFlowUI-需要图形界面QT支持" class="headerlink" title="ecFlowUI 需要图形界面QT支持"></a>ecFlowUI 需要图形界面QT支持</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@vm01 ecFlow]# yum -y install mesa-libGL-devel mesa-libGLU-devel freeglut-devel git gflags gflags-devel</div><div class="line">[root@vm01 ecFlow]# yum groupinstall &quot;GNOME Desktop&quot;</div><div class="line">[root@vm01 ecFlow]# chmod +x qt-opensource-linux-x64-5.8.0.run</div><div class="line">[root@vm01 ecFlow]# ./qt-opensource-linux-x64-5.8.0.run</div></pre></td></tr></table></figure><h1 id="安装ecFlow环境"><a href="#安装ecFlow环境" class="headerlink" title="安装ecFlow环境"></a>安装ecFlow环境</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@vm01 ~]# cd /usr/local/src/ecFlow/</div><div class="line">[root@vm01 ecFlow]# tar xf boost_1_64_0.tar.gz</div><div class="line">[root@vm01 ecFlow]# tar xf ecFlow-4.5.0-Source.tar.gz</div><div class="line">[root@vm01 ecFlow]# export WK=/usr/local/src/ecFlow/ecFlow-4.5.0-Source</div><div class="line">[root@vm01 ecFlow]# export BOOST_ROOT=/usr/local/src/ecFlow/boost_1_64_0</div></pre></td></tr></table></figure><h2 id="安装boost"><a href="#安装boost" class="headerlink" title="安装boost"></a>安装boost</h2><h3 id="基于bjam安装boost"><a href="#基于bjam安装boost" class="headerlink" title="基于bjam安装boost"></a>基于bjam安装boost</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@vm01 boost_1_64_0]# cd $BOOST_ROOT</div><div class="line">[root@vm01 boost_1_64_0]# ./bootstrap.sh</div><div class="line">[root@vm01 boost_1_64_0]# ./b2</div><div class="line">[root@vm01 boost_1_64_0]# ./b2 install --prefix=/usr/local</div></pre></td></tr></table></figure><h3 id="基于python安装boost"><a href="#基于python安装boost" class="headerlink" title="基于python安装boost"></a>基于python安装boost</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@vm01 boost_1_64_0]# ./bootstrap.sh --with-python=/usr/bin/python3</div><div class="line">[root@vm01 boost_1_64_0]# ./b2</div><div class="line">[root@vm01 boost_1_64_0]# ./b2 install --prefix=/usr/local</div></pre></td></tr></table></figure><blockquote><p>如果不需要ecflow的python接口，可以通过下面的设置避免编译boost的python库，在调用$WK/build_scripts/boost_build.sh前设置<br>export ECF_NO_PYTHON=1</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@vm01 boost_1_64_0]# cd $BOOST_ROOT</div><div class="line">[root@vm01 boost_1_64_0]# $WK/build_scripts/boost_1_53_fix.sh</div><div class="line">[root@vm01 boost_1_64_0]# $WK/build_scripts/boost_build.sh</div></pre></td></tr></table></figure><h2 id="编译安装ecflow"><a href="#编译安装ecflow" class="headerlink" title="编译安装ecflow"></a>编译安装ecflow</h2><p>推荐使用cmake 编译ecflow<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@vm01 boost_1_64_0]# cd $WK</div><div class="line">[root@vm01 build]# mkdir build; cd build;</div></pre></td></tr></table></figure></p><p><img src="/images/2017/0505/01.png" alt="ecFlow"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@vm01 build]# export CMAKE_PREFIX_PATH=/opt/Qt5.8.0/5.8/gcc_64/lib/cmake/Qt5Network</div></pre></td></tr></table></figure></p><p><img src="/images/2017/0505/02.png" alt="ecFlow"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@vm01 build]# vim ../CMakeLists.txt   #在最底下添加这行代码</div><div class="line">set(CMAKE_CXX_FLAGS &quot;$&#123;CMAKE_CXX_FLAGS&#125; -fPIC&quot;) </div><div class="line">[root@vm01 build]# cmake ..  -DCMAKE_INSTALL_PREFIX=/usr/local/ecflow -DCMAKE_BUILD_TYPE=Release -DENABLE_GUI=OFF</div><div class="line">[root@vm01 build]# CPUS=$(lscpu -p | grep -v &apos;#&apos; | wc -l)</div><div class="line">[root@vm01 build]# make -j$&#123;CPUS&#125;</div><div class="line">[root@vm01 build]# make check</div><div class="line">[root@vm01 build]# make install</div></pre></td></tr></table></figure></p><p>参考链接：<br><a href="https://software.ecmwf.int/wiki/display/ECFLOW/Installation" target="_blank" rel="external">https://software.ecmwf.int/wiki/display/ECFLOW/Installation</a><br><a href="http://windrocblog.sinaapp.com/?p=1602" target="_blank" rel="external">http://windrocblog.sinaapp.com/?p=1602</a><br><a href="https://wenku.baidu.com/view/fda9af29bfd5b9f3f90f76c66137ee06eff94e8d.html?re=view" target="_blank" rel="external">https://wenku.baidu.com/view/fda9af29bfd5b9f3f90f76c66137ee06eff94e8d.html?re=view</a><br><a href="http://blog.csdn.net/u013121305/article/details/49853713" target="_blank" rel="external">http://blog.csdn.net/u013121305/article/details/49853713</a></p><hr>]]></content>
      
      <categories>
          
          <category> 大气模型 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ecFlow </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Centos 7下KVM 虚拟机搭建</title>
      <link href="/arlo/8ae03ce9/"/>
      <content type="html"><![CDATA[<p>KVM（Kernel-based Virtual Machine）是支持虚拟化扩展（Intel VT 或 AMD-V技术）x86硬件的Linux完全虚拟化解决方案。它包括了一个可加载的内核模块kvm.ko，提供了核心的虚拟化架构以及一个处理器特定模块（kvm-intel.ko或kvm-amd.ko）。<br>使用KVM，用户可以运行多个无需修改的Linux或Windows虚拟机。每个虚拟机有自己私有的虚拟硬件：网卡、磁盘、显卡等等。<br><a id="more"></a></p><p><strong>系统化境</strong><br>iptables off<br>selinux disabled</p><h1 id="安装kvm虚拟化"><a href="#安装kvm虚拟化" class="headerlink" title="安装kvm虚拟化"></a>安装kvm虚拟化</h1><p>查看cpu是否支持全虚拟化<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">grep -E &apos;(vmx|svm)&apos; /proc/cpuinfo</div></pre></td></tr></table></figure></p><p>安装虚拟化组件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install qemu-kvm qemu-img virt-manager libvirt libvirt-python libvirt-client virt-install virt-viewer bridge-utils</div></pre></td></tr></table></figure></p><p>启动并设置开机自启动虚拟化服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">systemctl start libvirtd</div><div class="line">systemctl enable libvirtd</div></pre></td></tr></table></figure></p><p>检查虚拟化模块是否加载<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">lsmod | grep kvm</div></pre></td></tr></table></figure></p><p>安装图形界面<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y groupinstall &quot;GNOME Desktop&quot;</div></pre></td></tr></table></figure></p><p>图形化管理工具<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">virt-manager</div></pre></td></tr></table></figure></p><h1 id="配置桥接网络"><a href="#配置桥接网络" class="headerlink" title="配置桥接网络"></a>配置桥接网络</h1><p>拷贝一个br0网络配置文件<br>cd /etc/sysconfig/network-scripts/<br>cp ifcfg-em1 ifcfg-br0<br>配置ifcfg-em1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">TYPE=Ethernet</div><div class="line">BOOTPROTO=static</div><div class="line">DEVICE=em1</div><div class="line">ONBOOT=yes</div><div class="line">BRIDGE=br0</div></pre></td></tr></table></figure></p><p>配置ifcfg-br0<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">TYPE=Bridge</div><div class="line">BOOTPROTO=static</div><div class="line">DEVICE=br0</div><div class="line">ONBOOT=yes</div><div class="line">IPADDR=192.168.6.122</div><div class="line">NETMASK=255.255.255.0</div><div class="line">GATEWAY=192.168.6.1</div><div class="line">DNS1=223.5.5.5</div></pre></td></tr></table></figure></p><p>重启网络<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">systemctl restart network</div></pre></td></tr></table></figure></p><p>查看br0状态<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ip addr show br0</div><div class="line">brctl show</div></pre></td></tr></table></figure></p><h1 id="创建一个存储池"><a href="#创建一个存储池" class="headerlink" title="创建一个存储池"></a>创建一个存储池</h1><p>centos7操作系统安装的时候，自动分区时，大部分空间划分给/home分区了，默认的存储在/var/lib/libvirt/images目录下，在创建虚拟机之前我需要创建一个存储池；规划在/home/kvm/images 目录下<br>新建目录并设置权限<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mkdir -p /home/kvm/images;chown root:root /home/kvm/images;chmod 755 /home/kvm/images;</div></pre></td></tr></table></figure></p><p>创建存储池<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">#定义一个存储池绑定目录</div><div class="line"></div><div class="line">virsh pool-define-as StoragePool --type dir --target /home/kvm/images;</div><div class="line">#建立基于文件夹的存储池</div><div class="line">virsh pool-build StoragePool;</div><div class="line">#激活StoragePool</div><div class="line">virsh pool-start StoragePool;</div><div class="line">#存储池开机自动运行,使用virsh pool-autostart</div><div class="line">virsh pool-autostart StoragePool;</div><div class="line">#查看存储池的信息</div><div class="line">virsh pool-info StoragePool</div><div class="line">#查看创建的所有存储池</div><div class="line">virsh pool-list</div></pre></td></tr></table></figure></p><p>创建一个数据卷<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">virsh vol-create-as --pool StoragePool --name sql_server_2012.qcow2 100G --format qcow2</div></pre></td></tr></table></figure></p><p>查看存储卷信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">virsh vol-info --pool StoragePool sql_server_2012.qcow2 </div><div class="line">virsh vol-info /home/kvm/images/sql_server_2012.qcow2</div></pre></td></tr></table></figure></p><p>删除一个数据卷<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">virsh vol-delete --pool StoragePool sql_server_2012.qcow2</div></pre></td></tr></table></figure></p><h1 id="创建虚拟机"><a href="#创建虚拟机" class="headerlink" title="创建虚拟机"></a>创建虚拟机</h1><p>命令行创建虚拟机<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">virt-install --name sql_server_2012 --memory 4096 --vcpus sockets=1,cores=2,threads=2 --disk device=cdrom,path=/home/cn_windows_server_2012_r2_x64_dvd_2707961.iso --disk path=/home/kvm/images/sql_server_2012.qcow2 --network bridge=br0,model=e1000  --noautoconsole --accelerate --hvm --graphics vnc,listen=0.0.0.0,password=123456,port=20007 --cpu host-passthrough --autostart</div></pre></td></tr></table></figure></p><p>图形界面创建安虚拟机<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">virt-manager</div></pre></td></tr></table></figure></p><p>（过程略）</p><h1 id="virtsh-常用指令"><a href="#virtsh-常用指令" class="headerlink" title="virtsh 常用指令"></a>virtsh 常用指令</h1><p>1）virsh list 列出当前虚拟机列表，不包括未启动的<br>2）virsh list –all 列出所有虚拟机，包括所有已经定义的虚拟机<br>3）virsh destroy vm-name 关闭虚拟机<br>4）virsh start vm-name 启动虚拟机<br>5）virsh edit vm-name 编辑虚拟机xml文件<br>6）virsh undefine vm-name 删除虚拟机<br>7）virsh shutdown vm-name 停止虚拟机<br>8）virsh reboot vm-name 重启虚拟机<br>9）virsh autostart vm-name 虚拟机随宿主机启动</p><h1 id="virsh-pool与vol命令帮助"><a href="#virsh-pool与vol命令帮助" class="headerlink" title="virsh pool与vol命令帮助"></a>virsh pool与vol命令帮助</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">Storage Pool (help keyword &apos;pool&apos;)</div><div class="line">    find-storage-pool-sources-as   找到潜在存储池源</div><div class="line">    find-storage-pool-sources      发现潜在存储池源</div><div class="line">    pool-autostart                 自动启动某个池</div><div class="line">    pool-build                     建立池</div><div class="line">    pool-create-as                 从一组变量中创建一个池</div><div class="line">    pool-create                    从一个 XML 文件中创建一个池</div><div class="line">    pool-define-as                 在一组变量中定义池</div><div class="line">    pool-define                    define an inactive persistent storage pool or modify an existing persistent one from an XML file</div><div class="line">    pool-delete                    删除池</div><div class="line">    pool-destroy                   销毁（删除）池</div><div class="line">    pool-dumpxml                   XML 中的池信息</div><div class="line">    pool-edit                      为存储池编辑 XML 配置</div><div class="line">    pool-info                      存储池信息</div><div class="line">    pool-list                      列出池</div><div class="line">    pool-name                      将池 UUID 转换为池名称</div><div class="line">    pool-refresh                   刷新池</div><div class="line">    pool-start                     启动一个（以前定义的）非活跃的池</div><div class="line">    pool-undefine                  取消定义一个不活跃的池</div><div class="line">    pool-uuid                      把一个池名称转换为池 UUID</div><div class="line"></div><div class="line"> Storage Volume (help keyword &apos;volume&apos;)</div><div class="line">    vol-clone                      克隆卷。</div><div class="line">    vol-create-as                  从一组变量中创建卷</div><div class="line">    vol-create                     从一个 XML 文件创建一个卷</div><div class="line">    vol-create-from                生成卷，使用另一个卷作为输入。</div><div class="line">    vol-delete                     删除卷</div><div class="line">    vol-download                   将卷内容下载到文件中</div><div class="line">    vol-dumpxml                    XML 中的卷信息</div><div class="line">    vol-info                       存储卷信息</div><div class="line">    vol-key                        为给定密钥或者路径返回卷密钥</div><div class="line">    vol-list                       列出卷</div><div class="line">    vol-name                       为给定密钥或者路径返回卷名</div><div class="line">    vol-path                       为给定密钥或者路径返回卷路径</div><div class="line">    vol-pool                       为给定密钥或者路径返回存储池</div><div class="line">    vol-resize                     创新定义卷大小</div><div class="line">    vol-upload                     将文件内容上传到卷中</div><div class="line">    vol-wipe                       擦除卷</div></pre></td></tr></table></figure><p>参考：<br><a href="http://www.linuxtechi.com/install-kvm-hypervisor-on-centos-7-and-rhel-7/" target="_blank" rel="external">http://www.linuxtechi.com/install-kvm-hypervisor-on-centos-7-and-rhel-7/</a><br><a href="http://wangying.sinaapp.com/archives/1893" target="_blank" rel="external">http://wangying.sinaapp.com/archives/1893</a><br><a href="http://wangying.sinaapp.com/archives/1914" target="_blank" rel="external">http://wangying.sinaapp.com/archives/1914</a></p>]]></content>
      
      <categories>
          
          <category> 虚拟化 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 虚拟化 </tag>
            
            <tag> kvm </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Tomcat多实例部署</title>
      <link href="/arlo/42b916ee/"/>
      <content type="html"><![CDATA[<p>同一个tomcat下部署多个项目，重启会影响到其他项目的正常运行，为了使各项目独立，一般会使用安装多个tomcat，这样很耗费系统资源；创建tomcat多实例，有效的解决这一问题；<br><a id="more"></a></p><h1 id="常见部署方式"><a href="#常见部署方式" class="headerlink" title="常见部署方式"></a>常见部署方式</h1><p><strong>单实例单应用：</strong>比较常用的一种方式，只需要把你打好的 war 包丢在 webapps目录下，执行启动 Tomcat 的脚本就行了。<br><strong>单实例多应用：</strong>有两个不同的 Web 项目 war 包，还是只需要丢在webapps目录下，执行启动 Tomcat 的脚本，访问不同项目加上不同的虚拟目录。这种方式要慎用在生产环境，因为重启或挂掉 Tomcat 后会影响另外一个应用的访问。<br><strong>多实例单应用：</strong>多个 Tomcat 部署同一个项目，端口号不同，可以利用 Nginx 这么做负载均衡，当然意义不大。<br><strong>多实例多应用：</strong>多个 Tomcat 部署多个不同的项目。这种模式在服务器资源有限，或者对服务器要求并不是很高的情况下，可以实现多个不同项目部署在同一台服务器上的需求，来实现资源使用的最大化。</p><h1 id="目录作用"><a href="#目录作用" class="headerlink" title="目录作用"></a>目录作用</h1><p><strong>bin</strong>        主要存放脚本文件，例如比较常用的windows和linux系统中启动和关闭脚本<br><strong>conf</strong>    主要存放配置文件，其中最重要的两个配置文件是server.xml和web.xml<br><strong>lib</strong>        主要存放tomcat运行所依赖的包<br><strong>logs</strong>    主要存放运行时产生的日志文件，例如catalina.{date}.log等<br><strong>temp</strong>    存放tomcat运行时产生的临时文件，例如开启了hibernate缓存的应用程序，会在该目录下生成一些文件<br><strong>webapps</strong>    部署web应用程序的默认目录<br><strong>work</strong>    主要存放由JSP文件生成的servlet（java文件以及最终编译生成的class文件）</p><p>CATALINA_HOME：即指向Tomcat安装路径的系统变量<br>CATALINA_BASE：即指向活跃配置路径的系统变量<br>通过设置这两个变量，就可以将tomcat的安装目录和工作目录分离，从而实现tomcat多实例的部署。</p><p><img src="/images/2017/0502/01.png" alt="tomcat"><br>将tomcat复制为以下目录结构<br><img src="/images/2017/0502/00.png" alt="tomcat"></p><h1 id="修改-CATALINA-HOME-conf-server-xml"><a href="#修改-CATALINA-HOME-conf-server-xml" class="headerlink" title="修改$CATALINA_HOME/conf/server.xml"></a>修改$CATALINA_HOME/conf/server.xml</h1><p>在server.xml中配置了四个监听端口，分别是：<br><strong>Server Port：</strong>    该端口用于监听关闭tomcat的shutdown命令，默认为8005<br><strong>Connector Port：</strong>    该端口用于监听HTTP的请求，默认为8080<br><strong>AJP Port：</strong>        该端口用于监听AJP（ Apache JServ Protocol ）协议上的请求，通常用于整合Apache Server等其他HTTP服务器，默认为8009<br><strong>Redirect Port：</strong>    重定向端口，出现在Connector配置中，如果该Connector仅支持非SSL的普通http请求，那么该端口会把https的请求转发到这个Redirect Port指定的端口，默认为8443</p><p>修改第22行Server Port （三个tomcat依次修改为8005,8006,8007）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;Server port=&quot;8007&quot; shutdown=&quot;SHUTDOWN&quot;&gt;</div></pre></td></tr></table></figure></p><p>修改第71行Connector Port(三个tomcat依次修改为8080,8081,8082)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;Connector port=&quot;8082&quot; protocol=&quot;HTTP/1.1&quot;</div></pre></td></tr></table></figure></p><p>修改第93行AJP Port (三个tomcat依次修改为8009,8019,8029)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;Connector port=&quot;8029&quot; protocol=&quot;AJP/1.3&quot; redirectPort=&quot;8443&quot; /&gt;</div></pre></td></tr></table></figure></p><p>虚拟主机配置<br><strong>name：</strong>        虚拟主机的名称，一台主机表示了完全限定的域名或IP地址，默认为localhost，同时也是唯一的host，进入tomcat的所有http请求都会映射到该主机上<br><strong>appBase：</strong>        web应用程序目录的路径，可以是CATALINA_HOME的相对路径，也可以写成绝对路径，默认情况下为$CATALINA_HOME/webapps<br><strong>unpackWARs：</strong>    表示是否自动解压war包<br><strong>autoDeploy：</strong>    所谓的热部署，即在tomcat正在运行的情况下，如果有新的war加入，则会立即执行部署操作<br><strong>deployOnStartup：</strong>    表示tomcat启动时是否自动部署appBase目录下所有的Web应用程序，默认为true。这个属性和autoDeploy会产生两次部署的“副作用”：一次是tomcat启动时就开始部署，第二次就是autoDeploy引起的热部署。因此最好将autoDeploy置为false</p><p>修改第125-127行虚拟主机配置 (三个tomcat参考以下内容依次修改)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;Host name=&quot;c.com&quot;  appBase=&quot;/data/tomcat/c.com/&quot;</div><div class="line">            unpackWARs=&quot;true&quot; autoDeploy=&quot;false&quot;&gt;</div><div class="line">&lt;Context path=&quot;/hello&quot; docBase=&quot;/data/tomcat/c.com/hello.war&quot; /&gt;</div></pre></td></tr></table></figure></p><h1 id="启动-amp-关闭脚本"><a href="#启动-amp-关闭脚本" class="headerlink" title="启动&amp;关闭脚本"></a>启动&amp;关闭脚本</h1><p>脚本放在CATALINA_BASE(如：/opt/tomcat1/)下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">#!/bin/sh</div><div class="line"># description: 启动tomcat多实例.</div><div class="line">. /etc/init.d/functions</div><div class="line">RETVAL=$?</div><div class="line"># tomcat实例目录</div><div class="line">export CATALINA_BASE=&quot;$PWD&quot;</div><div class="line"># tomcat安装目录</div><div class="line">export CATALINA_HOME=&quot;/opt/&quot;</div><div class="line">case &quot;$1&quot; in</div><div class="line">start)</div><div class="line">if [ -f $CATALINA_HOME/bin/startup.sh ];then</div><div class="line">echo $&quot;Start Tomcat&quot;</div><div class="line">$CATALINA_HOME/bin/startup.sh</div><div class="line">fi</div><div class="line">;;</div><div class="line">stop)</div><div class="line">if [ -f $CATALINA_HOME/bin/shutdown.sh ];then</div><div class="line">echo $&quot;Stop Tomcat&quot;</div><div class="line">$CATALINA_HOME/bin/shutdown.sh</div><div class="line">fi</div><div class="line">;;</div><div class="line">*)</div><div class="line">echo $&quot;Usage: $0 &#123;start|stop&#125;&quot;</div><div class="line">exit 1</div><div class="line">;;</div><div class="line">esac</div><div class="line">exit $RETVAL</div></pre></td></tr></table></figure></p><blockquote><p><strong>因为启动脚本中有获取当前路径的操作，一定需要cd到tomcat.sh的当前目录下执行才可以</strong></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">cd /opt/tomcat1</div><div class="line">./tomcat.sh start|stop</div><div class="line">cd /opt/tomcat2</div><div class="line">./tomcat.sh start|stop</div><div class="line">cd /opt/tomcat3</div><div class="line">./tomcat.sh start|stop</div></pre></td></tr></table></figure><p>访问8080,8081,8082端口验证</p><p>参考地址：<br><a href="http://www.jianshu.com/p/0b549d00ecc2" target="_blank" rel="external">http://www.jianshu.com/p/0b549d00ecc2</a><br><a href="http://www.ttlsa.com/tomcat/config-multi-tomcat-instance/" target="_blank" rel="external">http://www.ttlsa.com/tomcat/config-multi-tomcat-instance/</a></p>]]></content>
      
      <categories>
          
          <category> 服务器搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tomcat </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>jenkins 持续集成环境搭建</title>
      <link href="/arlo/c0b31722/"/>
      <content type="html"><![CDATA[<h1 id="持续集成"><a href="#持续集成" class="headerlink" title="持续集成"></a>持续集成</h1><blockquote><p> 持续集成（CI）是一种软件工程流程，将所有工程师对于软件的工作复本，每天集成数次到共用主线（mainline）上。</p></blockquote><h2 id="依赖以下原则达到目标"><a href="#依赖以下原则达到目标" class="headerlink" title="依赖以下原则达到目标"></a>依赖以下原则达到目标</h2><ul><li>维护一个代码库</li><li>自动建置</li><li>让建置时会自我测试</li><li>所有人每天至少提交一次</li><li>应该要建置每一个提交</li><li>让建置维持快速</li><li>用在线环境的复本测试</li><li>让获取最新发布版本更容易</li><li>任何人都可以查看最后建置的结果</li><li>自动部署</li></ul><h2 id="产生的效益"><a href="#产生的效益" class="headerlink" title="产生的效益"></a>产生的效益</h2><ul><li>及早发现集成错误且由于修订的内容较小所以易于追踪，这可以节省项目的时间与成本。</li><li>避免发布日期的前一分钟发生混乱，当每个人都会尝试为他们所造成的那一点点不兼容的版本做检查。</li><li>当单元测试失败或发生错误，若开发人员需要在不除错的情况下还原代码库到一个没有问题的状态，只需要放弃一小部分的更改 (因为集成的次数频繁)。</li><li>让 “最新” 的程序可保持可用的状态供测试、展示或发布用。</li><li>频繁的提交代码会促使开发人员创建模块化，低复杂性的代码。<a id="more"></a>Jenkins是一个用Java编写的开源的持续集成工具，前身是Hudson (软件)项目，有丰富的插件支持；</li></ul><h1 id="Jenkins安装"><a href="#Jenkins安装" class="headerlink" title="Jenkins安装"></a>Jenkins安装</h1><h2 id="安装jdk"><a href="#安装jdk" class="headerlink" title="安装jdk"></a>安装jdk</h2><p>jdk下载地址： <a href="http://www.oracle.com/technetwork/java/archive-139210.html" target="_blank" rel="external">http://www.oracle.com/technetwork/java/archive-139210.html</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tar xf jdk-8u112-linux-x64.tar.gz -C /usr/local/</div></pre></td></tr></table></figure></p><p>配置jdk环境变量<br>vim /etc/profile<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">export JAVA_HOME=/usr/local/jdk1.8.0_112</div><div class="line">export CLASSPATH=.:$JAVA_HOME/lib/:$JAVA_HOME/jre/lib/</div><div class="line">export PATH=$JAVA_HOME/bin:$PATH</div></pre></td></tr></table></figure></p><h2 id="安装jenkins"><a href="#安装jenkins" class="headerlink" title="安装jenkins"></a>安装jenkins</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo</div><div class="line">rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key</div><div class="line">yum install jenkins</div></pre></td></tr></table></figure><p>添加java路径到jenkins启动脚本中<br>vim /etc/init.d/jenkins<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/local/jdk1.8.0_112/bin/java</div></pre></td></tr></table></figure></p><p><img src="/images/2017/0427/00.png" alt="jenkins"><br>修改jenkins默认时区<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">vim /etc/sysconfig/jenkins</div><div class="line">JENKINS_JAVA_OPTIONS=&quot;-Djava.awt.headless=true -Dorg.apache.commons.jelly.tags.fmt.timeZone=Asia/Shanghai&quot;</div></pre></td></tr></table></figure></p><h2 id="启动jenkins"><a href="#启动jenkins" class="headerlink" title="启动jenkins"></a>启动jenkins</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">/etc/init.d/jenkins start</div><div class="line">chkconfig --level 35 jenkins on</div></pre></td></tr></table></figure><p>访问路径 <a href="http://192.168.6.102:8080" target="_blank" rel="external">http://192.168.6.102:8080</a><br>默认密码存在这个文件中 /var/lib/jenkins/secrets/initialAdminPassword<br><img src="/images/2017/0427/01.png" alt="jenkins"><br>创建一个管理用户<br><img src="/images/2017/0427/02.png" alt="jenkins"><br><img src="/images/2017/0427/03.png" alt="jenkins"></p><h1 id="Jenkins-配置"><a href="#Jenkins-配置" class="headerlink" title="Jenkins 配置"></a>Jenkins 配置</h1><h2 id="全局工具配置"><a href="#全局工具配置" class="headerlink" title="全局工具配置"></a>全局工具配置</h2><p>点击系统配置-Global Tool Configuration<br><img src="/images/2017/0427/04.png" alt="jenkins"><br>针对项目中使用的jdk和maven情况添加对应的版本<br><img src="/images/2017/0427/05.png" alt="jenkins"></p><h2 id="插件安装配置"><a href="#插件安装配置" class="headerlink" title="插件安装配置"></a>插件安装配置</h2><p>点击系统配置-插件管理<br><img src="/images/2017/0427/06.png" alt="jenkins"></p><ul><li>可选插件直接安装<br>右上角的过滤功能很好用，可以直接搜索安装<br>安装以下插件<br>Hudson SCP publisher plugin<br>Deploy to container Plugin<br>Maven Integration plugin<br>Publish Over SSH<br>Publish Over CIFS<br>Backup plugin / ThinBackup<br>Email Ext Recipients Column Plugin</li><li>高级选项中上传插件安装<br><a href="http://mirrors.jenkins-ci.org/plugins/" target="_blank" rel="external">http://mirrors.jenkins-ci.org/plugins/</a><br>安装完插件之后，建议重启一下jenkins，防止插件未加载上，不生效；</li></ul><h1 id="发布一个静态网站"><a href="#发布一个静态网站" class="headerlink" title="发布一个静态网站"></a>发布一个静态网站</h1><h2 id="配置Hudson-SCP-publisher-plugin插件"><a href="#配置Hudson-SCP-publisher-plugin插件" class="headerlink" title="配置Hudson SCP publisher plugin插件"></a>配置Hudson SCP publisher plugin插件</h2><p>此插件用于发布静态网站，拷贝文件很方便<br><img src="/images/2017/0427/07.png" alt="jenkins"><br>配置需要发布的服务器hostname，端口，路径，用户名，密码（如果是正式环境，不建议使用root用户）</p><blockquote><p>ps:这里有个小技巧，如果这台机器上有多个静态网站目录的话，可以在服务器设置多个hosts记录，这里使用主机名来分区不同的路径</p></blockquote><h2 id="新建一个软件项目test"><a href="#新建一个软件项目test" class="headerlink" title="新建一个软件项目test"></a>新建一个软件项目test</h2><p><img src="/images/2017/0427/08.png" alt="jenkins"><br>源码管理：<br>填写svn路径<br>有获取代码权限的用户名密码<br><img src="/images/2017/0427/09.png" alt="jenkins"><br>构建后操作：<br>选择需要scp的路径<br>Source ** 表示所有<br>Keep Hierarchy  保持目录结构（否则不能拷贝文件夹）<br><img src="/images/2017/0427/10.png" alt="jenkins"><br>点击立即构建<br><img src="/images/2017/0427/11.png" alt="jenkins"><br>通过 Console Output可以看到详细日志<br><img src="/images/2017/0427/12.png" alt="jenkins"><br>至此，一个静态网站就发布完成了！</p><h1 id="发布一个java后台工程"><a href="#发布一个java后台工程" class="headerlink" title="发布一个java后台工程"></a>发布一个java后台工程</h1><h2 id="安装Deploy-to-container-Plugin插件"><a href="#安装Deploy-to-container-Plugin插件" class="headerlink" title="安装Deploy to container Plugin插件"></a>安装Deploy to container Plugin插件</h2><p>此插件可以将war/ear 包发布到tomcat，glassfish，jetty，weblogic等中间件上</p><h2 id="配置tomcat-web管理"><a href="#配置tomcat-web管理" class="headerlink" title="配置tomcat web管理"></a>配置tomcat web管理</h2><p>vim /usr/local/apache-tomcat-7.0.77/conf/tomcat-users.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;role rolename=&quot;tomcat&quot;/&gt;</div><div class="line">&lt;role rolename=&quot;role1&quot;/&gt;</div><div class="line">&lt;role rolename=&quot;manager-gui&quot;/&gt;</div><div class="line">&lt;role rolename=&quot;manager-gui,manager-script,manager-jmx,manager-status&quot;/&gt;</div><div class="line">&lt;user username=&quot;tomcat&quot; password=&quot;tomcat&quot; roles=&quot;manager-gui&quot;/&gt;</div><div class="line">&lt;user username=&quot;admin&quot; password=&quot;admin&quot; roles=&quot;manager-gui,manager-script,manager-jmx,manager-status&quot;/&gt;</div></pre></td></tr></table></figure></p><p>由于jenkins把8080端口占用，我这里修改tomcat端口为8081<br>vim /usr/local/apache-tomcat-7.0.77/conf/server.xml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;Connector port=&quot;8081&quot; protocol=&quot;HTTP/1.1&quot;</div></pre></td></tr></table></figure></p><h2 id="一个简单的maven工程代码"><a href="#一个简单的maven工程代码" class="headerlink" title="一个简单的maven工程代码"></a>一个简单的maven工程代码</h2><p><a href="https://github.com/nsxq/hello-world-war" target="_blank" rel="external">https://github.com/nsxq/hello-world-war</a></p><h2 id="maven-的简单使用"><a href="#maven-的简单使用" class="headerlink" title="maven 的简单使用"></a>maven 的简单使用</h2><p>查看版本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn -version</div></pre></td></tr></table></figure></p><p>查看详细信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn X</div></pre></td></tr></table></figure></p><p>测试<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn test</div></pre></td></tr></table></figure></p><p>清理（target目录下的编译内容）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn clean</div></pre></td></tr></table></figure></p><p>编译项目<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn compile</div></pre></td></tr></table></figure></p><p>打包发布<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn package</div></pre></td></tr></table></figure></p><p>生成eclipse项目文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn eclipse:eclipse</div></pre></td></tr></table></figure></p><p>产生site<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn site</div></pre></td></tr></table></figure></p><p>安装当前工程的jar安装到本地仓库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn install</div></pre></td></tr></table></figure></p><p>安装jar包到本地仓库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn install:install-file -DgroupId=com.oracle -DartifactId=ojdbc14 -Dversion=10.2.0.4.0 -Dpackaging=jar -Dfile=/usr/local/src/ojdbc14-10.2.0.4.0.jar</div></pre></td></tr></table></figure></p><p>分析项目的依赖信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn dependency:analyze / mvn dependency:tree</div></pre></td></tr></table></figure></p><h2 id="新建一个maven工程"><a href="#新建一个maven工程" class="headerlink" title="新建一个maven工程"></a>新建一个maven工程</h2><p>获取代码<br><img src="/images/2017/0427/14.png" alt="jenkins"><br>编译参数<br><img src="/images/2017/0427/15.png" alt="jenkins"><br>构建后发布<br><img src="/images/2017/0427/16.png" alt="jenkins"><br>点击立即构建<br>查看日志，已经发布完成了<br><img src="/images/2017/0427/17.png" alt="jenkins"><br>访问项目<br><a href="http://192.168.6.102:8081/hello" target="_blank" rel="external">http://192.168.6.102:8081/hello</a><br><img src="/images/2017/0427/18.png" alt="jenkins"><br>至此，一个maven工程已经实现自动化编译、打包、发布！</p><h1 id="版本回退"><a href="#版本回退" class="headerlink" title="版本回退"></a>版本回退</h1><p>有时候发布一个新版本失败或发布有问题，我们需要回滚到指定版本的构建，这样才能更灵活的进行项目的构建部署。我们可以选择“参数化的构建过程”进行传递不同的参数来选择是进行新的构建还是退</p><h2 id="对文件进行存档"><a href="#对文件进行存档" class="headerlink" title="对文件进行存档"></a>对文件进行存档</h2><p>为了能够进行版本回退，构建完成的需要对文件进行存档<br><img src="/images/2017/0427/19.png" alt="jenkins"></p><h2 id="使用参数化构建过程"><a href="#使用参数化构建过程" class="headerlink" title="使用参数化构建过程"></a>使用参数化构建过程</h2><p>让后面的脚步可以根据不同的变量执行不同的操作。添加“Choice”参数配置不同的选项，让选择发布还是回滚，添加“String Parameter”参数来传递要回退的版本号。<br><img src="/images/2017/0427/20.png" alt="jenkins"></p><h2 id="构建选择“Execute-Shell”的方式"><a href="#构建选择“Execute-Shell”的方式" class="headerlink" title="构建选择“Execute Shell”的方式"></a>构建选择“Execute Shell”的方式</h2><p>自己根据变量，自定义构建的脚本，此时如果是发布安装maven的构建过程进行新的构建，如果是回滚，知道历史构建后的文件，复制到当前构建结果目录。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">case $deploy_env in</div><div class="line">deploy)</div><div class="line">    echo &quot;deploy:$deploy_env&quot;</div><div class="line">        mvn clean test compile install package</div><div class="line">        ;;</div><div class="line">    rollback)</div><div class="line">    echo &quot;rollback:$deploy_env&quot;</div><div class="line">        echo &quot;version: $version&quot;</div><div class="line">        rm -fr target/hello-1.war</div><div class="line">        cp -R $&#123;JENKINS_HOME&#125;/jobs/myapp/builds/$&#123;version&#125;/com.efsavage\$hello/archive/com.efsavage/hello/1/hello-1.war .</div><div class="line">        pwd &amp;&amp; ls</div><div class="line">        ;;</div><div class="line">*)</div><div class="line">    exit</div><div class="line">    ;;</div><div class="line">esac</div></pre></td></tr></table></figure></p><h2 id="执行回退操作"><a href="#执行回退操作" class="headerlink" title="执行回退操作"></a>执行回退操作</h2><p>点击构建，根据不同的参数选择发布还是版本回退，回退的时候填写要回退到的历史版本号<br><img src="/images/2017/0427/21.png" alt="jenkins"><br><img src="/images/2017/0427/22.png" alt="jenkins"></p><p>PS: Tomcat8配置web管理后，Tomcat访问 manager页面 报403的解决办法：<a href="https://blog.52itstyle.com/archives/274/" target="_blank" rel="external">https://blog.52itstyle.com/archives/274/</a></p>]]></content>
      
      <categories>
          
          <category> 自动化运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 自动化 </tag>
            
            <tag> 运维 </tag>
            
            <tag> Jenkins </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>使用 Cobbler 自动化和管理系统安装</title>
      <link href="/arlo/bb0f7c70/"/>
      <content type="html"><![CDATA[<p>Cobbler是一套快速搭建网络自动化安装操作系统的软件，个人感觉是PXE的升级版;提供cli和web两种管理方式，还提供API接口<br><a id="more"></a><br>系统环境：<br>Centos7_x64<br>Iptables off<br>Selinux  disabled</p><h1 id="Cobbler对象类型"><a href="#Cobbler对象类型" class="headerlink" title="Cobbler对象类型"></a>Cobbler对象类型</h1><p><strong>发行版（distro）</strong>：表示一个操作系统。它承载了内核和 initrd 的信息，以及内核参数等其他数据。<br><strong>配置文件（profile）</strong>：包含一个发行版、一个 kickstart 文件以及可能的存储库，还包含更多特定的内核参数等其他数据。<br><strong>系统（system）</strong>：表示要配给的机器。它包含一个配置文件或一个镜像，还包含 IP 和 MAC 地址、电源管理（地址、凭据、类型）以及更为专业的数据等信息。<br><strong>存储库（repository）</strong>：保存一个 yum 或 rsync 存储库的镜像信息。<br><strong>镜像（image）</strong>：可替换一个包含不属于此类别的文件的发行版对象（例如，无法分为内核和 initrd 的对象）。<br>基于注册的对象以及各个对象之间的关联，Cobbler 知道如何更改文件系统以反映具体配置。因为系统配置的内部是抽象的，所以您可以仅关注想要执行的操作。<br><img src="/images/2017/0420/00.png" alt="cobbler"></p><h1 id="Cobbler安装"><a href="#Cobbler安装" class="headerlink" title="Cobbler安装"></a>Cobbler安装</h1><h2 id="安装系统扩展包"><a href="#安装系统扩展包" class="headerlink" title="安装系统扩展包"></a>安装系统扩展包</h2><p>安装后报错可以参考<br><a href="http://islocal.cc/2017/04/06/yum-安装epel扩展后报错/">http://islocal.cc/2017/04/06/yum-安装epel扩展后报错/</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install epel-release</div></pre></td></tr></table></figure></p><h2 id="安装需要的其他组件"><a href="#安装需要的其他组件" class="headerlink" title="安装需要的其他组件"></a>安装需要的其他组件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install rsync tftp httpd pykickstart xinetd</div></pre></td></tr></table></figure><h2 id="安装cobbler程序包和fence代理包"><a href="#安装cobbler程序包和fence代理包" class="headerlink" title="安装cobbler程序包和fence代理包"></a>安装cobbler程序包和fence代理包</h2><p>fence代理包是执行电源管理活动的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install cobbler fence-agents</div></pre></td></tr></table></figure></p><h2 id="启动cobbler-服务"><a href="#启动cobbler-服务" class="headerlink" title="启动cobbler 服务"></a>启动cobbler 服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">systemctl start cobblerd httpd</div></pre></td></tr></table></figure><h2 id="检查配置文件"><a href="#检查配置文件" class="headerlink" title="检查配置文件"></a>检查配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cobbler check</div></pre></td></tr></table></figure><p><img src="/images/2017/0420/01.png" alt="cobbler"></p><h3 id="Q1：修改cobbler服务器地址"><a href="#Q1：修改cobbler服务器地址" class="headerlink" title="Q1：修改cobbler服务器地址"></a>Q1：修改cobbler服务器地址</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">server: 192.168.6.103</div></pre></td></tr></table></figure><h3 id="Q2：修改dhcp服务器地址"><a href="#Q2：修改dhcp服务器地址" class="headerlink" title="Q2：修改dhcp服务器地址"></a>Q2：修改dhcp服务器地址</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">next_server: 192.168.6.103</div></pre></td></tr></table></figure><h3 id="Q3：修改-etc-selinux-config配置"><a href="#Q3：修改-etc-selinux-config配置" class="headerlink" title="Q3：修改/etc/selinux/config配置"></a>Q3：修改/etc/selinux/config配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SELINUX=disabled</div></pre></td></tr></table></figure><h3 id="Q4：修改-etc-xinetd-d-tftp-配置"><a href="#Q4：修改-etc-xinetd-d-tftp-配置" class="headerlink" title="Q4：修改/etc/xinetd.d/tftp 配置"></a>Q4：修改/etc/xinetd.d/tftp 配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">disable= no</div></pre></td></tr></table></figure><h3 id="Q5：下载需要的网络引导文件"><a href="#Q5：下载需要的网络引导文件" class="headerlink" title="Q5：下载需要的网络引导文件"></a>Q5：下载需要的网络引导文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cobbler get-loaders</div></pre></td></tr></table></figure><h3 id="Q6：启动并设置开机启动rsyncd服务"><a href="#Q6：启动并设置开机启动rsyncd服务" class="headerlink" title="Q6：启动并设置开机启动rsyncd服务"></a>Q6：启动并设置开机启动rsyncd服务</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">systemctl start rsyncd.service</div><div class="line">systemctl enable rsyncd.service</div></pre></td></tr></table></figure><h3 id="Q7：这个是基于debian操作系统的错误"><a href="#Q7：这个是基于debian操作系统的错误" class="headerlink" title="Q7：这个是基于debian操作系统的错误"></a>Q7：这个是基于debian操作系统的错误</h3><p>centos系统下忽略，不予处理</p><h3 id="Q8：修改安装系统后默认的root密码为’ffffff’"><a href="#Q8：修改安装系统后默认的root密码为’ffffff’" class="headerlink" title="Q8：修改安装系统后默认的root密码为’ffffff’"></a>Q8：修改安装系统后默认的root密码为’ffffff’</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">openssl passwd -1 -salt &apos;random123&apos; &apos;ffffff&apos;</div><div class="line">vim /etc/cobbler/settings</div><div class="line">default_password_crypted: &quot;$1$random12$KuDtGsOHnRfzasr7D4qI40&quot;</div></pre></td></tr></table></figure><h1 id="配置Cobbler"><a href="#配置Cobbler" class="headerlink" title="配置Cobbler"></a>配置Cobbler</h1><h2 id="编辑主配置文件"><a href="#编辑主配置文件" class="headerlink" title="编辑主配置文件"></a>编辑主配置文件</h2><p>vim /etc/cobbler/settings<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">manage_dhcp: 1   </div><div class="line">manage_dns: 1</div><div class="line">manage_tftpd: 1</div><div class="line">restart_dns: 1</div><div class="line">restart_dhcp: 1</div><div class="line">pxe_just_once: 1</div><div class="line">next_server: &lt;dhcp服务器地址，即本机&gt;</div><div class="line">server:&lt;cobbler 服务器地址&gt;</div></pre></td></tr></table></figure></p><p>以上部分选项之前已经配置或者默认选项已符合要求<br><strong>manage cobbler</strong>可以管理服务<br><strong>restart cobbler</strong> 可以重启服务<br><strong>pxe_just_once</strong> 预防将机器中的安装循环配置为始终从网络引导。激活此选项时，机器告诉 Cobbler 安装已完成</p><h2 id="指定cobbler管理服务使用的程序"><a href="#指定cobbler管理服务使用的程序" class="headerlink" title="指定cobbler管理服务使用的程序"></a>指定cobbler管理服务使用的程序</h2><p>vim /etc/cobbler/modules.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[dns]</div><div class="line">module = manage_dnsmasq</div><div class="line">[dhcp]</div><div class="line">module = manage_dnsmasq</div><div class="line">[tftpd]</div><div class="line">module = manage_in_tftpd</div></pre></td></tr></table></figure></p><h2 id="配置dhcp服务"><a href="#配置dhcp服务" class="headerlink" title="配置dhcp服务"></a>配置dhcp服务</h2><p>使用dnsmasq提供dns和dhcp服务<br>这里要保证dhcp设置的ip网段要和本机在同一网段，否则client找不到dhcp服务器</p><blockquote><p>通常，您希望阻止未注册的客户端从服务器引导。为此，添加参数 dhcp-ignore=tag:!known。（在以前的版本中，语法可能有所不同：dhcp-ignore=#known。如果有疑问，您可以同时插入两个版本。）</p></blockquote><p>vim /etc/cobbler/dnsmasq.template<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dhcp-range=192.168.6.200,192.168.6.210,255.255.255.0</div></pre></td></tr></table></figure></p><h2 id="同步cobbler数据"><a href="#同步cobbler数据" class="headerlink" title="同步cobbler数据"></a>同步cobbler数据</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cobbler sync</div></pre></td></tr></table></figure><h2 id="重启服务"><a href="#重启服务" class="headerlink" title="重启服务"></a>重启服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">systemctl restart httpd cobblerd xinetd rsyncd dnsmasq</div></pre></td></tr></table></figure><p>客户机从网络启动，可以看到已经可以获取到ip地址了<br><img src="/images/2017/0420/02.png" alt="cobbler"></p><h1 id="创建操作系统"><a href="#创建操作系统" class="headerlink" title="创建操作系统"></a>创建操作系统</h1><h2 id="创建一个发行版本"><a href="#创建一个发行版本" class="headerlink" title="创建一个发行版本"></a>创建一个发行版本</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mkdir /opt/centos6.9/</div><div class="line">mount -o loop /opt/CentOS-6.9-x86_64-bin-DVD1.iso /opt/centos6.9/</div><div class="line">cobbler import --path=/opt/centos6.9/ --name=&quot;Centos6.9&quot;</div></pre></td></tr></table></figure><p><img src="/images/2017/0420/03.png" alt="cobbler"></p><h2 id="查看发行版本"><a href="#查看发行版本" class="headerlink" title="查看发行版本"></a>查看发行版本</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cobbler distro list</div><div class="line">cobbler distro report</div></pre></td></tr></table></figure><p><img src="/images/2017/0420/04.png" alt="cobbler"></p><h2 id="查看配置文件"><a href="#查看配置文件" class="headerlink" title="查看配置文件"></a>查看配置文件</h2><p>可以看到这里默认的ks文件是sample_end.ks<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cobbler profile list</div><div class="line">cobbler profile report</div></pre></td></tr></table></figure></p><p><img src="/images/2017/0420/05.png" alt="cobbler"></p><h2 id="使用自定义ks文件"><a href="#使用自定义ks文件" class="headerlink" title="使用自定义ks文件"></a>使用自定义ks文件</h2><ul><li>使用图形化system-config-kickstart工具创建ks文件</li><li>使用系统生成的ks文件模板修改<br>kiskstart 文件内容<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div></pre></td><td class="code"><pre><div class="line"># kickstart template for Fedora 8 and later.</div><div class="line"># (includes %end blocks)</div><div class="line"># do not use with earlier distros</div><div class="line"></div><div class="line">#platform=x86, AMD64, or Intel EM64T</div><div class="line"># System authorization information</div><div class="line">auth  --useshadow  --enablemd5</div><div class="line"># System bootloader configuration</div><div class="line">bootloader --location=mbr</div><div class="line"># Partition clearing information</div><div class="line">clearpart --all --initlabel</div><div class="line"># Use text mode install</div><div class="line">text</div><div class="line"># Firewall configuration</div><div class="line">firewall --disable</div><div class="line"># Run the Setup Agent on first boot</div><div class="line">firstboot --disable</div><div class="line"># System keyboard</div><div class="line">keyboard us</div><div class="line"># System language</div><div class="line">lang en_US</div><div class="line"># Use network installation</div><div class="line">url --url=$tree</div><div class="line"># If any cobbler repo definitions were referenced in the kickstart profile, include them here.</div><div class="line">$yum_repo_stanza</div><div class="line"># Network information</div><div class="line">$SNIPPET(&apos;network_config&apos;)</div><div class="line"># Reboot after installation</div><div class="line">reboot</div><div class="line"></div><div class="line">#Root password</div><div class="line">rootpw --iscrypted $default_password_crypted</div><div class="line"># SELinux configuration</div><div class="line">selinux --disabled</div><div class="line"># Do not configure the X Window System</div><div class="line">skipx</div><div class="line"># System timezone</div><div class="line">timezone  Asia/Shanghai</div><div class="line"># Install OS instead of upgrade</div><div class="line">install</div><div class="line"># Clear the Master Boot Record</div><div class="line">zerombr</div><div class="line"># Allow anaconda to partition the system as needed</div><div class="line">autopart</div><div class="line"></div><div class="line">%pre</div><div class="line">$SNIPPET(&apos;log_ks_pre&apos;)</div><div class="line">$SNIPPET(&apos;kickstart_start&apos;)</div><div class="line">$SNIPPET(&apos;pre_install_network_config&apos;)</div><div class="line"># Enable installation monitoring</div><div class="line">$SNIPPET(&apos;pre_anamon&apos;)</div><div class="line">%end</div><div class="line"></div><div class="line">%packages</div><div class="line">$SNIPPET(&apos;func_install_if_enabled&apos;)</div><div class="line">@base</div><div class="line">@development</div><div class="line">%end</div><div class="line"></div><div class="line">%post --nochroot</div><div class="line">$SNIPPET(&apos;log_ks_post_nochroot&apos;)</div><div class="line">%end</div><div class="line"></div><div class="line">%post</div><div class="line">$SNIPPET(&apos;log_ks_post&apos;)</div><div class="line"># Start yum configuration</div><div class="line">$yum_config_stanza</div><div class="line"># End yum configuration</div><div class="line">$SNIPPET(&apos;post_install_kernel_options&apos;)</div><div class="line">$SNIPPET(&apos;post_install_network_config&apos;)</div><div class="line">$SNIPPET(&apos;func_register_if_enabled&apos;)</div><div class="line">$SNIPPET(&apos;download_config_files&apos;)</div><div class="line">$SNIPPET(&apos;koan_environment&apos;)</div><div class="line">$SNIPPET(&apos;redhat_register&apos;)</div><div class="line">$SNIPPET(&apos;cobbler_register&apos;)</div><div class="line"># Enable post-install boot notification</div><div class="line">$SNIPPET(&apos;post_anamon&apos;)</div><div class="line"># Start final steps</div><div class="line">$SNIPPET(&apos;kickstart_done&apos;)</div><div class="line"># End final steps</div><div class="line">%end</div></pre></td></tr></table></figure></li></ul><h3 id="添加一个profile"><a href="#添加一个profile" class="headerlink" title="添加一个profile"></a>添加一个profile</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cobbler profile add --distro=&quot;Centos6.9-x86_64&quot; --name=centos6.9_customized \</div><div class="line">--kickstart=/var/lib/cobbler/kickstarts/CentOS6.9_cust.cfg</div></pre></td></tr></table></figure><p>###　修改已有的profile<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cobbler profile edit --name=centos6.9_customized --kickstart=/var/lib/cobbler/kickstarts/CentOS6.9_cust.cfg</div></pre></td></tr></table></figure></p><h2 id="添加第三方yum仓库"><a href="#添加第三方yum仓库" class="headerlink" title="添加第三方yum仓库"></a>添加第三方yum仓库</h2><p>这一步好像有点问题会报错，网上资料说这是一个bug<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cobbler repo add --name=163mirrors --mirror=http://mirrors.163.com/centos/6.9/os/x86_64/</div><div class="line">cobbler reposync</div><div class="line">cobbler repo report</div></pre></td></tr></table></figure></p><p>将仓库文件与配置文件（profile）关联起来<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cobbler profile edit --name=Centos6.9-x86_64 --repos=163mirros</div></pre></td></tr></table></figure></p><h1 id="安装web管理界面"><a href="#安装web管理界面" class="headerlink" title="安装web管理界面"></a>安装web管理界面</h1><h2 id="安装cobbler-web包"><a href="#安装cobbler-web包" class="headerlink" title="安装cobbler-web包"></a>安装cobbler-web包</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install cobbler-web</div></pre></td></tr></table></figure><h2 id="Cobbler-Web-界面的身份验证和授权配置"><a href="#Cobbler-Web-界面的身份验证和授权配置" class="headerlink" title="Cobbler Web 界面的身份验证和授权配置"></a>Cobbler Web 界面的身份验证和授权配置</h2><p>/etc/cobbler/modules.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[authentication]</div><div class="line">module = authn_pam</div><div class="line">[authorization] = authz_ownership</div></pre></td></tr></table></figure></p><h2 id="新建系统账号并设置密码"><a href="#新建系统账号并设置密码" class="headerlink" title="新建系统账号并设置密码"></a>新建系统账号并设置密码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">useradd cobbler </div><div class="line">echo &quot;cobbler&quot; | passwd --stdin cobbler</div></pre></td></tr></table></figure><h2 id="添加用户到管理组"><a href="#添加用户到管理组" class="headerlink" title="添加用户到管理组"></a>添加用户到管理组</h2><p>vim /etc/cobbler/users.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[admins]</div><div class="line">admin = &quot;cobbler&quot;</div></pre></td></tr></table></figure></p><h2 id="重启服务-1"><a href="#重启服务-1" class="headerlink" title="重启服务"></a>重启服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">systemctl restart cobblerd httpd</div></pre></td></tr></table></figure><h2 id="使用https-url访问"><a href="#使用https-url访问" class="headerlink" title="使用https url访问"></a>使用https url访问</h2><p><a href="https://192.168.6.103/cobbler_web" target="_blank" rel="external">https://192.168.6.103/cobbler_web</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">user：cobbler</div><div class="line">passwd：cobbler</div></pre></td></tr></table></figure></p><p><img src="/images/2017/0420/06.png" alt="cobbler"></p><h1 id="安装操作系统"><a href="#安装操作系统" class="headerlink" title="安装操作系统"></a>安装操作系统</h1><ol><li>开机</li><li>选择从网络引导，dhcp获取ip地址</li><li>选择profile，通过tftp获取引导内核文件</li><li>调用ks文件进行无人值守安装操作系统<br><img src="/images/2017/0420/07.png" alt="cobbler"></li></ol><h1 id="重装操作系统"><a href="#重装操作系统" class="headerlink" title="重装操作系统"></a>重装操作系统</h1><p>这个是针对已经安装操作系统的服务器进行重新安装，个人感觉这种方式除了不用调整从网络启动之外，没看出来比较实用的特性</p><h2 id="在客户端机器安装koan软件"><a href="#在客户端机器安装koan软件" class="headerlink" title="在客户端机器安装koan软件"></a>在客户端机器安装koan软件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">yum -y install epel</div><div class="line">yum -y install koan</div></pre></td></tr></table></figure><h2 id="Koan-用法"><a href="#Koan-用法" class="headerlink" title="Koan 用法"></a>Koan 用法</h2><p>查看cobbler server 上的profile文件列表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">koan --server=192.168.6.250 --list=profiles</div></pre></td></tr></table></figure></p><p>查看profile详细信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">koan --server=192.168.6.250 --display --profile=Centos6.9-x86_64</div></pre></td></tr></table></figure></p><p>下次重启时重装操作系统<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">koan --server=192.168.6.250 -replace-self --profile=Centos6.9-x86_64</div><div class="line">reboot</div></pre></td></tr></table></figure></p><h1 id="安装windows操作系统"><a href="#安装windows操作系统" class="headerlink" title="安装windows操作系统"></a>安装windows操作系统</h1><h2 id="制作PE-iso镜像"><a href="#制作PE-iso镜像" class="headerlink" title="制作PE iso镜像"></a>制作PE iso镜像</h2><p>下载一个<strong><a href="http://www.wepe.com.cn/" target="_blank" rel="external">PE系统</a></strong><br>上传至cobbler服务器/data目录</p><h2 id="创建一个distro"><a href="#创建一个distro" class="headerlink" title="创建一个distro"></a>创建一个distro</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cobbler distro add --name=&quot;WePe_x64&quot; --kernel=/var/lib/tftpboot/memdisk --initrd=/data/WePE_64_V2.0.iso --kopts=&quot;raw iso&quot;</div></pre></td></tr></table></figure><h2 id="创建空白kickstart文件，并对winPE发行版添加profile"><a href="#创建空白kickstart文件，并对winPE发行版添加profile" class="headerlink" title="创建空白kickstart文件，并对winPE发行版添加profile"></a>创建空白kickstart文件，并对winPE发行版添加profile</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">touch /var/lib/cobbler/kickstarts/WePe_x64.xml</div><div class="line">cobbler profile add --name=WePe_x64 --distro=WePe_x64 --kickstart=/var/lib/cobbler/kickstarts/WePe_x64.xml</div></pre></td></tr></table></figure><h2 id="同步cobbler"><a href="#同步cobbler" class="headerlink" title="同步cobbler"></a>同步cobbler</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cobbler sync</div></pre></td></tr></table></figure><p>windows 操作系统安装这个，目前只是做了一个网络版的PE，网上有教程说使用samba共享镜像，我这里没有成功，可以参考<strong><a href="http://www.zhouweiping.cn/index.php/archives/30/#windows系统安装" target="_blank" rel="external">这篇文章</a></strong>;到这里一个最基本的cobbler自动化安装操作系统的环境就搭建完成了，只是完成了distro和profile部分，后期在学习system部分。</p><p>参考资料：<br><a href="https://www.ibm.com/developerworks/cn/linux/l-cobbler/" target="_blank" rel="external">https://www.ibm.com/developerworks/cn/linux/l-cobbler/</a><br><a href="http://blog.codecp.org/2016/11/02/Centos7部署cobbler/" target="_blank" rel="external">http://blog.codecp.org/2016/11/02/Centos7部署cobbler/</a></p><hr>]]></content>
      
      <categories>
          
          <category> 自动化运维 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 自动化 </tag>
            
            <tag> 运维 </tag>
            
            <tag> Cobbler </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>WRF模型学习（1）--安装篇</title>
      <link href="/arlo/7943f5da/"/>
      <content type="html"><![CDATA[<h1 id="WRF简介"><a href="#WRF简介" class="headerlink" title="WRF简介"></a>WRF简介</h1><p>WRF全称Weather Research and Forecasting Model, 是一个先进的大气建模系统，专为气象研究和数值天气预报而设计。它为大气过程提供了许多选项，可以在各种计算平台上运行。WRF在数千米到数千公里范围内的应用范围广泛，包括以下内容。</p><ul><li>气象研究</li><li>实时NWP </li><li>理想模拟</li><li>数据同化</li><li>地球系统模型耦合</li><li>示范训练和教育支持</li></ul><p>官方网站：<br><a href="http://www.wrf-model.org/index.php" target="_blank" rel="external">http://www.wrf-model.org/index.php</a><br><a href="https://www2.ucar.edu/" target="_blank" rel="external">https://www2.ucar.edu/</a><br><a href="https://zh.wikipedia.org/wiki/NetCDF" target="_blank" rel="external">https://zh.wikipedia.org/wiki/NetCDF</a><br><a id="more"></a></p><h1 id="系统环境"><a href="#系统环境" class="headerlink" title="系统环境"></a>系统环境</h1><p>VMware Wrokstation 12 pro<br>CentOS 6.4 x64</p><h1 id="软件环境"><a href="#软件环境" class="headerlink" title="软件环境"></a>软件环境</h1><p>zlib-1.2.11.tar.gz<br>hdf5-1.8.18.tar<br>netcdf-4.4.1.1.tar.gz<br>netcdf-fortran-4.4.4.tar.gz<br>pgilinux-2016-1610-x86_64.tar.gz<br>WRFV3.8.1.TAR.gz<br>WPSV3.8.1.TAR.gz</p><h1 id="WRF-模型安装"><a href="#WRF-模型安装" class="headerlink" title="WRF 模型安装"></a>WRF 模型安装</h1><p>安装WRF模型的的顺序为：WRF–&gt;WPS–&gt;WRF-chem等<br>WRF模拟系统主要包含WPS和WRF两部分模块： WPS模块全称为WRF Pre-processing System，即WRF预处理系统，用来为WRF模型准备输入数据；如果只是做理想实验(idealized modeling)，就不需要用WPS处理真实数据。<br>WRF模块就是数值求解的模块，它有两个版本：ARW(Advanced Research WRF) 和 NMM(Nonhydrostatic Mesoscale Model)。大多数研究者主要用的都是ARW版本。 除了WPS与WRF两大核心模块外，WRF系统还有很多附加模块：比如用于数据同化的WRF-DA，用于化学传输的WRF-chem，用于林火模拟的WRF-fire。</p><h1 id="安装依赖zlib"><a href="#安装依赖zlib" class="headerlink" title="安装依赖zlib"></a>安装依赖zlib</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># tar xf zlib-1.2.11.tar.gz</div><div class="line"># cd zlib-1.2.11</div><div class="line"># ./configure --prefix=/usr/local/zlib/</div><div class="line"># make &amp;&amp; make install</div></pre></td></tr></table></figure><h1 id="安装依赖hdf5"><a href="#安装依赖hdf5" class="headerlink" title="安装依赖hdf5"></a>安装依赖hdf5</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># tar xf hdf5-1.8.18.tar</div><div class="line"># cd hdf5-1.8.18</div><div class="line">#./configure --prefix=/usr/local/hdf5/ --with-zlib=/usr/local/zlib/</div><div class="line"># make &amp;&amp; make install</div></pre></td></tr></table></figure><h1 id="安装依赖netcdf"><a href="#安装依赖netcdf" class="headerlink" title="安装依赖netcdf"></a>安装依赖netcdf</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># tar xf netcdf-4.4.1.1.tar.gz</div><div class="line"># cd netcdf-4.4.1.1</div><div class="line"># ./configure --prefix=/usr/local/netcdf/ --enable-netcdf-4 LDFLAGS=&quot;-L/usr/local/hdf5/lib/&quot; CPPFLAGS=&quot;-I/usr/local/hdf5/include/&quot;</div><div class="line"># make &amp;&amp; make install</div></pre></td></tr></table></figure><h1 id="安装依赖netcdf-fortran"><a href="#安装依赖netcdf-fortran" class="headerlink" title="安装依赖netcdf-fortran"></a>安装依赖netcdf-fortran</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># tar xf netcdf-fortran-4.4.4.tar.gz </div><div class="line"># cd netcdf-fortran-4.4.4</div><div class="line"># ./configure --prefix=/usr/local/netcdf/ LDFLAGS=&quot;-L/usr/local/netcdf/lib&quot; CPPFLAGS=&quot;-I/usr/local/netcdf/include&quot; FC=gfortran</div><div class="line"># make &amp;&amp; make install</div></pre></td></tr></table></figure><p>此步骤中报错可以查看日志文件config.log 进行解决<br>我遇到的问题configure: error: cannot compute sizeof (off_t)，最终是设置了环境变量解决的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">export LDFLAGS=&quot;-L/usr/local/netcdf/lib/&quot;</div><div class="line">export CPPFLAGS=&quot;-I/usr/local/netcdf/include/&quot;</div><div class="line">export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/netcdf/lib/</div></pre></td></tr></table></figure></p><h1 id="安装WRF模型"><a href="#安装WRF模型" class="headerlink" title="安装WRF模型"></a>安装WRF模型</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># tar xf WRFV3.8.1.TAR.gz </div><div class="line"># cd WRFV3</div><div class="line"># export NETCDF=/usr/local/netcdf/</div><div class="line"># ./configure</div></pre></td></tr></table></figure><p>这里我选择的32，使用gfortran/gcc编译。<br><img src="/images/2017/0406/01.png" alt="插入图片01"><br><strong>serial</strong> 表示串行计算；<br><strong>smpar</strong> 表示内存共享并行计算(shared memory option)，即使用openMP，大部分多核电脑都支持这项功能；<br><strong>dmpar</strong> 表示分布式并行计算(distributed memory option)，即使用MPI 进行并行计算，主要用在计算集群，单个电脑就没必要用了；<br><strong>dm+sm</strong> 表示同时使用openMP与MPI两种并行方式.</p><p>如果使用pgi（选择1）编译的话，需要自行安装pgilinux包，否则会报错”pgf90: Command not found.”<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># ./compile em_real &gt;&amp; compile.log</div></pre></td></tr></table></figure></p><p>编译类型有以下几种<br>WRF-Chem（WRF大气化学模型）<br>em_real （3D真实情况）<br>em_quarter_ss （3D理想的情况下）<br>em_b_wave （3D理想的情况下）<br>em_les （3D理想的情况下）<br>em_heldsuarez （3D理想的情况下）<br>em_tropical_cyclone （3D理想的情况下）<br>em_hill2d_x （2D理想的情况下）<br>em_squall2d_x （2D理想的情况下）<br>em_squall2d_y （ 2d理想情况）<br>em_grav2d_x （2d理想情况）<br>em_seabreeze2d_x （2d理想情况）<br>em_scm_xy （1d理想情况）</p><p>真实情况编译完成后，在main目录下会出现ndown.exe,real.exe, tc.exe, wrf.exe这4个可执行程序；理想情况编译后会生成wrf.exe，ideal.exe 这2个可执行程序。</p><h1 id="安装WPS模型"><a href="#安装WPS模型" class="headerlink" title="安装WPS模型"></a>安装WPS模型</h1><p>要保证WPS和WRFV3在同级目录，configure.wps文件中有相对路径<br>安装依赖包<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># yum -y install libpng libpng-devel jasper jasper-devel libjpeg libjpeg-devel</div><div class="line"># export COMPRESSION_LIBS=-L/usr/lib64/</div><div class="line"># export COMPRESSION_INC=-I/usr/lib64/</div><div class="line"># tar xf WPSV3.8.1.TAR.gz</div><div class="line"># cd WPS</div><div class="line"># ./configure</div></pre></td></tr></table></figure></p><p><img src="/images/2017/0406/02.png" alt="插入图片02"><br>这里选择1即可<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># ./compile</div></pre></td></tr></table></figure></p><p>编译完成后再当前目录下会出现geogrid.exe、metgrid.exe、ungrib.exe 三个可执行程序<br><img src="/images/2017/0406/03.png" alt="插入图片03"><br>到这里WRF模型的安装工作就已经完成了，第一次安装，记录一下!</p><p>参考链接：<br><a href="https://xg1990.com/blog/archives/190" target="_blank" rel="external">https://xg1990.com/blog/archives/190</a><br><a href="http://www2.mmm.ucar.edu/wrf/OnLineTutorial/compilation_tutorial.php" target="_blank" rel="external">http://www2.mmm.ucar.edu/wrf/OnLineTutorial/compilation_tutorial.php</a></p>]]></content>
      
      <categories>
          
          <category> 大气模型 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> WRF </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>yum 安装epel扩展后报错</title>
      <link href="/arlo/ef6f2f28/"/>
      <content type="html"><![CDATA[<p>安装epel扩展后出现的几个问题<br><a id="more"></a></p><h1 id="A1："><a href="#A1：" class="headerlink" title="A1："></a>A1：</h1><p>Error: Cannot retrieve metalink for repository: epel. Please verify its path and try again<br>编辑/etc/yum.repo/epel.repo文件,<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#baseurl</div><div class="line">mirrorlist</div><div class="line">改成</div><div class="line">baseurl</div><div class="line">#mirrorlist</div></pre></td></tr></table></figure></p><h1 id="A2"><a href="#A2" class="headerlink" title="A2:"></a>A2:</h1><p>PYCURL ERROR 7 - “Failed to connect to 2001:4178:5:200::10: Network is unreachable”<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">vim /etc/yum.conf</div><div class="line">[main]</div><div class="line">ip_resolve=4</div></pre></td></tr></table></figure></p><h1 id="A3"><a href="#A3" class="headerlink" title="A3:"></a>A3:</h1><p>[Errno 14] problem making ssl connection<br>[Errno 14] PYCURL ERROR 7 - Failed to connect to 2605:bc80:3010:600:dead:beef:cafe:fed9: Network is unreachable<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">yum install ca-certificates -y</div><div class="line">yum clean all</div><div class="line">yum list</div></pre></td></tr></table></figure></p>]]></content>
      
      <categories>
          
          <category> Troubleshooting </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 常识 </tag>
            
            <tag> epel </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>MPICHI3 并行计算环境搭建</title>
      <link href="/arlo/undefined/"/>
      <content type="html"><![CDATA[<p>新工作接触到HPC高性能计算项目，最近看了一些HPC高性能计算的理论资料，今天搭建MPICHI 并行计算环境，算是开始HPC的学习之路吧！<br><a id="more"></a></p><h1 id="系统环境"><a href="#系统环境" class="headerlink" title="系统环境"></a>系统环境</h1><p>CentOS 6_x64</p><h2 id="设置hosts"><a href="#设置hosts" class="headerlink" title="设置hosts"></a>设置hosts</h2><p>vim /etc/hosts<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">192.168.6.100 vm00</div><div class="line">192.168.6.101 vm01</div><div class="line">192.168.6.102 vm02</div></pre></td></tr></table></figure></p><h2 id="新建用户"><a href="#新建用户" class="headerlink" title="新建用户"></a>新建用户</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># useradd -u 600 pxb</div><div class="line"># echo ffffff|passwd --stdin pxb</div></pre></td></tr></table></figure><h2 id="配置机器ssh无密码连接"><a href="#配置机器ssh无密码连接" class="headerlink" title="配置机器ssh无密码连接"></a>配置机器ssh无密码连接</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># su - pxb</div><div class="line">$ ssh-keygen 默认一直回车</div><div class="line">$ ssh-copy-id vm00</div><div class="line">$ ssh-copy-id vm01</div><div class="line">$ ssh-copy-id vm02</div><div class="line">$ ssh vm00</div><div class="line">$ ssh vm01</div><div class="line">$ ssh vm03</div></pre></td></tr></table></figure><h1 id="安装MPICHI（三台服务器上执行以下相同操作）"><a href="#安装MPICHI（三台服务器上执行以下相同操作）" class="headerlink" title="安装MPICHI（三台服务器上执行以下相同操作）"></a>安装MPICHI（三台服务器上执行以下相同操作）</h1><h2 id="获取mpichi"><a href="#获取mpichi" class="headerlink" title="获取mpichi"></a>获取mpichi</h2><p><a href="https://www.mpich.org/downloads/" target="_blank" rel="external">https://www.mpich.org/downloads/</a></p><h2 id="安装配置MPICHI"><a href="#安装配置MPICHI" class="headerlink" title="安装配置MPICHI"></a>安装配置MPICHI</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># tar -xf mpich-3.2.tar.gz</div><div class="line"># cd mpich-3.2</div><div class="line"># ./configure --prefix=/usr/local/mpich/</div><div class="line"># make &amp;&amp; make install</div></pre></td></tr></table></figure><p>$ vim ~/.bash_profile<br>$ export PATH=$PATH:/usr/local/mpich/bin/<br>$ source ~/.bash_profile<br>$ echo $PATH</p><h2 id="新建machinefile"><a href="#新建machinefile" class="headerlink" title="新建machinefile"></a>新建machinefile</h2><p>$ vim ~/machinefile<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">vm00</div><div class="line">vm01</div><div class="line">vm02</div></pre></td></tr></table></figure></p><h1 id="测试MPICHI，跑圆周率程序"><a href="#测试MPICHI，跑圆周率程序" class="headerlink" title="测试MPICHI，跑圆周率程序"></a>测试MPICHI，跑圆周率程序</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ /usr/local/mpich/bin/mpiexec -n 3 -machinefile machinefile ~/mpich-3.2/examples/cpi</div></pre></td></tr></table></figure><p>-n 是使用多少节点<br>-machinefile 集群节点文件<br><img src="/images/2017/0329/0.png" alt="计算圆周率"> </p>]]></content>
      
      <categories>
          
          <category> HPC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HPC </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>mailx 发送邮件小计</title>
      <link href="/arlo/670d97dc/"/>
      <content type="html"><![CDATA[<h1 id="安装postfix服务"><a href="#安装postfix服务" class="headerlink" title="安装postfix服务"></a>安装postfix服务</h1><p>yum install postfix<br>/etc/init.d/postfix start<br>chkconfig postfix on</p><h1 id="发送格式"><a href="#发送格式" class="headerlink" title="发送格式"></a>发送格式</h1><p>mailx -s subject user@xxx.com &lt; message_file<br>echo “内容” | mailx -s “邮件标题” user@xxx.com</p><h1 id="其他选项"><a href="#其他选项" class="headerlink" title="其他选项"></a>其他选项</h1><p>-r 指定发件人<br>-c 指定抄送人<br>-b 指定密送人<br>多个收件人使用逗号分隔<br>有些邮箱（如qq邮箱）会当成垃圾邮件拦截，日志中可以看到500错误<br><a id="more"></a></p><h1 id="监控服务脚本是否运行正常"><a href="#监控服务脚本是否运行正常" class="headerlink" title="监控服务脚本是否运行正常"></a>监控服务脚本是否运行正常</h1><h2 id="监控脚本内容"><a href="#监控脚本内容" class="headerlink" title="监控脚本内容"></a>监控脚本内容</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line">count=`ssh m1 ps -ef|grep real_wrf.csh |grep -v &quot;grep&quot; |wc -l`</div><div class="line">#echo $count</div><div class="line">if [ 0 == $count ];then</div><div class="line">        mailx -s &quot;the real_wrf.csh is not running &quot; a1@xxx.com.cn,a2@xxx.com.cn &lt; t.txt     </div><div class="line">fi</div></pre></td></tr></table></figure><h2 id="监测目录下是否有文件"><a href="#监测目录下是否有文件" class="headerlink" title="监测目录下是否有文件"></a>监测目录下是否有文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line">#每天6:00~7:00检查前一天00时的数据，每天16:00~18:00检查前一天12时的数据</div><div class="line"></div><div class="line">Date1=`date -d &quot;1 day ago&quot; +&quot;%Y%m%d00&quot;`</div><div class="line">Date2=`date -d &quot;1 day ago&quot; +&quot;%Y%m%d_06&quot;`</div><div class="line">file=&quot;\</div><div class="line">/data/Model3/WRF/data/output/wrf/$Date1/wrfout_d03 \</div><div class="line">/data/Model3/CMAQ4.7/data/cctm-wrf/$Date1/CCTM_CONC.cn03.*.ncf \</div><div class="line">/data/Model3/CAMx6/data/post_save/$Date1/camxsave_d03* \</div><div class="line">/data/em/result/predictions/SHAANXI/$Date2/POST/naqpms_d03.* \</div><div class="line">/data/Model3/WRF/data/output/wrfchem/$Date1/wrfout_d03* \</div><div class="line">&quot;</div><div class="line">for i in $file</div><div class="line">do</div><div class="line">    if [ ! -f &quot;$i&quot; ]; then</div><div class="line">        echo &quot;$i 文件不存在&quot; &gt;&gt;  check_00mx_$Date1.txt</div><div class="line">        mailx -s &quot;00时文件数据模型数据不存在&quot; b@xx.com.cn &lt; check_00mx_$Date1.txt                           </div><div class="line">    fi</div><div class="line">done</div></pre></td></tr></table></figure><h2 id="监测目录是否存在，目录是否为空"><a href="#监测目录是否存在，目录是否为空" class="headerlink" title="监测目录是否存在，目录是否为空"></a>监测目录是否存在，目录是否为空</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line">#每天6:00~7:00检查前一天00时的数据，每天16:00~18:00检查前一天12时的数据</div><div class="line"></div><div class="line">Date1=`date +&quot;%Y&quot;`</div><div class="line">Date2=`date +&quot;%m&quot;`</div><div class="line">Date3=`date -d &apos;-1 day&apos;  +&quot;%d&quot;`</div><div class="line">Date4=`date +&quot;%Y%m%d00&quot;`</div><div class="line">Dir=/data/Model3/WeatherForecast</div><div class="line">WRF_Dir=&quot;$Dir/WRF/$Date1/$Date2/$Date3/d3/500/ \</div><div class="line">$Dir/WRF/$Date1/$Date2/$Date3/d3/700/ \</div><div class="line">$Dir/WRF/$Date1/$Date2/$Date3/d3/850/ \</div><div class="line">$Dir/WRF/$Date1/$Date2/$Date3/d3/srf/&quot;</div><div class="line"></div><div class="line">WRFCHEM_Dir=&quot;$Dir/WRFCHEM/$Date1/$Date2/$Date3/00/d3/aqi \</div><div class="line">$Dir/WRFCHEM/$Date1/$Date2/$Date3/00/d3/co \</div><div class="line">$Dir/WRFCHEM/$Date1/$Date2/$Date3/00/d3/no2 \</div><div class="line">$Dir/WRFCHEM/$Date1/$Date2/$Date3/00/d3/o3 \</div><div class="line">$Dir/WRFCHEM/$Date1/$Date2/$Date3/00/d3/pm10 \</div><div class="line">$Dir/WRFCHEM/$Date1/$Date2/$Date3/00/d3/pm25 \</div><div class="line">$Dir/WRFCHEM/$Date1/$Date2/$Date3/00/d3/so2&quot;</div><div class="line"></div><div class="line">WRFCHEMDAY_Dir=&quot;$Dir/WRFCHEMDAY/$Date1/$Date2/$Date3/00/d3/aqi \</div><div class="line">$Dir/WRFCHEMDAY/$Date1/$Date2/$Date3/00/d3/co \</div><div class="line">$Dir/WRFCHEMDAY/$Date1/$Date2/$Date3/00/d3/no2 \</div><div class="line">$Dir/WRFCHEMDAY/$Date1/$Date2/$Date3/00/d3/o3 \</div><div class="line">$Dir/WRFCHEMDAY/$Date1/$Date2/$Date3/00/d3/pm10 \</div><div class="line">$Dir/WRFCHEMDAY/$Date1/$Date2/$Date3/00/d3/pm25 \</div><div class="line">$Dir/WRFCHEMDAY/$Date1/$Date2/$Date3/00/d3/so2&quot;</div><div class="line"></div><div class="line">CAMX_Dir=&quot;$Dir/CAMX/$Date1/$Date2/$Date3/00/d3/aqi \</div><div class="line">$Dir/CAMX/$Date1/$Date2/$Date3/00/d3/co \</div><div class="line">$Dir/CAMX/$Date1/$Date2/$Date3/00/d3/no2 \</div><div class="line">$Dir/CAMX/$Date1/$Date2/$Date3/00/d3/o3 \</div><div class="line">$Dir/CAMX/$Date1/$Date2/$Date3/00/d3/pm10 \</div><div class="line">$Dir/CAMX/$Date1/$Date2/$Date3/00/d3/pm25 \</div><div class="line">$Dir/CAMX/$Date1/$Date2/$Date3/00/d3/so2 &quot;</div><div class="line"></div><div class="line">CAMxDAY_Dir=&quot;$Dir/CAMxDAY/$Date1/$Date2/$Date3/00/d3/aqi \</div><div class="line">$Dir/CAMxDAY/$Date1/$Date2/$Date3/00/d3/co \</div><div class="line">$Dir/CAMxDAY/$Date1/$Date2/$Date3/00/d3/no2 \</div><div class="line">$Dir/CAMxDAY/$Date1/$Date2/$Date3/00/d3/o3 \</div><div class="line">$Dir/CAMxDAY/$Date1/$Date2/$Date3/00/d3/pm10 \</div><div class="line">$Dir/CAMxDAY/$Date1/$Date2/$Date3/00/d3/pm25 \</div><div class="line">$Dir/CAMxDAY/$Date1/$Date2/$Date3/00/d3/so2 &quot;</div><div class="line"></div><div class="line">CMAQ_WRF_Dir=&quot;$Dir/CMAQ.WRF/$Date1/$Date2/$Date3/00/d3/aqi \</div><div class="line">$Dir/CMAQ.WRF/$Date1/$Date2/$Date3/00/d3/co \</div><div class="line">$Dir/CMAQ.WRF/$Date1/$Date2/$Date3/00/d3/no2 \</div><div class="line">$Dir/CMAQ.WRF/$Date1/$Date2/$Date3/00/d3/o3 \</div><div class="line">$Dir/CMAQ.WRF/$Date1/$Date2/$Date3/00/d3/pm10 \</div><div class="line">$Dir/CMAQ.WRF/$Date1/$Date2/$Date3/00/d3/pm25 \</div><div class="line">$Dir/CMAQ.WRF/$Date1/$Date2/$Date3/00/d3/so2 &quot;</div><div class="line"></div><div class="line">CMAQDAY_Dir=&quot;$Dir/CMAQDAY/$Date1/$Date2/$Date3/00/d3/aqi \</div><div class="line">$Dir/CMAQDAY/$Date1/$Date2/$Date3/00/d3/co \</div><div class="line">$Dir/CMAQDAY/$Date1/$Date2/$Date3/00/d3/no2 \</div><div class="line">$Dir/CMAQDAY/$Date1/$Date2/$Date3/00/d3/o3 \</div><div class="line">$Dir/CMAQDAY/$Date1/$Date2/$Date3/00/d3/pm10 \</div><div class="line">$Dir/CMAQDAY/$Date1/$Date2/$Date3/00/d3/pm25 \</div><div class="line">$Dir/CMAQDAY/$Date1/$Date2/$Date3/00/d3/so2 &quot;</div><div class="line"></div><div class="line">NAQMPS_Dir=&quot;$Dir/NAQMPS/$Date1/$Date2/$Date3/00/d3/aqi \</div><div class="line">$Dir/NAQMPS/$Date1/$Date2/$Date3/00/d3/co \</div><div class="line">$Dir/NAQMPS/$Date1/$Date2/$Date3/00/d3/no2 \</div><div class="line">$Dir/NAQMPS/$Date1/$Date2/$Date3/00/d3/o3 \</div><div class="line">$Dir/NAQMPS/$Date1/$Date2/$Date3/00/d3/pm10 \</div><div class="line">$Dir/NAQMPS/$Date1/$Date2/$Date3/00/d3/pm25 \</div><div class="line">$Dir/NAQMPS/$Date1/$Date2/$Date3/00/d3/so2 &quot;</div><div class="line"></div><div class="line">NAQMPSDAY_Dir=&quot;$Dir/NAQMPSDAY/$Date1/$Date2/$Date3/00/d3/aqi \</div><div class="line">$Dir/NAQMPSDAY/$Date1/$Date2/$Date3/00/d3/co \</div><div class="line">$Dir/NAQMPSDAY/$Date1/$Date2/$Date3/00/d3/no2 \</div><div class="line">$Dir/NAQMPSDAY/$Date1/$Date2/$Date3/00/d3/o3 \</div><div class="line">$Dir/NAQMPSDAY/$Date1/$Date2/$Date3/00/d3/pm10 \</div><div class="line">$Dir/NAQMPSDAY/$Date1/$Date2/$Date3/00/d3/pm25 \</div><div class="line">$Dir/NAQMPSDAY/$Date1/$Date2/$Date3/00/d3/so2 &quot;</div><div class="line"></div><div class="line">Dir2=&quot;$WRF_Dir $WRFCHEM_Dir $WRFCHEMDAY_Dir $CAMX_Dir $CAMxDAY_Dir $CMAQ_WRF_Dir $CMAQDAY_Dir $NAQMPS_Dir $NAQMPSDAY_Dir&quot;</div><div class="line">for d in $Dir2</div><div class="line">do</div><div class="line">    if [ ! -d $d ]; then</div><div class="line">        echo &quot;$d 目录不存在&quot; &gt;&gt; /tmp/check_00tp_$Date4.txt</div><div class="line">    elif [ `ls $d |wc -l` -eq 0  ]; then</div><div class="line">        echo &quot;$d 目录下文件不存在&quot; &gt;&gt; /tmp/check_00tp_$Date4.txt</div><div class="line">    fi</div><div class="line">done</div><div class="line">mailx -s &quot;$Date4 00时 模型出图情况&quot; c@xx.com.cn &lt; /tmp/check_00tp_$Date4.txt</div></pre></td></tr></table></figure><h2 id="设置crontab"><a href="#设置crontab" class="headerlink" title="设置crontab"></a>设置crontab</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">01 13,17,01,04 * * * /data/tool/DRAW/shell/check_status/check_wrf.sh</div><div class="line">01 07 * * * /data/tool/DRAW/shell/check_status/check_00mx.sh</div><div class="line">01 08 * * * /data/tool/DRAW/shell/check_status/check_00tp.sh</div></pre></td></tr></table></figure><h1 id="另附短信发送脚本"><a href="#另附短信发送脚本" class="headerlink" title="另附短信发送脚本"></a>另附短信发送脚本</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line">datedir1=`date +%Y%d`</div><div class="line">datedir2=`date +%Y%d%y`</div><div class="line">un=&quot;xxxxxxxx&quot;</div><div class="line">pw=&quot;xxxxxxxxxx&quot;</div><div class="line">phone=&quot;xxxxxxxxxxx&quot;</div><div class="line">msg=&quot;this is a test mes,please ignore&quot;</div><div class="line"></div><div class="line">if [ ! -d &quot;/data/em/data/GFS/$datedir1/$datedir2&quot; ];then</div><div class="line">    curl --data &quot;un=$un&amp;pw=$pw&amp;phone=$phone&amp;msg=$msg&amp;rd=1&quot; &quot;http://sms.253.com/msg/send&quot;</div><div class="line">    echo  -e &quot;\n query balance:&quot;</div><div class="line">    curl --data &quot;un=$un&amp;pw=$pw&quot; &quot;http://sms.253.com/msg/balance&quot;</div><div class="line">fi</div><div class="line">echo &quot;send sms:&quot;</div></pre></td></tr></table></figure><p>短信参考：<a href="https://www.253.com/api-docs-13.html" target="_blank" rel="external">https://www.253.com/api-docs-13.html</a></p>]]></content>
      
      <categories>
          
          <category> 监控 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 监控 </tag>
            
            <tag> mail </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>SSH 奇淫技巧之隧道模式</title>
      <link href="/arlo/da9b9fcb/"/>
      <content type="html"><![CDATA[<p>用了ssh这么久，今天才知道ssh还有这么强大的功能，穿透内外网，来去自如；其实最重要的还是方便平时工作中的调试，在此简单的记录一下。</p><h1 id="使用条件"><a href="#使用条件" class="headerlink" title="使用条件"></a>使用条件</h1><p>一台拥有ssh端口连接的外网linux服务器</p><h1 id="本地转发"><a href="#本地转发" class="headerlink" title="本地转发"></a>本地转发</h1><p>场景：公网有一台服务器的公网ip，ssh端口(已修改为2012)没有对外开放，本地想直接连接此端口，可以通过公网一台开放ssh端口的服务器跳转过去<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh -p 2012 -CNg -L 2222:namenode:2012 nsxq@1.2.3.4</div></pre></td></tr></table></figure></p><p>将namenode服务器的2012端口通过1.2.3.4服务器映射到本地2222端口 ssh -p 2222 localhost 即可连接<br>-p 指定跳转机端口<br>—L 本地转发</p><h1 id="远程转发"><a href="#远程转发" class="headerlink" title="远程转发"></a>远程转发</h1><p>场景：本地开发环境需要被外网访问，之前一直使用花生壳，ngrok之类的程序；现在只需要本地执行一条ssh命令，将本地的端口映射到一台外网的服务器上去<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh -p 2012 -CNfg -R 0.0.0.0:8888:192.168.1.5:80 nsxq@1.2.3.4</div></pre></td></tr></table></figure></p><p>将本地内网192.168.1.5:80 映射到1.2.3.4服务器的8888端口，访问1.2.3.4:8888 即可访问192.168.1.5:80 内容</p><p><font color="#FF0000"> <strong>打开1.2.3.4服务器需要sshd_config 配置中的GatewayPorts yes</strong></font><br>记得顺手打开防火墙端口<br>-p 指定跳转机端口<br>-R 远程转发</p><h1 id="动态转发"><a href="#动态转发" class="headerlink" title="动态转发"></a>动态转发</h1><p>场景：相对于上边两种单一端口转发，此功能就是在本地启动一个端口，其他机器可以设置代理，通过此端口进行流量转发（俗称翻墙）。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh -D 5000 nsxq@1.2.3.4</div></pre></td></tr></table></figure></p><p>我这里没有能上google的服务器，没法测试，按道理来说，其他机器就可以将代理设置为1.2.3.4:5000 进行商上网了</p><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p>[实战ssh端口转发]<a href="http://www.ibm.com/developerworks/cn/linux/l-cn-sshforward/" target="_blank" rel="external">http://www.ibm.com/developerworks/cn/linux/l-cn-sshforward/</a><br>[SSH的三种端口转发（Port forwarding）/ 隧道协议概要]<a href="https://blog.twofei.com/528/" target="_blank" rel="external">https://blog.twofei.com/528/</a></p>]]></content>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> SSH </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>给下拉菜单和鼠标右键截图</title>
      <link href="/arlo/8fb14fc6/"/>
      <content type="html"><![CDATA[<h1 id="调用常用的QQ软件截图"><a href="#调用常用的QQ软件截图" class="headerlink" title="调用常用的QQ软件截图"></a>调用常用的QQ软件截图</h1><p><strong>1. 登陆qq</strong><br><strong>2. 同时按住Crtl+Alt+Shift</strong><br><strong>3. 松开Shift，其他两个手指不用松开</strong><br><strong>4. 按住A</strong><br><strong>5. 截图</strong></p>]]></content>
      
      
        <tags>
            
            <tag> windows </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>使用阿里云Docker镜像库加速</title>
      <link href="/arlo/42c94ca5/"/>
      <content type="html"><![CDATA[<h1 id="开发者账号"><a href="#开发者账号" class="headerlink" title="开发者账号"></a>开发者账号</h1><p>由于docker官方的镜像下载太慢了，于是开通了阿里云的开发者账号；<br><strong>申请开发者账号</strong><br><a href="http://console.d.aliyun.com/join.htm?spm=0.0.0.0.Xx1dX0#/docker/booster" target="_blank" rel="external">http://console.d.aliyun.com/join.htm?spm=0.0.0.0.Xx1dX0#/docker/booster</a><br><strong>本人的专属加速器地址</strong><br><a href="https://4c2kkvb9.mirror.aliyuncs.com" target="_blank" rel="external">https://4c2kkvb9.mirror.aliyuncs.com</a><br><strong>阿里云docker镜像搜索地址：</strong><br><a href="https://cr.console.aliyun.com/#/imageSearch" target="_blank" rel="external">https://cr.console.aliyun.com/#/imageSearch</a><br><strong>阿里云docker加速器</strong><br>使用加速器将会提升您在国内获取Docker官方镜像的速度！<br><a href="https://cr.console.aliyun.com/#/accelerator" target="_blank" rel="external">https://cr.console.aliyun.com/#/accelerator</a></p><h1 id="加速器操作文档"><a href="#加速器操作文档" class="headerlink" title="加速器操作文档"></a>加速器操作文档</h1><p>安装或升级Docker<br>您可以通过阿里云的镜像仓库下载：<strong><a href="http://mirrors.aliyun.com/help/docker-engine" target="_blank" rel="external">mirrors.aliyun.com/help/docker-engine</a></strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet | sh -</div></pre></td></tr></table></figure></p><p>配置Docker加速器</p><p>您可以使用如下的脚本将mirror的配置添加到docker daemon的启动参数中。<br>系统要求 CentOS 7 以上，Docker 1.9 以上。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cp -n /lib/systemd/system/docker.service /etc/systemd/system/docker.service   </div><div class="line">sed -i &quot;s|ExecStart=/usr/bin/dockerd|ExecStart=/usr/bin/docker daemon --registry-mirror=https://4c2kkvb9.mirror.aliyuncs.com|g&quot; /etc/systemd/system/docker.service    </div><div class="line">systemctl daemon-reload </div><div class="line">systemctl restart docker</div></pre></td></tr></table></figure></p><h1 id="QA"><a href="#QA" class="headerlink" title="QA"></a>QA</h1><p>Q: docker pull 时候报错“ x509: certificate has expired or is not yet valid”<br>A: 此问题是由于主机的时间不同步造成的，使用ntpdate cn.ntp.org.cn 同步网络时间即可。</p><hr>]]></content>
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>使用kubernetes 1.4 新特性kubeadm创建集群</title>
      <link href="/arlo/f9f5730/"/>
      <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>kubernetes 发布的最新版本1.4，增加了很多新特性，据说只用两条命令就可以创建一个k8s集群，比起之前的搭建起来简单很多。<br>[官方文档][<strong> <a href="http://kubernetes.io/docs/getting-started-guides/kubeadm/" target="_blank" rel="external">http://kubernetes.io/docs/getting-started-guides/kubeadm/</a> </strong>]<br><a id="more"></a></p><h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><h2 id="主机资源"><a href="#主机资源" class="headerlink" title="主机资源"></a>主机资源</h2><p>192.168.234.139    dc01<br>192.168.234.140    dc02<br>192.168.234.141    dc03</p><h2 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h2><p>推荐使用ubuntu 16 和centos 7 以上版本（我个人使用的是centos 7.2 x64）</p><h2 id="软件安装"><a href="#软件安装" class="headerlink" title="软件安装"></a>软件安装</h2><p>在三台机器上上分别安装docker 和 kubelet、kubectl和kubeadm </p><h3 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -sS https://get.docker.io/ |sh</div></pre></td></tr></table></figure><h3 id="安装kubelet、kubectl和kubeadm"><a href="#安装kubelet、kubectl和kubeadm" class="headerlink" title="安装kubelet、kubectl和kubeadm"></a>安装kubelet、kubectl和kubeadm</h3><p>需要安装的kubelet、kubeadm、kubectl、 kubernetes-cni这四个rpm包是google的源，正常情况下国内是连接不上的，qq群(319807078)里已经有热心网友下载下来了，安装的时候会依赖一个socat的软件包,使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum localinstall *.rpm</div></pre></td></tr></table></figure></p><h2 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h2><p>三台机器都需要启动docker和kubelet</p><h3 id="启动docker"><a href="#启动docker" class="headerlink" title="启动docker"></a>启动docker</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">systemctl enable docker &amp;&amp; systemctl start docker</div></pre></td></tr></table></figure><h3 id="启动kubelet"><a href="#启动kubelet" class="headerlink" title="启动kubelet"></a>启动kubelet</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">systemctl enable kubelet &amp;&amp; systemctl start kubelet  # **此时启动kubelet是失败的，因为在/etc/kubernetes下还没有生成配置文件**</div></pre></td></tr></table></figure><h3 id="下载images"><a href="#下载images" class="headerlink" title="下载images"></a>下载images</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">images=(kube-proxy-amd64:v1.4.0 kube-discovery-amd64:1.0 kubedns-amd64:1.7 kube-scheduler-amd64:v1.4.0 kube-controller-manager-amd64:v1.4.0 kube-apiserver-amd64:v1.4.0 etcd-amd64:2.2.5 kube-dnsmasq-amd64:1.3 exechealthz-amd64:1.1 pause-amd64:3.0 kubernetes-dashboard-amd64:v1.4.0)</div><div class="line">for imageName in $&#123;images[@]&#125; ; do</div><div class="line">  docker pull mritd/$imageName</div><div class="line">  docker tag mritd/$imageName gcr.io/google_containers/$imageName</div><div class="line">  docker rmi mritd/$imageName</div><div class="line">done</div></pre></td></tr></table></figure><h1 id="搭建集群"><a href="#搭建集群" class="headerlink" title="搭建集群"></a>搭建集群</h1><h2 id="初始化集群"><a href="#初始化集群" class="headerlink" title="初始化集群"></a>初始化集群</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubeadm init --api-advertise-addresses=192.168.234.139</div></pre></td></tr></table></figure><p><img src="/images/2016/1021/01.png" alt="k8s"><br>查看日志<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">journalctl -fu kubelet</div></pre></td></tr></table></figure></p><p>漠然大神给出的此错误排错步骤<br>NO.1、保证 hostname 中主机名为 xxxx.com 等这种域名格式<br>NO.2、保证 hosts 文件中 有 127.0.0.1 与之对应<br>NO.3、保证 gcr 相关镜像 已经 load 到本地<br>NO.4、保证 iptables规则没问题，必要时候 -F<br>NO.5、保证 selinux 已经关闭<br>NO.6、init 之前保证 启动 kubelet，虽然启动后显示启动失败<br>NO.7、重新 init 保证用 官方 clean 步骤做下清理<br>官方清理脚本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">systemctl stop kubelet;</div><div class="line">docker rm -f -v $(docker ps -q);</div><div class="line">find /var/lib/kubelet | xargs -n 1 findmnt -n -t tmpfs -o TARGET -T | uniq | xargs -r umount -v;</div><div class="line">rm -r -f /etc/kubernetes /var/lib/kubelet /var/lib/etcd;</div></pre></td></tr></table></figure></p><h2 id="加入集群节点"><a href="#加入集群节点" class="headerlink" title="加入集群节点"></a>加入集群节点</h2><p>保证节点上启动了docker 和kubectl<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubeadm join --token 0ab76c.b59aaa1d1ab3cf93 192.168.234.139</div></pre></td></tr></table></figure></p><h2 id="查看加入的节点"><a href="#查看加入的节点" class="headerlink" title="查看加入的节点"></a>查看加入的节点</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">kubectl get nodes</div></pre></td></tr></table></figure><p><a href="https://mritd.me/2016/10/09/kubernetes-1.4-create-cluster/" target="_blank" rel="external">本文参考漠然大神链接</a><br><a href="https://mritd.me" target="_blank" rel="external">漠然大神博客地址</a><br><a href="https://github.com/kubernetes/release/tree/master/rpm" target="_blank" rel="external">github build k8s rpm</a></p><hr>]]></content>
      
      <categories>
          
          <category> DevOps </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kubernetes </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>CentOs 7 firewalld 防火墙无法启动</title>
      <link href="/arlo/5a65cdf4/"/>
      <content type="html"><![CDATA[<p>CentOs 7 无法启动，提示“Job for firewalld.service failed because a timeout was exceeded. See “systemctl status firewalld.service” and “journalctl -xe” for details.”<br><a id="more"></a></p><h1 id="排错"><a href="#排错" class="headerlink" title="排错"></a>排错</h1><p>启动报错提示如下图<br><img src="/images/2016/0922/1.jpg" alt="firewalld"><br>排错很久，发现服务没有启动，但是有一个firewall的进程<br><img src="/images/2016/0922/2.jpg" alt="firewalld"><br>kill掉这个进程，顺利启动<br><img src="/images/2016/0922/3.jpg" alt="firewalld"></p><h1 id="常用firewall命令"><a href="#常用firewall命令" class="headerlink" title="常用firewall命令"></a>常用firewall命令</h1><p>firewall-cmd –list-services<br>firewall-cmd –list-ports<br>firewall-cmd –add-port 80/tcp    添加端口<br>firewall-cmd –add-service http    添加服务<br>firewall-cmd –zone=external –add-masquerade    开启端口转发<br>firewall-cmd –zone=external –add-forward-port=port=80:proto=tcp:toport=8080    本机80转发到本机8080<br>firewall-cmd –zone=external –add-forward=port=9090:proto=tcp:toaddr=192.168.234.130    9090转发到另外一台机器的9090<br>firewall-cmd –zone=external –add-forward=port=23:proto=tcp:toport=2003:toaddr=192.168.234.130    23转发到另外一台机器的2003<br>firewall-cmd –zone=public –add-port=5060-5059/udp –permanent    范围端口，永久生效<br>firewall-cmd –permanent –add-icmp-block=echo-reply    允许ICMP响应应答报文</p><h1 id="顺便推荐一篇firewalld写的很好，很全的文章"><a href="#顺便推荐一篇firewalld写的很好，很全的文章" class="headerlink" title="顺便推荐一篇firewalld写的很好，很全的文章"></a>顺便推荐一篇firewalld写的很好，很全的文章</h1><p><a href="http://www.hi-linux.com/2016/05/26/CentOS%207%E4%B8%8B%E4%BD%BF%E7%94%A8FirewallD%E6%9E%84%E5%BB%BA%E5%8A%A8%E6%80%81%E9%98%B2%E7%81%AB%E5%A2%99/" target="_blank" rel="external"><strong>CentOS 7下使用FirewallD构建动态防火墙</strong></a></p><p><a href="https://lists.centos.org/pipermail/centos/2014-September/145809.html" target="_blank" rel="external">参考链接</a></p><hr>]]></content>
      
      <categories>
          
          <category> Troubleshooting </category>
          
      </categories>
      
      
        <tags>
            
            <tag> firewalld </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Jumpserver跳转机搭建过程中的疑问</title>
      <link href="/arlo/ef870e7c/"/>
      <content type="html"><![CDATA[<h1 id="跳转机"><a href="#跳转机" class="headerlink" title="跳转机"></a>跳转机</h1><p>跳转机又名堡垒机，主要作用是在终端连接服务器之间加一层防护保障，保障连接到服务器的方式更加安全，更加透明，更加可控。<br><img src="/images/2016/0830/1.png" alt="Jumpserver 架构图"><br><a id="more"></a><br>Jumpserver官网的wiki、图解、视频教程做的已经很详细了，参考地址如下：<br>[Jumpserver 官网地址:]<a href="http://www.jumpserver.org/" target="_blank" rel="external">http://www.jumpserver.org/</a><br>[Jumpserver WiKi]<a href="https://github.com/jumpserver/jumpserver/wiki" target="_blank" rel="external">https://github.com/jumpserver/jumpserver/wiki</a><br>[Jumpserver v3 视频教程]<a href="http://bbs.jumpserver.org/read/639.html" target="_blank" rel="external">http://bbs.jumpserver.org/read/639.html</a></p><h1 id="记录问题"><a href="#记录问题" class="headerlink" title="记录问题"></a>记录问题</h1><p>以下是我在安装搭建过程中遇到的几个问题，在此记录一下。</p><h2 id="用户"><a href="#用户" class="headerlink" title="用户"></a>用户</h2><p><strong>用户管理中的用户:</strong> 用于登陆jumpserver跳转机和jumpserver web平台的用户；表示该类用户拥有登陆跳转机权限。<br><strong>设置中的默认管理员用户:</strong> 只适用于设置资产管理的时候，管理账号，使用默认选项；其实是一个缺省的管理员用户，只有大规模客户端使用相同的管理员用户名和密码是作用最大。<br><strong>添加资产时候的管理用户:</strong> 必须是真实存在于被添加的资产上，拥有管理权限（或sudo权限）的用户；被连接的资产设备上真是存在的管理员用户，如root。<br><strong>授权管理中的系统用户:</strong> 此用户是在添加jumpserver平台，通过推送在服务器上真是创建的用户；</p><h2 id="服务器，客户端"><a href="#服务器，客户端" class="headerlink" title="服务器，客户端"></a>服务器，客户端</h2><p>服务器：jms，安装jumpserver的这台服务器<br>客户端：通过跳转机链接的资产，如被连接的服务器，网络设备等</p><h2 id="推送"><a href="#推送" class="headerlink" title="推送"></a>推送</h2><p>推送是通过资产管理里的管理用户在服务器上建立系统用户和赋予sudo权限（如果管理sudo别名的话）</p>]]></content>
      
      
        <tags>
            
            <tag> 跳转机 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Xshell 使用技巧</title>
      <link href="/arlo/d1d8517a/"/>
      <content type="html"><![CDATA[<p>Xshell 是一个强大的安全终端模拟软件，它支持SSH1, SSH2, 以及Microsoft Windows 平台的TELNET 协议。Xshell 通过互联网到远程主机的安全连接以及它创新性的设计和特色帮助用户在复杂的网络环境中享受他们的工作。Xshell可以在Windows界面下用来访问远端不同系统下的服务器，从而比较好的达到远程控制终端的目的。<br><a id="more"></a></p><ol><li>主界面<br><img src="/images/2016/0819/1.png" alt="xshell配图"> </li><li>添加链接。<br><img src="/images/2016/0819/2.png" alt="xshell配图"> </li><li>可以保存的，以后不用输入用户名，密码，这个是putty没有的（有利有弊，从安全方面说，有风险哇。。。）<br><img src="/images/2016/0819/3.png" alt="xshell配图"> </li><li>中文乱码，修改编码为 UTF-8<br><img src="/images/2016/0819/4.png" alt="xshell配图"> </li><li>小键盘不能输入数字。<br><img src="/images/2016/0819/5.png" alt="xshell配图"> </li><li>界面及字体颜色<br><img src="/images/2016/0819/6.png" alt="xshell配图"> </li><li>看到这个真有点相见恨晚的感觉，右键粘贴功能，这个是用putty养成的习惯（虽然之前看到网上有说,选中后，使用ctrl+insert 复制，鼠标中键粘贴），在此感谢@ 吴天！<br><img src="/images/2016/0819/7.png" alt="xshell配图"><br>最大的好处就是，你设置的这些，只需要设置一次就可以了，不用像putty里那种针对每个连接都设置一遍。<br>xftp在这里就不说了，此处省去几十字。。。。。。。</li><li>xshell 5 每次exit退出时候，停留在本地shell界面，需要再次关闭，取消以下选项即可(ps：有强迫症的人可以顺手打上最后那个选项勾)<br><img src="/images/2016/0819/8.jpg" alt="xshell配图"> </li><li>Xshell选中文字复制时中断<strong>【<a href="http://nkcoder.github.io/2014/05/05/xshell-select-interrupt-dict/" target="_blank" rel="external">转</a>】</strong><br>在Xshell中设置了“自动将选中的文字复制到粘贴板”，之前一直没有问题，最近发现，只要选中屏幕上的文字，复制上了，但shell终端立即被中断了，即向终端发送了CTRL-C；</li></ol><p><em>很可能是“选中文字复制”与词典软件的“划词翻译”相冲突。我的原因是，最近安装了必应词典，且开启了“划词翻译”功能。<br>我在网上求助时，发现也有一些朋友遇到和我一样的问题，都是由于与词典的冲突导致的，如有道词典，关掉划译功能即可。</em></p><ol><li>顺手分享一个xshell的配色方案<br>将一些配置文件保存为x_shell.xcs格式<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">[x_shell]</div><div class="line">text(bold)=ffffff</div><div class="line">magenta(bold)=ff00ff</div><div class="line">text=839496</div><div class="line">white(bold)=ffffff</div><div class="line">green=00c000</div><div class="line">red(bold)=ff0000</div><div class="line">green(bold)=00ff00</div><div class="line">black(bold)=808080</div><div class="line">red=808000</div><div class="line">blue=ff8040</div><div class="line">black=000000</div><div class="line">blue(bold)=8080ff</div><div class="line">yellow(bold)=ffff00</div><div class="line">cyan(bold)=00ffff</div><div class="line">yellow=c0c000</div><div class="line">magenta=c000c0</div><div class="line">background=002b35</div><div class="line">white=c0c0c0</div><div class="line">cyan=00c0c0</div><div class="line">[Names]</div><div class="line">count=1</div><div class="line">name0=x_shell</div></pre></td></tr></table></figure></li></ol><p>点击工具-配色方案-导入<br><img src="/images/2016/0819/9.jpg" alt="xshell配图"><br><img src="/images/2016/0819/10.jpg" alt="xshell配图"><br>点击文件-属性-外观<br><img src="/images/2016/0819/11.jpg" alt="xshell配图"><br><img src="/images/2016/0819/12.jpg" alt="xshell配图"> </p><hr>]]></content>
      
      <categories>
          
          <category> 常识 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> xshell </tag>
            
            <tag> Linux </tag>
            
            <tag> 常识 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>常用命令集合</title>
      <link href="/arlo/ddba52eb/"/>
      <content type="html"><![CDATA[<h1 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h1><h2 id="进程查看"><a href="#进程查看" class="headerlink" title="进程查看"></a>进程查看</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">netstat -ano |findstr “8080” 查看端口</div><div class="line">netstat -ano |findstr “127.0.0.1”</div><div class="line">tasklist 查看进程</div><div class="line">tasklist |findstr “nginx”</div><div class="line">tskill 结束进程</div><div class="line">tskill nginx</div><div class="line">tskill 1130</div><div class="line">#查看文件被哪个进程占用</div><div class="line">打开资源管理器-CPU-关联的句柄-输入文件名称</div></pre></td></tr></table></figure><h2 id="映射网络驱动器"><a href="#映射网络驱动器" class="headerlink" title="映射网络驱动器"></a>映射网络驱动器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">net use Z: \\192.168.0.x\share /user:username password</div><div class="line">#断开网络驱动器</div><div class="line">net use Z: /del /y</div><div class="line">net use * /del /y</div></pre></td></tr></table></figure><h2 id="桌面图标设置"><a href="#桌面图标设置" class="headerlink" title="桌面图标设置"></a>桌面图标设置</h2><p>添加计算机到桌面<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rundll32.exe shell32.dll,Control_RunDLL desk.cpl,,0</div></pre></td></tr></table></figure></p><h2 id="常用快捷命令"><a href="#常用快捷命令" class="headerlink" title="常用快捷命令"></a>常用快捷命令</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">winver# 查看系统信息</div><div class="line">control.exe# 控制面板</div><div class="line">sysdm.cpl# 系统属性</div><div class="line">devmgmt.msc# 设备管理器</div><div class="line">compmgmt.msc# 计算机管理</div><div class="line">wf.msc# 防火墙管理</div></pre></td></tr></table></figure><p>网络与共享中心<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">control.exe /name Microsoft.NetworkAndSharingCenter</div></pre></td></tr></table></figure></p><h1 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h1><h2 id="free"><a href="#free" class="headerlink" title="free"></a>free</h2><p>查看内存使用情况</p><p>可用内存=free+buffers+cached<br>以用内存=used-buffers-cached<br>所以看内存的使用不要看used 和free ，看 -/+ buffers/cache 就可以了<br>查看内存插槽数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dmidecode|grep -P -A5 &quot;Memory\s+Device&quot;|grep Size|grep -v Range</div></pre></td></tr></table></figure></p><p>查看内存最大容量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dmidecode | grep -P &apos;Maximum\s+Capacity&apos;</div></pre></td></tr></table></figure></p><p>查看内存频率<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dmidecode|grep -A16 &quot;Memory Device&quot;|grep &apos;Speed&apos;</div></pre></td></tr></table></figure></p><h2 id="iostat"><a href="#iostat" class="headerlink" title="iostat"></a>iostat</h2><p>查看磁盘性能</p><p>iostat -x 1 5<br>%util 接近100%的时候，产生 的I/O 请求太多，I/O 系统已经满负荷，该磁盘可能存在瓶颈<br>%idle 小于70%的时候，I/O 的 压力比较大，说明读取中有很多的wait</p><h2 id="du"><a href="#du" class="headerlink" title="du"></a>du</h2><p>查看系统目录占用空间大小</p><p>在根目录下执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">du -hsx * |sort -rh |head -10</div><div class="line">du -ah --max-depth=1</div></pre></td></tr></table></figure></p><p>推荐一款速度更快的工具ncdu</p><h2 id="uptime"><a href="#uptime" class="headerlink" title="uptime"></a>uptime</h2><p>查看cpu的负载</p><p>每cpu的核心当前活动进程数不大于3，表示性能良好，大于五表示严重。</p><h2 id="dd"><a href="#dd" class="headerlink" title="dd"></a>dd</h2><p>瞬间创建（1T）大文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dd if=/dev/zero of=file bs=1G seek=1024 count=0</div></pre></td></tr></table></figure></p><p>这个文件用ll -h 看着是1TB的，用du -sh 看着是空文件，随着写入的数据而增长</p><p>dd制作ISO镜像<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dd if=/dev/cdrom of=/mnt/cd1.iso</div></pre></td></tr></table></figure></p><h2 id="shopt"><a href="#shopt" class="headerlink" title="shopt"></a>shopt</h2><p>选择性删除文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">shopt -s extglob 打开</div><div class="line">rm -fr !(file1|file2)</div><div class="line">shopt -u extglob #关闭</div></pre></td></tr></table></figure></p><h2 id="dstat"><a href="#dstat" class="headerlink" title="dstat"></a>dstat</h2><p>监控系统状态<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alias dstat=&apos;dstat -cdlmnpsy&apos;</div></pre></td></tr></table></figure></p><h2 id="iftop"><a href="#iftop" class="headerlink" title="iftop"></a>iftop</h2><p>n 显示ip/主机名<br>p 显示端口<br>l 输入过滤内容<br><a href="http://www.vpser.net/manage/iftop.html" target="_blank" rel="external">http://www.vpser.net/manage/iftop.html</a></p><h2 id="网卡灯闪烁"><a href="#网卡灯闪烁" class="headerlink" title="网卡灯闪烁"></a>网卡灯闪烁</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ethtool -p eth0</div></pre></td></tr></table></figure><h1 id="终端快捷键"><a href="#终端快捷键" class="headerlink" title="终端快捷键"></a>终端快捷键</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">ctrl + a移动光标到行首</div><div class="line">ctrl + e移动光标到行尾（好像不生效）</div><div class="line">ctrl + r查找历史命令</div><div class="line">ctrl + u删除从光标到行首</div><div class="line">ctrl + k删除从光标到行尾</div><div class="line">ctrl + l清屏</div></pre></td></tr></table></figure><p>更多参考：<a href="http://harttle.com/2015/11/09/bash-shortcuts.html" target="_blank" rel="external">http://harttle.com/2015/11/09/bash-shortcuts.html</a></p>]]></content>
      
      <categories>
          
          <category> 常识 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 常识 </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>升级mysql数据库字符集为utf8mb4</title>
      <link href="/arlo/3b439eff/"/>
      <content type="html"><![CDATA[<p>之前公司的项目中一直使用的mysql版本(5.1.73)，使用utf8字符集，基本上没有什么问题的;<br><img src="/images/2016/0812/1.jpg" alt="之前的mysql版本"><br>现在开始做一些手机客户端之类的项目，发送表情(emoji)的时候会报错“ ‘\xF0\x9F\x98\xB1’ for column ‘body’ at row 1”；<br><img src="/images/2016/0812/2.jpg" alt="发送表情报错"><br><a id="more"></a><br>Google了一把，原因是因为表情存储需要4个字节，但是mysql的utf8字符集编码只支持1-3个字节，存储空间不够就报错了，因此需要升级一下字符集。<br>MYSQL 5.5.3之后的版本支持UTF8MB4字符集，一个字符最多能有4字节，此字符集也是完全兼容utf8的，不存在兼容性问题。<br>升级完mysql-server之后<br><img src="/images/2016/0812/3.jpg" alt="升级后的mysql版本"></p><p>修改配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[client]</div><div class="line">default-character-set = utf8mb4</div><div class="line">[mysql]</div><div class="line">default-character-set = utf8mb4</div><div class="line">[mysqld]</div><div class="line">character-set-client-handshake = FALSE</div><div class="line">character-set-server = utf8mb4</div><div class="line">collation-server = utf8mb4_unicode_ci</div><div class="line">init_connect=&apos;SET NAMES utf8mb4&apos;</div></pre></td></tr></table></figure></p><p>修改完这些配置文件后，之后创建的库、表就是utf8mb4格式了，但是之前的收据就需要手动修改一下了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ALTER DATABASE database_name CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci;</div><div class="line">ALTER TABLE table_name CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;</div><div class="line">ALTER TABLE table_name CHANGE column_name VARCHAR(191) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;</div></pre></td></tr></table></figure></p><p>重启mysql，查看字符集<br><code>/etc/init.d/mysqld restart</code></p><p><strong>使用utf8mb4，需注意</strong>：<br>1.mysql-server 版本需要高于5.5.3<br>2.mysql-connector 版本需要高于5.1.3版本(建议升级到最新版，目前是5.1.39)</p><p><img src="/images/2016/0812/4.jpg" alt="查看字符集"><br>参考：<br><a href="http://www.wangyuxiong.com/blog/mysql-dbzi-fu-ji-sheng-ji-zhi-utf8mb4,24/" target="_blank" rel="external">http://www.wangyuxiong.com/blog/mysql-dbzi-fu-ji-sheng-ji-zhi-utf8mb4,24/</a><br><a href="https://segmentfault.com/a/1190000000616820" target="_blank" rel="external">https://segmentfault.com/a/1190000000616820</a></p>]]></content>
      
      <categories>
          
          <category> Troubleshooting </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>正在启动windows卡住故障的填坑之路</title>
      <link href="/arlo/4c7121ca/"/>
      <content type="html"><![CDATA[<h1 id="事件起因"><a href="#事件起因" class="headerlink" title="事件起因"></a>事件起因</h1><p>同事新买了一个ThinkPad E460，出厂系统为Windows8.1，希望修改为win7，于是开始了我的填坑之路，此故障之前在联想的S405上也遇到了一次。</p><h1 id="故障现象"><a href="#故障现象" class="headerlink" title="故障现象"></a>故障现象</h1><p>安装完操作系统后，出现“正在启动windows卡住”，如图:</p><p><img src="/images/2016/0809/1.jpg" alt="Alttext"></p><a id="more"></a><ul><li>更换安装版镜像</li><li>BIOS中硬盘模式调整</li><li>PE中重新分区</li><li>使用mhdd工具扫描硬盘</li></ul><p>做了以上步骤，实在是黔驴技穷啊，于是联系了ThinkPad的客服人员！</p><h2 id="使用安装版镜像，不能发现硬盘问题"><a href="#使用安装版镜像，不能发现硬盘问题" class="headerlink" title="使用安装版镜像，不能发现硬盘问题"></a>使用安装版镜像，不能发现硬盘问题</h2><p>官方客服给出的故障原因是，“原生Win7系统不包含USB3.0的驱动，所以无法使用USB3.0的U盘在USB3.0的设备上引导，且安装完系统后还需要重新安装USB3.0驱动”</p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案:"></a>解决方案:</h2><blockquote><p><strong><em>注：此方案仅适用于Intel芯片组的机型，AMD芯片组的机型将无法使用,文档中写明支持win7 32位系统，但是实测部分32位系统会存在问题，建议使用win7 64位系统安装</em></strong></p></blockquote><ul><li>从Intel官网下载<a href="https://downloadcenter.intel.com/zh-cn/download/25476/Windows7-USB3-0Creator" target="_blank" rel="external">Windows7 USB3.0 Creator 实用程序</a></li><li>解压缩之前下载的软件，在解压缩路径下右键以管理员方式运行Installer_Creator.exe<br><img src="/images/2016/0809/2.png" alt="Alt text"></li><li>在弹出界面中点击右侧的选择按钮，选中U盘所在分区<br><img src="/images/2016/0809/3.png" alt="Alt text"></li><li>点击Create Image开始往U盘中添加程序，过程会比较长，Intel官方数据是15分钟，实测超过20分钟<br><img src="/images/2016/0809/4.png" alt="Alt text"></li><li>在出现Upadte finished！后创建结束，现在就可以使用这个U盘在USB 3.0接口上安装系统了<br><img src="/images/2016/0809/8.jpg" alt="Alt text"><br>使用安装完补丁的U盘安装完系统USB3.0驱动会自动安装上。<h1 id="坑"><a href="#坑" class="headerlink" title="坑"></a>坑</h1><h2 id="坑一："><a href="#坑一：" class="headerlink" title="坑一："></a>坑一：</h2>win7，win8.1，win10 均不能讲此驱动安装到U盘上，报错如下图<br><img src="/images/2016/0809/15.png" alt="Alt text"><h2 id="坑二"><a href="#坑二" class="headerlink" title="坑二"></a>坑二</h2>更换Ghost版本的镜像，安装完操作系统后依然是启动到“正在启动windows”卡主，进入安全模式卡在“\Windows\System32\drivers\ahcix64s.sys 界面”<h2 id="坑三"><a href="#坑三" class="headerlink" title="坑三"></a>坑三</h2></li><li>使用DG格式化整个硬盘</li><li>重建分区表</li><li>更换分区类型（MBR/GPT）</li><li>激活主分区<h2 id="其他坑"><a href="#其他坑" class="headerlink" title="其他坑"></a>其他坑</h2><a href="http://iknow.lenovo.com/detail/dc_093720.html" target="_blank" rel="external">预装Win8/8.1系统的电脑改装为Win7系统的操作步骤及常见问题</a></li></ul><h1 id="填坑"><a href="#填坑" class="headerlink" title="填坑"></a>填坑</h1><p>使用<a href="https://www.microsoft.com/en-us/download/windows-usb-dvd-download-tool" target="_blank" rel="external">Windows 7 USB DVD Download Tool</a>或者软碟通（UltraISO）制作Win7原版安装盘（不要使用Ghost镜像制作，否则后续会有报错）</p><ul><li>使用Win7光盘或者U盘（建议usb2.0的U盘）引导，进入系统安装界面<br><img src="/images/2016/0809/21.jpg" alt="Alt text"></li><li>按Shift + F10打开命令提示符。(Edge系列机器需要按Fn+Shift+F10)<br><img src="/images/2016/0809/22.jpg" alt="Alt text"></li><li>输入”Diskpart”(不用输入引号，下同)，并按回车，进入操作界面<br><img src="/images/2016/0809/23.jpg" alt="Alt text"></li><li>输入：”list空格disk”，查看磁盘信息。注意看磁盘容量来选择。图中465G的Disk 0是硬盘，3852M的Disk 1是用于Win7安装的U盘<br><img src="/images/2016/0809/24.jpg" alt="Alt text"></li><li>输入：”select 空格disk空格 0”，选择disk 0为当前操作的磁盘<br><img src="/images/2016/0809/25.jpg" alt="Alt text"></li><li>输入：”Clean”，清空当前磁盘分区。<br><img src="/images/2016/0809/26.jpg" alt="Alt text"></li><li>输入：”convert 空格 mbr”，转换为MBR分区。<br><img src="/images/2016/0809/27.jpg" alt="Alt text"></li><li>操作完成，关闭此命令提示符窗口，继续按照正常的方法安装Win7系统即可（由于我坑一中的usb3.0 的驱动没有填好，就使用PE安装ghost版本的镜像安装了）。</li></ul><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>这个故障是我在安装操作系统的时候遇到的最棘手的问题，最主要的步骤就是在dos模式下清空一下磁盘分区；这里只是记录了其中最主要的几个坑，希望给遇到的朋友一些参考。</p><hr>]]></content>
      
      <categories>
          
          <category> Troubleshooting </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Hexo博客搭建简记</title>
      <link href="/arlo/e5e5519a/"/>
      <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>博客是我记录学习过程最好的方式；我的第一个博客是百度空间，后来百度关闭了；第二个博客是ChinaUnix，最近ChinaUnix升级了安全，牛盾老是阻止我访问，再者ChinaUnix风格太老了，写出来的东西也不漂亮，于是就想自己搭建一个博客，现在的blog有很多，比如wordpress，ghost，等等，<a href="http://kaimingwan.com/post/gong-ju/farbox-jekyll-octopress-ghost-hexodeng-zhu-liu-bo-ke-sheng-cheng-qi-te-dian-gai-xuan-ze-na-ge" target="_blank" rel="external">比较之下</a>觉得hexo有逼格，高大上，就你了！<br><a id="more"></a></p><h1 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h1><h2 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h2><ul><li>Node.js</li><li>Git</li><li>Github</li><li>MarkDown 编辑器</li></ul><h2 id="软件获取"><a href="#软件获取" class="headerlink" title="软件获取"></a>软件获取</h2><p><a href="https://nodejs.org/en/download/" target="_blank" rel="external">下载nodejs</a><br><a href="https://git-scm.com/download/" target="_blank" rel="external">下载git</a>  </p><h2 id="安装过程"><a href="#安装过程" class="headerlink" title="安装过程"></a>安装过程</h2><h3 id="安装git"><a href="#安装git" class="headerlink" title="安装git"></a>安装git</h3><p>start–&gt;next–&gt;end(详细过程略)</p><h3 id="安装nodejs"><a href="#安装nodejs" class="headerlink" title="安装nodejs"></a>安装nodejs</h3><p>start–&gt;next–&gt;end(详细过程略)</p><h3 id="安装hexo"><a href="#安装hexo" class="headerlink" title="安装hexo"></a>安装hexo</h3><ul><li><strong>开始安装Hexo</strong><br><code>npm install -g hexo</code>  </li><li><strong>初始化博客</strong><br><code>hexo init</code>  #默认路径为当前目录，可以在init后手动指定一个目录为博客根目录</li><li><strong>生成静态页面</strong><br><code>hexo g</code>  #完整命令hexo generate</li><li><strong>启动本地服务</strong><br><code>hexo s</code>  #完整命令hexo server，默认启动范围地址 <a href="http://localhost:4000" target="_blank" rel="external">http://localhost:4000</a> 可以使用-p指定端口<br>至此hexo 博客安装完毕</li></ul><h2 id="github"><a href="#github" class="headerlink" title="github"></a>github</h2><p>注册并登陆github<br>创建一个与自己用户名对应的项目(如：nsxq.github.io)</p><h2 id="配置hexo"><a href="#配置hexo" class="headerlink" title="配置hexo"></a>配置hexo</h2><p>hexo的主配置文件就是blog主目录下的_config.yml文件咯<br>打开文件，在配置文件最末尾，修改配置为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">type: git</div><div class="line">repo: git@github.com:nsxq/nsxq.github.io.git</div><div class="line">branch: master</div></pre></td></tr></table></figure></p><ul><li><p>安装插件，支持hexo提交到github<br><code>npm install hexo-deployer-git --save</code>  </p></li><li><p>提交blog数据到github<br><code>hexo d**  #完整命令 hexo deploy</code></p></li></ul><h2 id="更换皮肤next"><a href="#更换皮肤next" class="headerlink" title="更换皮肤next"></a>更换皮肤next</h2><p>目前我看到的最漂亮的皮肤就是next<br><code>git clone https://github.com/iissnan/hexo-theme-next</code><br>复制hexo-theme-next目录到hexo\themes\为next<br>修改_config.yml中配置项theme: next<br>next主题默认的Next.Muse,可以在主题配置文件hexo\themes\next_config.yml中修改Schemes<br><a href="http://prozhuchen.com/2015/10/05/Hexo%E5%8D%9A%E5%AE%A2%E4%B9%8B%E6%94%B9%E5%AD%97%E4%BD%93/" target="_blank" rel="external">更换字体</a></p><h2 id="图片居左"><a href="#图片居左" class="headerlink" title="图片居左"></a>图片居左</h2><p>修改E:\Hexo\themes\next\source\css_custom\custom.styl<br><code>.post-body .fancybox img {    margin-left: 0 !important;}</code></p><h1 id="将blog发布到公网"><a href="#将blog发布到公网" class="headerlink" title="将blog发布到公网"></a>将blog发布到公网</h1><ul><li>我的在阿里云（原万网）上买的域名，设置一条CNAME即可<br>CNAME    @    默认    nsxq.github.io    </li><li>在hexo\source 目录下新建一个文件CNAME，内容为<br>islocal.cc</li><li>修改_config.yml中url为<br>url: <a href="http://islocal.cc">http://islocal.cc</a>  </li><li>hexo g</li><li>hexo d<br>浏览器就可以使用<a href="http://islocal.cc">http://islocal.cc</a> 访问blog了</li></ul><h1 id="编写第一篇博文"><a href="#编写第一篇博文" class="headerlink" title="编写第一篇博文"></a>编写第一篇博文</h1><ul><li>是不是终于搭建完成了，懵逼了，完全不知道干吗了？</li><li>是不是搭建完发现blog上不能直接编写很惊讶？</li><li>是不是终于google到可以使用markdown语法编写，从来没用过？</li><li>这都不是事儿！<br><strong>教程奉上</strong><br><a href="http://www.hais2.com/2016/03/07/Hexo%20Getting%20Started%206/" target="_blank" rel="external">markdown快速入门</a><br><a href="http://wowubuntu.com/markdown/basic.html" target="_blank" rel="external">Hexo博客的写作</a><br><strong>工具奉上</strong><br><a href="https://maxiang.io/" target="_blank" rel="external">马克飞象</a><br><a href="http://mahua.jser.me/" target="_blank" rel="external">在线markdown编辑器</a><br><a href="http://www.franktly.com/2016/07/06/%E8%AE%A9Baidu%E5%92%8CGoogle%E6%94%B6%E5%BD%95Hexo%E5%8D%9A%E5%AE%A2/" target="_blank" rel="external">让Baidu和Google收录Hexo博客</a></li></ul><h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><p><a href="https://hexo.io/zh-cn/docs/" target="_blank" rel="external">Hexo官方中文文档</a></p>]]></content>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
  
  
</search>
