<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[Ambari+HDP大数据平台搭建]]></title>
    <url>%2Farlo%2F34b2c7a7%2F</url>
    <content type="text"><![CDATA[Ambari 是什么？Ambari 跟 Hadoop 等开源软件一样，也是 Apache Software Foundation 中的一个项目，并且是顶级项目。（http://ambari.apache.org） 目前最新的发布版本是 2.6.2.0；Ambari可以简单的理解为开源的Hadoop生态圈（Hive，Yarn，Hbase，Hive，Sqoop，Kafka，Zookeeper，spark 等）平台的管理软件，具备Hadoop组件的安装、管理、运维等基本功能，提供Web UI进行可视化的集群管理，简化了大数据平台的安装、使用难度。 基础环境配置资源规划12345主机名 IP地址 操作系统bigdata01.islocal.cc 192.168.6.164 CentOS Linux release 7.4.1708 (Core)bigdata02.islocal.cc 192.168.6.181 CentOS Linux release 7.4.1708 (Core)bigdata03.islocal.cc 192.168.6.183 CentOS Linux release 7.4.1708 (Core)bigdata04.islocal.cc 192.168.6.194 CentOS Linux release 7.4.1708 (Core) 软件版本JDK 1.8.1.8.0_112postgresql 10.3Ambari 2.6.2.0-155HDP 2.6.4.0-91HDP-GPL 2.6.4.0-91HDP-UTILS 1.1.0.22下载地址2.6.1.5：https://docs.hortonworks.com/HDPDocuments/Ambari-2.6.1.5/bk_ambari-installation/content/ch_obtaining-public-repos.html2.6.2.0：https://docs.hortonworks.com/HDPDocuments/Ambari-2.6.2.0/bk_ambari-installation/content/ch_obtaining-public-repos.html 关闭防火墙和Selinux关闭防火墙systemctl stop firewalld.service 禁用防火墙systemctl disable firewalld.service #查询防火墙服务状态12345[root@bigdata01 ~]# systemctl status firewalld.service● firewalld.service - firewalld - dynamic firewall daemon Loaded: loaded (/usr/lib/systemd/system/firewalld.service; disabled; vendor preset: enabled) Active: inactive (dead) Docs: man:firewalld(1) 关闭Selinux123sed -i &apos;s/SELINUX=enforcing/SELINUX=disabled/&apos; /etc/selinux/configgrep SELINUX=disabled /etc/selinux/configsetenforce 0 查看Selinux状态12[root@bigdata01 ~]# sestatus SELinux status: disabled or12[root@bigdata01 ~]# getenforce Disabled 新建用户useradd hadoop &amp;&amp; echo &quot;hadoop:hadoop&quot; | chpasswdvisudo1234567891011## Allow root to run any commands anywhere root ALL=(ALL) ALLhadoop ALL=(ALL) ALL #赋予hadoop用户所有权限## Allows members of the &apos;sys&apos; group to run networking, software, ## service management apps and more.# %sys ALL = NETWORKING, SOFTWARE, SERVICES, STORAGE, DELEGATING, PROCESSES, LOCATE, DRIVERS## Allows people in group wheel to run all commands%wheel ALL=(ALL) ALLhadoop ALL=(ALL) NOPASSWD: ALL #hadoop用户执行sudo不用输入密码 hadoop用户免密配置配置bigdata01主机上的hosts[root@bigdata01 ~]# cat /etc/hosts123456127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4::1 localhost localhost.localdomain localhost6 localhost6.localdomain6192.168.6.164 bigdata01.islocal.cc192.168.6.181 bigdata02.islocal.cc192.168.6.183 bigdata03.islocal.cc192.168.6.194 bigdata04.islocal.cc 复制/etc/hosts到其他主机scp /etc/hosts bigdata02.islocal.cc:/etc/hostsscp /etc/hosts bigdata03.islocal.cc:/etc/hostsscp /etc/hosts bigdata04.islocal.cc:/etc/hosts 配置免密ssh-keygen #默认一路回车 拷贝秘钥到其他主机ssh-copy-id bigdata01.islocal.ccssh-copy-id bigdata02.islocal.ccssh-copy-id bigdata03.islocal.ccssh-copy-id bigdata04.islocal.cc 测试ssh bigdata01.islocal.cc datessh bigdata02.islocal.cc datessh bigdata03.islocal.cc datessh bigdata04.islocal.cc date 配置时间同步如果服务器可以上外网，直接使用公网时间服务器即可1*/10 * * * * /usr/sbin/ntpdate cn.ntp.org.cn &amp;&amp; hwclock -w 安装JDK1234567891011mkdir /usr/thstar xf jdk1.8.0_112.tgz -C /usr/thsvim /etc/profileexport EDITOR=/usr/bin/vimexport HISTSIZE=10000export HISTTIMEFORMAT=&quot;%F %T &quot;export JAVA_HOME=/usr/ths/jdk1.8.0_112export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jarsource /etc/profile 系统参数优化vim /etc/security/limits.conf12* soft nofile 65536* hard nofile 65536 本地仓库搭建由于ambari，hdp软件包很大，使用官方的yum源安装比较慢，我们搭建一个本地仓库，使用本地yum源 安装配置web服务器安装依赖包yum install gcc gcc-c++ make automake autoconf libtool pcre pcre-devel zlib zlib-devel openssl openssl-devel 安装nginx1234wget http://nginx.org/download/nginx-1.14.0.tar.gztar xf nginx-1.14.0.tar.gzcd nginx-1.14.0./configure --prefix=/usr/ths/nginx-1.14.0/ &amp;&amp; make &amp;&amp; make install 更换nginx根目录1234567891011121314mkdir -p /var/www/html/vim /usr/ths/nginx-1.14.0/conf/nginx.conf...location / &#123; root /var/www/html; index index.html index.htm; autoindex on; #允许列出目录 &#125;...#监测配置文件是否正确cd /usr/ths/nginx-1.14.0/sbin./nginx -t#启动./nginx 解压文件到nginx发布目录下12345mkdir -p /var/www/html/hdp/tar xf ambari-2.6.2.0-centos7.tar.gz -C /var/www/html/tar xf HDP-GPL-2.6.4.0-centos7-rpm.tar.gz -C /var/www/html/hdp/tar xf HDP-UTILS-1.1.0.22-centos7.tar.gz -C /var/www/html/hdp/tar xf HDP-2.6.4.0-centos7-rpm.tar.gz -C /var/www/html/hdp/ 目录结构如下1234567891011121314151617181920212223242526[root@bigdata01 ~]# tree -L 4 /var/www/html//var/www/html/├── ambari│ └── centos7│ └── 2.6.2.0-155│ ├── ambari│ ├── ambari.repo│ ├── artifacts.txt│ ├── build.id│ ├── build_metadata.txt│ ├── repodata│ ├── RPM-GPG-KEY│ ├── smartsense│ └── tars└── hdp ├── HDP │ └── centos7 │ └── 2.6.4.0-91 ├── HDP-GPL │ └── centos7 │ └── 2.6.4.0-91 └── HDP-UTILS └── centos7 └── 1.1.0.2218 directories, 4 files 安装本地源制作相关工具yum install yum-utils createrepo 编辑repo文件cat /etc/yum.repos.d/ambari.repo12345#VERSION_NUMBER=2.6.2.0-155[ambari-2.6.2.0]name=ambari Version - ambari-2.6.2.0baseurl=http://192.168.6.164/ambari/centos7/2.6.2.0-155/gpgcheck=0 安装数据库Ambari支持PostgreSQL 9.1.13+,9.3, 9.4MariaDB 10.1MySQL 5.6** Oracle 11gr2 Oracle 12c** 等版本数据库，我们这里使用postgres数据库。 创建用户和组123groupadd postgres #新增用户组useradd -g postgres postgres #新增用户passwd postgres #为用户设置密码 创建数据目录，并授予权限mkdir -p /usr/ths/data/PGDATAchown postgres:postgres /usr/ths/data/PGDATAchmod 700 /usr/ths/data/PGDATA 编译安装1234567tar -zxvf postgresql-10.3.tar.gzcd postgresql-10.3./configure --prefix=/usr/ths/pgsql-10.3 --without-readlinesudo makesudo make installsu - postgres /usr/ths/pgsql-10.3/bin/initdb -D /usr/ths/data/PGDATA #初始化配置和数据库 启动12# -D 为数据文件位置 -l 为日志文件位置(日志文件不存在会自动创建)/usr/ths/pgsql-10.3/bin/pg_ctl start -D /usr/ths/data/PGDATA -l /usr/ths/data/PGDATA/pgsql.log #可选。 配置环境变量vi cat /etc/profile追加以下两行到/etc/profile123export PG_HOME=/usr/ths/pgsql-10.3export PATH=$PG_HOME/bin: $PATH #注意，环境变量要把:$PATH写在后面，可以避免一些版本冲突问题 配置文件修改/usr/ths/data/PGDATA/postgresql.conf1listen_addresses = &apos;*&apos; pg_hba.conf1host all all 192.168.6.1/24 trust 新建ambari数据库12345678910111213su - postgres#进入psql命令行工具psql#依次执行以下建库建用户语句CREATE DATABASE ambari; CREATE USER hdp WITH PASSWORD &apos;solution&apos;;GRANT ALL PRIVILEGES ON DATABASE ambari TO hdp; \connect ambari; CREATE SCHEMA AMBARI AUTHORIZATION hdp;ALTER SCHEMA AMBARI OWNER TO hdp;ALTER ROLE hdp SET search_path to &apos;AMBARI&apos;, &apos;public&apos;;#退出\q 执行Ambari的DDL语句123456# 以hdp用户，连接ambari库psql -U hdp -d ambari# 执行DDL语句\i /var/lib/ambari-server/resources/Ambari-DDL-Postgres-CREATE.sql#执行完毕后，退出\q 设置Ambari使用的PostgreSQL驱动包wget https://jdbc.postgresql.org/download/postgresql-42.2.2.jar -C /usr/ths/lib/postgresql-42.2.2.jarroot用户执行ambari-server setup --jdbc-db=postgres --jdbc-driver=/usr/ths/lib/postgresql-42.2.2.jar 安装Ambariyum -y install ambari-server 配置Ambariambari-server setup123456789101112131415#Customize user account for ambari-server daemon [y/n] (n)? y #自定义设置#Enter user account for ambari-server daemon (postgres): hadoop#Do you want to change Oracle JDK [y/n] (n)? y #是否修改Jdk#Enter choice (1): 3 #输入3#Path to JAVA_HOME: /usr/ths/jdk1.8.0_112 #设置jdk路径 #Enter advanced database configuration [y/n] (n)? y #是否进入高级数据库设置#Enter choice (1): 4 #数据库类型4（PostgreSQL）#Hostname (localhost): 192.168.6.164 #数据库地址#Port (5432): 5432 #数据库端口#Database name (ambari): ambari #数据库名#Postgres schema (ambari): ambari #Username (ambari): hdp #数据库用户名#Enter Database Password (bigdata): solution #数据库密码 #Re-enter password:你的密码#Proceed with configuring remote database connection properties [y/n] (y)? y 启动ambari-serverambari-server start访问地址：http://192.168.6.164:8080 默认用户名密码： admin/admin 安装HDP集群点击图中的蓝色按钮“Launch Install Wizard”启动安装向导。 设置HDP集群名称 选择要安装的HDP版本和本地仓库配置 设置ssh私钥私钥内容为/home/hadoop/.ssh/id_rsa文件内容，可以下载该文件或者直接复制文件内容 监测ssh免密通信 选择要安装的服务这里根据自己的安装选择，安装完成后也可以在Services-Action中添加 配置各个服务Master这里可以在下拉选项里选择调整一下默认的主机设置，保持资源均衡 服务的Slaves 和 Clients节配置 服务器自定义配置这里一般出现的红色警告都是需要设置密码的地方，手动填一下即可！这里填写之前设置过的postgres数据库hdp用户，填写完成后测试一下12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849Admin Name : adminCluster Name : ARLOTotal Hosts : 4 (4 new)Repositories:redhat7 (HDP-2.6): http://192.168.6.164/hdp/HDP/centos7/2.6.4.0-91/redhat7 (HDP-2.6-GPL): http://192.168.6.164/hdp/HDP-GPL/centos7/2.6.4.0-91/redhat7 (HDP-UTILS-1.1.0.22): http://192.168.6.164/hdp/HDP-UTILS/centos7/1.1.0.22/Services:HDFSDataNode : 3 hostsNameNode : bigdata01.islocal.ccNFSGateway : 1 hostSNameNode : bigdata02.islocal.ccYARN + MapReduce2App Timeline Server : bigdata04.islocal.ccNodeManager : 1 hostResourceManager : bigdata04.islocal.ccTezClients : 1 hostHiveMetastore : bigdata02.islocal.ccHiveServer2 : bigdata02.islocal.ccWebHCat Server : bigdata02.islocal.ccDatabase : Existing PostgreSQL DatabaseHBaseMaster : bigdata01.islocal.ccRegionServer : 1 hostPhoenix Query Server : 0 hostPigClients : 1 hostZooKeeperServer : 3 hostsAmbari MetricsMetrics Collector : bigdata03.islocal.ccGrafana : bigdata03.islocal.ccSmartSenseActivity Analyzer : bigdata01.islocal.ccActivity Explorer : bigdata01.islocal.ccHST Server : bigdata01.islocal.ccSliderClients : 1 host 开始安装出现警告，在安装过程完成后，可以进入到service里单独启动一下，看看日志报错详细解决。 解决完所有告警，效果图如下 NameNode HA配置关闭HBase服务这一步非常重要 点击Services-HDFS-Enable NameNode HA 输入Nameservice ID 选择要安装的主机 默认即可 根据提示登录到对应主机上执行提示命令如下图所示 开始安装组件 初始化组件 Namenode HA启用完成，如图所示 参考链接：http://www.cnblogs.com/zhijianliutang/articles/5195045.htmlhttps://blog.csdn.net/mawenwu1983/article/details/78983275http://wiki.ttxit.com/display/hortonworks/Hortonworkshttps://www.ibm.com/developerworks/cn/opensource/os-cn-bigdata-ambari/index.html]]></content>
      <categories>
        <category>大数据</category>
      </categories>
      <tags>
        <tag>Ambari</tag>
        <tag>HDP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Shell版俄罗斯方块(转)]]></title>
    <url>%2Farlo%2F8656017b%2F</url>
    <content type="text"><![CDATA[在网上看到一篇shell版本的俄罗斯方块游戏，很有趣，转过来记录一下。地址：http://www.ywnds.com/?p=12325123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619#!/bin/bash # Tetris Game# 10.21.2003 xhchen&lt;[email]xhchen@winbond.com.tw[/email]&gt; #APP declarationAPP_NAME=&quot;$&#123;0##*[\\/]&#125;&quot;APP_VERSION=&quot;1.0&quot; #颜色定义cRed=1cGreen=2cYellow=3cBlue=4cFuchsia=5cCyan=6cWhite=7colorTable=($cRed $cGreen $cYellow $cBlue $cFuchsia $cCyan $cWhite) #位置和大小iLeft=3iTop=2((iTrayLeft = iLeft + 2))((iTrayTop = iTop + 1))((iTrayWidth = 10))((iTrayHeight = 15)) #颜色设置cBorder=$cGreencScore=$cFuchsiacScoreValue=$cCyan #控制信号#改游戏使用两个进程，一个用于接收输入，一个用于游戏流程和显示界面;#当前者接收到上下左右等按键时，通过向后者发送signal的方式通知后者。sigRotate=25sigLeft=26sigRight=27sigDown=28sigAllDown=29sigExit=30 #七中不同的方块的定义#通过旋转，每种方块的显示的样式可能有几种box0=(0 0 0 1 1 0 1 1)box1=(0 2 1 2 2 2 3 2 1 0 1 1 1 2 1 3)box2=(0 0 0 1 1 1 1 2 0 1 1 0 1 1 2 0)box3=(0 1 0 2 1 0 1 1 0 0 1 0 1 1 2 1)box4=(0 1 0 2 1 1 2 1 1 0 1 1 1 2 2 2 0 1 1 1 2 0 2 1 0 0 1 0 1 1 1 2)box5=(0 1 1 1 2 1 2 2 1 0 1 1 1 2 2 0 0 0 0 1 1 1 2 1 0 2 1 0 1 1 1 2)box6=(0 1 1 1 1 2 2 1 1 0 1 1 1 2 2 1 0 1 1 0 1 1 2 1 0 1 1 0 1 1 1 2)#所有其中方块的定义都放到box变量中box=($&#123;box0[@]&#125; $&#123;box1[@]&#125; $&#123;box2[@]&#125; $&#123;box3[@]&#125; $&#123;box4[@]&#125; $&#123;box5[@]&#125; $&#123;box6[@]&#125;)#各种方块旋转后可能的样式数目countBox=(1 2 2 2 4 4 4)#各种方块再box数组中的偏移offsetBox=(0 1 3 5 7 11 15) #每提高一个速度级需要积累的分数iScoreEachLevel=50 #be greater than 7 #运行时数据sig=0 #接收到的signaliScore=0 #总分iLevel=0 #速度级boxNew=() #新下落的方块的位置定义cBoxNew=0 #新下落的方块的颜色iBoxNewType=0 #新下落的方块的种类iBoxNewRotate=0 #新下落的方块的旋转角度boxCur=() #当前方块的位置定义cBoxCur=0 #当前方块的颜色iBoxCurType=0 #当前方块的种类iBoxCurRotate=0 #当前方块的旋转角度boxCurX=-1 #当前方块的x坐标位置boxCurY=-1 #当前方块的y坐标位置iMap=() #背景方块图表 #初始化所有背景方块为-1, 表示没有方块for ((i = 0; i &lt; iTrayHeight * iTrayWidth; i++)); do iMap[$i]=-1; done #接收输入的进程的主函数function RunAsKeyReceiver()&#123; local pidDisplayer key aKey sig cESC sTTY pidDisplayer=$1 aKey=(0 0 0) cESC=`echo -ne &quot;\033&quot;` cSpace=`echo -ne &quot;\040&quot;` #保存终端属性。在read -s读取终端键时，终端的属性会被暂时改变。 #如果在read -s时程序被不幸杀掉，可能会导致终端混乱， #需要在程序退出时恢复终端属性。 sTTY=`stty -g` #捕捉退出信号 trap &quot;MyExit;&quot; INT TERM trap &quot;MyExitNoSub;&quot; $sigExit #隐藏光标 echo -ne &quot;\033[?25l&quot; while : do #读取输入。注-s不回显，-n读到一个字符立即返回 read -s -n 1 key aKey[0]=$&#123;aKey[1]&#125; aKey[1]=$&#123;aKey[2]&#125; aKey[2]=$key sig=0 #判断输入了何种键 if [[ $key == $cESC &amp;&amp; $&#123;aKey[1]&#125; == $cESC ]] then #ESC键 MyExit elif [[ $&#123;aKey[0]&#125; == $cESC &amp;&amp; $&#123;aKey[1]&#125; == &quot;[&quot; ]] then if [[ $key == &quot;A&quot; ]]; then sig=$sigRotate #&lt;向上键&gt; elif [[ $key == &quot;B&quot; ]]; then sig=$sigDown #&lt;向下键&gt; elif [[ $key == &quot;D&quot; ]]; then sig=$sigLeft #&lt;向左键&gt; elif [[ $key == &quot;C&quot; ]]; then sig=$sigRight #&lt;向右键&gt; fi elif [[ $key == &quot;W&quot; || $key == &quot;w&quot; ]]; then sig=$sigRotate #W, w elif [[ $key == &quot;S&quot; || $key == &quot;s&quot; ]]; then sig=$sigDown #S, s elif [[ $key == &quot;A&quot; || $key == &quot;a&quot; ]]; then sig=$sigLeft #A, a elif [[ $key == &quot;D&quot; || $key == &quot;d&quot; ]]; then sig=$sigRight #D, d elif [[ &quot;[$key]&quot; == &quot;[]&quot; ]]; then sig=$sigAllDown #空格键 elif [[ $key == &quot;Q&quot; || $key == &quot;q&quot; ]] #Q, q then MyExit fi if [[ $sig != 0 ]] then #向另一进程发送消息 kill -$sig $pidDisplayer fi done&#125; #退出前的恢复function MyExitNoSub()&#123; local y #恢复终端属性 stty $sTTY ((y = iTop + iTrayHeight + 4)) #显示光标 echo -e &quot;\033[?25h\033[$&#123;y&#125;;0H&quot; exit&#125; function MyExit()&#123; #通知显示进程需要退出 kill -$sigExit $pidDisplayer MyExitNoSub&#125; #处理显示和游戏流程的主函数function RunAsDisplayer()&#123; local sigThis InitDraw #挂载各种信号的处理函数 trap &quot;sig=$sigRotate;&quot; $sigRotate trap &quot;sig=$sigLeft;&quot; $sigLeft trap &quot;sig=$sigRight;&quot; $sigRight trap &quot;sig=$sigDown;&quot; $sigDown trap &quot;sig=$sigAllDown;&quot; $sigAllDown trap &quot;ShowExit;&quot; $sigExit while : do #根据当前的速度级iLevel不同，设定相应的循环的次数 for ((i = 0; i &lt; 21 - iLevel; i++)) do sleep 0.02 sigThis=$sig sig=0 #根据sig变量判断是否接受到相应的信号 if ((sigThis == sigRotate)); then BoxRotate; #旋转 elif ((sigThis == sigLeft)); then BoxLeft; #左移一列 elif ((sigThis == sigRight)); then BoxRight; #右移一列 elif ((sigThis == sigDown)); then BoxDown; #下落一行 elif ((sigThis == sigAllDown)); then BoxAllDown; #下落到底 fi done #kill -$sigDown $$ BoxDown #下落一行 done&#125; #BoxMove(y, x), 测试是否可以把移动中的方块移到(x, y)的位置, 返回0则可以, 1不可以function BoxMove()&#123; local j i x y xTest yTest yTest=$1 xTest=$2 for ((j = 0; j &lt; 8; j += 2)) do ((i = j + 1)) ((y = $&#123;boxCur[$j]&#125; + yTest)) ((x = $&#123;boxCur[$i]&#125; + xTest)) if (( y &lt; 0 || y &gt;= iTrayHeight || x &lt; 0 || x &gt;= iTrayWidth)) then #撞到墙壁了 return 1 fi if (($&#123;iMap[y * iTrayWidth + x]&#125; != -1 )) then #撞到其他已经存在的方块了 return 1 fi done return 0;&#125; #将当前移动中的方块放到背景方块中去,#并计算新的分数和速度级。(即一次方块落到底部)function Box2Map()&#123; local j i x y xp yp line #将当前移动中的方块放到背景方块中去 for ((j = 0; j &lt; 8; j += 2)) do ((i = j + 1)) ((y = $&#123;boxCur[$j]&#125; + boxCurY)) ((x = $&#123;boxCur[$i]&#125; + boxCurX)) ((i = y * iTrayWidth + x)) iMap[$i]=$cBoxCur done #消去可被消去的行 line=0 for ((j = 0; j &lt; iTrayWidth * iTrayHeight; j += iTrayWidth)) do for ((i = j + iTrayWidth - 1; i &gt;= j; i--)) do if (($&#123;iMap[$i]&#125; == -1)); then break; fi done if ((i &gt;= j)); then continue; fi ((line++)) for ((i = j - 1; i &gt;= 0; i--)) do ((x = i + iTrayWidth)) iMap[$x]=$&#123;iMap[$i]&#125; done for ((i = 0; i &lt; iTrayWidth; i++)) do iMap[$i]=-1 done done if ((line == 0)); then return; fi #根据消去的行数line计算分数和速度级 ((x = iLeft + iTrayWidth * 2 + 7)) ((y = iTop + 11)) ((iScore += line * 2 - 1)) #显示新的分数 echo -ne &quot;\033[1m\033[3$&#123;cScoreValue&#125;m\033[$&#123;y&#125;;$&#123;x&#125;H$&#123;iScore&#125; &quot; if ((iScore % iScoreEachLevel &lt; line * 2 - 1)) then if ((iLevel &lt; 20)) then ((iLevel++)) ((y = iTop + 14)) #显示新的速度级 echo -ne &quot;\033[3$&#123;cScoreValue&#125;m\033[$&#123;y&#125;;$&#123;x&#125;H$&#123;iLevel&#125; &quot; fi fi echo -ne &quot;\033[0m&quot; #重新显示背景方块 for ((y = 0; y &lt; iTrayHeight; y++)) do ((yp = y + iTrayTop + 1)) ((xp = iTrayLeft + 1)) ((i = y * iTrayWidth)) echo -ne &quot;\033[$&#123;yp&#125;;$&#123;xp&#125;H&quot; for ((x = 0; x &lt; iTrayWidth; x++)) do ((j = i + x)) if (($&#123;iMap[$j]&#125; == -1)) then echo -ne &quot; &quot; else echo -ne &quot;\033[1m\033[7m\033[3$&#123;iMap[$j]&#125;m\033[4$&#123;iMap[$j]&#125;m[]\033[0m&quot; fi done done&#125; #下落一行function BoxDown()&#123; local y s ((y = boxCurY + 1)) #新的y坐标 if BoxMove $y $boxCurX #测试是否可以下落一行 then s=&quot;`DrawCurBox 0`&quot; #将旧的方块抹去 ((boxCurY = y)) s=&quot;$s`DrawCurBox 1`&quot; #显示新的下落后方块 echo -ne $s else #走到这儿, 如果不能下落了 Box2Map #将当前移动中的方块贴到背景方块中 RandomBox #产生新的方块 fi&#125; #左移一列function BoxLeft()&#123; local x s ((x = boxCurX - 1)) if BoxMove $boxCurY $x then s=`DrawCurBox 0` ((boxCurX = x)) s=$s`DrawCurBox 1` echo -ne $s fi&#125; #右移一列function BoxRight()&#123; local x s ((x = boxCurX + 1)) if BoxMove $boxCurY $x then s=`DrawCurBox 0` ((boxCurX = x)) s=$s`DrawCurBox 1` echo -ne $s fi&#125; #下落到底function BoxAllDown()&#123; local k j i x y iDown s iDown=$iTrayHeight #计算一共需要下落多少行 for ((j = 0; j &lt; 8; j += 2)) do ((i = j + 1)) ((y = $&#123;boxCur[$j]&#125; + boxCurY)) ((x = $&#123;boxCur[$i]&#125; + boxCurX)) for ((k = y + 1; k &lt; iTrayHeight; k++)) do ((i = k * iTrayWidth + x)) if (( $&#123;iMap[$i]&#125; != -1)); then break; fi done ((k -= y + 1)) if (( $iDown &gt; $k )); then iDown=$k; fi done s=`DrawCurBox 0` #将旧的方块抹去 ((boxCurY += iDown)) s=$s`DrawCurBox 1` #显示新的下落后的方块 echo -ne $s Box2Map #将当前移动中的方块贴到背景方块中 RandomBox #产生新的方块&#125; #旋转方块function BoxRotate()&#123; local iCount iTestRotate boxTest j i s iCount=$&#123;countBox[$iBoxCurType]&#125; #当前的方块经旋转可以产生的样式的数目 #计算旋转后的新的样式 ((iTestRotate = iBoxCurRotate + 1)) if ((iTestRotate &gt;= iCount)) then ((iTestRotate = 0)) fi #更新到新的样式, 保存老的样式(但不显示) for ((j = 0, i = ($&#123;offsetBox[$iBoxCurType]&#125; + $iTestRotate) * 8; j &lt; 8; j++, i++)) do boxTest[$j]=$&#123;boxCur[$j]&#125; boxCur[$j]=$&#123;box[$i]&#125; done if BoxMove $boxCurY $boxCurX #测试旋转后是否有空间放的下 then #抹去旧的方块 for ((j = 0; j &lt; 8; j++)) do boxCur[$j]=$&#123;boxTest[$j]&#125; done s=`DrawCurBox 0` #画上新的方块 for ((j = 0, i = ($&#123;offsetBox[$iBoxCurType]&#125; + $iTestRotate) * 8; j &lt; 8; j++, i++)) do boxCur[$j]=$&#123;box[$i]&#125; done s=$s`DrawCurBox 1` echo -ne $s iBoxCurRotate=$iTestRotate else #不能旋转，还是继续使用老的样式 for ((j = 0; j &lt; 8; j++)) do boxCur[$j]=$&#123;boxTest[$j]&#125; done fi&#125; #DrawCurBox(bDraw), 绘制当前移动中的方块, bDraw为1, 画上, bDraw为0, 抹去方块。function DrawCurBox()&#123; local i j t bDraw sBox s bDraw=$1 s=&quot;&quot; if (( bDraw == 0 )) then sBox=&quot;\040\040&quot; else sBox=&quot;[]&quot; s=$s&quot;\033[1m\033[7m\033[3$&#123;cBoxCur&#125;m\033[4$&#123;cBoxCur&#125;m&quot; fi for ((j = 0; j &lt; 8; j += 2)) do ((i = iTrayTop + 1 + $&#123;boxCur[$j]&#125; + boxCurY)) ((t = iTrayLeft + 1 + 2 * (boxCurX + $&#123;boxCur[$j + 1]&#125;))) #\033[y;xH, 光标到(x, y)处 s=$s&quot;\033[$&#123;i&#125;;$&#123;t&#125;H$&#123;sBox&#125;&quot; done s=$s&quot;\033[0m&quot; echo -n $s&#125; #更新新的方块function RandomBox()&#123; local i j t #更新当前移动的方块 iBoxCurType=$&#123;iBoxNewType&#125; iBoxCurRotate=$&#123;iBoxNewRotate&#125; cBoxCur=$&#123;cBoxNew&#125; for ((j = 0; j &lt; $&#123;#boxNew[@]&#125;; j++)) do boxCur[$j]=$&#123;boxNew[$j]&#125; done #显示当前移动的方块 if (( $&#123;#boxCur[@]&#125; == 8 )) then #计算当前方块该从顶端哪一行&quot;冒&quot;出来 for ((j = 0, t = 4; j &lt; 8; j += 2)) do if (($&#123;boxCur[$j]&#125; &lt; t)); then t=$&#123;boxCur[$j]&#125;; fi done ((boxCurY = -t)) for ((j = 1, i = -4, t = 20; j &lt; 8; j += 2)) do if (($&#123;boxCur[$j]&#125; &gt; i)); then i=$&#123;boxCur[$j]&#125;; fi if (($&#123;boxCur[$j]&#125; &lt; t)); then t=$&#123;boxCur[$j]&#125;; fi done ((boxCurX = (iTrayWidth - 1 - i - t) / 2)) #显示当前移动的方块 echo -ne `DrawCurBox 1` #如果方块一出来就没处放，Game over! if ! BoxMove $boxCurY $boxCurX then kill -$sigExit $&#123;PPID&#125; ShowExit fi fi #清除右边预显示的方块 for ((j = 0; j &lt; 4; j++)) do ((i = iTop + 1 + j)) ((t = iLeft + 2 * iTrayWidth + 7)) echo -ne &quot;\033[$&#123;i&#125;;$&#123;t&#125;H &quot; done #随机产生新的方块 ((iBoxNewType = RANDOM % $&#123;#offsetBox[@]&#125;)) ((iBoxNewRotate = RANDOM % $&#123;countBox[$iBoxNewType]&#125;)) for ((j = 0, i = ($&#123;offsetBox[$iBoxNewType]&#125; + $iBoxNewRotate) * 8; j &lt; 8; j++, i++)) do boxNew[$j]=$&#123;box[$i]&#125;; done ((cBoxNew = $&#123;colorTable[RANDOM % $&#123;#colorTable[@]&#125;]&#125;)) #显示右边预显示的方块 echo -ne &quot;\033[1m\033[7m\033[3$&#123;cBoxNew&#125;m\033[4$&#123;cBoxNew&#125;m&quot; for ((j = 0; j &lt; 8; j += 2)) do ((i = iTop + 1 + $&#123;boxNew[$j]&#125;)) ((t = iLeft + 2 * iTrayWidth + 7 + 2 * $&#123;boxNew[$j + 1]&#125;)) echo -ne &quot;\033[$&#123;i&#125;;$&#123;t&#125;H[]&quot; done echo -ne &quot;\033[0m&quot;&#125; #初始绘制function InitDraw()&#123; clear RandomBox #随机产生方块，这时右边预显示窗口中有方快了 RandomBox #再随机产生方块，右边预显示窗口中的方块被更新，原先的方块将开始下落 local i t1 t2 t3 #显示边框 echo -ne &quot;\033[1m&quot; echo -ne &quot;\033[3$&#123;cBorder&#125;m\033[4$&#123;cBorder&#125;m&quot; ((t2 = iLeft + 1)) ((t3 = iLeft + iTrayWidth * 2 + 3)) for ((i = 0; i &lt; iTrayHeight; i++)) do ((t1 = i + iTop + 2)) echo -ne &quot;\033[$&#123;t1&#125;;$&#123;t2&#125;H||&quot; echo -ne &quot;\033[$&#123;t1&#125;;$&#123;t3&#125;H||&quot; done ((t2 = iTop + iTrayHeight + 2)) for ((i = 0; i &lt; iTrayWidth + 2; i++)) do ((t1 = i * 2 + iLeft + 1)) echo -ne &quot;\033[$&#123;iTrayTop&#125;;$&#123;t1&#125;H==&quot; echo -ne &quot;\033[$&#123;t2&#125;;$&#123;t1&#125;H==&quot; done echo -ne &quot;\033[0m&quot; #显示&quot;Score&quot;和&quot;Level&quot;字样 echo -ne &quot;\033[1m&quot; ((t1 = iLeft + iTrayWidth * 2 + 7)) ((t2 = iTop + 10)) echo -ne &quot;\033[3$&#123;cScore&#125;m\033[$&#123;t2&#125;;$&#123;t1&#125;HScore&quot; ((t2 = iTop + 11)) echo -ne &quot;\033[3$&#123;cScoreValue&#125;m\033[$&#123;t2&#125;;$&#123;t1&#125;H$&#123;iScore&#125;&quot; ((t2 = iTop + 13)) echo -ne &quot;\033[3$&#123;cScore&#125;m\033[$&#123;t2&#125;;$&#123;t1&#125;HLevel&quot; ((t2 = iTop + 14)) echo -ne &quot;\033[3$&#123;cScoreValue&#125;m\033[$&#123;t2&#125;;$&#123;t1&#125;H$&#123;iLevel&#125;&quot; echo -ne &quot;\033[0m&quot;&#125; #退出时显示GameOVer!function ShowExit()&#123; local y ((y = iTrayHeight + iTrayTop + 3)) echo -e &quot;\033[$&#123;y&#125;;0HGameOver!\033[0m&quot; exit&#125; #显示用法.function Usage&#123; cat &lt;&lt; EOFUsage: $APP_NAMEStart tetris game. -h, --help display this help and exit --version output version information and exitEOF&#125; #游戏主程序在这儿开始.if [[ &quot;$1&quot; == &quot;-h&quot; || &quot;$1&quot; == &quot;--help&quot; ]]; then Usageelif [[ &quot;$1&quot; == &quot;--version&quot; ]]; then echo &quot;$APP_NAME $APP_VERSION&quot;elif [[ &quot;$1&quot; == &quot;--show&quot; ]]; then #当发现具有参数--show时，运行显示函数 RunAsDisplayerelse bash $0 --show&amp; #以参数--show将本程序再运行一遍 RunAsKeyReceiver $! #以上一行产生的进程的进程号作为参数fi]]></content>
      <categories>
        <category>Interesting</category>
      </categories>
      <tags>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSH隧道实现Yum等代理]]></title>
    <url>%2Farlo%2Ff49b27ae%2F</url>
    <content type="text"><![CDATA[背景Linux服务器环境中有部分服务器不能上网，使用yum安装软件极为不便；解决方案可以搭建一个本地代理服务器，在不能联通外网的服务器上将1080端口跳转到另外一台可以上外网的22端口上，实现ssh跳转，设置yum代理，实现软件安装注意事项 需要一台可以连接公网的服务器A（192.168.6.123） 需要安装软件的服务器B（192.168.6.141）可以连接上A（192.168.6.123） 服务器B（192.168.6.141）上需要安装privoxy 和git 基础软件 所有操作在服务器B（192.168.6.141）上完成 在centos 6 上，yum只能使用 http, https, ftp 协议的代理。 但在 centos 7上 yum 可以使用 socks5 的代理。 建立SSH隧道12ssh -p 22 -gfND 1080 root@192.168.6.123ss -tlnup |grep 1080 安装配置privoxy12345yum -y install privoxyvim /etc/privoxy/configforward-socks5 / 127.0.0.1:1080 .#如果允许其他机器访问，需要修改listen-addresslisten-address 0.0.0.0:8118 启动privoxy服务12systemctl start privoxysystemctl enable privoxy 为YUM配置代理123456#centos7配置方法[main]proxy=socks5h://localhost:1080#centos6配置方法[main]proxy=http://localhost:8118 扩展、配置其他代理为CURL配置代理123vim ~/.curlc# socks5h 中的 h 意为远程主机名解析socks5 = &quot;socks5h://127.0.0.1:1080&quot; 为wget配置代理123456vim /etc/wgetrchttp_proxy = http://localhost:8118https_proxy = http://localhost:8118ftp_proxy = http://localhost:8118use_proxy = onwait = 15 为pip配置代理12345mkdir ~/.pipvim ~/.pip/pip.conf[global]proxy = 127.0.0.1:8118trusted-host = mirrors.aliyun.com 为git设置http https 代理123456789#设置git config --global https.proxy &apos;socks5h://127.0.0.1:1080&apos;git config --global http.proxy &apos;socks5h://127.0.0.1:1080&apos;#查看git config --global --get http.proxygit config --global --get https.proxy#取消git config --global --unset http.proxygit config --global --unset https.proxy]]></content>
      <categories>
        <category>常识</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>SSH</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[expdp/impdp数据泵工具运用]]></title>
    <url>%2Farlo%2F2148c304%2F</url>
    <content type="text"><![CDATA[Oracle数据库常用的备份方式有，exp/imp, expdp/impdp和rman；RMAN备份内容包括:整个数据库,表空间,数据文件,指定的数据文件,控制文件,归档日志文件,参数文件等，打开归档日志后，可以做到不丢失数据，后期再详细分析研究。使用expdp和impdp时应该注重的事项：1、exp和imp是客户端工具程序，它们既可以在客户端使用，也可以在服务端使用。2、expdp和impdp是服务端的工具程序，他们只能在oracle服务端使用，不能在客户端使用。3、imp只适用于exp导出的文件，不适用于expdp导出文件；impdp只适用于expdp导出的文件，而不适用于exp导出文件。4、对于10g以上的服务器，使用exp通常不能导出0行数据的空表，而此时必须使用expdp导出。 查询备份和恢复数据库的数据库信息尽量保证数据库的版本和字符集等信息一致，否则会有很多坑。 查看数据库的版本1select * from v$version; 查看数据库编码1SELECT * FROM V$NLS_PARAMETERS WHERE PARAMETER IN (&apos;NLS_CHARACTERSET&apos;, &apos;NLS_NCHAR_CHARACTERSET&apos;); 查看管理员目录12sqlplus / as sysdbaSQL&gt; select * from dba_directories; 创建管理员目录并授权12SQL&gt; create directory dump_dir as &apos;/opt/db_backup&apos;; #可以使用默认的目录，也可以自己新建目录SQL&gt; grant read,write on directory db_backup to scott; 使用expdp导出数据1234567891011121)导出用户expdp scott/tiger@orcl schemas=scott dumpfile=expdp.dmp directory=dump_dir;expdp userid=&quot;&apos;sys/passwd@orcl as sysdba&apos;&quot; schemas=scott dumpfile=scott.dmp directory=DATA_PUMP_DIR; #使用sys用户导出写法2)导出表expdp scott/tiger@orcl tables=emp,dept dumpfile=expdp.dmp directory=dump_dir;3)按查询条件导expdp scott/tiger@orcl directory=dump_dir dumpfile=expdp.dmp tables=emp query=&apos;where deptno=20&apos;;4)按表空间导expdp system/manager@orcl directory=dump_dir dumpfile=tablespace.dmp tablespaces=temp,example;5)导整个数据库expdp system/manager@orcl directory=dump_dir dumpfile=full.dmp full=y;expdp userid=&quot;&apos;sys/passwd@orcl as sysdba&apos;&quot; full=y directory=DATA_PUMP_DIR dumpfile=full.dmp; #使用sys用户导出写法 用impdp导入数据1234567891011121)导入用户（从用户scott导入到用户scott）impdp scott/tiger@orcl directory=dump_dir dumpfile=expdp.dmp schemas=scott;impdp userid=&quot;&apos;sys/passwd@orcl as sysdba&apos;&quot; schemas=scott dumpfile=scott.dmp directory=DATA_PUMP_DIR; #使用sys用户导出写法2)导入表（从scott用户中把表dept和emp导入到system用户中）impdp system/manager@orcl directory=dump_dir dumpfile=expdp.dmp tables=scott.dept,scott.emp remap_schema=scott:system;3)导入表空间impdp system/manager@orcl directory=dump_dir dumpfile=tablespace.dmp tablespaces=example;4)导入数据库impdb system/manager@orcl directory=dump_dir dumpfile=full.dmp full=y;impdp userid=&quot;&apos;sys/passwd@orcl as sysdba&apos;&quot; full=y directory=DATA_PUMP_DIR dumpfile=full.dmp5)追加数据impdp system/manager@orcl directory=dump_dir dumpfile=expdp.dmp schemas=system table_exists_action expdp的compression参数选项（压缩）COMPRESSION=[ALL | DATA_ONLY | METADATA_ONLY | NONE]Oracle 11g中新增了几种压缩方法。12345ALL 对导出的元数据和表数据都进行压缩，得到的导出文件是最小的，耗时也是最长的。（据说压缩比可以达到 1/7）DATA_ONLY 仅对表数据进行压缩，对于大数据量的导出效果明显，会比METADATA_ONLY方式得到更小的压缩文件。METADATA_ONLY 仅对元数据进行压缩，而不会对表数据进行压缩，这种压缩执行后效果一般不是很明显，不过速度比较快。NONE 不进行任何的压缩，导出后的文件也是最大的。DEFAULT 默认方式，即不指定COMPRESSION参数，会采用默认的压缩方式METADATA_ONLY。 impdp的TABLE_EXISTS_ACTION参数选项默认值是skip，但若设置了CONTENT=DATA_ONLY，则默认值是APPEND，不是SKIP。TABLE_EXISTS_ACTION=[SKIP | APPEND | TRUNCATE | REPLACE]123456SKIP：跳过这张表，继续下一个对象。如果CONTENT设置了DATA_ONLY参数，则不能使用SKIP。APPEND：会加载数据至对象，但不会影响已存在的行。TRUNCATE：删除已存在的行，然后加载所有的数据。REPLACE：drop已存在的表，然后create并加载数据。如果CONTENT设置了DATA_ONLY，则不能使用REPLACE。``` # 导入过程中，常用查询语句 查询表空间使用量，如果不够，可以添加文件SELECT FILE_NAME, TABLESPACE_NAME, BYTES / 1024 / 1024 “bytes MB”,MAXBYTES / 1024 / 1024 “maxbytes MB” FROM DBA_DATA_FILES WHERE TABLESPACE_NAME = ‘USERS’;ALTER TABLESPACE USERS ADD DATAFILE ‘/u01/app/oracle/oradata/sjzdb/users02.dbf’ SIZE 5M AUTOEXTEND ON MAXSIZE 32767M; 查看SCHEMAS占用的表空间大小SELECT OWNER, SUM(BYTES) / 1024 / 1024 / 1024 SCHEMA_SIZE_GIG FROM SYS.DBA_SEGMENTS GROUP BY OWNER; 查询schemas下的所有表SELECT TABLE_NAME FROM SYS.DBA_TABLES WHERE OWNER = ‘AIR_FORECAST’;```参考链接：http://blog.sina.com.cn/s/blog_67d41beb0100ixnb.htmlhttps://blog.csdn.net/bisal/article/details/51482968http://www.htz.pw/2015/05/20/expdp的compression测试.html]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>数据库</tag>
        <tag>Oracle</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[等保三级安全要求之开源软件实现]]></title>
    <url>%2Farlo%2F764ae16c%2F</url>
    <content type="text"><![CDATA[等级划分 《信息安全等级保护管理办法》规定，国家信息安全等级保护坚持自主定级、自主保护的原则。信息系统的安全保护等级应当根据信息系统在国家安全、经济建设、社会生活中的重要程度，信息系统遭到破坏后对国家安全、社会秩序、公共利益以及公民、法人和其他组织的合法权益的危害程度等因素确定。信息系统的安全保护等级分为以下五级：第一级，信息系统受到破坏后，会对公民、法人和其他组织的合法权益造成损害，但不损害国家安全、社会秩序和公共利益。第一级信息系统运营、使用单位应当依据国家有关管理规范和技术标准进行保护。第二级，信息系统受到破坏后，会对公民、法人和其他组织的合法权益产生严重损害，或者对社会秩序和公共利益造成损害，但不损害国家安全。国家信息安全监管部门对该级信息系统安全等级保护工作进行指导。第三级，信息系统受到破坏后，会对社会秩序和公共利益造成严重损害，或者对国家安全造成损害。国家信息安全监管部门对该级信息系统安全等级保护工作进行监督、检查。第四级，信息系统受到破坏后，会对社会秩序和公共利益造成特别严重损害，或者对国家安全造成严重损害。国家信息安全监管部门对该级信息系统安全等级保护工作进行强制监督、检查。第五级，信息系统受到破坏后，会对国家安全造成特别严重损害。国家信息安全监管部门对该级信息系统安全等级保护工作进行专门监督、检查。 本文目的主要是调研等保三级的硬件可以使用哪些软件来替换（有些有硬性要求另说），整理一版放在这里，以后的项目中如果有使用到，就不用在一一查找了。 安全管理中心系统OSSIMOSSIM即开源安全信息管理系统(OPEN SOURCE SECURITY INFORMATION MANAGEMENT)，是一个非常流行和完整的开源安全架构体系。OSSIM通过将开源产品进行集成，从而提供一种能够实现安全监控功能的基础平台。 它的目的是提供一种集中式、有组织的、能够更好地进行监测和显示的框架式系统。OSSIM由数据收集、监视、检测、审计以及控制台这五个模块构成。这5个模块包含了目前安全领域从事件预防到事件处理一个完整的过程，在目前的安全架构 中，OSSIM是最为完备的。这五个功能模块又被划分为三个层次，分别是高层的安全信息显示控制面板、中层的风险和活动监控以及底层的证据控制台和网络监控，各个层次提供不同功能，共同保证系统的安全运转。 开源堡垒机/运维审计系统JumpserverJumpserver是全球首款完全开源的堡垒机，使用 GNU GPL v2.0 开源协议，是符合 4A 的专业运维审计系统。支持支持RDP和SSH协议的跳转,支持命令，会话记录，支持资产管理，日志审计； GateOneGateone是一个基于tornado和html5技术的开源web ssh项目，功能很强大， 支持多个账户多个终端窗口连接远程机器， 支持多种认证登陆方式， 支持嵌入到各种web应用，支持多种插件等等。暂不支持windows TeleportTeleport是触维软件推出的一款简单易用的堡垒机系统，具有小巧、易用、易于集成的特点，支持RDP和SSH协议的跳转。 麒麟开源堡垒机麒麟堡垒机全协议支持、网管功能、3A系统功能、动态口令功能、SSL VPN功能、CA证书功能，支持RDP和SSH协议的跳转。 开源入侵检测系统(IDS/IPS)SnortSnort是最好的入侵检测系统（IDS）工具。它所需要的是一些在上面运行的硬件以及安装、配置和维护的时间。Snort可以在任何操作系统上运行，包括Windows和Linux。Snort 一直都是网络入侵检测（IDS）和入侵防御工具（IPS）的领导者，并且，随着开源社区的持续发展，为其母公司Sourcefire（多年 来，Sourcefire提供有供应商支持和即时更新的功能齐全的商业版本Snort，同时仍然免费提供功能有限的免费版本Snort）持续不断的支 持，Snort很可能会继续保持其领导地位。虽然Snort“称霸”这个市场，但也有其他供应商提供类似的免费工具。很多这些入侵检测系统（IDS）供应商（即使不是大多数）结合Snort或其他开源软件的引擎来创建强大的免费入侵检测服务。 Security OnionSecurity Onion是用于网络监控和入侵检测的基于Ubuntu的Linux发行版。该镜像可以作为传感器分布在网络中，以监控多个VLAN和子网，这很适用于 VMware和虚拟环境。该配置只能用作IDS，目前不能当作IPS运行。然而，你可以选择把它作为网络和主机入侵检测部署，以及利用Squil、Bro IDS和OSSEC等服务来执行该服务的IDS功能。该工具的wiki信息和文档信息很丰富，漏洞和错误也有记录和审查。虽然Security Onion很强大，但它仍然需要不断发展，当然这需要时间。 OSSECOSSEC是一个开源主机入侵检测系统（HIDS），它的功能不只是入侵检测。与大多数开源IDS产品一样，有多种附加模块可以结合该 IDS的核心功能。除了网络入侵检测外，OSSEC客户端能够执行文件完整性监控和rootkit检测，并有实时报警，这些功能都是集中管理，并能根据企 业的需求创建不同政策。OSSEC客户端在大多数操作系统上本地运行，包括Linux各版本、Mac OSX和Windows。它还通过趋势科技的全球支持团队提供商业支持，这是一个非常成熟的产品。 OpenWIPS-NGOpenWIPS-NG是一个免费的无线IDS / IPS，它依赖于服务器、传感器和接口。它可以在普通硬件上运行。其创建者是Aircrack-NG的开发者，该系统使用Aircrack-NG内置的很 多功能和服务来进行扫描、检测和入侵防御。OpenWIPS-NG是模块化的，允许管理员下载插件来增加功能。其文件并不像某些系统一样详细，但它允许公司在预算紧张的情况下执行WIPS。 Suricata在所有目前可用的IDS/IPS系统中，Suricata最能够与Snort相抗衡。该系统有一个类似Snort的架构，依赖于像 Snort等的签名，甚至可以使用VRT Snort规则和Snort本身使用的相同的Emerging Threat规则集。Suricata比Snort更新，它将有机会赶超Snort。如果Snort不是你企业的选择，这个免费的工具最适合运行在你的企 业网络中。 Bro IDSBro IDS类似于Security Onion，它使用更多IDS规则来确定攻击来源。Bro IDS使用工具组合，曾经它使用基于Snort的签名转换成Bro签名，不过现在不再是如此，现在用户能够为Bro IDS编写自定义签名。该系统有很多详细文档信息，并已有超过15年的历史。 Prelude IDS从设计的方式来看定位于适应大型网络的需求， 实现了网络探测器、日志分析器、告警信息集中查看分析工具。其网络探测器部分基本上翻版了Snort的功能，完全兼容Snort的规则集。 Firestorm是一个非常高性能的网络入侵检测系统(NIDS)。目前它仅实现了探测器部分，完全兼容Snort的规则集，但计划包括对分析、报告、远程控制台和实时传感器配置的真正支持。它完全可插拔，因此非常灵活，，可以把告警信息记录到Prelude IDS的管理器， 自称性能上比Snort强很多。 NetSTAT基于STAT(State Transition Analysis Technique，状态迁移分析技术)描述攻击的研究成果，使用特有的STATL语言描述攻击，攻击描述文本被STATL解释工具转换为C++代码编译进检测引擎来实现检测功能，目前已经发布了STATL语言解释转换工具及一个基本的示例网络探测器部分(很少的几个检测功能例子)。要熟练使用这个IDS工具需要比较强的编程功底，但用此IDS可以实现很复杂的检测功能。 Bro是一个Vern Paxson实现的实时网络入侵检测软件，于98年对外发布，BSD license，它的最初设计目标是实现一个在100M网络下实时告警、机制与策略分离、高可扩展性的入侵检测及网络监视审计系统。 开源的web应用防火墙Web应用防火墙提供应用层的安全。从本质上讲，WAF提供全面的web应用安全解决方案，确保数据和Web应用程序是安全的。Web应用防火墙，适用于跨站点脚本，SQL注入等，可以为Web应用程序提供安全的Web应用程序框架。Web应用防火墙允许您配置规则，通过识别阻止恶意内容。下面给出了10个最流行和广泛使用的开源的Web应用防火墙： ModSecurity的（Trustwave公司SpiderLabs）ModSecurity是一个最古老的和广泛使用的开放源码的Web应用程序防火墙能够检测应用层威胁在互联网上，并针对一系列Web应用程序的安全问题提供了安全保障。它提供非病毒的开放来源执照，它可以集成到Apache程序。近日，ModSecurity的发布2.6.0版提供的功能安全浏览API集成，敏感数据的跟踪和数据修改功能。 AQTRONIX WebKnightAQTRONIX WebKnight是一个开源应用程序专为Web服务器和IIS防火墙，它是通过GNU - 通用公共许可证授权。它提供了缓冲区溢出，目录遍历编码和SQL注入攻击识别/限制功能。 ESAPI WAFESAPI WAF是Aspect安全开发的，它被设计为提供保护，而不是在应用层网络层。它是基于Java的WAF提供完整的安全性，从网上攻击。一些解决方案的独特功能包括出站过滤功能，降低信息泄漏。配置驱动的，而不是代码的基础，它使安装方便，只需添加在文本文件中的配置细节。 WebCastellumWebCastellum是一个基于Java的Web应用防火墙，可以保护应用程序对跨站脚本，SQL注入，命令注入，参数操纵，它可以轻松地集成到一个基于Java的应用程序。它是基于新技术和提供保护，它可以使用现有的代码。 BinarysecBinarysec为Apache是​​Web应用程序防火墙软件，它可以保护应用程序免受非法HTTP和阻止可疑的请求以及。它提供保护，防止跨站点脚本，赞扬注射，参数篡改，缓冲区溢出，目录遍历，SQL注入攻击阻塞。这需要不超过10分钟来安装软件，在一台机器上，其用户界面可以管理Apache服务器和许多网站。 Guardian@JUMPERZ.NETGuardian@JUMPERZ.NET HTTPS / HTTP是一个开源应用层防火墙，HTTP / HTTPS流量评估保护Web应用程序免受外部攻击。Guardian@JUMPERZ.NET立即断开TCP连接，当应用程序来接触与恶意/未经授权的请求。 OpenWAFArt of defense是一个总部设在旧金山的Web应用程序的安全性提供者上开源OpenWAF的2011年2月启动了一个项目。这也是第一家提供Apache服务器的分布式Web应用防火墙。 IronbeeQualys公司创建基于云的开源Web应用程序防火墙 - Ironbee代替了传统的IP数据包检查的HTTP评估数据。它甚至可以跟踪跨站点脚本代码的攻击。Ironbee出版通过Apache许可证版本2，它提供无版权转让。它具有模块化结构，是相当容易使用。 ProfenseZION安全提供了一个开放源码的Web应用防火墙类似ModSecurity的，被称为Profense。Zion所提供的Web应用防火墙本质上是一个7层防火墙（也被称为“代理防火墙”），并检查交通封锁内容。 SmoothwallSmoothwall提供了强大的网络安全工具来管理电子邮件。开放源码的网页过滤引擎被称为Smoothwall DansGuardian的。它具有灵活的用户规则和一个完全集成的网页过滤和安全组件。更重要的是，它提供了身份验证的网络访问和 traffic blocking。Smoothwall免费防火墙安全加固Linux的GNU操作系统。 X-WAFX-WAF是一款适用中、小企业的云WAF系统，让中、小企业也可以非常方便地拥有自己的免费云WAF。 负载均衡Nginx工作在网络的7层之上，可以针对http应用做一些分流的策略，比如针对域名、目录结构，它的正则规则比HAProxy更为强大和灵活，这也是它目前广泛流行的主要原因之一，Nginx单凭这点可利用的场合就远多于LVS了。 HAProxyHAProxy 是一款提供高可用性、负载均衡以及基于TCP（第四层）和HTTP（第七层）应用的代理软件，支持虚拟主机，它是免费、快速并且可靠的一种解决方案。 HAProxy特别适用于那些负载特大的web站点，这些站点通常又需要会话保持或七层处理。HAProxy运行在时下的硬件上，完全可以支持数以万计的 并发连接。并且它的运行模式使得它可以很简单安全的整合进您当前的架构中， 同时可以保护你的web服务器不被暴露到网络上。 LVSLVS 使用Linux内核集群实现一个高性能、高可用的负载均衡服务器，它具有很好的可伸缩性（Scalability)、可靠性（Reliability)和可管理性（Manageability)。抗负载能力强、是工作在网络4层之上仅作分发之用，没有流量的产生，这个特点也决定了它在负载均衡软件里的性能最强的，对内存和cpu资源消耗比较低。 病毒过滤ClamaVClamAV 杀毒是Linux平台最受欢迎的杀毒软件，ClamAV属于免费开源产品，支持多种平台，如：Linux/Unix、MAC OS X、Windows、OpenVMS。ClamAV是基于病毒扫描的命令行工具，但同时也有支持图形界面的ClamTK工具。ClamAV主要用于邮件服务器扫描邮件。它有多种接口从邮件服务器扫描邮件，支持文件格式有如：ZIP、RAR、TAR、GZIP、BZIP2、HTML、DOC、PDF,、SIS CHM、RTF等等。ClamAV有自动的数据库更新器，还可以从共享库中运行。命令行的界面让ClamAV运行流畅。 Avria另一个Linux下最好的杀毒软件是Avria免费杀毒版，Avria提供可扩展配置，控制你的计算机成为可能。它有一些很强大的特性，例如：简单的脚本安装方式、命令行扫描器、自动更新(产品、引擎、VDF)、自我完整性程序检查等等。 AVG 免费版杀毒现在有超过10亿用户使用AVG杀毒，同样是Linux机器中不错的杀毒专家，免费版提供的特性比高级版要少。AVG目前还不支持图形界面。提供防病毒和防间谍工具，AVG运行速度很快，占用系统资源很少，支持主流Linux版本如：Debian、Ubuntu、Red hat、Cent OS、FreeBSD等等 VPNOpenVPNOpenVPN 是一个基于 OpenSSL 库的应用层 VPN 实现。和传统 VPN 相比，它的优点是简单易用。 参考链接：https://blog.csdn.net/chinajust/article/details/78663972http://www.aqniu.com/tools-tech/667.htmlhttp://www.cnnetsec.com/1006.htmlhttps://blog.csdn.net/chengxuyuanyonghu/article/details/60468470https://klionsec.github.io/2017/09/22/snortpentest/]]></content>
      <categories>
        <category>安全</category>
      </categories>
      <tags>
        <tag>等保</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Oracle 11g静默安装官方提供的examples]]></title>
    <url>%2Farlo%2F56125275%2F</url>
    <content type="text"><![CDATA[之前安装oracle的时候，没有安装默认的示例，练习过程中，教程常用的hr等用户都没有，可以从官网下载示例来安装。 下载官方example包登录http://www.oracle.com 到下载页浏览就可以找到名为 linux.x64_11gR2_examples.zipunzip linux.x64_11gR2_examples.zip 编辑rsp静默安装文件cp examples/response/demos_install.rsp .egrep -v &quot;^$|^#&quot; /home/oracle/demos_install.rsp123456ORACLE_HOSTNAME=siluxa_oracleUNIX_GROUP_NAME=oinstallINVENTORY_LOCATION=/u01/app/oraInventory/SELECTED_LANGUAGES=en,zh_CNORACLE_HOME=/u01/app/oracle/product/11.1.0/db_1ORACLE_BASE=/u01/app/oracle 静默安装example./runInstaller -silent -responseFile /home/oracle/demos_install.rsp -ignorePrereq 执行sql脚本文件，安装特定模式123456789101112131415161718192021222324252627[oracle@siluxa_oracle human_resources]$ sqlplus sys/solution as sysdbaSQL*Plus: Release 11.2.0.1.0 Production on Fri May 4 18:01:11 2018Copyright (c) 1982, 2009, Oracle. All rights reserved.Connected to:Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit ProductionWith the Partitioning, OLAP, Data Mining and Real Application Testing optionsSYS@orcl&gt; @?/demo/schema/human_resources/hr_main.sqlspecify password for HR as parameter 1:Enter value for 1: 123specify default tablespeace for HR as parameter 2:Enter value for 2: usersspecify temporary tablespace for HR as parameter 3:Enter value for 3: tempspecify password for SYS as parameter 4:Enter value for 4: solutionspecify log path as parameter 5:Enter value for 5: $ORACLE_HOME/demo/schema/log/ 1234567891011121314HR@orcl&gt; select table_name from user_tables;TABLE_NAME------------------------------REGIONSLOCATIONSJOB_HISTORYJOBSEMPLOYEESDEPARTMENTSCOUNTRIES7 rows selected. 这样就算安装完成了，可以使用hr进行学习了。 参考地址：https://blog.csdn.net/smstong/article/details/45891187]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>数据库</tag>
        <tag>Oracle</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[将绿色版Tomcat/Nginx注册成服务，实现开机自启动]]></title>
    <url>%2Farlo%2F956f976%2F</url>
    <content type="text"><![CDATA[我们常用的Tomcat，不管是在windows下还是linux下基本上都是绿色版本，解压、启动后直接使用。这就产生了一个问题，不能开机自自动，很不方便，linux下可以添加到/etc/rc.local实现开机自启，windows下也可以添加到开机启动项里；不过注册为系统服务更加方便一些，这里记录一下方法。 注册Tomcat服务检查系统环境确保64位的操作系统下是64位的Jdk1234F:\&gt;java -d64 -versionjava version &quot;1.7.0_80&quot;Java(TM) SE Runtime Environment (build 1.7.0_80-b15)Java HotSpot(TM) 64-Bit Server VM (build 24.80-b11, mixed mode) 使用tomcat自身工具注册服务进入到tomcat bin目录下，执行12345678910111213141516171819#注册服务service.bat install &apos;服务名&apos; #服务名中不能有&quot;-&quot;,&quot;_&quot;，否则在服务中看不到F:\apache-tomcat-7.0.70(zabbix)\bin&gt;service.bat install tomcat7070 Installing the service &apos;tomcat7070&apos; ...Using CATALINA_HOME: &quot;F:\apache-tomcat-7.0.70(zabbix)&quot;Using CATALINA_BASE: &quot;F:\apache-tomcat-7.0.70(zabbix)&quot;Using JAVA_HOME: &quot;C:\Program Files\Java\jdk1.7.0_80&quot;Using JRE_HOME: &quot;C:\Program Files\Java\jdk1.7.0_80\jre&quot;Using JVM: &quot;C:\Program Files\Java\jdk1.7.0_80\jre\bin\server\jvm.dll&quot;The service &apos;tomcat7070&apos; has been installed.#卸载服务service.bat remove &apos;服务名&apos; F:\apache-tomcat-7.0.70(zabbix)\bin&gt;service.bat remove tomcat7070Removing the service &apos;tomcat7070&apos; ...Using CATALINA_BASE: &quot;F:\apache-tomcat-7.0.70(zabbix)&quot;The service &apos;tomcat7070&apos; has been removed 注册Nginx服务下载Windows Server 2003 Resource Kit Tools其实我们只需要里边instsrv.exe、srvany.exe这两个工具https://www.microsoft.com/en-IE/download/details.aspx?id=17657 注册Nginx服务安装完上述工具，打开C:\Program Files (x86)\Windows Resource Kits\Tools， 复制srvany.exe到nginx.exe同级目录下。1sc create &quot;Nginx&quot; binPath=&quot;D:\deploy\nginx-1.12.1\srvany.exe&quot; start=auto 导入注册表复制一下内容，保存为.reg格式文件，双击导入到注册表12345Windows Registry Editor Version 5.00 [HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Nginx\Parameters] &quot;Application&quot;=&quot;D:\\deploy\\nginx-1.12.1\\nginx.exe&quot; &quot;AppParameters&quot;=&quot;&quot; &quot;AppDirectory&quot;=&quot;D:\\deploy\\nginx-1.12.1&quot; 启动关闭服务1234567# 启动C:\&gt;net start NginxNginx 服务正在启动 .Nginx 服务已经启动成功。# 关闭windows下nginx默认会启动两个进程，如果使用net stop Nginx的话只能关闭一个nginx进程，不能完全关闭taskkill /F /IM nginx.exe 参考资料：http://www.cnblogs.com/xwdreamer/p/3411986.htmlhttp://wlbbswl.iteye.com/blog/840538https://blog.csdn.net/qq_16022261/article/details/53836004http://koda.iteye.com/blog/600725]]></content>
      <categories>
        <category>常识</category>
      </categories>
      <tags>
        <tag>Tomcat</tag>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Zabbix(9)结合sensor监控cpu温度]]></title>
    <url>%2Farlo%2Fce74a028%2F</url>
    <content type="text"><![CDATA[zabbix 可以通过sensors-detect检测内核模块，使用zabbix监控系统自定义监控项，采集监控数据并设置告警。可以监控物理机器(虚拟机获取不到)的温度。 安装sensors安装、运行sensors，可以看到每颗cpu的温度123456789101112131415161718192021222324252627282930313233[root@siluxa2 src]# yum install lm_sensors[root@siluxa2 src]# sensorsi350bb-pci-0100Adapter: PCI adapterloc1: +50.0°C (high = +120.0°C, crit = +110.0°C)coretemp-isa-0000Adapter: ISA adapterPhysical id 0: +55.0°C (high = +80.0°C, crit = +90.0°C)Core 0: +45.0°C (high = +80.0°C, crit = +90.0°C)Core 1: +46.0°C (high = +80.0°C, crit = +90.0°C)Core 2: +45.0°C (high = +80.0°C, crit = +90.0°C)Core 3: +46.0°C (high = +80.0°C, crit = +90.0°C)Core 4: +46.0°C (high = +80.0°C, crit = +90.0°C)Core 8: +46.0°C (high = +80.0°C, crit = +90.0°C)Core 9: +46.0°C (high = +80.0°C, crit = +90.0°C)Core 10: +46.0°C (high = +80.0°C, crit = +90.0°C)Core 11: +44.0°C (high = +80.0°C, crit = +90.0°C)Core 12: +45.0°C (high = +80.0°C, crit = +90.0°C)coretemp-isa-0001Adapter: ISA adapterPhysical id 1: +49.0°C (high = +80.0°C, crit = +90.0°C)Core 0: +42.0°C (high = +80.0°C, crit = +90.0°C)Core 1: +41.0°C (high = +80.0°C, crit = +90.0°C)Core 2: +41.0°C (high = +80.0°C, crit = +90.0°C)Core 3: +41.0°C (high = +80.0°C, crit = +90.0°C)Core 4: +42.0°C (high = +80.0°C, crit = +90.0°C)Core 8: +41.0°C (high = +80.0°C, crit = +90.0°C)Core 9: +42.0°C (high = +80.0°C, crit = +90.0°C)Core 10: +41.0°C (high = +80.0°C, crit = +90.0°C)Core 11: +41.0°C (high = +80.0°C, crit = +90.0°C)Core 12: +41.0°C (high = +80.0°C, crit = +90.0°C) 配置zabbix agent客户端文件修改客户端配置文件zabbix_agentd.conf第一次自定义监控时要设置1UnsafeUserParameters=1 在配置文件中添加一行：1UserParameter=get_temp_cpu[*],sensors|grep &quot;Physical id $1&quot;|cut -c 17-20 添加监控项123456sensor[device,sensor,&lt;mode&gt;]读取硬件传感器device - 设备名称 sensor - 传感器名称 mode - 可选值:avg, max, min示例key: sensor[w83781d-i2c-0-2d,temp1] Prior to Zabbix 1.8.4, the sensor[temp1] format was used. On Linux 2.6+, 读取/sys/class/hwmon. On OpenBSD, 读取hw.sensors MIB.示例keys: sensor[cpu0,temp0] – CPU0的温度 sensor[cpu[0-2]$,temp,avg] – cpu平均温度Zabbix 1.8.4开始支持OpenBSD 我这里添加两颗cpu为例！ 添加触发器 添加图形 查看图形 参考链接：http://xy.uyun.cn/post/1865.html]]></content>
      <categories>
        <category>监控</category>
      </categories>
      <tags>
        <tag>自动化</tag>
        <tag>运维</tag>
        <tag>zabbix</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Zabbix(8)使用ansible批量部署zabbix agent]]></title>
    <url>%2Farlo%2F7c94dafb%2F</url>
    <content type="text"><![CDATA[相同系统环境部署zabbix agent，可以使用ansible playbook来实现，大概分为以下几步。 ansible 目录结构[root@sl_confluence ansible]# pwd/etc/ansible[root@sl_confluence ansible]# tree1234567891011121314.├── ansible.cfg├── hosts├── roles│ └── zabbix_agent│ ├── files│ │ └── zabbix-agent-3.4.8-1.el6.x86_64.rpm│ ├── tasks│ │ └── main.yml│ └── templates│ └── zabbix_agentd.conf.j2└── zabbix_agent.yml5 directories, 6 files 查看 hosts文件[root@sl_confluence ansible]# cat hosts12[zabbix_agent]dbserver [root@sl_confluence ansible]# cat zabbix_agent.yml123456789- hosts: zabbix_agent user: root vars: zabbix_serverip: 192.168.6.186 # zabbix 服务器IP zabbix_activeip: 192.168.6.186 # zabbix 服务器IP agent_hostname: &apos;&#123;&#123; ansible_hostname &#125;&#125;&apos; # 客户端hostname agent_ip: &apos;&#123;&#123; ansible_eth0.ipv4.address &#125;&#125;&apos; # 客户端IP 根据实际情况修改自己的网卡名字eth0 改成自己服务器 roles: - zabbix_agent [root@sl_confluence tasks]# cat main.yml12345678910- name: copy zabbix_agentd copy: src=/etc/ansible/roles/zabbix_agent/files/zabbix-agent-3.4.8-1.el6.x86_64.rpm dest=/usr/local/src/zabbix-agent-3.4.8-1.el6.x86_64.rpm- name: install zabbix-agend shell: rpm -ivh /usr/local/src/zabbix-agent-3.4.8-1.el6.x86_64.rpm # 安装zabbix agentd- name: up zabbix-agent file client # 上传配置文件 template: src=zabbix_agentd.conf.j2 dest=/etc/zabbix/zabbix_agentd.conf- name: enabled service zabbix-agent # 打开zabbix-agent 开机启动 service: name=zabbix-agent enabled=yes- name: start service zabbix-agent # 启动zabbix-agent service: name=zabbix-agent state=started 定义zabbix_agent.conf模板文件12345678910[root@sl_confluence templates]# cat zabbix_agentd.conf.j2 PidFile=/var/run/zabbix/zabbix_agentd.pidLogFile=/var/log/zabbix/zabbix_agentd.logEnableRemoteCommands=1Server=&#123;&#123;zabbix_serverip&#125;&#125;ListenPort=10050ServerActive=&#123;&#123;zabbix_activeip&#125;&#125;Hostname=&#123;&#123;ansible_hostname&#125;&#125;AllowRoot=1Include=/etc/zabbix/zabbix_agentd.d/*.conf 执行安装1ansible-playbook zabbix_agent.yml]]></content>
      <categories>
        <category>监控</category>
      </categories>
      <tags>
        <tag>自动化</tag>
        <tag>运维</tag>
        <tag>Ansible</tag>
        <tag>zabbix</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Zabbix(7)监控端口、服务存活]]></title>
    <url>%2Farlo%2F429ab963%2F</url>
    <content type="text"><![CDATA[之前添加的tomcat监控，只能监控到jvm，类，线程之类的参数，不能监控tomcat本身的存活状态，总感觉有点美中不足；网上找了下，监控端口、服务还是挺简单的，这里记录一下。 zabbix有三种监控端口的监控项方法1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859601.net.tcp.listen[port] 用于监听端口是否开启 1表示开启 0表示未开启 2.net.tcp.port[,port] 是否 可 以 连 接 到 指 定的 TCP 端口 0 – 无法连接 1 – 可以连接 ip – IP 地址(默认是 127.0. 0.1) port – 端口 范例: net.tcp.port[,80] 检测 web 服务器端口是否运行中3.net.tcp.service[service,,] 检 测 服 务 是否开启， 并 且 端 口 可用 0 – 服务挂了 1 – 服务运行中 service – 如下: ssh, ntp, ldap, smtp, ftp, http, p op, nntp,imap, tcp, https, telnet ip – IP地址 (默认127.0.0. 1) port – 端口 (默认情况为标 准端口号) 示例 key: net.tcp.service[ftp,,45] – 检测 45 端口 上得 FTP 是否运行中 Zabbix 1.8.3 支持的版本请使用 service.n tp 代替 ntp. https 和 telnet 服务从 2.0 和 2.2 开始支持4.net.tcp.service.perf[service,,] 检 测 服 务 器性能 0 – 服务挂了; seconds – 链接到 服务器端口消耗的时 间 service – 如下:ssh, ntp, ldap, smtp, ftp, http, po p, nntp,imap, tcp, https, telnet ip – IP地址 (默认127.0.0. 1) port – 端口 (默认情况为标 准端口号)5.net.udp.listen[port] 检测 UDP 端 口 是 否 在监听 0 – 未监听 1 – 监听中 port – udp 端口 范例: net.udp.listen[68] 监控tomcat 8080端口添加监控项 添加触发器 添加图形 参考链接：http://www.cnblogs.com/saneri/p/6126786.html]]></content>
      <categories>
        <category>监控</category>
      </categories>
      <tags>
        <tag>zabbix</tag>
        <tag>监控</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Centos6环境下搭建及破解confluence]]></title>
    <url>%2Farlo%2F58cb2af9%2F</url>
    <content type="text"><![CDATA[Confluence是一个专业的企业知识管理与协同软件，也可以用于构建企业wiki。使用简单，但它强大的编辑和站点管理特征能够帮助团队成员之间共享信息、文档协作、集体讨论，信息推送。【来自百度百科】 我们只是需要一个知识库……公司没有专门的知识库，企业wiki，团队的人资料文档都放在自己手里，你懂的？工作的文档一直都是svn提交，查看起来很不方便；长时间下来，没有技术共享、交流，积累；多方询问，别人推荐使用confluence，先搭建起来用用看。 系统环境Centos 6.9Jdk 1.8.112Mysql 5.7.20Atlassian-confluence-6.3.1 安装jdk12345678tar xf jdk-8u112-linux-x64.tar.gz -C /usr/local/-- 配置环境变量vim /etc/profileexport JAVA_HOME=/usr/local/jdk1.8.0_112/export CLASSPATH=.:$JAVA_HOME/lib/:$JAVA_HOME/jre/lib/export PATH=$JAVA_HOME/bin:$PATH-- 使环境变量生效source /etc/profile 安装mysql123456789101112wget https://mirrors.huaweicloud.com/repository/toolkit/mysql/Downloads/MySQL-5.7/mysql-5.7.20-1.el6.x86_64.rpm-bundle.tartar xf mysql-5.7.20-1.el6.x86_64.rpm-bundle.tar yum localinstall mysql-community-common-5.7.20-1.el6.x86_64.rpm mysql-community-client-5.7.20-1.el6.x86_64.rpm mysql-community-server-5.7.20-1.el6.x86_64.rpm mysql-community-libs-compat-5.7.20-1.el6.x86_64.rpm mysql-community-libs-5.7.20-1.el6.x86_64.rpm mysql-community-devel-5.7.20-1.el6.x86_64.rpm-- 修改mysql参数vim /etc/my.cnfmax_allowed_packet = 256Minnodb_log_file_size=512M--启动mysqld服务/etc/init.d/mysqld start--查看初始密码grep &apos;temporary password&apos; /var/log/mysqld.log 2018-04-03T02:44:31.357861Z 1 [Note] A temporary password is generated for root@localhost: OUGiG=n-l8lY 123456789101112131415161718192021222324[root@3g3MplC6 ~]# mysql -uroot -pOUGiG=n-l8lYmysql: [Warning] Using a password on the command line interface can be insecure.Welcome to the MySQL monitor. Commands end with ; or \g.Your MySQL connection id is 12Server version: 5.7.20Copyright (c) 2000, 2017, Oracle and/or its affiliates. All rights reserved.Oracle is a registered trademark of Oracle Corporation and/or itsaffiliates. Other names may be trademarks of their respectiveowners.Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.--mysql5.7密码策略比较高，设置一下复杂度和长度mysql&gt; set global validate_password_policy=0;Query OK, 0 rows affected (0.00 sec)mysql&gt; set global validate_password_length=1;Query OK, 0 rows affected (0.00 sec)--修改一下root用户的密码为&apos;ffffff&apos;(生产环境不建议这么操作)mysql&gt; alter user root@localhost identified by &apos;ffffff&apos;;Query OK, 0 rows affected (0.00 sec)--创建一个mysql数据库confluence，创建用户confluence，密码为confluencepwdmysql -uroot -p&apos;ffffff&apos; -e &quot;create database confluence default character set utf8 collate utf8_bin;grant all on confluence.* to &apos;confluence&apos;@&apos;%&apos; identified by &apos;confluencepwd&apos;;&quot; 安装confluence123456789wget https://www.atlassian.com/software/confluence/downloads/binary/atlassian-confluence-6.3.1-x64.bin数据库驱动包和破解补丁包: 链接: https://pan.baidu.com/s/1YfwGC2NDBVs3udsVb-i6fA 密码: ix7uchmod +x atlassian-confluence-6.3.1-x64.bin./atlassian-confluence-6.3.1-x64.bin/etc/init.d/confluence stop上传以下两个包到此目录下/opt/atlassian/confluence/confluence/WEB-INF/libatlassian-extras-3.2.jarmysql-connector-java-5.1.42-bin.jar/etc/init.d/confluence start 可以看到安装目录为Installation Directory: /opt/atlassian/confluenceHome Directory: /var/atlassian/application-data/confluence默认端口为8090 配置confluencehttp://192.168.6.186:8090 设置为中文语言 产品安装 直接下一步 复制服务器ID，点击获得授权码 参考图片设置12345678910服务器ID：BZ0A-OLZE-ZYYB-3PFX授权码：AAABLA0ODAoPeNptkF9rwjAUxd/zKQJ72PYQSaOiCIFp24FQragbU/aShesWqLHepKLffqmdzP15CISce8753dwsK6DDEilvU84HXT4QEY2TJRU86pMEnEZTerOzMt7ZTVGB1UDvFoAHwPvXAU0PqqhUPUBihPMlUR5kbWe8w3ibBKNX2k/VFmTE+/2e6ImH/b6ld1uiQ2griOYA0mMFzcPCK/SAcqMKBxd/OlGm+BPw3X/lz4wG62B5KuHcGueTSTqPx8OMFI30DOhqjyAh1XqwKuyVHkuDpyv8bo2f47uyxjUdR3OrLGnWHydytOZDlmfrlK1XqxFrzx5fyCKdynBYFkWdnhC8S75wwnw2Tn5KZ9xptX0DzDdPLlBJFl0M//PMKtQfysHvb/4EqFmR3DAtAhUAjJ5DzWcXkYufaw72NYIZs/rFeJgCFEocDK77ZwHKpPhhIvo1bD3HDmJIX02f3 选择MySQL 选择JDBC根据下图显示，在数据库URL添加?useSSL=false&amp;amp;useUnicode=true&amp;amp;characterEncoding=utf8&amp;amp;是代替&amp;，否则启动会报错，这里没有改的话，可以在/var/atlassian/application-data/confluence/confluence.cfg.xml文件中修改 选择空白站点 在Confluence中管理用户与组 配置系统管理员账户 配置完成 破解confluence替换/opt/atlassian/confluence/confluence/WEB-INF/lib/atlassian-extras-decoder-v2-3.2.jar包，进行破解 参考链接:https://blog.csdn.net/wh211212/article/details/76131569http://www.confluence.cn]]></content>
      <categories>
        <category>服务器搭建</category>
      </categories>
      <tags>
        <tag>confluence</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Oracle RAC手动启动与关闭及常用命令]]></title>
    <url>%2Farlo%2Fd56aba68%2F</url>
    <content type="text"><![CDATA[在经历了几次服务器意外断电，启动rac报错；觉得之前直接“shutdown -h now”这种方式还是太“粗暴”，需要一种“温柔”的方式来操作她。 查看一下RAC节点的服务状态123456789101112131415161718192021222324252627[grid@rac1 ~]$ crs_stat -t -vName Type R/RA F/FT Target State Host ----------------------------------------------------------------------ora.DATA.dg ora....up.type 0/5 0/ ONLINE ONLINE rac1 ora....ER.lsnr ora....er.type 0/5 0/ ONLINE ONLINE rac1 ora....N1.lsnr ora....er.type 0/5 0/0 ONLINE ONLINE rac1 ora.OCR.dg ora....up.type 0/5 0/ ONLINE ONLINE rac1 ora....DISK.dg ora....up.type 0/5 0/ ONLINE ONLINE rac1 ora.asm ora.asm.type 0/5 0/ ONLINE ONLINE rac1 ora.cvu ora.cvu.type 0/5 0/0 ONLINE ONLINE rac1 ora.gsd ora.gsd.type 0/5 0/ OFFLINE OFFLINE ora....network ora....rk.type 0/5 0/ ONLINE ONLINE rac1 ora.oc4j ora.oc4j.type 0/1 0/2 ONLINE ONLINE rac2 ora.ons ora.ons.type 0/3 0/ ONLINE ONLINE rac1 ora.orcl.db ora....se.type 0/2 0/1 ONLINE ONLINE rac1 ora....SM1.asm application 0/5 0/0 ONLINE ONLINE rac1 ora....C1.lsnr application 0/5 0/0 ONLINE ONLINE rac1 ora.rac1.gsd application 0/5 0/0 OFFLINE OFFLINE ora.rac1.ons application 0/3 0/0 ONLINE ONLINE rac1 ora.rac1.vip ora....t1.type 0/0 0/0 ONLINE ONLINE rac1 ora....SM2.asm application 0/5 0/0 ONLINE ONLINE rac2 ora....C2.lsnr application 0/5 0/0 OFFLINE OFFLINE ora.rac2.gsd application 0/5 0/0 OFFLINE OFFLINE ora.rac2.ons application 0/3 0/0 ONLINE ONLINE rac2 ora.rac2.vip ora....t1.type 0/0 0/0 ONLINE ONLINE rac2 ora.scan1.vip ora....ip.type 0/0 0/0 ONLINE ONLINE rac1 ora.sx21.db ora....se.type 0/2 0/1 ONLINE ONLINE rac1 关闭RAC关闭顺序：关闭数据库(实例)–&gt;关闭ASM实例–&gt;关闭节点服务 关闭数据库123--关闭数据库srvctl stop database -d sx21srvctl stop database -d orcl 关闭ASM实例从11.2 Grid Infrastructure开始， ASM diskgroups也注册为CRS资源。而diskgroup资源是依赖于ASM的，所以不能首先要停止’ora.ASM.dg’这个服务，或者直接使用-f选项强制停止ASM。12345678-- 查看asm磁盘相关信息sqlplus / as sysasmSQL&gt; select instance_name,status from v$instance;SQL&gt; col name format a10SQL&gt; set line 9999SQL&gt; col path format a15SQL&gt; select group_number,path,name,disk_number,total_mb,free_mb,create_date,mount_status,mount_date from v$asm_disk order by group_number desc,disk_number;SQL&gt; select name,state,free_mb,required_mirror_free_mb,usable_file_mb from v$asm_diskgroup; 1234--关闭磁盘组， 状态从ONLINE变成OFFLINEsrvctl stop diskgroup -g datasrvctl stop diskgroup -g ocrsrvctl stop diskgroup -g votingdisk 123--关闭asmsrvctl stop asm -n rac1srvctl stop asm -n rac2 关闭各节点的服务包括：listener、gsd、ons、vip12srvctl stop nodeapps -n rac1srvctl stop nodeapps -n rac2 启动RAC启动顺序：启动节点服务–&gt;启动ASM实例–&gt;启动数据库实例 启动各节点的服务包括：listener、gsd、ons、vip12srvctl start nodeapps -n rac1srvctl start nodeapps -n rac2 启动asm12srvctl start asm -n rac1srvctl start asm -n rac2 启动数据库12srvctl start database -d sx21srvctl start database -d orcl RAC常用操作命令1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950--查看集群状态crsctl stat res -tcrsctl check cluster -allcrs_stat -t -v--查看数据库配置srvctl config database -d sx21--查看数据库状态srvctl status database -d sx21--启动数据库srvctl start database -d sx21--关闭数据库srvctl stop database -d sx21--查看asm状态srvctl status asm -n rac1srvctl status asm -n rac2--关闭asm 状态从ONLINE变成OFFLINEsrvctl stop diskgroup -g datasrvctl stop diskgroup -g ocrsrvctl stop diskgroup -g votingdisk--开启asm srvctl start diskgroup -g datasrvctl start diskgroup -g ocrsrvctl start diskgroup -g votingdisk--查看vip状态srvctl status vip -n rac1 -v--启动vipsrvctl start vip -n rac1 -v--停止vipsrvctl stop vip -n rac2 -f -vsrvctl stop vip -n rac1 -f -v-- 查看asm磁盘相关信息sqlplus / as sysasmSQL&gt; select instance_name,status from v$instance;SQL&gt; col name format a10SQL&gt; set line 9999SQL&gt; col path format a15SQL&gt; select group_number,path,name,disk_number,total_mb,free_mb,create_date,mount_status,mount_date from v$asm_disk order by group_number desc,disk_number;SQL&gt; select name,state,free_mb,required_mirror_free_mb,usable_file_mb from v$asm_diskgroup;---------------------------------------------------------以下操作需要使用root用户-- 单一节点启动crsctl start hascrsctl start crscrsctl check crs-- 所有节点启动crsctl status cluster -n rac1 rac2crsctl start cluster -allcrsctl check cluster -all]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>数据库</tag>
        <tag>Oracle</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[记录一次oracle rac数据库启动故障修复过程]]></title>
    <url>%2Farlo%2F1b263496%2F</url>
    <content type="text"><![CDATA[周末测试服务器意外断电关机了，早上启动起来机器，发现数据库起不来了，以下记录一下排查过程。经过查看sx21和orcl两个数据库都是“Instance Shutdown”状态。 查看rac启动状态123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051[grid@rac1 ~]$ crsctl stat res -t--------------------------------------------------------------------------------NAME TARGET STATE SERVER STATE_DETAILS --------------------------------------------------------------------------------Local Resources--------------------------------------------------------------------------------ora.DATA.dg ONLINE ONLINE rac1 ONLINE ONLINE rac2 ora.LISTENER.lsnr ONLINE ONLINE rac1 ONLINE ONLINE rac2 ora.OCR.dg ONLINE ONLINE rac1 ONLINE ONLINE rac2 ora.VOTINGDISK.dg ONLINE ONLINE rac1 ONLINE ONLINE rac2 ora.asm ONLINE ONLINE rac1 Started ONLINE ONLINE rac2 Started ora.gsd OFFLINE OFFLINE rac1 OFFLINE OFFLINE rac2 ora.net1.network ONLINE ONLINE rac1 ONLINE ONLINE rac2 ora.ons ONLINE ONLINE rac1 ONLINE ONLINE rac2 --------------------------------------------------------------------------------Cluster Resources--------------------------------------------------------------------------------ora.LISTENER_SCAN1.lsnr 1 ONLINE ONLINE rac1 ora.cvu 1 ONLINE ONLINE rac1 ora.oc4j 1 ONLINE ONLINE rac2 ora.orcl.db 1 ONLINE OFFLINE Instance Shutdown 2 ONLINE OFFLINE Instance Shutdown ora.rac1.vip 1 ONLINE ONLINE rac1 ora.rac2.vip 1 ONLINE ONLINE rac2 ora.scan1.vip 1 ONLINE ONLINE rac1 ora.sx21.db 1 ONLINE OFFLINE Instance Shutdown 2 ONLINE OFFLINE Instance Shutdown 手动启动数据库手动启动sx21数据库报错1234567891011121314[grid@rac1 ~]$ srvctl start database -d sx21PRCR-1079 : Failed to start resource ora.sx21.dbCRS-5017: The resource action &quot;ora.sx21.db start&quot; encountered the following error: ORA-00600: internal error code, arguments: [kcratr_scan_lastbwr], [], [], [], [], [], [], [], [], [], [], []. For details refer to &quot;(:CLSN00107:)&quot; in &quot;/u01/app/11.2.0/grid/log/rac1/agent/crsd/oraagent_oracle/oraagent_oracle.log&quot;.CRS-5017: The resource action &quot;ora.sx21.db start&quot; encountered the following error: ORA-01157: cannot identify/lock data file 6 - see DBWR trace fileORA-01110: data file 6: &apos;/u01/app/oracle/11g/dbs/E:APPADMINISTRATORORADATASX21ALK.DBF&apos;. For details refer to &quot;(:CLSN00107:)&quot; in &quot;/u01/app/11.2.0/grid/log/rac2/agent/crsd/oraagent_oracle/oraagent_oracle.log&quot;.CRS-2674: Start of &apos;ora.sx21.db&apos; on &apos;rac1&apos; failedCRS-2674: Start of &apos;ora.sx21.db&apos; on &apos;rac2&apos; failedCRS-2632: There are no more servers to try to place resource &apos;ora.sx21.db&apos; on that would satisfy its placement policy 手动启动orcl数据库报错12345678910[grid@rac1 ~]$ srvctl start database -d orclPRCC-1014 : orcl was already runningPRCR-1004 : Resource ora.orcl.db is already runningPRCR-1079 : Failed to start resource ora.orcl.dbCRS-5017: The resource action &quot;ora.orcl.db start&quot; encountered the following error: ORA-01589: must use RESETLOGS or NORESETLOGS option for database open. For details refer to &quot;(:CLSN00107:)&quot; in &quot;/u01/app/11.2.0/grid/log/rac2/agent/crsd/oraagent_oracle/oraagent_oracle.log&quot;.CRS-2674: Start of &apos;ora.orcl.db&apos; on &apos;rac2&apos; failedCRS-2528: Unable to place an instance of &apos;ora.orcl.db&apos; as all possible servers are occupied by the resource 恢复数据库sx21另外开一个窗口，连接sx21数据库；恢复数据库1234567891011121314151617181920212223242526272829303132333435363738394041[root@rac1 ~]# su - oracle[oracle@rac1 ~]$ export ORACLE_SID=sx211[oracle@rac1 ~]$ sqlplus / as sysdbaSQL*Plus: Release 11.2.0.4.0 Production on Mon Apr 2 09:43:52 2018Copyright (c) 1982, 2013, Oracle. All rights reserved.Connected to an idle instance.SQL&gt; startupORACLE instance started.Total System Global Area 2471931904 bytesFixed Size 2255752 bytesVariable Size 687867000 bytesDatabase Buffers 1761607680 bytesRedo Buffers 20201472 bytesDatabase mounted.ORA-00600: internal error code, arguments: [kcratr_scan_lastbwr], [], [], [],[], [], [], [], [], [], [], []SQL&gt; select open_mode from v$database;OPEN_MODE--------------------MOUNTEDSQL&gt; alter database open resetlogs;alter database open resetlogs*ERROR at line 1:ORA-01139: RESETLOGS option only valid after an incomplete database recoverySQL&gt; recover database;Media recovery complete.SQL&gt; alter database open;Database altered. 恢复数据库orcl另外orcl实例，情况不太一样；直接恢复的话，会报错；需要我们手动指定恢复文件。123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114[oracle@rac1 ~]$ export ORACLE_SID=orcl11[oracle@rac1 ~]$ sqlplus / as sysdbaSQL*Plus: Release 11.2.0.4.0 Production on Mon Apr 2 09:51:24 2018Copyright (c) 1982, 2013, Oracle. All rights reserved.Connected to an idle instance.SQL&gt; startupORACLE instance started.Total System Global Area 2471931904 bytesFixed Size 2255752 bytesVariable Size 687867000 bytesDatabase Buffers 1761607680 bytesRedo Buffers 20201472 bytesDatabase mounted.ORA-00600: internal error code, arguments: [kcratr_nab_less_than_odr], [1],[115], [49383], [49388], [], [], [], [], [], [], []-- 查看数据库模式SQL&gt; select open_mode from v$database;OPEN_MODE--------------------MOUNTED--此时数据库启动到mount状态，尝试以resetlogs方式open数据库，也无法打开SQL&gt; alter database open resetlogs; alter database open resetlogs*ERROR at line 1:ORA-01139: RESETLOGS option only valid after an incomplete database recoverySQL&gt; recover database;ORA-00283: recovery session canceled due to errorsORA-00600: internal error code, arguments: [krr_read_5], [115], [49383], [],[], [], [], [], [], [], [], []--查看当前日志文件情况SQL&gt; select v1.group#, member, sequence#, first_change# from v$log v1, v$logfile v2 where v1.group# = v2.group#; GROUP#----------MEMBER-------------------------------------------------------------------------------- SEQUENCE# FIRST_CHANGE#---------- ------------- 1+DATA/orcl/onlinelog/group_1.261.970078827 115 4674751 2+DATA/orcl/onlinelog/group_2.262.970078829 114 4622551 GROUP#----------MEMBER-------------------------------------------------------------------------------- SEQUENCE# FIRST_CHANGE#---------- ------------- 3+DATA/orcl/onlinelog/group_3.266.970078993 65 4646182 4+DATA/orcl/onlinelog/group_4.267.970078995 GROUP#----------MEMBER-------------------------------------------------------------------------------- SEQUENCE# FIRST_CHANGE#---------- ------------- 66 4688519SQL&gt; recover database using backup controlfile until cancel;ORA-00279: change 4674751 generated at 04/01/2018 15:33:57 needed for thread 1ORA-00289: suggestion : /u01/app/oracle/11g/dbs/arch1_115_970078828.dbfORA-00280: change 4674751 for thread 1 is in sequence #115-- 记录住这里提示的change号和sqeuence号，去上边记录中查找文件名Specify log: &#123;&lt;RET&gt;=suggested | filename | AUTO | CANCEL&#125;+DATA/orcl/onlinelog/group_1.261.970078827-- 输入文件路径名称，进行恢复ORA-00279: change 4674751 generated at 04/01/2018 10:23:59 needed for thread 2ORA-00289: suggestion : /u01/app/oracle/11g/dbs/arch2_65_970078828.dbfORA-00280: change 4674751 for thread 2 is in sequence #65Specify log: &#123;&lt;RET&gt;=suggested | filename | AUTO | CANCEL&#125;+DATA/orcl/onlinelog/group_3.266.970078993ORA-00279: change 4688519 generated at 04/01/2018 18:01:42 needed for thread 2ORA-00289: suggestion : /u01/app/oracle/11g/dbs/arch2_66_970078828.dbfORA-00280: change 4688519 for thread 2 is in sequence #66ORA-00278: log file &apos;+DATA/orcl/onlinelog/group_3.266.970078993&apos; no longerneeded for this recoverySpecify log: &#123;&lt;RET&gt;=suggested | filename | AUTO | CANCEL&#125;+DATA/orcl/onlinelog/group_4.267.970078995Log applied.Media recovery complete.--恢复完成后，再次可以正常打开数据库，重启数据库正常。SQL&gt; alter database open resetlogs;Database altered.SQL&gt; select open_mode from v$database;OPEN_MODE--------------------READ WRITE 参考链接：https://www.cnblogs.com/jionjionyou/p/5602019.htmlhttps://blog.csdn.net/linucle/article/details/8778046]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>数据库</tag>
        <tag>Oracle</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[使用wgrib2将GFS数据导入到mysql]]></title>
    <url>%2Farlo%2F551cdbc9%2F</url>
    <content type="text"><![CDATA[GFS数据来源 数据来源采自美国国家环境预报中心的GFS(全球预报系统)，该系统每天发布4次全球范围的气象数据，分辨率最高可达到0.25° x 0.25°，精度还是比较可观的。GFS数据提供FTP下载方式：http://www.ftp.ncep.noaa.gov/data/nccf/com/gfs/prod/每次发布的数据保存在命名为gfs.YYYYMMDDHH的文件夹中。本次需要的数据精度为0.25°（0p25），所以数据的文件名为：gfs.t{HH}z.pgrb2.0p25.f{XXX}其中HH表示发布的时间，XXX表示未来几小时的预报数据。例如gfs.t00z.pgrb2.0p25.f001 表示0时发布的未来1小时气象数据信息。那么问题来了，这个文件太大了，因为分辨率比较高，每个文件高达200多MB，不仅下载速度慢，处理慢，对存储空间也是一个考验。于是找到了一个可以在线过滤要下载数据的地址：http://nomads.ncep.noaa.gov/cgi-bin/filter_gfs_0p25.pl这个网站允许用户仅下载过滤后的文件，并提供下载网址，这样文件就会小很多。例如，在本项目中，仅需要下载降雨数据（PWAT），并且经纬度范围为特定区域，每次发布的数据全部下载下来也才8M多点。那么要想获得GRIB文件中的数据，则需要用到一个软件wgrib2,，该软件在ncep网站上提供源码下载。 Mysql安装配置查看mysql安装1234567[root@siluxa_oracle grib2]# rpm -qa |grep -i mysqlmysql-community-common-5.6.36-2.el6.x86_64mysql-community-client-5.6.36-2.el6.x86_64mysql-community-server-5.6.36-2.el6.x86_64mysql-community-libs-compat-5.6.37-2.el6.x86_64mysql-community-libs-5.6.36-2.el6.x86_64mysql-community-devel-5.6.39-2.el6.x86_64 创建数据库和表1234567# 创建数据库CREATE DATABASE weatherDB DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;# 创建表create table wgrib2 (rt datetime, vt datetime, lat double, lon double, param varchar(80), level varchar(30), value double); # 创建用户和表，并赋予权限(实验环境可以直接用root，生产环境强烈建议使用普通用户)-- CREATE USER wgrib2 IDENTIFIED BY &apos;ffffff&apos;;-- GRANT ALL on weatherDB.* to wgrib2@&quot;%&quot; Identified by &quot;ffffff&quot; 编译安装wgrib2软件包编译安装wgrib2123456789101112131415#安装gcc和gfortran编译器yum install gcc gcc-gfortran -y#下载wgrib2软件包wget http://www.ftp.cpc.ncep.noaa.gov/wd51we/wgrib2/wgrib2.tgz -O /usr/local/src/wgrib2.tgzcd /usr/local/srctar wgrib2.tgzcd grib2/#设置编译环境export CC=gccexport FC=gfortran# 启用mysql支持，修改第114行vim makefile USE_MYSQL=1# 编译make 查看wgrib2配置12345678910111213141516171819202122232425262728293031323334353637[root@siluxa_oracle grib2]#cd wgrib2[root@siluxa_oracle grib2]# ./wgrib2 -configwgrib2 v0.2.0.7 12/2017 Wesley Ebisuzaki, Reinoud Bokhorst, John Howard, Jaakko Hyvätti, Dusan Jovic, Daniel Lee, Kristian Nilssen, Karl Pfeiffer, Pablo Romero, Manfred Schwarb, Gregor Schee, Arlindo da Silva, Niklas Sondell, Sam Trahan, Sergey Varlamov stock buildCompiled on 11:02:41 Mar 15 2018Netcdf package: &quot;3.6.3&quot; of Mar 15 2018 11:02:16 $ is installedlibaec-1.0.2.tar.gz is installedJasper 1.900.1 is installedmysql package is installedregex package is installedtigge package is installedIPOLATES iplib.v3.0.0 is installed, default vectors: UGRD/VGRD VUCSH/VVCSH UFLX/VFLX UGUST/VGUST USTM/VSTM VDFUA/VDFVA MAXUW/MAXVW UOGRD/VOGRD UICE/VICE U-GWD/V-GWD USSD/VSSD Geolocation library status (by search order) gctpc geolocation is enabled spherical geolocation is enabledUDF package is not installedversion ftime=2maximum number of arguments on command line: 10000maximum number of -match,-not,-if, and -not_if options: 2000maximum number of -match_fs,-not_fs,-if_fs, and -not_if_fs options: 2000maximum number of -fgrep, -egrep, -fgrep_v, -egrep_v options: 200RPN registers: 0..19memory files: @mem:0, @mem:1 .. @mem:19stdout buffer length: 30000default decoding: g2clib emulationg2clib decoders are not installedSupported decoding: simple, complex, rle, ieee, png, jpeg2000, CCSDS AECuser gribtable: (none)C compiler: gcc (GCC) 4.4.7 20120313 (Red Hat 4.4.7-18)Fortran compiler: gfortranOpenMP: control number of threads with environment variable OMP_NUM_THREADSINT_MAX: 2147483647ULONG_MAX: 18446744073709551615 将gfs数据导入到mysql中1./wgrib2 /mnt/wgrib2/gfs_20180313_0000_0p25_240.240 -mysql 192.168.6.123 root ffffff weatherDB wgrib2 可以过滤性导入数据，格式为 -if “：” 后跟参数12#下边这条命令是将“10 m above ground”的数据导入到wind表中./wgrib2 /mnt/wgrib2/gfs.t00z.pgrb2.0p25.f000 -if &quot;:10 m above ground&quot; -mysql 192.168.6.123 root ffffff weatherDB wind 查看导入结果123mysql -uroot -pffffffmysql&gt; use weatherDB;mysql&gt; select * from `weatherDB`.`wgrib2` limit 0, 20; 参考链接：http://blog.csdn.net/pch1982cn/article/details/74292772http://www.cpc.ncep.noaa.gov/products/wesley/wgrib2/index.htmlhttp://www.nco.ncep.noaa.gov/pmb/products/gfs/gfs.t00z.pgrb2f00.npoess.shtml数据下载地址:ftp://ftpprd.ncep.noaa.gov/pub/data/nccf/com/gfs/prod/在线过滤要下载数据的地址:http://nomads.ncep.noaa.gov]]></content>
      <categories>
        <category>大气模型</category>
      </categories>
      <tags>
        <tag>mysql</tag>
        <tag>wgrib2</tag>
        <tag>GFS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[安装rlwrap，使SqlPlus工具支持上下左右键]]></title>
    <url>%2Farlo%2Fd9547628%2F</url>
    <content type="text"><![CDATA[SqlPlus 工具中默认不支持上下左右键调出历史命令，很不方便；需安装rlwrap。 安装依赖包yum -y install gcc libtermcap-devel readline readline-devel 获取安装文件wget https://fossies.org/linux/privat/rlwrap-0.43.tar.gz 安装rlwrap123tar xf rlwrap-0.43.tar.gzcd rlwrap-0.43/./configure &amp;&amp; make install 配置12su - oraclevim .bash_profile 123alias sqlplus=&apos;rlwrap sqlplus&apos;alias rman=&apos;rlwrap rman&apos;alias asmcmd=&apos;rlwrap asmcmd&apos; source .bash_profile]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>常识</tag>
        <tag>Oracle</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Sonar代码质量管理工具安装]]></title>
    <url>%2Farlo%2F96c3f480%2F</url>
    <content type="text"><![CDATA[Sonar(SonarQube)是一款静态代码检查工具，采用B/S架构，帮助检查代码缺陷，改善代码质量，提高开发速度，通过插件形式，可以支持Java、C、C++、JavaScripe等等二十几种编程语言的代码质量管理与检测；通过客户端插件分析源代码，sonar客户端可以采用IDE插件、Sonar-Scanner插件、Ant插件和Maven插件方式，并通过各种不同的分析机制对项目源代码进行分析和扫描，并把分析扫描后的结果上传到sonar的数据库，通过sonar web界面对分析结果进行管理。可以从七个维度检测代码质量: 复杂度分布(complexity):代码复杂度过高将难以理解 重复代码(duplications):程序中包含大量复制、粘贴的代码而导致代码臃肿，sonar可以展示源码中重复严重的地方 单元测试统计(unit tests):统计并展示单元测试覆盖率，开发或测试可以清楚测试代码的覆盖情况 代码规则检查(coding rules):通过Findbugs,PMD,CheckStyle等检查代码是否符合规范 注释率(comments):若代码注释过少，特别是人员变动后，其他人接手比较难接手；若过多，又不利于阅读 潜在的Bug(potential bugs):通过Findbugs,PMD,CheckStyle等检测潜在的bug 结构与设计(architecture &amp; design):找出循环，展示包与包、类与类之间的依赖、检查程序之间耦合度 系统环境操作系统： CentOS 7.xMsql Server: 5.7.17Java ： JDK1.8Sonar ： sonarqube-6.7.1.zipSonar-scanner：sonar-scanner-cli-3.0.3.778-linux.zip 服务器安装安装MySQL服务器MariaDB 10.2在安装过程中检测为Mysql 5.5，不能满足需求wget http://download.softagency.net/MySQL/Downloads/MySQL-5.7/mysql-5.7.17-1.el7.x86_64.rpm-bundle.tartar xf mysql-5.7.17-1.el7.x86_64.rpm-bundle.taryum localinstall mysql-community-server-5.7.17-1.el7.x86_64.rpm mysql-community-client-5.7.17-1.el7.x86_64.rpm mysql-community-common-5.7.17-1.el7.x86_64.rpm mysql-community-client-5.7.17-1.el7.x86_64.rpm mysql-community-libs-5.7.17-1.el7.x86_64.rpmvim /etc/my.cnf123#[mysqld]下添加一行 innodb_buffer_pool_size = 128Mmax_allowed_packet = 128M 启动mysql服务systemctl start mysqld初始化mysql服务mysql_secure_installation默认密码在日志中可以看到创建sonar数据库和用户，并赋予权限mysql -uroot -p&#39;mysql_root_password&#39;123456789mysql&gt; select version();mysql5.7密码强度比较高，我们做实验调整一下；设置一下复杂度和长度mysql&gt; set global validate_password_policy=0;mysql&gt; set global validate_password_length=1;mysql&gt; CREATE DATABASE `sonar` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;mysql&gt; CREATE USER &apos;sonar&apos;@&apos;%&apos; IDENTIFIED BY &apos;sonar&apos;;mysql&gt; GRANT ALL ON sonar.* TO &apos;sonar&apos;@&apos;%&apos;;mysql&gt; flush privileges;mysql -usonar -psonar -hlocalhost 安装JDK下载地址：http://www.oracle.com/technetwork/java/archive-139210.htmltar xf jdk-8u112-linux-x64.tar.gz -C /usr/local/vim /etc/profile添加以下三行环境变量123export JAVA_HOME=/usr/local/jdk1.8.0_112/export CLASSPATH=.:$JAVA_HOME/lib/:$JAVA_HOME/jre/lib/export PATH=$JAVA_HOME/bin:$PATH 安装sonar系统参数配置新建用户sonar 不允许以root用户启动useradd sonarecho sonar|passwd --stdin sonar修改内核参数sysctl -w vm.max_map_count=262144sysctl -w fs.file-max=65536修改用户文件打开最大数vim /etc/security/limits.conf12sonar hard nofile 65536sonar soft nofile 65536 下载地址：https://www.sonarqube.org/downloads/unzip sonarqube-6.7.1.zip -d /usr/local 配置sonarvim /usr/local/sonarqube-6.7.1/conf/sonar.properties123456sonar.jdbc.username=sonarsonar.jdbc.password=sonarsonar.jdbc.url=jdbc:mysql://localhost:3306/sonar?useUnicode=true&amp;characterEncoding=utf8&amp;rewriteBatchedStatements=true&amp;useConfigs=maxPerformance&amp;useSSL=falsesonar.web.host=0.0.0.0sonar.web.context=/sonarsonar.web.port=9000 vim /usr/local/sonarqube-6.7.1/conf/wrapper.conf1wrapper.java.command=/usr/local/jdk1.8.0_112/bin/java chown sonar.sonar /usr/local/sonarqube-6.7.1 -R切换至sonar用户下su - sonar可以将此路径加入到环境变量中cd /usr/local/sonarqube-6.7.1/bin/linux-x86-64./sonar.sh start可以监控/usr/local/sonarqube-6.7.1/logs目录下的log,第一次启动时间会长一些，因为要给数据库建表访问地址http://192.168.6.178:9000/sonar/默认用户名/密码: admin/admin安装一个中文插件，安装完成后重启 开启SCM 客户端SonarQube Scanner安装下载地址https://docs.sonarqube.org/display/SCAN/Analyzing+with+SonarQube+ScannerSonarQube Scanner作为客户端，放在一个可以读取代码的位置即可，可以和SonarQube 服务端放在一台机器上，也可以分开部署； 配置sonarqube scanner我这里部署在本地windows系统上，将D:\Program Files (x86)\sonar-scanner-3.0.3.778-windows\bin加入到环境变量PATH中编辑D:\Program Files (x86)\sonar-scanner-3.0.3.778-windows\conf\sonar-scanner.properties配置文件123456789#Configure here general information about the environment, such as SonarQube DB details for example#No information about specific project should appear here#----- Default SonarQube serversonar.host.url=http://192.168.6.178:9000/sonarsonar.jdbc.username=sonarsonar.jdbc.password=sonarsonar.jdbc.url=jdbc:mysql://192.168.6.178:3306/sonar?useUnicode=true&amp;characterEncoding=utf8&amp;rewriteBatchedStatements=true&amp;useConfigs=maxPerformance&amp;useSSL=false#----- Default source code encodingsonar.sourceEncoding=UTF-8 配置项目在项目代码根目录下新建一个sonar-project.properties文件,内容如下sonar.projectKey和sonar.projectName自己定义即可。123456789101112# must be unique in a given SonarQube instancesonar.projectKey=silu# this is the name and version displayed in the SonarQube UI. Was mandatory prior to SonarQube 6.1.sonar.projectName=sxappsonar.projectVersion=1.0 # Path is relative to the sonar-project.properties file. Replace &quot;\&quot; by &quot;/&quot; on Windows.# This property is optional if sonar.modules is set. sonar.sources=.sonar.language=java# Encoding of the source code. Default is default system encodingsonar.sourceEncoding=UTF-8 客户端SonarQube Scanner使用用SonarQube Scanner分析在项目根目录下执行sonar-scanner即可开始代码监测在web页面上刷新一下就看到看到结果了Q:Please provide compiled classes of your project with sonar.java.binaries propertyA:这是因为sonar-java插件太新了，可以下载一个旧版本的插件进行替换https://sonarsource.bintray.com/Distribution/sonar-java-plugin/sonar-java-plugin-4.10.0.10260.jar下载完成后拷贝到C:\Users\nsxq.sonar\cache\2936e4ebd1e34b1646a3b66a51d30af7\ （类似这个）目录下，并修改名称为sonar-java-plugin-4.15.0.12310.jar(不要问我为什么要改成这个版本号，因为运行sonar-scanner提示是这个版本号) 用Maven调用SonarQube Scanner分析安装maven3下载地址http://apache.mirrors.lucidnetworks.net/maven/maven-3/下载完成解压后，配置环境变量，验证1234567mvn --versionApache Maven 3.3.9 (bb52d8502b132ec0a5a3f4c09453c07478323dc5; 2015-11-11T00:41:47+08:00)Maven home: D:\Program Files (x86)\apache-maven-3.3.9-bin\apache-maven-3.3.9\bin\..Java version: 1.8.0_141, vendor: Oracle CorporationJava home: C:\Program Files\Java\jdk1.8.0_141\jreDefault locale: zh_CN, platform encoding: GBKOS name: &quot;windows 10&quot;, version: &quot;10.0&quot;, arch: &quot;amd64&quot;, family: &quot;dos&quot; 配置maven全局设置settings.xml添加以下配置到本来的settings.xml12345678910111213141516171819&lt;settings&gt; &lt;pluginGroups&gt; &lt;pluginGroup&gt;org.sonarsource.scanner.maven&lt;/pluginGroup&gt; &lt;/pluginGroups&gt; &lt;profiles&gt; &lt;profile&gt; &lt;id&gt;sonar&lt;/id&gt; &lt;activation&gt; &lt;activeByDefault&gt;true&lt;/activeByDefault&gt; &lt;/activation&gt; &lt;properties&gt; &lt;!-- Optional URL to server. Default value is http://localhost:9000 --&gt; &lt;sonar.host.url&gt; http://myserver:9000 &lt;/sonar.host.url&gt; &lt;/properties&gt; &lt;/profile&gt; &lt;/profiles&gt;&lt;/settings&gt; 添加完成后，我的配置文件如下12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;settings xsi:schemaLocation=&quot;http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd&quot; xmlns=&quot;http://maven.apache.org/SETTINGS/1.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt; &lt;localRepository&gt;C:\Users\nsxq\.m2\repository\&lt;/localRepository&gt; &lt;pluginGroups&gt; &lt;pluginGroup&gt;org.sonarsource.scanner.maven&lt;/pluginGroup&gt; &lt;/pluginGroups&gt; &lt;servers&gt; &lt;server&gt; &lt;username&gt;test&lt;/username&gt; &lt;password&gt;test&lt;/password&gt; &lt;id&gt;THSArtifactory&lt;/id&gt; &lt;/server&gt; &lt;/servers&gt; &lt;mirrors&gt; &lt;mirror&gt; &lt;mirrorOf&gt;*&lt;/mirrorOf&gt; &lt;name&gt;ths-repos&lt;/name&gt; &lt;url&gt;http://192.168.0.45/artifactory/ths-repos&lt;/url&gt; &lt;id&gt;THSArtifactory&lt;/id&gt; &lt;/mirror&gt; &lt;mirror&gt; &lt;id&gt;alimaven&lt;/id&gt; &lt;mirrorOf&gt;central&lt;/mirrorOf&gt; &lt;name&gt;aliyun maven&lt;/name&gt; &lt;url&gt;http://maven.aliyun.com/nexus/content/repositories/central/&lt;/url&gt; &lt;/mirror&gt; &lt;/mirrors&gt; &lt;profiles&gt; &lt;profile&gt; &lt;repositories&gt; &lt;repository&gt; &lt;snapshots&gt; &lt;enabled&gt;false&lt;/enabled&gt; &lt;/snapshots&gt; &lt;id&gt;central&lt;/id&gt; &lt;name&gt;ths-repos&lt;/name&gt; &lt;url&gt;http://192.168.0.45/artifactory/ths-repos&lt;/url&gt; &lt;/repository&gt; &lt;repository&gt; &lt;snapshots /&gt; &lt;id&gt;snapshots&lt;/id&gt; &lt;name&gt;ths-repos&lt;/name&gt; &lt;url&gt;http://192.168.0.45/artifactory/ths-repos&lt;/url&gt; &lt;/repository&gt; &lt;/repositories&gt; &lt;pluginRepositories&gt; &lt;pluginRepository&gt; &lt;snapshots&gt; &lt;enabled&gt;false&lt;/enabled&gt; &lt;/snapshots&gt; &lt;id&gt;central&lt;/id&gt; &lt;name&gt;ths-repos&lt;/name&gt; &lt;url&gt;http://192.168.0.45/artifactory/ths-repos&lt;/url&gt; &lt;/pluginRepository&gt; &lt;pluginRepository&gt; &lt;snapshots /&gt; &lt;id&gt;snapshots&lt;/id&gt; &lt;name&gt;ths-repos&lt;/name&gt; &lt;url&gt;http://192.168.0.45/artifactory/ths-repos&lt;/url&gt; &lt;/pluginRepository&gt; &lt;/pluginRepositories&gt; &lt;id&gt;artifactory&lt;/id&gt; &lt;/profile&gt; &lt;profile&gt; &lt;id&gt;sonar&lt;/id&gt; &lt;activation&gt; &lt;activeByDefault&gt;true&lt;/activeByDefault&gt; &lt;/activation&gt; &lt;properties&gt; &lt;!-- Optional URL to server. Default value is http://localhost:9000 --&gt; &lt;sonar.host.url&gt; http://192.168.6.178:9000/sonar &lt;/sonar.host.url&gt; &lt;/properties&gt; &lt;/profile&gt; &lt;/profiles&gt; &lt;activeProfiles&gt; &lt;activeProfile&gt;artifactory&lt;/activeProfile&gt; &lt;/activeProfiles&gt;&lt;/settings&gt; 测试maven项目下载一个maven测试项目代码git clone https://github.com/SonarSource/sonar-scanning-examples.gitcd D:\sonar-scanning-examples\sonarqube-scanner-mavenmvn clean install sonar:sonarweb页面查看 用Jenkins调用SonarQube Scanner分析安装sonarqube插件系统管理–&gt;管理插件–&gt;可选插件SonarQube Scanner for JenkinsMashup Portlets 配置SonarQube servers系统管理–&gt;系统配置–&gt;SonarQube servers系统管理–&gt;全局工具配置–&gt;SonarQube ScannerJOB配置key,name,version三个字段是自定义的，sources路径是当前路径的话，用.表示就可以了；123456sonar.projectKey=ths.projectsonar.projectName=AirForcastsonar.projectVersion=1.0sonar.language=javasonar.java.binaries=./target/test-classes/ sonar.sources=. 点击查看监测结果！ 其他问题Q1：ERROR web[][o.s.s.p.Platform] Web server startup failed: Unsupported mysql version: 5.5. Minimal supported version is 5.6.A1:不要使用mariadb，mariadb10.2检测到是mysql5.5Q2:Native memory allocation (mmap) failed to map 42467328 bytes for committing reserved memory.A2:1.将虚拟机内存调整大，调整到4Gb；2.保证swap空间正常（我安装操作系统的时候没有设置swap分区，折腾了好一会儿）；3.修改此文件中的/usr/local/sonarqube-6.7.1/elasticsearch/config/jvm.options -Xms512m -Xmx512mQ3:mvn clean install sonar:sonar 上传分析数据时候报错。可以查看sonar日志web.log相关报错“Failed to upload report - 500: An error has occurred. Please contact your administrator”A3:1.修改mysqld参数max_allowed_packet = 128M2.重启mysqld服务3.重启sonarqube服务（一定要重启） 参考链接：https://docs.sonarqube.org/display/SONAR/Installing+the+Serverhttps://docs.sonarqube.org/display/SCAN/Analyzing+with+SonarQube+Scannerhttps://my.oschina.net/zxcholmes/blog/1529732https://www.ibm.com/developerworks/cn/devops/1612_qusm_jenkins/index.html]]></content>
      <categories>
        <category>自动化运维</category>
      </categories>
      <tags>
        <tag>自动化</tag>
        <tag>运维</tag>
        <tag>Sonar</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Bginfo--Windows系统信息显示工具]]></title>
    <url>%2Farlo%2Fea6f862b%2F</url>
    <content type="text"><![CDATA[经常维护多台Windows服务器，在服务器之间来回切换，经常容易搞混，为大家推荐一个维护利器BGinfo。 修改配置文件下载地址：https://download.sysinternals.com/files/BGInfo.zip下载、解压完成后，双击Bginfo64,同意即可价值默认信息；这里是我觉得平时会用到的参数信息。123456789101112131415主机名称: &lt;Host Name&gt;系统版本: &lt;OS Version&gt;服务补丁包: &lt;Service Pack&gt;系统启动时间: &lt;Boot Time&gt;当前用户名: &lt;User Name&gt;------------------------------CPU: &lt;CPU&gt;内存: &lt;Memory&gt;磁盘可用空间: &lt;Free Space&gt;------------------------------IP Address: &lt;IP Address&gt;MAC Address: &lt;MAC Address&gt;Subnet Mask: &lt;Subnet Mask&gt;Default Gateway: &lt;Default Gateway&gt;DNS Server: &lt;DNS Server&gt; 点击file-save as 保存D:\BGInfo为名为systeminfo.cgiBackground：可以定义直接在当前壁纸上显示、指定一个壁纸路径或纯色显示。Position：可配置信息输出位置（9个选项）以及多显示器输出支持(偏爱右上)Desktops：用于配置用户远程登录、控制台登录时的显示方式Preview：预览配置效果 配置开机启动12341. 在windows资源管理器输入shell:startup 快速打开当前用户的「启动」文件夹2. 新建一个.bat文件，内容为D:\BGInfo\Bginfo64.exe systeminfo.bgi /timer:0 /nolicprompt /silent PS: 此工具很方便，但是不能根据系统信息，自行刷新，可以添加计划任务进行刷新。 此工具大规模部署建议使用域环境操作。 参考链接：https://docs.microsoft.com/en-us/sysinternals/downloads/bginfohttps://www.sysgeek.cn/bginfo/]]></content>
      <categories>
        <category>常识</category>
      </categories>
      <tags>
        <tag>windows</tag>
        <tag>bginfo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[部署office在线预览服务器(Office Web Apps Server)]]></title>
    <url>%2Farlo%2F5b552504%2F</url>
    <content type="text"><![CDATA[Office Web Apps Server 是一种 Office 服务器产品，可提供在浏览器中查看和编辑 Office 文件的服务。可提供浏览器版 Word、PowerPoint、Excel 和 OneNote。 环境网络环境123服务器名 ip地址dc.islocal.cc 192.168.6.111apps.islocal.cc 192.168.6.112 软件环境12345操作系统 Windows Server 2012 R2 Standard .NET Framework 4.5.2Office Web Apps Server cn_office_web_apps_server_2013_with_sp1_x64_dvd_3832995.isoOffice Web Apps Server SP1 wacserversp2013-kb2880558-fullfile-x64-glb.exe语言包 wacserverlanguagepack.exe 规划 Office Web Apps ServerOffice Web Apps Server 支持的操作系统您可以在以下操作系统上运行 Office Web Apps Server： 安装了 Windows Server 2008 R2 x64 版本更新的 64 位版本 Windows Server 2008 R2 Service Pack 1 (SP1) Standard、Enterprise 或 DatacenterWindows Server 2012 Standard 或 Datacenter 的 64 位版本64 位版本的 Windows Server 2012 R2。若要使用此操作系统，则必须使用 Office Web Apps Server Service Pack 1 (SP1)。 Office Web Apps Server 的域要求Office Web Apps Server 场中的服务器都必须是域的一部分。它们可以在同一个域 （推荐） 中或位于同一个林中的不同域中。但是，如果您尝试在域控制器上安装它，Office Web Apps Server 将不起作用。 Office Web Apps Server 需要的服务器角色、服务及其他软件首先，以下是部署 Office Web Apps Server 时不应执行的一些操作。 请勿在运行 Office Web Apps Server 的服务器上安装任何其他服务器应用程序。包括 Exchange Server、SharePoint Server、Lync Server 和 SQL Server。如果您的服务器不足，则可以在这些服务器的其中一台上的虚拟机实例中运行 Office Web Apps Server。不要在端口 80、443 或 809 上安装依赖 Web 服务器 (IIS) 角色的任何服务或角色，因为 Office Web Apps Server 会定期删除这些端口上的 Web 应用程序。不要安装任何版本的 Office。如果已经安装，在安装 Office Web Apps Server 之前必须将其卸载。不要在域控制器上安装 Office Web Apps Server。它不会在包含 Active Directory 域服务 (AD DS) 的服务器上运行。 搭建域控服务器(DC)打开服务器管理，添加角色和功能默认下一步基于角色或基于功能的安装从服务器池中选择服务器，可以看到本机名称和ip地址勾选“DNS服务器”和“Active Directory域服务”默认下一步最后确认一下所有选择，开始安装安装完成服务器管理器-AD DS- 将此服务器升级为域控制器添加新林，输入根域名islocal.cc设置一个目录服务还原模式密码至此，与控制搭建工作已经完成！ owa服务器加入域控apps服务器上操作设置apps服务器ip地址，将dns地址设置为域控地址192.168.6.111点击系统属性-计算机名-更改-域-输入域名；输入域控服务器的用户名密码，成功加入，重启服务器 域控上操作服务器管理器-管理-添加服务器输入服务器名称，添加到计算机在所有服务器可以看到已经添加完成使用域管理员登录apps服务器，登录格式为：用户名：islocal\administrator，密码：域管理员密码加入域后，ping不通服务器，服务器本地关闭域防火墙 owa软件安装安装.NET Framework 4.5.2下载地址 https://www.microsoft.com/zh-cn/download/details.aspx?id=42643 安装IIS参考本文贴的第一张图，一定要安装全iis组件。 以管理员身份打开 Windows PowerShell 提示符，然后运行此命令示例来安装必需的角色和服务1Add-WindowsFeature Web-Server,Web-Mgmt-Tools,Web-Mgmt-Console,Web-WebServer,Web-Common-Http,Web-Default-Doc,Web-Static-Content,Web-Performance,Web-Stat-Compression,Web-Dyn-Compression,Web-Security,Web-Filtering,Web-Windows-Auth,Web-App-Dev,Web-Net-Ext45,Web-Asp-Net45,Web-ISAPI-Ext,Web-ISAPI-Filter,Web-Includes,InkandHandwritingServices,NET-Framework-Features,NET-Framework-Core,NET-HTTP-Activation,NET-Non-HTTP-Activ,NET-WCF-HTTP-Activation45 安装Office Web Apps Server下载地址Office Web Apps Server1ed2k://|file|cn_office_web_apps_server_2013_with_sp1_x64_dvd_3832995.iso|530315264|C33F5E985FB1B7CC74A28FAA4857458C|/ 加载到本地光驱，双击setup.exe开始安装选择文件安装位置 安装Office Web Apps Server SP1补丁包（2012R2必须项）下载地址：https://support.microsoft.com/zh-cn/help/2880558/description-of-microsoft-office-web-apps-server-service-pack-1-sp1 安装语言包下载地址：https://www.microsoft.com/zh-cn/download/details.aspx?id=35490 owa服务器配置导入OfficeWebApps模块1Import-Module -Name OfficeWebApps 创建一个Office Web Apps Server12New-OfficeWebAppsFarm -InternalURL http://192.168.6.112 -AllowHttp -EditingEnabledSet-OfficeWebAppsFarm -OpenFromUrlEnabled:$true 验证安装结果http://192.168.6.112/hosting/discoveryhttp://192.168.6.112/op/generate.aspx这里的测试文档URL必须使用域名，IP地址会报错“很抱歉，由于某种原因不能为您打开。如果是本地定义的域名，只需要在预览服务器上添加一条hosts即可。 参考链接：https://technet.microsoft.com/zh-cn/library/jj219455.aspxhttp://www.cnblogs.com/timelyxyz/p/3645134.htmlhttp://blog.csdn.net/duanchuanttao/article/details/53467060http://blog.csdn.net/ituff/article/details/23880431]]></content>
      <categories>
        <category>服务器搭建</category>
      </categories>
      <tags>
        <tag>Windows</tag>
        <tag>域控</tag>
        <tag>office</tag>
        <tag>在线预览</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Scp拷贝大文件出现stalled故障解决方法]]></title>
    <url>%2Farlo%2F8954c4ab%2F</url>
    <content type="text"><![CDATA[最近倒腾oracle数据库异地备份，由于端口限制不能使用rsync（首选），只能使用scp脚本自动拷贝到本地服务器，数据库按用户备份的，最大一个文件53G，发现每次都拷贝不完就中断了；之前以为是网络的问题导致shell退出，今天开了screen，手动执行脚本，特地跟踪了一下，发现出现stalled的故障；网上有找到的方法有以下几种，个人认为第三种更治根。 限速scp -l 1000 /from/path /to/path #单位为Kbit，1000Kbit/8=125Kb 修改内核参数echo 0 &gt; /proc/sys/net/ipv4/tcp_sack 调整mtu值由于我的网络是PPPoE拨号的，最佳mtu值应为1492ifconfig eth0 mtu 1492orip link set dev eth0 mtu 1492 参考资料https://www.gpforums.co.nz/threads/399001-MTU-Value-1492-vs-1500https://stackoverflow.com/questions/11985008/sending-a-large-file-with-scp-to-a-certain-server-stalls-at-exactly-2112-kbhttp://www.tp-link.com/tw/article/?faqid=190http://www.cnblogs.com/wjoyxt/p/6873714.html]]></content>
      <categories>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>常识</tag>
        <tag>Scp</tag>
        <tag>MTU</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Oracle表空间扩容]]></title>
    <url>%2Farlo%2F989e9822%2F</url>
    <content type="text"><![CDATA[在新装完的oracle数据库中导入数据，由于数据量比较大，报以下错误；12ORA-39171: Job is experiencing a resumable wait.ORA-01653: unable to extend table AIR_FORECAST.T_WRF_DATA by 8192 in tablespace USERS 此故障是由于数据库的表空间满了，造成的数据无法正常导入，我们需要手动来扩容表空间 查询当前实例名1select instance_name from v$instance; 查询表空间名1select tablespace_name from sys.dba_tablespaces; 查询默认表空间12345select a.property_name, a.property_value from database_properties a where a.property_name like &apos;%DEFAULT%&apos;;……DEFAULT_PERMANENT_TABLESPACEUSERS…… 查看表空间使用情况在PL SQL Developer 中执行一下SQL语句1SELECT a.tablespace_name &quot;表空间名&quot;,a.bytes / 1024 / 1024 &quot;表空间大小(M)&quot;,(a.bytes - b.bytes) / 1024 / 1024 &quot;已使用空间(M)&quot;,b.bytes / 1024 / 1024 &quot;空闲空间(M)&quot;,round(((a.bytes - b.bytes) / a.bytes) * 100, 2) &quot;使用比&quot;FROM (SELECT tablespace_name, sum(bytes) bytes FROM dba_data_files GROUP BY tablespace_name) a,(SELECT tablespace_name, sum(bytes) bytes, max(bytes) largest FROM dba_free_space GROUP BY tablespace_name) b WHERE a.tablespace_name = b.tablespace_name ORDER BY ((a.bytes - b.bytes) / a.bytes) DESC 查看USERS表空间文件及使用量1SELECT file_name,tablespace_name,bytes / 1024 / 1024 &quot;bytes MB&quot;,maxbytes / 1024 / 1024 &quot;maxbytes MB&quot; FROM dba_data_files WHERE tablespace_name = &apos;USERS&apos;; 查看USERS表空间文件是否自动扩展1SELECT file_id, file_name, tablespace_name, autoextensible, increment_by FROM dba_data_files WHERE tablespace_name = &apos;USERS&apos; ORDER BY file_id desc; 查看”autoextensible”对应的值是YES还是NO，若是NO，说明MSMS表空间的自动扩展功能没有开，改成YES就可以了。 查询所有的schema所占空间大小1select owner, sum(bytes)/1024/1024/1024 schema_size_gig from sys.dba_segments group by owner; 增加表空间文件查看表空间文件1SELECT * FROM dba_data_files t WHERE t.tablespace_name=&apos;USERS&apos;; 查看得知我们的表空间文件在/u01/app/oracle/oradata/sx21/目录下，新建的文件也放在此目录下,方便后期管理 查看表空间文件自增长文件最大值因为Oracle的物理文件最大只允许4194303个数据块(datablock).需要查看一下本地block块大小123456数据块的大小 物理文件的最大值 M=============================================== 2048 8191 M4096 16383 M8192 32767 M16384 65535 M 查看oracle数据库block大小123456789101112在sqlplus窗口中执行SQL&gt; show parameter db_block_size;NAME TYPE VALUE------------------------------------ ----------- ------------------------------db_block_size integer 8192在pl/SQL窗口中执行SQL&gt; select value from v$parameter where name=&apos;db_block_size&apos;;VALUE--------------------------------------------------------------------------------8192 添加表空间文件1SQL&gt; alter tablespace USERS add datafile &apos;/u01/app/oracle/oradata/sx21/users02.dbf&apos; size 5M autoextend on maxsize 32767M; ASM添加表空间文件12SQL&gt; alter tablespace USERS add datafile &apos;+DATA&apos; size 5M autoextend on maxsize 32767M;SQL&gt; select name from v$datafile; 注意：ASM增加数据文件或者创建表空间不需要指定数据文件名，只要指定 diskgroup即可,ASM会自动命名。 验证添加的表空间文件1234567891011SQL&gt; select file_name,file_id,tablespace_name FROM dba_data_files WHERE tablespace_name=&apos;USERS&apos;;FILE_NAME-------------------------------------------------------------------------------- FILE_ID TABLESPACE_NAME---------- ------------------------------/u01/app/oracle/oradata/sx21/users01.dbf 4 USERS/u01/app/oracle/oradata/sx21/users02.dbf 5 USERS 扩展阅读http://www.dba-oracle.com/t_bigfile_tablespace_tips.htm 参考资料：http://blog.csdn.net/u013806814/article/details/48400861http://blog.itpub.net/27042095/viewspace-1100993/http://blog.sina.com.cn/s/blog_9d4799c701017pw1.htmlhttps://blog.csdn.net/qq_33547950/article/details/79257882]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>数据库</tag>
        <tag>Oracle</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CentOS6.9环境静默安装Oracle11g]]></title>
    <url>%2Farlo%2F6dacbf16%2F</url>
    <content type="text"><![CDATA[系统基础环境操作系统：CentOS 6.9 x64Iptables：offSelinux：disabled 修改主机名安装oracle后不要修改主机名，会引起故障123vim /etc/sysconfig/networkNETWORKING=yesHOSTNAME=&quot;dbserver&quot; 1hostname dbserver 基础软件安装1234567891011121314151617181920212223242526#默认是不安装32位软件包的，添加此选项echo &apos;multilib_policy=all&apos; &gt;&gt; /etc/yum.confyum -y install binutils-* compat-libstdc++-* elfutils-libelf-* elfutils-libelf-devel-* gcc-* gcc-c++-* glibc-* glibc-common-* glibc-devel-* glibc-headers-* ksh-* libaio-* libaio-devel-* libgcc-* libstdc++* libstdc++-devel* make-* sysstat-* unixODBC-* unixODBC-devel-* mksh#监测一下软件是否安装全rpm -q \binutils \compat-libstdc++-33 \elfutils-libelf \elfutils-libelf-devel \expat \gcc \gcc-c++ \glibc \glibc-common \glibc-devel \glibc-headers \libaio \libaio-devel \libgcc \libstdc++ \libstdc++-devel \make \pdksh \sysstat \unixODBC \unixODBC-devel | grep &quot;not installed&quot; 修改PAM配置文件123vim /etc/pam.d/loginsession required /lib64/security/pam_limits.sosession required pam_limits.so 修改内核参数1234567891011121314vim /etc/sysct.conffs.aio-max-nr = 1048576 fs.file-max = 6815744 kernel.shmmni = 4096 kernel.sem = 250 32000 100 128 net.ipv4.ip_local_port_range = 9000 65500 net.core.rmem_default = 262144 net.core.rmem_max = 4194304 net.core.wmem_default = 262144 net.core.wmem_max = 1048586#重新加载生效sysctl –p 修改系统资源限制123456vi /etc/security/limits.conf oracle soft nproc 2047 oracle hard nproc 16384 oracle soft nofile 1024 oracle hard nofile 65536oracle soft stack 10240 Oracle相关环境配置新建用户12345groupadd -g 500 oinstallgroupadd -g 501 dbauseradd -u 500 -g oinstall -G dba oracle#设置oracle用户密码为oracleecho &quot;oracle:oracle&quot; | chpasswd 修改用户配置文件123456789vi/ etc/profileif [ $USER = &quot;oracle&quot; ]; then if [ $SHELL = &quot;/bin/ksh&quot; ]; then ulimit -p 16384 ulimit -n 65536 else ulimit -u 16384 -n 65536 fifi 新建目录并设置权限12345mkdir -p /u01/app/oracle/product/11.2.0/db_1mkdir -p /u01/app/oraInventorychown -R oracle.oinstall /u01/app/oraclechown -R oracle.oinstall /u01/app/oraInventorychmod -R 775 /u01/app 设置oracle用户环境变量12345678su - oracle$ vim ~/.bash_profile export ORACLE_BASE=/u01/app/oracleexport ORACLE_HOME=$ORACLE_BASE/product/11.2.0/db_1export ORACLE_SID=sx21export PATH=$PATH:$ORACLE_HOME/binexport LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/libexport NLS_LANG=American_America.ZHS16GBK 检查环境变量是否生效12345source ~/.bash_profileenv |grep ORAORACLE_SID=sx21ORACLE_BASE=/u01/app/oracleORACLE_HOME=/u01/app/oracle/product/11.2.0/db_1 准备软件安装包下载地址: http://www.oracle.com/technetwork/database/enterprise-edition/downloads/112010-linx8664soft-100572.html可以使用cksum校验文件完整性linux.x64_11gR2_database_1of2.zip (1,239,269,270 bytes) (cksum - 3152418844)linux.x64_11gR2_database_2of2.zip (1,111,416,131 bytes) (cksum - 3669256139) 解压软件包12unzip linux.x64_11gR2_database_1of2.zipunzip linux.x64_11gR2_database_2of2.zip 解压后得到/home/oracle/database/response目录，该目录中有三个rsp文件，用来作为静默安装时的应答文件的模板。备份三个文件并修改其内容123db_install.rsp 安装应答netca.rsp 建立监听、本地服务名等网络设置的应答dbca.rsp 创建数据库应答 静默安装数据库软件修改db_install.rsp 文件12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849egrep -v &quot;^#|^$&quot; db_install.rsporacle.install.responseFileVersion=/oracle/install/rspfmt_dbinstall_response_schema_v11_2_0oracle.install.option=INSTALL_DB_SWONLYORACLE_HOSTNAME=dbserverUNIX_GROUP_NAME=oinstallINVENTORY_LOCATION=/u01/app/oraInventorySELECTED_LANGUAGES=en,zh_CNORACLE_HOME=/u01/app/oracle/product/11.2.0/db_1ORACLE_BASE=/u01/app/oracleoracle.install.db.InstallEdition=EEoracle.install.db.isCustomInstall=falseoracle.install.db.customComponents=oracle.server:11.2.0.1.0,oracle.sysman.ccr:10.2.7.0.0,oracle.xdk:11.2.0.1.0,oracle.rdbms.oci:11.2.0.1.0,oracle.network:11.2.0.1.0,oracle.network.listener:11.2.0.1.0,oracle.rdbms:11.2.0.1.0,oracle.options:11.2.0.1.0,oracle.rdbms.partitioning:11.2.0.1.0,oracle.oraolap:11.2.0.1.0,oracle.rdbms.dm:11.2.0.1.0,oracle.rdbms.dv:11.2.0.1.0,orcle.rdbms.lbac:11.2.0.1.0,oracle.rdbms.rat:11.2.0.1.0oracle.install.db.DBA_GROUP=dbaoracle.install.db.OPER_GROUP=dbaoracle.install.db.CLUSTER_NODES=oracle.install.db.config.starterdb.type=oracle.install.db.config.starterdb.globalDBName=sx21oracle.install.db.config.starterdb.SID=sx21oracle.install.db.config.starterdb.characterSet=ZHS16GBKoracle.install.db.config.starterdb.memoryOption=trueoracle.install.db.config.starterdb.memoryLimit=81920oracle.install.db.config.starterdb.installExampleSchemas=falseoracle.install.db.config.starterdb.enableSecuritySettings=trueoracle.install.db.config.starterdb.password.ALL=solution#123oracle.install.db.config.starterdb.password.SYS=oracle.install.db.config.starterdb.password.SYSTEM=oracle.install.db.config.starterdb.password.SYSMAN=oracle.install.db.config.starterdb.password.DBSNMP=oracle.install.db.config.starterdb.control=DB_CONTROLoracle.install.db.config.starterdb.gridcontrol.gridControlServiceURL=oracle.install.db.config.starterdb.dbcontrol.enableEmailNotification=falseoracle.install.db.config.starterdb.dbcontrol.emailAddress=oracle.install.db.config.starterdb.dbcontrol.SMTPServer=oracle.install.db.config.starterdb.automatedBackup.enable=falseoracle.install.db.config.starterdb.automatedBackup.osuid=oracle.install.db.config.starterdb.automatedBackup.ospwd=oracle.install.db.config.starterdb.storageType=oracle.install.db.config.starterdb.fileSystemStorage.dataLocation=oracle.install.db.config.starterdb.fileSystemStorage.recoveryLocation=oracle.install.db.config.asm.diskGroup=oracle.install.db.config.asm.ASMSNMPPassword=MYORACLESUPPORT_USERNAME=MYORACLESUPPORT_PASSWORD=SECURITY_UPDATES_VIA_MYORACLESUPPORT=DECLINE_SECURITY_UPDATES=truePROXY_HOST=PROXY_PORT=PROXY_USER=PROXY_PWD= 执行静默安装12345678910$ pwd/home/oracle/database./runInstaller -silent -ignorePrereq -ignoreSysPrereqs -responseFile /home/oracle/database/response/db_install.rspStarting Oracle Universal Installer...Checking Temp space: must be greater than 120 MB. Actual 26363 MB PassedChecking swap space: must be greater than 150 MB. Actual 4095 MB PassedPreparing to launch Oracle Universal Installer from /tmp/OraInstall2017-12-27_02-06-55PM. Please wait ...[oracle@dbserver database]$ You can find the log of this install session at: /u01/app/oraInventory/logs/installActions2017-12-27_02-06-55PM.log 安装过程中可以另开一个窗口跟踪查看日志123456789101112tailf /u01/app/oraInventory/logs/installActions2017-12-27_02-06-55PM.log……INFO: Completed validating state &lt;finish&gt;INFO: Terminating all background operationsINFO: Terminated all background operationsINFO: Successfully executed the flow in SILENT modeINFO: Finding the most appropriate exit status for the current applicationINFO: Exit Status is 0INFO: Shutdown Oracle Database 11g Release 2 InstallerINFO: Unloading Setup Driver 123456789101112 #!/bin/sh #Root scripts to run/u01/app/oraInventory/orainstRoot.sh/u01/app/oracle/product/11.2.0/db_1/root.shTo execute the configuration scripts: 1. Open a terminal window 2. Log in as &quot;root&quot; 3. Run the scripts 4. Return to this window and hit &quot;Enter&quot; key to continue Successfully Setup Software. 一直到主窗口出现以上提示，以root用户打开一个窗口，一次执行下面操作123456789[root@dbserver ~]# /u01/app/oraInventory/orainstRoot.shChanging permissions of /u01/app/oraInventory.Adding read,write permissions for group.Removing read,write,execute permissions for world.Changing groupname of /u01/app/oraInventory to oinstall.The execution of the script is complete.[root@dbserver ~]# /u01/app/oracle/product/11.2.0/db_1/root.shCheck /u01/app/oracle/product/11.2.0/db_1/install/root_dbserver_2017-12-27_14-23-43.log for the output of root script 静默安装监听使用默认配置文件，不用修改12345678910111213141516$ORACLE_HOME/bin/netca /silent /responseFile /home/oracle/database/response/netca.rspParsing command line arguments: Parameter &quot;silent&quot; = true Parameter &quot;responsefile&quot; = /home/oracle/database/response/netca.rspDone parsing command line arguments.Oracle Net Services Configuration:Profile configuration complete.Oracle Net Listener Startup: Running Listener Control: /u01/app/oracle/product/11.2.0/db_1/bin/lsnrctl start LISTENER Listener Control complete. Listener started successfully.Listener configuration complete.Oracle Net Services configuration successful. The exit code is 0 默认监听是开启状态1234567891011121314151617181920212223[oracle@dbserver database]$ lsnrctl statusLSNRCTL for Linux: Version 11.2.0.1.0 - Production on 27-DEC-2017 14:26:34Copyright (c) 1991, 2009, Oracle. All rights reserved.Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=EXTPROC1521)))STATUS of the LISTENER------------------------Alias LISTENERVersion TNSLSNR for Linux: Version 11.2.0.1.0 - ProductionStart Date 27-DEC-2017 14:25:48Uptime 0 days 0 hr. 0 min. 50 secTrace Level offSecurity ON: Local OS AuthenticationSNMP OFFListener Parameter File /u01/app/oracle/product/11.2.0/db_1/network/admin/listener.oraListener Log File /u01/app/oracle/diag/tnslsnr/dbserver/listener/alert/log.xmlListening Endpoints Summary... (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1521))) (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=dbserver)(PORT=1521)))The listener supports no servicesThe command completed successfully 静默新建实例修改dbca.rsp配置这里只需要修改[CREATEDATABASE]部分即可，其他的保持默认123456789101112131415161718192021222324252627282930313233$ egrep -v &quot;^#|^$&quot; dbca.rsp [GENERAL]RESPONSEFILE_VERSION = &quot;11.2.0&quot;OPERATION_TYPE = &quot;createDatabase&quot;[CREATEDATABASE]GDBNAME = &quot;sx21&quot;SID = &quot;sx21&quot;TEMPLATENAME = &quot;General_Purpose.dbc&quot;SYSPASSWORD = &quot;solution#123&quot;SYSTEMPASSWORD = &quot;solution#123&quot;CHARACTERSET = &quot;ZHS16GBK&quot;NATIONALCHARACTERSET= &quot;AL16UTF16&quot;[createTemplateFromDB]SOURCEDB = &quot;myhost:1521:orcl&quot;SYSDBAUSERNAME = &quot;system&quot;TEMPLATENAME = &quot;My Copy TEMPLATE&quot;[createCloneTemplate]SOURCEDB = &quot;orcl&quot;TEMPLATENAME = &quot;My Clone TEMPLATE&quot;[DELETEDATABASE]SOURCEDB = &quot;orcl&quot;[generateScripts]TEMPLATENAME = &quot;New Database&quot;GDBNAME = &quot;orcl11.us.oracle.com&quot;[CONFIGUREDATABASE][ADDINSTANCE]DB_UNIQUE_NAME = &quot;orcl11g.us.oracle.com&quot;NODELIST=SYSDBAUSERNAME = &quot;sys&quot;[DELETEINSTANCE]DB_UNIQUE_NAME = &quot;orcl11g.us.oracle.com&quot;INSTANCENAME = &quot;orcl11g&quot;SYSDBAUSERNAME = &quot;sys&quot; 执行静默安装不清楚是什么原因，我执行静默安装命令，屏幕就一直闪烁，不能输入密码，所以我将密码写到dbca.rsp文件中了，可以避免此问题！12345678910111213141516171819202122232425262728$ORACLE_HOME/bin/dbca -silent -responseFile /home/oracle/database/response/dbca.rspCopying database files1% complete2% complete4% complete37% completeCreating and starting Oracle instance38% complete40% complete45% complete50% complete51% complete56% complete57% complete61% complete62% completeCompleting Database Creation66% complete70% complete73% complete74% complete85% complete86% complete98% complete100% completeLook at the log file &quot;/u01/app/oracle/cfgtoollogs/dbca/sx21/sx21.log&quot; for further details. 验证安装结果进程1234567891011121314151617181920212223[oracle@dbserver app]$ ps -ef |grep ora_oracle 5432 1 0 17:02 ? 00:00:00 ora_pmon_sx21oracle 5434 1 0 17:02 ? 00:00:00 ora_vktm_sx21oracle 5438 1 0 17:02 ? 00:00:00 ora_gen0_sx21oracle 5440 1 0 17:02 ? 00:00:00 ora_diag_sx21oracle 5442 1 0 17:02 ? 00:00:00 ora_dbrm_sx21oracle 5444 1 0 17:02 ? 00:00:00 ora_psp0_sx21oracle 5446 1 0 17:02 ? 00:00:00 ora_dia0_sx21oracle 5448 1 0 17:02 ? 00:00:01 ora_mman_sx21oracle 5450 1 0 17:02 ? 00:00:00 ora_dbw0_sx21oracle 5452 1 0 17:02 ? 00:00:00 ora_lgwr_sx21oracle 5454 1 0 17:02 ? 00:00:00 ora_ckpt_sx21oracle 5456 1 0 17:02 ? 00:00:00 ora_smon_sx21oracle 5458 1 0 17:02 ? 00:00:00 ora_reco_sx21oracle 5460 1 0 17:02 ? 00:00:00 ora_mmon_sx21oracle 5462 1 0 17:02 ? 00:00:00 ora_mmnl_sx21oracle 5464 1 0 17:02 ? 00:00:00 ora_d000_sx21oracle 5466 1 0 17:02 ? 00:00:00 ora_s000_sx21oracle 5558 1 0 17:02 ? 00:00:00 ora_qmnc_sx21oracle 5575 1 0 17:02 ? 00:00:00 ora_cjq0_sx21oracle 5579 1 0 17:02 ? 00:00:00 ora_q000_sx21oracle 5581 1 0 17:02 ? 00:00:00 ora_q001_sx21oracle 5585 1550 0 17:04 pts/0 00:00:00 grep ora_ 监听123456789101112131415161718192021222324252627[oracle@dbserver app]$ lsnrctl statusLSNRCTL for Linux: Version 11.2.0.1.0 - Production on 27-DEC-2017 17:04:44Copyright (c) 1991, 2009, Oracle. All rights reserved.Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=EXTPROC1521)))STATUS of the LISTENER------------------------Alias LISTENERVersion TNSLSNR for Linux: Version 11.2.0.1.0 - ProductionStart Date 27-DEC-2017 16:49:14Uptime 0 days 0 hr. 15 min. 32 secTrace Level offSecurity ON: Local OS AuthenticationSNMP OFFListener Parameter File /u01/app/oracle/product/11.2.0/db_1/network/admin/listener.oraListener Log File /u01/app/oracle/diag/tnslsnr/dbserver/listener/alert/log.xmlListening Endpoints Summary... (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1521))) (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=dbserver)(PORT=1521)))Services Summary...Service &quot;sx21&quot; has 1 instance(s). Instance &quot;sx21&quot;, status READY, has 1 handler(s) for this service...Service &quot;sx21XDB&quot; has 1 instance(s). Instance &quot;sx21&quot;, status READY, has 1 handler(s) for this service...The command completed successfully 连接12345678910111213141516171819202122[oracle@dbserver app]$ sqlplus /nologSQL*Plus: Release 11.2.0.1.0 Production on Wed Dec 27 17:05:57 2017Copyright (c) 1982, 2009, Oracle. All rights reserved.SQL&gt; conn /as sysdbaConnected.SQL&gt; shutdown immediateDatabase closed.Database dismounted.ORACLE instance shut down.SQL&gt; startupORACLE instance started.Total System Global Area 3340451840 bytesFixed Size 2217952 bytesVariable Size 1811941408 bytesDatabase Buffers 1509949440 bytesRedo Buffers 16343040 bytesDatabase mounted.Database opened. 静默删除数据库实例1dbca -silent -deleteDatabase -sourcedb orcl -sid orcl -sysDBAUserName sys -sysDBAPassword password 参考文档：https://www.jianshu.com/p/b4200e721bfdhttp://blog.51cto.com/wzlinux/1710941]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>数据库</tag>
        <tag>Oracle</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[枚举卷期间出错: 客户端无法连接到请求中指定的目标……]]></title>
    <url>%2Farlo%2F143cd09f%2F</url>
    <content type="text"><![CDATA[存储：华为/OceanStor 2600 V3网络：FC服务器：Windows Server 2012 R2更新系统补丁重启后连接存储提示以下错误： 枚举存储期间出错。枚举卷期间出错: 客户端无法连接到请求中指定的目标。 请验证该目标上的服务是否正在运行以及是否正在接受请求。 有关目标(通常是 IIS 或 WinRM)上运行的 WS 管理服务，请查阅日志和文档。 如果目标是 WinRM 服务，则在目标上运行以下命令来分析和配置 WinRM 服务: “winrm quickconfig”。 这个错误应该跟 WinRM 服务有关，找到服务启用“ Windows Remote Management（WinRM）”服务后恢复正常;顺便设置服务为开机自启动。]]></content>
      <categories>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>Windows</tag>
        <tag>华为</tag>
        <tag>存储</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[搭建ftp服务器并配置虚拟用户登录]]></title>
    <url>%2Farlo%2F5cd2f164%2F</url>
    <content type="text"><![CDATA[vsftpd 是“very secure FTP daemon”的缩写，安全性是它的一个最大的特点。本次搭建ftp服务器，采用虚拟用户登录；所谓虚拟用户就是没有使用真实的系统用户，只是通过映射到真实的账户和设置权限的目的。虚拟用户不能登录操作系统。 系统环境CentOS 6.9SELinux disabled 软件安装1yum -y install db4 db4-utils vsftpd 创建虚拟用户的宿主用户1useradd -u 600 -d /data/ftproot -s /sbin/nologin slvftp 创建用户名密码文件12345vim account.txtslftp1xxxxxxslftp2yyyyyy 生成虚拟用户认证文件1234db_load -T -t hash -f ./account.txt /etc/vsftpd/account.db#安全原因，修改认证文件权限chmod 600 /etc/vsftpd/account.db#执行完此操作，建议删除account.txt 配置认证文件1234vim /etc/pam.d/vsftpd.slauth required /lib64/security/pam_userdb.so db=/etc/vsftpd/accountaccount required /lib64/security/pam_userdb.so db=/etc/vsftpd/account#我这里是64位的操作系统，写的是/lib64,如果是32位的操作系统，写成/lib即可 修改配置文件123456789101112131415161718192021222324252627282930vim /etc/vsftpd/vsftpd.conf#虚拟用户权限与匿名用户权限相同，虚拟用户权限单独设定virtual_use_local_privs=NO#服务器独立运行listen=YES#设定不允许匿名访问anonymous_enable=NO#设定本地用户可以访问。注：如使用虚拟宿主用户，在该项目设定为NO的情况下所有虚拟用户将无法访问local_enable=YES#使用户不能离开主目录chroot_list_enable=YESchroot_list_enable=YESchroot_list_file=/etc/vsftpd/chroot_list#设定支持ASCII模式的上传和下载功能ascii_upload_enable=YESascii_download_enable=YES#PAM认证文件名。PAM将根据/etc/pam.d/vsftpd.sl进行认证pam_service_name=vsftpd.sl#设定启用虚拟用户功能guest_enable=YES#指定虚拟用户的宿主用户，CentOS中已经有内置的ftp用户了guest_username=slvftp#设定虚拟用户个人vsftp的CentOS FTP服务文件存放路径。存放虚拟用户个性的CentOS FTP服务文件(配置文件名=虚拟用户名)user_config_dir=/etc/vsftpd/user_config/#配置vsftpd日志（可选）xferlog_enable=YESxferlog_std_format=YESxferlog_file=/var/log/xferlogdual_log_enable=YESvsftpd_log_file=/var/log/vsftpd.log 新建chroot_list空文件1touch /etc/vsftpd/chroot_list 创建虚拟用户的配置目录文件1234567891011121314151617181920212223mkdir /etc/vsftpd/user_config/#虚拟用户配置文件名必须与用户名一致vim /etc/vsftpd/user_config/slftp1guest_username=slvftp #虚拟用户的宿主用户local_root=/data/ftproot/slftp1 #虚拟用户根目录local_enable=YESwrite_enable=YES #写权限anon_umask=022anon_world_readable_only=NOanon_upload_enable=YES #上传权限anon_mkdir_write_enable=YES #创建文件夹权限anon_other_write_enable=YES #其他权限##############vim /etc/vsftpd/user_config/slftp2guest_username=slvftplocal_root=/data/ftproot/slftp2local_enable=YESwrite_enable=YESanon_umask=022anon_world_readable_only=NOanon_upload_enable=YESanon_mkdir_write_enable=YESanon_other_write_enable=YES 创建ftp根目录123mkdir -pv /data/ftproot/slftp&#123;1,2&#125;chmod 700 -R /data/ftprootchown slvftp.slvftp -R /data/ftproot 重启vsftp服务1/etc/init.d/vsftpd restart 防火墙开放端口12iptables -A INPUT -m state --state NEW -m tcp -p tcp --dport 21 -j ACCEPTiptables -A INPUT -m state --state NEW -m tcp -p tcp --dport 20 -j ACCEPT 测试12yum -y install lftplftp user:passwd@127.0.0.1 参考文档：https://dumplings.cc/bu-shu-vsftpyu-pei-zhi-xu-ni-yong-hu-deng-lu/]]></content>
      <categories>
        <category>服务器搭建</category>
      </categories>
      <tags>
        <tag>ftp</tag>
        <tag>vsftp</tag>
        <tag>服务器</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Oracle RAC环境搭建(Oracle Linux 6.9+Oracle 11g R2+FreeNas)]]></title>
    <url>%2Farlo%2Fe07eb088%2F</url>
    <content type="text"><![CDATA[捣腾Oracle RAC环境已经半月有余，从对RAC一无所知到环境搭建成功，期间遇到很多坑，填了很多坑；特写此篇，记录一下搭建的过程，以备忘！话不多说，开干！网络环境：网络分为三个部分，Public网络用于访问业务应用，Priv网络用于检测心跳，Storge网络用于连接存储；VIP，rac-scan网络应与Public网络在同一网段12345主机名 Public网络 Priv网络 Storge网络 VIPrac1 192.168.100.11 172.16.10.11 172.16.20.11 92.168.100.21rac2 192.168.100.12 172.16.10.12 172.16.20.12 192.168.100.22rac-scan 192.168.100.23freenas 172.16.20.13 软件环境：Oracle Linux6.9GridOracle Database 11gASMlibFreeNas RAC搭建分为五个部分： 基础环境准备 共享存储搭建 网络搭建 Grid 安装 Database 安装 基础环境准备基础环境如无特别指明，都是需要在两台机器上操作的。 虚拟机环境搭建虚拟机资源配置rac1:4核/8G/200Grac2:4核/8G/200Gfreenas:2核/2G/100G+(200G+200G+20G+20G) 网络环境配置1234567虚拟机名称 网卡1 网卡2 网卡3rac1 VMnet1(NAT模式) VMnet2(仅主机模式) VMnet3(仅主机模式)rac2 VMnet1(NAT模式) VMnet2(仅主机模式) VMnet3(仅主机模式)freenas VMnet1(NAT模式)VMnet1:192.168.100.0/24VMnet2:172.16.10.0/24VMnet3:172.16.20.0/24 操作系统安装安装图形界面环境(过程略……) 操作系统配置修改主机名rac112vim /etc/sysconfig/networkHOSTNAME=rac1 rac212vim /etc/sysconfig/networkHOSTNAME=rac2 配置hosts123456789101112131415127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4########public#######192.168.100.11 rac1192.168.100.12 rac2#######priv#########172.16.10.11 rac1-priv172.16.10.12 rac2-priv######vip###########192.168.100.21 rac1-vip192.168.100.22 rac2-vip192.168.100.23 rac-scan172.16.20.13 freenas 配置时间同步关闭ntpd服务，使用oracle自身的集群时间同步12345678cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtimentpdate cn.ntp.org.cnvim /etc/sysconfig/ntpdSYNC_HWCLOCK=yesOPTIONS=&quot;-x -u ntp:ntp -p /var/run/ntpd.pid&quot;/etc/init.d/ntpd stopchkconfig ntpd offmv /etc/ntp.conf /etc/ntp.conf.bak 基础软件安装1234567891011121314151617181920212223242526#默认是不安装32位软件包的，添加此选项echo &apos;multilib_policy=all&apos; &gt;&gt; /etc/yum.confyum -y install binutils-* compat-libstdc++-* elfutils-libelf-* elfutils-libelf-devel-* gcc-* gcc-c++-* glibc-* glibc-common-* glibc-devel-* glibc-headers-* libaio-* libaio-devel-* libgcc-* libstdc++* libstdc++-devel* make-* sysstat-* unixODBC-* unixODBC-devel-* ksh-* mksh pdksh#监测一下软件是否安装全rpm -q \binutils \compat-libstdc++-33 \elfutils-libelf \elfutils-libelf-devel \expat \gcc \gcc-c++ \glibc \glibc-common \glibc-devel \glibc-headers \libaio \libaio-devel \libgcc \libstdc++ \libstdc++-devel \make \pdksh \sysstat \unixODBC \unixODBC-devel | grep &quot;not installed&quot; 修改PAM配置文件12vi /etc/pam.d/loginsession required /lib64/security/pam_limits.so 设置内核参数1234567891011121314vi /etc/sysctl.conffs.aio-max-nr = 1048576 fs.file-max = 6815744 kernel.shmmni = 4096 kernel.sem = 250 32000 100 128 net.ipv4.ip_local_port_range = 9000 65500 net.core.rmem_default = 262144 net.core.rmem_max = 4194304 net.core.wmem_default = 262144 net.core.wmem_max = 1048586重新加载生效sysctl –p 创建用户grid1234567groupadd -g 1000 oinstall groupadd -g 1001 asmadmin groupadd -g 1002 asmdba groupadd -g 1003 asmoperuseradd -u 1100 -g oinstall -G asmadmin,asmdba,asmoper -d /home/grid -s /bin/bash grid#设置密码grid用户密码为oracleecho oracle|passwd --stdin grid 配置grid用户环境变量RAC1：123456789101112131415161718su - grid#vi .bash_profile#export PS1=&quot;`/bin/hostname -s`-&gt;&quot;export TMP=/tmpexport TMPDIR=$TMPexport ORACLE_SID=+ASM1export ORACLE_BASE=/u01/app/gridexport ORACLE_HOME=/u01/app/11.2.0/gridexport TNS_ADMIN=$ORACLE_HOME/network/adminexport PATH=/usr/sbin:$PATHexport PATH=$PATH:$ORACLE_HOME/binexport LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/libexport LANG=en_US.UTF-8export NLS_LANG=AMERICAN_AMERICA.ZHS16GBK#使配置文件生效source .bash_profile RAC2：123456789101112131415161718su - grid#vi .bash_profile#export PS1=&quot;`/bin/hostname -s`-&gt;&quot;export TMP=/tmpexport TMPDIR=$TMPexport ORACLE_SID=+ASM2export ORACLE_BASE=/u01/app/gridexport ORACLE_HOME=/u01/app/11.2.0/gridexport TNS_ADMIN=$ORACLE_HOME/network/adminexport PATH=/usr/sbin:$PATHexport PATH=$PATH:$ORACLE_HOME/binexport LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/libexport LANG=en_US.UTF-8export NLS_LANG=AMERICAN_AMERICA.ZHS16GBK#使配置文件生效source .bash_profile 创建用户oracle123456su - rootgroupadd -g 1200 dbagroupadd -g 1201 operuseradd -u 1101 -g oinstall -G dba,oper,asmdba -d /home/oracle -s /bin/bash oracle#设置密码grid用户密码为oracleecho oracle|passwd --stdin oracle 配置oracle用户环境变量RAC1：1234567891011121314151617181920su - oracle#vi .bash_profile#export PS1=&quot;`/bin/hostname -s`-&gt;&quot;export TMP=/tmpexport TMPDIR=$TMPexport ORACLE_HOSTNAME=rac1export ORACLE_SID=orcl1export ORACLE_UNQNAME=orclexport ORACLE_BASE=/u01/app/oracleexport ORACLE_HOME=$ORACLE_BASE/11gexport TNS_ADMIN=$ORACLE_HOME/network/adminexport PATH=/usr/sbin:$PATHexport PATH=$PATH:$ORACLE_HOME/binexport LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/libexport LANG=en_US.UTF-8export NLS_LANG=AMERICAN_AMERICA.ZHS16GBK#使配置文件生效source .bash_profile RAC2：1234567891011121314151617181920su - oracle#vi .bash_profile#export PS1=&quot;`/bin/hostname -s`-&gt;&quot;export TMP=/tmpexport TMPDIR=$TMPexport ORACLE_HOSTNAME=rac2export ORACLE_SID=orcl2export ORACLE_UNQNAME=orclexport ORACLE_BASE=/u01/app/oracleexport ORACLE_HOME=$ORACLE_BASE/11gexport TNS_ADMIN=$ORACLE_HOME/network/adminexport PATH=/usr/sbin:$PATHexport PATH=$PATH:$ORACLE_HOME/binexport LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/libexport LANG=en_US.UTF-8export NLS_LANG=AMERICAN_AMERICA.ZHS16GBK#使配置文件生效source .bash_profile 创建目录，修改权限12345678910su - rootmkdir -p /u01/app/grid mkdir -p /u01/app/11.2.0/gridchown -R grid:oinstall /u01chown -R grid:oinstall /u01/app/11.2.0/gridmkdir -p /u01/app/oraclechown -R oracle:oinstall /u01/app/oraclechmod -R 775 /u01export LANG=en_US.UTF-8export NLS_LANG=AMERICAN_AMERICA.ZHS16GBK 配置profile12345678910vim /etc/profileif [ \$USER = &quot;oracle&quot; ] || [ \$USER = &quot;grid&quot; ];then if [ \$SHELL = &quot;/bin/ksh&quot; ];then ulimit -p 16384 ulimit -n 65536 else ulimit -u 16384 -n 65536 fi umask 022 fi 修改Oracle用户限制1234567891011121314vi /etc/security/limits.conforacle soft nproc 2047oracle hard nproc 16384oracle soft nofile 1024oracle hard nofile 65536oracle soft stack 10240oracle hard stack 32768grid soft nproc 2047grid hard nproc 16384grid soft nofile 1024grid hard nofile 65536grid soft stack 10240grid hard stack 32768 ssh 互信1234su - gridssh-keygen (一路回车)ssh-copy-id -i rac2ssh-copy-id -i rac1 1234su - oraclessh-keygen (一路回车)ssh-copy-id -i rac2ssh-copy-id -i rac1 测试一下1234ssh rac1 dateThu Nov 23 14:00:03 CST 2017ssh rac2 dateThu Nov 23 14:00:24 CST 2017 使用FreeNas搭建iscsi存储安装操作系统使用FreeNAS-9.2.1.7-RELEASE-x64.iso镜像搭建NAS存储，一块系统磁盘，四块存储盘选择1 Install/Upgrade 安装FreeNAS选择第一块系统磁盘全新安装(虚拟机环境之前安装过，新环境应该没有这一步)安装警告，例行问候，选择Yes安装完成重启系统 配置网络提示是否删除现有的配置，输入n是否配置DHCP，输入n；是否配置IPv4,输入y；输入ip地址、子网掩码；是否配置IPv6,输入n配置完成后，即可通过url来管理freenas，访问地址为http://172.16.20.13新版本第一次登录会让修改密码ps:如果密码忘记，可以在刚才的步骤里选择7）Reset WebGUI login credentials，在此步骤可以输入新密码 配置iscsi设置中文语言，上海时区开启iSCSI服务配置全局目标，设置iSCSI名称iqn.2017-11.cc.islocal.istgt配置Portals配置初始的授权配置授权用户grid添加iscsi目标设备依次添加4块存储磁盘关联添加的存储设备为LUN 安装Grid Infrastructure 如果使用Centos6.x操作系统安装rac，建议使用UEK内核;uek内核是Oracle Linux、Oracle Database、中间件和硬件工程师团队合作的结果，是一个快速、现代、可靠的内核，专门针对Oracle软件和硬件进行了优化。随着硬件的快速发展，为了更好的兼容并支持快速发展的硬件，Linux系统版本及内核也在不断的更新，uek正是在这样的环境下应运而生的产物。安装uek内核可以参考以下文档https://docs.oracle.com/cd/E37670_01/E37355/html/ol_obtain_uek.htmlhttps://docs.oracle.com/cd/E52668_01/E39381/html/ol_import_gpg.htmlhttp://www.oracle.com/technetwork/server-storage/linux/asmlib/index-101839.html ASM 分区创建方法一：使用ASMlib创建ASM分区12yum -y install oracleasm-support oracle-rdbms-server-11gR2-preinstallrpm -ivh http://download.oracle.com/otn_software/asmlib/oracleasmlib-2.0.12-1.el6.x86_64.rpm 上传linux.x64_11gR2_grid.zip到/usr/local/src目录下1234cd /usr/local/src/unzip linux.x64_11gR2_grid.zip/usr/local/src/grid/rpmrpm -ivh cvuqdisk-1.0.7-1.rpm 初始化asmRAC112345678910111213141516[root@rac1 rpm]# /etc/init.d/oracleasm configure -iConfiguring the Oracle ASM library driver.This will configure the on-boot properties of the Oracle ASM librarydriver. The following questions will determine whether the driver isloaded on boot and what permissions it will have. The current valueswill be shown in brackets (&apos;[]&apos;). Hitting &lt;ENTER&gt; without typing ananswer will keep that current value. Ctrl-C will abort.Default user to own the driver interface [grid]: gridDefault group to own the driver interface [oinstall]: oinstallStart Oracle ASM library driver on boot (y/n) [y]: yScan for Oracle ASM disks on boot (y/n) [y]: yWriting Oracle ASM library driver configuration: doneInitializing the Oracle ASMLib driver: [ OK ]Scanning the system for Oracle ASMLib disks: [ OK ] 1/usr/sbin/oracleasm init RAC212345678910111213141516[root@rac2 src]# /etc/init.d/oracleasm configure -iConfiguring the Oracle ASM library driver.This will configure the on-boot properties of the Oracle ASM librarydriver. The following questions will determine whether the driver isloaded on boot and what permissions it will have. The current valueswill be shown in brackets (&apos;[]&apos;). Hitting &lt;ENTER&gt; without typing ananswer will keep that current value. Ctrl-C will abort.Default user to own the driver interface [grid]: gridDefault group to own the driver interface [oinstall]: oinstallStart Oracle ASM library driver on boot (y/n) [y]: yScan for Oracle ASM disks on boot (y/n) [y]: yWriting Oracle ASM library driver configuration: doneInitializing the Oracle ASMLib driver: [ OK ]Scanning the system for Oracle ASMLib disks: [ OK ] 配置iscsi客户端1yum -y install iscsi-initiator-utils 12[root@rac1 rpm]# iscsiadm -m discovery -t sendtargets -p 172.16.20.13172.16.20.13:3260,1 iqn.2017-11.cc.islocal.istgt:iscsi 123[root@rac1 rpm]# /etc/init.d/iscsi restartStopping iscsi: [ OK ]Starting iscsi: [ OK ] iscsi命令拓展查看iscsi target信息123iscsiadm -m node -p ip_addriscsiadm -m node session -p ip_addriscsiadm -m node discovery -P ip_addr 登录target连接1iscsiadm -m node -T iqn.2017-11.cc.islocal.istgt:iscsi -p ip_addr -l 登出target连接1iscsiadm -m node -T iqn.2017-11.cc.islocal.istgt:iscsi -p ip_addr -u 删除target条目记录1iscsiadm -m node -o delete -T iqn.2017-11.cc.islocal.istgt:iscsi -p ip_addr 磁盘分区fdisk -l 可以发现已经识别到4个磁盘sdb,sdc,sdd,sde,对磁盘进行分区“n/p/1/回车/回车/w” 创建ASM分区1234/etc/init.d/oracleasm createdisk ASMDATA /dev/sdb1/etc/init.d/oracleasm createdisk BACKUP /dev/sdc1/etc/init.d/oracleasm createdisk OCR /dev/sdd1/etc/init.d/oracleasm createdisk VOTINGDISK /dev/sde1 1234567[root@rac1 rpm]# /etc/init.d/oracleasm scandisksScanning the system for Oracle ASMLib disks: [ OK ][root@rac1 rpm]# /etc/init.d/oracleasm listdisksASMDATABACKUPOCRVOTINGDISK 在rac2上发现asm磁盘1yum -y install iscsi-initiator-utils 12[root@rac2 rpm]# iscsiadm -m discovery -t sendtargets -p 172.16.20.13172.16.20.13:3260,1 iqn.2017-11.cc.islocal.istgt:iscsi 123[root@rac2 rpm]# /etc/init.d/iscsi restartStopping iscsi: [ OK ]Starting iscsi: [ OK ] 123456789[root@rac2 ~]# start_udev Starting udev: [ OK ][root@rac2 src]# /etc/init.d/oracleasm scandisksScanning the system for Oracle ASMLib disks: [ OK ][root@rac2 src]# /etc/init.d/oracleasm listdisksASMDATABACKUPOCRVOTINGDISK 方法二：使用udev方式创建ASM分区配置iscsi客户端1yum -y install iscsi-initiator-utils 12[root@rac1 rpm]# iscsiadm -m discovery -t sendtargets -p 172.16.20.13172.16.20.13:3260,1 iqn.2017-11.cc.islocal.istgt:iscsi 123[root@rac1 rpm]# /etc/init.d/iscsi restartStopping iscsi: [ OK ]Starting iscsi: [ OK ] 将ASM磁盘添加到udev，防止开始发现磁盘顺序不一致导致的异常问题12345678[root@rac1 ~]# /sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/sdb13300000007a38757b[root@rac1 ~]# /sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/sdc13300000008853f678[root@rac1 ~]# /sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/sdd13300000009b03058c[root@rac1 ~]# /sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/sde13300000006968868f 12345[root@rac1 rules.d]# vim 99-iscsi-asm.rulesKERNEL==&quot;sd*&quot;, BUS==&quot;scsi&quot;, PROGRAM==&quot;/sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/$name&quot;, RESULT==&quot;3300000007a38757b&quot;, NAME=&quot;asm-data&quot;, OWNER=&quot;grid&quot;, GROUP=&quot;oinstall&quot;, MODE=&quot;660&quot;KERNEL==&quot;sd*&quot;, BUS==&quot;scsi&quot;, PROGRAM==&quot;/sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/$name&quot;, RESULT==&quot;3300000008853f678&quot;, NAME=&quot;asm-backup&quot;, OWNER=&quot;grid&quot;, GROUP=&quot;oinstall&quot;, MODE=&quot;660&quot;KERNEL==&quot;sd*&quot;, BUS==&quot;scsi&quot;, PROGRAM==&quot;/sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/$name&quot;, RESULT==&quot;3300000009b03058c&quot;, NAME=&quot;asm-ocr&quot;, OWNER=&quot;grid&quot;, GROUP=&quot;oinstall&quot;, MODE=&quot;660&quot;KERNEL==&quot;sd*&quot;, BUS==&quot;scsi&quot;, PROGRAM==&quot;/sbin/scsi_id --whitelisted --replace-whitespace --device=/dev/$name&quot;, RESULT==&quot;3300000006968868f&quot;, NAME=&quot;asm-vdisk&quot;, OWNER=&quot;grid&quot;, GROUP=&quot;oinstall&quot;, MODE=&quot;660&quot; 123[root@rac1 rules.d]# scp 99-iscsi-asm.rules rac2:/etc/udev/rules.d/99-iscsi-asm.rules[root@rac1 rules.d]# start_udev Starting udev: [ OK ] 12345[root@rac1 rules.d]# ll /dev/asm-*brw-rw---- 1 grid asmadmin 8, 33 Nov 23 17:48 /dev/asm-backupbrw-rw---- 1 grid asmadmin 8, 17 Nov 23 17:48 /dev/asm-databrw-rw---- 1 grid asmadmin 8, 49 Nov 23 17:48 /dev/asm-ocrbrw-rw---- 1 grid asmadmin 8, 65 Nov 23 17:48 /dev/asm-vdisk 在rac2上发现asm磁盘1yum -y install iscsi-initiator-utils 12[root@rac2 rpm]# iscsiadm -m discovery -t sendtargets -p 172.16.20.13172.16.20.13:3260,1 iqn.2017-11.cc.islocal.istgt:iscsi 123[root@rac2 rpm]# /etc/init.d/iscsi restartStopping iscsi: [ OK ]Starting iscsi: [ OK ] 12[root@rac2 ~]# start_udev Starting udev: [ OK ] 12345[root@rac2 ~]# ll /dev/asm-*brw-rw---- 1 grid asmadmin 8, 33 Nov 23 17:54 /dev/asm-backupbrw-rw---- 1 grid asmadmin 8, 17 Nov 23 17:54 /dev/asm-databrw-rw---- 1 grid asmadmin 8, 49 Nov 23 17:54 /dev/asm-ocrbrw-rw---- 1 grid asmadmin 8, 65 Nov 23 17:54 /dev/asm-vdisk 安装Grid建议直接用grid用户登录图形桌面，而不是root登录su - grid切换过去。12rac1-&gt;cd /usr/local/src/gridrac1-&gt;./runcluvfy.sh stage -pre crsinst -n rac1,rac2 -fixup -verbose 安装前监测一下环境，如果有failed，按照要求去修复，我这里有几个软件包太新，不是太影响，我们就开始安装吧。执行./runInstaller，开始安装安装和配置一个GI集群高级安装添加中文支持取消GNS选项，保持SCAN Name和hosts里配置的一样添加rac2根据之前配置的网络，配置网络类型选择ASM存储这里遇到几个几个坑，详细说一下吧；1.如果默认没有在候选磁盘(Candidate Disks)里,选择所有磁盘(All disks),看看是否可以显示出来；2.如果还是没有发现，点一下改变其他路径(Change Discovery Path),rhel系列系统默认路径是/dev/raw/\, 我这里是/dev/asm-*;3.如果磁盘显示出来是灰色，不能选择，可能是练习的时候，之前已经使用过磁盘做过asm了，可以执行“dd if=/dev/zero of=/dev/rhdisk2 bs=1024 count=100”，然后重新开始安装试试，如果还不行，请从存储方面开始排查；4.我这里配置的udev方式发现保证磁盘的唯一性，现在发现一个问题，start_udev后可以发现磁盘，/dev/asm-*都生成了；执行oraclescandisk后发现不了ASM磁盘，/dev/oracleasm/disks/目录下是空的，但是安装时候找到了，是可用状态，有点小疑惑。*ASM提供三种冗余模式，我们使用External；ASM三种模式后期学习了，在单独写一篇吧。选择Yes默认默认的三个组默认安装路径忽略ALL所有的配置信息安装完成，使用root账号依次在rac1，rac2上执行脚本;如果你执行root.sh出现以下错误，恭喜你！这个问题折磨了我太久，后来在网上看到这是一个bug！1234CRS-4124: Oracle High Availability Services startup failed.CRS-4000: Command Start failed, or completed with errors.ohasd failed to start: Inappropriate ioctl for deviceohasd failed to start at /opt/app/11.2.0/grid/crs/install/rootcrs.pl line 443. 此错误解决方法123删除之前的配置：/u01/app/11.2.0/grid/crs/install/roothas.pl -deconfig -force -verbose窗口1：/u01/app/11.2.0/grid/root.sh窗口2：/bin/dd if=/var/tmp/.oracle/npohasd of=/dev/null bs=1024 count=1 （刚开始执行root.sh时候，还没生成npohash文件，等日志出现“Adding daemon to inittab”的时候，在窗口2中使用root用户执行此命令，等root.sh执行成功后，ctrl+c结束此命令即可） 出现以下提示，方为脚本执行成功。1234567Configure Oracle Grid Infrastructure for a Cluster ... succeededUpdating inventory properties for clusterwareStarting Oracle Universal Installer...Checking swap space: must be greater than 500 MB. Actual 7999 MB PassedThe inventory pointer is located at /etc/oraInst.locThe inventory is located at /u01/app/oraInventory 这个错误没事，直接点击Next完成安装 验证安装状态123456789su - gridcrs_stat -tcrsctl check cluster -allolsnodes -s -n -tcrsctl check crssrvctl status asmsrvctl status scansrvctl status vip -n rac1srvctl status scan_listener 创建ASM磁盘组在grid 用户下，执行 asmca，启动 asm 磁盘组创建向导DATA组，存放数据文件，包括/dev/asm-data,/dev/asm-backup;VOTINGDISK组，存放闪回文件，包含/dev/asm-vdiskDisk Groups，点击create 按钮，在弹出的创建界面中填写磁盘组名称，选择external(none)，并勾选成员，选择完毕后点击 ok；确认stat为2 of 2时,退出asmca 安装oracle11gr2 database 软件建议直接用oracle用户登录图形桌面，而不是root登录su - oracle切换过去。这个安装过程也很简单，基本上和单机版的一样；12rac1-&gt;cd /usr/local/src/databaserac1-&gt;./runInstaller 创建和配置一个数据库服务器模式选择rac集群中的节点高级安装添加中文支持服务器版本默认安装路径一般用途实例名称，SID名称(ps:这里的截图稍微有点问题，sid应该是orcl，不是orcl1)自动分配内存选择中文字符集连接asm存储的密码不备份选择DATA磁盘组设置sys/system密码默认管理组监测依赖配置信息安装完成依次执行脚本12345Entries will be added to the /etc/oratab file as needed byDatabase Configuration Assistant when a database is createdFinished running generic part of root.sh script.Now product-specific root actions will be performed.Finished product-specific root actions. 12sqlplus system/oracle@orclselect inst_id,instance_number,instance_name from gv$instance; 参考资料：http://v.qq.com/vplus/91c845f5c21fd8a6a25e9827b38c171ehttp://www.dba-oracle.com/t_reset_an_asm_diskgroup.htmhttp://www.oracle.com/technetwork/cn/articles/hunter-rac11gr2-iscsi-083834-zhs.htmlhttp://blog.csdn.net/u010098331/article/details/50767353https://docs.oracle.com/cd/E11882_01/doc.112/e28441/require.htm#CDMIG110http://blog.sina.com.cn/s/blog_563c17780102ux53.htmlhttps://blogs.oracle.com/database4cn/11gr2-crsgrid-scansingle-client-access-name]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>集群</tag>
        <tag>数据库</tag>
        <tag>Oracle</tag>
        <tag>RAC</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Windows组策略几个问题小计]]></title>
    <url>%2Farlo%2F9bdfcc8c%2F</url>
    <content type="text"><![CDATA[注册表编辑被管理员禁用第一步：打开组策略窗口，开始-运行-gptdit.msc第二步：选择用户配置-管理模板-系统，双击系统选项找到【阻止访问注册表编辑工具】第三步：双击【阻止访问注册表编辑工具】选择已禁用，点击确定。第四步：在开始-运行输入regedit，打开注册表。 说明注册表已经可以访问了。 服务灰色，无法正常使用MMC 在该文档中引用的管理单元受到策略限制第一步：开始-运行-regedit，启动注册表编辑器第二步：HKEY_CURRENT_USER\Software\Policies\Microsoft\MMC{58221C66-EA27-11CF-ADCF-00AA00A80033}\Restrict_Run，将值设为0 任务管理器无法正常使用第一步：打开组策略窗口，开始-运行-gptdit.msc第二步：选择用户配置-管理模板-系统-Ctrl+Alt+Del选项第三步：在该列表中打开 删除“任务管理器” 的属性，在 删除“任务管理器” 属性中的“设置”选项卡中点选“已禁用”，确定。 要远程登录，你需要具有通过远程桌面服务进行的登录权限要远程登录，你需要具有通过远程桌面服务进行的登录权限。默认情况下，远程桌面用户组的成员有这项权限。如果你所属的组没有这项权限，或者远程桌面用户组已经删除了这项权限，那么需要手动为你授予这一权限第一步：gpedit进入策略组:计算机配置-&gt;Windows设置-&gt;安全设置-&gt;本地策略-&gt;用户权限分配第二步：找到拒绝通过远程桌面服务登录,把里面的账号去了即可 修改远程登录3389端口第一步: 打开“开始→运行”，输入“regedit”，打开注册表，第二步: 进入[HKEY_LOCAL_MACHINE/SYSTEM/CurrentControlSet/Control/Terminal Server/Wds/rdpwd/Tds/tcp]，将PortNamber值(默认值是3389)，修改为新的端口，例如12389，注意使用十进制。第三部：进入[HKEY_LOCAL_MACHINE/SYSTEM/CurrentControlSet/Control/Terminal Server/WinStations/RDP-Tcp]，将PortNumber值(默认是3389)修改为新的端口，如12389，注意使用十进制。 Win10家庭版找不到gpedit.msc组策略复制一下内容，新建一个.bat文件，然后使用管理员身份运行1234567891011@echo offpushd &quot;%~dp0&quot;dir /b C:\Windows\servicing\Packages\Microsoft-Windows-GroupPolicy-ClientExtensions-Package~3*.mum &gt;List.txtdir /b C:\Windows\servicing\Packages\Microsoft-Windows-GroupPolicy-ClientTools-Package~3*.mum &gt;&gt;List.txtfor /f %%i in (&apos;findstr /i . List.txt 2^&gt;nul&apos;) do dism /online /norestart /add-package:&quot;C:\Windows\servicing\Packages\%%i&quot;pause 出现身份验证错误，要求的函数不受支持此错误原因是检查更新了KB4103718的补丁造成的。 使用微软官方建议修改本地组策略： 开始运行输入gpedit.msc 计算机配置&gt;管理模板&gt;系统&gt;凭据分配&gt;加密Oracle修正 选择启用并选择易受攻击。 易受攻击– 使用 CredSSP 的客户端应用程序将通过支持回退到不安全的版本使远程服务器遭受攻击，但使用 CredSSP 的服务将接受未修补的客户端。 PS:该操作仅用于专业版，如果是家庭版请考虑升级(本人是家庭版，在X宝上买的key升级为专业版了);或者卸载KB4103718补丁重启。 参考地址：http://ytweb.blog.51cto.com/5865824/1177266https://jingyan.baidu.com/article/3a2f7c2e6ab84626afd61114.htmlhttp://blog.sina.com.cn/s/blog_4298a2c80102vii4.htmlhttp://www.cnblogs.com/q149072205/p/6097433.htmlhttp://blog.csdn.net/flyingdream123/article/details/50724107http://www.soncs.com/NewsShow/144.html]]></content>
      <categories>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>Windows</tag>
        <tag>组策略</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Win10无法正常连接sslvpn]]></title>
    <url>%2Farlo%2Fe72ff5d%2F</url>
    <content type="text"><![CDATA[环境Dell燃7000Win 10 64bitHangzhou DPtech Co.,Ltd. SSL VPN 现象1、无法创建虚拟网卡2、使用vpn自带的修复工具后驱动不对，“Windows 无法验证此设备所需的驱动程序的数字签名。该值受安全引导策略保护，无法进行修改或删除” 解决方法1、重新笔记本2、进入BIOS-Secure Boot，取消Windows UEFI模式3、删除Secure Key(可以备份一下，我没备份，删除后暂时未发现异常)4、重启后秒拨参考：http://www.cnblogs.com/easyc/p/6132581.html]]></content>
      <categories>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>Windows</tag>
        <tag>vpn</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Jenkins使用Publish Over CIFS插件实现静态页面部署到Windows服务器]]></title>
    <url>%2Farlo%2F9a888771%2F</url>
    <content type="text"><![CDATA[发布静态内容操作很简单，一般分两步；一、获取svn内容。二、拷贝到服务器发布目录；以前静态内容都是在Linux环境下使用Nginx发布，持续集成发布的时候Hudson SCP publisher plugin,调用linux下Scp命令，通过SSH协议拷贝到发布目录就可以了；最近遇到一个问题，需要发布静态页面到Windows服务器下。不论是IIS，还是Nginx，也都存在一个拷贝内容到发布目录的问题，Windows下采取目录共享方式，通过CIFS协议拷贝。 共享发布目录共享nginx发布目录jzhome Nginx 配置文件修改1234567891011121314151617181920212223…… server &#123; listen 80; server_name localhost; location / &#123; root html; index index.html index.htm; &#125; location /mypic &#123; proxy_pass http://127.0.0.1:8888/mypic; &#125; location /JzAir &#123; proxy_pass http://127.0.0.1:9999/JzAir; &#125; location /Jzapp &#123; proxy_pass http://127.0.0.1:8080/Jzapp; &#125; location /jzhome &#123; root F:\\deploy\\nginx-1.12.1\\; index index.html index.htm; &#125;&#125;…… 安装Jenkins插件安装Publish Over CIFS插件，安装完成后重启Jenkins 配置CIFSJenkins-系统管理-系统配置-Publish over CIFS 配置JobJob-构建后步骤PS:这里有点比较难懂一点，Source files要一个能包含所有发布内容的父级目录，所以当发布内容为abc/html/xxx,我们在获取svn代码的时候，获取到abc这一层，这里Source files填写html/**,Remove prefix填写html,Remote directory为空，就可以将html目录下的所有内容发布到共享服务器上]]></content>
      <categories>
        <category>自动化运维</category>
      </categories>
      <tags>
        <tag>自动化</tag>
        <tag>运维</tag>
        <tag>Jenkins</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Zabbix(6)监控SQL Server数据库]]></title>
    <url>%2Farlo%2F35d80780%2F</url>
    <content type="text"><![CDATA[监控SQL Server相对来说比较简单，首先我们下载一个MS SQL的模板文件下载地址：https://share.zabbix.com/databases/microsoft-sql-server/template-ms-sql-2012 修改zabbix_agent.conf文件添加下边这行到配置文件最后1UserParameter=sqldatabasename.discovery,powershell -NoProfile -ExecutionPolicy Bypass -File C:\zabbix\scripts\SQLBaseName_To_Zabbix.ps1 将powershell脚本放在目录下将SQLBaseName_To_Zabbix.ps1脚本放在C:\zabbix\scripts\目录下 重启zabbix agent重启客户端zabbix agent服务 导入模板文件导入模板MS SQL 2012.xml 关联模板 查看最新数据]]></content>
      <categories>
        <category>监控</category>
      </categories>
      <tags>
        <tag>zabbix</tag>
        <tag>监控</tag>
        <tag>MSSQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Zabbix(5)通过JMX监控Tomcat]]></title>
    <url>%2Farlo%2Fe35d6a2a%2F</url>
    <content type="text"><![CDATA[Zabbix监控tomcat主要使用的是zabbix的zabbix-java-gateway。从Zabbix 2.0开始，内置了监控JMX的功能，叫做“Zabbix Java Gateway”，在Zabbix Server和Zabbix Proxy上启动名为“Zabbix Java Gateway”的进程，当需要获取JMX数据时，Zabbix Server会“问”JMX Gateway，然后JMX Gateway根据JMX管理API去查询需要的数据。在使用时，Java程序不需要在代码中新增任何东西，只需要在启动的时候加上一些JVM参数，使得它可以支持使用端口监控JMX。JMX的全称是Java Management Extensions，即Java管理扩展。Java程序会开放一些端口，用来获取运行状况。 安装jmx服务器安装jdk下载JDK配置环境变量 安装jmx服务1yum -y install zabbix-java-gateway 配置jmx服务123456egrep -v &apos;#|^$&apos; /etc/zabbix/zabbix_java_gateway.confLISTEN_IP=&quot;0.0.0.0&quot;LISTEN_PORT=10052PID_FILE=&quot;/var/run/zabbix/zabbix_java.pid&quot;START_POLLERS=5TIMEOUT=3 12systemctl start zabbix-java-gatewaysystemctl enable zabbix-java-gateway 修改zabbix server配置添加以下三行，这里配置的StartJavaPollers值要小于之前java_gateway中的START_POLLERS1234tail -n 3 /etc/zabbix/zabbix_server.conf JavaGateway=127.0.0.1JavaGatewayPort=10052 StartJavaPollers=3 修改zabbix_server.conf后重启服务1systemctl restart zabbix-server Tomcat配置修改修改配置文件Windows下tomcat在F:\apache-tomcat-7.0.70(zabbix)\bin\catalina.bat中set “CURRENT_DIR=%cd%”下添加以下内容12set CATALINA_OPTS=-Dcom.sun.management.jmxremote.port=12345 -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false# 如果zabbix添加JMX后报错“java.net.SocketTimeoutException: connection timed out: service:jmx:rmi:///jndi/rmi:/” 添加此参数 -Djava.rmi.server.hostname=192.168.6.124 测试JMX下载以下两个jar包放在tomcat lib目录下。下载cmdline-jmxclient-0.10.3.jar下载catalina-jmx-remote.jar123456F:\apache-tomcat-7.0.70(zabbix)\lib&gt;java -jar cmdline-jmxclient-0.10.3.jar - 192.168.6.124:12345 java.lang:type=Memory NonHeapMemoryUsage10/10/2017 16:31:57 +0800 org.archive.jmx.Client NonHeapMemoryUsage:committed: 24838144init: 12746752max: 100663296used: 24806392 在zabbix web页面中添加JMX端口导入模板zabbix自带的”Template App Generic Java JMX”和”Template App Apache Tomcat JMX”模板很多都获取不到数据，从网上找了个模板，监控项不多，但是都是很实用的。 添加JMX端口jmx的端口一定要与在catalina.bat下配置的jmxremote.port一样 关联模板 查看图形 参考链接：http://wzlinux.blog.51cto.com/8021085/1692444http://blog.csdn.net/jhfsdfs/article/details/65629174http://www.fblinux.com/?p=616]]></content>
      <categories>
        <category>监控</category>
      </categories>
      <tags>
        <tag>tomcat</tag>
        <tag>zabbix</tag>
        <tag>监控</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Oracle删除用户报错ORA-01940: cannot drop a user that is currently connected]]></title>
    <url>%2Farlo%2Fdd79d161%2F</url>
    <content type="text"><![CDATA[oracle导入数据之前，删除用户时候报错“ORA-01940: cannot drop a user that is currently connected”，原因是因为用户正在连接使用。12345SQL&gt; drop user air_forecast cascade;drop user air_forecast cascade*ERROR at line 1:ORA-01940: cannot drop a user that is currently connected 查询一下当前用户连接12345SQL&gt; select sid,serial# from v$session where username=&apos;AIR_FORECAST&apos;; SID SERIAL#---------- ---------- 237 2083 252 3564 杀掉占用进程1234567SQL&gt; alter system kill session &apos;237,2083&apos;;System altered.SQL&gt; alter system kill session &apos;252,3564&apos;;System altered. 删除用户1234SQL&gt; drop user air_forecast cascade;User dropped. PS：上述语句中没有状态列，所以看到删除的进程还在，其实是已经标记为KILLED状态了(status 为要删除用户的session状态，如果还为inactive，说明没有被kill掉，如果状态为killed，说明已kill)，删除进程后使用如下语句查询.1select saddr,sid,serial#,paddr,username,status from v$session where username is not null; 导入用户数据12SQL&gt; select * from dba_directories; #查询存储文件目录，将备份文件拷贝到此目录下shell&gt; impdp userid=&quot;&apos;sys/password@sx21 as sysdba&apos;&quot; schemas=air_forecast directory=DATA_PUMP_DIR dumpfile=AIR_FORECAST.DMP]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>数据库</tag>
        <tag>Oracle</tag>
        <tag>Troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Oracle数据库错误表SYS.AUD$无法通过8192(在表空间SYSTEM中)扩展]]></title>
    <url>%2Farlo%2F1998d04e%2F</url>
    <content type="text"><![CDATA[数据库报错信息123456[Content]ORA-00604: 递归 SQL 级别 1 出现错误ORA-01653: 表 SYS.AUD$ 无法通过 8192 (在表空间 SYSTEM 中) 扩展ORA-02002: 写入审计线索时出错ORA-00604: 递归 SQL 级别 1 出现错误ORA-01653: 表 SYS.AUD$ 无法通过 8192 (在表空间 SYSTEM 中) 扩展 该错误原因为表空间无法扩展故障，查找后得知单个表空间文件最大32G，有两个方法扩大表空间（1）创建多个数据文件，都不能超过32g（2）创建大表空间。create bigfile tablespace 他的上限是8EB，不过，oracle10及以后版本才能用。这里我们使用第一种方法处理一下此故障。 Windows下切换SID12345678C:\Users\Administrator&gt;SET ORACLE_SID=sx21C:\Users\Administrator&gt;sqlplus /nologSQL&gt; conn /as sysdba# 查询当前实例SQL&gt; select instance_name from v$instance；INSTANCE_NAME----------------sx21 增加一个表空间文件1234# 查询表空间路径SQL&gt; SELECT FILE_NAME,TABLESPACE_NAME,AUTOEXTENSIBLE FROM dba_data_files WHERE TABLESPACE_NAME=&apos;SYSTEM&apos;;# 在同路径目录下添加一个表空间文件SQL&gt; ALTER TABLESPACE &quot;SYSTEM&quot; ADD DATAFILE &apos;E:\APP\ADMINISTRATOR\ORADATA\SX21\SYSTEM02.DBF&apos; SIZE 1000M AUTOEXTEND ON NEXT 50M MAXSIZE UNLIMITED; 执行完成后重新查看表空间使用情况1SQL&gt; SELECT UPPER(F.TABLESPACE_NAME) &quot;表空间名&quot;, D.TOT_GROOTTE_MB &quot;表空间大小(M)&quot;, D.TOT_GROOTTE_MB - F.TOTAL_BYTES &quot;已使用空间(M)&quot;, TO_CHAR(ROUND((D.TOT_GROOTTE_MB - F.TOTAL_BYTES) / D.TOT_GROOTTE_MB * 100,2),&apos;990.99&apos;) &quot;使用比&quot;, F.TOTAL_BYTES &quot;空闲空间(M)&quot;, F.MAX_BYTES &quot;最大块(M)&quot; FROM (SELECT TABLESPACE_NAME, ROUND(SUM(BYTES) / (1024 * 1024), 2) TOTAL_BYTES, ROUND(MAX(BYTES) / (1024 * 1024), 2) MAX_BYTES FROM SYS.DBA_FREE_SPACE GROUP BY TABLESPACE_NAME) F, (SELECT DD.TABLESPACE_NAME, ROUND(SUM(DD.BYTES) / (1024 * 1024), 2) TOT_GROOTTE_MB FROM SYS.DBA_DATA_FILES DD GROUP BY DD.TABLESPACE_NAME) D WHERE D.TABLESPACE_NAME = F.TABLESPACE_NAME ORDER BY 4 DESC; 参考链接：http://www.jydba.net/oracle数据文件大小的限制/]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>数据库</tag>
        <tag>Oracle</tag>
        <tag>Troubleshooting</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Zabbix(4)通过orabbix插件监控Oracle数据库]]></title>
    <url>%2Farlo%2F780360a7%2F</url>
    <content type="text"><![CDATA[DBforBIX可以支持市面上主流的数据库监控，包括Oracle，Mysql，PostgreSQL，MSSQL，DB2，这篇文章简单的记录一下我监控oracle的过程；软件环境：Jdk 1.8.0_112zabbix 3.4.2orabbix 1.2.3 安装jdk下载jdk：http://www.oracle.com/technetwork/java/archive-139210.html12345tar xf jdk-8u112-linux-x64.tar.gz -C /usr/local/vim /etc/profileexport JAVA_HOME=/usr/local/jdk1.8.0_112/export CLASSPATH=.:$JAVA_HOME/lib/:$JAVA_HOME/jre/lib/export PATH=$JAVA_HOME/bin:$PATH 1source /etc/profile oracle中增加监控用户权限创建用户12345su - oracle$ sqlplus /nologSQL&gt; conn /as sysdbaSQL&gt; CREATE USER ZABBIX IDENTIFIED BY &apos;&lt;PASSWORD&gt;&apos; DEFAULT TABLESPACE SYSTEM TEMPORARY TABLESPACE TEMP PROFILE DEFAULT ACCOUNT UNLOCK;SQL&gt; CREATE USER ZABBIX IDENTIFIED BY zabbix DEFAULT TABLESPACE SYSTEM TEMPORARY TABLESPACE TEMP PROFILE DEFAULT ACCOUNT UNLOCK; 赋予权限123456GRANT CONNECT TO ZABBIX;GRANT RESOURCE TO ZABBIX;GRANT CREATE SESSION TO ZABBIX; GRANT SELECT ANY DICTIONARY TO ZABBIX;GRANT UNLIMITED TABLESPACE TO ZABBIX;GRANT SELECT ANY DICTIONARY TO ZABBIX; 如果是oracle11g的话，需执行以下语句执行以下语句的时候，注意一下全角半角标点符号12SQL&gt; exec dbms_network_acl_admin.create_acl(acl =&gt;&apos;resolve.xml&apos;,description =&gt; &apos;resolve acl&apos;, principal =&gt;&apos;ZABBIX&apos;,is_grant =&gt; true, privilege =&gt; &apos;resolve&apos;);SQL&gt; exec dbms_network_acl_admin.assign_acl(acl =&gt;&apos;resolve.xml&apos;, host =&gt;&apos;*&apos;); 验证语句1SQL&gt; select utl_inaddr.get_host_name(&apos;127.0.0.1&apos;) from dual; 安装orabbix1234wget https://nchc.dl.sourceforge.net/project/orabbix/orabbix-1.2.3.zipmkdir /usr/local/orabbixmv orabbix-1.2.3.zip /usr/local/orabbix/unzip orabbix-1.2.3.zip 12cp config.props.sample config.propsvim config.props 1234567891011121314151617ZabbixServerList=ZabbixServerZabbixServer.Address=192.168.6.103ZabbixServer.Port=10051OrabbixDaemon.Sleep=300OrabbixDaemon.MaxThreadNumber=100#DatabaseList这里配置的主机名一定要和Zabbix里添加的主机名称一致，否则获取不到数据DatabaseList=vm00DatabaseList.MaxActive=10DatabaseList.MaxWait=100DatabaseList.MaxIdle=1vm00.Url=jdbc:oracle:thin:@192.168.6.100:1521:ORCLvm00.User=ZABBIXvm00.Password=zabbixvm00.MaxActive=10vm00.MaxWait=100vm00.MaxIdle=1vm00.QueryListFile=./conf/query.props 12345cd /usr/local/orabbixvim run.sh修改java为/usr/local/jdk1.8.0_112/bin/javachmod +x run.shcp init.d/orabbix /etc/init.d/ 12345vim /etc/init.d/orabbix修改orabbix=/opt/orabbix为orabbix=/usr/local/orabbixchmod +x /etc/init.d/orabbixchkconfig --level 35 --add orabbix /etc/init.d/orabbix start 如果出现异常，可以查看日志排查 /usr/local/orabbix/logs/orabbix.log 导入模板将/usr/local/orabbix/template/Orabbix_export_full.xml模板导入添加主机，关联oracle数据库监控模板默认的配置文件无法正常获取到dbfilesize和dbsize，需要手动修改一下配置文件/usr/local/orabbix/conf/query.props在配置文件最后添加12345678dbfilesize.Query=select to_char(sum(bytes/1024/1024/10), &apos;FM99999999999999990&apos;) retvalue from dba_data_files dbsize.Query=SELECT to_char(sum( NVL(a.bytes/1024/1024/10 - NVL(f.bytes/1024/1024/10, 0), 0)), &apos;FM99999999999999990&apos;) retvalue \FROM sys.dba_tablespaces d, \(select tablespace_name, sum(bytes) bytes from dba_data_files group by tablespace_name) a, \(select tablespace_name, sum(bytes) bytes from dba_free_space group by tablespace_name) f \ WHERE d.tablespace_name = a.tablespace_name(+) AND d.tablespace_name = f.tablespace_name(+) \AND NOT (d.extent_management like &apos;LOCAL&apos; AND d.contents like &apos;TEMPORARY&apos;) 在QueryList最后添加,dbfilesize,dbsize123456QueryList=archive,audit,dbblockgets,dbconsistentgets,dbhitratio,dbphysicalread,dbversion,hitratio_body,hitratio_sqlarea,hitratio_table_proc, \lio_current_read,locks,maxprocs,maxsession,miss_latch,pga_aggregate_target, pga,phio_datafile_reads,phio_datafile_writes,phio_redo_writes,pinhitratio_body,pinhitratio_sqlarea,pinhitratio_table-proc,pinhitratio_trigger, \pool_dict_cache,pool_free_mem,pool_lib_cache,pool_misc,pool_sql_area,procnum,session_active,session_inactive,session,session_system,sga_buffer_cache, \sga_fixed,sga_java_pool,sga_large_pool,sga_log_buffer,sga_shared_pool,tbl_space,userconn,waits_controfileio,waits_directpath_read, \waits_file_io,waits_latch,waits_logwrite,waits_multiblock_read,waits_singleblock_read,hitratio_trigger,lio_block_changes,lio_consistent_read,waits_other,waits_sqlnet,users_locked,uptime,dbfilesize,dbsize 可以在最新数据里看到已经监控到的数据 参考链接：https://www.kancloud.cn/devops-centos/centos-linux-devops/361200http://fengwan.blog.51cto.com/508652/1722118http://www.smartmarmot.com/wiki/index.php?title=DBforBIX#Install_steps_for_Oracle]]></content>
      <categories>
        <category>监控</category>
      </categories>
      <tags>
        <tag>Oracle</tag>
        <tag>zabbix</tag>
        <tag>监控</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Zabbix(3)邮件报警配置]]></title>
    <url>%2Farlo%2F3efe0c83%2F</url>
    <content type="text"><![CDATA[报警的方式有很多，邮件，短信，微信，钉钉，最简单的方式这种脚本去发邮件，在此记录一下配置过程。 配置邮件发送安装mailx1yum -y install mailx 安装好，自己就有软链接了12[root@vm03 ~]# ls -l /usr/bin/maillrwxrwxrwx 1 root root 5 May 6 02:07 /usr/bin/mail -&gt; mailx 配置mailxvim /etc/mail.rc12345set from=user@aliyun.comset smtp=smtp.aliyun.comset smtp-auth-user=user@aliyun.comset smtp-auth-password=&apos;&lt;password&gt;&apos;set smtp-auth=login 发送一封测试邮件1echo &apos;test&apos; |mailx -s &apos;abc&apos; abc@qq.com 修改配置文件12vim /etc/zabbix/zabbix_server.confAlertScriptsPath=/usr/lib/zabbix/alertscripts 发送邮件脚本vim z_sendmail.sh1234#!/bin/bashmessages=`echo $3 | tr &apos;\r\n&apos; &apos;\n&apos;`subject=`echo $2 | tr &apos;\r\n&apos; &apos;\n&apos;`echo &quot;$&#123;messages&#125;&quot; | mail -s &quot;$&#123;subject&#125;&quot; $1 &gt;&gt;/tmp/sendmail.log 2&gt;&amp;1 使用脚本发送一封测试邮件1234chmod +x z_sendmail.shtouch /tmp/sendmail.logchown zabbix.zabbix /tmp/sendmail.log./z_sendmail.sh user@qq.com &quot;hello&quot; &quot;abc&quot; 添加报警类型创建报警类型z_sendmail管理-报警媒介类型-创建媒体类型脚本参数1234567名称：z_sendmail类型：脚本脚本名称：z_sendmail.sh添加以下3个参数，分别对应z_sendmail.sh脚本需要的3个参数收件人地址:&#123;ALERT.SENDTO&#125;主题:&#123;ALERT.SUBJECT&#125;详细内容:&#123;ALERT.MESSAGE&#125; 设置用户报警媒介 配置触发器告警修改默认的告警模板设置为“‘非维护状态’且‘报警值&gt;=警告’”时触发动作 故障操作ps:这个模板标题不会乱码，其他的标题需要做utf8转码gb23121234567891011默认接收人：故障&#123;TRIGGER.STATUS&#125;:服务器 &#123;HOSTNAME1&#125;:&#123;TRIGGER.NAME&#125;默认信息:告警主机:&#123;HOSTNAME1&#125;告警时间:&#123;EVENT.DATE&#125; &#123;EVENT.TIME&#125;告警等级:&#123;TRIGGER.SEVERITY&#125;告警信息: &#123;TRIGGER.NAME&#125;告警项目:&#123;TRIGGER.KEY1&#125;问题详情:&#123;ITEM.NAME&#125;:&#123;ITEM.VALUE&#125;当前状态:&#123;TRIGGER.STATUS&#125;:&#123;ITEM.VALUE1&#125;事件ID:&#123;EVENT.ID&#125;请至Montoring-Events中查看详细情况。 恢复操作12345678910默认接收人：恢复&#123;TRIGGER.STATUS&#125;:服务器&#123;HOSTNAME1&#125;:&#123;TRIGGER.NAME&#125;默认信息：告警主机:&#123;HOSTNAME1&#125;告警时间:&#123;EVENT.DATE&#125; &#123;EVENT.TIME&#125;告警等级:&#123;TRIGGER.SEVERITY&#125;告警信息: &#123;TRIGGER.NAME&#125;告警项目:&#123;TRIGGER.KEY1&#125;问题详情:&#123;ITEM.NAME&#125;:&#123;ITEM.VALUE&#125;当前状态:&#123;TRIGGER.STATUS&#125;:&#123;ITEM.VALUE1&#125;事件ID:&#123;EVENT.ID&#125;报警已恢复，请放松心情。 测试告警关闭zabbix agent，测试邮件 ps:我用qq邮箱+授权码方式测试邮件，手动发送可以，系统提示发送成功，就是收不到，浪费了一天时间，坑好深！使用阿里云邮箱测试顺利！]]></content>
      <categories>
        <category>监控</category>
      </categories>
      <tags>
        <tag>zabbix</tag>
        <tag>监控</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Zabbix(2)监控客户端安装]]></title>
    <url>%2Farlo%2Fb6f2d4bf%2F</url>
    <content type="text"><![CDATA[linux 客户端安装安装客户端软件12rpm -ivh http://repo.zabbix.com/zabbix/3.4/rhel/7/x86_64/zabbix-release-3.4-2.el7.noarch.rpmyum install zabbix-agent 配置连接服务器信息vim /etc/zabbix/zabbix_agentd.conf123Server=192.168.6.103ServerActive=192.168.6.103Hostname=silu1 启动服务12systemctl start zabbix-agentsystemctl enable zabbix-agent 添加主机主机名称一定要和配置文件中的Hostname一致如果使用主动模式，这里的ip地址填写0.0.0.0 Windows 客户端安装安装windows 客户端下载客户端软件 https://www.zabbix.com/downloads/3.4.0/zabbix_agents_3.4.0.win.zip解压到C盘根目录 配置连接服务器信息C:\zabbix_agents_3.4.0.win\conf\zabbix_agentd.win.conf123Server=192.168.6.103ServerActive=192.168.6.103Hostname=silu2 注册服务1C:\&gt;c:\zabbix_agents_3.4.0.win\bin\win64\zabbix_agentd.exe -i -c c:\zabbix_agents_3.4.0.win\conf\zabbix_agentd.win.conf 启动服务使用以下命令启动1net start &quot;Zabbix Agent&quot; 或者在本地服务中启动 添加主机和linux方法以下，选择Windows模板即可]]></content>
      <categories>
        <category>监控</category>
      </categories>
      <tags>
        <tag>zabbix</tag>
        <tag>监控</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Zabbix(1)监控搭建]]></title>
    <url>%2Farlo%2F3b5e53af%2F</url>
    <content type="text"><![CDATA[Zabbix是一款能够监控各种网络参数以及服务器健康性、完整性的分布式监控软件；系统环境Centos 7.3.1611Selinux offIptables offFirewalld off软件环境Zabbix 3.4.2Httpd 2.4.6Php 5.4.16MariaDB 10.2.7 使用部署包安装zabbix安装zabbix server12rpm -ivh http://repo.zabbix.com/zabbix/3.4/rhel/7/x86_64/zabbix-release-3.4-2.el7.noarch.rpmyum install zabbix-server-mysql zabbix-web-mysql 配置数据库123456789101112yum -y install mariadb-server mariadbcp /usr/share/mysql/my-medium.cnf /etc/my.cnfsystemctl start mariadb.servicesystemctl enable mariadb.servicemysql_secure_installation#初始化数据库，设置root密码mysql -uroot -p&lt;password&gt;mysql&gt; create database zabbix character set utf8 collate utf8_bin;mysql&gt; grant all privileges on zabbix.* to zabbix@localhost identified by &apos;&lt;password&gt;&apos;;mysql&gt; quit;cd /usr/share/doc/zabbix-server-mysql-3.4.2zcat create.sql.gz | mysql -uroot zabbix -p 配置zabbix_server.conf参数vim /etc/zabbix/zabbix_server.conf1234DBHost=localhostDBName=zabbixDBUser=zabbixDBPassword=zabbix 启动Zabbix Server12systemctl start zabbix-serversystemctl enable zabbix-server 编辑Zabbix前端的PHP配置Zabbix前端的Apache配置文件位于 /etc/httpd/conf.d/zabbix.conf 。一些PHP设置已经完成了配置。1234567php_value max_execution_time 300php_value memory_limit 128Mphp_value post_max_size 16Mphp_value upload_max_filesize 2Mphp_value max_input_time 300php_value always_populate_raw_post_data -1php_value date.timezone Asia/Shanghai 启动httpd12systemctl start httpdsystemctl enable httpd 配置zabbix前端在浏览器中配置zabbixZabbix前端可以在浏览器中通过 http://zabbixserver/zabbix 进行访问。 确认所有php参数都设置ok 填写mysql数据库信息，用户名密码 确认所有配置信息正确 默认的用户名／密码为 Admin/zabbix 系统配置配置中文界面替换中文字体在Windows系统里找一个中文字体（华文楷体）C:\Windows\Fonts\STKAITI.TTF上传到zabbix服务器替换掉默认的字体/usr/share/fonts/dejavu/DejaVuSans.ttf 开启中文支持如果默认中文(zh_CN)支持被关闭，可以将zh_CN后边的false选项修改为true；12345678vim /usr/share/zabbix/include/locales.inc.phpfunction getLocales() &#123; return [ &apos;en_GB&apos; =&gt; [&apos;name&apos; =&gt; _(&apos;English (en_GB)&apos;), &apos;display&apos; =&gt; true], &apos;en_US&apos; =&gt; [&apos;name&apos; =&gt; _(&apos;English (en_US)&apos;), &apos;display&apos; =&gt; true], &apos;bg_BG&apos; =&gt; [&apos;name&apos; =&gt; _(&apos;Bulgarian (bg_BG)&apos;), &apos;display&apos; =&gt; false], &apos;zh_CN&apos; =&gt; [&apos;name&apos; =&gt; _(&apos;Chinese (zh_CN)&apos;), &apos;display&apos; =&gt; true],…… 在web界面修改用户资料、语言 启用zabbix server监控安装zabbix agent12yum install zabbix-agentsystemctl start zabbix-agent 在配置-主机中启用zabbix server CentOS 6.x 安装ZabbixCentOS 6.x 默认的php版本太低，需借助第三方源升级php;建议PHP≥5.4 MySql≥5.61234rpm -Uvh http://rpms.famillecollet.com/enterprise/remi-release-6.rpmyum -y install --enablerepo=remi --enablerepo=remi-php56 php php-opcache php-devel php-mbstring php-mcrypt php-mysqlnd php-phpunit-PHPUnit php-pecl-xdebug php-pecl-xhprof php-gd php-mysql php-bcmath php-ldaprpm -ql zabbix-web | grep example.confcp /usr/share/doc/zabbix-web-3.4.8/httpd22-example.conf /etc/httpd/conf.d/zabbix.conf 参考资料:https://www.zabbix.com/documentation/3.4/zh/manualhttp://www.rfyy.net/archives/1742.htmlhttps://www.zabbix.com/documentation/3.4/manual/installation/install_from_packages/rhel_centos]]></content>
      <categories>
        <category>监控</category>
      </categories>
      <tags>
        <tag>zabbix</tag>
        <tag>监控</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JDK环境变量配置]]></title>
    <url>%2Farlo%2F3f60947a%2F</url>
    <content type="text"><![CDATA[Windows我的jdk安装在 C:\Program Files\Java\jdk1.8.0_141 目录下，以下为配置过程：1.我的电脑-（右键）属性-高级系统设置-高级-环境变量2.系统变量-新建12变量名：JAVA_HOME变量值：C:\Program Files\Java\jdk1.8.0_141 12变量名：CLASSPATH变量值：%JAVA_HOME%\lib\tools.jar;%JAVA_HOME%\lib\dt.jar 12变量名：Path变量值：C:\Program Files (x86)\Intel\iCLS Client\;C:\Program Files\Intel\iCLS Client\;%SystemRoot%\system32;%SystemRoot%;%SystemRoot%\System32\Wbem;%SYSTEMROOT%\System32\WindowsPowerShell\v1.0\;C:\Program Files (x86)\Intel\OpenCL SDK\2.0\bin\x86;C:\Program Files (x86)\Intel\OpenCL SDK\2.0\bin\x64;C:\Program Files\Intel\Intel(R) Management Engine Components\DAL;C:\Program Files\Intel\Intel(R) Management Engine Components\IPT;C:\Program Files (x86)\Intel\Intel(R) Management Engine Components\DAL;C:\Program Files (x86)\Intel\Intel(R) Management Engine Components\IPT;E:\Program Files\TortoiseSVN\bin;%JAVA_HOME%\bin;%JAVA_HOME%\jre\bin Linux编辑/etc/profile 文件，在文件最后添加以下内容123export JAVA_HOME=/usr/local/jdk1.8.0_112/export CLASSPATH=.:$JAVA_HOME/lib/:$JAVA_HOME/jre/lib/export PATH=$JAVA_HOME/bin:$PATH source /etc/profile 保留系统以前自己配置的项，不要动！]]></content>
      <categories>
        <category>常识</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>常识</tag>
        <tag>Windows</tag>
        <tag>jdk</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[WindowsUpdate不能更新，错误提示8024402F解决方法]]></title>
    <url>%2Farlo%2Fe0a98909%2F</url>
    <content type="text"><![CDATA[Windows系统下WindowsUpdate不能更新了，显示的是8024402F错误。微软上看到了解决方法：使用以下DNS服务：首选DNS服务器：4.2.2.1备用DNS服务器：4.2.2.2使用以后马上见效果。]]></content>
      <categories>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>Windows</tag>
        <tag>更新</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Jenkins持续集成发布时tomcat不能删除目录下文件]]></title>
    <url>%2Farlo%2Ffd00fe8d%2F</url>
    <content type="text"><![CDATA[使用jenkins自动发布到tomcat时遇到一个问题，发布的时候不能自动删除tomcat下的工程目录，必须关闭tomcat之后，才能删除；提示如下1&quot;org.codehaus.cargo.container.tomcat.internal.TomcatManagerException: The Tomcat Manager responded &quot;FAIL - Unable to delete [C:\ths\Tomcat8082-alk\webapps\SuperStation]. The continued presence of this file may cause problems.&quot; 解决方法在元素中增加一个属性antiResourceLocking=”true” antiJARLocking=”true”，默认是”false”。1&lt;Context reloadable=&quot;true&quot; antiJARLocking=&quot;true&quot; antiResourceLocking=&quot;true&quot;&gt; 实际上，这两个参数就是配置Tomcat的资源锁定和Jar包锁定策略。 antiJARLocking先来看看应用的antiJARLocking属性设置为true时，Tomcat是怎么处理的。针对antiJARLocking属性的处理集中在WebappClassLoader的getResource和findResourceInternal方法里，主要原理是将包含在Jar包里的资源抽取放到应用的工作目录（work里应用对应的目录）下去。把这个属性设置为true之后，部署应用就可以在work\Catalina\localhost\struts2-blank\loader目录下看到被解压的Jar包内容。antiJARLocking属性在有的时候并不会生效，从WebappClassLoader的getResource和findResource方法逻辑里可以看出一些端倪，在一些情况下（通过对Loader的delegate、searchExternalFirst等相关属性进行配置），资源的获取并不是WebappClassLoader去做的，而是其父加载器的getResource方法或父类的findResource方法去做的，WebappClassLoader的父类是URLClassLoader、父加载器是URLClassLoader实例。 antiResourceLocking当antiResourceLocking设置为true的时候，Tomcat不会锁定应用下的任何文件。那Tomcat是怎么做到这一点的呢？在Tomcat的架构里，应用也是一个级别的容器，对应的接口是Context；各级容器本身都具备生命周期，而且配置了多个生命周期监听器来监听容器不同的生命周期过程。Tomcat在初始化的时候，给Context增加了一个生命周期监听器org.apache.catalina.startup.ContextConfig；然后在Context真正开始启动之前，会有一个BEFORE_START_EVENT状态，ContextConfig监听到这个状态的事件后，就会针对antiResourceLocking进行处理。总结一下，就是如果应用的antiResourceLocking属性设置为true，就将应用的doc base移到临时目录下，让Tomca不会占用webapps下的文件。Tomcat里java.io.tmpdir默认指向Tomcat的temp目录。 副作用从上面的分析来看，antiResourceLocking为true有几个副作用：1) 会延长应用的启动时间，因为多了临时目录的清理和往临时目录拷贝应用内容的操作；2) 如果不知道这个属性的原理，修改webapps下应用的JSP，那就不会动态重加载到新的页面内容了，因为应用的doc base已经不再在webapps下了；3) 停止Tomcat的时候，临时目录下实际的doc base会被删掉，结合第二条和第三条，如果要修改应用的JSP，那必须将改动同时拷贝到两个目录下（原始doc base和临时目录下的doc base）。所以Tomcat里这个属性缺省为false。在使用Tomcat 6.0.24之前的版本时，如果要用这个属性解决文件被锁的问题，三思而行。 参考链接：http://blog.csdn.net/yanjun008/article/details/41249753]]></content>
      <categories>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>自动化</tag>
        <tag>运维</tag>
        <tag>Jenkins</tag>
        <tag>tomcat</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux下如何拨VPN]]></title>
    <url>%2Farlo%2F350a96fc%2F</url>
    <content type="text"><![CDATA[由于公司的svn和maven仓库地址都在内网，使用Centos系统搭建持续集成的时候，没有办法访问服务器，又不想换Windows环境；于是想办法在linux下拨通vpn！ 安装vpn客户端1yum -y install pptp pptp-setup 创建一个vpn连接1pptpsetup --create pptpd --server SERVER_IP --username USERNAME --password PASSWORD --encrypt --start –create是创建的连接名称–server是vpn的ip地址;–username是用户名–password是密码，也可以没这个参数，命令稍后会自动询问。这样可以保证账号安全–encrypt 是表示需要加密，不必指定加密方式，命令会读取配置文件中的加密方式–start是表示创建连接完后马上连接 编辑配置文件创建vpn连接完成后，会有两个配置文件(ps:有域的情况下，配置文件中\需要写成\\)vim /etc/ppp/peers/pptpd12345678910# written by pptpsetuppty &quot;pptp 1.2.3.4 --nolaunchpppd&quot;locknoauthnobsdcompnodeflatename domain\\username remotename pptpdipparam pptpdrequire-mppe-128 vim /etc/ppp/chap-secrets12345# Secrets for authentication using CHAP# client server secret IP addresses# added by pptpsetup for pptpddomain\\username pptpd &quot;password&quot; * 复制开启\断开脚本123cp /usr/share/doc/ppp-2.4.5/scripts/pon /usr/sbin/cp /usr/share/doc/ppp-2.4.5/scripts/poff /usr/sbin/chmod +x /usr/sbin/pon /usr/sbin/poff pon vpnname 开启vpnpoff vpnname 断开vpn 尝试拨vpn1pon pptpd 查看连接情况1ip a 如果有异常的话，可以跟踪系统日志排查1tailf /var/log/messages 设置路由1route add -net 192.168.0.0/24 dev ppp0]]></content>
      <categories>
        <category>常识</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>常识</tag>
        <tag>vpn</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Jenkins邮件通知配置]]></title>
    <url>%2Farlo%2Fc26ec4ea%2F</url>
    <content type="text"><![CDATA[Jenkins环境搭建完成了,项目自动化编译打包也调通了，但是我们不能保证每次都是正常的，根据自己的情况(构建失败，构建状态不稳定)配置邮件通知是有必要的；这篇文章我采用腾讯qq邮箱来发送，使用公司邮箱来接收； 常用的几种方式 使用内置的邮件插进（使用全局的配置，只能有一个接收方） 使用邮件扩展插件【Email Extension Plugin】（使用全局的配置，能有多个接收方，但是只能有一个发送方） 使用邮件扩展插件【Email Extension Plugin】+Groovy脚本（实现每个Job对应不同的发送邮件，多个发送方） 开发邮件转发中间件或者使用Foxmail这些工具来转发（每个Job发送到对应的邮箱，然后中间件负责转发到成员列表的邮箱。对发送插件没什么要求，只要能发送即可）(这篇文章只说一下前两种方式) 使用QQ邮箱发送qq授权码设置参考：http://service.mail.qq.com/cgi-bin/help?subtype=1&amp;&amp;id=28&amp;&amp;no=1001256使用内置的邮件插件配置管理员邮件地址系统管理–&gt;系统设置–&gt;Jenkins Location配置邮件通知系统管理–&gt;系统设置–&gt;邮件通知–&gt;高级，配置如下：这里密码填写我们神的“qq授权码”测试邮件提醒勾选“通过发送测试邮件测试配置”看到“Email was successfully sent”即为成功，去邮箱里看一下使用邮件拓展插件系统管理–&gt;系统设置–&gt;Extended E-mail Notification邮件内容配置以下是参考网上的配置：12345678910111213141516171819Default Subject: 构建通知:$PROJECT_NAME - Build # $BUILD_NUMBER - $BUILD_STATUS! Default Content!Default Content:(本邮件是程序自动下发的，请勿回复！)&lt;br/&gt;&lt;hr/&gt;项目名称：$PROJECT_NAME&lt;br/&gt;&lt;hr/&gt;构建编号：$BUILD_NUMBER&lt;br/&gt;&lt;hr/&gt;svn版本号：$&#123;SVN_REVISION&#125;&lt;br/&gt;&lt;hr/&gt;构建状态：$BUILD_STATUS&lt;br/&gt;&lt;hr/&gt;触发原因：$&#123;CAUSE&#125;&lt;br/&gt;&lt;hr/&gt;构建日志地址：&lt;a href=&quot;$&#123;BUILD_URL&#125;console&quot;&gt;$&#123;BUILD_URL&#125;console&lt;/a&gt;&lt;br/&gt;&lt;hr/&gt;构建地址：&lt;a href=&quot;$BUILD_URL&quot;&gt;$BUILD_URL&lt;/a&gt;&lt;br/&gt;&lt;hr/&gt;变更集:$&#123;JELLY_SCRIPT,template=&quot;html&quot;&#125;&lt;br/&gt;&lt;hr/&gt; 全局属性详解Default Content Type：指定构建后发送邮件内容的类型，有Text和HTML两种。Use List-ID Email Header：为所有的邮件设置一个List-ID的邮件信头，这样你就可以在邮件客户端使用过滤。Add ‘Precedence: bulk’ Email Header：设置优先级。Default Recipients：自定义默认电子邮件收件人列表。如果没有被项目配置覆盖,该插件会使用这个列表。Reply To List：回复列表Emergency reroute：如果这个字段不为空，所有的电子邮件将被单独发送到该地址（或地址列表）。Excluded Committers：防止邮件被邮件系统认为是垃圾邮件,邮件列表应该没有扩展的账户名(如:@domain.com),并且使用逗号分隔。Default Subject：自定义邮件通知的默认主题名称。该选项能在邮件的主题字段中替换一些参数，这样你就可以在构建中包含指定的输出信息。Maximum Attachment Size：邮件最大附件大小。Default Pre-send Script：默认发送前执行的脚本。Enable Debug Mode：启用插件的调试模式。这将增加额外的日志输出，构建日志以及Jenkins的日志。在调试时是有用的，但不能用于生产。Enable Security：启用时，会禁用发送脚本的能力，直接进入Jenkins实例。如果用户试图访问Jenkins管理对象实例，将抛出一个安全异常。Content Token Reference：邮件中可以使用的变量，所有的变量都是可选的。具体介绍请查看全局邮件变量章节。 Job中邮件配置在构建后操作——”Add Post-build Actions”选项中勾选”Editable Email Notification”标签Project Recipient List：这是一个以逗号(或者空格)分隔的收件人邮件的邮箱地址列表。允许您为每封邮件指定单独的列表。Ps：如果你想在默认收件人的基础上添加收件人：$DEFAULT_RECIPIENTS,&lt;新的收件人&gt;Default Subject：允许你配置此项目邮件的主题。Default Content：跟Default Subject的作用一样，但是是替换邮件内容。Attach Build Log：附件构建日志。Compress Build Log before sending：发送前压缩生成日志（zip格式）。 添加触发器 查看构建失败日志 查看收件箱 参考链接：http://www.cnblogs.com/yangxia-test/p/4366172.html]]></content>
      <categories>
        <category>自动化运维</category>
      </categories>
      <tags>
        <tag>自动化</tag>
        <tag>运维</tag>
        <tag>Jenkins</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Jenkins打包不能发现本地仓库包]]></title>
    <url>%2Farlo%2Fd4636f97%2F</url>
    <content type="text"><![CDATA[jenkins里新建了一个maven风格的项目，打包过程中找不到ojdbc的包，然后手动下载，加载到本地仓库中了，jenkins依然提示找不到这个包。123[ERROR] Failed to execute goal on project atmosphere: Could not resolve dependencies for project com.ths:atmosphere:war:0.0.1-SNAPSHOT: Failure to find com.oracle:ojdbc14:jar:10.2.0.4.0 in https://repo.maven.apache.org/maven2 was cached in the local repository, resolution will not be reattempted until the update interval of central has elapsed or updates are forced -&gt; [Help 1]org.apache.maven.lifecycle.LifecycleExecutionException: Failed to execute goal on project atmosphere: Could not resolve dependencies for project com.ths:atmosphere:war:0.0.1-SNAPSHOT: Failure to find com.oracle:ojdbc14:jar:10.2.0.4.0 in https://repo.maven.apache.org/maven2 was cached in the local repository, resolution will not be reattempted until the update interval of central has elapsed or updates are forcedat org.apache.maven.lifecycle.internal.LifecycleDependencyResolver.getDependencies(LifecycleDependencyResolver.java:221) 手动加载jar包到本地仓库1/usr/local/apache-maven-3.3.9/bin/mvn install:install-file -DgroupId=com.oracle -DartifactId=ojdbc14 -Dversion=10.2.0.4.0 -Dpackaging=jar -Dfile=/usr/local/src/ojdbc14-10.2.0.4.0.jar 手动maven编译打包在工作目录下尝试手动编译打包，可以成功1/usr/local/apache-maven-3.3.9/bin/mvn compile install package 然后我茫然了，同一台机器，同一个版本的jdk，同一个版本的mvn，同一份代码；本地maven编译打包可以成功，通过jenkins调用maven打包就找不到ojdbc的包，失败了；容我喝杯白开水压压惊！我仔细排查了jenkins里边的配置，maven的全局配置使用的是默认的；maven版本和本地是一样的3.3.9；maven的仓库是默认地址~/.m2/repository;终于发现问题的所在了，原因就是maven的仓库是不一样的；本地执行maven编译打包使用的是root用户，仓库地址为/root/.m2/repository; jenkins程序是以jenkins用户启动起来的，默认的仓库地址为/var/lib/jenkins/.m2/repository/;我之前手动导入jar只导入到root用户下的仓库中了； 解决方法直接拷贝jar包到1cp /root/.m2/repository/com/oracle/ojdbc14/10.2.0.4.0/ojdbc14-10.2.0.4.0.jar /var/lib/jenkins/.m2/repository/com/oracle/ojdbc14/10.2.0.4.0/ojdbc14-10.2.0.4.0.jar 修改本地maven仓库的地址123vim $MAVEN_HOME/conf/settings.xml&lt;localRepository&gt;/path/.m2/repository&lt;/localRepository&gt; 扩展阅读maven仓库的优先级别：本地仓库 &gt;profile &gt; pom中的repository &gt; mirrorhttp://toozhao.com/2012/07/13/compare-priority-of-maven-repository/]]></content>
      <categories>
        <category>自动化运维</category>
      </categories>
      <tags>
        <tag>自动化</tag>
        <tag>运维</tag>
        <tag>Jenkins</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Tomcat启动慢原因排查]]></title>
    <url>%2Farlo%2Fd8e5626d%2F</url>
    <content type="text"><![CDATA[故障现象1Tomcat启动异常，卡在以下提示处123INFO: validateJarFile(/usr/local/apache-tomcat-7.0.79/webapps/thsbox/WEB-INF/lib/tomcat-servlet-api-8.5.15.jar) - jar not loaded. See Servlet Spec 3.0, section 10.7.2. Offending class: javax/servlet/Servlet.classAug 17, 2017 2:36:19 PM org.apache.catalina.startup.TldConfig executeINFO: At least one JAR was scanned for TLDs yet contained no TLDs. Enable debug logging for this logger for a complete list of JARs that were scanned but no TLDs were found in them. Skipping unneeded JARs during scanning can improve startup time and JSP compilation time. 关闭TLDs1234567vim /usr/local/apache-tomcat-7.0.79/conf/context.xml&lt;Context processTlds=&quot;false&quot;&gt; &lt;!-- Default set of monitored resources --&gt; &lt;WatchedResource&gt;WEB-INF/web.xml&lt;/WatchedResource&gt; ……&lt;/Context&gt; 屏蔽jar包1234vim /usr/local/apache-tomcat-7.0.79/conf/catalina.propertiestomcat.util.scan.StandardJarScanFilter.jarsToSkip=\tomcat-servlet-api-8.5.15.jar 更改以上两个地方，日志还是会打印出来，启动还是卡主 故障现象2起初以为是启动不起来了，后来一直等着，发现只是很慢，可以启动起来的,在7分钟左右1INFO: Server startup in 432720 ms 跟踪日志有重大发现1WARNING: Creation of SecureRandom instance for session ID generation using [SHA1PRNG] took [422,085] milliseconds 第一种修改方法1234vim /usr/local/jdk1.8.0_112/jre/lib/security/java.security#securerandom.source=file:/dev/randomsecurerandom.source=file:/dev/./random 修改完成后INFO: Server startup in 118722 ms(还是慢) 第二种修改方法123vim /usr/local/apache-tomcat-7.0.79/bin/catalina.sh修改第232行JAVA_OPTS=&quot;$JAVA_OPTS $JSSE_OPTS -Djava.security.egd=file:/dev/./urandom&quot; 修改完成后INFO: Server startup in 8985 ms 参考：http://www.cnblogs.com/raphael5200/p/6844510.html]]></content>
      <tags>
        <tag>tomcat</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Lustre文件系统部署]]></title>
    <url>%2Farlo%2Fc6d9ba0c%2F</url>
    <content type="text"><![CDATA[软件下载https://downloads.hpdd.intel.com/public/lustre/https://downloads.hpdd.intel.com/public/e2fsprogs/1.42.7.wc1/http://mirror.symnds.com/software/zfsonlinux/repo/epel-testing/6/x86_64/ldiskfsprogs-1.42.7.wc1.3chaos-7.ch5.1.1.x86_64.rpm 查看lustre版本和操作系统对应关系参考：https://wiki.hpdd.intel.com/display/PUB/Lustre+Support+Matrix 2.4以后的版本支持多个mds查看lustre版本lctl get_param version &lt;未完待续&gt; 参考文档：http://www.google.com.pg/patents/CN102169448A?cl=zhhttp://cdn.opensfs.org/wp-content/uploads/2014/10/6-LUG-Inspur-WWWrevised.pdf]]></content>
      <categories>
        <category>HPC</category>
      </categories>
      <tags>
        <tag>Lustre</tag>
        <tag>文件系统</tag>
        <tag>分布式</tag>
        <tag>集群</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Lustre文件系统简介]]></title>
    <url>%2Farlo%2Fab1d26cf%2F</url>
    <content type="text"><![CDATA[Lustre是一款开源的，基于对象存储的集群并行分布式文件系统，具有很高的扩展性、可用性、易用性、性能等，在高性能计算中应用很广泛，世界十大超级计算中心当中的七个以及超过50%的全球top50超级计算机都在使用Lustre。可以支持上万个节点，数以PB的数量存储系统。从1999年lustre项目起，他的版权所有者就在不断的变换，从lustre项目组到Sun公司到Oracle再到Whamclound，最终被因特尔收购。基于对象的文件系统将文件的元数据和文件数据分离开来，存储在不同的服务器上。文件系统的客户用利用元数据服务器和对象存储服务器来为用户提供一个完整的文件系统抽象。基于对象的文件系统具有性能优势，文件系统客户通过对象存储服务器来访问文件内容，而元数据服务器只有在文件打开时才需要连接。 Lustre文件系统包括三种主要的功能单元元数据服务器MDS(Metadata Server)元数据服务器（metadata servers，MDSes）。一个Lustre文件系统通常拥有两个元数据服务器（active和standby），一个元数据服务器则拥有若干元数据目标（metadata targets，MDTs）。元数据目标存储名字空间元数据：文件名、目录、访问权限、文件结构等信息。不同于诸如GPFS和PanFS等基于块并由元数据服务器控制所有块分配的分布式文件系统，Lustre元数据服务器仅仅关心路径搜索和权限检查而不会牵涉任何的文件I/O操作。该特性避免元数据服务器成为集群扩展的瓶颈。单个文件系统拥有多个元数据目标是从2.4开始引入的新特性。 对象存储服务器OSS(Object Storage Server)对象存储服务器（object storage servers，OSSes）将文件数据存储于一个或多个对象存储目标（object storage targets，OSTs）中。取决于服务器硬件，一个对象存储服务器通常有二到八个对象存储目标，每个对象存储目标管理一个本地文件系统。Lustre文件系统的空间等于所有对象存储目标的容量总和。 客户端Client客户机（Clients）能访问并使用数据。Lustre为所有客户机提供统一的命名空间。Lustre支持多种网络类型，包括Infiniband，Omni-Path，以太网等。如果远程直接内存访问（RDMA）传输可用，Lustre将利用它提高吞吐量降低CPU使用率。 参考链接：https://zh.wikipedia.org/wiki/Lustrehttps://www.ibm.com/developerworks/cn/linux/l-ofs/index.htmlhttp://blog.csdn.net/fsdev/article/details/7310975http://mp.weixin.qq.com/s/QvBEU6yebkChMPNmcCZrWQ]]></content>
      <categories>
        <category>HPC</category>
      </categories>
      <tags>
        <tag>Lustre</tag>
        <tag>文件系统</tag>
        <tag>分布式</tag>
        <tag>集群</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Mariadb(MHA)高可用集群搭建]]></title>
    <url>%2Farlo%2F49c257f9%2F</url>
    <content type="text"><![CDATA[MHA（Master High Availability）目前在MySQL高可用方面是一个相对成熟的解决方案，它由日本DeNA公司youshimaton（现就职于Facebook公司）开发，是一套优秀的作为MySQL高可用性环境下故障切换和主从提升的高可用软件。在MySQL故障切换过程中，MHA能做到在0~30秒之内自动完成数据库的故障切换操作，并且在进行故障切换的过程中，MHA能在最大程度上保证数据的一致性，以达到真正意义上的高可用。该软件由两部分组成：MHA Manager（管理节点）和MHA Node（数据节点）。MHA Manager可以单独部署在一台独立的机器上管理多个master-slave集群，也可以部署在一台slave节点上。MHA Node运行在每台MySQL服务器上，MHA Manager会定时探测集群中的master节点，当master出现故障时，它可以自动将最新数据的slave提升为新的master，然后将所有其他的slave重新指向新的master。整个故障转移过程对应用程序完全透明。 在MHA自动故障切换过程中，MHA试图从宕机的主服务器上保存二进制日志，最大程度的保证数据的不丢失，但这并不总是可行的。例如，如果主服务器硬件故障或无法通过ssh访问，MHA没法保存二进制日志，只进行故障转移而丢失了最新的数据。使用MySQL 5.5的半同步复制，可以大大降低数据丢失的风险。MHA可以与半同步复制结合起来。如果只有一个slave已经收到了最新的二进制日志，MHA可以将最新的二进制日志应用于其他所有的slave服务器上，因此可以保证所有节点的数据一致性。目前MHA主要支持一主多从的架构，要搭建MHA,要求一个复制集群中必须最少有三台数据库服务器，一主二从，即一台充当master，一台充当备用master，另外一台充当从库，因为至少需要三台服务器，出于机器成本的考虑，淘宝也在该基础上进行了改造，目前淘宝TMHA已经支持一主一从。 MHA工作原理总结为以下几条： 从宕机崩溃的master保存二进制日志事件（binlog events）; 识别含有最新更新的slave; 应用差异的中继日志(relay log) 到其他slave; 应用从master保存的二进制日志事件(binlog events); 提升一个slave为新master; 使用其他的slave连接新的master进行复制。 配置基础环境mysql主充复制集群搭建mha的环境是基于mysql主从复制环境上搭建的，主从复制请参考http://islocal.cc/2017/07/26/Mariadb主从复制集群/ ，本文搭建的为一主三从环境 配置互相无密码验证配置hosts复制到到其他几台机器12345cat /etc/hosts192.168.6.126 mysql_a #从库 #node192.168.6.127 mysql_b #主库 #node192.168.6.128 mysql_c #备用主库 #node192.168.6.102 vm02 #从库 #manager mysql_a1234ssh-keygen ssh-copy-id mysql_bssh-copy-id mysql_csssh-copy-id vm02 mysql_b1234ssh-keygen ssh-copy-id mysql_assh-copy-id mysql_csssh-copy-id vm02 mysql_c1234ssh-keygen ssh-copy-id mysql_assh-copy-id mysql_bssh-copy-id vm02 vm021234ssh-keygen ssh-copy-id mysql_assh-copy-id mysql_bssh-copy-id mysql_c mysql 配置建立mysql用户，赋予权限在3台mysql服务器上分别新建mha用户，并授权1234MariaDB [test_repl]&gt; grant all privileges on *.* to &apos;mha&apos;@&apos;mysql_a&apos; identified by &apos;222222&apos;;MariaDB [test_repl]&gt; grant all privileges on *.* to &apos;mha&apos;@&apos;mysql_b&apos; identified by &apos;222222&apos;;MariaDB [test_repl]&gt; grant all privileges on *.* to &apos;mha&apos;@&apos;mysql_c&apos; identified by &apos;222222&apos;;MariaDB [test_repl]&gt; grant all privileges on *.* to &apos;mha&apos;@&apos;vm02&apos; identified by &apos;222222&apos;; 修改mysql参数在2台slave上修改12mysql -e &apos;set global read_only=1&apos;mysql -uroot -pffffff -e &apos;show slave status\G&apos;|egrep &apos;Slave_IO|Slave_SQL&apos; 安装mha manager安装mha manager123456[root@vm02 src]# yum install perl-DBD-MySQL perl-Config-Tiny perl-Log-Dispatch perl-Parallel-ForkManager perl-Time-HiRes -y[root@vm02 src]# cd mha4mysql-manager-0.56/[root@vm02 mha4mysql-manager-0.56]# perl Makefile.PL [root@vm02 mha4mysql-manager-0.56]# make &amp;&amp; make install[root@vm02 ~]# cp /usr/local/src/mha4mysql-manager-0.56/samples/scripts/master_ip_failover /usr/local/bin/[root@vm02 ~]# cp /usr/local/src/mha4mysql-manager-0.56/samples/scripts/master_ip_online_change /usr/local/bin/ 主配置文件123456789101112131415161718192021222324252627282930313233343536373839[server default]user=mhapassword=222222ping_interval=1remote_workdir=/tmprepl_user=replrepl_password=111111ssh_user=rootmanager_workdir=/var/log/masterha/app1manager_log=/var/log/masterha/app1/manager.logmaster_binlog_dir= /var/lib/mysql/master_ip_failover_script= /usr/local/bin/master_ip_failovermaster_ip_online_change_script= /usr/local/bin/master_ip_online_changereport_script=/usr/local/send_reportsecondary_check_script= /usr/local/bin/masterha_secondary_check -s mysql_b -s mysql_c --master_host=mysql_b --master_ip=192.168.6.127 --master_port=3306shutdown_script=&quot;&quot;[server1]hostname=mysql_bport=3306[server2]master_binlog_dir=/var/lib/mysqlhostname=mysql_cport=3306candidate_master=1check_repl_delay=0[server3]master_binlog_dir=/var/lib/mysqlhostname=mysql_aport=3306[server4]master_binlog_dir=/var/lib/mysqlhostname=vm02port=3306 安装mha node1234# yum install perl-ExtUtils-CBuilder perl-ExtUtils-MakeMaker perl-DBD-MySQL [root@mysql_a mha4mysql-node-0.56]# ansible mysql -a &apos;perl Makefile.PL chdir=/usr/local/src/mha4mysql-node-0.56/&apos;[root@mysql_a mha4mysql-node-0.56]# ansible mysql -a &apos;make chdir=/usr/local/src/mha4mysql-node-0.56/&apos;[root@mysql_a mha4mysql-node-0.56]# ansible mysql -a &apos;make install chdir=/usr/local/src/mha4mysql-node-0.56/&apos; 测试ssh连通性123456789101112131415161718192021[root@vm02 ~]# masterha_check_ssh --conf=/etc/mastermha/app1.cnfWed Aug 2 17:12:59 2017 - [warning] Global configuration file /etc/masterha_default.cnf not found. Skipping.Wed Aug 2 17:12:59 2017 - [info] Reading application default configurations from /etc/mastermha/app1.cnf..Wed Aug 2 17:12:59 2017 - [info] Reading server configurations from /etc/mastermha/app1.cnf..Wed Aug 2 17:12:59 2017 - [info] Starting SSH connection tests..Wed Aug 2 17:13:00 2017 - [debug] Wed Aug 2 17:13:00 2017 - [debug] Connecting via SSH from root@mysql_a(192.168.6.126:22) to root@mysql_b(192.168.6.127:22)..Wed Aug 2 17:13:00 2017 - [debug] ok.Wed Aug 2 17:13:00 2017 - [debug] Connecting via SSH from root@mysql_a(192.168.6.126:22) to root@mysql_c(192.168.6.128:22)..Wed Aug 2 17:13:00 2017 - [debug] ok.Wed Aug 2 17:13:01 2017 - [debug] Wed Aug 2 17:13:00 2017 - [debug] Connecting via SSH from root@mysql_b(192.168.6.127:22) to root@mysql_a(192.168.6.126:22)..Wed Aug 2 17:13:00 2017 - [debug] ok.Wed Aug 2 17:13:00 2017 - [debug] Connecting via SSH from root@mysql_b(192.168.6.127:22) to root@mysql_c(192.168.6.128:22)..Wed Aug 2 17:13:00 2017 - [debug] ok.Wed Aug 2 17:13:01 2017 - [debug] Wed Aug 2 17:13:01 2017 - [debug] Connecting via SSH from root@mysql_c(192.168.6.128:22) to root@mysql_a(192.168.6.126:22)..Wed Aug 2 17:13:01 2017 - [debug] ok.Wed Aug 2 17:13:01 2017 - [debug] Connecting via SSH from root@mysql_c(192.168.6.128:22) to root@mysql_b(192.168.6.127:22)..Wed Aug 2 17:13:01 2017 - [debug] ok.Wed Aug 2 17:13:01 2017 - [info] All SSH connection tests passed successfully. 测试主从复制1[root@vm02 ~]# masterha_check_repl --conf=/etc/mastermha/app1.cnf 报错1234Thu Aug 3 17:10:16 2017 - [info] MHA::MasterMonitor version 0.56.Thu Aug 3 17:10:18 2017 - [error][/usr/local/share/perl5/MHA/MasterMonitor.pm, ln401] Error happend on checking configurations. Use of uninitialized value in string eq at /usr/local/share/perl5/MHA/Server.pm line 236.Thu Aug 3 17:10:18 2017 - [error][/usr/local/share/perl5/MHA/MasterMonitor.pm, ln500] Error happened on monitoring servers.Thu Aug 3 17:10:18 2017 - [info] Got exit code 1 (Not master dead). 解决方法还没找到，所以就卡在这里了，网上也没找到有效的解决方法；好悲催，有知道的可以知道我一下，联系方式关于里边有；我怀疑是不是因为我mha0.56和Mariadb10.2.7版本不匹配，或者Mariadb太新导致的；先放一放，后期找到解决方法了再处理吧。 参考：http://www.cnblogs.com/gomysql/p/3675429.html]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>集群</tag>
        <tag>数据库</tag>
        <tag>Mariadb</tag>
        <tag>Mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Mariadb 读写分离集群搭建]]></title>
    <url>%2Farlo%2Fb48c6366%2F</url>
    <content type="text"><![CDATA[基础环境配置iptables: disabledselinux: disabled|系统 |主机名 |IP地址 |角色 ||CentOS 7.2 x64 |mysql_a |192.168.6.126 |Atlas代理服务 ||CentOS 7.2 x64 |mysql_b |192.168.6.127 |Mysql主服务器 ||CentOS 7.2 x64 |mysql_c |192.168.6.128 |Mysql 从服务器| 在mysql_a上安装ansible123456[root@mysql_a ~]# yum -y install epel-release[root@mysql_a ~]# yum -y install ansible[root@mysql_a ~]# vim /etc/ansible/hosts[mysql]mysql_bmysql_c 建立无密码通信123[root@mysql_a ~]# ssh-keygen -t rsa[root@mysql_a ~]# ssh-copy-id -i ~/.ssh/id_rsa.pub mysql_b[root@mysql_a ~]# ssh-copy-id -i ~/.ssh/id_rsa.pub mysql_c 保持服务器时间同步123[root@mysql_a ~]# ansible mysql -a &apos;timedatectl set-timezone Asia/Shanghai&apos;[root@mysql_a ~]# ansible mysql -a &apos;timedatectl set-ntp true&apos;[root@mysql_a ~]# ansible mysql -a &apos;ntpdate cn.ntp.org.cn&apos; 配置三台服务器的hosts12345cat /etc/hosts192.168.6.126 mysql_a192.168.6.127 mysql_b192.168.6.128 mysql_c[root@mysql_a ~]# ansible mysql -m copy -a &apos;src=/etc/hosts dest=/etc/hosts&apos; 搭建Mariadb(mysql)主从复制配置Mariadb yum源12345678[root@mysql_a ~]# vim /etc/yum.repos.d/MariaDB.repo# MariaDB 10.2 CentOS repository list - created 2017-07-27 03:36 UTC# http://downloads.mariadb.org/mariadb/repositories/[mariadb]name = MariaDBbaseurl = http://yum.mariadb.org/10.2/centos7-amd64gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDBgpgcheck=1 安装Mariadb(mysql)123[root@mysql_a ~]# ansible mysql -m copy -a &apos;src=/etc/yum.repos.d/MariaDB.repo dest=/etc/yum.repos.d/MariaDB.repo&apos;[root@mysql_a ~]# ansible mysql -m yum -a &apos;name=MariaDB-server state=installed&apos;[root@mysql_a ~]# ansible mysql -m yum -a &apos;name=MariaDB-client state=installed&apos; Ps：也可以下载以下几个rpm包，使用yum localinstall *.rpm 进行安装（速度会快一些）1234567[root@mysql_b mariadb]# lltotal 171204-rw-r--r-- 1 root root 8353220 Aug 1 13:56 galera-25.3.20-1.rhel7.el7.centos.x86_64.rpm-rw-r--r-- 1 root root 50251656 Aug 1 09:46 MariaDB-10.2.7-centos7-x86_64-client.rpm-rw-r--r-- 1 root root 158012 Aug 1 09:46 MariaDB-10.2.7-centos7-x86_64-common.rpm-rw-r--r-- 1 root root 2975776 Aug 1 09:46 MariaDB-10.2.7-centos7-x86_64-compat.rpm-rw-r--r-- 1 root root 113565340 Aug 1 09:46 MariaDB-10.2.7-centos7-x86_64-server.rpm 拷贝模板配置文件1[root@mysql_a ~]# ansible mysql -a &apos;cp /usr/share/mysql/my-medium.cnf /etc/my.cnf&apos; 各服务器上执行初始化操作mysql_secure_installation 修改mysql_b配置文件1234567vim /etc/my.cnflog-bin=/var/lib/mysql/mysql-binbinlog_format=rowserver-id = 127sync_binlog = 1innodb_support_xa = 1innodb-flush-log-at-trx-commit=1 建立授权账号123456789[root@mysql_b mariadb]# mysql -uroot -pffffffMariaDB [mysql]&gt; grant replication slave on *.* to &apos;repl&apos;@&apos;192.168.6.%&apos; identified by &apos;111111&apos;;MariaDB [(none)]&gt; show master status;+------------------+----------+--------------+------------------+| File | Position | Binlog_Do_DB | Binlog_Ignore_DB |+------------------+----------+--------------+------------------+| mysql-bin.000002 | 342 | | |+------------------+----------+--------------+------------------+1 row in set (0.00 sec) 修改mysql_c配置文件12345vim /etc/my.cnfbinlog_format=rowserver-id = 128replicate-ignore-db=mysqlrelay_log=relay-bin 重启两台Mariadb(mysql)服务1[root@mysql_a ~]# ansible mysql -a &apos;systemctl restart mariadb.service&apos; 开启主从同步12345[root@mysql_c mysql]# mysql -uroot –pffffffMariaDB [(none)]&gt; stop slave;MariaDB [(none)]&gt; change master to master_host=&apos;mysql_b&apos;, master_user=&apos;repl&apos;, master_password=&apos;111111&apos;,master_log_file=&apos;mysql-bin.000002&apos;,master_log_pos=342;MariaDB [(none)]&gt; start slave;MariaDB [(none)]&gt; show slave status\G Atlas安装配置安装Mariadb(Mysql)客户端123[root@mysql_a mariadb]# yum install MariaDB-client[root@mysql_a mariadb]# systemctl status mariadb.service //确保Atlas本机没有mysql服务被启动Unit mariadb.service could not be found. 安装atlas下载的时候有两个软件包带分片功能的Atlas-sharding 和Atlas，我们下后边这个（el6的包centos7可以安装）12[root@mysql_a src]# axel https://github.com/Qihoo360/Atlas/releases/download/2.2.1/Atlas-2.2.1.el6.x86_64.rpm[root@mysql_a src]# rpm -ivh Atlas-2.2.1.el6.x86_64.rpm 安装目录为/usr/local/mysql-proxy/，会在此目录下生成bin,conf,lib,log四个目录 生成一个加密字符串，配置文件中会用到12[root@mysql_a bin]# ./encrypt 111111kOVJsquUepY= 修改配置文件360团队很良心，中文注释很详细12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758[root@mysql_a bin]# vim /usr/local/mysql-proxy/conf/test.cnf[mysql-proxy]#带#号的为非必需的配置项目#管理接口的用户名admin-username = nsxq#管理接口的密码admin-password = ffffff#Atlas后端连接的MySQL主库的IP和端口，可设置多项，用逗号分隔proxy-backend-addresses = 192.168.6.127:3306#Atlas后端连接的MySQL从库的IP和端口，@后面的数字代表权重，用来作负载均衡，若省略则默认为1，可设置多项，用逗号分隔proxy-read-only-backend-addresses = 192.168.6.128:3306@1#用户名与其对应的加密过的MySQL密码，密码使用PREFIX/bin目录下的加密程序encrypt加密，下行的user1和user2为示例，将其替换为你的MySQL的用户名和加密密码！pwds = atlas:kOVJsquUepY=#设置Atlas的运行方式，设为true时为守护进程方式，设为false时为前台方式，一般开发调试时设为false，线上运行时设为true,true后面不能有空格。daemon = true#设置Atlas的运行方式，设为true时Atlas会启动两个进程，一个为monitor，一个为worker，monitor在worker意外退出后会自动将其重启，设为false时只有worker，没有monitor，一般开发调试时设为false，线上&gt;运行时设为true,true后面不能有空格。keepalive = true#工作线程数，对Atlas的性能有很大影响，可根据情况适当设置event-threads = 8#日志级别，分为message、warning、critical、error、debug五个级别log-level = message#日志存放的路径log-path = /usr/local/mysql-proxy/log#SQL日志的开关，可设置为OFF、ON、REALTIME，OFF代表不记录SQL日志，ON代表记录SQL日志，REALTIME代表记录SQL日志且实时写入磁盘，默认为OFF#sql-log = OFF#慢日志输出设置。当设置了该参数时，则日志只输出执行时间超过sql-log-slow（单位：ms)的日志记录。不设置该参数则输出全部日志。#sql-log-slow = 10#实例名称，用于同一台机器上多个Atlas实例间的区分#instance = test#Atlas监听的工作接口IP和端口proxy-address = 0.0.0.0:1234 #分表设置，此例中person为库名，mt为表名，id为分表字段，3为子表数量，可设置多项，以逗号分隔，若不分表则不需要设置该项#tables = person.mt.id.3#默认字符集，设置该项后客户端不再需要执行SET NAMES语句#charset = utf8#允许连接Atlas的客户端的IP，可以是精确IP，也可以是IP段，以逗号分隔，若不设置该项则允许所有IP连接，否则只允许列表中的IP连接#client-ips = 127.0.0.1, 192.168.1#Atlas前面挂接的LVS的物理网卡的IP(注意不是虚IP)，若有LVS且设置了client-ips则此项必须设置，否则可以不设置#lvs-ips = 192.168.1.1 启动Atlas服务12345[root@mysql_a bin]# ./mysql-proxyd test start[root@mysql_a mariadb]# ps -ef |grep mysqlroot 21456 1 0 15:24 ? 00:00:00 /usr/local/mysql-proxy/bin/mysql-proxy --defaults-file=/usr/local/mysql-proxy/conf/test.cnfroot 21457 21456 0 15:24 ? 00:00:00 /usr/local/mysql-proxy/bin/mysql-proxy --defaults-file=/usr/local/mysql-proxy/conf/test.cnfroot 21607 20025 0 15:35 pts/0 00:00:00 grep --color=auto mysql 通过Atlas访问通过管理接口访问1[root@mysql_a mariadb]# mysql -h127.0.0.1 -P2345 -unsxq –pffffff 通过工作接口访问123要保证这个用户在主从节点上都有权限，在主从节点上都添加一个用户MariaDB [mysql]&gt; grant all on *.* to atlas@&apos;192.168.6.%&apos; identified by &apos;111111&apos;;[root@mysql_a mariadb]# mysql -h127.0.0.1 -P1234 -uatlas -p111111 参考连接：https://github.com/Qihoo360/Atlas/wikihttp://www.cnblogs.com/yyhh/p/5084844.html]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>数据库</tag>
        <tag>Mariadb</tag>
        <tag>Mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Mariadb主从复制集群]]></title>
    <url>%2Farlo%2Ffe63d61c%2F</url>
    <content type="text"><![CDATA[Centos7系统中将Mysql置换为Mariadb了；Mariadb是Mysql数据库被Oracle公司收购之后Mysql之前的开发者基于mysql开发的开源数据库，完全兼容mysql；更详细的纠葛请自行google。Mysql的主从复制是指从服务器向主服务器索取二进制binlog文件，在从服务器上把日志文件重新执行，从而获取主服务器数据，保证从服务器和主服务器的数据保持同步。但由于是异步的复制，从服务器在一定程度上落后于主服务器，刚写入到主服务器上的数据可能服务在从服务器上查询得到。 复制原理过程 从服务器创建I/O线程连接主数据库，向主数据请库服务器求二进制日志文件（binlog） 主服务器上启动Binlog Dump,将二进制日志文件发送给I/O线程，I/O线程获取数据后将数据卸载从库的中继日志中（relay log） SQL线程读取中继日志并执行 日志方式 statement：基于语句级别的binlog，记录修改数据的sql语句。 row： 基于行级别的binlog逐行记录数据的变更。 mixed：由Mysql数据库自动选择哪种方式记录binlog。raw格式下日志文件会很大，会影响磁盘的I/O,在传输过程中也会影响带宽，根据情况自行选择。 集群环境搭建系统：Centos7 x64软件：Mariadb 10.2 stable 保持服务器时间同步123timedatectl set-timezone Asia/Shanghaitimedatectl set-ntp truentpdate cn.ntp.org.cn 安装Mariadb软件配置yum源参考https://downloads.mariadb.org/mariadb/repositories/vim /etc/yum.repos.d/MariaDB.repo1234567# MariaDB 10.2 CentOS repository list - created 2017-07-27 03:36 UTC# http://downloads.mariadb.org/mariadb/repositories/[mariadb]name = MariaDBbaseurl = http://yum.mariadb.org/10.2/centos7-amd64gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDBgpgcheck=1 安装1yum -y install MariaDB-server MariaDB-client 启动服务，并设置开机启动12systemctl start mariadb.servicesystemctl enable mariadb.service 初始化服务器1234可以初始化过程中设置密码mysql_secure_installation也可以进入数据库后设置密码update user set password=PASSWORD(&quot;SOME_ROOT_PASSWORD&quot;) where User=&apos;root&apos;; 配置主服务器将以下配置添加到my.cnf中[mysqld]下123456server-id=102 #服务器ID号(取值范围为1到2的32次方-1的整数，建议使用ip地址最后一位，保持唯一性),写成server_id 不生效log-bin=/var/lib/mysql/mariadb-bin #二进制文件存放位置binlog_format=row #日志类型为rawsync_binlog = 1 #事务一提交，就将二进制日志同步至磁盘上innodb_support_xa = 1 #支持分布式事务innodb-flush-log-at-trx-commit=1 #针对innodb的设置 给slave开相应的权限1GRANT REPLICATION SLAVE ON *.* TO ‘repl’@‘192.168.6.103’ IDENTIFIED BY ‘123456’; 配置从服务器将以下配置添加到my.cnf中[mysqld]下1234server-id=103 #服务器ID号(取值范围为1到2的32次方-1的整数，建议使用ip地址最后一位，保持唯一性)read_only = 1 #从服务器为只读状态（确保数据的一致性）log-bin=/var/lib/mysql/mariadb-bin #中继日志存放目录 replicate-ignore-db=mysql #不需要同步的数据库（忽略的库最好配置在slave上，让master有最全的binlog） Mysql版本从5.1.7以后开始就不支持“master-host”类似的参数；在从库上执行如下命令；123change master to master_host=&apos;192.168.6.102&apos;, master_user=&apos;repl&apos;, master_password=&apos;123456&apos;; #好像不需要master_log_file和master_log_pos也可以;slave start;show slave status\G #查看同步状态 测试在主服务器上新建数据库，建表，插入数据;在从库上查询；1234567891011mysql -uroot -pffffffMariaDB [(none)]&gt; create database test_repl;MariaDB [(none)]&gt; use test_repl;MariaDB [test_repl]&gt; CREATE TABLE Persons (PersonID int,LastName varchar(255),FirstName varchar(255),Address varchar(255),City varchar(255));MariaDB [test_repl]&gt; INSERT INTO Persons VALUES (1, &quot;LastName1&quot;, &quot;FirstName1&quot;, &quot;Address1&quot;, &quot;City1&quot;); 在从库上查询；123mysql -uroot -pffffffMariaDB [(none)]&gt; use test_repl;MariaDB [test_repl]&gt; select * from Persons; 可以在主库上看到连接的从库信息（一主多从很有用）1234567MariaDB [test_repl]&gt; show slave hosts;+-----------+------+------+-----------+| Server_id | Host | Port | Master_id |+-----------+------+------+-----------+| 3 | | 3306 | 1 |+-----------+------+------+-----------+1 row in set (0.00 sec) 问题记录Q1：Q：Got fatal error 1236 from master when reading data from binary log: ‘Could not find first log file name in binary log index file’A：123MariaDB [test_repl]&gt; stop slave;MariaDB [test_repl]&gt; reset slave;MariaDB [test_repl]&gt; start slave; Q2:Q:Could not execute Update_rows event on table mysql.user; Can’t find record in ‘user’, Error_code: 1032; handler error HA_ERR_KEY_NOT_FOUND; the event’s master log mariadb-bin.000003, end_log_pos 1749A:12345678MariaDB [test_repl]&gt; stop slave; Query OK, 0 rows affected (0.00 sec)MariaDB [test_repl]&gt; set global sql_slave_skip_counter=1; Query OK, 0 rows affected (0.00 sec)MariaDB [test_repl]&gt; start slave;Query OK, 0 rows affected (0.01 sec) Q3：Q：Last_SQL_Errno: 1146Last_SQL_Error: Unable to load replication GTID slave state from mysql.gtid_slave_pos: Table ‘mysql.gtid_slave_pos’ doesn’t existA:主从的版本是一样是，不清楚为什么会出现这样的问题，使用mysql_upgrade升级修复了一下好了；1mysql_upgrade -uroot -pffffff 扩展阅读Mysql默认的复制是异步的，Mysql(5.5以后版本)半同步复制 参考链接：https://linux.cn/article-5491-1.htmlhttp://joelhy.github.io/2015/02/06/mariadb-master-slave-replication/http://www.cnblogs.com/gomysql/p/3662492.html]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>数据库</tag>
        <tag>Mariadb</tag>
        <tag>Mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux下多线程下载工具Axel]]></title>
    <url>%2Farlo%2F1a27e5da%2F</url>
    <content type="text"><![CDATA[Linux 平台下默认的下载工具是wget，可在慢速或不稳定的网络连接下保持健壮性，如果由于网络问题下载失败，它将继续重试，直到整个文件下载完成；但是wget不支持多线程下载，这里推荐一个axel，可实现对同一个文件建立多个连接，每个连接下载单独的文件片段以更快地完成下载，支持HTTP,HTTPS,FTP,FTPS协议； 安装源码安装下载地址https://sourceforge.net/projects/axel2/files/ 包管理器安装看教程说epel源中带有这个工具，但是我Centos 6.8 没发现；于是自已下载一个rpm包安装，推荐下载地址 http://pkgs.org/ 使用基本用法如下：1alex [选项][下载目录][下载地址] 参数如下：1234567-s 指定每秒下载最大的比特数（如限速为512KB/s，设置为 -s 512000）-n 指定同时打开的下载线程数 (如指定10个线程，设置为 -n 10)-o 指定下载路径（如下载到/tmp目录，设置为 -o /tmp；也可以指定下载后的文件名，如下载后文件名为test.tgz,设置为 -o /tmp/test.tgz）-S 搜索镜像，并下载-v 打印更多状态信息-a 打印简洁的进度信息-q 不显示下载进度 实例1axel -n 10 -a -o /tmp ftp://ftpprd.ncep.noaa.gov/pub/data/nccf/com/gfs/prod/enkf.20170724/12/gdas.t12z.atmf009s.mem011.nemsio 断点续传如果下载过程中下载中断可以再执行下载命令即可恢复上次的下载进度。axel 默认具有恢复未完成的下载的行为。Axel 在下载文件时定期更新状态文件（扩展名为 .st）。由于某些原因，下载中途停止了？不用担心，只要使用相同的 axel 命令，它将会检查 file 和 file.st，如果找到，它会从停止处恢复下载。 参考：http://man.linuxde.net/axel]]></content>
      <categories>
        <category>常识</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>常识</tag>
        <tag>下载</tag>
        <tag>axel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Intel编译器(parallel_studio_xe)安装]]></title>
    <url>%2Farlo%2Fe5fb788a%2F</url>
    <content type="text"><![CDATA[软件环境CentOS 7.2 x64parallel_studio_xe_2013_update2_intel64.tgzintel_eval.lic 安装安装依赖环境1[root@vm00 ~]# yum -y install libstdc++.so.5 gcc-c++ 开始安装123[root@vm00 src]# tar xf parallel_studio_xe_2013_update2_intel64[root@vm00 src]# cd parallel_studio_xe_2013_update2_intel64[root@vm00 parallel_studio_xe_2013_update2_intel64]# ./install.sh 初始化，欢迎界面-——————————————————————————-Initializing, please wait…-——————————————————————————- Step no: 1 of 7 | Welcome-——————————————————————————-Welcome to the Intel(R) Parallel Studio XE 2013 Update 2 for Linux* installationprogram. -——————————————————————————-You will complete the steps below during this installation:Step 1 : WelcomeStep 2 : LicenseStep 3 : ActivationStep 4 : Intel(R) Software Improvement ProgramStep 5 : OptionsStep 6 : InstallationStep 7 : Complete-——————————————————————————-Press “Enter” key to continue or “q” to quit: 回车-——————————————————————————-Checking the prerequisites. It can take several minutes. Please wait…-——————————————————————————- 提示不支持的操作系统，跳过即可Step no: 1 of 7 | Options &gt; Missing Optional Pre-requisite(s)-——————————————————————————-There are one or more optional unresolved issues. It is highly recommended toresolve them all before you continue the installation. You can fix them withoutexiting from the installation and re-check. Or you can quit from theinstallation, fix them and run the installation again.-——————————————————————————-Missing optional pre-requisites– Intel(R) Composer XE 2013 Update 2 for Linux*: unsupported OS-——————————————————————————- Skip missing optional pre-requisites [default] Show the detailed info about issue(s) Re-check the pre-requisites h. Helpb. Back to the previous menuq. Quit-——————————————————————————-Please type a selection or press “Enter” to accept default choice [1]: 回车 接受条约，输入acceptStep no: 2 of 7 | License-——————————————————————————-As noted in the Intel(R) Software Development Product End User LicenseAgreement, the Intel(R) Software Development Product you install will send Intelthe products serial number and other system information to help Intel improvethe product and validate license compliance. No personal information will betransmitted.-——————————————————————————-To continue with the installation of this product you are required to acceptthe terms and conditions of the End User License Agreement (EULA). The EULAis displayed using the “more” utility. Press the spacebar to advance to thenext page or enter “q” to skip to the end. After reading the EULA, you mustenter “accept” to continue the installation or “decline” to return to theprevious menu.-——————————————————————————-IMPORTANT - READ BEFORE COPYING, INSTALLING OR USING.Do not copy, install, distribute, public display, or use the Materials providedunder this license agreement (“Agreement”), until you have carefully read thefollowing terms and conditions. By copying, installing, distributing, publicly displaying, or otherwise usingthe Materials, you agree to be bound by the terms of this Agreement.If you do not agree to the terms of this Agreement, do not copy,install, distribute, publicly display, or use the Materials. End User License Agreement for the Intel(R) Software Development Products(Version May 2012) LICENSE DEFINITIONS: A. “Materials” are defined as the software, documentation, license keycodes (if applicable) and other materials, including any updates and upgradethereto, that are provided to you under this Agreement. Materials alsoinclude the Redistributables, Cluster OpenMP Library, and Sample Sourceas defined below. B. “Redistributables” are the files listed in the following text files thatmay be included in the Materials for the applicable Intel Software DevelopmentProduct: clredist.txt, credist.txt, fredist.txt, redist.txt, redist-rt.txt. C. “Cluster OpenMP Library”, is comprised of the files listed in the“clredist.txt” file specified above, is the Intel(R) Cluster OpenMP Libraryadd-on option to the Intel(R) C++ Compiler for Linux andIntel(R) Fortran Compiler for Linux* products (“Intel Compiler for Linux”).The use of the Cluster OpenMP Library is conditioned on having a valid licensefrom Intel for the Cluster OpenMP Library and for either Intel(R) C++ Compilerfor Linux or Intel(R) Fortran Compiler for Linux, and further is governed by theterms and conditions of the license agreement for applicable the Intel Compilerfor Linux. D. “Source Code” is defined as the Materials provided in human readableformat, and includes modification that you make or are made on your behalf. E. “Sample Source” is the Source Code file(s) that: (i) demonstrate certainlimited functions included in the binary libraries of the Intel(R) IntegratedPerformance Primitives (“Intel(R) IPPs”); (ii) are identified as Intel IPPsample source code; (iii) are obtained separately from Intel after you registeryour copy of the Intel(R) IPPs product with Intel; and (iv) are subject to allof the terms and conditions of this Agreement. F. “Microsoft Platforms” means any current and future Microsoft operatingsystem products, Microsoft run-time technologies (such as the .NET Framework),and Microsoft application platforms(such as Microsoft Office or Microsoft Dynamics) that Microsoft offers. LICENSE GRANT: A. Subject to all of the terms and conditions of this Agreement,Intel Corporation (“Intel”) grants to you a non-exclusive, non-assignable,copyright license to use the Materials. B. Subject to all of the terms and conditions of this Agreement, Intelgrants to you a non-exclusive, non-assignable copyright license to modify theMaterials, or any portions thereof, that are (i) provided in Source Code formor, (ii) are defined as Redistributables and are provided in text form. C. Subject to all of the terms and conditions of this Agreement and anyspecific restrictions which may appear in the Redistributables text files, Intelgrants to you a non-exclusive, non-assignable, fully-paid copyright license todistribute (except if you received the Materials under an Evaluation Licenseas specified below) the Redistributables, including any modifications pursuantto Section 2.B, or any portions thereof, as part of the product or applicationyou developed using the Materials. If such application is a softwaredevelopment library, then attribution, as specified in the product release notesof the corresponding Materials shall be displayed prominently in that product’sor application’s associated documentation and on the product or application’sweb site (if any). LICENSE RESTRICTIONS: A. If you receive your first copy of the Materials electronically, and asecond copy on media, then you may use the second copy only in accordance withyour applicable license stated in this Agreement, or for backup or archivalpurposes. You may not provide the second copy to another user. B. You may NOT: (i) use, copy, distribute, or publicly display theMaterials except as provided in this Agreement; (ii) rent or lease the Materialsto any third party; (iii) assign this Agreement or transfer the Materialswithout the express written consent of Intel; (iv) modify, adapt, or translatethe Materials in whole or in part except as provided in this Agreement;(v) reverse engineer, decompile, or disassemble the Materials; (vi) attempt tomodify or tamper with the normal function of a license manager that regulatesusage of the Materials; (vii) distribute, sublicense or transfer the SourceCode form of any components of the Materials or derivatives thereof to any thirdparty except as provided in this Agreement; (viii) distribute Redistributablesexcept as part of a larger program that adds significant primary functionalitydifferent from that of the Redistributables; (ix) distribute theRedistributables to run on a platform other than a Microsoft Platform if per theaccompanying user documentation the Materials are meant to execute only on aMicrosoft Platform; (x) include the Redistributables in malicious, deceptive,or unlawful programs; or (xi) modify or distribute the Source Code of anyRedistributable so that any part of it becomes subject to an Excluded License.An “Excluded License” is one that requires, as a condition of use, modification,or distribution, that the licensed software or other software incorporated into,derived from or distributed with such software (a) be disclosed or distributedin Source Code form; (b) be licensed by the user to third parties for thepurpose of making and/or distributing derivative works;or (c) be redistributable at no charge. Open source software includes, withoutlimitation, software licensed or distributed under any of thefollowing licenses or distribution models, or licenses or distribution modelssubstantially similar to any of the following: (a) GNU’s General Public License(GPL) or Lesser/Library GPL (LGPL), (b) the Artistic License (e.g., PERL),(c) the Mozilla Public License, (d) the Netscape Public License, (e) the SunCommunity Source License (SCSL), (f) the Sun Industry Source License (SISL),and (g) the Common Public License (CPL). C. The scope and term of your license depends on the type of license youare provided by Intel. The variety of license types are set forth below, whichmay not be available for all “Intel(R) Software Development Products” andtherefore may not apply to the Materials. For more information on the types oflicenses, please contact Intel or your sales representative. i. PRE-RELEASE LICENSE: If you are using the Materials under the controlof a pre-release license, (a) the Materials are deemed to be pre-release code(e.g., alpha or beta release, etc), which may not be fully functional and whichIntel may substantially modify in development of a commercial version, and forwhich Intel makes no assurances that it will ever develop or make generallyavailable a commercial version, and (b) if you are an individual, you have theright to use the Materials only for the duration of the pre-release term, whichis specified in the Materials, or until the commercial release, if any, of theMaterials, whichever is shorter. You may install copies of the Materials on anunlimited number of computers provided that you are the only individual usingthe Materials and only one copy of the Materials is in use at any one time.A separate license is required for each additional use and/or individual userin all other cases, including without limitation, use by persons, computersystems, and other use methods known now and in the future. If you are anentity, Intel grants you the right to designate one individual within yourorganization to have the sole right to use the Materials in the mannerspecified provided above. ii. EVALUATION LICENSE: If you are using the Materials under the controlof an evaluation license, you as an individual may use the Materials only forinternal evaluation purposes and only for the term of the evaluation, whichmay be controlled by the license key code for the Materials.NOTWITHSTANDING ANYTHING TO THE CONTRARY ELSEWHERE IN THISAGREEMENT, YOU MAY NOT DISTRIBUTE ANY PORTION OF THE MATERIALS, AND THEAPPLICATION AND/OR PRODUCT DEVELOPED BY YOU MAY ONLY BE USED FOREVALUATION PURPOSES AND ONLY FOR THE TERM OF THE EVALUATION. You mayinstall copies of the Materials on a reasonable number of computers to conductyour evaluation provided that you are the only individual using the Materialsand only one copy of the Materials is in use at any one time. A separatelicense is required for each additional use and/or individual user in all othercases, including without limitation, use by persons, computer systems, and otheruse methods known now and in the future. Intel may provide you with a licensecode key that enables the Materials for an evaluation license. If you are anentity, Intel grants you the right to designate one individual within yourorganization to have the sole right to use the Materials in the mannerprovided above. iii. NONCOMMERCIAL-USE LICENSE: If you are using the Materials under thecontrol of a noncommercial-use license, if you are an individual, you as anindividual may use the Materials only for non-commercial use where you receiveno fee, salary or any other form of compensation. The Materials may not be usedfor any other purpose, whether “for profit” or “not for profit.” Any workperformed or produced as a result of use of the Materials cannot be performedor produced for the benefit of other parties for a fee, compensation or anyotherreimbursement or remuneration. You may install copies of the Materials on anunlimited number of computers provided that you are the only individual usingthe Materials and only one copy of the Materials is in use at any one time.A separate license is required for each additional use and/or individual userin all other cases, including without limitation, use by persons, computersystems, and other methods of use known now and in the future. Intel willprovide you with a license code key that enables the Materials for anoncommercial-use license. If you obtained a time-limited noncommercial-uselicense, the duration (time period) of your license and your ability to use theMaterials is limited to the time period of the obtained license, which iscontrolled by the license key code for the Materials. If you are an entity,Intel grants you the right to designate one individual within your organizationto have the sole right to use the Materials in the manner provided above. iv. SINGLE-USER LICENSE: If you are using the Materials under the controlof a single-user license, you as an individual may install and use the Materialson an unlimited number of computers provided that you are the only individualusing the Materials and only one copy of the Materials is in use at any onetime. A separate license is required for each additional use and/or individualuser in all other cases, including without limitation, use by persons, computersystems, and other methods of use known now and in the future. Intel willprovide you with a license code key that enables the Materials for a single-userlicense. If you obtained a time-limited single-user license, the term of yourlicense and your ability to use the Materials is limited to the specified timeperiod, which is controlled by the license key code for the Materials. If youare an entity, Intel grants you the right to designate one individual withinyour organization to have the sole right to use the Materials in the mannerprovided above. v. NODE-LOCKED LICENSE: If you are using the Materials under the control of a node-locked license, you may use the Materials only on a single designatedcomputer by no more than the authorized number of concurrent users. A separatelicense is required for each additional concurrent user and use, and/or computersystems in all other cases, including without limitation, use by persons,computer systems, and other methods of use known now and in the future. Intelwill provide you with a license code key that enables the Materials for a Node-Locked license up to the authorized number of concurrent users. If you obtaineda time-limited node-locked license, the term of your license and your ability touse the Materials is limited to the specified time, which is controlled by thelicense key code for the Materials. vi. FLOATING LICENSE: If you are using the Materials under the control of afloating license, you may (a) install the Materials on an unlimited number ofcomputers that are connected to the designated network and (b) use the Materialby no more than the authorized number of concurrent individual users.A separate license is required for each additional concurrent individual userand each additional use by a computer system and/or network on which theMaterials are used. You understand that you must obtain a separate license forevery and any use of the Materials under a floating license, regardless ofwhether such use is, without limitation, by persons, computer systems, and othermethods of use known now and in the future. Intel will provide you with alicense code key that enables the Materials for a floating license up to theauthorized number of concurrent users. If you obtained a time-limited Floatinglicense, the duration (time period) of your license and your ability to use theMaterials is limited to the time period of the obtained license, which iscontrolled by the license key code for the Materials. Intel Library FloatingLicense: If the Materials are the Intel(R) Math Kernel Library or the Intel(R)Integrated Performance Primitives Library or the Intel(R) Threading BuildingBlocks (either “Intel Library”), then the Intel Library is provided to you as anadd-on option to either the Intel(R) C++ Compiler product or the Intel(R)Fortran Compiler product (either, an “Intel Compiler”) for which you have aFloating license, and as such, in addition to the terms and conditions above,the Intel Library may only be used by the authorized concurrent users (as notedabove) of that Intel Compiler Floating license. D. DISTRIBUTION: Distribution of the Redistributables is also subject tothe following limitations: You (i) shall be solely responsible to yourcustomers for any update or support obligation or other liability which mayarise from the distribution, (ii) shall not make any statement that your productis “certified”, or that its performance is guaranteed, by Intel, (iii) shall notuse Intel’s name or trademarks to market your product without writtenpermission, (iv) shall use a license agreement that prohibits disassembly andreverse engineering of the Redistributables, (v) shall indemnify, hold harmless,and defend Intel and its suppliers from and against any claims or lawsuits,including attorney’s fees, that arise or result from your distribution ofany product. E. Intel(R) Integrated Performance Primitives (Intel IPP). The followingterms and conditions apply only to the Intel IPP. i. Notwithstanding anything in this Agreement to the contrary, if youimplement the Sample Sources in your application or if you use Intel IPP toimplement algorithms that are protected by others’ licenses then you may needadditional licenses from various entities. Should any such additional licensesbe required, you are solely responsible for obtaining any such licenses andagree to obtain any such licenses at your own expense. ii. Notwithstanding anything herein to the contrary, a valid license toIntel IPP is a prerequisite to any license for Sample Source, and possession ofSample Source does not grant any license to Intel IPP (or any portion thereof).To access Sample Source, you must first register your licensed copy of the IntelIPP with Intel. By downloading, installing or copying any Sample Source file,you agree to be bound by terms of this Agreement. F. SOFTWARE TRANSFER: Except for Pre-Release Licenses or EvaluationLicenses or Non-Commercial Licenses, as specified above, you may permanentlytransfer the Materials you received pursuant to a license type listed inSection 3(C) above, and all of your rights under this Agreement, to anotherparty (“Recipient”) solely in conjunction with a change of ownership, merger,acquisition, sale or transfer of all, substantially all or any part of yourbusiness or assets or otherwise, either voluntarily, by operation of law ofotherwise subject to the following: You must notify Intel of the transfer bysending a letter to Intel (i) identifying the legal entities of Recipient andyou, (ii) identifying the Materials (i.e., the specific Intel software products)and the associated serial numbers to be transferred, (iii) certifying that youretain no copies of the Materials, (iv) certifying that the Recipient has agreedin writing to be bound by all of the terms and conditions of this Agreement, (v)certifying that the Recipient has been notified that in order to receive supportfrom Intel for the Materials they must notify Intel in writing of the transferand provide Intel with the information specified in subsection (ii) above alongwith the name and email address of the individual assigned to use the Materials,and (vi) providing your email address so that we may confirm receipt of yourletter. Please send such letter to: Intel Corporation2111 NE 25th AvenueHillsboro, OR 97124Attn: DPD Contracts Management, JF1-15 COPYRIGHT: Title to the Materials, modifications thereto provided byIntel and all copies thereof remain with Intel or its suppliers. The Materialsare protected by intellectual property rights, including without limitation,United States copyright laws and international treaty provisions. You will notremove any copyright or other proprietary notice from the Materials. You agreeto prevent any unauthorized copying of the Materials. Except as expresslyprovided herein, no license or right is granted to you directly or byimplication, inducement, estoppel or otherwise; specifically Intel does notgrant any express or implied right to you under Intel patents, copyrights,trademarks, or trade secrets. NO WARRANTY, NO SUPPORT AND LIMITED REPLACEMENT: THE MATERIALS ANDINFORMATION ARE PROVIDED “AS IS” WITH NO WARRANTIES, EXPRESS OR IMPLIED. INTELSPECIFICALLY DISCLAIMS ANY AND ALL WARRANTIES, INCLUDING WITHOUT LIMITATION,ANY IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE,NON-INFRINGEMENT OF INTELLECTUAL PROPERTY RIGHTS, OR ANY WARRANTY OTHERWISEARISING OUT OF ANY PROPOSAL, SPECIFICATION, OR SAMPLE. If the media on whichthe Materials are furnished are found to be defective in material or workmanshipunder normal use for a period of ninety (90) days from the date of receipt,Intel’s entire liability and your exclusive remedy shall be the replacement ofthe media. This offer is void if the media defect results from accident, abuse,or misapplication. Intel may make changes to the Materials, or to items referenced therein, at anytime without notice, but is not obligated to support, update or provide trainingfor the Materials. Intel may in its sole discretion offer such support, updateor training services under separate terms at Intel’s then-current rates. You mayrequest additional information on Intel’s service offerings from an Intel salesrepresentative. LIMITATION OF LIABILITY: NEITHER INTEL NOR ITS SUPPLIERS SHALL BELIABLE FOR ANY DAMAGES WHATSOEVER (INCLUDING, WITHOUT LIMITATION, DAMAGES FORLOSS OF BUSINESS PROFITS, BUSINESS INTERRUPTION, LOSS OF BUSINESS INFORMATION,OR OTHER LOSS) ARISING OUT OF THE USE OF OR INABILITY TO USE THE SOFTWARE, EVENIF INTEL HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES. BECAUSE SOMEJURISDICTIONS PROHIBIT THE EXCLUSION OR LIMITATION OF LIABILITY FORCONSEQUENTIAL OR INCIDENTAL DAMAGES, THE ABOVE LIMITATION MAY NOT APPLY TOYOU. UNAUTHORIZED USE: THE MATERIALS ARE NOT DESIGNED, INTENDED, ORAUTHORIZED FOR USE IN ANY TYPE OF SYSTEM OR APPLICATION IN WHICH THE FAILURE OFTHE MATERIALS COULD CREATE A SITUATION WHERE PERSONAL INJURY OR DEATH MAY OCCUR(e.g., MEDICAL SYSTEMS, LIFE SUSTAINING OR LIFE SAVING SYSTEMS). Should youuse the Materials for any such unintended or unauthorized use, you herebyindemnify, defend, and hold Intel and its officers, subsidiaries and affiliatesharmless against all claims, costs, damages, and expenses, and reasonableattorney fees arising out of, directly or indirectly, such use and any claim ofproduct liability, personal injury or death associated with such unintended orunauthorized use, even if such claim alleges that Intel was negligent regardingthe design or manufacture of the Materials. USER SUBMISSIONS: This Agreement does not obligate you to provide Intelwith materials, information, comments, suggestions or other communicationregarding the Materials. However, you agree that any material, information,comments, suggestions or other communication you transmit or post to an Intelwebsite (including but not limited to, submissions to the Intel Premier Supportand/or other customer support websites or online portals) or provide to Intelunder this Agreement related to the features, functions, performance or useof the Materials are deemed non-confidential and non-proprietary(“Communications”). Intel will have no obligations with respect to theCommunications. You hereby grant to Intel a non-exclusive, perpetual,irrevocable, royalty-free, copyright license to copy, modify, create derivativeworks, publicly display, disclose, distribute, license and sublicense throughmultiple tiers of distribution and licensees, incorporate and otherwise use theCommunications and all data, images, sounds, text, and other things embodiedtherein, including derivative works thereto, for any and all commercial ornon-commercial purposes. You are prohibited from posting or transmitting to orfrom an Intel website or provide to Intel any unlawful, threatening, libelous,defamatory, obscene, pornographic, or other material that would violate any law.If you wish to provide Intel with information that you intend to be treated asconfidential information, Intel requires that such confidential information beprovided pursuant to a non-disclosure agreement (“NDA”), so please contact yourIntel representative to ensure the proper NDA is in place. Nothing in this Agreement will be construed as preventing Intel from reviewingyour Communications and errors or defects in Intel products discovered whilereviewing your Communications. Furthermore, nothing in this Agreement will beconstrued as preventing Intel from implementing independently-developedenhancements to Intel’s own error diagnosis methodology to detect errors ordefects in Intel products discovered while reviewing your Communications or toimplement bug fixes or enhancements in Intel products. The foregoing may includethe right to include your Communications in regression test suites. CONSENT. You agree that Intel, its subsidiaries or suppliers maycollect and use technical and related information, including but not limited totechnical information about your computer, system and application software, andperipherals, that is gathered periodically to facilitate the provision ofsoftware updates, product support and other services to you (if any) related tothe Materials, and to verify compliance with the terms of this Agreement. Intelmay use this information, as long as it is in a form that does not personallyidentify you, to improve our products or to develop and provide services ortechnologies to you. TERMINATION OF THIS LICENSE: This Agreement becomes effective on thedate you accept this Agreement and will continue until terminated as providedfor in this Agreement. If you are using the Materials under the control of atime-limited license, for example an Evaluation License, this Agreementterminates without notice on the last day of the time period, which is specifiedin the Materials, and/or controlled by the license key code for the Materials.Intel may terminate this license immediately if you are in breach of any of itsterms and conditions and such breach is not cured within thirty (30) days ofwritten notice from Intel. Upon termination, you will immediately return toIntel or destroy the Materials and all copies thereof. In the event oftermination of this Agreement, the license grant to any Redistributablesdistributed by you in accordance with the terms and conditions of thisAgreement, prior to the effective date of such termination, shall survive anysuch termination of this Agreement U.S. GOVERNMENT RESTRICTED RIGHTS: The technical data and computersoftware covered by this license is a “Commercial Item,” as such term is definedby the FAR 2.101 (48 C.F.R. 2.101) and is “commercial computer software” and“commercial computer software documentation” as specified under FAR 12.212(48 C.F.R. 12.212) or DFARS 227.7202 (48 C.F.R. 227.7202), as applicable. Thiscommercial computer software and related documentation is provided to end usersfor use by and on behalf of the U.S. Government, with only those rights as aregranted to all other end users pursuant to the terms and conditions herein. Usefor or on behalf of the U.S. Government is permitted only if the party acquiringor using this software is properly authorized by an appropriate U.S. Governmentofficial. This use by or for the U.S. Government clause is in lieu of, andsupersedes, any other FAR, DFARS, or other provision that addresses Governmentrights in the computer software or documentation covered by this license. Allcopyright licenses granted to the U.S. Government are coextensive with thetechnical data and computer software licenses granted herein. The U.S.Government shall only have the right to reproduce, distribute, perform, display,and prepare derivative works as needed to implement those rights. GENERAL PROVISIONS A. ENTIRE AGREEMENT: This Agreement is intended to be the entire agreementbetween you and Intel with respect to matters contained herein, and supersedesall prior or contemporaneous agreements and negotiations with respect to thosematters. No waiver of any breach or default shall constitute a waiver of anysubsequent breach or default. If any provision of this Agreement is determinedby a court to be unenforceable, you and Intel will deem the provision to bemodified to the extent necessary to allow it to be enforced to the extentpermitted by law, or if it cannot be modified, the provision will be severed anddeleted from this Agreement, and the remainder of the Agreement will continue ineffect. Any change, modification or waiver to this Agreement must be in writingand signed by an authorized representative of you and an officer (or delegate)of Intel, and must specifically identify this Agreement by its title (e.g.,“End User License Agreement for the Intel(R) Software Development Products”) andversion, i.e., May 2012). B. APPLICABLE LAWS: Any claim arising under or relating to this Agreementshall be governed by the internal substantive laws of the State of Delaware,without regard to principles of conflict of laws. You agree that the terms ofthe United Nations Convention on Contracts for the Sale of Goods do not applyto this Agreement. You agree that your distribution and export/re-export of theSoftware and permitted modifications shall be in compliance with the laws,regulations, orders or other restrictions of applicable export laws. THIRD PARTY PROGRAMS. The Materials may include third party programsor materials that are governed by the third party’s license terms, includingwithout limitation, open source software. The license terms associated withsuch third party programs or materials govern your use of same, and Intel isnot liable for such third party programs or materials. Other names and brands may be claimed as the property of others -——————————————————————————-Do you agree to be bound by the terms and conditions of this license agreement?Type “accept” to continue or “decline” to back to the previous menu: accept 选择激活方式，选择4使用激活文件Step no: 3 of 7 | Activation-——————————————————————————-If you have purchased this product and have the serial number and a connectionto the internet you can choose to activate the product at this time. Activationis a secure and anonymous one-time process that verifies your software licensingrights to use the product. Alternatively, you can choose to evaluate theproduct or defer activation by choosing the evaluate option. Evaluation softwarewill time out in about one month. Also you can use license file, licensemanager, or remote activation if the system you are installing on does nothave internet access activation options.-——————————————————————————- Use existing license [default] I want to activate my product using a serial number I want to evaluate my product or activate later I want to activate either remotely, or by using a license file, or by using alicense manager h. Helpb. Back to the previous menuq. Quit-——————————————————————————-Please type a selection or press “Enter” to accept default choice [1]: 4 指定license文件Step no: 3 of 7 | Activation &gt; Advanced activation-——————————————————————————-You can use license file, license manager, or the system you are installing ondoes not have internet access activation options.-——————————————————————————- Use a different computer with internet access [default] Use a license file Use a license server h. Helpb. Back to the previous menuq. Quit-——————————————————————————-Please type a selection or press “Enter” to accept default choice [1]: 2Note: Press “Enter” key to back to the previous menu.Please type the full path to your license file(s):/root/intel_eval.lic-——————————————————————————-Activation completed successfully.-——————————————————————————-Press “Enter” key to continue: 回车 是否加入改进，2为不加入Step no: 4 of 7 | Intel(R) Software Improvement Program-——————————————————————————-Help improve your experience with Intel(R) software Participate in the design of future Intel software. Select ‘Yes’ to give uspermission to learn about how you use your Intel software and we will do therest. - No Personal contact information is collected - There are no surveys or additional follow-up emails by opting in - You can stop participating at any time Learn more about Intel(R) Software Improvement Program http://software.intel.com/en-us/articles/software-improvement-program With your permission, Intel may automatically receive anonymous informationabout how you use your current and future Intel software.-——————————————————————————- Yes, I am willing to participate and improve Intel software. (Recommended) No, I don’t want to participate in the Intel(R) Software Improvement Programat this time. b. Back to the previous menuq. Quit-——————————————————————————-Please type a selection: 2 最后一次确认安装路径，可修改Step no: 5 of 7 | Options-——————————————————————————-You are now ready to begin installation. You can use all default installationsettings by simply choosing the “Start installation Now” option or you cancustomize these settings by selecting any of the change options given belowfirst. You can view a summary of the settings by selecting“Show pre-install summary”.-——————————————————————————- Start installation Now Change install directory [ /opt/intel ] Change components to install [ Custom ] Change advanced options Show pre-install summary h. Helpb. Back to the previous menuq. Quit-——————————————————————————-Please type a selection or press “Enter” to accept default choice [1]: 回车 检测安装环境，跳过即可Step no: 5 of 7 | Options &gt; Missing Optional Pre-requisite(s)-——————————————————————————-There are one or more optional unresolved issues. It is highly recommended toresolve them all before you continue the installation. You can fix them withoutexiting from the installation and re-check. Or you can quit from theinstallation, fix them and run the installation again.-——————————————————————————-Missing optional pre-requisites– Intel(R) Composer XE 2013 Update 2 for Linux: No compatible Java RuntimeEnvironment (JRE) found-——————————————————————————- Skip missing optional pre-requisites [default] Show the detailed info about issue(s) Re-check the pre-requisites h. Helpb. Back to the previous menuq. Quit-——————————————————————————-Please type a selection or press “Enter” to accept default choice [1]: 回车 开始安装Step no: 6 of 7 | Installation-——————————————————————————-Each component will be installed individually. If you cancel the installation,components that have been completely installed will remain on your system. Thisinstallation may take several minutes, depending on your system and the optionsyou selected.-——————————————————————————-Installing Intel Debugger 13.0 on Intel(R) 64 component… done-——————————————————————————-Finalizing installation… done-——————————————————————————- 安装完成Step no: 7 of 7 | Complete-——————————————————————————-Thank you for installing and using theIntel(R) Parallel Studio XE 2013 Update 2 for Linux* Reminder: Intel(R) VTune(TM) Amplifier XE users must be members of the “vtune”permissions group in order to use Event-based Sampling. To register your product purchase, visithttps://registrationcenter.intel.com/RegCenter/registerexpress.aspx?media=5G9 To get started using Intel(R) VTune(TM) Amplifier XE 2013 Update 4: - To set your environment variables: source /opt/intel/vtune_amplifier_xe_2013/amplxe-vars.sh - To start the graphical user interface: amplxe-gui - To use the command-line interface: amplxe-cl - For more getting started resources: /opt/intel/vtune_amplifier_xe_2013/ documentation/en/welcomepage/get_started.html. To get started using Intel(R) Inspector XE 2013 Update 4: - To set your environment variables: source /opt/intel/inspector_xe_2013/inspxe-vars.sh - To start the graphical user interface: inspxe-gui - To use the command-line interface: inspxe-cl - For more getting started resources: /opt/intel/inspector_xe_2013/ documentation/en/welcomepage/get_started.html. To get started using Intel(R) Advisor XE 2013 Update 2: - To set your environment variables: source /opt/intel/advisor_xe_2013/advixe-vars.sh - To start the graphical user interface: advixe-gui - To use the command-line interface: advixe-cl - For more getting started resources: /opt/intel/advisor_xe_2013/ documentation/en/welcomepage/get_started.html. To get started using Intel(R) Composer XE 2013 Update 2 for Linux*: - Set the environment variables for a terminal window using one of the following (replace &quot;intel64&quot; with &quot;ia32&quot; if you are using a 32-bit platform). For csh/tcsh: $ source /opt/intel/bin/compilervars.csh intel64 For bash: $ source /opt/intel/bin/compilervars.sh intel64 To invoke the installed compilers: For C++: icpc For C: icc For Fortran: ifort To get help, append the -help option or precede with the man command. - For more getting started resources: /opt/intel/composer_xe_2013/Documentation/en_US/get_started_lc.htm. /opt/intel/composer_xe_2013/Documentation/en_US/get_started_lf.htm. To view movies and additional training, visithttp://www.intel.com/software/products. -——————————————————————————-q. Quit [default]-——————————————————————————-Please type a selection or press “Enter” to accept default choice [q]: 回车 设置环境变量12[root@vm00 parallel_studio_xe_2013_update2_intel64]# source /opt/intel/bin/compilervars.sh intel64将此行内容加入到/etc/profile中，否则重启后失效 验证安装的正确性12[root@vm00 parallel_studio_xe_2013_update2_intel64]# icc -vicc version 13.1.0 (gcc version 4.4.7 compatibility) 参考链接：http://www.cnblogs.com/iDove/p/4103231.html]]></content>
      <categories>
        <category>HPC</category>
      </categories>
      <tags>
        <tag>Intel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Centos7下Rsync服务器搭建配置]]></title>
    <url>%2Farlo%2F98679d8a%2F</url>
    <content type="text"><![CDATA[之前写了个Windows下oracle多用户自动备份的脚本，这个备份完数据还是存在服务器本地的，如果系统宕机的话，数据还是没有了，这样的备份是没有意义滴；所以我们需要把数据转移到其他的存储上，常用的方式是使用Rsync工具来保持同步数据，接下来我们搭建一个简单的Rsync服务器。 安装部署rsync服务器1234[root@sftp_server ~]# yum -y install rsync[root@sftp_server ~]# mkdir -p /etc/rsyncd/[root@sftp_server ~]# touch /etc/rsyncd/rsyncd.conf[root@sftp_server ~]# ln -s /etc/rsyncd/rsyncd.conf /etc/rsyncd.conf 配置rsync服务器主配置文件/etc/rsyncd.conf123456789101112131415161718192021222324[root@sftp_server ~]# cat /etc/rsyncd.conf uid = root gid = root use chroot = yes hosts allow=192.168.10.33/24hosts deny=*max connections=5pid file = /var/run/rsyncd.pid secrets file = /etc/rsyncd/rsyncd.secrets motd file = /etc/rsyncd/rsyncd.motd log file = /var/log/rsync.logtransfer logging = yes log format = %t %a %m %f %bsyslog facility = local3timeout = 300[db_backup] path = /data/backup/ list=yes read only = no ignore errors auth users = rdatabase comment = Oracle Database Backup 密码验证文件/etc/rsyncd/rsyncd.secrets1234[root@sftp_server ~]# cat /etc/rsyncd/rsyncd.secrets rdatabase:sss[root@sftp_server ~]# chown root.root /etc/rsyncd/rsyncd.secrets[root@sftp_server ~]# chmod 600 /etc/rsyncd/rsyncd.secrets 欢迎提示信息文件/etc/rsyncd/rsyncd.motd1234[root@sftp_server ~]# cat /etc/rsyncd/rsyncd.motd++++++++++++++++++++++++++++ Oracle Database Backup! ++++++++++++++++++++++++++++ 启动服务12[root@sftp_server ~]# systemctl start rsyncd.service[root@sftp_server ~]# systemctl enable rsyncd.service 防火墙配置123firewall-cmd --zone=public --add-port=873/tcp --permanentfirewall-cmd --zone=public --add-service=rsyncd --permanentfirewall-cmd --reload 客户端配置有几个细节地方需要主机 rsync命令执行的时候，前边的是src(源)，后边的是dest(目标) 路径后有/只会同步目录下的内容，路径后没有/，会把当前目录（路径的最后一层）同步过去 linux客户端配置12# yum install -y rsync[airmodel@silu ~]$ rsync -avzP /tmp/data/ rdatabase@192.168.6.23::db_backup #把本机/tmp/data/目录下的内容同步到rsync服务器db_backup模块配置的目录中去，如果要将rsync服务器上内容同步至本机，路径位置换一下即可 windows 客户端配置 下载free版本的cwrsync软件 https://itefix.net/cwrsync 在c盘根目录新建一个密码文件password.rsync，内容为sss（这里写的密码和rsync服务器上的要对应，只写密码，不需要用户名） cwrsync不识别Windows路径，C盘需要写为/cygdrive/c，E盘需要写为/cygdrive/e 新建一个计划任务，实现自动化备份，操作可以参考以下示例以下实例内容为：将本地E:\database_backup\目录下的内容同步至rsync服务的db_backup模块中定义的路径中去，密码文件为C:\password.rsync 1C:\cwRsync_5.5.0_x86_Free\bin\rsync.exe -azvP --password-file=/cygdrive/c/password.rsync /cygdrive/e/database_backup/ rdatabase@192.168.6.23::db_backup 更优方式linux下可以部署inotify+rsync，实现实时同步数据]]></content>
      <categories>
        <category>常识</category>
      </categories>
      <tags>
        <tag>rsync</tag>
        <tag>同步</tag>
        <tag>备份</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Aansible palybook 创建lvm并自动挂载]]></title>
    <url>%2Farlo%2F1e1aab57%2F</url>
    <content type="text"><![CDATA[由于工作中经常会遇到添加磁盘，分区，挂载这种操作，使用ansible后再也不用一台台的搞了；主要使用到lvg，lvol，filesystem，mount模块；123456789101112131415161718192021222324252627282930313233343536- hosts: test vars: vg_name: &quot;vgtest&quot; lv_name: &quot;lvtest&quot; pvs_name: &quot;/dev/sdb&quot; dir_path: &quot;/data&quot; tasks: - name: 创建一个vg lvg: vg: &quot;&#123;&#123;vg_name&#125;&#125;&quot; pvs: &quot;&#123;&#123;pvs_name&#125;&#125;&quot; pesize: 4 - name: 创建一个lv lvol: vg: &quot;&#123;&#123;vg_name&#125;&#125;&quot; lv: &quot;&#123;&#123;lv_name&#125;&#125;&quot; size: 100%PVS - name: 格式化lv filesystem: fstype: ext4 dev: &quot;/dev/&#123;&#123;vg_name&#125;&#125;/&#123;&#123;lv_name&#125;&#125;&quot; - name: 获取UUID shell: blkid /dev/&quot;&#123;&#123;vg_name&#125;&#125;&quot;/&quot;&#123;&#123;lv_name&#125;&#125;&quot; |awk &apos;&#123;print $2&#125;&apos; register: result ignore_errors: True - name: 创建挂载目录 file: path: &quot;&#123;&#123;dir_path&#125;&#125;&quot; state: directory mode: 0755 - name: 使用UUID挂载lvm分区 mount: path: /data src: &quot;&#123;&#123;result.stdout&#125;&#125;&quot; fstype: ext4 state: mounted 由于我一直习惯使用UUID挂载分区（UUID是每个分区的唯一标识），所以我加了一步获取UUID的操作，这步也可以略去，挂载的时候使用分区名称进行挂载；还有一点就是使用lvm分区的时候，将整个磁盘做成pv是不需要进行分区操作的，这点比较方便；如果要做分区操作的话，可以使用以下playbook：hosts: test123456789101112vars: dev_name1: &quot;/dev/sdb&quot; dev_name2: &quot;/dev/sdb1&quot;tasks: - name: Disk Partition shell : fdisk &quot;&#123;&#123;dev_name1&#125;&#125;&quot; &lt; /tmp/fdisk_temp.conf - name: Disk Mkfs ext4 filesystem: fstype: ext4 dev: &quot;&#123;&#123;dev_name2&#125;&#125;&quot; - name: Disk Mount shell: blkid /dev/sdb1 |awk &apos;&#123;print $2&#125;&apos;| sed -n &apos;s/$/ \/data ext4 defaults 0 0/p&apos; &gt;&gt; /etc/fstab &amp;&amp; mount -a 受控机/tmp/fdisk_temp.conf内容1234567np11wq]]></content>
      <categories>
        <category>自动化运维</category>
      </categories>
      <tags>
        <tag>自动化</tag>
        <tag>运维</tag>
        <tag>Ansible</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Ansible Playbook入门篇]]></title>
    <url>%2Farlo%2F45b10f7e%2F</url>
    <content type="text"><![CDATA[playbook 是由一组ansible调用module命令的集合，使用yaml语言编写，执行顺序自上而下；1命令格式：ansible-playbook test.yml Playbook 组成Target section: 定义将要执行playbook的远程主机组 name：执行过程中会打印出来变量的值 hosts：定义远程的主机组 user：执行该任务组的用户 remote_user: 与user一样，任选其一 sudo：如果设置为yes，执行该任务组的用户在执行任务的时候获取root权限 sudo_user：如果sudo设置为yes，user设置为user1，sudo_user设置为user2，那么user1会获取user2权限 connection：通过什么方式连接到远程主机，默认是ssh gather_facts：除非明确定义不需要在远程主机上执行setup模块，否则会默认自动执行；不需要执行setup模块，需False该选项。 Variable section：定义playbook运行时需要使用的变量 vars：格式为“变量名称:变量值” vars_files：将变量名称和变量值定义在一个文件中，调用该文件，文件格式为每行一个“变量名称:变量值” vars_prompt：定义一个变量，通过交互方式让用户输入变量值 Task section：定义将要在远程主机上执行的任务列表 tasks： #三种写法如下 调用模块name: 定义名称action：模块名称 模块参数调用 直接使用模块name: 定义名称模块名称：调用方法 模块使用name：定义名称模块名称：模块参数调用 Handler section：定义task执行完成以后需要调用的任务满足一下两点才能达到触发的效果，否则会不生效。 必须在tasks中使用notify调用 在notify中定义内容一定要和tasks中定义的 - name 内容一样 新建用户的示例123456789101112[root@vm00 ~]# cat test.yaml - name: &quot;新建用户&quot; hosts: test user: root vars: user: &quot;user3&quot; password: &quot;$1$01a9gEpb$nlv.OmSa1c4jDaGgeoDKi0&quot; #加密后的密码，可以参考上篇文章中user模块使用 uid: &quot;700&quot; tasks: - name: &quot;新建用户&quot; user: name=&quot;&#123;&#123;user&#125;&#125;&quot; password=&quot;&#123;&#123;password&#125;&#125;&quot; uid=&quot;&#123;&#123;uid&#125;&#125;&quot;# user: name=&quot;&#123;&#123;user&#125;&#125;&quot; state=absent remove=yes #删除用户的话就使用这行 1[root@vm00 ~]# ansible-playbook test.yaml 修改selinux，安装epel扩展包1234567891011121314[root@vm00 ~]# cat test2.yml- hosts: test vars: packages: &quot;epel-release&quot; tasks: - name: &quot;永久关闭selinux&quot; command: sed -i s/SELINUX=enforcing/SELINUX=disabled/g /etc/selinux/config - name: &quot;安装epel扩展包&quot; yum: name=&#123;&#123;packages&#125;&#125; state=present notify: - reboot system handlers: - name: reboot system command: reboot 参考链接：http://breezey.blog.51cto.com/2400275/1757624]]></content>
      <categories>
        <category>自动化运维</category>
      </categories>
      <tags>
        <tag>自动化</tag>
        <tag>运维</tag>
        <tag>Ansible</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Ansible 模块篇]]></title>
    <url>%2Farlo%2F7a718f23%2F</url>
    <content type="text"><![CDATA[Ansible 之所以能自动化完成这么多操作，都是依赖于丰富的模块；类似Jenkins软件的强大的插件支持 查看模块1[root@vm00 ~]# ansible-doc -l 查看模块参数用法12[root@vm00 ~]# ansible-doc -s module[root@vm00 ~]# ansible-doc help module ansible 命令格式1ansible 主机或组-m 模块名-a &apos;模块参数&apos; command 模块默认缺省模块12[root@vm00 ~]# ansible all -m command -a &quot;/bin/echo &apos;hello,sir.&apos;&quot;[root@vm00 ~]# ansible all -a &apos;chdir=/usr/local/src/ tar -cvzf test.tgz file&apos; shell 模块和command一样；支持管道1[root@vm00 ~]# ansible test -m shell -a &apos;ps -ef |grep java&apos; raw 模块和command一样；支持管道 ping 模块测试主机连通性，没有参数1[root@vm00 ~]# ansible all -m ping setup 模块查看主机参数配置filter 过滤参数，相当于grep功能1[root@vm00 ~]# ansible vm02 -m setup 将所有主机的信息输入到/tmp/facts目录下，每台主机的信息输入到主机名文件中（/etc/ansible/hosts里的主机名）1[root@vm00 ~]# ansible all -m setup --tree /tmp/facts 获取主机ip地址1[root@vm00 ~]# ansible vm02 -m setup -a &apos;filter=ansible_default_ipv4&apos; 获取主机内存使用情况1[root@vm00 ~]# ansible vm02 -m setup -a &apos;filter=ansible_memory_mb&apos; 获取主机名1ansible vm02 -m setup -a &apos;filter=ansible_nodename&apos; file 模块file模块主要用于远程主机上的文件操作，file模块包含如下选项：force：需要在两种情况下强制创建软链接，一种是源文件不存在但之后会建立的情况下；另一种是目标软链接已存在,需要先取消之前的软链，然后创建新的软链，有两个选项：yes|nogroup：定义文件/目录的属组mode：定义文件/目录的权限owner：定义文件/目录的属主path：必选项，定义文件/目录的路径recurse：递归的设置文件的属性，只对目录有效src：要被链接的源文件的路径，只应用于state=link的情况dest：被链接到的路径，只应用于state=link的情况state： directory：如果目录不存在，创建目录 file：即使文件不存在，也不会被创建 link：创建软链接 hard：创建硬链接 touch：如果文件不存在，则会创建一个新的文件，如果文件或目录已存在，则更新其最后修改时间 absent：删除目录、文件或者取消链接文件 12345[root@vm00 ~]# ansible nsxq -m file -a &apos;src=/etc/hosts dest=/tmp/hosts&apos;[root@vm00 ~]# ansible nsxq -a &apos;ls -lh /tmp/hosts&apos;[root@vm00 ~]# ansible nsxq -m file -a &quot;path=/tmp/file1 state=touch&quot;[root@vm00 ~]# ansible nsxq -m file -a &quot;dest=/tmp/hosts mode=600 owner=airmodel group=airmodel&quot;[root@vm00 ~]# ansible nsxq -m file -a &quot;dest=/opt/test mode=755 owner=airmodel group=airmodel state=directory&quot; copy模块复制文件到远程主机，copy模块包含如下选项：backup：在覆盖之前将原文件备份，备份文件包含时间信息。有两个选项：yes|nocontent：用于替代”src”,可以直接设定指定文件的值dest：必选项。要将源文件复制到的远程主机的绝对路径，如果源文件是一个目录，那么该路径也必须是个目录directory_mode：递归的设定目录的权限，默认为系统默认权限force：如果目标主机包含该文件，但内容不同，如果设置为yes，则强制覆盖，如果为no，则只有当目标主机的目标位置不存在该文件时，才复制。默认为yesothers：所有的file模块里的选项都可以在这里使用src：要复制到远程主机的文件在本地的地址，可以是绝对路径，也可以是相对路径。如果路径是一个目录，它将递归复制。在这种情况下，如果路径使用”/“来结尾，则只复制目录里的内容，如果没有使用”/“来结尾，则包含目录在内的整个内容全部复制，类似于rsync。12[root@vm00 ~]# ansible nsxq -m copy -a &quot;src=/etc/hosts dest=/tmp/hosts&quot;[root@vm00 ~]# ansible test -m copy -a &apos;src=/etc/fstab dest=/tmp/fstab owner=airmodel group=airmodel mode=644 backup=yes&apos; service 模块管理服务，该模块包含如下选项：arguments：给命令行提供一些选项enabled：是否开机启动 yes|noname：必选项，服务名称pattern：定义一个模式，如果通过status指令来查看服务的状态时，没有响应，就会通过ps指令在进程中根据该模式进行查找，如果匹配到，则认为该服务依然在运行runlevel：运行级别sleep：如果执行了restarted，在则stop和start之间沉睡几秒钟state：对当前服务执行启动，停止、重启、重新加载等操作（started,stopped,restarted,reloaded）ansible nsxq -m service -a ‘name=nginx state=started enabled=yes’1[root@vm00 ~]# ansible test -m service -a &apos;name=httpd state=started enabled=yes&apos; cron 模块用于管理计划任务包含如下选项：backup：对远程主机上的原任务计划内容修改之前做备份cron_file：如果指定该选项，则用该文件替换远程主机上的cron.d目录下的用户的任务计划day：日（1-31，，/2,……）hour：小时（0-23，，/2，……）minute：分钟（0-59，，/2，……）month：月（1-12，，/2，……）weekday：周（0-7，，……）job：要执行的任务，依赖于state=presentname：该任务的描述special_time：指定什么时候执行，参数：reboot,yearly,annually,monthly,weekly,daily,hourlystate：确认该任务计划是创建还是删除user：以哪个用户的身份执行时间不特意指定的话，默认是 123[root@vm00 ~]# ansible nsxq -m cron -a &apos;name=&quot;update ntp time&quot; hour=2 user=root job=&quot;/usr/sbin/ntpdate cn.ntp.org.cn&quot;&apos;[root@vm00 ~]# ansible nsxq -m cron -a &apos;name=&quot;update ntp time&quot; state=absent&apos;[root@vm00 ~]# ansible test -m cron -a &quot;name=&apos;show date&apos; job=&apos;/root/test.sh&apos; backup=&apos;True&apos; hour=2 minute=*/5&quot; yum 模块使用yum包管理器来管理软件包，其选项有：config_file：yum的配置文件disable_gpg_check：关闭gpg_checkdisablerepo：不启用某个源enablerepo：启用某个源name：要进行操作的软件包的名字，也可以传递一个url或者一个本地的rpm包的路径state：状态（present，absent，latest，installed）1234[root@vm00 ~]# ansible nsxq -m yum a &apos;name=httpd state=latest&apos;[root@vm00 ~]# ansible nsxq -m yum a &apos;name=&quot;@Development Tools&quot; state=present&apos;卸载操作[root@vm00 ~]# ansible test -m yum -a &quot;name=httpd state=absent&quot; user模块user模块是请求的是useradd, userdel, usermod三个指令。 home：指定用户的家目录，需要与createhome配合使用groups：指定用户的属组uid：指定用的uidpassword：指定用户的密码name：指定用户名createhome：是否创建家目录 yes|nosystem：是否为系统用户remove：当state=absent时，remove=yes则表示连同家目录一起删除，等价于userdel -rstate：是创建还是删除shell：指定用户的shell环境指定password的时候，需要指定加密后的密码，明文会直接写到/etc/shadow文件中，用户无法登陆123[root@vm00 ~]# echo &quot;ffffff&quot; | openssl passwd -1 -salt $(&lt; /dev/urandom tr -dc &apos;[:alnum:]&apos; | head -c 32) -stdin[root@vm00 ~]# ansible test -m user -a &apos;createhome=yes home=/home/user1 password=&quot;$1$01a9gEpb$nlv.OmSa1c4jDaGgeoDKi0&quot; name=user1 state=present shell=/bin/bash&apos;[root@vm00 ~]# ansible test -m user -a &apos;name=user1 state=absent remove=yes&apos; group 模块goup模块请求的是groupadd, groupdel, groupmod 三个指令。1[root@vm00 ~]# ansible test -m group -a &apos;name=group1 gid=700 state=present&apos; synchronize 模块使用rsync同步文件，其参数如下：archive: 归档，相当于同时开启recursive(递归)、links、perms、times、owner、group、-D选项都为yes ，默认该项为开启checksum: 跳过检测sum值，默认关闭compress:是否开启压缩copy_links：复制链接文件，默认为no ，注意后面还有一个links参数delete: 删除不存在的文件，默认nodest：目录路径dest_port：默认目录主机上的端口 ，默认是22，走的ssh协议dirs：传速目录不进行递归，默认为no，即进行目录递归rsync_opts：rsync参数部分set_remote_user：主要用于/etc/ansible/hosts中定义或默认使用的用户与rsync使用的用户不同的情况mode: push或pull 模块，缺省模式是push；push模的话，一般用于从本机向远程主机上传文件，push的时候src是本机上的文件或目录; pull 模式用于从远程主机上取文件；pull的时候src是目标主机上的文件或目录目录后边跟/表示同步目录下内容，不加/把目录同步过去12[root@vm00 ~]# ansible test -m synchronize -a &apos;src=/etc/hosts dest=/tmp mode=push&apos;[root@vm00 ~]# ansible test -m synchronize -a &apos;src=/etc/fstab dest=/tmp mode=pull&apos; filesystem 模块在块设备上创建文件系统选项：dev：目标块设备force：在一个已有文件系统 的设备上强制创建fstype：文件系统的类型opts：传递给mkfs命令的选项123[root@vm00 ~]# ansible test -a &apos;dd if=/dev/zero of=/abc.img bs=4k count=10000&apos;[root@vm00 ~]# ansible test -a &apos;losetup /dev/loop0 /abc.img&apos;[root@vm00 ~]# ansible test -m filesystem -a &apos;fstype=ext4 dev=/dev/loop0 force=yes opts=-F&apos; mount 模块配置挂载点选项：dumpfstype：必选项，挂载文件的类型name：必选项，挂载点opts：传递给mount命令的参数src：必选项，要挂载的文件state：必选项 present：只处理fstab中的配置 absent：删除挂载点 mounted：自动创建挂载点并挂载之 umounted：卸载 1[root@vm00 ~]# ansible test -m mount -a &apos;name=/opt/abc src=/abc.img fstype=ext4 opts=loop state=mounted&apos; 模块的参数太多了，这篇文章基本上是copy过来的，这里贴一下出处：http://breezey.blog.51cto.com/2400275/1555530]]></content>
      <categories>
        <category>自动化运维</category>
      </categories>
      <tags>
        <tag>自动化</tag>
        <tag>运维</tag>
        <tag>Ansible</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Ansible 入门篇]]></title>
    <url>%2Farlo%2F40fad05f%2F</url>
    <content type="text"><![CDATA[Ansible (is Simple IT Automation) ,是一款自动化运维工具，基于强大的模块功能通过SSH协议推送到被管理端，可以实现的批量系统部署，批量程序部署，批量执行命令等 特性 不需要安装客户端，基于ssh连接管理 不需要配置服务，安装Ansible工具，可以执行命令就可以 拥有大量的模块 支持YAML语法 安装配置简单(门槛低) 被管理机器支持Windows 组成部分 Ansible 核心 Inventory Ansible管理主机的清单 Modules 包括Ansible自带的核心模块和自定义模块 Plugins 完成模块功能的补充，包括连接插件、邮件插件等 Playbooks 编排文件，定义Ansible多任务配置文件，实现Ansible自动执行 安装ansible软件需要主机有python环境，这个安装没啥说的，一键搞定，so easy！1yum -y install ansible 配置管理主机清单默认的主机清单文件是/etc/ansible/hosts 可以修改/etc/ansible/ansible.cfg文件中[defaults]下的#inventory参数来修改， 可以在执行命令时候使用-i参数来指定hosts文件 最简单的配置主机和组配置成主机名的时候，要确保主机名可以被解析(hosts或dns)123456[web]vm01vm02[db]192.168.6.100192.168.6.101 自定义参数ansible_ssh_user 用于指定管理远程主机的账号ansible_ssh_pass 用于指定管理远程主机的密码ansible_ssh_host 用于指定被管理的主机ansible_ssh_port 用于指定ssh的端口ansible_sudo_pass 用于sudo连接用户时的密码ansible_sudo_exec 如果sudo命令不在默认路径，需要指定sudo命令路径ansible_shell_type 目标系统的shell的类型，默认shansible_ssh_private_key_file 指定key文件1234[webservers]192.168.10.12 ansible_ssh_pass=123456 ansible_ssh_user=root192.168.10.13 ansible_ssh_pass=123456 ansible_ssh_user=root ansible_ssh_port=3055vm03 ansible_ssh_pass=123567 ansible_ssh_user=root 指定主机范围01:20 表示192.168.6.1到192.168.6.20共20台主机a:f 表示dba.islocal.cc 到dbf.islocal.cc共6台主机123[db]192.168.6.[01:20]db[a:f].islocal.cc 主机组嵌套，使用children关键字12345678910[mfs:children]mfs_amfs_bmfs_c[mfs_a]vm01[mfs_b]vm02[mfs_c]vm03 测试一下12ansible mfs -m pingansible mfs_c -m ping 调用匹配主机或主机组匹配所有all 或者 *1ansible all -m ping 匹配组直接写组名就ok1ansible test -m ping 逻辑非目标主机在nsxq组不在test组中，逻辑非使用！1ansible nsxq:!test -m ping 逻辑与目标主机在nsxq组并在test中，逻辑与使用&amp;1ansible nsxq:&amp;test -m ping 支持正则匹配匹配一web或者db开头.islocal.cc 的主机1ansible ~(web|db).*\.islocal\.cc -m ping 设置主机互信，配置SSH免密码登录由于ansible是基于ssh来远程管理，执行操作命令的，每次输入密码的话会很繁琐，配置ssh免密码就显得很方便 -k 命令会提示输入密码 修改配置文件/etc/ansible/ansible.cfghost_key_checking=False #当第一次连接远程主机时，会提示输入yes/no,跳过此环节 配置ssh免密码登录，可以参考我之前的另一篇文章SSH免密码验证 模块查看模块ansible-doc -l查看模块参数用法ansible-doc -s moduleansible-doc help module setup 模块查看主机参数配置ansible all -m setup ping 模块测试主机连通性ansible all -m ping file 模块[root@vm00 ~]# ansible nsxq -m file -a ‘src=/etc/hosts dest=/tmp/hosts’[root@vm00 ~]# ansible nsxq -a ‘ls -lh /tmp/hosts’[root@vm00 ~]# ansible nsxq -m file -“path=/tmp/file1 state=touch”[root@vm00 ~]# ansible nsxq -m file -a “dest=/tmp/hosts mode=600 owner=airmodel group=airmodel”[root@vm00 ~]# ansible nsxq -m file -a “dest=/opt/test mode=755 owner=airmodel group=airmodel state=directory” copy模块ansible nsxq -m copy -a “src=/etc/hosts dest=/tmp/hosts” command 模块【默认模块】ansible all -m command -a “/bin/echo ‘hello,sir.’”ansible all -a ‘chdir=/usr/local/src/ tar -cvzf test.tgz file’ shell 模块和command一样；支持管道 raw 模块和command一样 service 模块ansible nsxq -m service -a ‘name=nginx state=started enabled=yes’ cron 模块ansible nsxq -m cron -a ‘name=”update ntp time” hour=2 user=root job=”/usr/sbin/ntpdate cn.ntp.org.cn”‘ansible nsxq -m cron -a ‘name=”update ntp time” state=absent’ filesystem 模块yum 模块ansible nsxq -m yum a ‘name=httpd state=installed’ansible nsxq -m yum a ‘name=”@Development Tools” state=present’ user 模块ansible nsxq -m user -a ‘createhome=yes home=/home/user1 password=”ffffff” name=user1 state=present shell=/bin/bash’ synchronize 模块目录后边跟/表示同步目录下内容，不加/把目录同步过去ansible nsxq -m synchronize -a ‘src=/etc/hosts dest=/opt/‘ filesystem 模块ansible test -m filesystem -a ‘dev=/disk.img fstype=ext4 opts=-F’ mount 模块ansible test -m mount -a ‘fstype=ext4 name=/aaa src=/dev/loop0 state=mounted’]]></content>
      <categories>
        <category>自动化运维</category>
      </categories>
      <tags>
        <tag>自动化</tag>
        <tag>运维</tag>
        <tag>Ansible</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Except实践之 修改主机密码&添加用户&ssh免密码验证]]></title>
    <url>%2Farlo%2F45fa6416%2F</url>
    <content type="text"><![CDATA[最近运维工作中遇到大批量的主机需要添加账户，修改密码，实现无密码验证等工作，由于这种工作完全是重复性的，可以借助脚本（更好的方式是自动化运维工具）来解决，主要是使用到expect工具，该工具主要用来处理自动交互式任务进行通信，不需要人为干预；今天就把用到的脚本在此记录一下，以备后用。 批量修改主机密码脚本内容如下：1234567891011121314151617181920[root@vm00 ~]# cat chpasswd.sh #!/bin/bashfile=&quot;iplist.txt&quot;for ip in `awk &apos;/^[^#]/&#123;print $1&#125;&apos; $file`; do port=`awk -v I=$ip &apos;&#123;if(I==$1)print $3&#125;&apos; $file` user=`awk -v I=$ip &apos;&#123;if(I==$1)print $2&#125;&apos; $file` pass=`awk -v I=$ip &apos;&#123;if(I==$1)print $4&#125;&apos; $file` newpass=`awk -v I=$ip &apos;&#123;if(I==$1)print $5&#125;&apos; $file`expect -c &quot; spawn ssh -p$port $user@$ip set timeout 2 expect &#123; \&quot;(yes/no)\&quot; &#123;send \&quot;yes\r\&quot;;exp_continue&#125; \&quot;password:\&quot; &#123;send \&quot;$pass\r\&quot;;exp_continue&#125; \&quot;$user@*\&quot; &#123;send \&quot;echo \&apos;$newpass\&apos; |passwd --stdin $user\r exit\r\&quot;;exp_continue&#125;#\&quot;$user@*\&quot; &#123;send \&quot;df -h\r exit\r\&quot;;exp_continue&#125; &#125;&quot;done iplist.txt 格式如下12345[root@vm00 ~]# cat iplist.txt # ip user port passwd newpasswd#------------------------------------------------192.168.6.101 root 22 ffffff gggggg192.168.6.102 root 22 ffffff gggggg 批量主机ssh免密码验证手动操作ssh无密码验证设置hosts记录123456[root@vm00 ~]# cat /etc/hosts\#127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 oracle11g\#::1 localhost localhost.localdomain localhost6 localhost6.localdomain6192.168.6.100 vm00192.168.6.101 vm01192.168.6.102 vm02 新建用户并设置密码（每台机器都执行）1234[root@vm00 ~]# useradd -u 600 airmodel[root@vm00 ~]# echo &quot;ffffff&quot; |passwd --stdin airmodelChanging password for user airmodel.passwd: all authentication tokens updated successfully. 配置无密码访问key1234567891011121314151617181920212223[root@vm00 ~]# su - airmodel[airmodel@vm00 ~]$ ssh-keygen Generating public/private rsa key pair.Enter file in which to save the key (/home/airmodel/.ssh/id_rsa): Created directory &apos;/home/airmodel/.ssh&apos;.Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /home/airmodel/.ssh/id_rsa.Your public key has been saved in /home/airmodel/.ssh/id_rsa.pub.The key fingerprint is:3a:d9:04:80:20:6a:90:8a:cd:c7:ee:fb:2d:d9:03:cd airmodel@vm00The key&apos;s randomart image is:+--[ RSA 2048]----+|+o .. ||= . . ||++ . . ||+ o o . || o oS || . .=E || . ++. || . ooo || .o.... |+-----------------+ 将生成的公钥拷贝到其他主机标准命令格式：ssh-copy-id -i ~/.ssh/id_rsa.pub user@server偷懒可以写成下边这种：1234567[airmodel@vm00 ~]$ ssh-copy-id -i vm02airmodel@vm02&apos;s password: Now try logging into the machine, with &quot;ssh &apos;vm02&apos;&quot;, and check in: .ssh/authorized_keysto make sure we haven&apos;t added extra keys that you weren&apos;t expecting. 验证1.公钥会被拷贝到目标主机的 /home/user/.ssh/authorized_keys 文件中2.[airmodel@vm00 ~]$ ssh vm02 无密码访问 多主机自动化配置ssh免密脚本添加用户脚本12345678910111213141516171819[root@vm00 ~]# cat padduser.sh #!/bin/bashfile=&quot;iplist2.txt&quot;newuser=&quot;airmodel&quot;newpass=&quot;ffffff&quot;for ip in `awk &apos;/^[^#]/&#123;print $1&#125;&apos; $file`; do port=`awk -v I=$ip &apos;&#123;if(I==$1)print $3&#125;&apos; $file` loginuser=`awk -v I=$ip &apos;&#123;if(I==$1)print $2&#125;&apos; $file` pass=`awk -v I=$ip &apos;&#123;if(I==$1)print $4&#125;&apos; $file`expect -c &quot; spawn ssh -p$port $loginuser@$ip set timeout 2 expect &#123; \&quot;(yes/no)\&quot; &#123;send \&quot;yes\r\&quot;;exp_continue&#125; \&quot;password:\&quot; &#123;send \&quot;$pass\r\&quot;;exp_continue&#125; \&quot;$user@*\&quot; &#123;send \&quot;useradd -u 600 $newuser &amp;&amp; echo \&apos;$newpass\&apos; |passwd --stdin $newuser\r exit\r\&quot;;exp_continue&#125;#\&quot;$user@*\&quot; &#123;send \&quot;df -h\r exit\r\&quot;;exp_continue&#125; &#125;&quot;done iplist2.txt内容123# ip user port passwd #--------------------------------------192.168.6.102 root 22 ffffff 多主机拷贝ssh公钥12345678910111213141516#!/bin/bash#批量ssh无密码验证for p in $(cat /opt/iplist3.txt)doip=$(echo &quot;$p&quot;|cut -f1 -d &quot;:&quot;)password=$(echo &quot;$p&quot;|cut -f2 -d &quot;:&quot;)expect -c &quot; spawn ssh-copy-id -i /home/airmodel/.ssh/id_rsa.pub airmodel@$ip expect &#123; \&quot;*yes/no*\&quot; &#123;send \&quot;yes\r\&quot;; exp_continue&#125; \&quot;*password*\&quot; &#123;send \&quot;$password\r\&quot;; exp_continue&#125; \&quot;*Password*\&quot; &#123;send \&quot;$password\r\&quot;;&#125; &#125; &quot; done iplist3.txt 格式1234567#user:passwd#-----------vm01:ffffffvm02:ffffffvm03:ffffffvm04:ffffffvm05:ffffff 参考连接：http://zqscm.qiniucdn.com/data/20110709133541/index.htmlhttps://blog.slogra.com/post-674.htmlhttp://blog.csdn.net/fanren224/article/details/63250184]]></content>
      <categories>
        <category>自动化运维</category>
      </categories>
      <tags>
        <tag>自动化</tag>
        <tag>运维</tag>
        <tag>expect</tag>
        <tag>脚本</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Windows 下使用expdp自动备份多用户oracle脚本]]></title>
    <url>%2Farlo%2F85974653%2F</url>
    <content type="text"><![CDATA[Windows下多Oracle实例，根据用户自动备份12345678910111213141516171819@echo off echo ================================================ echo Windows环境下Oracle数据库的自动备份脚本 echo 1. 使用当前日期命名备份文件。 echo 2. 自动删除30天前的备份。 echo ================================================ ::以“YYYYMMDD”格式取出当前时间。 set BACKUPDATE=%date:~0,4%%date:~5,2%%date:~8,2% set DATADIR=E:\database_backup\%BACKUPDATE%echo 本次备份目录是%DATADIR%echo ================================================ echo 开始备份数据库for %%u in (AIR_FORECAST,ALK,AIR_FZ,TSUBJECT,TMAIN,TCODE,AIR_YBYJ,AIR_FXPT,INVENTORY,TENV,NEWMBGL) do expdp userid=&apos;sys/密码@实例 as sysdba&apos; schemas=%%u directory=DATA_PUMP_DIR dumpfile=%%u.dmpecho 移动文件到数据库备份目录if not exist &quot;E:\database_backup\%BACKUPDATE%&quot; mkdir E:\database_backup\%BACKUPDATE% MOVE /Y E:\app\Administrator\admin\SX21\dpdump\* E:\database_backup\%BACKUPDATE%::删除30天前的备份forfiles /p E:\database_backup\ /m 201* /d -30 /c &quot;cmd /c if @isdir==TRUE (rmdir /q /s @path) else (del /f @path)&quot; exit 参考：http://www.cnblogs.com/peterpanzsy/p/3442784.htmlhttp://blog.csdn.net/smasegain/article/details/46759267]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>数据库</tag>
        <tag>Oracle</tag>
        <tag>Windows</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[NIS 服务器搭建记录]]></title>
    <url>%2Farlo%2F3e02ce74%2F</url>
    <content type="text"><![CDATA[概述NIS是Network Information Services (NIS server)的缩写，是为了管理一个网络中的用户账号 ，以方便用户在不同的主机上登录时只需要一个账号即可，它将用户的账号保存在一个主机上，用户登录时只需向其发送请求确认账号是否正确。 NIS 的主要功能：管理帐户信息服务器端文件名 档案内容/etc/passwd 提供用户账号、UID、GID、家目录所在、Shell 等等/etc/group 提供群组数据以及 GID 的对应，还有该群组的加入人员/etc/hosts 主机名与 IP 的对应，常用于 private IP 的主机名对应/etc/services 每一种服务 (daemons) 所对应的埠口 (port number)/etc/protocols 基础的 TCP/IP 封包协定，如 TCP, UDP, ICMP 等/etc/rpc 每种 RPC 服务器所对应的程序号码/var/yp/ypservers NIS 服务器所提供的数据库 NIS Server端配置yp-tools ：提供 NIS 相关的查寻指令功能。ypbind ：提供 NIS Client 端的设定软件。ypserv ：提供 NIS Server 端的设定软件。rpcbind ：就是 RPC ，系统一般会安装上。 安装NIS Server 端软件12[root@sg010 ~]# yum -y install yp-tools ypbind ypserv rpcbind[root@sg010 ~]# rpm -qa | grep &apos;^yp&apos; ypbind-1.20.4-33.el6.x86_64yp-tools-2.9-12.el6.x86_64ypserv-2.19-31.el6.x86_641[root@sg010 ~]# rpm -qa | grep rpcbind rpcbind-0.2.0-13.el6_9.x86_64 配置hosts文件Hosts文件中之前的记录不要动，新增包含nis server 和 nis client 的主机与ip对应记录1234[[root@sg010 ~]# vim /etc/sysconfig/network\#增加以下两行NISDOMAIN=hpcnisYPSERV_ARGS=&quot;-p 1011&quot; 配置nis服务12345678910[root@sg010 ~]# egrep -v &apos;^$|#&apos; /etc/ypserv.conf dns: nofiles: 30xfr_check_port: yes\* : * : shadow.byname : port\* : * : passwd.adjunct.byname : port127.0.0.0/255.0.0.0 :*:*:none218.193.126.128/255.255.255.128 :*:*:none59.77.252.0/255.255.255.192 :*:*:none\* :*:*:deny 12[root@sg010 ~]# vim /etc/sysconfig/yppasswddYPPASSWDD_ARGS=&quot;--port 1012&quot; 启动服务启动后查看一下三个服务状态1[root@sg010 ~]# /etc/init.d/rpcbind status rpcbind (pid 18813) is running…1[root@sg010 ~]# /etc/init.d/ypserv status ypserv (pid 21054) is running…1[root@sg010 ~]# /etc/init.d/yppasswdd status rpc.yppasswdd (pid 23087) is running…并设置开机自启动123[root@sg010 ~]# chkconfig --level 35 ypserv on[root@sg010 ~]# chkconfig --level 35 yppasswdd on[root@sg010 ~]# chkconfig --level 35 rpcbind on 添加用户，设置密码[root@sg010 ~]# useradd -u 1001 nisuser1[root@sg010 ~]# echo ffffff|passwd –stdin nisuser1[root@sg010 ~]# /usr/lib64/yp/ypinit -m Client 端配置[root@sg011 ~]# yum -y install ypbind yp-tools[root@sg011 ~]# rpm -qa |grep ‘^yp’yp-tools-2.9-12.el6.x86_64ypbind-1.20.4-30.el6.x86_64 配置NIS1[root@sg011 ~]# setup xshell 的配色方案修改过，所以这里看到的图片颜色也不是那种蓝底色的勾选NIS，启用NIS验证填写NIS的服务器域名和服务器地址Starting rpcbind: [ OK ]Starting NIS service: [ OK ]Binding NIS service: . [ OK ]刚才的步骤其实就是做了以下操作 /etc/sysconfig/network (加入 NISDOMAIN 项目) /etc/yp.conf (亦即是 ypbind 的配置文件) /etc/nsswitch.conf (修改许多主机验证功能的顺序) /etc/sysconfig/authconfig (CentOS 的认证机制) /etc/pam.d/system-auth (许多登入所需要的 PAM 认证过程) 启动了rpcbind 和 ypbind服务 /etc/sysconfig/network /etc/yp.conf /etc/nsswitch.conf主机验证顺序12345passwd: files nisshadow: files nisgroup: files nis\#hosts: db files nisplus nis dnshosts: files nis dns /etc/sysconfig/authconfig启用NIS1USENIS=yes /etc/pam.d/system-auth在pam验证过程中增加了nis1password sufficient pam_unix.so sha512 shadow nis nullok try_first_pass use_authtok 客户端简单粗暴的验证方法切换用户验证12[root@sg011 ~]# grep nisuser1 /etc/passwd[root@sg011 ~]# su - nisuser1 su: warning: cannot change directory to /home/nisuser1: No such file or directory-bash-4.1$ 没有用户主目录两种解决方式 新建一个/home/nisuser1目录,cp /etc/skel/* /home/niuser1 使用nfs，挂载nis server的home目录，客户端和服务器使用的是同一个用户目录，保持一致性（推荐）修改用户的默认shell在客户端执行 ypchsh 参考：http://cn.linux.vbird.org/linux_server/0430nis.php]]></content>
      <tags>
        <tag>NIS</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[NFS 服务器搭建记录]]></title>
    <url>%2Farlo%2Fdd17c5bd%2F</url>
    <content type="text"><![CDATA[系统环境Centos 6.5Iptables：offSelinux：disabled 由于MBR分区表只支持2T的硬盘，/dev/sdb是一块10T的硬盘，使用GPT分区表，需要使用parted工具分区 使用fdisk查看磁盘ps：这个之后又增加了一块10T的硬盘，这个截图早一点，没提现出来 使用parted工具分区1[root@sg020 ~]# parted /dev/sdb GNU Parted 2.1Using /dev/sdbWelcome to GNU Parted! Type ‘help’ to view a list of commands.(parted) printModel: VMware Virtual disk (scsi)Disk /dev/sdb: 9896GBSector size (logical/physical): 512B/512BPartition Table: gpt Number Start End Size File system Name Flags (parted) mkpart primary 0 10TWarning: The resulting partition is not properly aligned for best performance.Ignore/Cancel? Ignore (parted) print Model: VMware Virtual disk (scsi)Disk /dev/sdb: 9896GBSector size (logical/physical): 512B/512BPartition Table: gpt Number Start End Size File system Name Flags 1 17.4kB 9896GB 9896GB primary (parted) quit Information: You may need to update /etc/fstab.(parted) set 1 lvm on (parted) print Model: VMware Virtual disk (scsi)Disk /dev/sdb: 9896GBSector size (logical/physical): 512B/512BPartition Table: gpt Number Start End Size File system Name Flags 1 17.4kB 9896GB 9896GB ext4 primary lvm(parted) quit Information: You may need to update /etc/fstab.1[root@sg020 ~]# parted /dev/sdc GNU Parted 2.1Using /dev/sdcWelcome to GNU Parted! Type ‘help’ to view a list of commands.(parted) print Error: /dev/sdc: unrecognised disk label(parted) mklabel gpt (parted) print Model: VMware Virtual disk (scsi)Disk /dev/sdc: 11.0TBSector size (logical/physical): 512B/512BPartition Table: gpt Number Start End Size File system Name Flags (parted) mkpart primary 0 10995G Warning: The resulting partition is not properly aligned for best performance.Ignore/Cancel? Ignore (parted) print Model: VMware Virtual disk (scsi)Disk /dev/sdc: 11.0TBSector size (logical/physical): 512B/512BPartition Table: gpt Number Start End Size File system Name Flags 1 17.4kB 11.0TB 11.0TB primary (parted) set 1 lvm on (parted) print Model: VMware Virtual disk (scsi)Disk /dev/sdc: 11.0TBSector size (logical/physical): 512B/512BPartition Table: gpt Number Start End Size File system Name Flags 1 17.4kB 11.0TB 11.0TB primary lvm (parted) quit Information: You may need to update /etc/fstab. lvm 划分创建pv1[root@sg020 ~]# pvcreate /dev/sdb1 /dev/sdc1 dev_is_mpath: failed to get device for 8:17 Physical volume “/dev/sdb1” successfully created dev_is_mpath: failed to get device for 8:33 Physical volume “/dev/sdc1” successfully created1[root@sg020 ~]# pvdisplay — Physical volume — PV Name /dev/sda2 VG Name vg_sg020 PV Size 193.51 GiB / not usable 3.00 MiB Allocatable yes (but full) PE Size 4.00 MiB Total PE 49538 Free PE 0 Allocated PE 49538 PV UUID BF6Ikw-eYtl-HfNM-Nnmt-WLK4-xb8O-KAnZtB “/dev/sdb1” is a new physical volume of “9.00 TiB” — NEW Physical volume — PV Name /dev/sdb1 VG Name PV Size 9.00 TiB Allocatable NO PE Size 0 Total PE 0 Free PE 0 Allocated PE 0 PV UUID aPPVxz-oeWE-lP9l-AeZU-p699-pffd-O7T3dW “/dev/sdc1” is a new physical volume of “10.00 TiB” — NEW Physical volume — PV Name /dev/sdc1 VG Name PV Size 10.00 TiB Allocatable NO PE Size 0 Total PE 0 Free PE 0 Allocated PE 0 PV UUID MWbqIl-WI66-JCsc-x0Re-UqjL-HgXB-Vw1jge 创建vg1[root@sg020 ~]# vgcreate vg_fuz /dev/sdb1 /dev/sdc1 Volume group “vg_fuz” successfully created1[root@sg020 ~]# vgdisplay — Volume group — VG Name vg_fuz System ID Format lvm2 Metadata Areas 2 Metadata Sequence No 1 VG Access read/write VG Status resizable MAX LV 0 Cur LV 0 Open LV 0 Max PV 0 Cur PV 2 Act PV 2 VG Size 19.00 TiB PE Size 4.00 MiB Total PE 4980734 Alloc PE / Size 0 / 0 Free PE / Size 4980734 / 19.00 TiB VG UUID ruDcio-mmt5-z6YD-7HS0-fbst-GIlT-SwmvcF — Volume group — VG Name vg_sg020 System ID Format lvm2 Metadata Areas 1 Metadata Sequence No 4 VG Access read/write VG Status resizable MAX LV 0 Cur LV 3 Open LV 3 Max PV 0 Cur PV 1 Act PV 1 VG Size 193.51 GiB PE Size 4.00 MiB Total PE 49538 Alloc PE / Size 49538 / 193.51 GiB Free PE / Size 0 / 0 VG UUID 2E6Hdt-xWhi-DyLX-pDva-3WTw-fDNx-Qytoqg 创建lv1[root@sg020 ~]# lvcreate -n lv_fuz -l 4980734 vg_fuz Logical volume “lv_fuz” created1[root@sg020 ~]# lvdisplay — Logical volume — LV Path /dev/vg_fuz/lv_fuz LV Name lv_fuz VG Name vg_fuz LV UUID JTUEVa-9JPb-0VaD-5JH8-fwov-MuUS-gp1Gdr LV Write Access read/write LV Creation host, time sg020, 2017-06-14 09:27:14 +0800 LV Status available # open 0 LV Size 19.00 TiB Current LE 4980734 Segments 2 Allocation inherit Read ahead sectors auto - currently set to 256 Block device 253:3 — Logical volume — LV Path /dev/vg_sg020/lv_root LV Name lv_root VG Name vg_sg020 LV UUID 5yHVBf-Qt3u-fzb2-gwNL-opy3-0ewQ-0ypYsc LV Write Access read/write LV Creation host, time livedvd.centos, 2017-06-09 15:49:11 +0800 LV Status available # open 1 LV Size 50.00 GiB Current LE 12800 Segments 1 Allocation inherit Read ahead sectors auto - currently set to 256 Block device 253:0 — Logical volume — LV Path /dev/vg_sg020/lv_home LV Name lv_home VG Name vg_sg020 LV UUID d1bsIq-ZeVr-mxk1-Mu2U-7H1R-wXMX-rWZ9hj LV Write Access read/write LV Creation host, time livedvd.centos, 2017-06-09 15:49:19 +0800 LV Status available # open 1 LV Size 124.11 GiB Current LE 31772 Segments 1 Allocation inherit Read ahead sectors auto - currently set to 256 Block device 253:2 — Logical volume — LV Path /dev/vg_sg020/lv_swap LV Name lv_swap VG Name vg_sg020 LV UUID wGW4BB-KB5g-UUZ8-FwLQ-pTYy-Eoc2-ji102r LV Write Access read/write LV Creation host, time livedvd.centos, 2017-06-09 15:49:37 +0800 LV Status available # open 1 LV Size 19.40 GiB Current LE 4966 Segments 1 Allocation inherit Read ahead sectors auto - currently set to 256 Block device 253:1 格式化分区1[root@sg020 ~]# mkfs.ext4 /dev/vg_fuz/lv_fuz mke2fs 1.41.12 (17-May-2010)mkfs.ext4: Size of device /dev/vg_fuz/lv_fuz too big to be expressed in 32 bits using a blocksize of 4096. ext4格式的分区，不支持大于16TB的硬盘分区，我们使用xfs格式12[root@sg020 ~]# yum install xfsprogs[root@sg020 ~]# mkfs.xfs /dev/vg_fuz/lv_fuz 查找分区UUID1[root@sg020 ~]# blkid /dev/vg_fuz/lv_fuz /dev/vg_fuz/lv_fuz: UUID=”3c2731e9-eac4-4e05-b103-be061e4c009c” TYPE=”xfs” 添加到fstab12[root@sg020 ~]# mkdir /data[root@sg020 ~]# echo &apos;UUID=3c2731e9-eac4-4e05-b103-be061e4c009c /data xfs defaults 0 0&apos; &gt;&gt; /etc/fstab 挂载分区12[root@sg020 ~]# mount –a[root@sg020 ~]# mount |column –t 查看安装nfs软件12[root@sg020 ~]# yum -y install nfs-utils rpcbind[root@sg020 ~]# rpm -qa |grep nfs nfs-utils-1.2.3-39.el6.x86_64nfs-utils-lib-1.1.5-6.el6.x86_64nfs4-acl-tools-0.3.3-6.el6.x86_61[root@sg020 ~]# rpm -qa |grep rpcbind rpcbind-0.2.0-11.el6.x86_6412/etc/exports文件内容格式：&lt;输出目录&gt; [客户端1 选项（访问权限,用户映射,其他）] [客户端2 选项（访问权限,用户映射,其他）] 12[root@sg020 ~]# cat /etc/exports /data 218.193.126.128/25(insecure,rw,async,no_root_squash) 59.77.252.0/26(insecure,rw,async,no_root_squash) NFS的常用目录/etc/exports NFS服务的主要配置文件/usr/sbin/exportfs NFS服务的管理命令/usr/sbin/showmount 客户端的查看命令/var/lib/nfs/etab 记录NFS分享出来的目录的完整权限设定值/var/lib/nfs/xtab 记录曾经登录过的客户端信息 启动服务1[root@sg020 ~]# /etc/init.d/rpcbind start Starting rpcbind: [ OK ]1[root@sg020 ~]# /etc/init.d/nfs start Starting NFS services: [ OK ]Starting NFS quotas: [ OK ]Starting NFS mountd: [ OK ]Starting NFS daemon: [ OK ]Starting RPC idmapd: [ OK ]12[root@sg020 ~]# chkconfig --level 35 rpcbind on[root@sg020 ~]# chkconfig --level 35 nfs on 重新共享所有目录并输出详细信息1[root@sg020 ~]# exportfs -rv exporting 218.193.126.128/25:/dataexporting 59.77.252.0/26:/data 卸载所有共享目1[root@sg020 ~]# exportfs -au 客户端挂载1234[root@sg011 ~]# mount -t nfs sg020:/data/ /data[root@sg011 ~]# echo “sg020:/data /data nfs nolock 0 0” &gt;&gt; /etc/fstab[root@sg011~]# mount –a[root@sg011 ~]# mount |column –t user &amp; group 是nobody的问题由于centos6以后采用的是nfs v4，所以在挂载后，服务端和客户端看到的信息不一致，客户端看到文件的user和group都是nobody 或nfsnobody，以下是解决办法 服务端修改配置文件12# vi /etc/idmapd.confDomain = hpcnfs 重启服务12/etc/init.d/rpcidmapd restart chkconfig --level 35 rpcidmapd on 客户端修改配置文件12# vi /etc/idmapd.confDomain = hpcnfs 清除缓存1nfsidmap -c 重启服务12/etc/init.d/rpcidmapd restart chkconfig --level 35 rpcidmapd on 问题解决重启之后，如果客户端提示“Stale file handle”，三种解决方法：1231. umount /data;mount -a2. fuser -km /data; mount -a3. umount -lv /data; mount -a lvm扩容，“resize2fs: Device or resource busy while trying to open”，解决方法如下：其实做lvm不需要分区，直接将整个盘做成pv；扩容的vg时候，可以更懒一点，pv都不用做，直接vgextend；1vgextend vg_fuz /dev/sdc 在扩容lv的时候，更加方便的做法是使用pe扩容，而不是容量（-L是容量，-l是PE，可以通过vgdisplay查看剩余）；1lvextend -l +3000 /dev/vg_fuz/lv_fuz fdisk可以看到到容量已经变化了，但是df还看不出来，我们可以使用resize2fs命令重设；1resize2fs /dev/vg_fuz/lv_fuz xfs 文件系统 resize2fs已经不适用了，需要用到一个新的命令xfs_growfs； xfs_growfs /dev/vg_fuz/lv_fuz 因为整个环境是内网环境，需要拨vpn才能访问，我没有配置iptables，nfs的iptables配置也比较麻烦，回头研究一下；另，今天遇到一个很有意思的情况（其实就是自己学艺不精），由于Nfs给两个网段提供服务，牵扯到一个跨网段的问题；我看了下服务器上的配置的网络情况，根据ip地址所在的网段（218.193.126.x和59.77.252.x）和子网掩码（25和26），配置了/data 218.193.126.0/25(insecure,rw,async,no_all_squash) 59.77.252.0/26(insecure,rw,async,no_all_squash)，之后的情况就很诡异，59这个网络是可以正常访问的，218这个网络提示没有权限（mount.nfs: access denied by server while mounting sg020:/data/），搞得我很纳闷，配置到精确的ip地址就没有问题；后来经群里高手点播，网络和掩码的计算（218.193.126.0/25意思应该是218.193.126.1~218.193.126.127），我的服务器ip是不在范围内的，回头需要补习一下网络基础。]]></content>
      <tags>
        <tag>Nfs</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Oracle TNS-12541、TNS-00511 无监听程序]]></title>
    <url>%2Farlo%2F6e04db84%2F</url>
    <content type="text"><![CDATA[一台Windows服务器上安装的oralce服务器很卡，于是同事就重启了一下，然后……，你想到了，起不来了。折腾了好久，服务器终于起来了，oracle起不来，记录一下故障原因 提示错误信息如下：12345678910111213141516Fatal NI connect error 12541, connecting to: (DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=WIN-EPRQ7FK9EK2)(PORT=1521))(CONNECT_DATA=(SID=orcl)(CID=(PROGRAM=E:\app\Administrator\product\11.2.0\dbhome_4\bin\emagent.exe)(HOST=WIN-EPRQ7FK9EK2)(USER=SYSTEM)))) VERSION INFORMATION: TNS for 64-bit Windows: Version 11.2.0.1.0 - Production Windows NT TCP/IP NT Protocol Adapter for 64-bit Windows: Version 11.2.0.1.0 - Production Time: 13-6月 -2017 10:58:58 Tracing not turned on. Tns error struct: ns main err code: 12541 TNS-12541: TNS: 无监听程序 ns secondary err code: 12560 nt main err code: 511 TNS-00511: 无监听程序 nt secondary err code: 61 nt OS err code: 0 故障原因oracle运行时间过长，listener.log日志超过4G导致，此为oracle bug；BUG号为9879101 : THE CONNECT THROUGH LISTENER WAS SLOW WHEN LISTNER LOG GROWED 4GB 解决方法 找到日志文件 E:\app\Administrator\diag\tnslsnr*WIN-EPRQ7FK9EK2*\listener\trace\listener.log 经查看，该日志大小为4.00 GB (4,294,967,340 字节) 删除该文件，启动监听、服务，恢复正常 顺手写个脚本放计划任务里12345678910111213141516@echo off echo ================================================ echo E:\app\Administrator\diag\tnslsnr\WIN-EPRQ7FK9EK2\listener\trace\listener.log 备份文件，用来解决日志问超过4G，数据库监听死掉问题 echo ================================================ ::以“YYYYMMDD”格式取出当前时间。 set BACKUPDATE=%date:~0,4%%date:~5,2%%date:~8,2% set DATADIR=E:\app\Administrator\diag\tnslsnr\WIN-EPRQ7FK9EK2\listener\trace\echo 备份日志文件e:cd %DATADIR%lsnrctl set log_status offrename listener.log listener.log_%BACKUPDATE%lsnrctl set log_status onecho 删除30天以前的日志文件forfiles -p %DATADIR% -s -m listener.log_* -d -30 -c &quot;cmd /c del @path&quot;]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>数据库</tag>
        <tag>Oracle</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[在已存在的目录中增加一层路径]]></title>
    <url>%2Farlo%2Fffa6a879%2F</url>
    <content type="text"><![CDATA[由于之前项目上考虑不周，路径配置的有问题，现在需要在已有的目录中某一级增加一层目录，需要解决几个问题；12/data/Model3/WeatherForecast/CAMX/2017/05/01/&#123;d1,d2,d3&#125;/data/Model3/WeatherForecast/CAMX/2017/05/01/00/&#123;d1,d2,d3&#125; 多级目录，多个参数，CAMX/2017/05/01 这四个参数是变化的 判断父级目录是否存在，存在后增加一层目录 移动之前的数据到当前目录 以下是我写的脚本，能满足使用，稍显繁琐，求优化！123456789101112131415161718192021222324#!/bin/bashdir=&apos;/data/Model3/WeatherForecast&apos;#dir1=&quot;NAQMPSDAY&quot;dir1=&quot;CAMX CAMxDAY CMAQDAY CMAQ.WRF NAQMPS NAQMPSDAY WRF WRFCHEM WRFCHEMDAY&quot;dir2=&quot;2016 2017&quot;for i1 in $dir1;do for i2 in $dir2; do for i3 in &#123;01..12&#125;; do for i4 in &#123;01..31&#125;; do dir4=&quot;$dir/$i1/$i2/$i3/$i4&quot;# echo $dir4 if [ -d $dir4 ];then cd $dir4 mkdir $dir4/00 mv d* $dir4/00 fi done done donedone 以下是执行前后的效果对比图（使用tree -L 5 &gt; 2.txt生成）]]></content>
      <categories>
        <category>常识</category>
      </categories>
      <tags>
        <tag>脚本</tag>
        <tag>shell</tag>
        <tag>linux常识</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Oracle 多实例启动]]></title>
    <url>%2Farlo%2F6b9bbb19%2F</url>
    <content type="text"><![CDATA[oracle 服务器上配置了两个实例，orcl和sx21，启动服务的时候需要手动修改一下环境变量ORACLE_SID,在此记录一下。 手动启动oracle 用户的环境变量.bash_profile12345678ORACLE_BASE=/u01/app/oracleORACLE_HOME=$ORACLE_BASE/product/11.1.0/db_1ORACLE_SID=orclPATH=$PATH:$ORACLE_HOME/bin:$HOME/binLD_LIBRARY_PATH=$ORACLE_HOME/libexport PATH ORACLE_BASE ORACLE_HOME ORACLE_SID PATH LD_LIBRARY_PATHexport LANG=zh_CN.UTF-8export NLS_LANG=AMERICAN_AMERICA.ZHS16GBK 查看环境变量1234[oracle@localhost ~]$ echo $ORACLE_HOME/u01/app/oracle/product/11.1.0/db_1[oracle@localhost ~]$ echo $ORACLE_SIDorcl 启动oracle服务12345su - oraclesqlplus /nologsql&gt; conn /as sysdbasql&gt; startupsql&gt; exit 修改ORACLE_SID环境变量，再次执行第3步的启动操作1export ORACLE_SID=SX21 启动监听服务1lsnrctl start 验证1[oracle@localhost ~]$ sqlplus sys/password@SX21 as sysdba 自动启动修改控制文件1234vim /etc/orataborcl:/u01/app/oracle/product/11.1.0/db_1:Ysx21:/u01/app/oracle/product/11.1.0/db_1:YCQ:/u01/app/oracle/product/11.1.0/db_1:Y 修改dbstart文件修改第80行: ORACLE_HOME_LISTNER=$1为ORACLE_HOME_LISTNER=$ORACLE_HOME1234vim /u01/app/oracle/product/11.1.0/db_1/bin/dbstart……ORACLE_HOME_LISTNER=$ORACLE_HOME …… 修改dbshut文件修改第50行: ORACLE_HOME_LISTNER=$1为ORACLE_HOME_LISTNER=$ORACLE_HOME1234vim /u01/app/oracle/product/11.1.0/db_1/bin/dbshut……ORACLE_HOME_LISTNER=$ORACLE_HOME…… 修改开机启动文件12vim /etc/rc.localsu - oracle -lc &quot;/u01/app/oracle/product/11.1.0/db_1/bin/dbstart&quot; 常用的三个图形控制如下启动em控制台123emctl start dbconsole#添加到开机启动文件中su - oracle -lc &quot;$ORACLE_HOME/bin/emctl start dbconsole&quot; 创建数据库1dbca 配置监听12netcanetmgr]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>数据库</tag>
        <tag>Oracle</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Oracle入门]]></title>
    <url>%2Farlo%2F9f698189%2F</url>
    <content type="text"><![CDATA[服务、监听启动oracle服务12345su - oraclesqlplus /nologsql&gt; conn /as sysdbasql&gt; startupsql&gt; exit 启动监听服务1lsnrctl start 配置监听1netca 启动em控制台1emctl start dbconsole 创建数据库1dbca 连接数据库12sqlplus /nologconn / as sysdba; 连接数据库1conn system/password; 断开数据库连接1disc[onnect] 将屏幕上的内容输入到文件中123spool d:\a.txt……spool off; 创建用户 密码必须以字母开头1create user xiaoming identified by m123; sys用户：超级管理员，权限最高，dba角色，默认密码：change_on_installsystem用户：系统管理员，没有create database权限，默认密码：manager普通用户：新建的用户无登录数据库权限查看当前用户1show user； 修改密码121. passw[ord]2. alter user 用户名 identified by 新密码; 删除用户如果用户已经创建表，删除的时候加一个cascade参数1drop user 用户名 cascade 授予权限12grant select on emp to xiaoming;grant all on emp to xiaoming; 收回权限1revoke all on emp to xiaoming; 收回上级权限，下级权限也相应取消对象权限授权123grant select on emp to xiaoming with grant option;conn xiaoming/m1234;grant select on scott.emp to xiaohong; 系统权限授权123grant connect to xiaoming with admin option;conn xiaoming/1234;grant connect to xiaohong; 用户口令管理建立数据库时候，oracle会建立默认的default的profile，当没有给用户指定profile的时候，oracle会将default的profile分配给用户创建profile文件用户输入3次错误密码后被锁定2天12create profile lock_account limit failed_login_attempts 3 password_lock_time 2;alter user xiaoming profile lock_account; 用户解锁1alter user xiaoming account unlock; 定期修改密码要求用每隔30天修改登录密码，宽限期为2天，32天后没有修改将不能登录12create profile myprofile limit password_life_time 30 password_grace_time 2;alter user xiaoming profile myprofile; 口令历史希望用户修改密码的时候，不能使用之前的密码；使用口令历史，oracle会将之前的密码存在数据字典中，当用户修改密码时，oracle会将新输入的密码和旧密码进行比对，如果一样，会提示重新输入。不能使用10内使用过的密码12create profile password_history limit password_life_time 10 password_grace_time 2 password_reuse_time 10alter user xiaoming profile password_history; 删除profile文件1drop profile password_history [cascade] ###############Day2############创建表必须以字母开头长度不能超过30个字符不能使用oracle保留字只能使用a-zA-Z0-9$# 字符型char 2000varchar2 4000clob 4000+数字型number 整数，小数 -(10^38) ~ 10^38日期类型date 包含年月日和时分秒timestamp 时间戳，精度更高图片blob 创建student表1234567create table student(xh number(4),xm varchar2(20),sex char(2),birthday date,sal num(7,2)); 添加一个字段1alter table student add(classID number(2)); 修改字段长度1alter table student modify(xm varchar2(30)); 修改字段的类型/或者名字（不能有数据）1alter table student modify (xm char(30)); 删除一个字段1alter table student drop column sal; 修改表名字1rename student to stu; 删除表1drop table student; 修改日期默认格式1alter session set nls_date_format=&apos;mm-dd-yyyy&apos; 插入数据插入所有字段1insert into student values(1,&apos;小明&apos;,&apos;男&apos;,&apos;03-14-2017&apos;,3200.00) 插入部分字段1insert into student(xh,xm,sex) values(&apos;23&apos;,小张&apos;,&apos;男&apos;) 插入空值修改数据1update student set sex=&apos;女&apos; where xm=&apos;小明&apos;; 修改多个字段，用逗号隔开 将一行数据复制多条1insert into users (userid,username,userpass) select * from users; 查询字段为[非]空1select * from student where brithday is [not] null; 删除数据,不删除表结构，记录在日志中，删除之前建立一个回滚点savepoint aa;可恢复1delete from student; 删除数据后回滚1rollback to aa; 删除表的结构和数据1drop table student; 删除表数据，不删除表结构，不记录在日志中，不可恢复，速度快；1truncate table student; 查看表结构1desc table_name; 查询所有列1select * from dept; 查询指定列1select ename,sal,job,deption from dept; 取消重复行1select distinct deptno,job from emp; 打开显示操作时间1set timing on; nvl处理null值，当字段为null，当0处理1select sal*13+nvl(comm,0)*13 &quot;年工资&quot;,ename,comm from emp; like%表示0到多个字符_表示任意单个字符 多个值匹配1select * from emp where empno in(123,234,500); or &amp; and1select * from emp where (sal&gt;500 or job=&apos;Manager&apos;) and ename like &apos;J%&apos;; 默认排序低到高123order by [asc/desc]select * from emp order by sal;` 按部门编号升序，薪水降序列；1select * from emp order by depto, sal desc; 列别名排序1select ename,(sal+nvl(comm,0))*12 [as] &quot;年薪&quot; from emp order by &quot;年薪&quot;; 复杂查询max，min，avg，sum，count查询一个最高工资，最低工资1select max(sal),min(sal) from emp; 查出最高工资员工1select ename,sal from emp where sal=(select max(sal) from emp); 显示工资高于平均工资的员工1select * from emp where sal&gt;(select avg(sal) from emp); group by按部门分组，查出部门平均工资和最高工资1select avg(sal),max(sal),deptno from emp group by deptno; 显示每个部门的每种岗位的平均工资，最高工资1select avg(sal),max(sal),deptno,job from emp group by deptno,job; having 1select avg(sal),max(sal),deptno from emp group by deptno having avg(sal)&gt;2000; 同一条语句出现顺序，优先级group by &gt; having &gt; order by在选择列中，如果有列，表达式和分组函数，那么这些列和表达式中必须有一个出现在group by字句中，否则会报错 多表查询多表查询的条件是至少不能少于表的个数-1笛卡尔集1select a1.ename,a1.sal,a2.dname from emp a1, dept a2 where a1.deptno=a2.deptno; between 在两者之间1select a1.ename,a1.sal,a2.grade from emp a1,salgrade a2 where a1.sal between a2.losal and a2.hisal; 多表排序1select a1.ename,a2.dname,a1.sal from emp a1,dept a2 where a1.deptno=a2.deptno order by a1.deptno; 自连接 子查询数据库执行sql语句从左到右单行子查询1select * from emp where deptno=(select deptno from emp where ename=&apos;SMITH&apos;); 多行子查询1select * from emp where job in(select distinct job from emp where deptno=10); all查出工资比部门30的所有员工的工资都高的员工的姓名，工资和部门号12select ename,sal,deptno from emp where sal&gt;all(select all from emp where deptno=30);select * from emp where sal&gt;(select max(sal) from emp where deptno=30) any查出工资比部门30的任意一个员工的工资高的员工的姓名，工资和部门号12select ename,sal,dept from emp where sal&gt;any(select all from emp where deptno=30);select * from emp where sal&gt;(select min(sal) from emp where deptno=30) 多列子查询查出与SMITH部门和岗位完全相同的所有职员1select * from emp where (deptno,job)=(select deptno,job from emp where ename=&apos;SMITH&apos;); 查询高于自己部门平均工资的员工的信息1select a2.ename,a2.sal,a2.deptno,a1.mysal from emp a2,(select deptno,avg(sal) mysql from emp group by deptno) a1 where a2.deptno=a1.deptno and a2.sal &gt; a1.mysal; 内嵌视图就是子查询当一个表使用，当在from子句中使用子查询时，必须给子查询指定别名；列加别名可以加as，表加别名不能加as 分页查询一共有三种方式 rownum 分页 1select * from (select a1.*,rownum rn from (select * from emp) a1 where rownum&lt;=10) where rn&gt;6; ROWID 分页速度最快 按分析函数分页速度最慢 查询结果创建新表1create table mytable (id,name,sal,job,deptno) as select empno,ename,sal from emp; 合并查询为了合并多个select语句的结果，可以使用集合操作符号union，union all，intersect，minus.union去多个select查询结果的并集，取消重复行union all和union 类似，不取消重复行，or关系intersect取交集结果minus取差集（一个集合完全包含另一个集合，取没有的部分） 数据库管理员职责： 安装和升级oracle数据库 建库，表空间，表，视图，索引…… 指定并实施备份和恢复计划 数据库权限管理，调优，故障排除， 对于高级dba，要求能参与项目开发，会编写sql语句，存储过程，触发器，规则，约束，包 sys用户：所有oracle的数据字典的基表和动态视图都存在sys用户中；sys拥有dba（数据库管理员角色），sysdba（系统管理员），sysoper（系统操作员） 角色和权限；是oracle最高权限用户，必须以as sysdba或as sysoper形式登录，不能以normal方式登录数据库 system 用户：存放次级用户内部数据;拥有dba，sysdba角色及权限； 显示oracle 初始化参数show parameter; 数据库的逻辑备份和恢复 导出表1exp userid=username/passwd@sid tables=(table1,table2,table3) file=/path/x.dmp 导入表1imp userid=username/passwd@sid tables=(table1,table2,table3) file=/path/x.dmp 使用直接导出方式这种方式比默认常规的方式速度要快，当数据量大时，可以考虑这种方法，这时需要数据库的字符集要与客户端的字符集完全一致，否则报错1exp userid=username/passwd@sid tables=(table1,table2,table3) file=/path/x.dmp direct=y 导出表结构1exp userid=username/passwd@sid tables=(table1,table2,table3) file=/path/x.dmp rows=n 导出方案1exp username/passwd@sid owner=username file=/path/x.dmp 导出数据库12exp userid=system/passwd@sid full=y inctype=complete file=/path/xx.dmpimp userid=system/manager full=y file=/path/xx.dmp 数据字典记录了数据库的系统信息，它是只读表和视图的集合，数据字典的所有者为sys用户，用户只能在数据字典上执行查询操作，而其维护和修改是由系统自动完成的数据字典包括字典基表和数据字典动态视图，其中基表存储数据库的基本信息，普通用户不能直接访问数据字典的基表，数据字典视图是基于数据字典基表所建立的视图，普通用户可以通过查询数据字典的视图取得系统信息数据字典视图主要包括user_xxx,all_xxx,dba_xxx三种类型 user_tables;用于显示当前用户拥有的所有表，只返回用户所对应方案的所有表；select table_name from user_tables;all_tables;用于显示当前用户可以访问的所有表;select table_name from all_tables;dba_tables;用户显示所有方案拥有的数据库表。但是查询这种数据库字典视图，要求用户必须是dba角色或是有select any table系统权限。select table_name from dba_tables; 用户名，权限，角色dba_users 可以显示所有数据库用户的详细信息；dba_sys_privs 可以显示用户所具有的系统权限；dba_tab_privs 可以显示用户具有的对象权限;dba_col_privs 可以显示用户具有的列权限；dba_role_privs 可以显示用户所具有的角色。 查询oracle中所有的系统权限，一般是dbaselect from system_privilege_map order by name;查询oracle中所有的角色，一般是dbaselect from dba_roles;查询oracle中所有的对象权限，一般是dbaselect distinct privilege from dba_tab_privs;查询数据表的表空间select tablespace_name from dba_tablespaces; oracle 有多少种角色？select from dba_roles;查询一种角色有多少种权限？a. 一个角色包含的系统权限select from dba_sys_privs where grantee=’CONNECT’;select from role_sys_privs where role=’CONNECT’;b. 一个角色包含的对象权限select from dba_tab_privs where grantee=’CONNECT’;如何查看某个用户具有什么样的角色？select * from dba_role_privs where grantee=’SCOTT’; 显示当前用户可以访问的所有数据字典视图select from dict where comments like ‘%grant%’显示当前数据库的全称select from global_name;]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>数据库</tag>
        <tag>Oracle</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ecFlow安装小记]]></title>
    <url>%2Farlo%2F8af01e65%2F</url>
    <content type="text"><![CDATA[在数值天气预报系统中有大量的计算机任务，这些任务之间又存在错综复杂的关系，如何管理和维护大量的复杂的任务成为一个难题，ecFlow正是为解决这一问题而诞生的。ecFlow是为欧洲中期天气预报中心（ECMWF）制作的产品，作为气象应用软件项目的一部分，用于工作流的管理和监控。它具有如下功能： 提供基于文本的任务定义语言以及python接口对计算机任务进行定义 可以设定任务间的依赖关系，并在依赖关系满足时触发任务 提供任务出错时的容错机制 提供图形化的界面实时查看任务运行状况以及报错信息，用不同颜色来表示任务的运行状态，还可以根据需要自定义显示任务运行的进度。 ecFlow是基于客户端/服务端的模式工作的，即先启动一个ecFlow的服务端，计算机任务作为客户端，客户端任务在运行过程中将自己的状态发送到服务端，服务端根据收到的信息更新作业状态。 本来是就Centos 6.9来安装ecflow的，由于ecflow要求Python版本必须大于2.7，而默认的是2.6.6，自行升级了python，编译后是各种报错，qt也装不上，实在是折腾累了，于是更换为centos7.2操作系统，默认python版本2.7.5，编译一切正常； 依赖关系 cmake g++ Python 2.7 or Python3 Xlib, X11, XMotif for ecflowview Qt for ecFlowUI 下载地址ecFlow：https://software.ecmwf.int/wiki/display/SUP/Releasesboost： http://www.boost.org/users/download/Motif： http://www.ist.co.uk/motif/download/index.htmlQt： http://mirrors.ustc.edu.cn/qtproject/archive/qt/ 安装cmake、g++1[root@vm01 ~]# yum -y install cmake g++ glibc gcc gcc-c++ python-devel openssl-devel zlib-devel ncurses-devel 安装python3 Centos 7默认的python版本是2.7.5，满足要求；不需要安装python3 12345678[root@vm01 ~]# wget https://www.python.org/ftp/python/3.5.0/Python-3.5.0.tar.xz[root@vm01 ~]# tar xvf Python-3.5.0.tar.xz[root@vm01 ~]# cd Python-3.5.0[root@vm01 ~]# ./configure --prefix=/usr/local/python3[root@vm01 ~]# make &amp;&amp; make install[root@vm01 ~]# mv /usr/bin/python /usr/bin/python_old[root@vm01 ~]# ln -s /usr/local/python3/bin/python3 /usr/bin/python[root@vm01 ~]# cp -R /usr/local/python3/lib/* /usr/lib64/ 修改yum中的python版本1234[root@vm01 ~]# vim /usr/bin/yum#!/usr/bin/python 更改为 #!/usr/bin/python_old 安装Xlib, X11, XMotif1[root@vm01 ecFlow]# yum localinstall openmotif-2.1.32-2_IST.x86_64.rpm ecFlowUI 需要图形界面QT支持1234[root@vm01 ecFlow]# yum -y install mesa-libGL-devel mesa-libGLU-devel freeglut-devel git gflags gflags-devel[root@vm01 ecFlow]# yum groupinstall &quot;GNOME Desktop&quot;[root@vm01 ecFlow]# chmod +x qt-opensource-linux-x64-5.8.0.run[root@vm01 ecFlow]# ./qt-opensource-linux-x64-5.8.0.run 安装ecFlow环境12345[root@vm01 ~]# cd /usr/local/src/ecFlow/[root@vm01 ecFlow]# tar xf boost_1_64_0.tar.gz[root@vm01 ecFlow]# tar xf ecFlow-4.5.0-Source.tar.gz[root@vm01 ecFlow]# export WK=/usr/local/src/ecFlow/ecFlow-4.5.0-Source[root@vm01 ecFlow]# export BOOST_ROOT=/usr/local/src/ecFlow/boost_1_64_0 安装boost基于bjam安装boost1234[root@vm01 boost_1_64_0]# cd $BOOST_ROOT[root@vm01 boost_1_64_0]# ./bootstrap.sh[root@vm01 boost_1_64_0]# ./b2[root@vm01 boost_1_64_0]# ./b2 install --prefix=/usr/local 基于python安装boost123[root@vm01 boost_1_64_0]# ./bootstrap.sh --with-python=/usr/bin/python3[root@vm01 boost_1_64_0]# ./b2[root@vm01 boost_1_64_0]# ./b2 install --prefix=/usr/local 如果不需要ecflow的python接口，可以通过下面的设置避免编译boost的python库，在调用$WK/build_scripts/boost_build.sh前设置export ECF_NO_PYTHON=1 123[root@vm01 boost_1_64_0]# cd $BOOST_ROOT[root@vm01 boost_1_64_0]# $WK/build_scripts/boost_1_53_fix.sh[root@vm01 boost_1_64_0]# $WK/build_scripts/boost_build.sh 编译安装ecflow推荐使用cmake 编译ecflow12[root@vm01 boost_1_64_0]# cd $WK[root@vm01 build]# mkdir build; cd build; 1[root@vm01 build]# export CMAKE_PREFIX_PATH=/opt/Qt5.8.0/5.8/gcc_64/lib/cmake/Qt5Network 1234567[root@vm01 build]# vim ../CMakeLists.txt #在最底下添加这行代码set(CMAKE_CXX_FLAGS &quot;$&#123;CMAKE_CXX_FLAGS&#125; -fPIC&quot;) [root@vm01 build]# cmake .. -DCMAKE_INSTALL_PREFIX=/usr/local/ecflow -DCMAKE_BUILD_TYPE=Release -DENABLE_GUI=OFF[root@vm01 build]# CPUS=$(lscpu -p | grep -v &apos;#&apos; | wc -l)[root@vm01 build]# make -j$&#123;CPUS&#125;[root@vm01 build]# make check[root@vm01 build]# make install 参考链接：https://software.ecmwf.int/wiki/display/ECFLOW/Installationhttp://windrocblog.sinaapp.com/?p=1602https://wenku.baidu.com/view/fda9af29bfd5b9f3f90f76c66137ee06eff94e8d.html?re=viewhttp://blog.csdn.net/u013121305/article/details/49853713]]></content>
      <categories>
        <category>大气模型</category>
      </categories>
      <tags>
        <tag>ecFlow</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Centos 7下KVM 虚拟机搭建]]></title>
    <url>%2Farlo%2F8ae03ce9%2F</url>
    <content type="text"><![CDATA[KVM（Kernel-based Virtual Machine）是支持虚拟化扩展（Intel VT 或 AMD-V技术）x86硬件的Linux完全虚拟化解决方案。它包括了一个可加载的内核模块kvm.ko，提供了核心的虚拟化架构以及一个处理器特定模块（kvm-intel.ko或kvm-amd.ko）。使用KVM，用户可以运行多个无需修改的Linux或Windows虚拟机。每个虚拟机有自己私有的虚拟硬件：网卡、磁盘、显卡等等。 系统化境iptables offselinux disabled 安装kvm虚拟化查看cpu是否支持全虚拟化1grep -E &apos;(vmx|svm)&apos; /proc/cpuinfo 安装虚拟化组件1yum install qemu-kvm qemu-img virt-manager libvirt libvirt-python libvirt-client virt-install virt-viewer bridge-utils 启动并设置开机自启动虚拟化服务12systemctl start libvirtdsystemctl enable libvirtd 检查虚拟化模块是否加载1lsmod | grep kvm 安装图形界面1yum -y groupinstall &quot;GNOME Desktop&quot; 图形化管理工具1virt-manager 配置桥接网络拷贝一个br0网络配置文件cd /etc/sysconfig/network-scripts/cp ifcfg-em1 ifcfg-br0配置ifcfg-em112345TYPE=EthernetBOOTPROTO=staticDEVICE=em1ONBOOT=yesBRIDGE=br0 配置ifcfg-br012345678TYPE=BridgeBOOTPROTO=staticDEVICE=br0ONBOOT=yesIPADDR=192.168.6.122NETMASK=255.255.255.0GATEWAY=192.168.6.1DNS1=223.5.5.5 重启网络1systemctl restart network 查看br0状态12ip addr show br0brctl show 创建一个存储池centos7操作系统安装的时候，自动分区时，大部分空间划分给/home分区了，默认的存储在/var/lib/libvirt/images目录下，在创建虚拟机之前我需要创建一个存储池；规划在/home/kvm/images 目录下新建目录并设置权限1mkdir -p /home/kvm/images;chown root:root /home/kvm/images;chmod 755 /home/kvm/images; 创建存储池12345678910111213#定义一个存储池绑定目录virsh pool-define-as StoragePool --type dir --target /home/kvm/images;#建立基于文件夹的存储池virsh pool-build StoragePool;#激活StoragePoolvirsh pool-start StoragePool;#存储池开机自动运行,使用virsh pool-autostartvirsh pool-autostart StoragePool;#查看存储池的信息virsh pool-info StoragePool#查看创建的所有存储池virsh pool-list 创建一个数据卷1virsh vol-create-as --pool StoragePool --name sql_server_2012.qcow2 100G --format qcow2 查看存储卷信息12virsh vol-info --pool StoragePool sql_server_2012.qcow2 virsh vol-info /home/kvm/images/sql_server_2012.qcow2 删除一个数据卷1virsh vol-delete --pool StoragePool sql_server_2012.qcow2 创建虚拟机命令行创建虚拟机1virt-install --name sql_server_2012 --memory 4096 --vcpus sockets=1,cores=2,threads=2 --disk device=cdrom,path=/home/cn_windows_server_2012_r2_x64_dvd_2707961.iso --disk path=/home/kvm/images/sql_server_2012.qcow2 --network bridge=br0,model=e1000 --noautoconsole --accelerate --hvm --graphics vnc,listen=0.0.0.0,password=123456,port=20007 --cpu host-passthrough --autostart 图形界面创建安虚拟机1virt-manager （过程略） virtsh 常用指令1）virsh list 列出当前虚拟机列表，不包括未启动的2）virsh list –all 列出所有虚拟机，包括所有已经定义的虚拟机3）virsh destroy vm-name 关闭虚拟机4）virsh start vm-name 启动虚拟机5）virsh edit vm-name 编辑虚拟机xml文件6）virsh undefine vm-name 删除虚拟机7）virsh shutdown vm-name 停止虚拟机8）virsh reboot vm-name 重启虚拟机9）virsh autostart vm-name 虚拟机随宿主机启动 virsh pool与vol命令帮助1234567891011121314151617181920212223242526272829303132333435363738Storage Pool (help keyword &apos;pool&apos;) find-storage-pool-sources-as 找到潜在存储池源 find-storage-pool-sources 发现潜在存储池源 pool-autostart 自动启动某个池 pool-build 建立池 pool-create-as 从一组变量中创建一个池 pool-create 从一个 XML 文件中创建一个池 pool-define-as 在一组变量中定义池 pool-define define an inactive persistent storage pool or modify an existing persistent one from an XML file pool-delete 删除池 pool-destroy 销毁（删除）池 pool-dumpxml XML 中的池信息 pool-edit 为存储池编辑 XML 配置 pool-info 存储池信息 pool-list 列出池 pool-name 将池 UUID 转换为池名称 pool-refresh 刷新池 pool-start 启动一个（以前定义的）非活跃的池 pool-undefine 取消定义一个不活跃的池 pool-uuid 把一个池名称转换为池 UUID Storage Volume (help keyword &apos;volume&apos;) vol-clone 克隆卷。 vol-create-as 从一组变量中创建卷 vol-create 从一个 XML 文件创建一个卷 vol-create-from 生成卷，使用另一个卷作为输入。 vol-delete 删除卷 vol-download 将卷内容下载到文件中 vol-dumpxml XML 中的卷信息 vol-info 存储卷信息 vol-key 为给定密钥或者路径返回卷密钥 vol-list 列出卷 vol-name 为给定密钥或者路径返回卷名 vol-path 为给定密钥或者路径返回卷路径 vol-pool 为给定密钥或者路径返回存储池 vol-resize 创新定义卷大小 vol-upload 将文件内容上传到卷中 vol-wipe 擦除卷 参考：http://www.linuxtechi.com/install-kvm-hypervisor-on-centos-7-and-rhel-7/http://wangying.sinaapp.com/archives/1893http://wangying.sinaapp.com/archives/1914]]></content>
      <categories>
        <category>虚拟化</category>
      </categories>
      <tags>
        <tag>虚拟化</tag>
        <tag>kvm</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Tomcat多实例部署]]></title>
    <url>%2Farlo%2F42b916ee%2F</url>
    <content type="text"><![CDATA[同一个tomcat下部署多个项目，重启会影响到其他项目的正常运行，为了使各项目独立，一般会使用安装多个tomcat，这样很耗费系统资源；创建tomcat多实例，有效的解决这一问题； 常见部署方式单实例单应用：比较常用的一种方式，只需要把你打好的 war 包丢在 webapps目录下，执行启动 Tomcat 的脚本就行了。单实例多应用：有两个不同的 Web 项目 war 包，还是只需要丢在webapps目录下，执行启动 Tomcat 的脚本，访问不同项目加上不同的虚拟目录。这种方式要慎用在生产环境，因为重启或挂掉 Tomcat 后会影响另外一个应用的访问。多实例单应用：多个 Tomcat 部署同一个项目，端口号不同，可以利用 Nginx 这么做负载均衡，当然意义不大。多实例多应用：多个 Tomcat 部署多个不同的项目。这种模式在服务器资源有限，或者对服务器要求并不是很高的情况下，可以实现多个不同项目部署在同一台服务器上的需求，来实现资源使用的最大化。 目录作用bin 主要存放脚本文件，例如比较常用的windows和linux系统中启动和关闭脚本conf 主要存放配置文件，其中最重要的两个配置文件是server.xml和web.xmllib 主要存放tomcat运行所依赖的包logs 主要存放运行时产生的日志文件，例如catalina.{date}.log等temp 存放tomcat运行时产生的临时文件，例如开启了hibernate缓存的应用程序，会在该目录下生成一些文件webapps 部署web应用程序的默认目录work 主要存放由JSP文件生成的servlet（java文件以及最终编译生成的class文件） CATALINA_HOME：即指向Tomcat安装路径的系统变量CATALINA_BASE：即指向活跃配置路径的系统变量通过设置这两个变量，就可以将tomcat的安装目录和工作目录分离，从而实现tomcat多实例的部署。 将tomcat复制为以下目录结构 修改$CATALINA_HOME/conf/server.xml在server.xml中配置了四个监听端口，分别是：Server Port： 该端口用于监听关闭tomcat的shutdown命令，默认为8005Connector Port： 该端口用于监听HTTP的请求，默认为8080AJP Port： 该端口用于监听AJP（ Apache JServ Protocol ）协议上的请求，通常用于整合Apache Server等其他HTTP服务器，默认为8009Redirect Port： 重定向端口，出现在Connector配置中，如果该Connector仅支持非SSL的普通http请求，那么该端口会把https的请求转发到这个Redirect Port指定的端口，默认为8443 修改第22行Server Port （三个tomcat依次修改为8005,8006,8007）1&lt;Server port=&quot;8007&quot; shutdown=&quot;SHUTDOWN&quot;&gt; 修改第71行Connector Port(三个tomcat依次修改为8080,8081,8082)1&lt;Connector port=&quot;8082&quot; protocol=&quot;HTTP/1.1&quot; 修改第93行AJP Port (三个tomcat依次修改为8009,8019,8029)1&lt;Connector port=&quot;8029&quot; protocol=&quot;AJP/1.3&quot; redirectPort=&quot;8443&quot; /&gt; 虚拟主机配置name： 虚拟主机的名称，一台主机表示了完全限定的域名或IP地址，默认为localhost，同时也是唯一的host，进入tomcat的所有http请求都会映射到该主机上appBase： web应用程序目录的路径，可以是CATALINA_HOME的相对路径，也可以写成绝对路径，默认情况下为$CATALINA_HOME/webappsunpackWARs： 表示是否自动解压war包autoDeploy： 所谓的热部署，即在tomcat正在运行的情况下，如果有新的war加入，则会立即执行部署操作deployOnStartup： 表示tomcat启动时是否自动部署appBase目录下所有的Web应用程序，默认为true。这个属性和autoDeploy会产生两次部署的“副作用”：一次是tomcat启动时就开始部署，第二次就是autoDeploy引起的热部署。因此最好将autoDeploy置为false 修改第125-127行虚拟主机配置 (三个tomcat参考以下内容依次修改)123&lt;Host name=&quot;c.com&quot; appBase=&quot;/data/tomcat/c.com/&quot; unpackWARs=&quot;true&quot; autoDeploy=&quot;false&quot;&gt;&lt;Context path=&quot;/hello&quot; docBase=&quot;/data/tomcat/c.com/hello.war&quot; /&gt; 启动&amp;关闭脚本脚本放在CATALINA_BASE(如：/opt/tomcat1/)下123456789101112131415161718192021222324252627#!/bin/sh# description: 启动tomcat多实例.. /etc/init.d/functionsRETVAL=$?# tomcat实例目录export CATALINA_BASE=&quot;$PWD&quot;# tomcat安装目录export CATALINA_HOME=&quot;/opt/&quot;case &quot;$1&quot; instart)if [ -f $CATALINA_HOME/bin/startup.sh ];thenecho $&quot;Start Tomcat&quot;$CATALINA_HOME/bin/startup.shfi;;stop)if [ -f $CATALINA_HOME/bin/shutdown.sh ];thenecho $&quot;Stop Tomcat&quot;$CATALINA_HOME/bin/shutdown.shfi;;*)echo $&quot;Usage: $0 &#123;start|stop&#125;&quot;exit 1;;esacexit $RETVAL 因为启动脚本中有获取当前路径的操作，一定需要cd到tomcat.sh的当前目录下执行才可以 123456cd /opt/tomcat1./tomcat.sh start|stopcd /opt/tomcat2./tomcat.sh start|stopcd /opt/tomcat3./tomcat.sh start|stop 访问8080,8081,8082端口验证 参考地址：http://www.jianshu.com/p/0b549d00ecc2http://www.ttlsa.com/tomcat/config-multi-tomcat-instance/]]></content>
      <categories>
        <category>服务器搭建</category>
      </categories>
      <tags>
        <tag>Tomcat</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[jenkins 持续集成环境搭建]]></title>
    <url>%2Farlo%2Fc0b31722%2F</url>
    <content type="text"><![CDATA[持续集成 持续集成（CI）是一种软件工程流程，将所有工程师对于软件的工作复本，每天集成数次到共用主线（mainline）上。 依赖以下原则达到目标 维护一个代码库 自动建置 让建置时会自我测试 所有人每天至少提交一次 应该要建置每一个提交 让建置维持快速 用在线环境的复本测试 让获取最新发布版本更容易 任何人都可以查看最后建置的结果 自动部署 产生的效益 及早发现集成错误且由于修订的内容较小所以易于追踪，这可以节省项目的时间与成本。 避免发布日期的前一分钟发生混乱，当每个人都会尝试为他们所造成的那一点点不兼容的版本做检查。 当单元测试失败或发生错误，若开发人员需要在不除错的情况下还原代码库到一个没有问题的状态，只需要放弃一小部分的更改 (因为集成的次数频繁)。 让 “最新” 的程序可保持可用的状态供测试、展示或发布用。 频繁的提交代码会促使开发人员创建模块化，低复杂性的代码。 Jenkins是一个用Java编写的开源的持续集成工具，前身是Hudson (软件)项目，有丰富的插件支持； Jenkins安装安装jdkjdk下载地址： http://www.oracle.com/technetwork/java/archive-139210.html1tar xf jdk-8u112-linux-x64.tar.gz -C /usr/local/ 配置jdk环境变量vim /etc/profile123export JAVA_HOME=/usr/local/jdk1.8.0_112export CLASSPATH=.:$JAVA_HOME/lib/:$JAVA_HOME/jre/lib/export PATH=$JAVA_HOME/bin:$PATH 安装jenkins123wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.reporpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.keyyum install jenkins 添加java路径到jenkins启动脚本中vim /etc/init.d/jenkins1/usr/local/jdk1.8.0_112/bin/java 修改jenkins默认时区12vim /etc/sysconfig/jenkinsJENKINS_JAVA_OPTIONS=&quot;-Djava.awt.headless=true -Dorg.apache.commons.jelly.tags.fmt.timeZone=Asia/Shanghai&quot; 启动jenkins12/etc/init.d/jenkins startchkconfig --level 35 jenkins on 访问路径 http://192.168.6.102:8080默认密码存在这个文件中 /var/lib/jenkins/secrets/initialAdminPassword创建一个管理用户 Jenkins 配置全局工具配置点击系统配置-Global Tool Configuration针对项目中使用的jdk和maven情况添加对应的版本 插件安装配置点击系统配置-插件管理 可选插件直接安装右上角的过滤功能很好用，可以直接搜索安装安装以下插件Hudson SCP publisher pluginDeploy to container PluginMaven Integration pluginPublish Over SSHPublish Over CIFSBackup plugin / ThinBackupEmail Ext Recipients Column Plugin 高级选项中上传插件安装http://mirrors.jenkins-ci.org/plugins/安装完插件之后，建议重启一下jenkins，防止插件未加载上，不生效； 发布一个静态网站配置Hudson SCP publisher plugin插件此插件用于发布静态网站，拷贝文件很方便配置需要发布的服务器hostname，端口，路径，用户名，密码（如果是正式环境，不建议使用root用户） ps:这里有个小技巧，如果这台机器上有多个静态网站目录的话，可以在服务器设置多个hosts记录，这里使用主机名来分区不同的路径 新建一个软件项目test源码管理：填写svn路径有获取代码权限的用户名密码构建后操作：选择需要scp的路径Source ** 表示所有Keep Hierarchy 保持目录结构（否则不能拷贝文件夹）点击立即构建通过 Console Output可以看到详细日志至此，一个静态网站就发布完成了！ 发布一个java后台工程安装Deploy to container Plugin插件此插件可以将war/ear 包发布到tomcat，glassfish，jetty，weblogic等中间件上 配置tomcat web管理vim /usr/local/apache-tomcat-7.0.77/conf/tomcat-users.xml123456&lt;role rolename=&quot;tomcat&quot;/&gt;&lt;role rolename=&quot;role1&quot;/&gt;&lt;role rolename=&quot;manager-gui&quot;/&gt;&lt;role rolename=&quot;manager-gui,manager-script,manager-jmx,manager-status&quot;/&gt;&lt;user username=&quot;tomcat&quot; password=&quot;tomcat&quot; roles=&quot;manager-gui&quot;/&gt;&lt;user username=&quot;admin&quot; password=&quot;admin&quot; roles=&quot;manager-gui,manager-script,manager-jmx,manager-status&quot;/&gt; 由于jenkins把8080端口占用，我这里修改tomcat端口为8081vim /usr/local/apache-tomcat-7.0.77/conf/server.xml1&lt;Connector port=&quot;8081&quot; protocol=&quot;HTTP/1.1&quot; 一个简单的maven工程代码https://github.com/nsxq/hello-world-war maven 的简单使用查看版本1mvn -version 查看详细信息1mvn X 测试1mvn test 清理（target目录下的编译内容）1mvn clean 编译项目1mvn compile 打包发布1mvn package 生成eclipse项目文件1mvn eclipse:eclipse 产生site1mvn site 安装当前工程的jar安装到本地仓库1mvn install 安装jar包到本地仓库1mvn install:install-file -DgroupId=com.oracle -DartifactId=ojdbc14 -Dversion=10.2.0.4.0 -Dpackaging=jar -Dfile=/usr/local/src/ojdbc14-10.2.0.4.0.jar 分析项目的依赖信息1mvn dependency:analyze / mvn dependency:tree 新建一个maven工程获取代码编译参数构建后发布点击立即构建查看日志，已经发布完成了访问项目http://192.168.6.102:8081/hello至此，一个maven工程已经实现自动化编译、打包、发布！ 版本回退有时候发布一个新版本失败或发布有问题，我们需要回滚到指定版本的构建，这样才能更灵活的进行项目的构建部署。我们可以选择“参数化的构建过程”进行传递不同的参数来选择是进行新的构建还是退 对文件进行存档为了能够进行版本回退，构建完成的需要对文件进行存档 使用参数化构建过程让后面的脚步可以根据不同的变量执行不同的操作。添加“Choice”参数配置不同的选项，让选择发布还是回滚，添加“String Parameter”参数来传递要回退的版本号。 构建选择“Execute Shell”的方式自己根据变量，自定义构建的脚本，此时如果是发布安装maven的构建过程进行新的构建，如果是回滚，知道历史构建后的文件，复制到当前构建结果目录。12345678910111213141516case $deploy_env in deploy) echo &quot;deploy:$deploy_env&quot; mvn clean test compile install package ;; rollback) echo &quot;rollback:$deploy_env&quot; echo &quot;version: $version&quot; rm -fr target/hello-1.war cp -R $&#123;JENKINS_HOME&#125;/jobs/myapp/builds/$&#123;version&#125;/com.efsavage\$hello/archive/com.efsavage/hello/1/hello-1.war . pwd &amp;&amp; ls ;; *) exit ;;esac 执行回退操作点击构建，根据不同的参数选择发布还是版本回退，回退的时候填写要回退到的历史版本号 PS: Tomcat8配置web管理后，Tomcat访问 manager页面 报403的解决办法：https://blog.52itstyle.com/archives/274/]]></content>
      <categories>
        <category>自动化运维</category>
      </categories>
      <tags>
        <tag>自动化</tag>
        <tag>运维</tag>
        <tag>Jenkins</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[使用 Cobbler 自动化和管理系统安装]]></title>
    <url>%2Farlo%2Fbb0f7c70%2F</url>
    <content type="text"><![CDATA[Cobbler是一套快速搭建网络自动化安装操作系统的软件，个人感觉是PXE的升级版;提供cli和web两种管理方式，还提供API接口系统环境：Centos7_x64Iptables offSelinux disabled Cobbler对象类型发行版（distro）：表示一个操作系统。它承载了内核和 initrd 的信息，以及内核参数等其他数据。配置文件（profile）：包含一个发行版、一个 kickstart 文件以及可能的存储库，还包含更多特定的内核参数等其他数据。系统（system）：表示要配给的机器。它包含一个配置文件或一个镜像，还包含 IP 和 MAC 地址、电源管理（地址、凭据、类型）以及更为专业的数据等信息。存储库（repository）：保存一个 yum 或 rsync 存储库的镜像信息。镜像（image）：可替换一个包含不属于此类别的文件的发行版对象（例如，无法分为内核和 initrd 的对象）。基于注册的对象以及各个对象之间的关联，Cobbler 知道如何更改文件系统以反映具体配置。因为系统配置的内部是抽象的，所以您可以仅关注想要执行的操作。 Cobbler安装安装系统扩展包安装后报错可以参考http://islocal.cc/2017/04/06/yum-安装epel扩展后报错/1yum -y install epel-release 安装需要的其他组件1yum -y install rsync tftp httpd pykickstart xinetd 安装cobbler程序包和fence代理包fence代理包是执行电源管理活动的1yum -y install cobbler fence-agents 启动cobbler 服务1systemctl start cobblerd httpd 检查配置文件1cobbler check Q1：修改cobbler服务器地址1server: 192.168.6.103 Q2：修改dhcp服务器地址1next_server: 192.168.6.103 Q3：修改/etc/selinux/config配置1SELINUX=disabled Q4：修改/etc/xinetd.d/tftp 配置1disable = no Q5：下载需要的网络引导文件1cobbler get-loaders Q6：启动并设置开机启动rsyncd服务12systemctl start rsyncd.servicesystemctl enable rsyncd.service Q7：这个是基于debian操作系统的错误centos系统下忽略，不予处理 Q8：修改安装系统后默认的root密码为’ffffff’123openssl passwd -1 -salt &apos;random123&apos; &apos;ffffff&apos;vim /etc/cobbler/settingsdefault_password_crypted: &quot;$1$random12$KuDtGsOHnRfzasr7D4qI40&quot; 配置Cobbler编辑主配置文件vim /etc/cobbler/settings12345678manage_dhcp: 1 manage_dns: 1manage_tftpd: 1restart_dns: 1restart_dhcp: 1pxe_just_once: 1next_server: &lt;dhcp服务器地址，即本机&gt;server:&lt;cobbler 服务器地址&gt; 以上部分选项之前已经配置或者默认选项已符合要求manage cobbler可以管理服务restart cobbler 可以重启服务pxe_just_once 预防将机器中的安装循环配置为始终从网络引导。激活此选项时，机器告诉 Cobbler 安装已完成 指定cobbler管理服务使用的程序vim /etc/cobbler/modules.conf123456[dns]module = manage_dnsmasq[dhcp]module = manage_dnsmasq[tftpd]module = manage_in_tftpd 配置dhcp服务使用dnsmasq提供dns和dhcp服务这里要保证dhcp设置的ip网段要和本机在同一网段，否则client找不到dhcp服务器 通常，您希望阻止未注册的客户端从服务器引导。为此，添加参数 dhcp-ignore=tag:!known。（在以前的版本中，语法可能有所不同：dhcp-ignore=#known。如果有疑问，您可以同时插入两个版本。） vim /etc/cobbler/dnsmasq.template1dhcp-range=192.168.6.200,192.168.6.210,255.255.255.0 同步cobbler数据1cobbler sync 重启服务1systemctl restart httpd cobblerd xinetd rsyncd dnsmasq 客户机从网络启动，可以看到已经可以获取到ip地址了 创建操作系统创建一个发行版本123mkdir /opt/centos6.9/mount -o loop /opt/CentOS-6.9-x86_64-bin-DVD1.iso /opt/centos6.9/cobbler import --path=/opt/centos6.9/ --name=&quot;Centos6.9&quot; 查看发行版本12cobbler distro listcobbler distro report 查看配置文件可以看到这里默认的ks文件是sample_end.ks12cobbler profile listcobbler profile report 使用自定义ks文件 使用图形化system-config-kickstart工具创建ks文件 使用系统生成的ks文件模板修改kiskstart 文件内容123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081# kickstart template for Fedora 8 and later.# (includes %end blocks)# do not use with earlier distros#platform=x86, AMD64, or Intel EM64T# System authorization informationauth --useshadow --enablemd5# System bootloader configurationbootloader --location=mbr# Partition clearing informationclearpart --all --initlabel# Use text mode installtext# Firewall configurationfirewall --disable# Run the Setup Agent on first bootfirstboot --disable# System keyboardkeyboard us# System languagelang en_US# Use network installationurl --url=$tree# If any cobbler repo definitions were referenced in the kickstart profile, include them here.$yum_repo_stanza# Network information$SNIPPET(&apos;network_config&apos;)# Reboot after installationreboot#Root passwordrootpw --iscrypted $default_password_crypted# SELinux configurationselinux --disabled# Do not configure the X Window Systemskipx# System timezonetimezone Asia/Shanghai# Install OS instead of upgradeinstall# Clear the Master Boot Recordzerombr# Allow anaconda to partition the system as neededautopart%pre$SNIPPET(&apos;log_ks_pre&apos;)$SNIPPET(&apos;kickstart_start&apos;)$SNIPPET(&apos;pre_install_network_config&apos;)# Enable installation monitoring$SNIPPET(&apos;pre_anamon&apos;)%end%packages$SNIPPET(&apos;func_install_if_enabled&apos;)@base@development%end%post --nochroot$SNIPPET(&apos;log_ks_post_nochroot&apos;)%end%post$SNIPPET(&apos;log_ks_post&apos;)# Start yum configuration$yum_config_stanza# End yum configuration$SNIPPET(&apos;post_install_kernel_options&apos;)$SNIPPET(&apos;post_install_network_config&apos;)$SNIPPET(&apos;func_register_if_enabled&apos;)$SNIPPET(&apos;download_config_files&apos;)$SNIPPET(&apos;koan_environment&apos;)$SNIPPET(&apos;redhat_register&apos;)$SNIPPET(&apos;cobbler_register&apos;)# Enable post-install boot notification$SNIPPET(&apos;post_anamon&apos;)# Start final steps$SNIPPET(&apos;kickstart_done&apos;)# End final steps%end 添加一个profile12cobbler profile add --distro=&quot;Centos6.9-x86_64&quot; --name=centos6.9_customized \--kickstart=/var/lib/cobbler/kickstarts/CentOS6.9_cust.cfg ### 修改已有的profile1cobbler profile edit --name=centos6.9_customized --kickstart=/var/lib/cobbler/kickstarts/CentOS6.9_cust.cfg 添加第三方yum仓库这一步好像有点问题会报错，网上资料说这是一个bug123cobbler repo add --name=163mirrors --mirror=http://mirrors.163.com/centos/6.9/os/x86_64/cobbler reposynccobbler repo report 将仓库文件与配置文件（profile）关联起来1cobbler profile edit --name=Centos6.9-x86_64 --repos=163mirros 安装web管理界面安装cobbler-web包1yum -y install cobbler-web Cobbler Web 界面的身份验证和授权配置/etc/cobbler/modules.conf123[authentication]module = authn_pam[authorization] = authz_ownership 新建系统账号并设置密码12useradd cobbler echo &quot;cobbler&quot; | passwd --stdin cobbler 添加用户到管理组vim /etc/cobbler/users.conf12[admins]admin = &quot;cobbler&quot; 重启服务1systemctl restart cobblerd httpd 使用https url访问https://192.168.6.103/cobbler_web12user：cobblerpasswd：cobbler 安装操作系统 开机 选择从网络引导，dhcp获取ip地址 选择profile，通过tftp获取引导内核文件 调用ks文件进行无人值守安装操作系统 重装操作系统这个是针对已经安装操作系统的服务器进行重新安装，个人感觉这种方式除了不用调整从网络启动之外，没看出来比较实用的特性 在客户端机器安装koan软件12yum -y install epelyum -y install koan Koan 用法查看cobbler server 上的profile文件列表1koan --server=192.168.6.250 --list=profiles 查看profile详细信息1koan --server=192.168.6.250 --display --profile=Centos6.9-x86_64 下次重启时重装操作系统12koan --server=192.168.6.250 -replace-self --profile=Centos6.9-x86_64reboot 安装windows操作系统制作PE iso镜像下载一个PE系统上传至cobbler服务器/data目录 创建一个distro1cobbler distro add --name=&quot;WePe_x64&quot; --kernel=/var/lib/tftpboot/memdisk --initrd=/data/WePE_64_V2.0.iso --kopts=&quot;raw iso&quot; 创建空白kickstart文件，并对winPE发行版添加profile12touch /var/lib/cobbler/kickstarts/WePe_x64.xmlcobbler profile add --name=WePe_x64 --distro=WePe_x64 --kickstart=/var/lib/cobbler/kickstarts/WePe_x64.xml 同步cobbler1cobbler sync windows 操作系统安装这个，目前只是做了一个网络版的PE，网上有教程说使用samba共享镜像，我这里没有成功，可以参考这篇文章;到这里一个最基本的cobbler自动化安装操作系统的环境就搭建完成了，只是完成了distro和profile部分，后期在学习system部分。 参考资料：https://www.ibm.com/developerworks/cn/linux/l-cobbler/http://blog.codecp.org/2016/11/02/Centos7部署cobbler/]]></content>
      <categories>
        <category>自动化运维</category>
      </categories>
      <tags>
        <tag>自动化</tag>
        <tag>运维</tag>
        <tag>Cobbler</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[WRF模型学习（1）--安装篇]]></title>
    <url>%2Farlo%2F7943f5da%2F</url>
    <content type="text"><![CDATA[WRF简介WRF全称Weather Research and Forecasting Model, 是一个先进的大气建模系统，专为气象研究和数值天气预报而设计。它为大气过程提供了许多选项，可以在各种计算平台上运行。WRF在数千米到数千公里范围内的应用范围广泛，包括以下内容。 气象研究 实时NWP 理想模拟 数据同化 地球系统模型耦合 示范训练和教育支持 官方网站：http://www.wrf-model.org/index.phphttps://www2.ucar.edu/https://zh.wikipedia.org/wiki/NetCDF 系统环境VMware Wrokstation 12 proCentOS 6.4 x64 软件环境zlib-1.2.11.tar.gzhdf5-1.8.18.tarnetcdf-4.4.1.1.tar.gznetcdf-fortran-4.4.4.tar.gzpgilinux-2016-1610-x86_64.tar.gzWRFV3.8.1.TAR.gzWPSV3.8.1.TAR.gz WRF 模型安装安装WRF模型的的顺序为：WRF–&gt;WPS–&gt;WRF-chem等WRF模拟系统主要包含WPS和WRF两部分模块： WPS模块全称为WRF Pre-processing System，即WRF预处理系统，用来为WRF模型准备输入数据；如果只是做理想实验(idealized modeling)，就不需要用WPS处理真实数据。WRF模块就是数值求解的模块，它有两个版本：ARW(Advanced Research WRF) 和 NMM(Nonhydrostatic Mesoscale Model)。大多数研究者主要用的都是ARW版本。 除了WPS与WRF两大核心模块外，WRF系统还有很多附加模块：比如用于数据同化的WRF-DA，用于化学传输的WRF-chem，用于林火模拟的WRF-fire。 安装依赖zlib1234# tar xf zlib-1.2.11.tar.gz# cd zlib-1.2.11# ./configure --prefix=/usr/local/zlib/# make &amp;&amp; make install 安装依赖hdf51234# tar xf hdf5-1.8.18.tar# cd hdf5-1.8.18#./configure --prefix=/usr/local/hdf5/ --with-zlib=/usr/local/zlib/# make &amp;&amp; make install 安装依赖netcdf1234# tar xf netcdf-4.4.1.1.tar.gz# cd netcdf-4.4.1.1# ./configure --prefix=/usr/local/netcdf/ --enable-netcdf-4 LDFLAGS=&quot;-L/usr/local/hdf5/lib/&quot; CPPFLAGS=&quot;-I/usr/local/hdf5/include/&quot;# make &amp;&amp; make install 安装依赖netcdf-fortran1234# tar xf netcdf-fortran-4.4.4.tar.gz # cd netcdf-fortran-4.4.4# ./configure --prefix=/usr/local/netcdf/ LDFLAGS=&quot;-L/usr/local/netcdf/lib&quot; CPPFLAGS=&quot;-I/usr/local/netcdf/include&quot; FC=gfortran# make &amp;&amp; make install 此步骤中报错可以查看日志文件config.log 进行解决我遇到的问题configure: error: cannot compute sizeof (off_t)，最终是设置了环境变量解决的123export LDFLAGS=&quot;-L/usr/local/netcdf/lib/&quot;export CPPFLAGS=&quot;-I/usr/local/netcdf/include/&quot;export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/netcdf/lib/ 安装WRF模型1234# tar xf WRFV3.8.1.TAR.gz # cd WRFV3# export NETCDF=/usr/local/netcdf/# ./configure 这里我选择的32，使用gfortran/gcc编译。serial 表示串行计算；smpar 表示内存共享并行计算(shared memory option)，即使用openMP，大部分多核电脑都支持这项功能；dmpar 表示分布式并行计算(distributed memory option)，即使用MPI 进行并行计算，主要用在计算集群，单个电脑就没必要用了；dm+sm 表示同时使用openMP与MPI两种并行方式. 如果使用pgi（选择1）编译的话，需要自行安装pgilinux包，否则会报错”pgf90: Command not found.”1# ./compile em_real &gt;&amp; compile.log 编译类型有以下几种WRF-Chem（WRF大气化学模型）em_real （3D真实情况）em_quarter_ss （3D理想的情况下）em_b_wave （3D理想的情况下）em_les （3D理想的情况下）em_heldsuarez （3D理想的情况下）em_tropical_cyclone （3D理想的情况下）em_hill2d_x （2D理想的情况下）em_squall2d_x （2D理想的情况下）em_squall2d_y （ 2d理想情况）em_grav2d_x （2d理想情况）em_seabreeze2d_x （2d理想情况）em_scm_xy （1d理想情况） 真实情况编译完成后，在main目录下会出现ndown.exe,real.exe, tc.exe, wrf.exe这4个可执行程序；理想情况编译后会生成wrf.exe，ideal.exe 这2个可执行程序。 安装WPS模型要保证WPS和WRFV3在同级目录，configure.wps文件中有相对路径安装依赖包123456# yum -y install libpng libpng-devel jasper jasper-devel libjpeg libjpeg-devel# export COMPRESSION_LIBS=-L/usr/lib64/# export COMPRESSION_INC=-I/usr/lib64/# tar xf WPSV3.8.1.TAR.gz# cd WPS# ./configure 这里选择1即可1# ./compile 编译完成后再当前目录下会出现geogrid.exe、metgrid.exe、ungrib.exe 三个可执行程序到这里WRF模型的安装工作就已经完成了，第一次安装，记录一下! 参考链接：https://xg1990.com/blog/archives/190http://www2.mmm.ucar.edu/wrf/OnLineTutorial/compilation_tutorial.php]]></content>
      <categories>
        <category>大气模型</category>
      </categories>
      <tags>
        <tag>WRF</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[yum 安装epel扩展后报错]]></title>
    <url>%2Farlo%2Fef6f2f28%2F</url>
    <content type="text"><![CDATA[安装epel扩展后出现的几个问题 A1：Error: Cannot retrieve metalink for repository: epel. Please verify its path and try again编辑/etc/yum.repo/epel.repo文件,12345#baseurlmirrorlist改成baseurl#mirrorlist A2:PYCURL ERROR 7 - “Failed to connect to 2001:4178:5:200::10: Network is unreachable”123vim /etc/yum.conf[main]ip_resolve=4 A3:[Errno 14] problem making ssl connection[Errno 14] PYCURL ERROR 7 - Failed to connect to 2605:bc80:3010:600:dead:beef:cafe:fed9: Network is unreachable123yum install ca-certificates -yyum clean allyum list]]></content>
      <categories>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>常识</tag>
        <tag>epel</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MPICHI3 并行计算环境搭建]]></title>
    <url>%2Farlo%2Fundefined%2F</url>
    <content type="text"><![CDATA[新工作接触到HPC高性能计算项目，最近看了一些HPC高性能计算的理论资料，今天搭建MPICHI 并行计算环境，算是开始HPC的学习之路吧！ 系统环境CentOS 6_x64 设置hostsvim /etc/hosts123192.168.6.100 vm00192.168.6.101 vm01192.168.6.102 vm02 新建用户12# useradd -u 600 pxb# echo ffffff|passwd --stdin pxb 配置机器ssh无密码连接12345678# su - pxb$ ssh-keygen 默认一直回车$ ssh-copy-id vm00$ ssh-copy-id vm01$ ssh-copy-id vm02$ ssh vm00$ ssh vm01$ ssh vm03 安装MPICHI（三台服务器上执行以下相同操作）获取mpichihttps://www.mpich.org/downloads/ 安装配置MPICHI1234# tar -xf mpich-3.2.tar.gz# cd mpich-3.2# ./configure --prefix=/usr/local/mpich/# make &amp;&amp; make install $ vim ~/.bash_profile$ export PATH=$PATH:/usr/local/mpich/bin/$ source ~/.bash_profile$ echo $PATH 新建machinefile$ vim ~/machinefile123vm00vm01vm02 测试MPICHI，跑圆周率程序1$ /usr/local/mpich/bin/mpiexec -n 3 -machinefile machinefile ~/mpich-3.2/examples/cpi -n 是使用多少节点-machinefile 集群节点文件]]></content>
      <categories>
        <category>HPC</category>
      </categories>
      <tags>
        <tag>HPC</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mailx 发送邮件小计]]></title>
    <url>%2Farlo%2F670d97dc%2F</url>
    <content type="text"><![CDATA[安装postfix服务yum install postfix/etc/init.d/postfix startchkconfig postfix on 发送格式mailx -s subject user@xxx.com &lt; message_fileecho “内容” | mailx -s “邮件标题” user@xxx.com 其他选项-r 指定发件人-c 指定抄送人-b 指定密送人多个收件人使用逗号分隔有些邮箱（如qq邮箱）会当成垃圾邮件拦截，日志中可以看到500错误 监控服务脚本是否运行正常监控脚本内容123456#!/bin/bashcount=`ssh m1 ps -ef|grep real_wrf.csh |grep -v &quot;grep&quot; |wc -l`#echo $countif [ 0 == $count ];then mailx -s &quot;the real_wrf.csh is not running &quot; a1@xxx.com.cn,a2@xxx.com.cn &lt; t.txt fi 监测目录下是否有文件12345678910111213141516171819#!/bin/bash#每天6:00~7:00检查前一天00时的数据，每天16:00~18:00检查前一天12时的数据Date1=`date -d &quot;1 day ago&quot; +&quot;%Y%m%d00&quot;`Date2=`date -d &quot;1 day ago&quot; +&quot;%Y%m%d_06&quot;`file=&quot;\/data/Model3/WRF/data/output/wrf/$Date1/wrfout_d03 \/data/Model3/CMAQ4.7/data/cctm-wrf/$Date1/CCTM_CONC.cn03.*.ncf \/data/Model3/CAMx6/data/post_save/$Date1/camxsave_d03* \/data/em/result/predictions/SHAANXI/$Date2/POST/naqpms_d03.* \/data/Model3/WRF/data/output/wrfchem/$Date1/wrfout_d03* \&quot;for i in $filedo if [ ! -f &quot;$i&quot; ]; then echo &quot;$i 文件不存在&quot; &gt;&gt; check_00mx_$Date1.txt mailx -s &quot;00时文件数据模型数据不存在&quot; b@xx.com.cn &lt; check_00mx_$Date1.txt fidone 监测目录是否存在，目录是否为空123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687#!/bin/bash#每天6:00~7:00检查前一天00时的数据，每天16:00~18:00检查前一天12时的数据Date1=`date +&quot;%Y&quot;`Date2=`date +&quot;%m&quot;`Date3=`date -d &apos;-1 day&apos; +&quot;%d&quot;`Date4=`date +&quot;%Y%m%d00&quot;`Dir=/data/Model3/WeatherForecastWRF_Dir=&quot;$Dir/WRF/$Date1/$Date2/$Date3/d3/500/ \$Dir/WRF/$Date1/$Date2/$Date3/d3/700/ \$Dir/WRF/$Date1/$Date2/$Date3/d3/850/ \$Dir/WRF/$Date1/$Date2/$Date3/d3/srf/&quot;WRFCHEM_Dir=&quot;$Dir/WRFCHEM/$Date1/$Date2/$Date3/00/d3/aqi \$Dir/WRFCHEM/$Date1/$Date2/$Date3/00/d3/co \$Dir/WRFCHEM/$Date1/$Date2/$Date3/00/d3/no2 \$Dir/WRFCHEM/$Date1/$Date2/$Date3/00/d3/o3 \$Dir/WRFCHEM/$Date1/$Date2/$Date3/00/d3/pm10 \$Dir/WRFCHEM/$Date1/$Date2/$Date3/00/d3/pm25 \$Dir/WRFCHEM/$Date1/$Date2/$Date3/00/d3/so2&quot;WRFCHEMDAY_Dir=&quot;$Dir/WRFCHEMDAY/$Date1/$Date2/$Date3/00/d3/aqi \$Dir/WRFCHEMDAY/$Date1/$Date2/$Date3/00/d3/co \$Dir/WRFCHEMDAY/$Date1/$Date2/$Date3/00/d3/no2 \$Dir/WRFCHEMDAY/$Date1/$Date2/$Date3/00/d3/o3 \$Dir/WRFCHEMDAY/$Date1/$Date2/$Date3/00/d3/pm10 \$Dir/WRFCHEMDAY/$Date1/$Date2/$Date3/00/d3/pm25 \$Dir/WRFCHEMDAY/$Date1/$Date2/$Date3/00/d3/so2&quot;CAMX_Dir=&quot;$Dir/CAMX/$Date1/$Date2/$Date3/00/d3/aqi \$Dir/CAMX/$Date1/$Date2/$Date3/00/d3/co \$Dir/CAMX/$Date1/$Date2/$Date3/00/d3/no2 \$Dir/CAMX/$Date1/$Date2/$Date3/00/d3/o3 \$Dir/CAMX/$Date1/$Date2/$Date3/00/d3/pm10 \$Dir/CAMX/$Date1/$Date2/$Date3/00/d3/pm25 \$Dir/CAMX/$Date1/$Date2/$Date3/00/d3/so2 &quot;CAMxDAY_Dir=&quot;$Dir/CAMxDAY/$Date1/$Date2/$Date3/00/d3/aqi \$Dir/CAMxDAY/$Date1/$Date2/$Date3/00/d3/co \$Dir/CAMxDAY/$Date1/$Date2/$Date3/00/d3/no2 \$Dir/CAMxDAY/$Date1/$Date2/$Date3/00/d3/o3 \$Dir/CAMxDAY/$Date1/$Date2/$Date3/00/d3/pm10 \$Dir/CAMxDAY/$Date1/$Date2/$Date3/00/d3/pm25 \$Dir/CAMxDAY/$Date1/$Date2/$Date3/00/d3/so2 &quot;CMAQ_WRF_Dir=&quot;$Dir/CMAQ.WRF/$Date1/$Date2/$Date3/00/d3/aqi \$Dir/CMAQ.WRF/$Date1/$Date2/$Date3/00/d3/co \$Dir/CMAQ.WRF/$Date1/$Date2/$Date3/00/d3/no2 \$Dir/CMAQ.WRF/$Date1/$Date2/$Date3/00/d3/o3 \$Dir/CMAQ.WRF/$Date1/$Date2/$Date3/00/d3/pm10 \$Dir/CMAQ.WRF/$Date1/$Date2/$Date3/00/d3/pm25 \$Dir/CMAQ.WRF/$Date1/$Date2/$Date3/00/d3/so2 &quot;CMAQDAY_Dir=&quot;$Dir/CMAQDAY/$Date1/$Date2/$Date3/00/d3/aqi \$Dir/CMAQDAY/$Date1/$Date2/$Date3/00/d3/co \$Dir/CMAQDAY/$Date1/$Date2/$Date3/00/d3/no2 \$Dir/CMAQDAY/$Date1/$Date2/$Date3/00/d3/o3 \$Dir/CMAQDAY/$Date1/$Date2/$Date3/00/d3/pm10 \$Dir/CMAQDAY/$Date1/$Date2/$Date3/00/d3/pm25 \$Dir/CMAQDAY/$Date1/$Date2/$Date3/00/d3/so2 &quot;NAQMPS_Dir=&quot;$Dir/NAQMPS/$Date1/$Date2/$Date3/00/d3/aqi \$Dir/NAQMPS/$Date1/$Date2/$Date3/00/d3/co \$Dir/NAQMPS/$Date1/$Date2/$Date3/00/d3/no2 \$Dir/NAQMPS/$Date1/$Date2/$Date3/00/d3/o3 \$Dir/NAQMPS/$Date1/$Date2/$Date3/00/d3/pm10 \$Dir/NAQMPS/$Date1/$Date2/$Date3/00/d3/pm25 \$Dir/NAQMPS/$Date1/$Date2/$Date3/00/d3/so2 &quot;NAQMPSDAY_Dir=&quot;$Dir/NAQMPSDAY/$Date1/$Date2/$Date3/00/d3/aqi \$Dir/NAQMPSDAY/$Date1/$Date2/$Date3/00/d3/co \$Dir/NAQMPSDAY/$Date1/$Date2/$Date3/00/d3/no2 \$Dir/NAQMPSDAY/$Date1/$Date2/$Date3/00/d3/o3 \$Dir/NAQMPSDAY/$Date1/$Date2/$Date3/00/d3/pm10 \$Dir/NAQMPSDAY/$Date1/$Date2/$Date3/00/d3/pm25 \$Dir/NAQMPSDAY/$Date1/$Date2/$Date3/00/d3/so2 &quot;Dir2=&quot;$WRF_Dir $WRFCHEM_Dir $WRFCHEMDAY_Dir $CAMX_Dir $CAMxDAY_Dir $CMAQ_WRF_Dir $CMAQDAY_Dir $NAQMPS_Dir $NAQMPSDAY_Dir&quot;for d in $Dir2do if [ ! -d $d ]; then echo &quot;$d 目录不存在&quot; &gt;&gt; /tmp/check_00tp_$Date4.txt elif [ `ls $d |wc -l` -eq 0 ]; then echo &quot;$d 目录下文件不存在&quot; &gt;&gt; /tmp/check_00tp_$Date4.txt fidonemailx -s &quot;$Date4 00时 模型出图情况&quot; c@xx.com.cn &lt; /tmp/check_00tp_$Date4.txt 设置crontab12301 13,17,01,04 * * * /data/tool/DRAW/shell/check_status/check_wrf.sh01 07 * * * /data/tool/DRAW/shell/check_status/check_00mx.sh01 08 * * * /data/tool/DRAW/shell/check_status/check_00tp.sh 另附短信发送脚本1234567891011121314#!/bin/bashdatedir1=`date +%Y%d`datedir2=`date +%Y%d%y`un=&quot;xxxxxxxx&quot;pw=&quot;xxxxxxxxxx&quot;phone=&quot;xxxxxxxxxxx&quot;msg=&quot;this is a test mes,please ignore&quot;if [ ! -d &quot;/data/em/data/GFS/$datedir1/$datedir2&quot; ];then curl --data &quot;un=$un&amp;pw=$pw&amp;phone=$phone&amp;msg=$msg&amp;rd=1&quot; &quot;http://sms.253.com/msg/send&quot; echo -e &quot;\n query balance:&quot; curl --data &quot;un=$un&amp;pw=$pw&quot; &quot;http://sms.253.com/msg/balance&quot;fiecho &quot;send sms:&quot; 短信参考：https://www.253.com/api-docs-13.html]]></content>
      <categories>
        <category>监控</category>
      </categories>
      <tags>
        <tag>监控</tag>
        <tag>mail</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[SSH 奇淫技巧之隧道模式]]></title>
    <url>%2Farlo%2Fda9b9fcb%2F</url>
    <content type="text"><![CDATA[用了ssh这么久，今天才知道ssh还有这么强大的功能，穿透内外网，来去自如；其实最重要的还是方便平时工作中的调试，在此简单的记录一下。 使用条件一台拥有ssh端口连接的外网linux服务器 本地转发场景：公网有一台服务器的公网ip，ssh端口(已修改为2012)没有对外开放，本地想直接连接此端口，可以通过公网一台开放ssh端口的服务器跳转过去1ssh -p 2012 -CNg -L 2222:namenode:2012 nsxq@1.2.3.4 将namenode服务器的2012端口通过1.2.3.4服务器映射到本地2222端口 ssh -p 2222 localhost 即可连接-p 指定跳转机端口—L 本地转发 远程转发场景：本地开发环境需要被外网访问，之前一直使用花生壳，ngrok之类的程序；现在只需要本地执行一条ssh命令，将本地的端口映射到一台外网的服务器上去1ssh -p 2012 -CNfg -R 0.0.0.0:8888:192.168.1.5:80 nsxq@1.2.3.4 将本地内网192.168.1.5:80 映射到1.2.3.4服务器的8888端口，访问1.2.3.4:8888 即可访问192.168.1.5:80 内容 打开1.2.3.4服务器需要sshd_config 配置中的GatewayPorts yes记得顺手打开防火墙端口-p 指定跳转机端口-R 远程转发 动态转发场景：相对于上边两种单一端口转发，此功能就是在本地启动一个端口，其他机器可以设置代理，通过此端口进行流量转发（俗称翻墙）。1ssh -D 5000 nsxq@1.2.3.4 我这里没有能上google的服务器，没法测试，按道理来说，其他机器就可以将代理设置为1.2.3.4:5000 进行商上网了 参考资料[实战ssh端口转发]http://www.ibm.com/developerworks/cn/linux/l-cn-sshforward/[SSH的三种端口转发（Port forwarding）/ 隧道协议概要]https://blog.twofei.com/528/]]></content>
      <categories>
        <category>常识</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>SSH</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[给下拉菜单和鼠标右键截图]]></title>
    <url>%2Farlo%2F8fb14fc6%2F</url>
    <content type="text"><![CDATA[调用常用的QQ软件截图1. 登陆qq2. 同时按住Crtl+Alt+Shift3. 松开Shift，其他两个手指不用松开4. 按住A5. 截图]]></content>
      <tags>
        <tag>windows</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[使用阿里云Docker镜像库加速]]></title>
    <url>%2Farlo%2F42c94ca5%2F</url>
    <content type="text"><![CDATA[开发者账号由于docker官方的镜像下载太慢了，于是开通了阿里云的开发者账号；申请开发者账号http://console.d.aliyun.com/join.htm?spm=0.0.0.0.Xx1dX0#/docker/booster本人的专属加速器地址https://4c2kkvb9.mirror.aliyuncs.com阿里云docker镜像搜索地址：https://cr.console.aliyun.com/#/imageSearch阿里云docker加速器使用加速器将会提升您在国内获取Docker官方镜像的速度！https://cr.console.aliyun.com/#/accelerator 加速器操作文档安装或升级Docker您可以通过阿里云的镜像仓库下载：mirrors.aliyun.com/help/docker-engine1curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet | sh - 配置Docker加速器 您可以使用如下的脚本将mirror的配置添加到docker daemon的启动参数中。系统要求 CentOS 7 以上，Docker 1.9 以上。1234cp -n /lib/systemd/system/docker.service /etc/systemd/system/docker.service sed -i &quot;s|ExecStart=/usr/bin/dockerd|ExecStart=/usr/bin/docker daemon --registry-mirror=https://4c2kkvb9.mirror.aliyuncs.com|g&quot; /etc/systemd/system/docker.service systemctl daemon-reload systemctl restart docker QAQ: docker pull 时候报错“ x509: certificate has expired or is not yet valid”A: 此问题是由于主机的时间不同步造成的，使用ntpdate cn.ntp.org.cn 同步网络时间即可。]]></content>
      <categories>
        <category>DevOps</category>
      </categories>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[使用kubernetes 1.4 新特性kubeadm创建集群]]></title>
    <url>%2Farlo%2Ff9f5730%2F</url>
    <content type="text"><![CDATA[背景kubernetes 发布的最新版本1.4，增加了很多新特性，据说只用两条命令就可以创建一个k8s集群，比起之前的搭建起来简单很多。[官方文档][ http://kubernetes.io/docs/getting-started-guides/kubeadm/ ] 环境主机资源192.168.234.139 dc01192.168.234.140 dc02192.168.234.141 dc03 操作系统推荐使用ubuntu 16 和centos 7 以上版本（我个人使用的是centos 7.2 x64） 软件安装在三台机器上上分别安装docker 和 kubelet、kubectl和kubeadm 安装docker1curl -sS https://get.docker.io/ |sh 安装kubelet、kubectl和kubeadm需要安装的kubelet、kubeadm、kubectl、 kubernetes-cni这四个rpm包是google的源，正常情况下国内是连接不上的，qq群(319807078)里已经有热心网友下载下来了，安装的时候会依赖一个socat的软件包,使用1yum localinstall *.rpm 启动服务三台机器都需要启动docker和kubelet 启动docker1systemctl enable docker &amp;&amp; systemctl start docker 启动kubelet1systemctl enable kubelet &amp;&amp; systemctl start kubelet # **此时启动kubelet是失败的，因为在/etc/kubernetes下还没有生成配置文件** 下载images123456images=(kube-proxy-amd64:v1.4.0 kube-discovery-amd64:1.0 kubedns-amd64:1.7 kube-scheduler-amd64:v1.4.0 kube-controller-manager-amd64:v1.4.0 kube-apiserver-amd64:v1.4.0 etcd-amd64:2.2.5 kube-dnsmasq-amd64:1.3 exechealthz-amd64:1.1 pause-amd64:3.0 kubernetes-dashboard-amd64:v1.4.0)for imageName in $&#123;images[@]&#125; ; do docker pull mritd/$imageName docker tag mritd/$imageName gcr.io/google_containers/$imageName docker rmi mritd/$imageNamedone 搭建集群初始化集群1kubeadm init --api-advertise-addresses=192.168.234.139 查看日志1journalctl -fu kubelet 漠然大神给出的此错误排错步骤NO.1、保证 hostname 中主机名为 xxxx.com 等这种域名格式NO.2、保证 hosts 文件中 有 127.0.0.1 与之对应NO.3、保证 gcr 相关镜像 已经 load 到本地NO.4、保证 iptables规则没问题，必要时候 -FNO.5、保证 selinux 已经关闭NO.6、init 之前保证 启动 kubelet，虽然启动后显示启动失败NO.7、重新 init 保证用 官方 clean 步骤做下清理官方清理脚本1234systemctl stop kubelet;docker rm -f -v $(docker ps -q);find /var/lib/kubelet | xargs -n 1 findmnt -n -t tmpfs -o TARGET -T | uniq | xargs -r umount -v;rm -r -f /etc/kubernetes /var/lib/kubelet /var/lib/etcd; 加入集群节点保证节点上启动了docker 和kubectl1kubeadm join --token 0ab76c.b59aaa1d1ab3cf93 192.168.234.139 查看加入的节点1kubectl get nodes 本文参考漠然大神链接漠然大神博客地址github build k8s rpm]]></content>
      <categories>
        <category>DevOps</category>
      </categories>
      <tags>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[CentOs 7 firewalld 防火墙无法启动]]></title>
    <url>%2Farlo%2F5a65cdf4%2F</url>
    <content type="text"><![CDATA[CentOs 7 无法启动，提示“Job for firewalld.service failed because a timeout was exceeded. See “systemctl status firewalld.service” and “journalctl -xe” for details.” 排错启动报错提示如下图排错很久，发现服务没有启动，但是有一个firewall的进程kill掉这个进程，顺利启动 常用firewall命令firewall-cmd –list-servicesfirewall-cmd –list-portsfirewall-cmd –add-port 80/tcp 添加端口firewall-cmd –add-service http 添加服务firewall-cmd –zone=external –add-masquerade 开启端口转发firewall-cmd –zone=external –add-forward-port=port=80:proto=tcp:toport=8080 本机80转发到本机8080firewall-cmd –zone=external –add-forward=port=9090:proto=tcp:toaddr=192.168.234.130 9090转发到另外一台机器的9090firewall-cmd –zone=external –add-forward=port=23:proto=tcp:toport=2003:toaddr=192.168.234.130 23转发到另外一台机器的2003firewall-cmd –zone=public –add-port=5060-5059/udp –permanent 范围端口，永久生效firewall-cmd –permanent –add-icmp-block=echo-reply 允许ICMP响应应答报文 顺便推荐一篇firewalld写的很好，很全的文章CentOS 7下使用FirewallD构建动态防火墙 参考链接]]></content>
      <categories>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>firewalld</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Jumpserver跳转机搭建过程中的疑问]]></title>
    <url>%2Farlo%2Fef870e7c%2F</url>
    <content type="text"><![CDATA[跳转机跳转机又名堡垒机，主要作用是在终端连接服务器之间加一层防护保障，保障连接到服务器的方式更加安全，更加透明，更加可控。Jumpserver官网的wiki、图解、视频教程做的已经很详细了，参考地址如下：[Jumpserver 官网地址:]http://www.jumpserver.org/[Jumpserver WiKi]https://github.com/jumpserver/jumpserver/wiki[Jumpserver v3 视频教程]http://bbs.jumpserver.org/read/639.html 记录问题以下是我在安装搭建过程中遇到的几个问题，在此记录一下。 用户用户管理中的用户: 用于登陆jumpserver跳转机和jumpserver web平台的用户；表示该类用户拥有登陆跳转机权限。设置中的默认管理员用户: 只适用于设置资产管理的时候，管理账号，使用默认选项；其实是一个缺省的管理员用户，只有大规模客户端使用相同的管理员用户名和密码是作用最大。添加资产时候的管理用户: 必须是真实存在于被添加的资产上，拥有管理权限（或sudo权限）的用户；被连接的资产设备上真是存在的管理员用户，如root。授权管理中的系统用户: 此用户是在添加jumpserver平台，通过推送在服务器上真是创建的用户； 服务器，客户端服务器：jms，安装jumpserver的这台服务器客户端：通过跳转机链接的资产，如被连接的服务器，网络设备等 推送推送是通过资产管理里的管理用户在服务器上建立系统用户和赋予sudo权限（如果管理sudo别名的话）]]></content>
      <tags>
        <tag>跳转机</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Xshell 使用技巧]]></title>
    <url>%2Farlo%2Fd1d8517a%2F</url>
    <content type="text"><![CDATA[Xshell 是一个强大的安全终端模拟软件，它支持SSH1, SSH2, 以及Microsoft Windows 平台的TELNET 协议。Xshell 通过互联网到远程主机的安全连接以及它创新性的设计和特色帮助用户在复杂的网络环境中享受他们的工作。Xshell可以在Windows界面下用来访问远端不同系统下的服务器，从而比较好的达到远程控制终端的目的。 主界面 添加链接。 可以保存的，以后不用输入用户名，密码，这个是putty没有的（有利有弊，从安全方面说，有风险哇。。。） 中文乱码，修改编码为 UTF-8 小键盘不能输入数字。 界面及字体颜色 看到这个真有点相见恨晚的感觉，右键粘贴功能，这个是用putty养成的习惯（虽然之前看到网上有说,选中后，使用ctrl+insert 复制，鼠标中键粘贴），在此感谢@ 吴天！最大的好处就是，你设置的这些，只需要设置一次就可以了，不用像putty里那种针对每个连接都设置一遍。xftp在这里就不说了，此处省去几十字。。。。。。。 xshell 5 每次exit退出时候，停留在本地shell界面，需要再次关闭，取消以下选项即可(ps：有强迫症的人可以顺手打上最后那个选项勾) Xshell选中文字复制时中断【转】在Xshell中设置了“自动将选中的文字复制到粘贴板”，之前一直没有问题，最近发现，只要选中屏幕上的文字，复制上了，但shell终端立即被中断了，即向终端发送了CTRL-C； 很可能是“选中文字复制”与词典软件的“划词翻译”相冲突。我的原因是，最近安装了必应词典，且开启了“划词翻译”功能。我在网上求助时，发现也有一些朋友遇到和我一样的问题，都是由于与词典的冲突导致的，如有道词典，关掉划译功能即可。 顺手分享一个xshell的配色方案将一些配置文件保存为x_shell.xcs格式1234567891011121314151617181920212223[x_shell]text(bold)=ffffffmagenta(bold)=ff00fftext=839496white(bold)=ffffffgreen=00c000red(bold)=ff0000green(bold)=00ff00black(bold)=808080red=808000blue=ff8040black=000000blue(bold)=8080ffyellow(bold)=ffff00cyan(bold)=00ffffyellow=c0c000magenta=c000c0background=002b35white=c0c0c0cyan=00c0c0[Names]count=1name0=x_shell 点击工具-配色方案-导入点击文件-属性-外观]]></content>
      <categories>
        <category>常识</category>
      </categories>
      <tags>
        <tag>xshell</tag>
        <tag>Linux</tag>
        <tag>常识</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[常用命令集合]]></title>
    <url>%2Farlo%2Fddba52eb%2F</url>
    <content type="text"><![CDATA[Windows进程查看123456789netstat -ano |findstr “8080” 查看端口netstat -ano |findstr “127.0.0.1”tasklist 查看进程tasklist |findstr “nginx”tskill 结束进程tskill nginxtskill 1130#查看文件被哪个进程占用打开资源管理器-CPU-关联的句柄-输入文件名称 映射网络驱动器1234net use Z: \\192.168.0.x\share /user:username password#断开网络驱动器net use Z: /del /ynet use * /del /y 桌面图标设置添加计算机到桌面1rundll32.exe shell32.dll,Control_RunDLL desk.cpl,,0 查看系统启动时间1systeminfo|find &quot;系统启动时间&quot; 常用快捷命令123456winver # 查看系统信息control.exe # 控制面板sysdm.cpl # 系统属性devmgmt.msc # 设备管理器compmgmt.msc # 计算机管理wf.msc # 防火墙管理 网络与共享中心1control.exe /name Microsoft.NetworkAndSharingCenter Linuxfree查看内存使用情况 可用内存=free+buffers+cached以用内存=used-buffers-cached所以看内存的使用不要看used 和free ，看 -/+ buffers/cache 就可以了查看内存插槽数1dmidecode|grep -P -A5 &quot;Memory\s+Device&quot;|grep Size|grep -v Range 查看内存最大容量1dmidecode | grep -P &apos;Maximum\s+Capacity&apos; 查看内存频率1dmidecode|grep -A16 &quot;Memory Device&quot;|grep &apos;Speed&apos; iostat查看磁盘性能 iostat -x 1 5%util 接近100%的时候，产生 的I/O 请求太多，I/O 系统已经满负荷，该磁盘可能存在瓶颈%idle 小于70%的时候，I/O 的 压力比较大，说明读取中有很多的wait du查看系统目录占用空间大小 在根目录下执行12du -hsx * |sort -rh |head -10du -ah --max-depth=1 推荐一款速度更快的工具ncdu uptime查看cpu的负载 每cpu的核心当前活动进程数不大于3，表示性能良好，大于五表示严重。 dd瞬间创建（1T）大文件1dd if=/dev/zero of=file bs=1G seek=1024 count=0 这个文件用ll -h 看着是1TB的，用du -sh 看着是空文件，随着写入的数据而增长 dd制作ISO镜像1dd if=/dev/cdrom of=/mnt/cd1.iso shopt选择性删除文件123shopt -s extglob 打开rm -fr !(file1|file2)shopt -u extglob #关闭 dstat监控系统状态1alias dstat=&apos;dstat -cdlmnpsy&apos; iftopn 显示ip/主机名p 显示端口l 输入过滤内容http://www.vpser.net/manage/iftop.html 网卡灯闪烁1ethtool -p eth0 终端快捷键123456ctrl + a 移动光标到行首ctrl + e 移动光标到行尾（好像不生效）ctrl + r 查找历史命令ctrl + u 删除从光标到行首ctrl + k 删除从光标到行尾ctrl + l 清屏 更多参考：http://harttle.com/2015/11/09/bash-shortcuts.html]]></content>
      <categories>
        <category>常识</category>
      </categories>
      <tags>
        <tag>常识</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[升级mysql数据库字符集为utf8mb4]]></title>
    <url>%2Farlo%2F3b439eff%2F</url>
    <content type="text"><![CDATA[之前公司的项目中一直使用的mysql版本(5.1.73)，使用utf8字符集，基本上没有什么问题的;现在开始做一些手机客户端之类的项目，发送表情(emoji)的时候会报错“ ‘\xF0\x9F\x98\xB1’ for column ‘body’ at row 1”；Google了一把，原因是因为表情存储需要4个字节，但是mysql的utf8字符集编码只支持1-3个字节，存储空间不够就报错了，因此需要升级一下字符集。MYSQL 5.5.3之后的版本支持UTF8MB4字符集，一个字符最多能有4字节，此字符集也是完全兼容utf8的，不存在兼容性问题。升级完mysql-server之后 修改配置文件123456789[client]default-character-set = utf8mb4[mysql]default-character-set = utf8mb4[mysqld]character-set-client-handshake = FALSEcharacter-set-server = utf8mb4collation-server = utf8mb4_unicode_ciinit_connect=&apos;SET NAMES utf8mb4&apos; 修改完这些配置文件后，之后创建的库、表就是utf8mb4格式了，但是之前的收据就需要手动修改一下了123ALTER DATABASE database_name CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci;ALTER TABLE table_name CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;ALTER TABLE table_name CHANGE column_name VARCHAR(191) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci; 重启mysql，查看字符集/etc/init.d/mysqld restart 使用utf8mb4，需注意：1.mysql-server 版本需要高于5.5.32.mysql-connector 版本需要高于5.1.3版本(建议升级到最新版，目前是5.1.39) 参考：http://www.wangyuxiong.com/blog/mysql-dbzi-fu-ji-sheng-ji-zhi-utf8mb4,24/https://segmentfault.com/a/1190000000616820]]></content>
      <categories>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[正在启动windows卡住故障的填坑之路]]></title>
    <url>%2Farlo%2F4c7121ca%2F</url>
    <content type="text"><![CDATA[事件起因同事新买了一个ThinkPad E460，出厂系统为Windows8.1，希望修改为win7，于是开始了我的填坑之路，此故障之前在联想的S405上也遇到了一次。 故障现象安装完操作系统后，出现“正在启动windows卡住”，如图: 更换安装版镜像 BIOS中硬盘模式调整 PE中重新分区 使用mhdd工具扫描硬盘 做了以上步骤，实在是黔驴技穷啊，于是联系了ThinkPad的客服人员！ 使用安装版镜像，不能发现硬盘问题官方客服给出的故障原因是，“原生Win7系统不包含USB3.0的驱动，所以无法使用USB3.0的U盘在USB3.0的设备上引导，且安装完系统后还需要重新安装USB3.0驱动” 解决方案: 注：此方案仅适用于Intel芯片组的机型，AMD芯片组的机型将无法使用,文档中写明支持win7 32位系统，但是实测部分32位系统会存在问题，建议使用win7 64位系统安装 从Intel官网下载Windows7 USB3.0 Creator 实用程序 解压缩之前下载的软件，在解压缩路径下右键以管理员方式运行Installer_Creator.exe 在弹出界面中点击右侧的选择按钮，选中U盘所在分区 点击Create Image开始往U盘中添加程序，过程会比较长，Intel官方数据是15分钟，实测超过20分钟 在出现Upadte finished！后创建结束，现在就可以使用这个U盘在USB 3.0接口上安装系统了使用安装完补丁的U盘安装完系统USB3.0驱动会自动安装上。坑坑一：win7，win8.1，win10 均不能讲此驱动安装到U盘上，报错如下图坑二更换Ghost版本的镜像，安装完操作系统后依然是启动到“正在启动windows”卡主，进入安全模式卡在“\Windows\System32\drivers\ahcix64s.sys 界面”坑三 使用DG格式化整个硬盘 重建分区表 更换分区类型（MBR/GPT） 激活主分区其他坑预装Win8/8.1系统的电脑改装为Win7系统的操作步骤及常见问题 填坑使用Windows 7 USB DVD Download Tool或者软碟通（UltraISO）制作Win7原版安装盘（不要使用Ghost镜像制作，否则后续会有报错） 使用Win7光盘或者U盘（建议usb2.0的U盘）引导，进入系统安装界面 按Shift + F10打开命令提示符。(Edge系列机器需要按Fn+Shift+F10) 输入”Diskpart”(不用输入引号，下同)，并按回车，进入操作界面 输入：”list空格disk”，查看磁盘信息。注意看磁盘容量来选择。图中465G的Disk 0是硬盘，3852M的Disk 1是用于Win7安装的U盘 输入：”select 空格disk空格 0”，选择disk 0为当前操作的磁盘 输入：”Clean”，清空当前磁盘分区。 输入：”convert 空格 mbr”，转换为MBR分区。 操作完成，关闭此命令提示符窗口，继续按照正常的方法安装Win7系统即可（由于我坑一中的usb3.0 的驱动没有填好，就使用PE安装ghost版本的镜像安装了）。 总结这个故障是我在安装操作系统的时候遇到的最棘手的问题，最主要的步骤就是在dos模式下清空一下磁盘分区；这里只是记录了其中最主要的几个坑，希望给遇到的朋友一些参考。]]></content>
      <categories>
        <category>Troubleshooting</category>
      </categories>
      <tags>
        <tag>Windows</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hexo博客搭建简记]]></title>
    <url>%2Farlo%2Fe5e5519a%2F</url>
    <content type="text"><![CDATA[背景博客是我记录学习过程最好的方式；我的第一个博客是百度空间，后来百度关闭了；第二个博客是ChinaUnix，最近ChinaUnix升级了安全，牛盾老是阻止我访问，再者ChinaUnix风格太老了，写出来的东西也不漂亮，于是就想自己搭建一个博客，现在的blog有很多，比如wordpress，ghost，等等，比较之下觉得hexo有逼格，高大上，就你了！ 环境搭建基础环境 Node.js Git Github MarkDown 编辑器 软件获取下载nodejs下载git 安装过程安装gitstart–&gt;next–&gt;end(详细过程略) 安装nodejsstart–&gt;next–&gt;end(详细过程略) 安装hexo 开始安装Hexonpm install -g hexo 初始化博客hexo init #默认路径为当前目录，可以在init后手动指定一个目录为博客根目录 生成静态页面hexo g #完整命令hexo generate 启动本地服务hexo s #完整命令hexo server，默认启动范围地址 http://localhost:4000 可以使用-p指定端口至此hexo 博客安装完毕 github注册并登陆github创建一个与自己用户名对应的项目(如：nsxq.github.io) 配置hexohexo的主配置文件就是blog主目录下的_config.yml文件咯打开文件，在配置文件最末尾，修改配置为：123type: gitrepo: git@github.com:nsxq/nsxq.github.io.gitbranch: master 安装插件，支持hexo提交到githubnpm install hexo-deployer-git --save 提交blog数据到githubhexo d** #完整命令 hexo deploy 更换皮肤next目前我看到的最漂亮的皮肤就是nextgit clone https://github.com/iissnan/hexo-theme-next复制hexo-theme-next目录到hexo\themes\为next修改_config.yml中配置项theme: nextnext主题默认的Next.Muse,可以在主题配置文件hexo\themes\next_config.yml中修改Schemes更换字体 图片居左修改E:\Hexo\themes\next\source\css_custom\custom.styl.post-body .fancybox img { margin-left: 0 !important; } 将blog发布到公网 我的在阿里云（原万网）上买的域名，设置一条CNAME即可CNAME @ 默认 nsxq.github.io 在hexo\source 目录下新建一个文件CNAME，内容为islocal.cc 修改_config.yml中url为url: http://islocal.cc hexo g hexo d浏览器就可以使用http://islocal.cc 访问blog了 编写第一篇博文 是不是终于搭建完成了，懵逼了，完全不知道干吗了？ 是不是搭建完发现blog上不能直接编写很惊讶？ 是不是终于google到可以使用markdown语法编写，从来没用过？ 这都不是事儿！教程奉上markdown快速入门Hexo博客的写作工具奉上马克飞象在线markdown编辑器让Baidu和Google收录Hexo博客 参考文档Hexo官方中文文档]]></content>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
</search>
